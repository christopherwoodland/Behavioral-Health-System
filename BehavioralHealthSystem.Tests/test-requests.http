### Behavioral Health System - Local Testing
### Use with VS Code REST Client extension or similar HTTP clients

### Variables
@baseUrl = http://localhost:7071
@userId = test-user-7ab023fd
@sessionId = 0325d3e3-55f4-43ec-83eb-c6f4064250d7

### 1. Health Check - Verify the function is running
GET {{baseUrl}}/api/health
Accept: application/json

###

### 2. Test Kintsugi API Connection - Verify API credentials
POST {{baseUrl}}/api/TestKintsugiConnection
Content-Type: application/json

{
  "userId": "{{userId}}",
  "testConnection": true
}

###

### 3. Initiate Session - Create a new session for user
POST {{baseUrl}}/api/sessions/initiate
Content-Type: application/json

{
  "userId": "{{userId}}",
  "metadata": {
    "age": 28,
    "ethnicity": "Hispanic, Latino, or Spanish Origin",
    "gender": "female",
    "language": true,
    "race": "white",
    "weight": 140,
    "zipcode": "90210"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/test_recording.wav",
  "audioFileName": "test_recording.wav"
}

###

### 3.1. Initiate Session - Alternative with SAS URL
POST {{baseUrl}}/api/sessions/initiate
Content-Type: application/json

{
  "userId": "{{userId}}",
  "metadata": {
    "age": 28,
    "ethnicity": "Hispanic, Latino, or Spanish Origin",
    "gender": "female",
    "language": true,
    "race": "white",
    "weight": 140,
    "zipcode": "90210"
  },
  "audioFileUrl": "https://aistgvi.blob.core.windows.net/nasa/output.wav?sp=r&st=2025-09-04T01:25:45Z&se=2025-10-11T09:40:45Z&spr=https&sv=2024-11-04&sr=b&sig=gX0NvSqhzbPWjyQHfXRumnhg%2F2nhJnipmPDh3%2FFqgVY%3D",
    "audioFileName": "output.wav"
}

###

### 4. Submit Prediction - Submit prediction data
POST {{baseUrl}}/api/predictions/submit
Accept: application/json

###

### 5. Get User Predictions - Retrieve prediction results
GET {{baseUrl}}/api/predictions/{{userId}}
Accept: application/json

###

### 5.1. Get Prediction by Session ID - Retrieve specific session result
GET {{baseUrl}}/api/predictions/sessions/{{sessionId}}
Accept: application/json

###

### Advanced Test Cases

### 6. Initiate Session with Minimal Data
POST {{baseUrl}}/api/sessions/initiate
Content-Type: application/json

{
  "userId": "minimal-user",
  "metadata": {
    "age": 25,
    "gender": "male"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/minimal_test.wav",
  "audioFileName": "minimal_test.wav"
}

###

### 6.1. Submit Prediction with Minimal Data
POST {{baseUrl}}/api/predictions/submit
Content-Type: application/json

{
  "userId": "minimal-user",
  "metadata": {
    "age": 25,
    "gender": "male"
  },
  "audioData": "UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="
}

###

### 7. Test Invalid Request (should return validation errors)
POST {{baseUrl}}/api/sessions/initiate
Content-Type: application/json

{
  "userId": "",
  "metadata": {},
  "audioData": ""
}

###

### 8. Initiate Session with Different Demographics
POST {{baseUrl}}/api/sessions/initiate
Content-Type: application/json

{
  "userId": "diverse-user-456",
  "metadata": {
    "age": 35,
    "ethnicity": "Asian",
    "gender": "non-binary",
    "language": false,
    "race": "asian",
    "weight": 165,
    "zipcode": "10001"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/diverse_test.wav",
  "audioFileName": "diverse_test.wav"
}

###

### 8.1. Submit Prediction with Different Demographics
POST {{baseUrl}}/api/predictions/submit
Content-Type: application/json

{
  "userId": "diverse-user-456",
  "metadata": {
    "age": 35,
    "ethnicity": "Asian",
    "gender": "non-binary",
    "language": false,
    "race": "asian",
    "weight": 165,
    "zipcode": "10001"
  },
  "audioData": "UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="
}

###

### API Testing Sequence
### 1. Run step 1 (Health Check) to verify functions are running
### 2. Run step 2 (Test Connection) to verify API credentials
### 3. Run step 3 (Initiate Session) to create a new session
### 4. Run step 4 (Submit Prediction) to submit prediction data  
### 5. Run step 5 to get results by userId OR
###    Run step 5.1 to get results by sessionId
###
### Audio File Submission Options:
### - URL-based (Recommended): Provide audioFileUrl and audioFileName
### - Base64: Provide audioData as base64-encoded content
### 
### Expected Response Flow:
### - Health Check: {"status": "Healthy", ...}
### - Test Connection: {"message": "Connection successful", ...}
### - Initiate Session: {"sessionId": "abc123", "userId": "test-user-123"}
### - Submit Prediction: {"success": true, "sessionId": "..."}
### - User Predictions (by userId): [{"sessionId": "...", "results": [...]}]
### - Prediction (by sessionId): {"sessionId": "...", "status": "...", "predictedScore": "...", ...}
