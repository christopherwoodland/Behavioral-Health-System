### Behavioral Health System - Local Testing
### Use with VS Code REST Client extension or similar HTTP clients

### Variables
@baseUrl = http://localhost:7071
@userId = test-user-7ab023fd
@sessionId = 0325d3e3-55f4-43ec-83eb-c6f4064250d7

### 1. Health Check - Verify the function is running
GET {{baseUrl}}/api/health
Accept: application/json

###

### 2. Test Kintsugi API Connection - Verify API credentials
POST {{baseUrl}}/api/TestKintsugiConnection
Content-Type: application/json

{
  "userId": "{{userId}}",
  "testConnection": true
}

###

### 3. Start Behavioral Health Workflow - Main workflow entry point (URL-based)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "{{userId}}",
  "metadata": {
    "age": 28,
    "ethnicity": "Hispanic, Latino, or Spanish Origin",
    "gender": "female",
    "language": true,
    "race": "white",
    "weight": 140,
    "zipcode": "90210"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/test_recording.wav",
  "audioFileName": "test_recording.wav"
}

###

### 3.1. Start Workflow - Alternative with Base64 Audio Data (Legacy)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "{{userId}}",
  "metadata": {
    "age": 28,
    "ethnicity": "Hispanic, Latino, or Spanish Origin",
    "gender": "female",
    "language": true,
    "race": "white",
    "weight": 140,
    "zipcode": "90210"
  },
  "audioFileUrl": "https://aistgvi.blob.core.windows.net/nasa/output.wav?sp=r&st=2025-09-04T01:25:45Z&se=2025-10-11T09:40:45Z&spr=https&sv=2024-11-04&sr=b&sig=gX0NvSqhzbPWjyQHfXRumnhg%2F2nhJnipmPDh3%2FFqgVY%3D",
    "audioFileName": "output.wav"
}

###

### 4. Get Workflow Status - Check orchestration progress
### Replace {instanceId} with the ID returned from step 3
GET {{baseUrl}}/api/orchestrators/your-instance-id-here
Accept: application/json

###

### 5. Get User Predictions - Retrieve prediction results
GET {{baseUrl}}/api/predictions/{{userId}}
Accept: application/json

###

### 5.1. Get Prediction by Session ID - Retrieve specific session result
GET {{baseUrl}}/api/predictions/sessions/{{sessionId}}
Accept: application/json

###

### Advanced Test Cases

### 6. Start Workflow with Minimal Data (URL-based)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "minimal-user",
  "metadata": {
    "age": 25,
    "gender": "male"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/minimal_test.wav",
  "audioFileName": "minimal_test.wav"
}

###

### 6.1. Start Workflow with Minimal Data (Base64 - Legacy)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "minimal-user",
  "metadata": {
    "age": 25,
    "gender": "male"
  },
  "audioData": "UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="
}

###

### 7. Test Invalid Request (should return validation errors)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "",
  "metadata": {},
  "audioData": ""
}

###

### 8. Test with Different Demographics (URL-based)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "diverse-user-456",
  "metadata": {
    "age": 35,
    "ethnicity": "Asian",
    "gender": "non-binary",
    "language": false,
    "race": "asian",
    "weight": 165,
    "zipcode": "10001"
  },
  "audioFileUrl": "https://yourstorageaccount.blob.core.windows.net/audio/diverse_test.wav",
  "audioFileName": "diverse_test.wav"
}

###

### 8.1. Test with Different Demographics (Base64 - Legacy)
POST {{baseUrl}}/api/KintsugiWorkflow_HttpStart
Content-Type: application/json

{
  "userId": "diverse-user-456",
  "metadata": {
    "age": 35,
    "ethnicity": "Asian",
    "gender": "non-binary",
    "language": false,
    "race": "asian",
    "weight": 165,
    "zipcode": "10001"
  },
  "audioData": "UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="
}

###

### Workflow Testing Sequence
### 1. Run step 1 (Health Check) to verify functions are running
### 2. Run step 2 (Test Connection) to verify API credentials
### 3. Run step 3 (Start Workflow - URL-based) for modern approach OR
###    Run step 3.1 (Start Workflow - Base64) for legacy approach
### 4. Replace {instanceId} in step 4 with the actual ID and run to check status
### 5. Wait for workflow completion, then run step 5 to get results by userId OR
###    Run step 5.1 to get results by sessionId
###
### Audio File Submission Options:
### - URL-based (Recommended): Provide audioFileUrl and audioFileName
### - Base64 (Legacy): Provide audioData as base64-encoded content
### 
### Expected Response Flow:
### - Health Check: {"status": "Healthy", ...}
### - Test Connection: {"message": "Connection successful", ...}
### - Start Workflow: {"instanceId": "abc123", "userId": "test-user-123"}
### - Workflow Status: {"runtimeStatus": "Running|Completed", ...}
### - User Predictions (by userId): [{"sessionId": "...", "results": [...]}]
### - Prediction (by sessionId): {"sessionId": "...", "status": "...", "predictedScore": "...", ...}
