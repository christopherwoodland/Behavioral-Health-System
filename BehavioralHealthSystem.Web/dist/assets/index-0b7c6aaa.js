var Ps=Object.defineProperty;var Ls=(a,t,s)=>t in a?Ps(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var B=(a,t,s)=>(Ls(a,typeof t!="symbol"?t+"":t,s),s);import{j as e,u as os,Q as Fs,a as Os}from"./query-7a13343f.js";import{a as Us,r as h,u as vt,N as ls,b as $t,L as ie,c as Hs,R as cs,B as zs,d as Bs,e as Ae}from"./vendor-b4aac61f.js";import{F as Ws,t as Wt,f as qs}from"./ffmpeg-c0c62554.js";import{B as Vs,e as Gs}from"./azure-e79d136e.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Et={},qt=Us;Et.createRoot=qt.createRoot,Et.hydrateRoot=qt.hydrateRoot;let lt;const Ys=new Uint8Array(16);function Ks(){if(!lt&&(lt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!lt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return lt(Ys)}const ce=[];for(let a=0;a<256;++a)ce.push((a+256).toString(16).slice(1));function Js(a,t=0){return ce[a[t+0]]+ce[a[t+1]]+ce[a[t+2]]+ce[a[t+3]]+"-"+ce[a[t+4]]+ce[a[t+5]]+"-"+ce[a[t+6]]+ce[a[t+7]]+"-"+ce[a[t+8]]+ce[a[t+9]]+"-"+ce[a[t+10]]+ce[a[t+11]]+ce[a[t+12]]+ce[a[t+13]]+ce[a[t+14]]+ce[a[t+15]]}const Xs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vt={randomUUID:Xs};function Zs(a,t,s){if(Vt.randomUUID&&!t&&!a)return Vt.randomUUID();a=a||{};const r=a.random||(a.rng||Ks)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){s=s||0;for(let n=0;n<16;++n)t[s+n]=r[n];return t}return Js(r)}const He={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!0},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},Be={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},Ye={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},Ke={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300},Re=()=>{let a=localStorage.getItem(Be.USER_ID);return(!a||a.trim().length===0)&&(a=Zs(),localStorage.setItem(Be.USER_ID,a)),a},Qs=()=>{const a=localStorage.getItem(Be.THEME);return a==="light"||a==="dark"?a:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Gt=a=>{localStorage.setItem(Be.THEME,a),a==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},er=()=>{const a=localStorage.getItem(Be.PROCESSING_MODE);return a==="true"||a==="false"?a==="true":!1},tr=a=>{localStorage.setItem(Be.PROCESSING_MODE,a.toString())},Xe=a=>{const t=new Date,s=new Date(a),r=t.getTime()-s.getTime(),n=Math.floor(r/(1e3*60)),i=Math.floor(r/(1e3*60*60)),o=Math.floor(r/(1e3*60*60*24));return n<1?"Just now":n<60?`${n}m ago`:i<24?`${i}h ago`:o<7?`${o}d ago`:s.toLocaleDateString()},ze=a=>new Date(a).toLocaleString(),pe=(a,t,s)=>({code:a,message:t,details:s,timestamp:new Date().toISOString()}),sr=a=>a instanceof TypeError&&a.message.includes("fetch")?!0:a instanceof Error?a.message.includes("Network")||a.message.includes("connection")||a.message.includes("timeout"):!1,de=(a,t="polite")=>{const s=document.createElement("div");s.setAttribute("aria-live",t),s.setAttribute("aria-atomic","true"),s.className="sr-only",s.textContent=a,document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},1e3)},rr=(a,t=100)=>{setTimeout(()=>{const s=document.getElementById(a);s&&s.focus()},t)},ds=h.createContext(void 0),ar=()=>{const a=h.useContext(ds);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a},nr=({children:a})=>{const[t,s]=h.useState(Qs),r=o=>{s(o),Gt(o)},n=()=>{r(t==="light"?"dark":"light")};h.useEffect(()=>{Gt(t)},[t]),h.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),l=u=>{localStorage.getItem("bh_theme")||s(u.matches?"dark":"light")};return o.addEventListener("change",l),()=>o.removeEventListener("change",l)},[]);const i={theme:t,toggleTheme:n,setTheme:r};return e.jsx(ds.Provider,{value:i,children:a})};/*! @azure/msal-common v15.12.0 2025-08-19 */const ge={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"};/*! @azure/msal-common v15.12.0 2025-08-19 */class Pt extends Error{constructor(t,s,r){const n=s?`${t}: ${s}`:t;super(n),Object.setPrototypeOf(this,Pt.prototype),this.errorCode=t||ge.EMPTY_STRING,this.errorMessage=s||ge.EMPTY_STRING,this.subError=r||ge.EMPTY_STRING,this.name="AuthError"}setCorrelationId(t){this.correlationId=t}}/*! @azure/msal-common v15.12.0 2025-08-19 */var ue;(function(a){a[a.Error=0]="Error",a[a.Warning=1]="Warning",a[a.Info=2]="Info",a[a.Verbose=3]="Verbose",a[a.Trace=4]="Trace"})(ue||(ue={}));class ft{constructor(t,s,r){this.level=ue.Info;const n=()=>{},i=t||ft.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||n,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:ue.Info,this.correlationId=i.correlationId||ge.EMPTY_STRING,this.packageName=s||ge.EMPTY_STRING,this.packageVersion=r||ge.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ue.Info}}clone(t,s,r){return new ft({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},t,s)}logMessage(t,s){if(s.logLevel>this.level||!this.piiLoggingEnabled&&s.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${s.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${ue[s.logLevel]} - ${t}`;this.executeCallback(s.logLevel,i,s.containsPii||!1)}executeCallback(t,s,r){this.localCallback&&this.localCallback(t,s,r)}error(t,s){this.logMessage(t,{logLevel:ue.Error,containsPii:!1,correlationId:s||ge.EMPTY_STRING})}errorPii(t,s){this.logMessage(t,{logLevel:ue.Error,containsPii:!0,correlationId:s||ge.EMPTY_STRING})}warning(t,s){this.logMessage(t,{logLevel:ue.Warning,containsPii:!1,correlationId:s||ge.EMPTY_STRING})}warningPii(t,s){this.logMessage(t,{logLevel:ue.Warning,containsPii:!0,correlationId:s||ge.EMPTY_STRING})}info(t,s){this.logMessage(t,{logLevel:ue.Info,containsPii:!1,correlationId:s||ge.EMPTY_STRING})}infoPii(t,s){this.logMessage(t,{logLevel:ue.Info,containsPii:!0,correlationId:s||ge.EMPTY_STRING})}verbose(t,s){this.logMessage(t,{logLevel:ue.Verbose,containsPii:!1,correlationId:s||ge.EMPTY_STRING})}verbosePii(t,s){this.logMessage(t,{logLevel:ue.Verbose,containsPii:!0,correlationId:s||ge.EMPTY_STRING})}trace(t,s){this.logMessage(t,{logLevel:ue.Trace,containsPii:!1,correlationId:s||ge.EMPTY_STRING})}tracePii(t,s){this.logMessage(t,{logLevel:ue.Trace,containsPii:!0,correlationId:s||ge.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */var Yt;(function(a){a.Redirect="redirect",a.Popup="popup",a.Silent="silent",a.None="none"})(Yt||(Yt={}));const ir={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"};/*! @azure/msal-browser v4.23.0 2025-09-17 */const or="storage_not_supported",ae="stubbed_public_client_application_called",lr="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const cr={[or]:"Given storage configuration option was not supported.",[ae]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[lr]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Lt extends Pt{constructor(t,s){super(t,s),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Lt.prototype)}}function le(a){return new Lt(a,cr[a])}/*! @azure/msal-browser v4.23.0 2025-09-17 */const dr={initialize:()=>Promise.reject(le(ae)),acquireTokenPopup:()=>Promise.reject(le(ae)),acquireTokenRedirect:()=>Promise.reject(le(ae)),acquireTokenSilent:()=>Promise.reject(le(ae)),acquireTokenByCode:()=>Promise.reject(le(ae)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(le(ae)),loginPopup:()=>Promise.reject(le(ae)),loginRedirect:()=>Promise.reject(le(ae)),logout:()=>Promise.reject(le(ae)),logoutRedirect:()=>Promise.reject(le(ae)),logoutPopup:()=>Promise.reject(le(ae)),ssoSilent:()=>Promise.reject(le(ae)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw le(ae)},getLogger:()=>{throw le(ae)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw le(ae)},hydrateCache:()=>Promise.reject(le(ae)),clearCache:()=>Promise.reject(le(ae))};/*! @azure/msal-react v3.0.19 2025-08-19 */const hr={instance:dr,inProgress:ir.None,accounts:[],logger:new ft({})},hs=h.createContext(hr);hs.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */const ur=()=>h.useContext(hs),gr={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},ne={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},us=h.createContext(void 0),qe=()=>{const a=h.useContext(us);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a},mr=({children:a})=>e.jsx(e.Fragment,{children:a}),xr=({children:a})=>null,pr={id:"mock-user-id",email:"anonymous@localhost",name:"Anonymous User",roles:["Admin"],primaryRole:"Admin",groups:[],preferredUsername:"anonymous"},fr=({children:a})=>{const t={user:pr,isAuthenticated:!0,isLoading:!1,error:null,login:async()=>{console.log("Mock login called - no action taken")},logout:async()=>{console.log("Mock logout called - no action taken")},clearError:()=>{console.log("Mock clearError called - no action taken")},hasRole:()=>!0,hasAnyRole:()=>!0,isAdmin:()=>!0,canAccessControlPanel:()=>!0};return e.jsx(us.Provider,{value:t,children:a})};console.log("Authentication mode:","Mock authentication enabled");console.log("VITE_ENABLE_ENTRA_AUTH:","false");const yr=({children:a})=>e.jsx(fr,{children:a}),br=()=>{const{login:a,isLoading:t,error:s}=qe(),r=()=>{a().catch(console.error)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:e.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:"ðŸ§ "})}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),e.jsxs("div",{className:"space-y-4",children:[s&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:s})}),e.jsx("button",{onClick:r,disabled:t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),e.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),e.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),e.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},Kt=({children:a,fallback:t,redirectTo:s})=>{const r=vt();return e.jsxs(e.Fragment,{children:[e.jsx(mr,{children:a}),e.jsx(xr,{children:t||(s?e.jsx(ls,{to:s,state:{from:r},replace:!0}):e.jsx(br,{}))})]})},wr=({children:a,roles:t,requireAll:s=!1,fallback:r,redirectTo:n})=>{const{hasRole:i,hasAnyRole:o,user:l}=qe(),u=vt();return(s?t.every(g=>i(g)):o(t))?e.jsx(e.Fragment,{children:a}):r?e.jsx(e.Fragment,{children:r}):n?e.jsx(ls,{to:n,state:{from:u},replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸš«"}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",t.length>1?"s":"",": ",t.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",l!=null&&l.roles.length&&l.roles.length>1?"s":"",": ",(l==null?void 0:l.roles.join(", "))||"None"]})]})]})})},Ie=({children:a,requireAuth:t=!0,requireRoles:s=[],requireAll:r=!1,fallback:n,redirectTo:i})=>!t&&s.length===0?e.jsx(e.Fragment,{children:a}):t&&s.length===0?e.jsx(Kt,{fallback:n,redirectTo:i,children:a}):e.jsx(Kt,{fallback:n,redirectTo:i,children:e.jsx(wr,{roles:s,requireAll:r,fallback:n,redirectTo:i,children:a})}),vr=()=>{const a=$t(),t=vt(),{user:s,isAuthenticated:r,isLoading:n,hasRole:i}=qe();return h.useEffect(()=>{if(n||!r||!s||t.pathname!=="/")return;let o="/";i(ne.CONTROL_PANEL)&&!i(ne.ADMIN)?o="/summary":(i(ne.ADMIN),o="/"),o!==t.pathname&&a(o,{replace:!0})},[s,r,n,t.pathname,a,i]),null};class kr{constructor(t,s){B(this,"msalInstance");B(this,"accounts");this.msalInstance=t,this.accounts=s}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...gr,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(t){return console.warn("Failed to acquire access token silently:",t),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const t=this.accounts[0];return{userId:t.homeAccountId,username:t.username,name:t.name}}}const jr=()=>{const{instance:a,accounts:t}=ur();return new kr(a,t)};class Nr{constructor(t,s){B(this,"baseUrl");B(this,"authProvider");this.baseUrl=t,this.authProvider=s}setAuthProvider(t){this.authProvider=t}async handleResponse(t){if(!t.ok){const s=await t.json().catch(()=>({}));throw pe(`HTTP_${t.status}`,s.message||`HTTP ${t.status}: ${t.statusText}`,{status:t.status,statusText:t.statusText,data:s})}return t.json()}async request(t,s={}){try{const r=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,n=t.startsWith("/")?t:`/${t}`,i=`${r}${n}`,o={"Content-Type":"application/json",...s.headers};if(this.authProvider)try{const u=await this.authProvider.getAuthHeaders();Object.assign(o,u)}catch(u){console.warn("Failed to get authentication headers:",u)}const l=await fetch(i,{...s,headers:o});return this.handleResponse(l)}catch(r){throw sr(r)?pe("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:r}):r instanceof Error&&"code"in r?r:pe("UNKNOWN_ERROR","An unexpected error occurred",{originalError:r})}}async get(t){return this.request(t,{method:"GET"})}async post(t,s){return this.request(t,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(t,s){return this.request(t,{method:"PUT",body:s?JSON.stringify(s):void 0})}async delete(t){return this.request(t,{method:"DELETE"})}}const fe=new Nr(He.api.baseUrl),_r=a=>{fe.setAuthProvider(a)},Q={async checkHealth(){return fe.get(Ye.HEALTH)},async initiateSession(a){return fe.post(Ye.SESSIONS_INITIATE,a)},async submitPrediction(a){return fe.post(Ye.PREDICTIONS_SUBMIT,a)},async getPredictionBySessionId(a){return fe.get(`${Ye.PREDICTIONS_BY_SESSION}/${a}`)},async getUserPredictions(a){return fe.get(`${Ye.PREDICTIONS_BY_USER}/${a}`)},async saveSessionData(a){return fe.post("sessions",a)},async getSessionData(a){return fe.get(`sessions/${a}`)},async getUserSessions(a){return fe.get(`sessions/users/${a}`)},async getAllSessions(){return fe.get("sessions/all")},async updateSessionData(a,t){return fe.put(`sessions/${a}`,t)},async deleteSessionData(a){return fe.delete(`sessions/${a}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(a){return{success:!1,message:a.message||"Connection test failed"}}},async generateRiskAssessment(a){return fe.post(`sessions/${a}/risk-assessment`)},async getRiskAssessment(a){return fe.get(`sessions/${a}/risk-assessment`)}};class Jt{constructor(t,s={}){B(this,"sessionId");B(this,"intervalMs");B(this,"maxAttempts");B(this,"backoffFactor");B(this,"currentAttempt",0);B(this,"timeoutId",null);B(this,"isPolling",!1);this.sessionId=t,this.intervalMs=s.intervalMs||He.polling.intervalMs,this.maxAttempts=s.maxAttempts||He.polling.maxAttempts,this.backoffFactor=s.backoffFactor||He.polling.backoffFactor}async start(t,s,r){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const n=async()=>{try{const i=await Q.getPredictionBySessionId(this.sessionId);if(t(i),i.status==="succeeded"||i.status==="success"||i.status==="failed"){this.stop(),s(i);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),r(pe("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const o=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(n,o)}catch(i){this.stop(),r(i)}};await n()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const Sr=({children:a})=>{const t=jr();return h.useEffect(()=>{_r(t)},[t]),e.jsx(e.Fragment,{children:a})},gs=()=>{const a=h.useCallback((r,n="polite")=>{de(r,n)},[]),t=h.useCallback(r=>{a(r,"assertive")},[a]),s=h.useCallback(r=>{a(r,"polite")},[a]);return{announce:a,announceError:t,announceSuccess:s}},ms=()=>{const a=h.useCallback(s=>{const r=n=>{n.key==="Escape"&&(n.preventDefault(),s())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),t=h.useCallback(s=>r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),s())},[]);return{handleEscape:a,handleEnterSpace:t}},Cr=()=>({skipToMain:h.useCallback(()=>{rr(Ke.SKIP_TO_CONTENT_ID,Ke.FOCUS_TIMEOUT)},[])}),Ar=({className:a=""})=>{const{theme:t,toggleTheme:s}=ar(),{user:r,logout:n,isAuthenticated:i,isAdmin:o}=qe(),l=vt(),{handleEnterSpace:u}=ms(),[d,g]=h.useState(!1),[k,N]=h.useState(!1),R=()=>{const A=[{path:"/",label:"Dashboard",icon:"ðŸ ",roles:[ne.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"ðŸ“¤",roles:[ne.ADMIN]},{path:"/sessions",label:"Sessions",icon:"ðŸ“Š",roles:[ne.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"ðŸ“ˆ",roles:[ne.ADMIN]}];return i?A.filter(()=>!!o()):[]};h.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:i,user:r?{id:r.id,name:r.name,roles:r.roles}:null,timestamp:new Date().toISOString()})},[i,r]);const I=R(),E=A=>A==="/"?l.pathname==="/":l.pathname.startsWith(A),S=()=>{g(!d)},v=()=>{g(!1)};return h.useEffect(()=>{g(!1),N(!1)},[l.pathname]),h.useEffect(()=>{const A=q=>{const M=q.target;k&&!M.closest("[data-user-menu]")&&N(!1)};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[k]),e.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${a}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(ie,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[e.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:"ðŸ§ "}),e.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),e.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),e.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:I.map(({path:A,label:q,icon:M})=>e.jsxs(ie,{to:A,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${E(A)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":E(A)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:M}),e.jsx("span",{children:q})]},A))}),e.jsxs("div",{className:"flex items-center space-x-4",children:[i&&r&&e.jsxs("div",{className:"relative","data-user-menu":!0,children:[e.jsxs("button",{onClick:()=>N(!k),onKeyDown:u(()=>N(!k)),className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                    transition-colors touch-target\r
                  `,"aria-label":"User menu",type:"button",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:r.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${k?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:r.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.email})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:r.primaryRole}),r.roles.length>1&&e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["+",r.roles.length-1," more"]})]})]}),e.jsx("div",{className:"py-1",children:e.jsx("button",{onClick:()=>{n(),N(!1)},className:`\r
                          w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r
                          hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r
                        `,children:"Sign out"})})]})]}),e.jsx("button",{onClick:s,onKeyDown:u(s),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,type:"button",children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:t==="light"?"ðŸŒ™":"â˜€ï¸"})}),i&&e.jsx("button",{onClick:S,onKeyDown:u(S),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":d?"Close mobile menu":"Open mobile menu",type:"button",...d?{"aria-expanded":!0}:{"aria-expanded":!1},children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:d?"âœ•":"â˜°"})})]})]}),d&&i&&e.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:e.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:I.map(({path:A,label:q,icon:M})=>e.jsxs(ie,{to:A,onClick:v,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${E(A)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":E(A)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:M}),e.jsx("span",{children:q})]},A))})})]})})},Ir=({size:a=20,className:t="",...s})=>e.jsxs("svg",{width:a,height:a,viewBox:"0 0 23 23",className:t,"aria-label":"Microsoft",...s,children:[e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),e.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),e.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),e.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),Er=({children:a,className:t=""})=>{const{skipToMain:s}=Cr();return e.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[e.jsx("a",{href:`#${Ke.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:r=>{r.preventDefault(),s()},children:"Skip to main content"}),e.jsx(Ar,{}),e.jsx("main",{id:Ke.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${t}`,tabIndex:-1,children:a}),e.jsx("div",{id:Ke.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),e.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ir,{size:24,className:"opacity-80"}),e.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),e.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[e.jsxs("p",{children:["Behavioral Health System Â© ",new Date().getFullYear()]}),e.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant â€¢ Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Tr=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,s,r)=>r?r.toUpperCase():s.toLowerCase()),Xt=a=>{const t=Tr(a);return t.charAt(0).toUpperCase()+t.slice(1)},xs=(...a)=>a.filter((t,s,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===s).join(" ").trim(),Dr=a=>{for(const t in a)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Mr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=h.forwardRef(({color:a="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:n="",children:i,iconNode:o,...l},u)=>h.createElement("svg",{ref:u,...Mr,width:t,height:t,stroke:a,strokeWidth:r?Number(s)*24/Number(t):s,className:xs("lucide",n),...!i&&!Dr(l)&&{"aria-hidden":"true"},...l},[...o.map(([d,g])=>h.createElement(d,g)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=(a,t)=>{const s=h.forwardRef(({className:r,...n},i)=>h.createElement($r,{ref:i,iconNode:t,className:xs(`lucide-${Rr(Xt(a))}`,`lucide-${a}`,r),...n}));return s.displayName=Xt(a),s};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ze=O("activity",Pr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Fr=O("arrow-left",Lr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Ee=O("brain",Or);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ps=O("calendar",Ur);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Zt=O("chart-column",Hr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Br=O("chart-pie",zr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],fs=O("chevron-down",Wr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ys=O("chevron-up",qr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],je=O("circle-alert",Vr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ne=O("circle-check-big",Gr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],yt=O("circle-x",Yr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Te=O("clock",Kr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],bt=O("download",Jr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Zr=O("eye-off",Xr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Qe=O("eye",Qr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],ta=O("file-audio",ea);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ra=O("file-text",sa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],na=O("file",aa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],oa=O("files",ia);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],bs=O("funnel",la);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ft=O("heart",ca);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Rt=O("info",da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],ua=O("languages",ha);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],ma=O("lightbulb",ga);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],pa=O("loader-circle",xa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],ya=O("mic-off",fa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ws=O("mic",ba);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Tt=O("pause",wa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ue=O("play",va);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Qt=O("plus",ka);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],se=O("refresh-cw",ja);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],_a=O("search",Na);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ca=O("send",Sa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],vs=O("settings",Aa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Dt=O("shield-alert",Ia);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ks=O("target",Ea);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Je=O("trash-2",Ra);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],js=O("trending-down",Ta);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],kt=O("trending-up",Da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ns=O("triangle-alert",Ma);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Pa=O("upload",$a);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],es=O("user",La);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],_s=O("users",Fa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],et=O("volume-2",Oa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Ha=O("volume-x",Ua);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ct=O("x",za),Ss={health:["health"],userPredictions:a=>["predictions","user",a],sessionPrediction:a=>["predictions","session",a],userSessions:a=>["sessions","user",a]},Cs=()=>os({queryKey:Ss.health,queryFn:()=>Q.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),Ba=a=>{const t=a||Re();return os({queryKey:Ss.userSessions(t),queryFn:()=>Q.getUserSessions(t),enabled:!!t,staleTime:3e4,refetchOnWindowFocus:!1})},Wa=()=>{const{announce:a}=gs(),{canAccessControlPanel:t}=qe(),{data:s,isLoading:r,error:n}=Cs(),{data:i,isLoading:o}=Ba();h.useEffect(()=>{a("Dashboard page loaded","polite")},[a]);const l=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"ðŸ“¤",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"ðŸ“Š",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"ðŸ“ˆ",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"ðŸ¤–",color:"warning",disabled:!0}],u=(d,g=!1)=>{const k=g?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(d){case"primary":return`${k} border-primary-200 bg-primary-50 ${!g&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!g&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${k} border-secondary-200 bg-secondary-50 ${!g&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!g&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${k} border-accent-200 bg-accent-50 ${!g&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!g&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${k} border-warning-200 bg-warning-50 ${!g&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!g&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${k} border-gray-200 bg-gray-50 ${!g&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!g&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(d=>d.disabled?e.jsxs("div",{className:`${u(d.color,!0)} relative`,"aria-label":`${d.title}: Coming Soon`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:d.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:d.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:d.description})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-bold text-sm mb-1",children:"ðŸš§"}),e.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},d.href):e.jsx(ie,{to:d.href,className:u(d.color,!1),"aria-label":`${d.title}: ${d.description}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:d.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:d.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:d.description})]})},d.href))})]}),t()&&e.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),e.jsx(ie,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),e.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(i!=null&&i.sessions)||i.sessions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:"ðŸ“­"}),e.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",e.jsx(ie,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):e.jsxs("div",{className:"space-y-3",children:[i.sessions.slice(0,3).map(d=>{var g,k;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`status-${d.status||"completed"}`,children:d.status||"completed"}),e.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:d.audioFileName||((g=d.sessionId)==null?void 0:g.slice(0,8))||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:d.createdAt,children:d.createdAt?new Date(d.createdAt).toLocaleString():""})]}),e.jsx(ie,{to:`/sessions/${d.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${d.audioFileName||((k=d.sessionId)==null?void 0:k.slice(0,8))||"Unknown"}`,children:e.jsx(Qe,{className:"w-4 h-4","aria-hidden":"true"})})]},d.sessionId)}),i.sessions.length>3&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(ie,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",i.sessions.length," sessions â†’"]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),e.jsx(ie,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),r?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):n?e.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[e.jsx("span",{role:"img","aria-label":"Error",children:"âš ï¸"}),e.jsx("span",{children:"System health check failed"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[e.jsx("span",{role:"img","aria-label":"Healthy",children:"âœ…"}),e.jsx("span",{children:"All systems operational"}),(s==null?void 0:s.checks)&&e.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(s.checks).length," services checked)"]})]})]})]})};class qa{constructor(){B(this,"ffmpeg",null);B(this,"isLoaded",!1);B(this,"loadingPromise",null);this.ffmpeg=new Ws}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw pe("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const t="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await Wt(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Wt(`${t}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(t){throw this.loadingPromise=null,pe("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:t})}}async convertAudio(t,s={outputFormat:"wav",sampleRate:44100,channels:1},r){try{if(r==null||r({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw pe("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:g})=>{r==null||r({stage:"converting",progress:Math.round(g*100),message:`Converting audio... ${Math.round(g*100)}%`})}),r==null||r({stage:"converting",progress:0,message:"Preparing audio file..."});const n="input."+this.getFileExtension(t.name);await this.ffmpeg.writeFile(n,await qs(t));const i=`output.${s.outputFormat}`,o=["-i",n,"-ac",s.channels.toString(),"-ar",s.sampleRate.toString(),"-f",s.outputFormat,i];await this.ffmpeg.exec(o);const l=await this.ffmpeg.readFile(i),u=new Blob([l],{type:`audio/${s.outputFormat}`}),d=new File([u],`${this.getFileNameWithoutExtension(t.name)}.${s.outputFormat}`,{type:`audio/${s.outputFormat}`});return await this.ffmpeg.deleteFile(n),await this.ffmpeg.deleteFile(i),r==null||r({stage:"completed",progress:100,message:"Audio conversion completed"}),d}catch(n){throw pe("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:n,fileName:t.name,fileSize:t.size,fileType:t.type})}}getFileExtension(t){const s=t.lastIndexOf(".");return s!==-1?t.slice(s+1).toLowerCase():""}getFileNameWithoutExtension(t){const s=t.lastIndexOf(".");return s!==-1?t.slice(0,s):t}async isFormatSupported(t){try{await this.loadFFmpeg();const s=["wav","mp3","mp4","m4a","aac","flac","ogg"],r=this.getFileExtension(t.name);return s.includes(r)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let _t=null;const Va=()=>(_t||(_t=new qa),_t),St=async(a,t)=>{const r=await Va().convertAudio(a,{outputFormat:"wav",sampleRate:44100,channels:1},t?n=>t(n.progress):void 0);return new Blob([r],{type:"audio/wav"})};class Ga{constructor(t){B(this,"containerClient",null);B(this,"sasUrl");if(this.sasUrl=t||He.azure.blobSasUrl,!this.sasUrl)throw pe("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const t=new Vs(this.sasUrl);this.containerClient=t.getContainerClient(He.azure.containerName)}catch(t){throw pe("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:t})}return this.containerClient}async uploadFile(t,s,r,n){try{r==null||r({progress:0,stage:"preparing",message:"Preparing upload..."});const i=this.getContainerClient(),o=s||this.generateBlobName(t.name,n),l=i.getBlockBlobClient(o);r==null||r({progress:10,stage:"uploading",message:"Starting upload..."}),await l.uploadData(t,{blobHTTPHeaders:{blobContentType:t.type},onProgress:d=>{const g=d.loadedBytes&&t.size?Math.round(d.loadedBytes/t.size*90)+10:50;r==null||r({progress:g,stage:"uploading",message:`Uploading... ${g}%`})}});const u=l.url;return r==null||r({progress:100,stage:"completed",message:"Upload completed"}),{url:u,fileName:o,size:t.size}}catch(i){throw pe("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:i,fileName:t.name,fileSize:t.size})}}generateBlobName(t,s){const r=s||Re(),n=new Date().toISOString().replace(/[:.]/g,"-"),i=Math.random().toString(36).substring(2,8),o=t.split(".").pop()||"wav";return`users/${r}/audio/${n}-${i}.${o}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(t){try{await this.getContainerClient().getBlockBlobClient(t).deleteIfExists()}catch(s){throw pe("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:s,fileName:t})}}async listUserFiles(t){try{const s=t||Re(),r=this.getContainerClient(),n=`users/${s}/`,i=[];for await(const o of r.listBlobsFlat({prefix:n}))i.push(o.name);return i}catch(s){throw pe("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:s,userId:t})}}async deleteUserData(t){try{const s=t||Re(),r=await this.listUserFiles(s);let n=0;for(const i of r)await this.deleteFile(i),n++;return n}catch(s){throw pe("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:s,userId:t})}}async getUserStorageUsage(t){try{const s=t||Re(),r=this.getContainerClient(),n=`users/${s}/`;let i=0,o=0;for await(const l of r.listBlobsFlat({prefix:n}))i++,o+=l.properties.contentLength||0;return{fileCount:i,totalSizeBytes:o}}catch(s){throw pe("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:s,userId:t})}}}let dt=null;const Ya=a=>((!dt||a&&a!==dt.sasUrl)&&(dt=new Ga(a)),dt),Ct=async(a,t,s,r)=>{const n=Ya(),i=a instanceof File?a:new File([a],t,{type:a.type});return(await n.uploadFile(i,t,s?l=>s(l.progress):void 0,r)).url},Ve=()=>{const a=h.useRef(null),t=h.useCallback(l=>{if(!a.current){const u=document.createElement("div");u.setAttribute("aria-live","polite"),u.setAttribute("aria-atomic","true"),u.style.position="absolute",u.style.left="-10000px",u.style.width="1px",u.style.height="1px",u.style.overflow="hidden",document.body.appendChild(u),a.current=u}a.current.textContent="",setTimeout(()=>{a.current&&(a.current.textContent=l)},100)},[]),s={focusById:l=>{const u=document.getElementById(l);u&&u.focus()},focusFirstInContainer:l=>{const d=l.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d&&d.focus()},trapFocus:l=>{const u=l.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),d=u[0],g=u[u.length-1],k=N=>{N.key==="Tab"&&(N.shiftKey?document.activeElement===d&&(g.focus(),N.preventDefault()):document.activeElement===g&&(d.focus(),N.preventDefault()))};return l.addEventListener("keydown",k),()=>{l.removeEventListener("keydown",k)}}},r={handleArrowNavigation:(l,u,d,g)=>{var N;let k=d;switch(l.key){case"ArrowDown":l.preventDefault(),k=d<u.length-1?d+1:0;break;case"ArrowUp":l.preventDefault(),k=d>0?d-1:u.length-1;break;case"Home":l.preventDefault(),k=0;break;case"End":l.preventDefault(),k=u.length-1;break;default:return}g(k),(N=u[k])==null||N.focus()},handleEscape:(l,u)=>{l.key==="Escape"&&(l.preventDefault(),u())}},n=h.useCallback((l="element")=>`${l}-${Math.random().toString(36).substr(2,9)}`,[]),i=h.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),o=h.useCallback((l,u,d)=>{const g={};return l||(g["aria-invalid"]="true",u&&d&&(g["aria-describedby"]=d)),g},[]);return{announceToScreenReader:t,focusManagement:s,keyboardNavigation:r,generateId:n,prefersReducedMotion:i,getValidationAttributes:o}},Ka=()=>{const{user:a}=qe(),[t,s]=h.useState([]),[r,n]=h.useState(()=>er()),[i,o]=h.useState({}),[l,u]=h.useState({}),[d,g]=h.useState({}),[k,N]=h.useState(!1),[R,I]=h.useState(null),[E,S]=h.useState({stage:"idle",progress:0,message:""}),[v,A]=h.useState(null),[q,M]=h.useState(!1),[P,y]=h.useState(0),[m,f]=h.useState(null),[c,x]=h.useState({userId:"",age:"",gender:"",race:"",ethnicity:"",language:"",weight:"",zipcode:"",sessionNotes:""}),[b,_]=h.useState(null),[z,J]=h.useState([]);h.useEffect(()=>{if(!c.userId){const p=`user-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;x(j=>({...j,userId:p}))}},[c.userId]);const ve=h.useCallback(()=>(a==null?void 0:a.id)||Re(),[a==null?void 0:a.id]),X=h.useRef(null),oe=h.useRef(null),{announceToScreenReader:L}=Ve(),$=h.useCallback((p,j,C)=>{const T=Date.now().toString()+Math.random().toString(36).substr(2,9),F={id:T,type:p,title:j,message:C,timestamp:Date.now()};J(Y=>[...Y,F]),setTimeout(()=>{J(Y=>Y.filter(he=>he.id!==T))},p==="error"?8e3:5e3)},[]),H=h.useCallback(p=>{J(j=>j.filter(C=>C.id!==p))},[]),re=h.useCallback(()=>{s([]),I(null),S({stage:"idle",progress:0,message:""}),A(null),u({}),o({}),_(null),M(!1),y(0),f(null),N(!1)},[]),Se=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),rt=h.useCallback(p=>{const j=Se(),C=URL.createObjectURL(p),T={id:j,file:p,url:C};r?(s(D=>[...D,T]),g(D=>({...D,[j]:"ready"})),o(D=>({...D,[j]:{stage:"idle",progress:0,message:"Ready to process"}}))):I(T),L(`Audio file selected: ${p.name}`);const F=new Audio(C);F.addEventListener("loadedmetadata",()=>{r?s(D=>D.map(Y=>Y.id===j?{...Y,duration:F.duration}:Y)):I(D=>D?{...D,duration:F.duration}:null)})},[r,L]),Nt=h.useCallback(p=>{r&&(s(j=>{const C=j.find(T=>T.id===p);return C&&URL.revokeObjectURL(C.url),j.filter(T=>T.id!==p)}),o(j=>{const{[p]:C,...T}=j;return T}),u(j=>{const{[p]:C,...T}=j;return T}),g(j=>{const{[p]:C,...T}=j;return T}))},[r]),De=h.useCallback(p=>{const j=p.target.files;!j||j.length===0||Array.from(j).forEach(C=>{const T=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],F=C.name.toLowerCase(),Y=[".wav",".mp3",".m4a",".aac",".flac"].some(ke=>F.endsWith(ke));if(!T.includes(C.type)&&!Y){_(`Unsupported file type for ${C.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),$("error","Unsupported File",`${C.name} is not a supported audio file format`),L(`Error: Unsupported file format selected for ${C.name}`);return}const ye=50*1024*1024;if(C.size>ye){_(`File ${C.name} is too large. File size must be less than 50MB`),$("error","File Too Large",`${C.name} size must be less than 50MB`),L(`Error: File ${C.name} is too large`);return}rt(C),_(null)})},[L,rt,$]),at=h.useCallback(p=>{p.preventDefault()},[]),Ge=h.useCallback(p=>{p.preventDefault();const j=p.dataTransfer.files;j.length>0&&De({target:{files:j}})},[De]),Es=h.useCallback(()=>{n(p=>{const j=!p;return tr(j),re(),j})},[re]),Rs=h.useCallback(()=>{X.current&&(q?(X.current.pause(),M(!1),L("Audio paused")):(X.current.play(),M(!0),L("Audio playing")))},[q,L]),Ts=h.useCallback(()=>{X.current&&y(X.current.currentTime)},[]),nt=h.useCallback(p=>{const j=Math.floor(p/60),C=Math.floor(p%60);return`${j}:${C.toString().padStart(2,"0")}`},[]),Fe=h.useCallback(()=>{const p=[];if(c.age){const j=parseInt(c.age);(isNaN(j)||j<18||j>130)&&p.push("Age must be between 18 and 130")}if(c.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(c.gender)||p.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),c.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(c.race)||p.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),c.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(c.ethnicity)||p.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),c.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(c.zipcode)||p.push("Zipcode must be alphanumeric and contain no more than 10 characters")),c.weight){const j=parseInt(c.weight);(isNaN(j)||j<10||j>1e3)&&p.push("Weight must be between 10 and 1000 pounds (lbs)")}return p},[c]),it=h.useCallback(()=>{const p={};let j=!1;return c.age&&(p.age=parseInt(c.age),j=!0),c.gender&&(p.gender=c.gender,j=!0),c.race&&(p.race=c.race,j=!0),c.ethnicity&&(p.ethnicity=c.ethnicity,j=!0),(c.language==="true"||c.language==="false")&&(p.language=c.language==="true",j=!0),c.weight&&(p.weight=parseInt(c.weight),j=!0),c.zipcode&&(p.zipcode=c.zipcode,j=!0),j?p:void 0},[c]),Ds=h.useCallback(async()=>{if(r){if(t.length===0||!c.userId.trim()){_("Please select audio files. User ID is automatically generated."),$("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await zt()}else{if(!R||!c.userId.trim()){_("Please select an audio file. User ID is automatically generated."),$("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await $s()}},[R,t,c.userId,r]),ot=h.useCallback(async(p,j)=>{try{o(K=>({...K,[p]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const C=it(),T={userid:c.userId.trim(),is_initiated:!0};C&&(T.metadata=C);const F=await Q.initiateSession(T),D={sessionId:F.sessionId,userId:c.userId.trim()};o(K=>({...K,[p]:{stage:"initiating",progress:10,message:"Saving session data..."}}));const Y={sessionId:F.sessionId,userId:c.userId.trim(),userMetadata:C,audioFileName:j.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await Q.saveSessionData(Y),console.log("Session data saved successfully (multi-file):",Y.sessionId)}catch(K){console.error("Failed to save session data (multi-file):",K),$("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}o(K=>({...K,[p]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const he=await St(j.file,K=>{o(W=>({...W,[p]:{stage:"converting",progress:15+K*.25,message:`Converting audio... ${Math.round(K)}%`}}))});o(K=>({...K,[p]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}}));const ye=`${c.userId}_${D.sessionId}_${Date.now()}.wav`,ke=await Ct(he,ye,K=>{o(W=>({...W,[p]:{stage:"uploading",progress:40+K*.25,message:`Uploading... ${Math.round(K)}%`}}))},ve());o(K=>({...K,[p]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const K={...Y,audioUrl:ke,audioFileName:ye,status:"processing",updatedAt:new Date().toISOString()};await Q.updateSessionData(D.sessionId,K)}catch(K){console.warn("Failed to update session data with audio info:",K)}await Q.submitPrediction({userId:c.userId.trim(),sessionid:D.sessionId,audioFileUrl:ke,audioFileName:ye}),o(K=>({...K,[p]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const xe=new Jt(D.sessionId);await new Promise((K,W)=>{xe.start(G=>{const Oe=G.status==="processing"?80:G.status==="success"?95:70;o(Me=>({...Me,[p]:{stage:"analyzing",progress:Oe,message:`Analysis ${G.status}...`}})),G.predictError&&$("error","Prediction Error",`${G.predictError.error}: ${G.predictError.message}`)},G=>{if(G.predictError){$("error","Analysis Failed",`The analysis completed with an error: ${G.predictError.error} - ${G.predictError.message}`),o(Ce=>({...Ce,[p]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),W(new Error(`Prediction error: ${G.predictError.error}`));return}const Oe={sessionId:D.sessionId,depressionScore:G.predictedScoreDepression?parseFloat(G.predictedScoreDepression):0,riskLevel:G.predictedScoreDepression&&parseFloat(G.predictedScoreDepression)>.7?"high":G.predictedScoreDepression&&parseFloat(G.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",G.predictedScoreDepression?`Depression score: ${G.predictedScoreDepression}`:"",G.predictedScoreAnxiety?`Anxiety score: ${G.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(Ce=>Ce.trim()!==""),timestamp:G.updatedAt,audioUrl:ke,rawApiResponse:G},Me={...Y,audioUrl:ke,analysisResult:Oe,status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};Q.updateSessionData(D.sessionId,Me).then(()=>{console.log("Multi-file session data updated with analysis results for session:",D.sessionId),$("success","Session Saved","Analysis results have been saved to session storage.")}).catch(Ce=>{console.error("Failed to save multi-file analysis results to session storage:",Ce),$("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),o(Ce=>({...Ce,[p]:{stage:"complete",progress:100,message:"Analysis complete!"}})),u(Ce=>({...Ce,[p]:Oe})),K()},G=>{W(G)})})}catch(C){console.error(`Error processing file ${p}:`,C);let T="UNKNOWN_ERROR",F="An unexpected error occurred",D={};C&&typeof C=="object"?("code"in C&&typeof C.code=="string"&&(T=C.code),"message"in C&&typeof C.message=="string"&&(F=C.message),"details"in C&&typeof C.details=="object"&&(D=C.details)):C instanceof Error&&(F=C.message,T=C.name||"ERROR");try{const Y=i[p];if(Y&&(Y.stage==="uploading"||Y.stage==="submitting"||Y.stage==="analyzing")){const he=`${c.userId}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${he}`)}}catch(Y){console.warn("Error during cleanup attempt:",Y)}throw o(Y=>({...Y,[p]:{stage:"error",progress:0,message:"Processing failed",error:{code:T,message:F,details:D}}})),C}},[c.userId,it,Q,Ct,St,$]),zt=h.useCallback(async()=>{N(!0),_(null);const p=Fe();if(p.length>0){_(`Validation error: ${p.join(", ")}`),$("error","Validation Error",p.join(", ")),N(!1);return}const j=t.filter(F=>d[F.id]==="ready");if(j.length===0){$("info","No Files Ready","No files are ready to process"),N(!1);return}const C=j.length;let T=0;try{for(const F of j){T++,$("info","Processing File",`Processing ${F.file.name} (${T}/${C})`),g(D=>({...D,[F.id]:"processing"}));try{await ot(F.id,F),g(D=>({...D,[F.id]:"complete"})),$("success","File Complete",`${F.file.name} processed successfully`)}catch(D){let Y="FILE_PROCESSING_ERROR",he="An unexpected error occurred",ye={};D&&typeof D=="object"?("code"in D&&typeof D.code=="string"&&(Y=D.code),"message"in D&&typeof D.message=="string"&&(he=D.message),"details"in D&&typeof D.details=="object"&&(ye=D.details)):D instanceof Error&&(he=D.message,Y=D.name||"ERROR"),$("error","File Failed",`Failed to process ${F.file.name}: ${he}`),g(ke=>({...ke,[F.id]:"error"})),o(ke=>({...ke,[F.id]:{stage:"error",progress:0,message:`Failed: ${he}`,error:{code:Y,message:he,details:ye}}}))}}$("success","Batch Complete",`Processed ${T} file${T!==1?"s":""}`),L(`Batch processing complete. ${T} files processed.`)}catch(F){const D=F instanceof Error?F.message:"An unexpected error occurred";_(D),$("error","Batch Failed",D),L(`Error: ${D}`)}finally{N(!1)}},[t,d,Fe,$,L,ot]),Ms=h.useCallback(async p=>{const j=t.find(T=>T.id===p);if(!j)return;const C=Fe();if(C.length>0){_(`Validation error: ${C.join(", ")}`),$("error","Validation Error",C.join(", "));return}g(T=>({...T,[p]:"processing"}));try{await ot(p,j),g(T=>({...T,[p]:"complete"})),$("success","File Complete",`${j.file.name} processed successfully`)}catch(T){console.error(`Error processing ${j.file.name}:`,T);const F=T instanceof Error?T.message:"An unexpected error occurred";$("error","File Failed",`Failed to process ${j.file.name}: ${F}`),g(D=>({...D,[p]:"error"})),o(D=>({...D,[p]:{stage:"error",progress:0,message:`Failed: ${F}`}}))}},[t,Fe,$,ot]),$s=h.useCallback(async()=>{if(!R||!c.userId.trim()){_("Please select an audio file. User ID is automatically generated."),$("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const p=Fe();if(p.length>0){_(`Validation error: ${p.join(", ")}`),$("error","Validation Error",p.join(", "));return}try{_(null),S({stage:"initiating",progress:5,message:"Initiating session..."}),L("Starting analysis process - initiating session");const j=it(),C={userid:c.userId.trim(),is_initiated:!0};j&&(C.metadata=j);const T=await Q.initiateSession(C),F={sessionId:T.sessionId,userId:c.userId.trim()};S({stage:"initiating",progress:10,message:"Saving session data..."});const D={sessionId:T.sessionId,userId:c.userId.trim(),userMetadata:j,audioFileName:R.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await Q.saveSessionData(D),console.log("Session data saved successfully (single-file):",D.sessionId)}catch(xe){console.error("Failed to save session data (single-file):",xe),$("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}S({stage:"converting",progress:15,message:"Converting audio to required format..."}),L("Session created successfully, now converting audio");const Y=await St(R.file,xe=>{S({stage:"converting",progress:15+xe*.25,message:`Converting audio... ${Math.round(xe)}%`})});S({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),L("Audio converted successfully, now uploading");const he=`${c.userId}_${F.sessionId}_${Date.now()}.wav`,ye=await Ct(Y,he,xe=>{S({stage:"uploading",progress:40+xe*.25,message:`Uploading... ${Math.round(xe)}%`})},ve());S({stage:"submitting",progress:65,message:"Submitting for analysis..."}),L("Upload complete, submitting for behavioral health analysis");try{const xe={...D,audioUrl:ye,audioFileName:he,status:"processing",updatedAt:new Date().toISOString()};await Q.updateSessionData(F.sessionId,xe)}catch(xe){console.warn("Failed to update session data with audio info:",xe)}await Q.submitPrediction({userId:c.userId.trim(),sessionid:F.sessionId,audioFileUrl:ye,audioFileName:he}),S({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),L("Prediction submitted, analysis in progress");const ke=new Jt(F.sessionId);await new Promise((xe,K)=>{ke.start(W=>{const G=W.status==="processing"?80:W.status==="success"?95:70;S({stage:"analyzing",progress:G,message:`Analysis ${W.status}...`}),W.predictError&&$("error","Prediction Error",`${W.predictError.error}: ${W.predictError.message}`)},W=>{if(W.predictError){$("error","Analysis Failed",`The analysis completed with an error: ${W.predictError.error} - ${W.predictError.message}`),S({stage:"error",progress:0,message:"Analysis failed with errors"}),K(new Error(`Prediction error: ${W.predictError.error}`));return}const G={sessionId:F.sessionId,depressionScore:W.predictedScoreDepression?parseFloat(W.predictedScoreDepression):0,riskLevel:W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.7?"high":W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",W.predictedScoreDepression?`Depression score: ${W.predictedScoreDepression}`:"",W.predictedScoreAnxiety?`Anxiety score: ${W.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(Me=>Me.trim()!==""),timestamp:W.updatedAt,audioUrl:ye,rawApiResponse:W},Oe={...D,audioUrl:ye,analysisResult:G,status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};Q.updateSessionData(F.sessionId,Oe).then(()=>{console.log("Session data updated with analysis results for session:",F.sessionId),$("success","Session Saved","Analysis results have been saved to session storage.")}).catch(Me=>{console.error("Failed to save analysis results to session storage:",Me),$("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),S({stage:"complete",progress:100,message:"Analysis complete!"}),A(G),$("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),L("Behavioral health analysis completed successfully"),xe()},W=>{$("error","Analysis Error",W.message||"An unexpected error occurred during analysis."),K(W)})})}catch(j){console.error("Processing error:",j);const C=j instanceof Error?j.message:"An unexpected error occurred";_(C),S({stage:"error",progress:0,message:"Processing failed"}),$("error","Processing Failed",C),L(`Error: ${C}`)}},[R,c.userId,L,Fe,it]),Bt=h.useCallback(p=>{switch(p){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("button",{type:"button",onClick:Es,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${r?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${r?"single file":"multi-file"} mode`,children:e.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${r?"translate-x-9":"translate-x-1"}`,children:r?e.jsx(oa,{className:"h-3 w-3 text-blue-600"}):e.jsx(na,{className:"h-3 w-3 text-gray-600"})})}),e.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[e.jsx("span",{className:`text-sm font-medium ${r?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),e.jsx("span",{className:`text-sm font-medium ${r?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",r?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),e.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${r?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID (Auto-generated, editable)"}),e.jsx("input",{type:"text",id:"userId",value:c.userId,onChange:p=>x(j=>({...j,userId:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-generated user ID"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for API calls. Auto-generated but can be customized."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age (Optional)"}),e.jsx("input",{type:"number",id:"age",value:c.age,onChange:p=>x(j=>({...j,age:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Age in years",min:"1",max:"150"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight (Optional)"}),e.jsx("input",{type:"number",id:"weight",value:c.weight,onChange:p=>x(j=>({...j,weight:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Weight in lbs",min:"1",max:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender (Optional)"}),e.jsxs("select",{id:"gender",value:c.gender,onChange:p=>x(j=>({...j,gender:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"non-binary",children:"Non-binary"}),e.jsx("option",{value:"transgender female",children:"Transgender female"}),e.jsx("option",{value:"transgender male",children:"Transgender male"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer",children:"Prefer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race (Optional)"}),e.jsxs("select",{id:"race",value:c.race,onChange:p=>x(j=>({...j,race:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select race"}),e.jsx("option",{value:"white",children:"White"}),e.jsx("option",{value:"black or african-american",children:"Black or African-American"}),e.jsx("option",{value:"asian",children:"Asian"}),e.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),e.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),e.jsx("option",{value:"two or more races",children:"Two or more races"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity (Optional)"}),e.jsxs("select",{id:"ethnicity",value:c.ethnicity,onChange:p=>x(j=>({...j,ethnicity:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select ethnicity"}),e.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),e.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language (Optional)"}),e.jsxs("select",{id:"language",value:c.language,onChange:p=>x(j=>({...j,language:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select language"}),e.jsx("option",{value:"true",children:"English"}),e.jsx("option",{value:"false",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code (Optional)"}),e.jsx("input",{type:"text",id:"zipcode",value:c.zipcode,onChange:p=>x(j=>({...j,zipcode:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)"})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes (Optional)"}),e.jsx("textarea",{id:"sessionNotes",value:c.sessionNotes,onChange:p=>x(j=>({...j,sessionNotes:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Additional notes about this session or patient context"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",r&&e.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!r&&!R||r&&t.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:at,onDrop:Ge,children:[e.jsx(Pa,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>{var p;return(p=oe.current)==null?void 0:p.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Select Audio File",r?"s":""]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",r?"files":"file"," here"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",r&&e.jsx("br",{}),r&&"You can select multiple files at once"]}),e.jsx("input",{ref:oe,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:De,multiple:r,"aria-label":`Select audio file${r?"s":""} for analysis`})]}):e.jsxs("div",{className:"space-y-4",children:[!r&&R&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(et,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:R.file.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(R.file.size/1024/1024).toFixed(2)," MB",R.duration&&` â€¢ ${nt(R.duration)}`]})]})]}),e.jsx("button",{type:"button",onClick:re,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:e.jsx(ct,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:Rs,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":q?"Pause audio":"Play audio",children:q?e.jsx(Tt,{className:"h-5 w-5","aria-hidden":"true"}):e.jsx(Ue,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:R.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[nt(P)," / ",nt(R.duration)]})})]}),R.duration&&e.jsx("div",{className:"audio-progress",children:e.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${P/R.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":P,"aria-valuemin":0,"aria-valuemax":R.duration})})]}),e.jsx("audio",{ref:X,src:R.url,onTimeUpdate:Ts,onEnded:()=>M(!1),onPlay:()=>M(!0),onPause:()=>M(!1),className:"hidden"})]}),r&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",t.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var p;return(p=oe.current)==null?void 0:p.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Qt,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(p=>{const j=d[p.id]||"ready",C=i[p.id];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsx(et,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:p.file.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(p.file.size/1024/1024).toFixed(2)," MB",p.duration&&` â€¢ ${nt(p.duration)}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[j==="ready"&&e.jsxs("button",{type:"button",onClick:()=>Ms(p.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${p.file.name}`,children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"Start"]}),j==="processing"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),j==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Complete"]}),j==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Error"]}),e.jsx("button",{type:"button",onClick:()=>Nt(p.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${p.file.name}`,children:e.jsx(Je,{className:"h-4 w-4"})})]})]}),C&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:C.message}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(C.progress),"%"]})]}),e.jsx("div",{className:"processing-progress mt-1",children:e.jsx("div",{className:`processing-progress__fill progress-animated ${Bt(C.stage)}`,style:{width:`${C.progress}%`}})})]})]},p.id)})}),e.jsx("input",{ref:oe,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:De,multiple:r,"aria-label":"Select additional audio files for analysis"})]})]})]}),b&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:b})]})}),!r&&E.stage!=="idle"&&!v&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:E.message}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(E.progress),"%"]})]}),e.jsx("div",{className:"processing-progress",children:e.jsx("div",{className:`processing-progress__fill progress-animated ${Bt(E.stage)}`,style:{width:`${E.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":E.progress,"aria-valuemin":0,"aria-valuemax":100})}),E.stage==="analyzing"&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(pa,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),v&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ne,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),v.rawApiResponse&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.predicted_score_anxiety||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`font-mono ${v.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:v.rawApiResponse.status||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.model_category||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.model_granularity||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),e.jsx("span",{className:`font-mono ${v.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:v.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),v.rawApiResponse.actual_score&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[v.rawApiResponse.actual_score.depression_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.actual_score.depression_binary||"N/A"})]}),v.rawApiResponse.actual_score.anxiety_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:v.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),v.rawApiResponse.actual_score.phq_9&&v.rawApiResponse.actual_score.phq_9.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",v.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),v.rawApiResponse.actual_score.phq_2&&v.rawApiResponse.actual_score.phq_2.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",v.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),v.rawApiResponse.actual_score.gad_7&&v.rawApiResponse.actual_score.gad_7.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",v.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:v.rawApiResponse.created_at?new Date(v.rawApiResponse.created_at).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:v.rawApiResponse.updated_at?new Date(v.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:v.sessionId})]})})]}),v.rawApiResponse.predict_error&&e.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:v.rawApiResponse.predict_error.error})]}),e.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[e.jsx("span",{className:"font-medium",children:"Message:"})," ",v.rawApiResponse.predict_error.message]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(v.rawApiResponse,null,2)})})]})]})})]}),v.insights&&v.insights.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),e.jsx("ul",{className:"space-y-1",children:v.insights.map((p,j)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["â€¢ ",p]},j))})]}),e.jsx("div",{className:"mt-6 flex space-x-3",children:e.jsx("button",{type:"button",onClick:re,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(r&&t.length>0||!r&&R)&&!v&&Object.keys(l).length===0&&E.stage==="idle"&&!k&&e.jsx("div",{className:"text-center",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsxs("button",{type:"button",onClick:zt,disabled:t.length===0||!c.userId.trim()||!t.some(p=>d[p.id]==="ready"),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(Ue,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",t.filter(p=>d[p.id]==="ready").length>0&&` (${t.filter(p=>d[p.id]==="ready").length})`]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:Ds,disabled:!R||!c.userId.trim(),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(Ue,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),r&&Object.keys(l).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ne,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(l).length," files)"]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(l).map(([p,j])=>{const C=t.find(F=>F.id===p),T=i[p];return e.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(C==null?void 0:C.file.name)||`File ${p}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(T==null?void 0:T.stage)==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Complete"]}),(T==null?void 0:T.stage)==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(T==null?void 0:T.stage)==="error"&&(T==null?void 0:T.error)&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(je,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:T.error.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:T.error.message})]})]}),T.error.details&&Object.keys(T.error.details).length>0&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),e.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:e.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(T.error.details,null,2)})})]})]})]})]})}),j.rawApiResponse&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:j.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:j.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:j.sessionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:j.rawApiResponse.status||"N/A"})]})]})}),e.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(j.rawApiResponse,null,2)})})]})]}),C&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{const F=document.getElementById(`audio-${p}`);F.paused?(document.querySelectorAll("audio").forEach(D=>D.pause()),f(p),F.play()):(F.pause(),f(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":m===p?"Pause audio":"Play audio",children:m===p?e.jsx(Tt,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[C.file.name," â€¢ ",C.duration?`${Math.round(C.duration)}s`:"Duration unknown"]})]}),e.jsx("audio",{id:`audio-${p}`,src:C.url,onEnded:()=>f(null),className:"hidden"})]})]},p)})})]}),z.length>0&&e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:z.map(p=>e.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${p.type==="error"?"border-red-500":p.type==="warning"?"border-yellow-500":p.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-shrink-0",children:[p.type==="error"&&e.jsx(je,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),p.type==="warning"&&e.jsx(je,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),p.type==="success"&&e.jsx(Ne,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),p.type==="info"&&e.jsx(je,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:p.message})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>H(p.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:e.jsx(ct,{className:"h-4 w-4"})})})]})},p.id))})]})},ht={queued:{color:"yellow",icon:Te,label:"Queued"},running:{color:"blue",icon:se,label:"Processing"},processing:{color:"blue",icon:se,label:"Processing"},succeeded:{color:"green",icon:Ne,label:"Completed"},success:{color:"green",icon:Ne,label:"Completed"},failed:{color:"red",icon:yt,label:"Failed"},error:{color:"red",icon:yt,label:"Error"}},ut=a=>a?a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):"â€”",gt=a=>{if(!a)return 0;switch(a.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},Ja=()=>{const[a,t]=h.useState([]),[s,r]=h.useState(!0),[n,i]=h.useState(null),[o,l]=h.useState(new Set),[u,d]=h.useState(!1),[g,k]=h.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:N}=Ve(),R=h.useCallback(async()=>{try{r(!0),i(null);const y=Re(),f=(await Q.getUserSessions(y)).sessions.map(c=>{var b;const x=c.prediction;return{...c,uploadedAt:c.createdAt,fileName:c.audioFileName||`Audio_${c.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:((b=c.analysisResults)==null?void 0:b.riskLevel)||"unknown",depressionScore:(x==null?void 0:x.predicted_score_depression)||(x==null?void 0:x.predictedScoreDepression)||void 0,anxietyScore:(x==null?void 0:x.predicted_score_anxiety)||(x==null?void 0:x.predictedScoreAnxiety)||void 0}});t(f),N(`${f.length} sessions loaded successfully`)}catch(y){const m=y;i(m),N(`Error loading sessions: ${m.message}`)}finally{r(!1)}},[N]);h.useEffect(()=>{R()},[R]);const I=h.useMemo(()=>{let y=a;if(g.search){const m=g.search.toLowerCase();y=y.filter(f=>{var c,x;return f.sessionId.toLowerCase().includes(m)||((c=f.fileName)==null?void 0:c.toLowerCase().includes(m))||((x=ht[f.status])==null?void 0:x.label.toLowerCase().includes(m))})}if(g.status!=="all"&&(y=y.filter(m=>m.status===g.status)),g.dateRange!=="all"){const m=new Date,f=new Date;switch(g.dateRange){case"today":f.setHours(0,0,0,0);break;case"week":f.setDate(m.getDate()-7);break;case"month":f.setMonth(m.getMonth()-1);break;case"year":f.setFullYear(m.getFullYear()-1);break}y=y.filter(c=>new Date(c.uploadedAt)>=f)}return y.sort((m,f)=>{let c=0;switch(g.sortBy){case"date":c=new Date(m.uploadedAt).getTime()-new Date(f.uploadedAt).getTime();break;case"status":c=m.status.localeCompare(f.status);break;case"depressionScore":const x=gt(m.depressionScore),b=gt(f.depressionScore);c=x-b;break;case"anxietyScore":const _=gt(m.anxietyScore),z=gt(f.anxietyScore);c=_-z;break}return g.sortOrder==="desc"?-c:c}),y},[a,g]),E=h.useCallback((y,m)=>{k(f=>({...f,[y]:m})),N(`Filter ${y} changed to ${m}`)},[N]),S=h.useCallback(y=>{l(m=>{const f=new Set(m);return f.has(y)?(f.delete(y),N("Session deselected")):(f.add(y),N("Session selected")),f})},[N]),v=h.useCallback(()=>{o.size===I.length?(l(new Set),N("All sessions deselected")):(l(new Set(I.map(m=>m.sessionId))),N(`All ${I.length} sessions selected`))},[o.size,I,N]),A=h.useCallback(async y=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await Q.deleteSessionData(y),t(f=>f.filter(c=>c.sessionId!==y)),l(f=>{const c=new Set(f);return c.delete(y),c}),N("Session deleted successfully")}catch(f){const c=f;N(`Error deleting session: ${c.message}`),alert(`Failed to delete session: ${c.message}`)}},[N]),q=h.useCallback(async()=>{if(o.size===0||!window.confirm(`Are you sure you want to delete ${o.size} session(s)? This action cannot be undone.`))return;const m=Array.from(o);let f=0,c=[];for(const x of m)try{await Q.deleteSessionData(x),f++}catch(b){const _=b;c.push(x),console.error(`Failed to delete session ${x}:`,_.message)}if(f>0&&t(x=>x.filter(b=>!(o.has(b.sessionId)&&!c.includes(b.sessionId)))),l(new Set),c.length===0)N(`${f} sessions deleted successfully`);else{const x=`${f} sessions deleted successfully, ${c.length} failed`;N(x),alert(`${x}. Failed sessions: ${c.join(", ")}`)}},[o,N]),M=y=>{if(y===0)return"0 B";const m=1024,f=["B","KB","MB","GB"],c=Math.floor(Math.log(y)/Math.log(m));return`${parseFloat((y/Math.pow(m,c)).toFixed(1))} ${f[c]}`},P=({status:y})=>{const m=y.toLowerCase();let f=ht[y];f||(m.includes("error")||m.includes("fail")?f=ht.error:f=ht.failed);const c=f.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":f.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":f.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${f.label}`,children:[e.jsx(c,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),f.label]})};return s?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):n?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:n.message}),e.jsx("button",{type:"button",onClick:R,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:R,disabled:s,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[e.jsx(se,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsx(ie,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),e.jsxs("div",{className:"relative",children:[e.jsx(_a,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:g.search,onChange:y=>E("search",y.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),e.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),e.jsxs("button",{type:"button",onClick:()=>d(!u),className:"btn btn--secondary flex items-center","aria-expanded":u?"true":"false","aria-controls":"filter-panel","aria-label":`${u?"Hide":"Show"} filter options`,children:[e.jsx(bs,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",u?e.jsx(ys,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):e.jsx(fs,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),u&&e.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{id:"status-filter",value:g.status,onChange:y=>E("status",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"queued",children:"Queued"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"succeeded",children:"Completed"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-filter",value:g.dateRange,onChange:y=>E("dateRange",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),e.jsxs("select",{id:"sort-by",value:g.sortBy,onChange:y=>E("sortBy",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"depressionScore",children:"Depression Score"}),e.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),e.jsxs("select",{id:"sort-order",value:g.sortOrder,onChange:y=>E("sortOrder",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),I.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[I.length," of ",a.length," sessions",o.size>0&&` â€¢ ${o.size} selected`]})}),o.size>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:q,className:"btn btn--danger","aria-label":`Delete ${o.size} selected sessions`,children:[e.jsx(Je,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),I.length>0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:o.size===I.length,onChange:v,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:I.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:o.has(y.sessionId),onChange:()=>S(y.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${y.sessionId}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.fileName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",y.sessionId.slice(-12)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:M(y.fileSize||0)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(P,{status:y.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:y.depressionScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:ut(y.depressionScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:y.anxietyScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:ut(y.anxietyScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Xe(y.uploadedAt)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:ze(y.uploadedAt)})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(ie,{to:`/sessions/${y.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${y.sessionId}`,children:e.jsx(Qe,{className:"w-4 h-4","aria-hidden":"true"})}),y.status==="succeeded"&&e.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${y.sessionId}`,children:e.jsx(bt,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>A(y.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${y.sessionId}`,children:e.jsx(Je,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},y.sessionId))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4",children:I.map(y=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:o.has(y.sessionId),onChange:()=>S(y.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${y.sessionId}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.fileName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",y.sessionId.slice(-12)]})]})]}),e.jsx(P,{status:y.status})]}),(y.depressionScore||y.anxietyScore)&&e.jsxs("div",{className:"text-sm",children:[y.depressionScore&&e.jsxs("div",{children:["Depression: ",ut(y.depressionScore)]}),y.anxietyScore&&e.jsxs("div",{children:["Anxiety: ",ut(y.anxietyScore)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:Xe(y.uploadedAt)}),e.jsx("span",{children:M(y.fileSize||0)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs(ie,{to:`/sessions/${y.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${y.sessionId}`,children:[e.jsx(Qe,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),y.status==="succeeded"&&e.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${y.sessionId}`,children:[e.jsx(bt,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),e.jsxs("button",{type:"button",onClick:()=>A(y.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${y.sessionId}`,children:[e.jsx(Je,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},y.sessionId))})]}):e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:a.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),a.length===0?e.jsx(ie,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):e.jsx("button",{type:"button",onClick:()=>k({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},Xa={low:{color:"green",label:"Low Risk",icon:Ne,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:Ns,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:Dt,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:Dt,description:"Urgent intervention required"}},Za=({sessionId:a,existingAssessment:t,onAssessmentUpdated:s})=>{const{announceToScreenReader:r}=Ve(),[n,i]=h.useState(t||null),[o,l]=h.useState(!1),[u,d]=h.useState(!1),[g,k]=h.useState(null),N=h.useCallback(async()=>{try{l(!0),k(null),r("Generating AI risk assessment...");const E=await Q.generateRiskAssessment(a);if(E.success&&E.riskAssessment)i(E.riskAssessment),s==null||s(E.riskAssessment),r("Risk assessment generated successfully");else throw new Error(E.message||"Failed to generate risk assessment")}catch(E){const S=E;k(S),r(`Error generating assessment: ${S.message}`)}finally{l(!1)}},[a,s,r]),R=h.useCallback(async()=>{try{d(!0),k(null);const E=await Q.getRiskAssessment(a);E.success&&E.riskAssessment&&(i(E.riskAssessment),s==null||s(E.riskAssessment))}catch(E){k(E)}finally{d(!1)}},[a,s]),I=({riskLevel:E,riskScore:S})=>{const v=Xa[E.toLowerCase()];if(!v)return null;const A=v.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${v.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":v.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${v.label}`,children:[e.jsx(A,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),v.label,S&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[S,"/10"]})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:v.description})]})};return!n&&!o&&!u?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ee,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:N,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),e.jsxs("button",{type:"button",onClick:R,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[e.jsx(se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),g&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:g.message})})]})]}):o||u?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ee,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:o?"Generating AI risk assessment...":"Loading assessment..."})]}),o&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):n?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ee,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:e.jsxs("button",{type:"button",onClick:N,disabled:o,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[e.jsx(se,{className:`w-3 h-3 mr-1 ${o?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),e.jsx(I,{riskLevel:n.overallRiskLevel,riskScore:n.riskScore})]}),n.generatedAt&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(ps,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:ze(n.generatedAt)})]})]}),n.summary&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ra,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:n.summary})})]}),n.keyFactors&&n.keyFactors.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Ns,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:n.keyFactors.map((E,S)=>e.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),E]},S))})})]}),n.recommendations&&n.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ma,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:e.jsx("ul",{className:"space-y-2",children:n.recommendations.map((E,S)=>e.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[e.jsx(Ne,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),E]},S))})})]}),n.immediateActions&&n.immediateActions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ks,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("ul",{className:"space-y-2",children:n.immediateActions.map((E,S)=>e.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[e.jsx(Dt,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),E]},S))})})]}),n.followUpRecommendations&&n.followUpRecommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(kt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsx("ul",{className:"space-y-2",children:n.followUpRecommendations.map((E,S)=>e.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[e.jsx(Te,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),E]},S))})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Te,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",ze(n.generatedAt),n.modelVersion&&e.jsxs("span",{className:"ml-4",children:["Model: ",n.modelVersion]})]})})]}),g&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:g.message})})]}):null},At={queued:{color:"yellow",icon:Te,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Te,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:se,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:se,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:Ne,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:Ne,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:yt,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:yt,label:"Error",description:"An error occurred during processing"}},Qa=()=>{var y,m,f,c,x,b,_,z,J,ve,X,oe;const{sessionId:a}=Hs(),t=$t(),{announceToScreenReader:s}=Ve(),[r,n]=h.useState(null),[i,o]=h.useState(!0),[l,u]=h.useState(null),[d,g]=h.useState(!1),[k,N]=h.useState(!1),[R,I]=h.useState(!1),E=h.useRef(null),S=h.useCallback(async()=>{if(a)try{o(!0),u(null);const L=await Q.getSessionData(a);n(L),s(`Session ${a} loaded successfully`)}catch(L){const $=L;u($),s(`Error loading session: ${$.message}`)}finally{o(!1)}},[a,s]),v=h.useCallback(async()=>{N(!0),await S(),N(!1),s("Session data refreshed")},[S,s]);h.useEffect(()=>{S()},[S]);const A=h.useCallback(()=>{g(L=>{const $=!L;return s(`Raw JSON view ${$?"enabled":"disabled"}`),$})},[s]),q=h.useCallback(()=>{E.current&&(R?(E.current.pause(),I(!1),s("Audio paused")):(E.current.play().catch(()=>{s("Failed to play audio")}),I(!0),s("Audio playing")))},[R,s]),M=h.useCallback(()=>{if(!r)return;const L=JSON.stringify(r,null,2),$=new Blob([L],{type:"application/json"}),H=URL.createObjectURL($),re=document.createElement("a");re.href=H,re.download=`session-${r.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(H),s("Session data download started")},[r,s]),P=({status:L})=>{const $=L.toLowerCase();let H=At[L];H||($.includes("error")||$.includes("fail")?H=At.error:H=At.failed);const re=H.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${H.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":H.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":H.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${H.label}`,children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${H.color==="blue"&&L==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),H.label]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:H.description})]})};return i?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):l?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:l.message}),e.jsxs("div",{className:"mt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:S,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),e.jsx(ie,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):r?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>t("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[e.jsx(Fr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",r.sessionId]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:A,className:"btn btn--secondary","aria-label":`${d?"Hide":"Show"} raw JSON data`,children:[d?e.jsx(Zr,{className:"w-4 h-4 mr-2"}):e.jsx(Qe,{className:"w-4 h-4 mr-2"}),d?"Hide JSON":"Show JSON"]}),e.jsxs("button",{type:"button",onClick:v,disabled:k,className:"btn btn--secondary","aria-label":"Refresh session data",children:[e.jsx(se,{className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:M,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[e.jsx(bt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),d&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Rt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:e.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(r,null,2)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Rt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsx(P,{status:r.status})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ps,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:Xe(r.createdAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:ze(r.createdAt)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Te,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:Xe(r.updatedAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:ze(r.updatedAt)})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(es,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:r.userId})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ta,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),e.jsxs("div",{className:"space-y-4",children:[r.audioFileName&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-medium",children:r.audioFileName})]}),r.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:q,className:"btn btn--secondary","aria-label":`${R?"Pause":"Play"} audio`,children:R?e.jsx(Tt,{className:"w-4 h-4"}):e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:R?"Playing audio...":"Audio playback available"})]}),e.jsx("audio",{ref:E,src:r.audioUrl,onPlay:()=>I(!0),onPause:()=>I(!1),onEnded:()=>I(!1),onError:()=>{I(!1),s("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),r.userMetadata&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(es,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.userMetadata.age&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.age," years"]})]}),r.userMetadata.gender&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.gender.replace(/[_-]/g," ")})]}),r.userMetadata.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.weight," lbs"]})]}),r.userMetadata.race&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.race})]}),r.userMetadata.ethnicity&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.ethnicity})]}),r.userMetadata.zipcode&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:r.userMetadata.zipcode})]}),r.userMetadata.language!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.language?"Yes":"No"})]}),r.userMetadata.sessionNotes&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:r.userMetadata.sessionNotes})]})]})]}),(r.analysisResults||r.prediction)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ze,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),e.jsxs("div",{className:"space-y-6",children:[(r.analysisResults||r.prediction)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Ee,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((y=r.analysisResults)==null?void 0:y.depressionScore)||((m=r.prediction)==null?void 0:m.predicted_score_depression))&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),e.jsx(kt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((c=(f=r.analysisResults)==null?void 0:f.depressionScore)==null?void 0:c.toFixed(2))||((x=r.prediction)!=null&&x.predicted_score_depression?r.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()):"N/A")})]}),(((b=r.analysisResults)==null?void 0:b.anxietyScore)||((_=r.prediction)==null?void 0:_.predicted_score_anxiety))&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),e.jsx(Ft,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((J=(z=r.analysisResults)==null?void 0:z.anxietyScore)==null?void 0:J.toFixed(2))||((ve=r.prediction)!=null&&ve.predicted_score_anxiety?r.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()):"N/A")})]})]})]}),((X=r.analysisResults)==null?void 0:X.insights)&&r.analysisResults.insights.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:r.analysisResults.insights.map((L,$)=>e.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),L]},$))})})]}),((oe=r.analysisResults)==null?void 0:oe.completedAt)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Ne,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:ze(r.analysisResults.completedAt)})]})})]})]})]}),e.jsx(Za,{sessionId:r.sessionId,existingAssessment:r.riskAssessment||null,onAssessmentUpdated:L=>{n($=>$?{...$,riskAssessment:L}:null)}})]}):e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),e.jsx(ie,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},en=()=>{const[a,t]=h.useState([]),[s,r]=h.useState(!0),[n,i]=h.useState(null),[o,l]=h.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[u,d]=h.useState(!1),{announceToScreenReader:g}=Ve(),k=$t(),N=h.useCallback(m=>{k(`/sessions/${m}`),g(`Navigating to session ${m} details`)},[k,g]),R=h.useCallback(async()=>{try{r(!0),i(null);const m=Re(),c=(await Q.getUserSessions(m)).sessions.filter(x=>x.analysisResults||x.prediction);t(c),g(`${c.length} prediction sessions loaded`)}catch(m){const f=m;i(f),g(`Error loading predictions: ${f.message}`)}finally{r(!1)}},[g]);h.useEffect(()=>{R()},[R]);const I=h.useMemo(()=>{if(o.dateRange==="all")return a;const m=new Date,f=new Date;switch(o.dateRange){case"week":f.setDate(m.getDate()-7);break;case"month":f.setMonth(m.getMonth()-1);break;case"quarter":f.setMonth(m.getMonth()-3);break;case"year":f.setFullYear(m.getFullYear()-1);break}return a.filter(c=>new Date(c.createdAt)>=f)},[a,o.dateRange]),E=h.useMemo(()=>I.map(m=>{var b,_;const f=z=>{if(!z)return null;switch(z.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},c=f((b=m.prediction)==null?void 0:b.predicted_score_depression),x=f((_=m.prediction)==null?void 0:_.predicted_score_anxiety);return{date:m.createdAt,depression:c,anxiety:x,overall:null,sessionId:m.sessionId}}).sort((m,f)=>new Date(m.date).getTime()-new Date(f.date).getTime()),[I]),S=h.useMemo(()=>{const m={depression:[],anxiety:[]},f=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],c=I.map(b=>{var _;return(_=b.prediction)==null?void 0:_.predicted_score_depression}).filter(b=>b!==void 0);f.forEach(b=>{const _=c.filter(J=>J===b.category).length,z=c.length>0?_/c.length*100:0;_>0&&m.depression.push({category:b.label,count:_,percentage:z,color:b.color})});const x=I.map(b=>{var _;return(_=b.prediction)==null?void 0:_.predicted_score_anxiety}).filter(b=>b!==void 0);return f.forEach(b=>{const _=x.filter(J=>J===b.category).length,z=x.length>0?_/x.length*100:0;_>0&&m.anxiety.push({category:b.label,count:_,percentage:z,color:b.color})}),m},[I]),v=h.useMemo(()=>{const m={},f=b=>{if(!b)return 0;switch(b.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},c=I.map(b=>{var _;return(_=b.prediction)==null?void 0:_.predicted_score_depression}).filter(b=>b!==void 0);if(c.length<2)m.depression={direction:"stable",change:0,period:"insufficient data"};else{const b=c.map(f),_=b.slice(0,Math.floor(b.length/2)),z=b.slice(Math.floor(b.length/2)),J=_.reduce((oe,L)=>oe+L,0)/_.length,X=z.reduce((oe,L)=>oe+L,0)/z.length-J;m.depression={direction:Math.abs(X)<.5?"stable":X<0?"improving":"worsening",change:Math.abs(X),period:`${I.length} sessions`}}const x=I.map(b=>{var _;return(_=b.prediction)==null?void 0:_.predicted_score_anxiety}).filter(b=>b!==void 0);if(x.length<2)m.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const b=x.map(f),_=b.slice(0,Math.floor(b.length/2)),z=b.slice(Math.floor(b.length/2)),J=_.reduce((oe,L)=>oe+L,0)/_.length,X=z.reduce((oe,L)=>oe+L,0)/z.length-J;m.anxiety={direction:Math.abs(X)<.5?"stable":X<0?"improving":"worsening",change:Math.abs(X),period:`${I.length} sessions`}}return m.overall={direction:"stable",change:0,period:"coming soon"},m},[I]),A=h.useMemo(()=>{const m={totalSessions:I.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(I.length===0)return m;const f=I.map(x=>{var b;return(b=x.prediction)==null?void 0:b.predictedScoreDepression}).filter(x=>x!==void 0),c=I.map(x=>{var b;return(b=x.prediction)==null?void 0:b.predictedScoreAnxiety}).filter(x=>x!==void 0);if(f.length>0){const x={};f.forEach(_=>{x[_]=(x[_]||0)+1});const b=Object.entries(x).sort(([,_],[,z])=>z-_)[0][0];m.avgDepression=x[b]}if(c.length>0){const x={};c.forEach(_=>{x[_]=(x[_]||0)+1});const b=Object.entries(x).sort(([,_],[,z])=>z-_)[0][0];m.avgAnxiety=x[b]}return m.latestSession=I.sort((x,b)=>new Date(b.createdAt).getTime()-new Date(x.createdAt).getTime())[0],m.improvementSessions=0,m},[I]),q=h.useCallback((m,f)=>{l(c=>({...c,[m]:f})),g(`Filter ${m} changed to ${f}`)},[g]),M=h.useCallback(()=>{const m=JSON.stringify(I,null,2),f=new Blob([m],{type:"application/json"}),c=URL.createObjectURL(f),x=document.createElement("a");x.href=c,x.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c),g("Predictions data download started")},[I,g]),P=({trend:m,label:f})=>{const c=m.direction==="improving"?js:m.direction==="worsening"?kt:Ze,x=m.direction==="improving"?"text-green-600 dark:text-green-400":m.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:`w-4 h-4 ${x}`,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:f}),e.jsxs("span",{className:`text-sm font-medium ${x} capitalize`,children:[m.direction,m.period==="insufficient data"?" (need more sessions)":m.period==="coming soon"?" (analysis coming soon)":` (${m.period})`]})]})},y=({data:m,type:f,onBarClick:c})=>{const x=m.map(H=>H[f]).filter(H=>H!==null);if(x.length===0)return e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const b=Math.max(...x),_=Math.min(...x),z=b-_||1,J=H=>{switch(H){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},ve=(H,re)=>{if(re==="depression")switch(H){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(re==="anxiety")switch(H){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(H){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},X=H=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(Se=>({...Se,color:ve(Se.score,H)})),oe=new Set(x),$=X(f).filter(H=>oe.has(H.score));return e.jsxs("div",{children:[e.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:m.map((H,re)=>{const Se=H[f];if(Se===null)return null;const rt=(Se-_)/z*100,Nt=ve(Se,f),De=J(Se),at=new Date(H.date).toLocaleDateString();return e.jsx("div",{className:`flex-1 ${Nt} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(rt,8)}%`},onClick:()=>c(H.sessionId),role:"button",tabIndex:0,onKeyDown:Ge=>{(Ge.key==="Enter"||Ge.key===" ")&&(Ge.preventDefault(),c(H.sessionId))},"aria-label":`View session details for ${De} score on ${at}`,children:e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsx("div",{className:"font-medium",children:De}),e.jsx("div",{className:"text-gray-300",children:at}),e.jsxs("div",{className:"text-gray-300",children:["Session: ",H.sessionId.slice(-8)]}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},re)})}),$.length>0&&e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),$.map(H=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 ${H.color} rounded`}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:H.label})]},H.score))]})})]})};return s?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):n?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:n.message}),e.jsx("button",{type:"button",onClick:R,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>d(!u),className:"btn btn--secondary","aria-expanded":u?"true":"false","aria-label":`${u?"Hide":"Show"} filter options`,children:[e.jsx(bs,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",u?e.jsx(ys,{className:"w-4 h-4 ml-2"}):e.jsx(fs,{className:"w-4 h-4 ml-2"})]}),e.jsxs("button",{type:"button",onClick:R,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[e.jsx(se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:M,className:"btn btn--primary",disabled:I.length===0,"aria-label":"Download predictions data",children:[e.jsx(bt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),u&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-range",value:o.dateRange,onChange:m=>q("dateRange",m.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"quarter",children:"Past Quarter"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),e.jsxs("select",{id:"score-type",value:o.scoreType,onChange:m=>q("scoreType",m.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Scores"}),e.jsx("option",{value:"depression",children:"Depression"}),e.jsx("option",{value:"anxiety",children:"Anxiety"}),e.jsx("option",{value:"overall",children:"Overall"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.showTrends,onChange:m=>q("showTrends",m.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),I.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(Ee,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:a.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),e.jsx(ie,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ze,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:A.totalSessions})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ee,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const m=I.map(x=>{var b;return(b=x.prediction)==null?void 0:b.predicted_score_depression}).filter(x=>x!==void 0);if(m.length===0)return"â€”";const f={};return m.forEach(x=>{f[x]=(f[x]||0)+1}),Object.entries(f).sort(([,x],[,b])=>b-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ft,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const m=I.map(x=>{var b;return(b=x.prediction)==null?void 0:b.predicted_score_anxiety}).filter(x=>x!==void 0);if(m.length===0)return"â€”";const f={};return m.forEach(x=>{f[x]=(f[x]||0)+1}),Object.entries(f).sort(([,x],[,b])=>b-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(o.scoreType==="all"||o.scoreType==="depression")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Zt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),e.jsx(y,{data:E,type:"depression",onBarClick:N}),o.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(P,{trend:v.depression,label:"Trend:"})})]}),(o.scoreType==="all"||o.scoreType==="anxiety")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Br,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),e.jsx(y,{data:E,type:"anxiety",onBarClick:N}),o.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(P,{trend:v.anxiety,label:"Trend:"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Zt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(S).map(([m,f])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[m," Scores"]}),e.jsx("div",{className:"space-y-2",children:f.map(c=>e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:c.category}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[c.count," (",c.percentage.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${c.color} progress-dynamic progress-animated`,style:{"--progress-width":`${c.percentage}%`}})})]})},c.category))})]},m))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),e.jsx(ie,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions â†’"})]}),e.jsx("div",{className:"space-y-4",children:I.slice(0,5).map(m=>{var f,c;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m.status==="succeeded"?"bg-green-500":m.status==="processing"?"bg-blue-500":m.status==="failed"?"bg-red-500":"bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.audioFileName||`Session ${m.sessionId.slice(-8)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Xe(m.createdAt)})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[((f=m.prediction)==null?void 0:f.predicted_score_depression)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),((c=m.prediction)==null?void 0:c.predicted_score_anxiety)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:m.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),e.jsx(ie,{to:`/sessions/${m.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${m.sessionId}`,children:e.jsx(Qe,{className:"w-4 h-4","aria-hidden":"true"})})]})]},m.sessionId)})})]})]})]})},Mt=(a,t)=>t>0?Math.round(a/t*100):0,tn=a=>{const t=a.length,s=new Set(a.map(S=>S.userId)).size,r=a.filter(S=>S.status==="succeeded"&&S.prediction),n=a.filter(S=>S.status==="failed"),i=a.filter(S=>S.status==="processing"),o=Mt(r.length,t),l=s>0?Math.round(t/s*10)/10:0,u=new Date(Date.now()-24*60*60*1e3),d=a.filter(S=>new Date(S.createdAt)>u).length,g={low:0,medium:0,high:0,unknown:0};a.forEach(S=>{var A;const v=((A=S.analysisResults)==null?void 0:A.riskLevel)||"unknown";v in g&&g[v]++});const k={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},N={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};r.forEach(S=>{if(S.prediction){const v=S.prediction.predictedScoreDepression;v&&v in k&&k[v]++;const A=S.prediction.predictedScoreAnxiety;A&&A in N&&N[A]++}});const R=[];for(let S=6;S>=0;S--){const v=new Date;v.setDate(v.getDate()-S);const A=v.toISOString().split("T")[0],q=a.filter(M=>M.createdAt.split("T")[0]===A).length;R.push({date:A,count:q})}const I=new Map;a.forEach(S=>{I.has(S.userId)||I.set(S.userId,{totalSessions:0,successfulSessions:0,sessions:[]});const v=I.get(S.userId);v.totalSessions++,v.sessions.push(S),S.status==="succeeded"&&S.prediction&&v.successfulSessions++});const E=Array.from(I.entries()).map(([S,v])=>{var c;const A=Mt(v.successfulSessions,v.totalSessions),q=v.sessions.filter(x=>{var b;return x.status==="succeeded"&&x.prediction&&((b=x.analysisResults)==null?void 0:b.confidence)}),M=q.length>0?q.reduce((x,b)=>{var _;return x+(((_=b.analysisResults)==null?void 0:_.confidence)||0)},0)/q.length:0,P={low:0,medium:0,high:0,unknown:0};v.sessions.forEach(x=>{var _;const b=((_=x.analysisResults)==null?void 0:_.riskLevel)||"unknown";b in P&&P[b]++});const y={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},m={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};q.forEach(x=>{if(x.prediction){const b=x.prediction.predictedScoreDepression;b&&b in y&&y[b]++;const _=x.prediction.predictedScoreAnxiety;_&&_ in m&&m[_]++}});const f=v.sessions.reduce((x,b)=>new Date(b.updatedAt)>new Date(x)?b.updatedAt:x,((c=v.sessions[0])==null?void 0:c.updatedAt)||new Date().toISOString());return{userId:S,totalSessions:v.totalSessions,successfulSessions:v.successfulSessions,successRate:A,avgConfidence:Math.round(M*100)/100,riskDistribution:P,lastActivity:f,depressionScores:y,anxietyScores:m}}).sort((S,v)=>v.totalSessions-S.totalSessions);return{overview:{totalSessions:t,uniqueUsers:s,successRate:o,avgSessionsPerUser:l,recentActivity:d},sessionStatus:{succeeded:r.length,failed:n.length,processing:i.length,total:t},riskLevels:{...g,total:t},predictions:{depression:{...k,total:r.length},anxiety:{...N,total:r.length}},timeData:R,riskDistribution:g,userStats:E}},mt=({title:a,value:t,subtitle:s,icon:r,trend:n,color:i="text-blue-600"})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:a}),e.jsx("p",{className:`text-2xl font-bold ${i} dark:text-white mt-1`,children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s})]}),e.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${i}`,children:r})]}),n&&e.jsxs("div",{className:"flex items-center mt-4",children:[n==="up"&&e.jsx(kt,{className:"h-4 w-4 text-green-500 mr-1"}),n==="down"&&e.jsx(js,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("span",{className:`text-sm ${n==="up"?"text-green-600":n==="down"?"text-red-600":"text-gray-500"}`,children:n==="up"?"Trending up":n==="down"?"Trending down":"Stable"})]})]}),xt=({title:a,data:t,total:s})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:a}),e.jsx("div",{className:"space-y-3",children:t.map((r,n)=>{const i=Mt(r.value,s);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r.label}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[r.value," (",i,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${r.color}`,style:{width:`${i}%`},role:"progressbar","aria-label":`${r.label}: ${r.value} (${i}%)`})})]},n)})})]}),sn=({title:a,data:t})=>{const s=Math.max(...t.map(i=>i.count),1),r=0,n=s-r||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:a}),e.jsx("div",{className:"relative h-48",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),t.map((i,o)=>{const l=80/t.length,u=o/(t.length-1)*(100-l)+l/2,d=(i.count-r)/n*95,g=100-d;return e.jsx("rect",{x:u-l/2,y:g,width:l*.6,height:d,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},o)})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:t.map((i,o)=>{const l=new Date(i.date),u=l.toLocaleDateString("en-US",{weekday:"short"}),d=l.toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:u}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:d}),e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:i.count})]},o)})})]})},rn=({title:a,depressionData:t,anxietyData:s})=>{const r=[{depression:t.no_to_mild,anxiety:s.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:t.mild_to_moderate,anxiety:s.mild,severity:"Mild",label:"Mild"},{depression:t.moderate_to_severe,anxiety:s.moderate,severity:"Moderate",label:"Moderate"},{depression:t.severe,anxiety:s.moderately_severe+s.severe,severity:"High",label:"Severe"}],n=Math.max(...r.map(o=>Math.max(o.depression,o.anxiety)),10),i=o=>{switch(o){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:a}),e.jsx("div",{className:"relative h-96",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 400 300",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"correlationGrid",width:"40",height:"30",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 40 0 L 0 0 0 30",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),e.jsx("rect",{width:"400",height:"300",fill:"url(#correlationGrid)"}),e.jsx("line",{x1:"50",y1:"270",x2:"370",y2:"270",stroke:"rgb(107 114 128)",strokeWidth:"2"}),e.jsx("line",{x1:"50",y1:"270",x2:"50",y2:"30",stroke:"rgb(107 114 128)",strokeWidth:"2"}),r.map((o,l)=>{const u=50+o.depression/n*320,d=270-o.anxiety/n*240,g=Math.max(Math.sqrt(o.depression+o.anxiety)*2.5,8);return e.jsxs("g",{children:[e.jsx("circle",{cx:u,cy:d,r:g,className:`${i(o.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),e.jsx("text",{x:u,y:d+4,textAnchor:"middle",className:"text-xs fill-white font-bold",children:o.depression+o.anxiety})]},l)}),e.jsx("text",{x:"210",y:"295",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases â†’"}),e.jsx("text",{x:"30",y:"150",textAnchor:"middle",transform:"rotate(-90 30 150)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"â† Anxiety Cases"})]})}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:r.map((o,l)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i(o.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:o.label})]},l))})]})},an=({title:a,sessionStatus:t})=>{const s=[{label:"Total Sessions",value:t.total,color:"bg-blue-500"},{label:"In Processing",value:t.processing,color:"bg-yellow-500"},{label:"Completed",value:t.succeeded,color:"bg-green-500"},{label:"Failed",value:t.failed,color:"bg-red-500"}],r=t.total||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:a}),e.jsx("div",{className:"space-y-4",children:s.map((n,i)=>{const o=n.value/r*100,l=i>0?(n.value/s[0].value*100).toFixed(1):"100.0";return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:n.value}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",l,"%)"]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:`h-full ${n.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${o}%`},children:o>20&&e.jsx("span",{className:"text-xs font-medium text-white",children:n.value})}),i<s.length-1&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},i)})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(t.succeeded/t.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(t.failed/t.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},nn=({userStats:a})=>{const t=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),s=(o,l)=>{if(l===0)return"text-gray-400";switch(o){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},r=a.length,n=r>0?Math.round(a.reduce((o,l)=>o+l.totalSessions,0)/r*10)/10:0,i=a.length>0?a.reduce((o,l)=>l.successRate>o.successRate?l:o,a[0]):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(_s,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),e.jsxs("div",{className:"flex space-x-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:n}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),i&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-green-600",children:[i.successRate,"%"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Best Job Success Rate"})]})]})]}),a.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white",children:"User ID"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Job Success Rate"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Avg Confidence"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Risk Distribution"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),e.jsx("tbody",{children:a.map((o,l)=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${l%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.jsxs("div",{className:"truncate max-w-[120px]",title:o.userId,children:[o.userId.substring(0,8),"..."]})})}),e.jsxs("td",{className:"py-3 px-2 text-center",children:[e.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:o.totalSessions}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.successfulSessions," successful"]})]}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:`font-medium ${o.successRate>=80?"text-green-600":o.successRate>=60?"text-yellow-600":"text-red-600"}`,children:[o.successRate,"%"]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(o.avgConfidence*100).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[e.jsxs("span",{className:`px-1 py-0.5 rounded ${s("low",o.riskDistribution.low)}`,children:["L:",o.riskDistribution.low]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${s("medium",o.riskDistribution.medium)}`,children:["M:",o.riskDistribution.medium]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${s("high",o.riskDistribution.high)}`,children:["H:",o.riskDistribution.high]})]})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t(o.lastActivity)})})]},o.userId))})]})})]})]})},on=()=>{const[a,t]=h.useState(null),[s,r]=h.useState(!1),[n,i]=h.useState(null),[o,l]=h.useState(new Date),{announceToScreenReader:u}=Ve(),d=parseInt("69")*1e3,g=h.useCallback(async()=>{try{r(!0),i(null);let N=[];try{N=(await Q.getAllSessions()).sessions}catch(I){console.warn("getAllSessions endpoint not available, using mock data for demonstration:",I),N=[{sessionId:"demo-session-1",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*2).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_1.wav",prediction:{sessionId:"demo-session-1",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"no_or_minimal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.85,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-2",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*6).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_2.wav",prediction:{sessionId:"demo-session-2",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.92,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-3",userId:"9d8c7b6a-5e4f-4392-8a1b-0c9d8e7f6a5b",status:"failed",createdAt:new Date(Date.now()-1e3*60*60*12).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_3.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing failed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-4",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*24).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_4.wav",prediction:{sessionId:"demo-session-4",status:"succeeded",predictedScoreDepression:"moderate_to_severe",predictedScoreAnxiety:"moderately_severe",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"high",confidence:.78,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-5",userId:"4c3b2a19-8e7f-4d6c-5b4a-392817f6e5d4",status:"processing",createdAt:new Date(Date.now()-1e3*60*30).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_5.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing in progress"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-6",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*36).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_6.wav",prediction:{sessionId:"demo-session-6",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"mild",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.89,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-7",userId:"7f6e5d4c-3b2a-4190-8e7f-6d5c4b3a2918",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*48).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_7.wav",prediction:{sessionId:"demo-session-7",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.82,insights:["Analysis completed"],completedAt:new Date().toISOString()}}]}const R=tn(N);t(R),l(new Date),u("Control panel data loaded successfully")}catch(N){const R=N;i(R),u(`Error loading control panel data: ${R.message}`)}finally{r(!1)}},[u]);h.useEffect(()=>{g()},[g]),h.useEffect(()=>{const N=setInterval(()=>{s||g()},d);return()=>clearInterval(N)},[g,s,d]);const k=h.useCallback(()=>{i(null),g()},[g]);return s?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{className:"h-6 w-6 animate-spin text-blue-500"}),e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):n?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:n.message}),e.jsxs("button",{onClick:k,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):a?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights dashboard"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",o.toLocaleTimeString()]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",d/1e3,"s intervals"]})]}),e.jsxs("button",{onClick:g,disabled:s,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors","aria-label":"Refresh control panel data",children:[e.jsx(se,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(mt,{title:"Total Sessions",value:a.overview.totalSessions,subtitle:"All time",icon:e.jsx(Ze,{className:"h-6 w-6"}),color:"text-blue-600"}),e.jsx(mt,{title:"Unique Users",value:a.overview.uniqueUsers,subtitle:"Active users",icon:e.jsx(_s,{className:"h-6 w-6"}),color:"text-green-600"}),e.jsx(mt,{title:"Job Success Rate",value:`${a.overview.successRate}%`,subtitle:"Completed analyses",icon:e.jsx(ks,{className:"h-6 w-6"}),color:"text-purple-600",trend:a.overview.successRate>75?"up":a.overview.successRate<50?"down":"neutral"}),e.jsx(mt,{title:"Recent Activity",value:a.overview.recentActivity,subtitle:"Last 24 hours",icon:e.jsx(Te,{className:"h-6 w-6"}),color:"text-orange-600",trend:a.overview.recentActivity>5?"up":a.overview.recentActivity===0?"down":"neutral"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(xt,{title:"Session Status Distribution",data:[{label:"Succeeded",value:a.sessionStatus.succeeded,color:"bg-green-500"},{label:"Processing",value:a.sessionStatus.processing,color:"bg-yellow-500"},{label:"Failed",value:a.sessionStatus.failed,color:"bg-red-500"}],total:a.sessionStatus.total}),e.jsx(xt,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:a.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:a.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:a.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:a.riskLevels.unknown,color:"bg-gray-500"}],total:a.riskLevels.total})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(xt,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:a.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:a.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:a.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:a.predictions.depression.severe,color:"bg-red-500"}],total:a.predictions.depression.total}),e.jsx(xt,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:a.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:a.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:a.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:a.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:a.predictions.anxiety.severe,color:"bg-red-700"}],total:a.predictions.anxiety.total})]}),e.jsx("div",{className:"mb-8",children:e.jsx(nn,{userStats:a.userStats})}),e.jsx("div",{className:"mb-8",children:e.jsx(rn,{title:"Depression vs Anxiety Correlation",depressionData:a.predictions.depression,anxietyData:a.predictions.anxiety})}),e.jsx("div",{className:"mb-8",children:e.jsx(an,{title:"Session Completion Funnel",sessionStatus:a.sessionStatus})}),e.jsx("div",{className:"mb-8",children:e.jsx(sn,{title:"Sessions Over Time (7 Days)",data:a.timeData})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ft,{className:"h-5 w-5 mr-2 text-red-500"}),"System Health Overview"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[a.overview.successRate,"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Job Success Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:a.overview.totalSessions}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:a.sessionStatus.processing}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Processing"})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})};class ln extends Gs.EventEmitter{constructor(s){super();B(this,"recognition",null);B(this,"synthesis",null);B(this,"audioContext",null);B(this,"microphone",null);B(this,"analyzer",null);B(this,"vadProcessor",null);B(this,"stream",null);B(this,"isListening",!1);B(this,"isVADActive",!1);B(this,"silenceTimeout",null);B(this,"speechTimeout",null);B(this,"config",{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:3,audioTracks:!0,noiseReduction:!0,echoCancellation:!0});this.config={...this.config,...s},this.initializeServices()}async initializeServices(){try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const s=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new s,this.setupSpeechRecognition()}"speechSynthesis"in window&&(this.synthesis=window.speechSynthesis),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.emit("initialized",{speechRecognition:!!this.recognition,speechSynthesis:!!this.synthesis,voiceActivityDetection:!!this.audioContext})}catch(s){console.error("Error initializing speech services:",s),this.emit("error",{type:"initialization",error:s})}}setupSpeechRecognition(){this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives,this.recognition.onstart=()=>{this.isListening=!0,this.emit("listening",{started:!0})},this.recognition.onresult=s=>{const r=[];for(let i=s.resultIndex;i<s.results.length;i++){const o=s.results[i],l=o[0].transcript,u=o[0].confidence,d=o.isFinal,g=[];for(let k=1;k<o.length&&k<this.config.maxAlternatives;k++)g.push(o[k].transcript);r.push({transcript:l,confidence:u,isFinal:d,alternatives:g})}this.emit("result",{results:r});const n=r.filter(i=>i.isFinal);n.length>0&&this.emit("finalResult",{results:n})},this.recognition.onerror=s=>{console.error("Speech recognition error:",s.error),this.emit("error",{type:"recognition",error:s.error}),(s.error==="no-speech"||s.error==="audio-capture")&&setTimeout(()=>this.restartRecognition(),1e3)},this.recognition.onend=()=>{this.isListening=!1,this.emit("listening",{started:!1}),this.config.continuous&&this.isVADActive&&setTimeout(()=>this.startListening(),100)})}async setupVoiceActivityDetection(){try{if(!this.audioContext)throw new Error("AudioContext not available");this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:this.config.echoCancellation,noiseSuppression:this.config.noiseReduction,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyzer=this.audioContext.createAnalyser(),this.vadProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.analyzer.fftSize=256,this.analyzer.smoothingTimeConstant=.8,this.microphone.connect(this.analyzer),this.analyzer.connect(this.vadProcessor),this.vadProcessor.connect(this.audioContext.destination),this.vadProcessor.onaudioprocess=s=>{this.processVAD(s)},this.emit("vadReady")}catch(s){console.error("Error setting up VAD:",s),this.emit("error",{type:"vad",error:s})}}processVAD(s){if(!this.analyzer)return;const r=this.analyzer.frequencyBinCount,n=new Uint8Array(r);this.analyzer.getByteFrequencyData(n);let i=0;for(let d=0;d<r;d++)i+=n[d];const o=i/r,u=o>30;this.emit("voiceActivity",{isActive:u,volume:o,timestamp:Date.now()}),u?(this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout||(this.speechTimeout=setTimeout(()=>{this.emit("speechStart")},200))):(this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null),this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.emit("speechEnd")},1500)))}async startListening(){try{if(!this.recognition)throw new Error("Speech recognition not available");this.isVADActive||(await this.setupVoiceActivityDetection(),this.isVADActive=!0),this.isListening||this.recognition.start()}catch(s){console.error("Error starting speech recognition:",s),this.emit("error",{type:"start",error:s})}}stopListening(){try{this.recognition&&this.isListening&&this.recognition.stop(),this.isVADActive=!1,this.vadProcessor&&this.vadProcessor.disconnect(),this.analyzer&&this.analyzer.disconnect(),this.microphone&&this.microphone.disconnect(),this.stream&&(this.stream.getTracks().forEach(s=>s.stop()),this.stream=null),this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null)}catch(s){console.error("Error stopping speech recognition:",s),this.emit("error",{type:"stop",error:s})}}restartRecognition(){this.isVADActive&&(this.stopListening(),setTimeout(()=>this.startListening(),500))}async speak(s,r){return new Promise((n,i)=>{if(!this.synthesis){i(new Error("Speech synthesis not available"));return}r!=null&&r.interrupt&&this.synthesis.cancel();const o=new SpeechSynthesisUtterance(s);o.rate=(r==null?void 0:r.rate)||.9,o.pitch=(r==null?void 0:r.pitch)||1,o.volume=(r==null?void 0:r.volume)||.8,r!=null&&r.voice&&(o.voice=r.voice),o.onend=()=>{this.emit("speechEnd",{text:s}),n()},o.onerror=l=>{this.emit("error",{type:"synthesis",error:l.error}),i(new Error(`Speech synthesis error: ${l.error}`))},o.onstart=()=>{this.emit("speechStart",{text:s})},this.synthesis.speak(o)})}getAvailableVoices(){return this.synthesis?this.synthesis.getVoices():[]}updateConfig(s){this.config={...this.config,...s},this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives)}isAvailable(){return!!(this.recognition&&this.synthesis)}isCurrentlyListening(){return this.isListening}destroy(){this.stopListening(),this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.removeAllListeners()}}const cn=(a={})=>{const t=h.useRef(null),[s,r]=h.useState(!1),[n,i]=h.useState(!1),[o,l]=h.useState(!1),[u,d]=h.useState(0),[g,k]=h.useState(null),[N,R]=h.useState(!1),[I,E]=h.useState([]);h.useEffect(()=>{t.current=new ln(a.config);const M=t.current;return M.on("initialized",P=>{i(P.speechRecognition&&P.speechSynthesis),R(!0),E(M.getAvailableVoices())}),M.on("listening",({started:P})=>{r(P)}),M.on("result",({results:P})=>{var y;(y=a.onResult)==null||y.call(a,P)}),M.on("finalResult",({results:P})=>{var y;(y=a.onFinalResult)==null||y.call(a,P)}),M.on("voiceActivity",P=>{var y;l(P.isActive),d(P.volume),(y=a.onVoiceActivity)==null||y.call(a,P)}),M.on("speechStart",()=>{var P;(P=a.onSpeechStart)==null||P.call(a)}),M.on("speechEnd",()=>{var P;(P=a.onSpeechEnd)==null||P.call(a)}),M.on("error",({type:P,error:y})=>{var f;const m=`Speech ${P} error: ${y}`;k(m),(f=a.onError)==null||f.call(a,{type:P,error:y}),console.error(m)}),a.autoStart&&M.startListening().catch(console.error),()=>{M.destroy()}},[]);const S=h.useCallback(async()=>{try{k(null),t.current&&await t.current.startListening()}catch(M){const P=M instanceof Error?M.message:"Failed to start listening";throw k(P),M}},[]),v=h.useCallback(()=>{try{k(null),t.current&&t.current.stopListening()}catch(M){const P=M instanceof Error?M.message:"Failed to stop listening";k(P)}},[]),A=h.useCallback(async(M,P)=>{try{k(null),t.current&&await t.current.speak(M,P)}catch(y){const m=y instanceof Error?y.message:"Failed to speak";throw k(m),y}},[]),q=h.useCallback(M=>{t.current&&t.current.updateConfig(M)},[]);return h.useEffect(()=>{if(N&&t.current){const M=()=>{E(t.current.getAvailableVoices())};if(M(),"speechSynthesis"in window)return window.speechSynthesis.addEventListener("voiceschanged",M),()=>{window.speechSynthesis.removeEventListener("voiceschanged",M)}}},[N]),{isListening:s,isAvailable:n,isVoiceActive:o,volume:u,startListening:S,stopListening:v,speak:A,updateConfig:q,availableVoices:I,error:g,isInitialized:N}};class $e extends Error{constructor(t,s){const r=new.target.prototype;super(`${t}: Status code '${s}'`),this.statusCode=s,this.__proto__=r}}class Ot extends Error{constructor(t="A timeout occurred."){const s=new.target.prototype;super(t),this.__proto__=s}}class _e extends Error{constructor(t="An abort occurred."){const s=new.target.prototype;super(t),this.__proto__=s}}class dn extends Error{constructor(t,s){const r=new.target.prototype;super(t),this.transport=s,this.errorType="UnsupportedTransportError",this.__proto__=r}}class hn extends Error{constructor(t,s){const r=new.target.prototype;super(t),this.transport=s,this.errorType="DisabledTransportError",this.__proto__=r}}class un extends Error{constructor(t,s){const r=new.target.prototype;super(t),this.transport=s,this.errorType="FailedToStartTransportError",this.__proto__=r}}class ts extends Error{constructor(t){const s=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=s}}class gn extends Error{constructor(t,s){const r=new.target.prototype;super(t),this.innerErrors=s,this.__proto__=r}}class As{constructor(t,s,r){this.statusCode=t,this.statusText=s,this.content=r}}class jt{get(t,s){return this.send({...s,method:"GET",url:t})}post(t,s){return this.send({...s,method:"POST",url:t})}delete(t,s){return this.send({...s,method:"DELETE",url:t})}getCookieString(t){return""}}var w;(function(a){a[a.Trace=0]="Trace",a[a.Debug=1]="Debug",a[a.Information=2]="Information",a[a.Warning=3]="Warning",a[a.Error=4]="Error",a[a.Critical=5]="Critical",a[a.None=6]="None"})(w||(w={}));class tt{constructor(){}log(t,s){}}tt.instance=new tt;const mn="9.0.6";class ee{static isRequired(t,s){if(t==null)throw new Error(`The '${s}' argument is required.`)}static isNotEmpty(t,s){if(!t||t.match(/^\s*$/))throw new Error(`The '${s}' argument should not be empty.`)}static isIn(t,s,r){if(!(t in s))throw new Error(`Unknown ${r} value: ${t}.`)}}class Z{static get isBrowser(){return!Z.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!Z.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!Z.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function st(a,t){let s="";return Le(a)?(s=`Binary data of length ${a.byteLength}`,t&&(s+=`. Content: '${xn(a)}'`)):typeof a=="string"&&(s=`String data of length ${a.length}`,t&&(s+=`. Content: '${a}'`)),s}function xn(a){const t=new Uint8Array(a);let s="";return t.forEach(r=>{const n=r<16?"0":"";s+=`0x${n}${r.toString(16)} `}),s.substr(0,s.length-1)}function Le(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}async function Is(a,t,s,r,n,i){const o={},[l,u]=We();o[l]=u,a.log(w.Trace,`(${t} transport) sending data. ${st(n,i.logMessageContent)}.`);const d=Le(n)?"arraybuffer":"text",g=await s.post(r,{content:n,headers:{...o,...i.headers},responseType:d,timeout:i.timeout,withCredentials:i.withCredentials});a.log(w.Trace,`(${t} transport) request complete. Response status: ${g.statusCode}.`)}function pn(a){return a===void 0?new wt(w.Information):a===null?tt.instance:a.log!==void 0?a:new wt(a)}class fn{constructor(t,s){this._subject=t,this._observer=s}dispose(){const t=this._subject.observers.indexOf(this._observer);t>-1&&this._subject.observers.splice(t,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(s=>{})}}class wt{constructor(t){this._minLevel=t,this.out=console}log(t,s){if(t>=this._minLevel){const r=`[${new Date().toISOString()}] ${w[t]}: ${s}`;switch(t){case w.Critical:case w.Error:this.out.error(r);break;case w.Warning:this.out.warn(r);break;case w.Information:this.out.info(r);break;default:this.out.log(r);break}}}}function We(){let a="X-SignalR-User-Agent";return Z.isNode&&(a="User-Agent"),[a,yn(mn,bn(),vn(),wn())]}function yn(a,t,s,r){let n="Microsoft SignalR/";const i=a.split(".");return n+=`${i[0]}.${i[1]}`,n+=` (${a}; `,t&&t!==""?n+=`${t}; `:n+="Unknown OS; ",n+=`${s}`,r?n+=`; ${r}`:n+="; Unknown Runtime Version",n+=")",n}function bn(){if(Z.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function wn(){if(Z.isNode)return process.versions.node}function vn(){return Z.isNode?"NodeJS":"Browser"}function It(a){return a.stack?a.stack:a.message?a.message:`${a}`}function kn(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("could not find globalThis")}class jn extends jt{constructor(t){if(super(),this._logger=t,typeof fetch>"u"||Z.isNode){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(s("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=s("node-fetch"):this._fetchType=fetch,this._fetchType=s("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(kn());if(typeof AbortController>"u"){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=s("abort-controller")}else this._abortControllerType=AbortController}async send(t){if(t.abortSignal&&t.abortSignal.aborted)throw new _e;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");const s=new this._abortControllerType;let r;t.abortSignal&&(t.abortSignal.onabort=()=>{s.abort(),r=new _e});let n=null;if(t.timeout){const u=t.timeout;n=setTimeout(()=>{s.abort(),this._logger.log(w.Warning,"Timeout from HTTP request."),r=new Ot},u)}t.content===""&&(t.content=void 0),t.content&&(t.headers=t.headers||{},Le(t.content)?t.headers["Content-Type"]="application/octet-stream":t.headers["Content-Type"]="text/plain;charset=UTF-8");let i;try{i=await this._fetchType(t.url,{body:t.content,cache:"no-cache",credentials:t.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...t.headers},method:t.method,mode:"cors",redirect:"follow",signal:s.signal})}catch(u){throw r||(this._logger.log(w.Warning,`Error from HTTP request. ${u}.`),u)}finally{n&&clearTimeout(n),t.abortSignal&&(t.abortSignal.onabort=null)}if(!i.ok){const u=await ss(i,"text");throw new $e(u||i.statusText,i.status)}const l=await ss(i,t.responseType);return new As(i.status,i.statusText,l)}getCookieString(t){let s="";return Z.isNode&&this._jar&&this._jar.getCookies(t,(r,n)=>s=n.join("; ")),s}}function ss(a,t){let s;switch(t){case"arraybuffer":s=a.arrayBuffer();break;case"text":s=a.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`);default:s=a.text();break}return s}class Nn extends jt{constructor(t){super(),this._logger=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new _e):t.method?t.url?new Promise((s,r)=>{const n=new XMLHttpRequest;n.open(t.method,t.url,!0),n.withCredentials=t.withCredentials===void 0?!0:t.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.content===""&&(t.content=void 0),t.content&&(Le(t.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=t.headers;i&&Object.keys(i).forEach(o=>{n.setRequestHeader(o,i[o])}),t.responseType&&(n.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{n.abort(),r(new _e)}),t.timeout&&(n.timeout=t.timeout),n.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),n.status>=200&&n.status<300?s(new As(n.status,n.statusText,n.response||n.responseText)):r(new $e(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(w.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),r(new $e(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(w.Warning,"Timeout from HTTP request."),r(new Ot)},n.send(t.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class _n extends jt{constructor(t){if(super(),typeof fetch<"u"||Z.isNode)this._httpClient=new jn(t);else if(typeof XMLHttpRequest<"u")this._httpClient=new Nn(t);else throw new Error("No usable HttpClient found.")}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new _e):t.method?t.url?this._httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this._httpClient.getCookieString(t)}}class we{static write(t){return`${t}${we.RecordSeparator}`}static parse(t){if(t[t.length-1]!==we.RecordSeparator)throw new Error("Message is incomplete.");const s=t.split(we.RecordSeparator);return s.pop(),s}}we.RecordSeparatorCode=30;we.RecordSeparator=String.fromCharCode(we.RecordSeparatorCode);class Sn{writeHandshakeRequest(t){return we.write(JSON.stringify(t))}parseHandshakeResponse(t){let s,r;if(Le(t)){const l=new Uint8Array(t),u=l.indexOf(we.RecordSeparatorCode);if(u===-1)throw new Error("Message is incomplete.");const d=u+1;s=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,d))),r=l.byteLength>d?l.slice(d).buffer:null}else{const l=t,u=l.indexOf(we.RecordSeparator);if(u===-1)throw new Error("Message is incomplete.");const d=u+1;s=l.substring(0,d),r=l.length>d?l.substring(d):null}const n=we.parse(s),i=JSON.parse(n[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[r,i]}}var U;(function(a){a[a.Invocation=1]="Invocation",a[a.StreamItem=2]="StreamItem",a[a.Completion=3]="Completion",a[a.StreamInvocation=4]="StreamInvocation",a[a.CancelInvocation=5]="CancelInvocation",a[a.Ping=6]="Ping",a[a.Close=7]="Close",a[a.Ack=8]="Ack",a[a.Sequence=9]="Sequence"})(U||(U={}));class Cn{constructor(){this.observers=[]}next(t){for(const s of this.observers)s.next(t)}error(t){for(const s of this.observers)s.error&&s.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new fn(this,t)}}class An{constructor(t,s,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=t,this._connection=s,this._bufferSize=r}async _send(t){const s=this._protocol.writeMessage(t);let r=Promise.resolve();if(this._isInvocationMessage(t)){this._totalMessageCount++;let n=()=>{},i=()=>{};Le(s)?this._bufferedByteCount+=s.byteLength:this._bufferedByteCount+=s.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((o,l)=>{n=o,i=l})),this._messages.push(new In(s,this._totalMessageCount,n,i))}try{this._reconnectInProgress||await this._connection.send(s)}catch{this._disconnected()}await r}_ack(t){let s=-1;for(let r=0;r<this._messages.length;r++){const n=this._messages[r];if(n._id<=t.sequenceId)s=r,Le(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else if(this._bufferedByteCount<this._bufferSize)n._resolver();else break}s!==-1&&(this._messages=this._messages.slice(s+1))}_shouldProcessMessage(t){if(this._waitForSequenceMessage)return t.type!==U.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(t))return!0;const s=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,s<=this._latestReceivedSequenceId?(s===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=s,this._ackTimer(),!0)}_resetSequence(t){if(t.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=t.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const t=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:U.Sequence,sequenceId:t}));const s=this._messages;for(const r of s)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(t){t??(t=new Error("Unable to reconnect to server."));for(const s of this._messages)s._rejector(t)}_isInvocationMessage(t){switch(t.type){case U.Invocation:case U.StreamItem:case U.Completion:case U.StreamInvocation:case U.CancelInvocation:return!0;case U.Close:case U.Sequence:case U.Ping:case U.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:U.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class In{constructor(t,s,r,n){this._message=t,this._id=s,this._resolver=r,this._rejector=n}}const En=30*1e3,Rn=15*1e3,Tn=1e5;var V;(function(a){a.Disconnected="Disconnected",a.Connecting="Connecting",a.Connected="Connected",a.Disconnecting="Disconnecting",a.Reconnecting="Reconnecting"})(V||(V={}));class Ut{static create(t,s,r,n,i,o,l){return new Ut(t,s,r,n,i,o,l)}constructor(t,s,r,n,i,o,l){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(w.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},ee.isRequired(t,"connection"),ee.isRequired(s,"logger"),ee.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=i??En,this.keepAliveIntervalInMilliseconds=o??Rn,this._statefulReconnectBufferSize=l??Tn,this._logger=s,this._protocol=r,this.connection=t,this._reconnectPolicy=n,this._handshakeProtocol=new Sn,this.connection.onreceive=u=>this._processIncomingData(u),this.connection.onclose=u=>this._connectionClosed(u),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=V.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:U.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this._connectionState!==V.Disconnected&&this._connectionState!==V.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==V.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=V.Connecting,this._logger.log(w.Debug,"Starting HubConnection.");try{await this._startInternal(),Z.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=V.Connected,this._connectionStarted=!0,this._logger.log(w.Debug,"HubConnection connected successfully.")}catch(t){return this._connectionState=V.Disconnected,this._logger.log(w.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const t=new Promise((s,r)=>{this._handshakeResolver=s,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let s=this._protocol.version;this.connection.features.reconnect||(s=1);const r={protocol:this._protocol.name,version:s};if(this._logger.log(w.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(w.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await t,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new An(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(s){throw this._logger.log(w.Debug,`Hub handshake failed with error '${s}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(s),s}}async stop(){const t=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await t}catch{}}_stopInternal(t){if(this._connectionState===V.Disconnected)return this._logger.log(w.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===V.Disconnecting)return this._logger.log(w.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const s=this._connectionState;return this._connectionState=V.Disconnecting,this._logger.log(w.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(w.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(s===V.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=t||new _e("The connection was stopped before the hub handshake could complete."),this.connection.stop(t))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(t,...s){const[r,n]=this._replaceStreamingParams(s),i=this._createStreamInvocation(t,s,n);let o;const l=new Cn;return l.cancelCallback=()=>{const u=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],o.then(()=>this._sendWithProtocol(u))},this._callbacks[i.invocationId]=(u,d)=>{if(d){l.error(d);return}else u&&(u.type===U.Completion?u.error?l.error(new Error(u.error)):l.complete():l.next(u.item))},o=this._sendWithProtocol(i).catch(u=>{l.error(u),delete this._callbacks[i.invocationId]}),this._launchStreams(r,o),l}_sendMessage(t){return this._resetKeepAliveInterval(),this.connection.send(t)}_sendWithProtocol(t){return this._messageBuffer?this._messageBuffer._send(t):this._sendMessage(this._protocol.writeMessage(t))}send(t,...s){const[r,n]=this._replaceStreamingParams(s),i=this._sendWithProtocol(this._createInvocation(t,s,!0,n));return this._launchStreams(r,i),i}invoke(t,...s){const[r,n]=this._replaceStreamingParams(s),i=this._createInvocation(t,s,!1,n);return new Promise((l,u)=>{this._callbacks[i.invocationId]=(g,k)=>{if(k){u(k);return}else g&&(g.type===U.Completion?g.error?u(new Error(g.error)):l(g.result):u(new Error(`Unexpected message type: ${g.type}`)))};const d=this._sendWithProtocol(i).catch(g=>{u(g),delete this._callbacks[i.invocationId]});this._launchStreams(r,d)})}on(t,s){!t||!s||(t=t.toLowerCase(),this._methods[t]||(this._methods[t]=[]),this._methods[t].indexOf(s)===-1&&this._methods[t].push(s))}off(t,s){if(!t)return;t=t.toLowerCase();const r=this._methods[t];if(r)if(s){const n=r.indexOf(s);n!==-1&&(r.splice(n,1),r.length===0&&delete this._methods[t])}else delete this._methods[t]}onclose(t){t&&this._closedCallbacks.push(t)}onreconnecting(t){t&&this._reconnectingCallbacks.push(t)}onreconnected(t){t&&this._reconnectedCallbacks.push(t)}_processIncomingData(t){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(t=this._processHandshakeResponse(t),this._receivedHandshakeResponse=!0),t){const s=this._protocol.parseMessages(t,this._logger);for(const r of s)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(r)))switch(r.type){case U.Invocation:this._invokeClientMethod(r).catch(n=>{this._logger.log(w.Error,`Invoke client method threw error: ${It(n)}`)});break;case U.StreamItem:case U.Completion:{const n=this._callbacks[r.invocationId];if(n){r.type===U.Completion&&delete this._callbacks[r.invocationId];try{n(r)}catch(i){this._logger.log(w.Error,`Stream callback threw error: ${It(i)}`)}}break}case U.Ping:break;case U.Close:{this._logger.log(w.Information,"Close message received from server.");const n=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(n):this._stopPromise=this._stopInternal(n);break}case U.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case U.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(w.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(t){let s,r;try{[r,s]=this._handshakeProtocol.parseHandshakeResponse(t)}catch(n){const i="Error parsing handshake response: "+n;this._logger.log(w.Error,i);const o=new Error(i);throw this._handshakeRejecter(o),o}if(s.error){const n="Server returned handshake error: "+s.error;this._logger.log(w.Error,n);const i=new Error(n);throw this._handshakeRejecter(i),i}else this._logger.log(w.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let t=this._nextKeepAlive-new Date().getTime();t<0&&(t=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===V.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(t){const s=t.target.toLowerCase(),r=this._methods[s];if(!r){this._logger.log(w.Warning,`No client method with the name '${s}' found.`),t.invocationId&&(this._logger.log(w.Warning,`No result given for '${s}' method and invocation ID '${t.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)));return}const n=r.slice(),i=!!t.invocationId;let o,l,u;for(const d of n)try{const g=o;o=await d.apply(this,t.arguments),i&&o&&g&&(this._logger.log(w.Error,`Multiple results provided for '${s}'. Sending error to server.`),u=this._createCompletionMessage(t.invocationId,"Client provided multiple results.",null)),l=void 0}catch(g){l=g,this._logger.log(w.Error,`A callback for the method '${s}' threw error '${g}'.`)}u?await this._sendWithProtocol(u):i?(l?u=this._createCompletionMessage(t.invocationId,`${l}`,null):o!==void 0?u=this._createCompletionMessage(t.invocationId,null,o):(this._logger.log(w.Warning,`No result given for '${s}' method and invocation ID '${t.invocationId}'.`),u=this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(u)):o&&this._logger.log(w.Error,`Result given for '${s}' method but server is not expecting a result.`)}_connectionClosed(t){this._logger.log(w.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||t||new _e("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===V.Disconnecting?this._completeClose(t):this._connectionState===V.Connected&&this._reconnectPolicy?this._reconnect(t):this._connectionState===V.Connected&&this._completeClose(t)}_completeClose(t){if(this._connectionStarted){this._connectionState=V.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(t??new Error("Connection closed.")),this._messageBuffer=void 0),Z.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(s=>s.apply(this,[t]))}catch(s){this._logger.log(w.Error,`An onclose callback called with error '${t}' threw error '${s}'.`)}}}async _reconnect(t){const s=Date.now();let r=0,n=t!==void 0?t:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(r++,0,n);if(i===null){this._logger.log(w.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(t);return}if(this._connectionState=V.Reconnecting,t?this._logger.log(w.Information,`Connection reconnecting because of error '${t}'.`):this._logger.log(w.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(o=>o.apply(this,[t]))}catch(o){this._logger.log(w.Error,`An onreconnecting callback called with error '${t}' threw error '${o}'.`)}if(this._connectionState!==V.Reconnecting){this._logger.log(w.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;i!==null;){if(this._logger.log(w.Information,`Reconnect attempt number ${r} will start in ${i} ms.`),await new Promise(o=>{this._reconnectDelayHandle=setTimeout(o,i)}),this._reconnectDelayHandle=void 0,this._connectionState!==V.Reconnecting){this._logger.log(w.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=V.Connected,this._logger.log(w.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(o=>o.apply(this,[this.connection.connectionId]))}catch(o){this._logger.log(w.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${o}'.`)}return}catch(o){if(this._logger.log(w.Information,`Reconnect attempt failed because of error '${o}'.`),this._connectionState!==V.Reconnecting){this._logger.log(w.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===V.Disconnecting&&this._completeClose();return}n=o instanceof Error?o:new Error(o.toString()),i=this._getNextRetryDelay(r++,Date.now()-s,n)}}this._logger.log(w.Information,`Reconnect retries have been exhausted after ${Date.now()-s} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(t,s,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:s,previousRetryCount:t,retryReason:r})}catch(n){return this._logger.log(w.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${s}) threw error '${n}'.`),null}}_cancelCallbacksWithError(t){const s=this._callbacks;this._callbacks={},Object.keys(s).forEach(r=>{const n=s[r];try{n(null,t)}catch(i){this._logger.log(w.Error,`Stream 'error' callback called with '${t}' threw error: ${It(i)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(t,s,r,n){if(r)return n.length!==0?{target:t,arguments:s,streamIds:n,type:U.Invocation}:{target:t,arguments:s,type:U.Invocation};{const i=this._invocationId;return this._invocationId++,n.length!==0?{target:t,arguments:s,invocationId:i.toString(),streamIds:n,type:U.Invocation}:{target:t,arguments:s,invocationId:i.toString(),type:U.Invocation}}}_launchStreams(t,s){if(t.length!==0){s||(s=Promise.resolve());for(const r in t)t[r].subscribe({complete:()=>{s=s.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:n=>{let i;n instanceof Error?i=n.message:n&&n.toString?i=n.toString():i="Unknown error",s=s.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,i)))},next:n=>{s=s.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,n)))}})}}_replaceStreamingParams(t){const s=[],r=[];for(let n=0;n<t.length;n++){const i=t[n];if(this._isObservable(i)){const o=this._invocationId;this._invocationId++,s[o]=i,r.push(o.toString()),t.splice(n,1)}}return[s,r]}_isObservable(t){return t&&t.subscribe&&typeof t.subscribe=="function"}_createStreamInvocation(t,s,r){const n=this._invocationId;return this._invocationId++,r.length!==0?{target:t,arguments:s,invocationId:n.toString(),streamIds:r,type:U.StreamInvocation}:{target:t,arguments:s,invocationId:n.toString(),type:U.StreamInvocation}}_createCancelInvocation(t){return{invocationId:t,type:U.CancelInvocation}}_createStreamItemMessage(t,s){return{invocationId:t,item:s,type:U.StreamItem}}_createCompletionMessage(t,s,r){return s?{error:s,invocationId:t,type:U.Completion}:{invocationId:t,result:r,type:U.Completion}}_createCloseMessage(){return{type:U.Close}}}const Dn=[0,2e3,1e4,3e4,null];class rs{constructor(t){this._retryDelays=t!==void 0?[...t,null]:Dn}nextRetryDelayInMilliseconds(t){return this._retryDelays[t.previousRetryCount]}}class Pe{}Pe.Authorization="Authorization";Pe.Cookie="Cookie";class Mn extends jt{constructor(t,s){super(),this._innerClient=t,this._accessTokenFactory=s}async send(t){let s=!0;this._accessTokenFactory&&(!this._accessToken||t.url&&t.url.indexOf("/negotiate?")>0)&&(s=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(t);const r=await this._innerClient.send(t);return s&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(t),await this._innerClient.send(t)):r}_setAuthorizationHeader(t){t.headers||(t.headers={}),this._accessToken?t.headers[Pe.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&t.headers[Pe.Authorization]&&delete t.headers[Pe.Authorization]}getCookieString(t){return this._innerClient.getCookieString(t)}}var te;(function(a){a[a.None=0]="None",a[a.WebSockets=1]="WebSockets",a[a.ServerSentEvents=2]="ServerSentEvents",a[a.LongPolling=4]="LongPolling"})(te||(te={}));var me;(function(a){a[a.Text=1]="Text",a[a.Binary=2]="Binary"})(me||(me={}));let $n=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class as{get pollAborted(){return this._pollAbort.aborted}constructor(t,s,r){this._httpClient=t,this._logger=s,this._pollAbort=new $n,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(t,s){if(ee.isRequired(t,"url"),ee.isRequired(s,"transferFormat"),ee.isIn(s,me,"transferFormat"),this._url=t,this._logger.log(w.Trace,"(LongPolling transport) Connecting."),s===me.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,n]=We(),i={[r]:n,...this._options.headers},o={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};s===me.Binary&&(o.responseType="arraybuffer");const l=`${t}&_=${Date.now()}`;this._logger.log(w.Trace,`(LongPolling transport) polling: ${l}.`);const u=await this._httpClient.get(l,o);u.statusCode!==200?(this._logger.log(w.Error,`(LongPolling transport) Unexpected response code: ${u.statusCode}.`),this._closeError=new $e(u.statusText||"",u.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,o)}async _poll(t,s){try{for(;this._running;)try{const r=`${t}&_=${Date.now()}`;this._logger.log(w.Trace,`(LongPolling transport) polling: ${r}.`);const n=await this._httpClient.get(r,s);n.statusCode===204?(this._logger.log(w.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):n.statusCode!==200?(this._logger.log(w.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new $e(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(w.Trace,`(LongPolling transport) data received. ${st(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(w.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof Ot?this._logger.log(w.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(w.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(w.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(t){return this._running?Is(this._logger,"LongPolling",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(w.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(w.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const t={},[s,r]=We();t[s]=r;const n={headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,n)}catch(o){i=o}i?i instanceof $e&&(i.statusCode===404?this._logger.log(w.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(w.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(w.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(w.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this._closeError&&(t+=" Error: "+this._closeError),this._logger.log(w.Trace,t),this.onclose(this._closeError)}}}class Pn{constructor(t,s,r,n){this._httpClient=t,this._accessToken=s,this._logger=r,this._options=n,this.onreceive=null,this.onclose=null}async connect(t,s){return ee.isRequired(t,"url"),ee.isRequired(s,"transferFormat"),ee.isIn(s,me,"transferFormat"),this._logger.log(w.Trace,"(SSE transport) Connecting."),this._url=t,this._accessToken&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,n)=>{let i=!1;if(s!==me.Text){n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let o;if(Z.isBrowser||Z.isWebWorker)o=new this._options.EventSource(t,{withCredentials:this._options.withCredentials});else{const l=this._httpClient.getCookieString(t),u={};u.Cookie=l;const[d,g]=We();u[d]=g,o=new this._options.EventSource(t,{withCredentials:this._options.withCredentials,headers:{...u,...this._options.headers}})}try{o.onmessage=l=>{if(this.onreceive)try{this._logger.log(w.Trace,`(SSE transport) data received. ${st(l.data,this._options.logMessageContent)}.`),this.onreceive(l.data)}catch(u){this._close(u);return}},o.onerror=l=>{i?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},o.onopen=()=>{this._logger.log(w.Information,`SSE connected to ${this._url}`),this._eventSource=o,i=!0,r()}}catch(l){n(l);return}})}async send(t){return this._eventSource?Is(this._logger,"SSE",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(t){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(t))}}class Ln{constructor(t,s,r,n,i,o){this._logger=r,this._accessTokenFactory=s,this._logMessageContent=n,this._webSocketConstructor=i,this._httpClient=t,this.onreceive=null,this.onclose=null,this._headers=o}async connect(t,s){ee.isRequired(t,"url"),ee.isRequired(s,"transferFormat"),ee.isIn(s,me,"transferFormat"),this._logger.log(w.Trace,"(WebSockets transport) Connecting.");let r;return this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((n,i)=>{t=t.replace(/^http/,"ws");let o;const l=this._httpClient.getCookieString(t);let u=!1;if(Z.isNode||Z.isReactNative){const d={},[g,k]=We();d[g]=k,r&&(d[Pe.Authorization]=`Bearer ${r}`),l&&(d[Pe.Cookie]=l),o=new this._webSocketConstructor(t,void 0,{headers:{...d,...this._headers}})}else r&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);o||(o=new this._webSocketConstructor(t)),s===me.Binary&&(o.binaryType="arraybuffer"),o.onopen=d=>{this._logger.log(w.Information,`WebSocket connected to ${t}.`),this._webSocket=o,u=!0,n()},o.onerror=d=>{let g=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?g=d.error:g="There was an error with the transport",this._logger.log(w.Information,`(WebSockets transport) ${g}.`)},o.onmessage=d=>{if(this._logger.log(w.Trace,`(WebSockets transport) data received. ${st(d.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(d.data)}catch(g){this._close(g);return}},o.onclose=d=>{if(u)this._close(d);else{let g=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?g=d.error:g="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(g))}}})}send(t){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(w.Trace,`(WebSockets transport) sending data. ${st(t,this._logMessageContent)}.`),this._webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(t){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(w.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(t)&&(t.wasClean===!1||t.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)):t instanceof Error?this.onclose(t):this.onclose())}_isCloseEvent(t){return t&&typeof t.wasClean=="boolean"&&typeof t.code=="number"}}const ns=100;class Fn{constructor(t,s={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,ee.isRequired(t,"url"),this._logger=pn(s.logger),this.baseUrl=this._resolveUrl(t),s=s||{},s.logMessageContent=s.logMessageContent===void 0?!1:s.logMessageContent,typeof s.withCredentials=="boolean"||s.withCredentials===void 0)s.withCredentials=s.withCredentials===void 0?!0:s.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");s.timeout=s.timeout===void 0?100*1e3:s.timeout;let r=null,n=null;if(Z.isNode&&typeof require<"u"){const i=typeof __webpack_require__=="function"?__non_webpack_require__:require;r=i("ws"),n=i("eventsource")}!Z.isNode&&typeof WebSocket<"u"&&!s.WebSocket?s.WebSocket=WebSocket:Z.isNode&&!s.WebSocket&&r&&(s.WebSocket=r),!Z.isNode&&typeof EventSource<"u"&&!s.EventSource?s.EventSource=EventSource:Z.isNode&&!s.EventSource&&typeof n<"u"&&(s.EventSource=n),this._httpClient=new Mn(s.httpClient||new _n(this._logger),s.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=s,this.onreceive=null,this.onclose=null}async start(t){if(t=t||me.Binary,ee.isIn(t,me,"transferFormat"),this._logger.log(w.Debug,`Starting connection with transfer format '${me[t]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(t),await this._startInternalPromise,this._connectionState==="Disconnecting"){const s="Failed to start the HttpConnection before stop() was called.";return this._logger.log(w.Error,s),await this._stopPromise,Promise.reject(new _e(s))}else if(this._connectionState!=="Connected"){const s="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(w.Error,s),Promise.reject(new _e(s))}this._connectionStarted=!0}send(t){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Ht(this.transport)),this._sendQueue.send(t))}async stop(t){if(this._connectionState==="Disconnected")return this._logger.log(w.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(w.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(s=>{this._stopPromiseResolver=s}),await this._stopInternal(t),await this._stopPromise}async _stopInternal(t){this._stopError=t;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(s){this._logger.log(w.Error,`HttpConnection.transport.stop() threw error '${s}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(w.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(t){let s=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===te.WebSockets)this.transport=this._constructTransport(te.WebSockets),await this._startTransport(s,t);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,n=0;do{if(r=await this._getNegotiationResponse(s),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new _e("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(s=r.url),r.accessToken){const i=r.accessToken;this._accessTokenFactory=()=>i,this._httpClient._accessToken=i,this._httpClient._accessTokenFactory=void 0}n++}while(r.url&&n<ns);if(n===ns&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(s,this._options.transport,r,t)}this.transport instanceof as&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(w.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(w.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(t){const s={},[r,n]=We();s[r]=n;const i=this._resolveNegotiateUrl(t);this._logger.log(w.Debug,`Sending negotiation request: ${i}.`);try{const o=await this._httpClient.post(i,{content:"",headers:{...s,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(o.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${o.statusCode}'`));const l=JSON.parse(o.content);return(!l.negotiateVersion||l.negotiateVersion<1)&&(l.connectionToken=l.connectionId),l.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new ts("Client didn't negotiate Stateful Reconnect but the server did.")):l}catch(o){let l="Failed to complete negotiation with the server: "+o;return o instanceof $e&&o.statusCode===404&&(l=l+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(w.Error,l),Promise.reject(new ts(l))}}_createConnectUrl(t,s){return s?t+(t.indexOf("?")===-1?"?":"&")+`id=${s}`:t}async _createTransport(t,s,r,n){let i=this._createConnectUrl(t,r.connectionToken);if(this._isITransport(s)){this._logger.log(w.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=s,await this._startTransport(i,n),this.connectionId=r.connectionId;return}const o=[],l=r.availableTransports||[];let u=r;for(const d of l){const g=this._resolveTransportOrError(d,s,n,(u==null?void 0:u.useStatefulReconnect)===!0);if(g instanceof Error)o.push(`${d.transport} failed:`),o.push(g);else if(this._isITransport(g)){if(this.transport=g,!u){try{u=await this._getNegotiationResponse(t)}catch(k){return Promise.reject(k)}i=this._createConnectUrl(t,u.connectionToken)}try{await this._startTransport(i,n),this.connectionId=u.connectionId;return}catch(k){if(this._logger.log(w.Error,`Failed to start the transport '${d.transport}': ${k}`),u=void 0,o.push(new un(`${d.transport} failed: ${k}`,te[d.transport])),this._connectionState!=="Connecting"){const N="Failed to select transport before stop() was called.";return this._logger.log(w.Debug,N),Promise.reject(new _e(N))}}}}return o.length>0?Promise.reject(new gn(`Unable to connect to the server with any of the available transports. ${o.join(" ")}`,o)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(t){switch(t){case te.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Ln(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case te.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Pn(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case te.LongPolling:return new as(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${t}.`)}}_startTransport(t,s){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let n=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(t,s),await this.features.resend()}catch{n=!0}else{this._stopConnection(r);return}n&&this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(t,s)}_resolveTransportOrError(t,s,r,n){const i=te[t.transport];if(i==null)return this._logger.log(w.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(On(s,i))if(t.transferFormats.map(l=>me[l]).indexOf(r)>=0){if(i===te.WebSockets&&!this._options.WebSocket||i===te.ServerSentEvents&&!this._options.EventSource)return this._logger.log(w.Debug,`Skipping transport '${te[i]}' because it is not supported in your environment.'`),new dn(`'${te[i]}' is not supported in your environment.`,i);this._logger.log(w.Debug,`Selecting transport '${te[i]}'.`);try{return this.features.reconnect=i===te.WebSockets?n:void 0,this._constructTransport(i)}catch(l){return l}}else return this._logger.log(w.Debug,`Skipping transport '${te[i]}' because it does not support the requested transfer format '${me[r]}'.`),new Error(`'${te[i]}' does not support ${me[r]}.`);else return this._logger.log(w.Debug,`Skipping transport '${te[i]}' because it was disabled by the client.`),new hn(`'${te[i]}' is disabled by the client.`,i)}_isITransport(t){return t&&typeof t=="object"&&"connect"in t}_stopConnection(t){if(this._logger.log(w.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this._connectionState}.`),this.transport=void 0,t=this._stopError||t,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(w.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(w.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),t?this._logger.log(w.Error,`Connection disconnected with error '${t}'.`):this._logger.log(w.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(s=>{this._logger.log(w.Error,`TransportSendQueue.stop() threw error '${s}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(s){this._logger.log(w.Error,`HttpConnection.onclose(${t}) threw error '${s}'.`)}}}_resolveUrl(t){if(t.lastIndexOf("https://",0)===0||t.lastIndexOf("http://",0)===0)return t;if(!Z.isBrowser)throw new Error(`Cannot resolve '${t}'.`);const s=window.document.createElement("a");return s.href=t,this._logger.log(w.Information,`Normalizing '${t}' to '${s.href}'.`),s.href}_resolveNegotiateUrl(t){const s=new URL(t);s.pathname.endsWith("/")?s.pathname+="negotiate":s.pathname+="/negotiate";const r=new URLSearchParams(s.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),s.search=r.toString(),s.toString()}}function On(a,t){return!a||(t&a)!==0}class Ht{constructor(t){this._transport=t,this._buffer=[],this._executing=!0,this._sendBufferedData=new pt,this._transportResult=new pt,this._sendLoopPromise=this._sendLoop()}send(t){return this._bufferData(t),this._transportResult||(this._transportResult=new pt),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(t){if(this._buffer.length&&typeof this._buffer[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof t}`);this._buffer.push(t),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new pt;const t=this._transportResult;this._transportResult=void 0;const s=typeof this._buffer[0]=="string"?this._buffer.join(""):Ht._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(s),t.resolve()}catch(r){t.reject(r)}}}static _concatBuffers(t){const s=t.map(i=>i.byteLength).reduce((i,o)=>i+o),r=new Uint8Array(s);let n=0;for(const i of t)r.set(new Uint8Array(i),n),n+=i.byteLength;return r.buffer}}class pt{constructor(){this.promise=new Promise((t,s)=>[this._resolver,this._rejecter]=[t,s])}resolve(){this._resolver()}reject(t){this._rejecter(t)}}const Un="json";class Hn{constructor(){this.name=Un,this.version=2,this.transferFormat=me.Text}parseMessages(t,s){if(typeof t!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];s===null&&(s=tt.instance);const r=we.parse(t),n=[];for(const i of r){const o=JSON.parse(i);if(typeof o.type!="number")throw new Error("Invalid payload.");switch(o.type){case U.Invocation:this._isInvocationMessage(o);break;case U.StreamItem:this._isStreamItemMessage(o);break;case U.Completion:this._isCompletionMessage(o);break;case U.Ping:break;case U.Close:break;case U.Ack:this._isAckMessage(o);break;case U.Sequence:this._isSequenceMessage(o);break;default:s.log(w.Information,"Unknown message type '"+o.type+"' ignored.");continue}n.push(o)}return n}writeMessage(t){return we.write(JSON.stringify(t))}_isInvocationMessage(t){this._assertNotEmptyString(t.target,"Invalid payload for Invocation message."),t.invocationId!==void 0&&this._assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(t){if(this._assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),t.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this._assertNotEmptyString(t.error,"Invalid payload for Completion message."),this._assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}_isAckMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(t,s){if(typeof t!="string"||t==="")throw new Error(s)}}const zn={trace:w.Trace,debug:w.Debug,info:w.Information,information:w.Information,warn:w.Warning,warning:w.Warning,error:w.Error,critical:w.Critical,none:w.None};function Bn(a){const t=zn[a.toLowerCase()];if(typeof t<"u")return t;throw new Error(`Unknown log level: ${a}`)}class Wn{configureLogging(t){if(ee.isRequired(t,"logging"),qn(t))this.logger=t;else if(typeof t=="string"){const s=Bn(t);this.logger=new wt(s)}else this.logger=new wt(t);return this}withUrl(t,s){return ee.isRequired(t,"url"),ee.isNotEmpty(t,"url"),this.url=t,typeof s=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...s}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:s},this}withHubProtocol(t){return ee.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new rs(t):this.reconnectPolicy=t:this.reconnectPolicy=new rs,this}withServerTimeout(t){return ee.isRequired(t,"milliseconds"),this._serverTimeoutInMilliseconds=t,this}withKeepAliveInterval(t){return ee.isRequired(t,"milliseconds"),this._keepAliveIntervalInMilliseconds=t,this}withStatefulReconnect(t){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=t==null?void 0:t.bufferSize,this}build(){const t=this.httpConnectionOptions||{};if(t.logger===void 0&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const s=new Fn(this.url,t);return Ut.create(s,this.logger||tt.instance,this.protocol||new Hn,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function qn(a){return a.log!==void 0}class Vn{constructor(t="http://localhost:7071"){B(this,"connection",null);B(this,"sessionId",null);B(this,"onAgentMessageHandler");B(this,"onHandoffHandler");B(this,"onAgentTypingHandler");B(this,"onSessionStatusHandler");B(this,"onErrorHandler");this.baseUrl=t,this.setupConnection()}setupConnection(){this.connection=new Wn().withUrl(`${this.baseUrl}/api`).withAutomaticReconnect().configureLogging(w.Information).build(),this.connection.on("AgentMessage",t=>{var s;console.log("Received agent message:",t),(s=this.onAgentMessageHandler)==null||s.call(this,t)}),this.connection.on("AgentHandoff",t=>{var s;console.log("Received handoff notification:",t),(s=this.onHandoffHandler)==null||s.call(this,t)}),this.connection.on("AgentTyping",t=>{var s;console.log("Received typing notification:",t),(s=this.onAgentTypingHandler)==null||s.call(this,t)}),this.connection.on("SessionStatus",t=>{var s;console.log("Received session status:",t),(s=this.onSessionStatusHandler)==null||s.call(this,t)}),this.connection.onreconnecting(()=>{console.log("SignalR reconnecting...")}),this.connection.onreconnected(()=>{console.log("SignalR reconnected"),this.sessionId&&this.joinSession(this.sessionId)}),this.connection.onclose(t=>{var s;console.error("SignalR connection closed:",t),(s=this.onErrorHandler)==null||s.call(this,`Connection closed: ${(t==null?void 0:t.message)||"Unknown error"}`)})}async start(){if(!this.connection)throw new Error("SignalR connection not initialized");try{await this.connection.start(),console.log("SignalR connection started")}catch(t){throw console.error("Error starting SignalR connection:",t),t}}async stop(){this.connection&&this.connection.state===V.Connected&&(await this.connection.stop(),console.log("SignalR connection stopped"))}async joinSession(t){if(!this.connection||this.connection.state!==V.Connected)throw new Error("SignalR connection is not active");try{this.sessionId=t,await this.connection.invoke("JoinSession",t),console.log(`Joined session: ${t}`)}catch(s){throw console.error("Error joining session:",s),s}}async sendUserMessage(t){if(!this.connection||this.connection.state!==V.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)throw new Error("No active session");try{await this.connection.invoke("SendUserMessage",this.sessionId,t),console.log("User message sent:",t)}catch(s){throw console.error("Error sending user message:",s),s}}async getSessionStatus(){if(!this.connection||this.connection.state!==V.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)return null;try{return await this.connection.invoke("GetSessionStatus",this.sessionId)}catch(t){throw console.error("Error getting session status:",t),t}}onAgentMessage(t){this.onAgentMessageHandler=t}onAgentHandoff(t){this.onHandoffHandler=t}onAgentTyping(t){this.onAgentTypingHandler=t}onSessionStatus(t){this.onSessionStatusHandler=t}onError(t){this.onErrorHandler=t}get connectionState(){var t;return((t=this.connection)==null?void 0:t.state)||V.Disconnected}get isConnected(){var t;return((t=this.connection)==null?void 0:t.state)===V.Connected}get currentSessionId(){return this.sessionId}dispose(){this.stop(),this.connection=null,this.sessionId=null,this.onAgentMessageHandler=void 0,this.onHandoffHandler=void 0,this.onAgentTypingHandler=void 0,this.onSessionStatusHandler=void 0,this.onErrorHandler=void 0}}const be=new Vn,Gn=()=>{const[a,t]=h.useState(V.Disconnected),[s,r]=h.useState(!1),[n,i]=h.useState(null),[o,l]=h.useState(null),[u,d]=h.useState(null),[g,k]=h.useState([]),[N,R]=h.useState([]),[I,E]=h.useState({}),S=h.useRef(!1);h.useEffect(()=>{if(S.current)return;S.current=!0,be.onAgentMessage(f=>{k(c=>[...c,f])}),be.onAgentHandoff(f=>{R(c=>[...c,f])}),be.onAgentTyping(f=>{E(c=>({...c,[f.agentName]:f.isTyping}))}),be.onSessionStatus(f=>{d(f)}),be.onError(f=>{i(f)});const m=setInterval(()=>{const f=be.connectionState;t(f),r(f===V.Connected)},1e3);return()=>{clearInterval(m),be.dispose()}},[]);const v=h.useCallback(async()=>{try{i(null),await be.start(),r(!0)}catch(m){const f=m instanceof Error?m.message:"Failed to connect";throw i(f),m}},[]),A=h.useCallback(async()=>{try{await be.stop(),r(!1),l(null),d(null)}catch(m){const f=m instanceof Error?m.message:"Failed to disconnect";throw i(f),m}},[]),q=h.useCallback(async m=>{try{i(null),await be.joinSession(m),l(m);const f=await be.getSessionStatus();d(f)}catch(f){const c=f instanceof Error?f.message:"Failed to join session";throw i(c),f}},[]),M=h.useCallback(async m=>{try{i(null),await be.sendUserMessage(m)}catch(f){const c=f instanceof Error?f.message:"Failed to send message";throw i(c),f}},[]),P=h.useCallback(()=>{k([]),R([]),E({})},[]),y=h.useCallback(async()=>{try{const m=await be.getSessionStatus();d(m)}catch(m){const f=m instanceof Error?m.message:"Failed to refresh session status";throw i(f),m}},[]);return{connectionState:a,isConnected:s,error:n,sessionId:o,sessionStatus:u,agentMessages:g,handoffNotifications:N,agentTyping:I,connect:v,disconnect:A,joinSession:q,sendMessage:M,clearMessages:P,refreshSessionStatus:y}},Yn=({volume:a,isVoiceActive:t,isListening:s,size:r="md",className:n=""})=>{const i={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},o=r==="sm"?3:r==="md"?5:7,l=r==="sm"?16:r==="md"?24:32,u=Math.min(a/100,1);return e.jsx("div",{className:`flex items-center justify-center ${i[r]} ${n}`,children:e.jsx("div",{className:"flex items-end space-x-1 h-full",children:Array.from({length:o}).map((d,g)=>{const k=g/o,N=s&&(t||g===0),R=u>k,I=N&&R?Math.max(4,u*l):4,E=g*100;return e.jsx("div",{className:`w-1 transition-all duration-150 rounded-sm voice-bar ${N?R?"bg-green-500 animate-pulse":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700"}`,"data-height":I,"data-delay":E},g)})})})},Kn=({config:a,availableVoices:t,selectedVoice:s,onConfigUpdate:r,onVoiceSelect:n,isOpen:i,onClose:o})=>{const[l,u]=h.useState(a),d=(k,N)=>{const R={...l,[k]:N};u(R),r({[k]:N})},g=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French (France)"},{code:"de-DE",name:"German (Germany)"},{code:"it-IT",name:"Italian (Italy)"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"}];return i?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"speech-settings-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-full p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:o}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(vs,{className:"h-6 w-6 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{id:"speech-settings-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Speech Settings"})]}),e.jsxs("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Close settings",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ws,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Recognition"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(ua,{className:"inline h-4 w-4 mr-1"}),"Language"]}),e.jsx("select",{value:l.language,onChange:k=>d("language",k.target.value),title:"Select language for speech recognition",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:g.map(k=>e.jsx("option",{value:k.code,children:k.name},k.code))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recognition Alternatives"}),e.jsxs("select",{value:l.maxAlternatives,onChange:k=>d("maxAlternatives",parseInt(k.target.value)),title:"Select number of recognition alternatives",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:1,children:"1 (fastest)"}),e.jsx("option",{value:2,children:"2 (balanced)"}),e.jsx("option",{value:3,children:"3 (best accuracy)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.continuous,onChange:k=>d("continuous",k.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Continuous listening (auto-restart)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.interimResults,onChange:k=>d("interimResults",k.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Show interim results (real-time transcription)"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Audio Processing"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.noiseReduction,onChange:k=>d("noiseReduction",k.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.echoCancellation,onChange:k=>d("echoCancellation",k.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Echo cancellation"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:l.audioTracks,onChange:k=>d("audioTracks",k.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Enhanced audio processing"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(et,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Synthesis"})]}),e.jsxs("button",{onClick:()=>window.speechSynthesis.getVoices(),className:"flex items-center space-x-1 px-3 py-1 text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",title:"Refresh available voices",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Selection"}),e.jsxs("select",{value:(s==null?void 0:s.name)||"",onChange:k=>{const N=t.find(R=>R.name===k.target.value);N&&n(N)},title:"Select voice for speech synthesis",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Default system voice"}),t.map((k,N)=>e.jsxs("option",{value:k.name,children:[k.name," (",k.lang,") ",k.default?"(Default)":""]},N))]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[t.length," voices available"]})]}),s&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>{const k=new SpeechSynthesisUtterance("Hello! This is a test of the selected voice.");k.voice=s,window.speechSynthesis.speak(k)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-800 dark:text-primary-200 dark:hover:bg-primary-700",children:[e.jsx(et,{className:"h-4 w-4 mr-1"}),"Test Voice"]})})]})]}),e.jsx("div",{className:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",children:"Close"})})]})]})}):null},Jn=()=>{const{handleEnterSpace:a}=ms(),[t,s]=h.useState([]),[r,n]=h.useState(""),[i,o]=h.useState(!1),[l,u]=h.useState({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),[d,g]=h.useState(!1),[k,N]=h.useState(!1),[R,I]=h.useState(),E=h.useRef(null),S=h.useRef(null),v=Gn(),A=cn({config:{continuous:!0,interimResults:!0,language:"en-US",maxAlternatives:2},onFinalResult:c=>{c.length>0&&c[0].transcript.trim()&&(n(c[0].transcript.trim()),de(`Voice input captured: ${c[0].transcript}`))},onVoiceActivity:c=>{},onError:c=>{console.error("Advanced speech error:",c),de("Voice input error occurred")}});h.useEffect(()=>{var c;(c=E.current)==null||c.scrollIntoView({behavior:"smooth"})},[t]),h.useEffect(()=>((async()=>{try{v.isConnected||(await v.connect(),de("Connected to real-time communication"));const x=`session-${Date.now()}`;await v.joinSession(x),de("Joined communication session")}catch(x){console.error("Failed to initialize SignalR:",x),de("Failed to connect to real-time communication")}})(),()=>{v.disconnect()}),[v]),h.useEffect(()=>{if(v.agentMessages.length>0){const c=v.agentMessages[v.agentMessages.length-1],x={id:`signalr-${Date.now()}`,content:c.content,role:"assistant",timestamp:new Date(c.timestamp)};s(b=>b.some(z=>z.content===x.content&&Math.abs(z.timestamp.getTime()-x.timestamp.getTime())<1e3)?b:[...b,x]),u(b=>({...b,name:c.agentName,id:c.agentName.toLowerCase().replace(/\s+/g,"-"),isTyping:!1})),M(c.content),de(`Message from ${c.agentName}: ${c.content}`)}},[v.agentMessages]),h.useEffect(()=>{if(v.handoffNotifications.length>0){const c=v.handoffNotifications[v.handoffNotifications.length-1];u(b=>({...b,name:c.toAgent,id:c.toAgent.toLowerCase().replace(/\s+/g,"-"),isTyping:!1}));const x={id:`handoff-${Date.now()}`,content:`Agent handoff: ${c.reason}. You are now speaking with ${c.toAgent}.`,role:"assistant",timestamp:new Date(c.timestamp)};s(b=>[...b,x]),de(`Agent handoff: You are now speaking with ${c.toAgent}`)}},[v.handoffNotifications]),h.useEffect(()=>{Object.keys(v.agentTyping).filter(x=>v.agentTyping[x]).length>0?u(x=>({...x,isTyping:!0})):u(x=>({...x,isTyping:!1}))},[v.agentTyping]),h.useEffect(()=>{s([{id:"1",content:"Hello! I'm your behavioral health assistant. I can help you with depression screenings, provide support, or just have a friendly conversation. What would you like to explore today?",role:"assistant",timestamp:new Date}])},[]);const q=async()=>{try{A.isListening?(A.stopListening(),de("Voice input stopped")):(await A.startListening(),de("Voice input started"))}catch(c){console.error("Error toggling speech:",c),de("Error with voice input")}},M=async c=>{if(d&&A.isAvailable)try{await A.speak(c,{rate:.9,pitch:1,volume:.8,voice:R,interrupt:!0})}catch(x){console.error("Error speaking message:",x)}},P=()=>{g(!d),d?(de("Audio output disabled"),A.isAvailable&&window.speechSynthesis&&window.speechSynthesis.cancel()):de("Audio output enabled")},y=async()=>{if(!r.trim()||i)return;const c={id:Date.now().toString(),content:r.trim(),role:"user",timestamp:new Date};s(b=>[...b,c]);const x=r.trim();n(""),o(!0),u(b=>({...b,isTyping:!0}));try{if(v.isConnected){const b={content:x,timestamp:new Date().toISOString(),metadata:{speechConfidence:1,voiceActivityLevel:A.volume,processingTime:0}};await v.sendMessage(b),de("Message sent to agent")}else{await new Promise(X=>setTimeout(X,1e3+Math.random()*2e3));let b="I understand what you're saying. Let me help you with that.",_=l.id,z=l.name;const J=x.toLowerCase();J.includes("phq")||J.includes("depression")||J.includes("screening")?(b="I can help you with a depression screening. I'll start with the PHQ-2, which is a quick 2-question assessment. This will help determine if a more comprehensive evaluation might be helpful. Shall we begin?",_="phq2",z="PHQ-2 Agent"):J.includes("joke")||J.includes("funny")||J.includes("humor")?(b="Hey there! ðŸ˜„ I'm here to brighten your day with some wholesome humor! I can share clean jokes, funny stories, or just have some playful banter. What sounds good to you?",_="comedian",z="Comedy Agent"):(J.includes("crisis")||J.includes("emergency")||J.includes("help"))&&(b="I'm here to help. If you're experiencing a mental health crisis, please reach out for immediate support: Call 988 (Suicide & Crisis Lifeline) or contact your local emergency services. I'm also here to provide support and connect you with appropriate resources.");const ve={id:(Date.now()+1).toString(),content:b,role:"assistant",timestamp:new Date};s(X=>[...X,ve]),_!==l.id&&(u({id:_,name:z,isActive:!0,isTyping:!1}),de(`Agent changed to ${z}`)),M(b)}}catch(b){console.error("Error sending message:",b);const _={id:(Date.now()+1).toString(),content:"I'm sorry, I encountered an error processing your message. Please try again.",role:"assistant",timestamp:new Date};s(z=>[...z,_]),de("Error sending message")}finally{o(!1),v.isConnected||u(b=>({...b,isTyping:!1}))}},m=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),y())},f=()=>{s([]),u({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),de("Conversation cleared")};return e.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${l.isTyping?"bg-primary-500 animate-pulse":l.isActive?"bg-green-500":"bg-gray-400"}`,children:e.jsx("span",{className:"text-white text-lg",children:"ðŸ¤–"})}),l.isActive&&e.jsx("div",{className:"absolute -inset-1 rounded-full bg-green-400 opacity-30 animate-ping"}),A.isListening&&e.jsx("div",{className:"absolute -bottom-1 -right-1",children:e.jsx(Yn,{volume:A.volume,isVoiceActive:A.isVoiceActive,isListening:A.isListening,size:"sm"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Agent Experience"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Current Agent: ",l.name,l.isTyping&&e.jsx("span",{className:"ml-2 text-primary-600 dark:text-primary-400",children:e.jsx("span",{className:"animate-pulse",children:"Typing..."})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-xs ${v.isConnected?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:v.isConnected?"Connected":"Offline"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>N(!0),onKeyDown:a(()=>N(!0)),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Open speech settings",title:"Speech settings",children:e.jsx(vs,{size:20})}),e.jsx("button",{onClick:P,onKeyDown:a(P),className:`p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${d?"bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,"aria-label":`${d?"Disable":"Enable"} audio output`,title:`${d?"Disable":"Enable"} audio output`,children:d?e.jsx(et,{size:20}):e.jsx(Ha,{size:20})}),e.jsx("button",{onClick:f,onKeyDown:a(f),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Clear conversation",title:"Clear conversation",children:e.jsx(Je,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.map(c=>e.jsx("div",{className:`flex ${c.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${c.role==="user"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("p",{className:"text-sm",children:c.content}),e.jsx("p",{className:`text-xs mt-1 opacity-70 ${c.role==="user"?"text-primary-200":"text-gray-500 dark:text-gray-400"}`,children:c.timestamp.toLocaleTimeString()})]})},c.id)),l.isTyping&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"})]})})}),e.jsx("div",{ref:E})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-end space-x-2",children:[A.isAvailable&&e.jsx("button",{onClick:q,onKeyDown:a(q),disabled:i,className:`p-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${A.isListening?"bg-red-600 text-white hover:bg-red-700":"bg-primary-600 text-white hover:bg-primary-700 disabled:bg-gray-400"}`,"aria-label":A.isListening?"Stop voice input":"Start voice input",title:A.isListening?"Stop voice input":"Start voice input",children:A.isListening?e.jsx(ya,{size:20}):e.jsx(ws,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{ref:S,value:r,onChange:c=>n(c.target.value),onKeyPress:m,placeholder:"Type your message here or use voice input...",disabled:i,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-700 min-h-[44px] max-h-[120px]",rows:1,"aria-label":"Message input"})}),e.jsx("button",{onClick:y,onKeyDown:a(y),disabled:!r.trim()||i,className:"p-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Send message",title:"Send message",children:e.jsx(Ca,{size:20})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[A.isListening&&e.jsxs("span",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Listening..."})]}),A.isVoiceActive&&e.jsxs("span",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Voice detected"})]}),A.isAvailable&&e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Voice input available"}),A.error&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Speech error: ",A.error]}),v.error&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Connection error: ",v.error]}),d&&e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Audio output enabled"}),v.sessionId&&e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Session: ",v.sessionId.slice(-8)]})]}),e.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"})]})]}),e.jsx(Kn,{config:{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:2,audioTracks:!0,noiseReduction:!0,echoCancellation:!0},availableVoices:A.availableVoices,selectedVoice:R,onConfigUpdate:c=>A.updateConfig(c),onVoiceSelect:c=>I(c),isOpen:k,onClose:()=>N(!1)})]})},Xn=()=>{const{data:a,isLoading:t,error:s,refetch:r}=Cs(),{announce:n}=gs();cs.useEffect(()=>{n("System Health page loaded","polite")},[n]);const i=d=>{if(!d)return"Just now";try{const g=new Date(d);return isNaN(g.getTime())?"Just now":g.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},o=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},l=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"âœ…";case"degraded":return"âš ï¸";case"unhealthy":return"âŒ";default:return"â“"}},u=d=>{const g="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(d==null?void 0:d.toLowerCase()){case"healthy":return`${g} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${g} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${g} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${g} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),e.jsxs("button",{type:"button",onClick:()=>r(),disabled:t,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[e.jsx(se,{className:`w-4 h-4 ${t?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]}),t&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{className:"w-6 h-6 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),s&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"w-6 h-6 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:s.message||"Unable to retrieve system health status"}),e.jsx("button",{type:"button",onClick:()=>r(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),a&&!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),e.jsxs("div",{className:u(a.status),children:[e.jsx("span",{className:"mr-1",children:l(a.status)}),a.status]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:l(a.status)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("div",{className:`font-medium ${o(a.status)}`,children:a.status})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"â±ï¸"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.totalDuration?`${a.totalDuration}ms`:"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“…"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:i(a.timestamp)})]})]})]}),a.checks&&Object.keys(a.checks).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ze,{className:"w-5 h-5 mr-2"}),"Service Details"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(a.checks).map(([d,g])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:l(g.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.replace(/-/g," ")}),g.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:g.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[g.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g.duration,"ms"]}),e.jsx("div",{className:u(g.status),children:g.status})]})]},d))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Rt,{className:"w-5 h-5 mr-2"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},Zn=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),e.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),Qn=new Fs({defaultOptions:{queries:{retry:(a,t)=>{if(t&&typeof t=="object"&&"code"in t){const s=t.code;if(s!=null&&s.startsWith("HTTP_4")&&s!=="HTTP_408")return!1}return a<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}});function ei(){return e.jsxs(Os,{client:Qn,children:[e.jsx(nr,{children:e.jsx(yr,{children:e.jsx(Sr,{children:e.jsx(zs,{children:e.jsx(Er,{children:e.jsxs(Bs,{children:[e.jsx(Ae,{path:"/",element:e.jsxs(Ie,{requireRoles:[ne.ADMIN,ne.CONTROL_PANEL],children:[e.jsx(vr,{}),e.jsx(Wa,{})]})}),e.jsx(Ae,{path:"/upload",element:e.jsx(Ie,{requireRoles:[ne.ADMIN],children:e.jsx(Ka,{})})}),e.jsx(Ae,{path:"/sessions",element:e.jsx(Ie,{requireRoles:[ne.ADMIN],children:e.jsx(Ja,{})})}),e.jsx(Ae,{path:"/sessions/:sessionId",element:e.jsx(Ie,{requireRoles:[ne.ADMIN],children:e.jsx(Qa,{})})}),e.jsx(Ae,{path:"/predictions",element:e.jsx(Ie,{requireRoles:[ne.ADMIN],children:e.jsx(en,{})})}),e.jsx(Ae,{path:"/summary",element:e.jsx(Ie,{requireRoles:[ne.ADMIN,ne.CONTROL_PANEL],children:e.jsx(on,{})})}),e.jsx(Ae,{path:"/agent-experience",element:e.jsx(Ie,{requireRoles:[ne.ADMIN,ne.CONTROL_PANEL],children:e.jsx(Jn,{})})}),e.jsx(Ae,{path:"/health",element:e.jsx(Ie,{requireRoles:[ne.ADMIN],children:e.jsx(Xn,{})})}),e.jsx(Ae,{path:"*",element:e.jsx(Zn,{})})]})})})})})}),!1]})}const is=localStorage.getItem("bh_theme"),ti=window.matchMedia("(prefers-color-scheme: dark)").matches,si=is==="dark"||!is&&ti;si?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");Et.createRoot(document.getElementById("root")).render(e.jsx(cs.StrictMode,{children:e.jsx(ei,{})}));
//# sourceMappingURL=index-0b7c6aaa.js.map
