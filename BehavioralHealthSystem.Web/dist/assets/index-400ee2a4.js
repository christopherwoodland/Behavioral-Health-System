var Xl=Object.defineProperty;var Zl=(n,e,t)=>e in n?Xl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var se=(n,e,t)=>(Zl(n,typeof e!="symbol"?e+"":e,t),t);import{j as s,u as ma,Q as ed,a as td}from"./query-7a13343f.js";import{a as rd,r as m,R as zt,u as Us,N as pa,b as Fn,L as Ne,c as sd,B as nd,d as id,e as yt}from"./vendor-b4aac61f.js";import{F as od,t as lo,f as ad}from"./ffmpeg-c0c62554.js";import{B as cd,e as ld}from"./azure-e79d136e.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var xn={},ho=rd;xn.createRoot=ho.createRoot,xn.hydrateRoot=ho.hydrateRoot;let Yr;const dd=new Uint8Array(16);function hd(){if(!Yr&&(Yr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Yr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yr(dd)}const Re=[];for(let n=0;n<256;++n)Re.push((n+256).toString(16).slice(1));function ud(n,e=0){return Re[n[e+0]]+Re[n[e+1]]+Re[n[e+2]]+Re[n[e+3]]+"-"+Re[n[e+4]]+Re[n[e+5]]+"-"+Re[n[e+6]]+Re[n[e+7]]+"-"+Re[n[e+8]]+Re[n[e+9]]+"-"+Re[n[e+10]]+Re[n[e+11]]+Re[n[e+12]]+Re[n[e+13]]+Re[n[e+14]]+Re[n[e+15]]}const gd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),uo={randomUUID:gd};function md(n,e,t){if(uo.randomUUID&&!e&&!n)return uo.randomUUID();n=n||{};const r=n.random||(n.rng||hd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return ud(r)}const sr={api:{baseUrl:{}.VITE_API_BASE||"http://localhost:7071/api"},azure:{blobSasUrl:{}.VITE_AZURE_BLOB_SAS_URL||"",containerName:{}.VITE_STORAGE_CONTAINER_NAME||"audio-uploads"},polling:{intervalMs:parseInt({}.VITE_POLL_INTERVAL_MS||"3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:{}.VITE_ENABLE_FFMPEG_WORKER==="true",enableDebugLogging:{}.VITE_ENABLE_DEBUG_LOGGING==="true"},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},cr={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},wr={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},Sr={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300};let bn=null;const go=n=>{bn=n},vt=()=>{if(bn)return bn;let n=localStorage.getItem(cr.USER_ID);return(!n||n.trim().length===0)&&(n=md(),localStorage.setItem(cr.USER_ID,n)),n},pd=()=>{const n=localStorage.getItem(cr.THEME);return n==="light"||n==="dark"?n:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},mo=n=>{localStorage.setItem(cr.THEME,n),n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},fd=()=>{const n=localStorage.getItem(cr.PROCESSING_MODE);return n==="true"||n==="false"?n==="true":!1},yd=n=>{localStorage.setItem(cr.PROCESSING_MODE,n.toString())},jr=n=>{const e=new Date,t=new Date(n),r=e.getTime()-t.getTime(),i=Math.floor(r/(1e3*60)),o=Math.floor(r/(1e3*60*60)),a=Math.floor(r/(1e3*60*60*24));return i<1?"Just now":i<60?`${i}m ago`:o<24?`${o}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()},nr=n=>new Date(n).toLocaleString(),He=(n,e,t)=>({code:n,message:e,details:t,timestamp:new Date().toISOString()}),xd=n=>n instanceof TypeError&&n.message.includes("fetch")?!0:n instanceof Error?n.message.includes("Network")||n.message.includes("connection")||n.message.includes("timeout"):!1,je=(n,e="polite")=>{const t=document.createElement("div");t.setAttribute("aria-live",e),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=n,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)},bd=(n,e=100)=>{setTimeout(()=>{const t=document.getElementById(n);t&&t.focus()},e)},fa=m.createContext(void 0),wd=()=>{const n=m.useContext(fa);if(n===void 0)throw new Error("useTheme must be used within a ThemeProvider");return n},vd=({children:n})=>{const[e,t]=m.useState(pd),r=a=>{t(a),mo(a)},i=()=>{r(e==="light"?"dark":"light")};m.useEffect(()=>{mo(e)},[e]),m.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),c=l=>{localStorage.getItem("bh_theme")||t(l.matches?"dark":"light")};return a.addEventListener("change",c),()=>a.removeEventListener("change",c)},[]);const o={theme:e,toggleTheme:i,setTheme:r};return s.jsx(fa.Provider,{value:o,children:n})};/*! @azure/msal-common v15.12.0 2025-08-19 */const T={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Et={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Ft={GET:"GET",POST:"POST"},ur=[T.OPENID_SCOPE,T.PROFILE_SCOPE,T.OFFLINE_ACCESS_SCOPE],po=[...ur,T.EMAIL_SCOPE],Ue={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},fo={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Rt={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Jr={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Fe={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},$n={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},Hs={QUERY:"query",FRAGMENT:"fragment"},kd={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},ya={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Xr={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Pr={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},Oe={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Bn="appmetadata",Cd="client_info",ms="1",ps={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Ye={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Pe={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},ce={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},_r={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},yo={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Zt={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},on={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Ht={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Sd={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},xa=300;/*! @azure/msal-common v15.12.0 2025-08-19 */const fs="unexpected_error",_d="post_request_failed";/*! @azure/msal-common v15.12.0 2025-08-19 */const xo={[fs]:"Unexpected error in authentication.",[_d]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class de extends Error{constructor(e,t,r){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,de.prototype),this.errorCode=e||T.EMPTY_STRING,this.errorMessage=t||T.EMPTY_STRING,this.subError=r||T.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function wn(n,e){return new de(n,e?`${xo[n]} ${e}`:xo[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */const Kn="client_info_decoding_error",ba="client_info_empty_error",zn="token_parsing_error",wa="null_or_empty_token",wt="endpoints_resolution_error",va="network_error",ka="openid_config_error",Ca="hash_not_deserialized",lr="invalid_state",Sa="state_mismatch",vn="state_not_found",_a="nonce_mismatch",Gn="auth_time_not_found",Aa="max_age_transpired",Ad="multiple_matching_tokens",Id="multiple_matching_accounts",Ia="multiple_matching_appMetadata",Ta="request_cannot_be_made",Na="cannot_remove_empty_scope",Ea="cannot_append_scopeset",kn="empty_input_scopeset",Td="device_code_polling_cancelled",Nd="device_code_expired",Ed="device_code_unknown_error",qn="no_account_in_silent_request",Ra="invalid_cache_record",Vn="invalid_cache_environment",Cn="no_account_found",Sn="no_crypto_object",Rd="unexpected_credential_type",jd="invalid_assertion",Pd="invalid_client_credential",jt="token_refresh_required",Od="user_timeout_reached",ja="token_claims_cnf_required_for_signedjwt",Pa="authorization_code_missing_from_server_response",Oa="binding_key_not_removed",Ma="end_session_endpoint_not_supported",Wn="key_id_missing",Md="no_network_connectivity",Dd="user_canceled",Ld="missing_tenant_id_error",te="method_not_implemented",Ud="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.12.0 2025-08-19 */const bo={[Kn]:"The client info could not be parsed/decoded correctly",[ba]:"The client info was empty",[zn]:"Token cannot be parsed",[wa]:"The token is null or empty",[wt]:"Endpoints cannot be resolved",[va]:"Network request failed",[ka]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Ca]:"The hash parameters could not be deserialized",[lr]:"State was not the expected format",[Sa]:"State mismatch error",[vn]:"State not found",[_a]:"Nonce mismatch error",[Gn]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Aa]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Ad]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Id]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Ia]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[Ta]:"Token request cannot be made without authorization code or refresh token.",[Na]:"Cannot remove null or empty scope from ScopeSet",[Ea]:"Cannot append ScopeSet",[kn]:"Empty input ScopeSet cannot be processed",[Td]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Nd]:"Device code is expired.",[Ed]:"Device code stopped polling for unknown reasons.",[qn]:"Please pass an account object, silent flow is not supported without account information",[Ra]:"Cache record object was null or undefined.",[Vn]:"Invalid environment when attempting to create cache entry",[Cn]:"No account found in cache for given key.",[Sn]:"No crypto object detected.",[Rd]:"Unexpected credential type.",[jd]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Pd]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[jt]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Od]:"User defined timeout for device code polling reached",[ja]:"Cannot generate a POP jwt if the token_claims are not populated",[Pa]:"Server response does not contain an authorization code to proceed",[Oa]:"Could not remove the credential's binding key from storage.",[Ma]:"The provided authority does not support logout",[Wn]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Md]:"No network connectivity. Check your internet connection.",[Dd]:"User cancelled the flow.",[Ld]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[te]:"This method has not been implemented",[Ud]:"The nested app auth bridge is disabled"};class Qn extends de{constructor(e,t){super(e,t?`${bo[e]}: ${t}`:bo[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Qn.prototype)}}function R(n,e){return new Qn(n,e)}/*! @azure/msal-common v15.12.0 2025-08-19 */const ys={createNewGuid:()=>{throw R(te)},base64Decode:()=>{throw R(te)},base64Encode:()=>{throw R(te)},base64UrlEncode:()=>{throw R(te)},encodeKid:()=>{throw R(te)},async getPublicKeyThumbprint(){throw R(te)},async removeTokenBindingKey(){throw R(te)},async clearKeystore(){throw R(te)},async signJwt(){throw R(te)},async hashString(){throw R(te)}};/*! @azure/msal-common v15.12.0 2025-08-19 */var me;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(me||(me={}));class Ct{constructor(e,t,r){this.level=me.Info;const i=()=>{},o=e||Ct.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||i,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:me.Info,this.correlationId=o.correlationId||T.EMPTY_STRING,this.packageName=t||T.EMPTY_STRING,this.packageVersion=r||T.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:me.Info}}clone(e,t,r){return new Ct({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const o=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${me[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:me.Error,containsPii:!1,correlationId:t||T.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:me.Error,containsPii:!0,correlationId:t||T.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:me.Warning,containsPii:!1,correlationId:t||T.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:me.Warning,containsPii:!0,correlationId:t||T.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:me.Info,containsPii:!1,correlationId:t||T.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:me.Info,containsPii:!0,correlationId:t||T.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:me.Verbose,containsPii:!1,correlationId:t||T.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:me.Verbose,containsPii:!0,correlationId:t||T.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:me.Trace,containsPii:!1,correlationId:t||T.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:me.Trace,containsPii:!0,correlationId:t||T.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Da="@azure/msal-common",Yn="15.12.0";/*! @azure/msal-common v15.12.0 2025-08-19 */const Jn={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.12.0 2025-08-19 */const La="redirect_uri_empty",Hd="claims_request_parsing_error",Ua="authority_uri_insecure",kr="url_parse_error",Ha="empty_url_error",Fa="empty_input_scopes_error",Xn="invalid_claims",$a="token_request_empty",Ba="logout_request_empty",Fd="invalid_code_challenge_method",Zn="pkce_params_missing",ei="invalid_cloud_discovery_metadata",Ka="invalid_authority_metadata",za="untrusted_authority",Fs="missing_ssh_jwk",Ga="missing_ssh_kid",$d="missing_nonce_authentication_header",Bd="invalid_authentication_header",qa="cannot_set_OIDCOptions",Va="cannot_allow_platform_broker",Wa="authority_mismatch",Qa="invalid_request_method_for_EAR",Ya="invalid_authorize_post_body_parameters";/*! @azure/msal-common v15.12.0 2025-08-19 */const Kd={[La]:"A redirect URI is required for all calls, and none has been set.",[Hd]:"Could not parse the given claims request object.",[Ua]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[kr]:"URL could not be parsed into appropriate segments.",[Ha]:"URL was empty or null.",[Fa]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Xn]:"Given claims parameter must be a stringified JSON object.",[$a]:"Token request was empty and not found in cache.",[Ba]:"The logout request was null or undefined.",[Fd]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Zn]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[ei]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Ka]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[za]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Fs]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Ga]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[$d]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Bd]:"Invalid authentication header provided",[qa]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Va]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[Wa]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[Ya]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[Qa]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};class ti extends de{constructor(e){super(e,Kd[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ti.prototype)}}function ue(n){return new ti(n)}/*! @azure/msal-common v15.12.0 2025-08-19 */class Xe{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),i=o=>decodeURIComponent(o.replace(/\+/g," "));return r.forEach(o=>{if(o.trim()){const[a,c]=o.split(/=(.+)/g,2);a&&c&&(t[i(a)]=i(c))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class ke{constructor(e){const t=e?Xe.trimArrayEntries([...e]):[],r=t?Xe.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw ue(Fa);this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){const r=(e||T.EMPTY_STRING).split(" ");return new ke(r)}static createSearchScopes(e){const t=e&&e.length>0?e:[...ur],r=new ke(t);return r.containsOnlyOIDCScopes()?r.removeScope(T.OFFLINE_ACCESS_SCOPE):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new ke(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return po.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw R(Ea)}}removeScope(e){if(!e)throw R(Na);this.scopes.delete(e.trim())}removeOIDCScopes(){po.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw R(kn);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw R(kn);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):T.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.12.0 2025-08-19 */function wo(n,e){return!!n&&!!e&&n===e.split(".")[1]}function ri(n,e,t,r){if(r){const{oid:i,sub:o,tid:a,name:c,tfp:l,acr:d,preferred_username:h,upn:u,login_hint:y}=r,x=a||l||d||"";return{tenantId:x,localAccountId:i||o||"",name:c,username:h||u||"",loginHint:y,isHomeTenant:wo(x,n)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:wo(t,n)}}function si(n,e,t,r){let i=n;if(e){const{isHomeTenant:o,...a}=e;i={...n,...a}}if(t){const{isHomeTenant:o,...a}=ri(n.homeAccountId,n.localAccountId,n.tenantId,t);return i={...i,...a,idTokenClaims:t,idToken:r},i}return i}/*! @azure/msal-common v15.12.0 2025-08-19 */function gr(n,e){const t=zd(n);try{const r=e(t);return JSON.parse(r)}catch{throw R(zn)}}function zd(n){if(!n)throw R(wa);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw R(zn);return t[2]}function Ja(n,e){if(e===0||Date.now()-3e5>n+e)throw R(Aa)}/*! @azure/msal-common v15.12.0 2025-08-19 */function vo(n){if(!n)return n;let e=n.toLowerCase();return Xe.endsWith(e,"?")?e=e.slice(0,-1):Xe.endsWith(e,"?/")&&(e=e.slice(0,-2)),Xe.endsWith(e,"/")||(e+="/"),e}function Xa(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function xs(n){if(!n||n.indexOf("=")<0)return null;try{const e=Xa(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw R(Ca)}return null}function Or(n,e=!0,t){const r=new Array;return n.forEach((i,o)=>{!e&&t&&o in t?r.push(`${o}=${i}`):r.push(`${o}=${encodeURIComponent(i)}`)}),r.join("&")}function ko(n){if(!n)return n;const e=n.split("#")[0];try{const t=new URL(e),r=t.origin+t.pathname+t.search;return vo(r)}catch{return vo(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class oe{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw ue(Ha);e.includes("#")||(this._urlString=oe.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Xe.endsWith(t,"?")?t=t.slice(0,-1):Xe.endsWith(t,"?/")&&(t=t.slice(0,-2)),Xe.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw ue(kr)}if(!e.HostNameAndPort||!e.PathSegments)throw ue(kr);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw ue(Ua)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return oe.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Rt.COMMON||r[0]===Rt.ORGANIZATIONS)&&(r[0]=e),oe.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ue(kr);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=r.AbsolutePath.split("/");return i=i.filter(o=>o&&o.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw ue(kr);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===T.FORWARD_SLASH){const i=new oe(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new oe(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!xs(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Za={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},Co=Za.endpointMetadata,ni=Za.instanceDiscoveryMetadata,ec=new Set;ni.metadata.forEach(n=>{n.aliases.forEach(e=>{ec.add(e)})});function Gd(n,e){var i;let t;const r=n.canonicalAuthority;if(r){const o=new oe(r).getUrlComponents().HostNameAndPort;t=So(o,(i=n.cloudDiscoveryMetadata)==null?void 0:i.metadata,Ye.CONFIG,e)||So(o,ni.metadata,Ye.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function So(n,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=bs(e,n);if(i)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function qd(n){return bs(ni.metadata,n)}function bs(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v15.12.0 2025-08-19 */const ws="cache_quota_exceeded",ii="cache_error_unknown";/*! @azure/msal-common v15.12.0 2025-08-19 */const an={[ws]:"Exceeded cache storage capacity.",[ii]:"Unexpected error occurred when using cache storage."};class ir extends de{constructor(e,t){const r=t||(an[e]?an[e]:an[ii]);super(`${e}: ${r}`),Object.setPrototypeOf(this,ir.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function _n(n){return n instanceof Error?n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"||n.message.includes("exceeded the quota")?new ir(ws):new ir(n.name,n.message):new ir(ii)}/*! @azure/msal-common v15.12.0 2025-08-19 */class An{constructor(e,t,r,i,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Da,Yn),this.staticAuthorityOptions=o,this.performanceClient=i}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(Object.keys(e).length===0||Object.values(e).every(i=>!i))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const r=this.getAllAccounts(e,t);return r.length>1?r.sort(o=>o.idTokenClaims?-1:1)[0]:r.length===1?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?r[0].getAccountInfo():null}buildTenantProfiles(e,t,r){return e.flatMap(i=>this.getTenantProfilesFromAccountEntity(i,t,r==null?void 0:r.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,i,o){let a=null,c;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;const l=this.getIdToken(e,i,t,r.tenantId);return l&&(c=gr(l.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(c,o))?null:(a=si(e,r,c,l==null?void 0:l.secret),a)}getTenantProfilesFromAccountEntity(e,t,r,i){const o=e.getAccountInfo();let a=o.tenantProfiles||new Map;const c=this.getTokenKeys();if(r){const d=a.get(r);if(d)a=new Map([[r,d]]);else return[]}const l=[];return a.forEach(d=>{const h=this.getTenantedAccountInfoByFilter(o,c,d,t,i);h&&l.push(h)}),l}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,r){var i;if(!e)throw R(Ra);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(r==null?void 0:r.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(r==null?void 0:r.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(r==null?void 0:r.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(o){throw(i=this.commonLogger)==null||i.error("CacheManager.saveCacheRecord: failed"),o instanceof de?o:_n(o)}}async saveAccessToken(e,t){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),o=ke.fromString(e.target);i.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,r,!1))return;const c=this.getAccessTokenCredential(a,t);c&&this.credentialMatchesFilter(c,r)&&ke.fromString(c.target).intersectingScopeSets(o)&&this.removeAccessToken(a,t)}),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),i=[];return r.forEach(o=>{var d;const a=this.getAccount(o,t);if(!a||e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId)||e.username&&!this.matchUsername(a.username,e.username)||e.environment&&!this.matchEnvironment(a,e.environment)||e.realm&&!this.matchRealm(a,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const c={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},l=(d=a.tenantProfiles)==null?void 0:d.filter(h=>this.tenantProfileMatchesFilter(h,c));l&&l.length===0||i.push(a)}),i}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===ce.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const o=this.getAppMetadata(i);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(r[i]=o))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const o=this.getAuthorityMetadata(i);o&&o.aliases.indexOf(e)!==-1&&(r=o)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(r=>{this.removeAccount(r,e)})}removeAccount(e,t){this.removeAccountContext(e,t);const r=this.getAccountKeys(),i=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);r.filter(i).forEach(o=>{this.removeItem(o,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const r=this.getTokenKeys(),i=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);r.idToken.filter(i).forEach(o=>{this.removeIdToken(o,t)}),r.accessToken.filter(i).forEach(o=>{this.removeAccessToken(o,t)}),r.refreshToken.filter(i).forEach(o=>{this.removeRefreshToken(o,t)})}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!r||r.credentialType.toLowerCase()!==Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||r.tokenType!==ce.POP)return;const i=r.keyId;i&&this.cryptoImpl.removeTokenBindingKey(i).catch(()=>{var o;this.commonLogger.error(`Failed to remove token binding key ${i}`,t),(o=this.performanceClient)==null||o.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(r=>{this.isAppMetadata(r)&&this.removeItem(r,e)}),!0}getIdToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getIdToken called");const a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Oe.ID_TOKEN,clientId:this.clientId,realm:i},c=this.getIdTokensByFilter(a,t,r),l=c.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let d=c;if(!i){const h=new Map;c.forEach((y,x)=>{y.realm===e.tenantId&&h.set(x,y)});const u=h.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),c.values().next().value;if(u===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;d=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),d.forEach((h,u)=>{this.removeIdToken(u,t)}),o&&t&&o.addFields({multiMatchedID:c.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),c.values().next().value}getIdTokensByFilter(e,t,r){const i=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return i.forEach(a=>{if(!this.idTokenKeyMatchesFilter(a,{clientId:this.clientId,...e}))return;const c=this.getIdTokenCredential(a,t);c&&this.credentialMatchesFilter(c,e)&&o.set(a,c)}),o}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,i){const o=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",o);const a=ke.createSearchScopes(t.scopes),c=t.authenticationScheme||ce.BEARER,l=c&&c.toLowerCase()!==ce.BEARER.toLowerCase()?Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME:Oe.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(x=>{if(this.accessTokenKeyMatchesFilter(x,d,!0)){const U=this.getAccessTokenCredential(x,o);U&&this.credentialMatchesFilter(U,d)&&u.push(U)}});const y=u.length;return y<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",o),null):y>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",o),u.forEach(x=>{this.removeAccessToken(this.generateCredentialKey(x),o)}),this.performanceClient.addFields({multiMatchedAT:u.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",o),u[0])}accessTokenKeyMatchesFilter(e,t,r){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const o=t.target.asArray();for(let a=0;a<o.length;a++){if(r&&!i.includes(o[a].toLowerCase()))return!1;if(!r&&i.includes(o[a].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),i=[];return r.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;const a=this.getAccessTokenCredential(o,t);a&&this.credentialMatchesFilter(a,e)&&i.push(a)}),i}getRefreshToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const a=t?ms:void 0,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:Oe.REFRESH_TOKEN,clientId:this.clientId,familyId:a},l=i&&i.refreshToken||this.getTokenKeys().refreshToken,d=[];l.forEach(u=>{if(this.refreshTokenKeyMatchesFilter(u,c)){const y=this.getRefreshTokenCredential(u,r);y&&this.credentialMatchesFilter(y,c)&&d.push(y)}});const h=d.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&o&&r&&o.addFields({multiMatchedRT:h},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),d[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),i=Object.keys(r).map(a=>r[a]),o=i.length;if(o<1)return null;if(o>1)throw R(Ia);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===ms)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=Gd(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==Oe.ACCESS_TOKEN&&e.credentialType!==Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:ke.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Bn)!==-1}isAuthorityMetadata(e){return e.indexOf(ps.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${ps.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Vd extends An{async setAccount(){throw R(te)}getAccount(){throw R(te)}async setIdTokenCredential(){throw R(te)}getIdTokenCredential(){throw R(te)}async setAccessTokenCredential(){throw R(te)}getAccessTokenCredential(){throw R(te)}async setRefreshTokenCredential(){throw R(te)}getRefreshTokenCredential(){throw R(te)}setAppMetadata(){throw R(te)}getAppMetadata(){throw R(te)}setServerTelemetry(){throw R(te)}getServerTelemetry(){throw R(te)}setAuthorityMetadata(){throw R(te)}getAuthorityMetadata(){throw R(te)}getAuthorityMetadataKeys(){throw R(te)}setThrottlingCache(){throw R(te)}getThrottlingCache(){throw R(te)}removeItem(){throw R(te)}getKeys(){throw R(te)}getAccountKeys(){throw R(te)}getTokenKeys(){throw R(te)}generateCredentialKey(){throw R(te)}generateAccountKey(){throw R(te)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const ze={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};/*! @azure/msal-common v15.12.0 2025-08-19 */const p={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},Wd={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.12.0 2025-08-19 */class _o{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class tc{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Wd.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new _o}}startPerformanceMeasurement(){return new _o}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-common v15.12.0 2025-08-19 */const rc={tokenRenewalOffsetSeconds:xa,preventCorsPreflight:!1},Qd={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:me.Info,correlationId:T.EMPTY_STRING},Yd={claimsBasedCachingEnabled:!1},Jd={async sendGetRequestAsync(){throw R(te)},async sendPostRequestAsync(){throw R(te)}},Xd={sku:T.SKU,version:Yn,cpu:T.EMPTY_STRING,os:T.EMPTY_STRING},Zd={clientSecret:T.EMPTY_STRING,clientAssertion:void 0},eh={azureCloudInstance:Jn.None,tenant:`${T.DEFAULT_COMMON_TENANT}`},th={application:{appName:"",appVersion:""}};function rh({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:o,cryptoInterface:a,clientCredentials:c,libraryInfo:l,telemetry:d,serverTelemetryManager:h,persistencePlugin:u,serializableCache:y}){const x={...Qd,...t};return{authOptions:sh(n),systemOptions:{...rc,...e},loggerOptions:x,cacheOptions:{...Yd,...r},storageInterface:i||new Vd(n.clientId,ys,new Ct(x),new tc),networkInterface:o||Jd,cryptoInterface:a||ys,clientCredentials:c||Zd,libraryInfo:{...Xd,...l},telemetry:{...th,...d},serverTelemetryManager:h||null,persistencePlugin:u||null,serializableCache:y||null}}function sh(n){return{clientCapabilities:[],azureCloudOptions:eh,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...n}}function sc(n){return n.authOptions.authority.options.protocolMode===ze.OIDC}/*! @azure/msal-common v15.12.0 2025-08-19 */const ot={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.12.0 2025-08-19 */function vs(n,e){if(!n)throw R(ba);try{const t=e(n);return JSON.parse(t)}catch{throw R(Kn)}}function or(n){if(!n)throw R(Kn);const e=n.split(Pr.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?T.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Gt="client_id",nc="redirect_uri",nh="response_type",ih="response_mode",oh="grant_type",ah="claims",ch="scope",lh="refresh_token",dh="state",hh="nonce",uh="prompt",gh="code",mh="code_challenge",ph="code_challenge_method",fh="code_verifier",yh="client-request-id",xh="x-client-SKU",bh="x-client-VER",wh="x-client-OS",vh="x-client-CPU",kh="x-client-current-telemetry",Ch="x-client-last-telemetry",Sh="x-ms-lib-capability",_h="x-app-name",Ah="x-app-ver",Ih="post_logout_redirect_uri",Th="id_token_hint",Nh="client_secret",Eh="client_assertion",Rh="client_assertion_type",ic="token_type",oc="req_cnf",Ao="return_spa_code",jh="nativebroker",Ph="logout_hint",Oh="sid",Mh="login_hint",Dh="domain_hint",Lh="x-client-xtra-sku",ks="brk_client_id",Cs="brk_redirect_uri",In="instance_aware",Uh="ear_jwk",Hh="ear_jwe_crypto";/*! @azure/msal-common v15.12.0 2025-08-19 */function $s(n,e,t){if(!e)return;const r=n.get(Gt);r&&n.has(ks)&&(t==null||t.addFields({embeddedClientId:r,embeddedRedirectUri:n.get(nc)},e))}function oi(n,e){n.set(nh,e)}function Fh(n,e){n.set(ih,e||kd.QUERY)}function $h(n){n.set(jh,"1")}function ai(n,e,t=!0,r=ur){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const i=t?[...e||[],...r]:e||[],o=new ke(i);n.set(ch,o.printScopes())}function ci(n,e){n.set(Gt,e)}function li(n,e){n.set(nc,e)}function Bh(n,e){n.set(Ih,e)}function Kh(n,e){n.set(Th,e)}function zh(n,e){n.set(Dh,e)}function Zr(n,e){n.set(Mh,e)}function Ss(n,e){n.set(Ue.CCS_HEADER,`UPN:${e}`)}function Ar(n,e){n.set(Ue.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function Io(n,e){n.set(Oh,e)}function di(n,e,t){const r=Yh(e,t);try{JSON.parse(r)}catch{throw ue(Xn)}n.set(ah,r)}function hi(n,e){n.set(yh,e)}function ui(n,e){n.set(xh,e.sku),n.set(bh,e.version),e.os&&n.set(wh,e.os),e.cpu&&n.set(vh,e.cpu)}function gi(n,e){e!=null&&e.appName&&n.set(_h,e.appName),e!=null&&e.appVersion&&n.set(Ah,e.appVersion)}function Gh(n,e){n.set(uh,e)}function ac(n,e){e&&n.set(dh,e)}function qh(n,e){n.set(hh,e)}function cc(n,e,t){if(e&&t)n.set(mh,e),n.set(ph,t);else throw ue(Zn)}function Vh(n,e){n.set(gh,e)}function Wh(n,e){n.set(lh,e)}function Qh(n,e){n.set(fh,e)}function lc(n,e){n.set(Nh,e)}function dc(n,e){e&&n.set(Eh,e)}function hc(n,e){e&&n.set(Rh,e)}function uc(n,e){n.set(oh,e)}function mi(n){n.set(Cd,"1")}function gc(n){n.has(In)||n.set(In,"true")}function Pt(n,e){Object.entries(e).forEach(([t,r])=>{!n.has(t)&&r&&n.set(t,r)})}function Yh(n,e){let t;if(!n)t={};else try{t=JSON.parse(n)}catch{throw ue(Xn)}return e&&e.length>0&&(t.hasOwnProperty(Jr.ACCESS_TOKEN)||(t[Jr.ACCESS_TOKEN]={}),t[Jr.ACCESS_TOKEN][Jr.XMS_CC]={values:e}),JSON.stringify(t)}function pi(n,e){e&&(n.set(ic,ce.POP),n.set(oc,e))}function mc(n,e){e&&(n.set(ic,ce.SSH),n.set(oc,e))}function pc(n,e){n.set(kh,e.generateCurrentRequestHeaderValue()),n.set(Ch,e.generateLastRequestHeaderValue())}function fc(n){n.set(Sh,_r.X_MS_LIB_CAPABILITY_VALUE)}function Jh(n,e){n.set(Ph,e)}function Bs(n,e,t){n.has(ks)||n.set(ks,e),n.has(Cs)||n.set(Cs,t)}function Xh(n,e){n.set(Uh,encodeURIComponent(e));const t="eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0";n.set(Hh,t)}function Zh(n,e){Object.entries(e).forEach(([t,r])=>{r&&n.set(t,r)})}/*! @azure/msal-common v15.12.0 2025-08-19 */const it={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.12.0 2025-08-19 */function eu(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.12.0 2025-08-19 */function tu(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v15.12.0 2025-08-19 */function ru(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ze=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const a=r==null?void 0:r.startMeasurement(e,i);if(i){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},i)}try{const c=n(...o);return a==null||a.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(c){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},c),c}},I=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const a=r==null?void 0:r.startMeasurement(e,i);if(i){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},i)}return r==null||r.setPreQueueTime(e,i),n(...o).then(c=>(t.trace(`Returning result from ${e}`),a==null||a.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},c),c})};/*! @azure/msal-common v15.12.0 2025-08-19 */class Ks{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(p.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=Zt.ENVIRONMENT_VARIABLE;else{const o=Ks.IMDS_OPTIONS;try{const a=await I(this.getRegionFromIMDS.bind(this),p.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(T.IMDS_VERSION,o);if(a.status===Et.SUCCESS&&(r=a.body,t.region_source=Zt.IMDS),a.status===Et.BAD_REQUEST){const c=await I(this.getCurrentVersion.bind(this),p.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(o);if(!c)return t.region_source=Zt.FAILED_AUTO_DETECTION,null;const l=await I(this.getRegionFromIMDS.bind(this),p.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(c,o);l.status===Et.SUCCESS&&(r=l.body,t.region_source=Zt.IMDS)}}catch{return t.region_source=Zt.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=Zt.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(p.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${T.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,T.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(p.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${T.IMDS_ENDPOINT}?format=json`,e);return r.status===Et.BAD_REQUEST&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}Ks.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.12.0 2025-08-19 */function Ge(){return Math.round(new Date().getTime()/1e3)}function To(n){return n.getTime()/1e3}function ar(n){return n?new Date(Number(n)*1e3):new Date}function _s(n,e){const t=Number(n)||0;return Ge()+e>t}function su(n,e){const t=Number(n)+e*24*60*60*1e3;return Date.now()>t}function nu(n){return Number(n)>Ge()}/*! @azure/msal-common v15.12.0 2025-08-19 */function zs(n,e,t,r,i){return{credentialType:Oe.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i,lastUpdatedAt:Date.now().toString()}}function Gs(n,e,t,r,i,o,a,c,l,d,h,u,y,x,U){var v,C;const N={homeAccountId:n,credentialType:Oe.ACCESS_TOKEN,secret:t,cachedAt:Ge().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:e,clientId:r,realm:i,target:o,tokenType:h||ce.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(N.userAssertionHash=u),d&&(N.refreshOn=d.toString()),x&&(N.requestedClaims=x,N.requestedClaimsHash=U),((v=N.tokenType)==null?void 0:v.toLowerCase())!==ce.BEARER.toLowerCase())switch(N.credentialType=Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME,N.tokenType){case ce.POP:const j=gr(t,l);if(!((C=j==null?void 0:j.cnf)!=null&&C.kid))throw R(ja);N.keyId=j.cnf.kid;break;case ce.SSH:N.keyId=y}return N}function yc(n,e,t,r,i,o,a){const c={credentialType:Oe.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,lastUpdatedAt:Date.now().toString()};return o&&(c.userAssertionHash=o),i&&(c.familyId=i),a&&(c.expiresOn=a.toString()),c}function fi(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function No(n){return n?fi(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===Oe.ACCESS_TOKEN||n.credentialType===Oe.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function iu(n){return n?fi(n)&&n.hasOwnProperty("realm")&&n.credentialType===Oe.ID_TOKEN:!1}function Eo(n){return n?fi(n)&&n.credentialType===Oe.REFRESH_TOKEN:!1}function ou(n,e){const t=n.indexOf(Pe.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function au(n,e){let t=!1;n&&(t=n.indexOf(_r.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function cu({environment:n,clientId:e}){return[Bn,n,e].join(Pr.CACHE_KEY_SEPARATOR).toLowerCase()}function lu(n,e){return e?n.indexOf(Bn)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function du(n,e){return e?n.indexOf(ps.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function Ro(){return Ge()+ps.REFRESH_TIME_SECONDS}function es(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function cn(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function jo(n){return n.expiresAt<=Ge()}/*! @azure/msal-common v15.12.0 2025-08-19 */class Me{constructor(e,t,r,i,o,a,c,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=c,this.correlationId=a,this.managedIdentity=l||!1,this.regionDiscovery=new Ks(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(T.CIAM_AUTH_URL))return it.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case T.ADFS:return it.Adfs;case T.DSTS:return it.Dsts}return it.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new oe(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw R(wt)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw R(wt)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw R(wt)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw R(Ma);return this.replacePath(this.metadata.end_session_endpoint)}else throw R(wt)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw R(wt)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw R(wt)}canReplaceTenant(e){return e.PathSegments.length===1&&!Me.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===it.Default&&this.protocolMode!==ze.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new oe(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((c,l)=>{let d=o[l];if(l===0&&this.canReplaceTenant(i)){const h=new oe(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];d!==h&&(this.logger.verbose(`Replacing tenant domain name ${d} with id ${h}`),d=h)}c!==d&&(t=t.replace(`/${d}/`,`/${c}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===it.Adfs||this.protocolMode===ze.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,o;(i=this.performanceClient)==null||i.addQueueMeasurement(p.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await I(this.updateCloudDiscoveryMetadata.bind(this),p.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await I(this.updateEndpointMetadata.bind(this),p.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(o=this.performanceClient)==null||o.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:Ro(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==Ye.CACHE&&(r==null?void 0:r.source)!==Ye.CACHE&&(e.expiresAt=Ro(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,o,a;(i=this.performanceClient)==null||i.addQueueMeasurement(p.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Ye.HARDCODED_VALUES&&(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&t.metadata){const c=await I(this.updateMetadataWithRegionalInformation.bind(this),p.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);es(e,c,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await I(this.getEndpointMetadataFromNetwork.bind(this),p.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(a=this.authorityOptions.azureRegionConfiguration)!=null&&a.azureRegion&&(r=await I(this.updateMetadataWithRegionalInformation.bind(this),p.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),es(e,r,!0),Ye.NETWORK;throw R(ka,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),es(e,t,!1),{source:Ye.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return es(e,i,!1),{source:Ye.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=jo(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Ye.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new oe(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw ue(Ka)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(p.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return eu(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Co?Co[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,i,o;(r=this.performanceClient)==null||r.addQueueMeasurement(p.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==T.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=on.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Me.replaceWithRegionalInformation(e,t);const a=await I(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),p.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((o=this.authorityOptions.azureRegionConfiguration)==null?void 0:o.environmentRegion,this.regionDiscoveryMetadata);if(a)return this.regionDiscoveryMetadata.region_outcome=on.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=a,Me.replaceWithRegionalInformation(e,a);this.regionDiscoveryMetadata.region_outcome=on.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(p.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await I(this.getCloudDiscoveryMetadataFromNetwork.bind(this),p.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return cn(e,r,!0),Ye.NETWORK;throw ue(za)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||T.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||T.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||T.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),cn(e,t,!1),Ye.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=qd(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),cn(e,i,!1),Ye.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=jo(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),Ye.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===it.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=bs(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),ue(ei)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(p.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${T.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const o=await this.networkInterface.sendGetRequestAsync(e,t);let a,c;if(tu(o.body))a=o.body,c=a.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else if(ru(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),a=o.body,a.error===T.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),c=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=bs(c,this.hostnameAndPort)}catch(o){if(o instanceof de)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{const a=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${a.name}
Error Description: ${a.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&oe.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Jn.None){const i=t.tenant?t.tenant:T.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${i}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return T.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw R(wt)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return ec.has(e)}static isPublicCloudAuthority(e){return T.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const i=new oe(e);i.validateAsUri();const o=i.getUrlComponents();let a=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(a=`${t}.${T.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const c=oe.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:a}).urlString;return r?`${c}?${r}`:c}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Me.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Me.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Me.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const i=new oe(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(T.CIAM_AUTH_URL)){const o=i.HostNameAndPort.split(".")[0];t=`${t}${o}${T.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Me.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Rt.COMMON,Rt.CONSUMERS,Rt.ORGANIZATIONS]);function hu(n){var i;const r=(i=new oe(n).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(r){case Rt.COMMON:case Rt.ORGANIZATIONS:case Rt.CONSUMERS:return;default:return r}}function xc(n){return n.endsWith(T.FORWARD_SLASH)?n:`${n}${T.FORWARD_SLASH}`}function uu(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw ue(ei)}return{canonicalAuthority:n.authority?xc(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.12.0 2025-08-19 */async function bc(n,e,t,r,i,o,a){a==null||a.addQueueMeasurement(p.AuthorityFactoryCreateDiscoveredInstance,o);const c=Me.transformCIAMAuthority(xc(n)),l=new Me(c,e,t,r,i,o,a);try{return await I(l.resolveEndpointsAsync.bind(l),p.AuthorityResolveEndpointsAsync,i,a,o)(),l}catch{throw R(wt)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Yt extends de{constructor(e,t,r,i,o){super(e,t,r),this.name="ServerError",this.errorNo=i,this.status=o,Object.setPrototypeOf(this,Yt.prototype)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function qs(n,e,t){var r;return{clientId:n,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||((r=e.tokenBodyParameters)==null?void 0:r.clientId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class mt{static generateThrottlingStorageKey(e){return`${_r.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,r){var a;const i=mt.generateThrottlingStorageKey(t),o=e.getThrottlingCache(i);if(o){if(o.throttleTime<Date.now()){e.removeItem(i,r);return}throw new Yt(((a=o.errorCodes)==null?void 0:a.join(" "))||T.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,r,i){if(mt.checkResponseStatus(r)||mt.checkResponseForRetryAfter(r)){const o={throttleTime:mt.calculateThrottleTime(parseInt(r.headers[Ue.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(mt.generateThrottlingStorageKey(t),o,i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Ue.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||_r.DEFAULT_THROTTLE_TIME_SECONDS),r+_r.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,i){const o=qs(t,r,i),a=this.generateThrottlingStorageKey(o);e.removeItem(a,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Vs extends de{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Vs.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function Cr(n,e,t,r){return n.errorMessage=`${n.errorMessage}, additionalErrorInfo: error.name:${r==null?void 0:r.name}, error.message:${r==null?void 0:r.message}`,new Vs(n,e,t)}/*! @azure/msal-common v15.12.0 2025-08-19 */class yi{constructor(e,t){this.config=rh(e),this.logger=new Ct(this.config.loggerOptions,Da,Yn),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Ue.CONTENT_TYPE]=T.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case ot.HOME_ACCOUNT_ID:try{const r=or(e.credential);t[Ue.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case ot.UPN:t[Ue.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,i,o,a){var l;a&&((l=this.performanceClient)==null||l.addQueueMeasurement(a,o));const c=await this.sendPostRequest(i,e,{body:t,headers:r},o);return this.config.serverTelemetryManager&&c.status<500&&c.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),c}async sendPostRequest(e,t,r,i){var a,c,l;mt.preProcess(this.cacheManager,e,i);let o;try{o=await I(this.networkClient.sendPostRequestAsync.bind(this.networkClient),p.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,i)(t,r);const d=o.headers||{};(c=this.performanceClient)==null||c.addFields({refreshTokenSize:((a=o.body.refresh_token)==null?void 0:a.length)||0,httpVerToken:d[Ue.X_MS_HTTP_VERSION]||"",requestId:d[Ue.X_MS_REQUEST_ID]||""},i)}catch(d){if(d instanceof Vs){const h=d.responseHeaders;throw h&&((l=this.performanceClient)==null||l.addFields({httpVerToken:h[Ue.X_MS_HTTP_VERSION]||"",requestId:h[Ue.X_MS_REQUEST_ID]||"",contentTypeHeader:h[Ue.CONTENT_TYPE]||void 0,contentLengthHeader:h[Ue.CONTENT_LENGTH]||void 0,httpStatus:d.httpStatus},i)),d.error}throw d instanceof de?d:R(va)}return mt.postProcess(this.cacheManager,e,o,i),o}async updateAuthority(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(p.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,i=await bc(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&Bs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&Pt(t,e.tokenQueryParameters),hi(t,e.correlationId),$s(t,e.correlationId,this.performanceClient),Or(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function wc(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */class nt{getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,loginHint:this.loginHint,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,r){var d,h,u,y,x,U,N;const i=new nt;t.authorityType===it.Adfs?i.authorityType=Xr.ADFS_ACCOUNT_TYPE:t.protocolMode===ze.OIDC?i.authorityType=Xr.GENERIC_ACCOUNT_TYPE:i.authorityType=Xr.MSSTS_ACCOUNT_TYPE;let o;e.clientInfo&&r&&(o=vs(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const a=e.environment||t&&t.getPreferredCache();if(!a)throw R(Vn);i.environment=a,i.realm=(o==null?void 0:o.utid)||wc(e.idTokenClaims)||"",i.localAccountId=(o==null?void 0:o.uid)||((d=e.idTokenClaims)==null?void 0:d.oid)||((h=e.idTokenClaims)==null?void 0:h.sub)||"";const c=((u=e.idTokenClaims)==null?void 0:u.preferred_username)||((y=e.idTokenClaims)==null?void 0:y.upn),l=(x=e.idTokenClaims)!=null&&x.emails?e.idTokenClaims.emails[0]:null;if(i.username=c||l||"",i.loginHint=(U=e.idTokenClaims)==null?void 0:U.login_hint,i.name=((N=e.idTokenClaims)==null?void 0:N.name)||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const v=ri(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[v]}return i}static createFromAccountInfo(e,t,r){var o;const i=new nt;return i.authorityType=e.authorityType||Xr.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.loginHint=e.loginHint,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(((o=e.tenantProfiles)==null?void 0:o.values())||[]),i}static generateHomeAccountId(e,t,r,i,o){if(!(t===it.Adfs||t===it.Dsts)){if(e)try{const a=vs(e,i.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}r.warning("No client info in response")}return(o==null?void 0:o.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let i=!0;if(r){const o=e.idTokenClaims||{},a=t.idTokenClaims||{};i=o.iat===a.iat&&o.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v15.12.0 2025-08-19 */const As="no_tokens_found",vc="native_account_unavailable",xi="refresh_token_expired",bi="ux_not_allowed",gu="interaction_required",mu="consent_required",pu="login_required",Ws="bad_token";/*! @azure/msal-common v15.12.0 2025-08-19 */const Po=[gu,mu,pu,Ws,bi],fu=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],yu={[As]:"No refresh token found in the cache. Please sign-in.",[vc]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[xi]:"Refresh token has expired.",[Ws]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[bi]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};class lt extends de{constructor(e,t,r,i,o,a,c,l){super(e,t,r),Object.setPrototypeOf(this,lt.prototype),this.timestamp=i||T.EMPTY_STRING,this.traceId=o||T.EMPTY_STRING,this.correlationId=a||T.EMPTY_STRING,this.claims=c||T.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function kc(n,e,t){const r=!!n&&Po.indexOf(n)>-1,i=!!t&&fu.indexOf(t)>-1,o=!!e&&Po.some(a=>e.indexOf(a)>-1);return r||o||i}function Is(n){return new lt(n,yu[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */class mr{static setRequestState(e,t,r){const i=mr.generateLibraryState(e,r);return t?`${i}${T.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw R(Sn);const r={id:e.createNewGuid()};t&&(r.meta=t);const i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw R(Sn);if(!t)throw R(lr);try{const r=t.split(T.RESOURCE_DELIM),i=r[0],o=r.length>1?r.slice(1).join(T.RESOURCE_DELIM):T.EMPTY_STRING,a=e.base64Decode(i),c=JSON.parse(a);return{userRequestState:o||T.EMPTY_STRING,libraryState:c}}catch{throw R(lr)}}}/*! @azure/msal-common v15.12.0 2025-08-19 */const xu={SW:"sw"};class dr{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(p.PopTokenGenerateCnf,e.correlationId);const r=await I(this.generateKid.bind(this),p.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:i}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(p.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:xu.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,i){const{resourceRequestMethod:o,resourceRequestUri:a,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=a?new oe(a):void 0,u=h==null?void 0:h.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Ge(),m:o==null?void 0:o.toUpperCase(),u:u==null?void 0:u.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:u==null?void 0:u.AbsolutePath,q:u!=null&&u.QueryString?[[],u.QueryString]:void 0,client_claims:c||void 0,...i},t,d,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class bu{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.12.0 2025-08-19 */class qt{constructor(e,t,r,i,o,a,c){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=c}validateTokenResponse(e,t){var r;if(e.error||e.error_description||e.suberror){const i=`Error(s): ${e.error_codes||T.NOT_AVAILABLE} - Timestamp: ${e.timestamp||T.NOT_AVAILABLE} - Description: ${e.error_description||T.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||T.NOT_AVAILABLE} - Trace ID: ${e.trace_id||T.NOT_AVAILABLE}`,o=(r=e.error_codes)!=null&&r.length?e.error_codes[0]:void 0,a=new Yt(e.error,i,e.suberror,o,e.status);if(t&&e.status&&e.status>=Et.SERVER_ERROR_RANGE_START&&e.status<=Et.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${a}`);return}else if(t&&e.status&&e.status>=Et.CLIENT_ERROR_RANGE_START&&e.status<=Et.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${a}`);return}throw kc(e.error,e.error_description,e.suberror)?new lt(e.error,e.error_description,e.suberror,e.timestamp||T.EMPTY_STRING,e.trace_id||T.EMPTY_STRING,e.correlation_id||T.EMPTY_STRING,e.claims||T.EMPTY_STRING,o):a}}async handleServerTokenResponse(e,t,r,i,o,a,c,l,d){var U;(U=this.performanceClient)==null||U.addQueueMeasurement(p.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=gr(e.id_token||T.EMPTY_STRING,this.cryptoObj.base64Decode),o&&o.nonce&&h.nonce!==o.nonce)throw R(_a);if(i.maxAge||i.maxAge===0){const N=h.auth_time;if(!N)throw R(Gn);Ja(N,i.maxAge)}}this.homeAccountIdentifier=nt.generateHomeAccountId(e.client_info||T.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let u;o&&o.state&&(u=mr.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0;const y=this.generateCacheRecord(e,t,r,i,h,a,o);let x;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),x=new bu(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(x)),c&&!l&&y.account){const N=this.cacheStorage.generateAccountKey(y.account.getAccountInfo());if(!this.cacheStorage.getAccount(N,i.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await qt.generateAuthenticationResult(this.cryptoObj,t,y,!1,i,h,u,void 0,d)}await this.cacheStorage.saveCacheRecord(y,i.correlationId,i.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&x&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(x))}return qt.generateAuthenticationResult(this.cryptoObj,t,y,!1,i,h,u,e,d)}generateCacheRecord(e,t,r,i,o,a,c){const l=t.getPreferredCache();if(!l)throw R(Vn);const d=wc(o);let h,u;e.id_token&&o&&(h=zs(this.homeAccountIdentifier,l,e.id_token,this.clientId,d||""),u=wi(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i.correlationId,o,e.client_info,l,d,c,void 0,this.logger));let y=null;if(e.access_token){const N=e.scope?ke.fromString(e.scope):new ke(i.scopes||[]),v=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,C=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,j=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,J=r+v,O=J+C,M=j&&j>0?r+j:void 0;y=Gs(this.homeAccountIdentifier,l,e.access_token,this.clientId,d||t.tenant||"",N.printScopes(),J,O,this.cryptoObj.base64Decode,M,e.token_type,a,e.key_id,i.claims,i.requestedClaimsHash)}let x=null;if(e.refresh_token){let N;if(e.refresh_token_expires_in){const v=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;N=r+v}x=yc(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,a,N)}let U=null;return e.foci&&(U={clientId:this.clientId,environment:l,familyId:e.foci}),{account:u,idToken:h,accessToken:y,refreshToken:x,appMetadata:U}}static async generateAuthenticationResult(e,t,r,i,o,a,c,l,d){var J,O,M,Z,G;let h=T.EMPTY_STRING,u=[],y=null,x,U,N=T.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===ce.POP&&!o.popKid){const w=new dr(e),{secret:g,keyId:b}=r.accessToken;if(!b)throw R(Wn);h=await w.signPopToken(g,b,o)}else h=r.accessToken.secret;u=ke.fromString(r.accessToken.target).asArray(),y=ar(r.accessToken.expiresOn),x=ar(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(U=ar(r.accessToken.refreshOn))}r.appMetadata&&(N=r.appMetadata.familyId===ms?ms:"");const v=(a==null?void 0:a.oid)||(a==null?void 0:a.sub)||"",C=(a==null?void 0:a.tid)||"";l!=null&&l.spa_accountid&&r.account&&(r.account.nativeAccountId=l==null?void 0:l.spa_accountid);const j=r.account?si(r.account.getAccountInfo(),void 0,a,(J=r.idToken)==null?void 0:J.secret):null;return{authority:t.canonicalAuthority,uniqueId:v,tenantId:C,scopes:u,account:j,idToken:((O=r==null?void 0:r.idToken)==null?void 0:O.secret)||"",idTokenClaims:a||{},accessToken:h,fromCache:i,expiresOn:y,extExpiresOn:x,refreshOn:U,correlationId:o.correlationId,requestId:d||T.EMPTY_STRING,familyId:N,tokenType:((M=r.accessToken)==null?void 0:M.tokenType)||T.EMPTY_STRING,state:c?c.userRequestState:T.EMPTY_STRING,cloudGraphHostName:((Z=r.account)==null?void 0:Z.cloudGraphHostName)||T.EMPTY_STRING,msGraphHost:((G=r.account)==null?void 0:G.msGraphHost)||T.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function wi(n,e,t,r,i,o,a,c,l,d,h,u){u==null||u.verbose("setCachedAccount called");const x=n.getAccountKeys().find(j=>j.startsWith(t));let U=null;x&&(U=n.getAccount(x,i));const N=U||nt.createAccount({homeAccountId:t,idTokenClaims:o,clientInfo:a,environment:c,cloudGraphHostName:d==null?void 0:d.cloud_graph_host_name,msGraphHost:d==null?void 0:d.msgraph_host,nativeAccountId:h},e,r),v=N.tenantProfiles||[],C=l||N.realm;if(C&&!v.find(j=>j.tenantId===C)){const j=ri(t,N.localAccountId,C,o);v.push(j)}return N.tenantProfiles=v,N}/*! @azure/msal-common v15.12.0 2025-08-19 */async function Cc(n,e,t){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.12.0 2025-08-19 */class Sc extends yi{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async acquireToken(e,t){var c,l;if((c=this.performanceClient)==null||c.addQueueMeasurement(p.AuthClientAcquireToken,e.correlationId),!e.code)throw R(Ta);const r=Ge(),i=await I(this.executeTokenRequest.bind(this),p.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=(l=i.headers)==null?void 0:l[Ue.X_MS_REQUEST_ID],a=new qt(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return a.validateTokenResponse(i.body),I(a.handleServerTokenResponse.bind(a),p.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,r,e,t,void 0,void 0,void 0,o)}getLogoutUri(e){if(!e)throw ue(Ba);const t=this.createLogoutUrlQueryString(e);return oe.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var d;(d=this.performanceClient)==null||d.addQueueMeasurement(p.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),i=oe.appendQueryString(e.tokenEndpoint,r),o=await I(this.createTokenRequestBody.bind(this),p.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let a;if(t.clientInfo)try{const h=vs(t.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${h.uid}${Pr.CLIENT_INFO_SEPARATOR}${h.utid}`,type:ot.HOME_ACCOUNT_ID}}catch(h){this.logger.verbose("Could not parse client info for CCS Header: "+h)}const c=this.createTokenRequestHeaders(a||t.ccsCredential),l=qs(this.config.authOptions.clientId,t);return I(this.executePostToTokenEndpoint.bind(this),p.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,o,c,l,t.correlationId,p.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,o;(i=this.performanceClient)==null||i.addQueueMeasurement(p.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(ci(t,e.embeddedClientId||((o=e.tokenBodyParameters)==null?void 0:o[Gt])||this.config.authOptions.clientId),this.includeRedirectUri)li(t,e.redirectUri);else if(!e.redirectUri)throw ue(La);if(ai(t,e.scopes,!0,this.oidcDefaultScopes),Vh(t,e.code),ui(t,this.config.libraryInfo),gi(t,this.config.telemetry.application),fc(t),this.serverTelemetryManager&&!sc(this.config)&&pc(t,this.serverTelemetryManager),e.codeVerifier&&Qh(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&lc(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;dc(t,await Cc(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),hc(t,a.assertionType)}if(uc(t,ya.AUTHORIZATION_CODE_GRANT),mi(t),e.authenticationScheme===ce.POP){const a=new dr(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await I(a.generateCnf.bind(a),p.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,pi(t,c)}else if(e.authenticationScheme===ce.SSH)if(e.sshJwk)mc(t,e.sshJwk);else throw ue(Fs);(!Xe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&di(t,e.claims,this.config.authOptions.clientCapabilities);let r;if(e.clientInfo)try{const a=vs(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${a.uid}${Pr.CLIENT_INFO_SEPARATOR}${a.utid}`,type:ot.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case ot.HOME_ACCOUNT_ID:try{const a=or(r.credential);Ar(t,a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case ot.UPN:Ss(t,r.credential);break}return e.embeddedClientId&&Bs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Pt(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Ao])&&Pt(t,{[Ao]:"1"}),$s(t,e.correlationId,this.performanceClient),Or(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&Bh(t,e.postLogoutRedirectUri),e.correlationId&&hi(t,e.correlationId),e.idTokenHint&&Kh(t,e.idTokenHint),e.state&&ac(t,e.state),e.logoutHint&&Jh(t,e.logoutHint),e.extraQueryParameters&&Pt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&gc(t),Or(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const wu=300;class vu extends yi{constructor(e,t){super(e,t)}async acquireToken(e){var a,c;(a=this.performanceClient)==null||a.addQueueMeasurement(p.RefreshTokenClientAcquireToken,e.correlationId);const t=Ge(),r=await I(this.executeTokenRequest.bind(this),p.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(c=r.headers)==null?void 0:c[Ue.X_MS_REQUEST_ID],o=new qt(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(r.body),I(o.handleServerTokenResponse.bind(o),p.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var r;if(!e)throw ue($a);if((r=this.performanceClient)==null||r.addQueueMeasurement(p.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw R(qn);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await I(this.acquireTokenWithCachedRefreshToken.bind(this),p.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const o=i instanceof lt&&i.errorCode===As,a=i instanceof Yt&&i.errorCode===yo.INVALID_GRANT_ERROR&&i.subError===yo.CLIENT_MISMATCH_ERROR;if(o||a)return I(this.acquireTokenWithCachedRefreshToken.bind(this),p.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return I(this.acquireTokenWithCachedRefreshToken.bind(this),p.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var o,a,c;(o=this.performanceClient)==null||o.addQueueMeasurement(p.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=Ze(this.cacheManager.getRefreshToken.bind(this.cacheManager),p.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw Is(As);if(r.expiresOn&&_s(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||wu))throw(a=this.performanceClient)==null||a.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),Is(xi);const i={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||ce.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:ot.HOME_ACCOUNT_ID}};try{return await I(this.acquireToken.bind(this),p.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(l){if(l instanceof lt&&((c=this.performanceClient)==null||c.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),l.subError===Ws)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const d=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(d,e.correlationId)}throw l}}async executeTokenRequest(e,t){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(p.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),i=oe.appendQueryString(t.tokenEndpoint,r),o=await I(this.createTokenRequestBody.bind(this),p.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),a=this.createTokenRequestHeaders(e.ccsCredential),c=qs(this.config.authOptions.clientId,e);return I(this.executePostToTokenEndpoint.bind(this),p.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,o,a,c,e.correlationId,p.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i,o;(r=this.performanceClient)==null||r.addQueueMeasurement(p.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(ci(t,e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[Gt])||this.config.authOptions.clientId),e.redirectUri&&li(t,e.redirectUri),ai(t,e.scopes,!0,(o=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:o.defaultScopes),uc(t,ya.REFRESH_TOKEN_GRANT),mi(t),ui(t,this.config.libraryInfo),gi(t,this.config.telemetry.application),fc(t),this.serverTelemetryManager&&!sc(this.config)&&pc(t,this.serverTelemetryManager),Wh(t,e.refreshToken),this.config.clientCredentials.clientSecret&&lc(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;dc(t,await Cc(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),hc(t,a.assertionType)}if(e.authenticationScheme===ce.POP){const a=new dr(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await I(a.generateCnf.bind(a),p.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,pi(t,c)}else if(e.authenticationScheme===ce.SSH)if(e.sshJwk)mc(t,e.sshJwk);else throw ue(Fs);if((!Xe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&di(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ot.HOME_ACCOUNT_ID:try{const a=or(e.ccsCredential.credential);Ar(t,a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case ot.UPN:Ss(t,e.ccsCredential.credential);break}return e.embeddedClientId&&Bs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Pt(t,e.tokenBodyParameters),$s(t,e.correlationId,this.performanceClient),Or(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class ku extends yi{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(p.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Ht.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Xe.isEmptyObj(e.claims))throw this.setCacheOutcome(Ht.FORCE_REFRESH_OR_CLAIMS,e.correlationId),R(jt);if(!e.account)throw R(qn);const r=e.account.tenantId||hu(e.authority),i=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,i,r);if(o){if(nu(o.cachedAt)||_s(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Ht.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),R(jt);o.refreshOn&&_s(o.refreshOn,0)&&(t=Ht.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Ht.NO_CACHED_ACCESS_TOKEN,e.correlationId),R(jt);const a=e.authority||this.authority.getPreferredCache(),c={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,i,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(a)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await I(this.generateResultFromCacheRecord.bind(this),p.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(c,e),t]}setCacheOutcome(e,t){var r,i;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==Ht.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(p.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=gr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const o=r==null?void 0:r.auth_time;if(!o)throw R(Gn);Ja(o,t.maxAge)}return qt.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Cu={sendGetRequestAsync:()=>Promise.reject(R(te)),sendPostRequestAsync:()=>Promise.reject(R(te))};/*! @azure/msal-common v15.12.0 2025-08-19 */function Su(n,e,t,r){var c,l;const i=e.correlationId,o=new Map;ci(o,e.embeddedClientId||((c=e.extraQueryParameters)==null?void 0:c[Gt])||n.clientId);const a=[...e.scopes||[],...e.extraScopesToConsent||[]];if(ai(o,a,!0,(l=n.authority.options.OIDCOptions)==null?void 0:l.defaultScopes),li(o,e.redirectUri),hi(o,i),Fh(o,e.responseMode),mi(o),e.prompt&&(Gh(o,e.prompt),r==null||r.addFields({prompt:e.prompt},i)),e.domainHint&&(zh(o,e.domainHint),r==null||r.addFields({domainHintFromRequest:!0},i)),e.prompt!==Fe.SELECT_ACCOUNT)if(e.sid&&e.prompt===Fe.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),Io(o,e.sid),r==null||r.addFields({sidFromRequest:!0},i);else if(e.account){const d=Iu(e.account);let h=Tu(e.account);if(h&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),h=null),h){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),Zr(o,h),r==null||r.addFields({loginHintFromClaim:!0},i);try{const u=or(e.account.homeAccountId);Ar(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(d&&e.prompt===Fe.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),Io(o,d),r==null||r.addFields({sidFromClaim:!0},i);try{const u=or(e.account.homeAccountId);Ar(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),Zr(o,e.loginHint),Ss(o,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},i);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),Zr(o,e.account.username),r==null||r.addFields({loginHintFromUpn:!0},i);try{const u=or(e.account.homeAccountId);Ar(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),Zr(o,e.loginHint),Ss(o,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},i));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&qh(o,e.nonce),e.state&&ac(o,e.state),(e.claims||n.clientCapabilities&&n.clientCapabilities.length>0)&&di(o,e.claims,n.clientCapabilities),e.embeddedClientId&&Bs(o,n.clientId,n.redirectUri),n.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(In))&&gc(o),o}function vi(n,e,t,r){const i=Or(e,t,r);return oe.appendQueryString(n.authorizationEndpoint,i)}function _u(n,e){if(_c(n,e),!n.code)throw R(Pa);return n}function _c(n,e){if(!n.state||!e)throw n.state?R(vn,"Cached State"):R(vn,"Server State");let t,r;try{t=decodeURIComponent(n.state)}catch{throw R(lr,n.state)}try{r=decodeURIComponent(e)}catch{throw R(lr,n.state)}if(t!==r)throw R(Sa);if(n.error||n.error_description||n.suberror){const i=Au(n);throw kc(n.error,n.error_description,n.suberror)?new lt(n.error||"",n.error_description,n.suberror,n.timestamp||"",n.trace_id||"",n.correlation_id||"",n.claims||"",i):new Yt(n.error||"",n.error_description,n.suberror,i)}}function Au(n){var r,i;const e="code=",t=(r=n.error_uri)==null?void 0:r.lastIndexOf(e);return t&&t>=0?(i=n.error_uri)==null?void 0:i.substring(t+e.length):void 0}function Iu(n){var e;return((e=n.idTokenClaims)==null?void 0:e.sid)||null}function Tu(n){var e;return n.loginHint||((e=n.idTokenClaims)==null?void 0:e.login_hint)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */const Oo=",",Ac="|";function Nu(n){const{skus:e,libraryName:t,libraryVersion:r,extensionName:i,extensionVersion:o}=n,a=new Map([[0,[t,r]],[2,[i,o]]]);let c=[];if(e!=null&&e.length){if(c=e.split(Oo),c.length<4)return e}else c=Array.from({length:4},()=>Ac);return a.forEach((l,d)=>{var h,u;l.length===2&&((h=l[0])!=null&&h.length)&&((u=l[1])!=null&&u.length)&&Eu({skuArr:c,index:d,skuName:l[0],skuVersion:l[1]})}),c.join(Oo)}function Eu(n){const{skuArr:e,index:t,skuName:r,skuVersion:i}=n;t>=e.length||(e[t]=[r,i].join(Ac))}class Mr{constructor(e,t){this.cacheOutcome=Ht.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||T.EMPTY_STRING,this.wrapperVer=e.wrapperVer||T.EMPTY_STRING,this.telemetryCacheKey=Pe.CACHE_KEY+Pr.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Pe.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r!=null&&r.length&&t.push(`broker_error=${r}`);const i=t.join(Pe.VALUE_SEPARATOR),o=this.getRegionDiscoveryFields(),a=[e,o].join(Pe.VALUE_SEPARATOR);return[Pe.SCHEMA_VERSION,a,i].join(Pe.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Mr.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Pe.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(Pe.VALUE_SEPARATOR),o=e.errors.length,a=t<o?Pe.OVERFLOW_TRUE:Pe.OVERFLOW_FALSE,c=[o,a].join(Pe.VALUE_SEPARATOR);return[Pe.SCHEMA_VERSION,e.cacheHits,r,i,c].join(Pe.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Pe.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof de?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Pe.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Mr.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,i=0;const o=e.errors.length;for(t=0;t<o;t++){const a=e.failedRequests[2*t]||T.EMPTY_STRING,c=e.failedRequests[2*t+1]||T.EMPTY_STRING,l=e.errors[t]||T.EMPTY_STRING;if(i+=a.toString().length+c.toString().length+l.length+3,i<Pe.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||T.EMPTY_STRING),e.push(this.regionSource||T.EMPTY_STRING),e.push(this.regionOutcome||T.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return Nu(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ic="missing_kid_error",Tc="missing_alg_error";/*! @azure/msal-common v15.12.0 2025-08-19 */const Ru={[Ic]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Tc]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class ki extends de{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,ki.prototype)}}function Mo(n){return new ki(n,Ru[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */class Ci{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Mo(Ic);if(!e.alg)throw Mo(Tc);const t=new Ci({typ:e.typ||Sd.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Si="pkce_not_created",_i="ear_jwk_empty",Nc="ear_jwe_empty",Tn="crypto_nonexistent",Qs="empty_navigate_uri",Ec="hash_empty_error",Ai="no_state_in_hash",Rc="hash_does_not_contain_known_properties",jc="unable_to_parse_state",Pc="state_interaction_type_mismatch",Oc="interaction_in_progress",Mc="popup_window_error",Dc="empty_window_error",Dr="user_cancelled",ju="monitor_popup_timeout",Lc="monitor_window_timeout",Uc="redirect_in_iframe",Hc="block_iframe_reload",Fc="block_nested_popups",Pu="iframe_closed_prematurely",Ys="silent_logout_unsupported",$c="no_account_error",Ou="silent_prompt_value_error",Bc="no_token_request_cache_error",Kc="unable_to_parse_token_request_cache_error",Mu="auth_request_not_set_error",Du="invalid_cache_type",Js="non_browser_environment",er="database_not_open",Ts="no_network_connectivity",zc="post_request_failed",Gc="get_request_failed",Nn="failed_to_parse_response",qc="unable_to_load_token",Ii="crypto_key_not_found",Vc="auth_code_required",Wc="auth_code_or_nativeAccountId_required",Qc="spa_code_and_nativeAccountId_present",Ti="database_unavailable",Yc="unable_to_acquire_token_from_native_platform",Jc="native_handshake_timeout",Xc="native_extension_not_installed",Ni="native_connection_not_established",Ir="uninitialized_public_client_application",Zc="native_prompt_not_supported",el="invalid_base64_string",tl="invalid_pop_token_request",rl="failed_to_build_headers",sl="failed_to_parse_headers",us="failed_to_decrypt_ear_response",Ns="timed_out";/*! @azure/msal-browser v4.23.0 2025-09-17 */const xt="For more visit: aka.ms/msaljs/browser-errors",Lu={[Si]:"The PKCE code challenge and verifier could not be generated.",[_i]:"No EAR encryption key provided. This is unexpected.",[Nc]:"Server response does not contain ear_jwe property. This is unexpected.",[Tn]:"The crypto object or function is not available.",[Qs]:"Navigation URI is empty. Please check stack trace for more info.",[Ec]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${xt}`,[Ai]:"Hash does not contain state. Please verify that the request originated from msal.",[Rc]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${xt}`,[jc]:"Unable to parse state. Please verify that the request originated from msal.",[Pc]:"Hash contains state but the interaction type does not match the caller.",[Oc]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${xt}`,[Mc]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Dc]:"window.open returned null or undefined window object.",[Dr]:"User cancelled the flow.",[ju]:`Token acquisition in popup failed due to timeout.  ${xt}`,[Lc]:`Token acquisition in iframe failed due to timeout.  ${xt}`,[Uc]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Hc]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${xt}`,[Fc]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Pu]:"The iframe being monitored was closed prematurely.",[Ys]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[$c]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Ou]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Bc]:"No token request found in cache.",[Kc]:"The cached token request could not be parsed.",[Mu]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Du]:"Invalid cache type",[Js]:"Login and token requests are not supported in non-browser environments.",[er]:"Database is not open!",[Ts]:"No network connectivity. Check your internet connection.",[zc]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Gc]:"Network request failed. Please check the network trace to determine root cause.",[Nn]:"Failed to parse network response. Check network trace.",[qc]:"Error loading token to cache.",[Ii]:"Cryptographic Key or Keypair not found in browser storage.",[Vc]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Wc]:"An authorization code or nativeAccountId must be provided to this flow.",[Qc]:"Request cannot contain both spa code and native account id.",[Ti]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Yc]:`Unable to acquire token from native platform.  ${xt}`,[Jc]:"Timed out while attempting to establish connection to browser extension",[Xc]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Ni]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${xt}`,[Ir]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${xt}`,[Zc]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[el]:"Invalid base64 encoded string.",[tl]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[rl]:"Failed to build request headers object.",[sl]:"Failed to parse response headers",[us]:"Failed to decrypt ear response",[Ns]:"The request timed out."};class zr extends de{constructor(e,t){super(e,Lu[e],t),Object.setPrototypeOf(this,zr.prototype),this.name="BrowserAuthError"}}function L(n,e){return new zr(n,e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Be={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},rt={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},vr={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Ce={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Do={GET:"GET",POST:"POST"},Tt={SIGNIN:"signin",SIGNOUT:"signout"},xe={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},ts={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},le={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var B;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(B||(B={}));const ge={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Lo={scopes:ur},nl="jwk",Uu={React:"@azure/msal-react",Angular:"@azure/msal-angular"},En="msal.db",Hu=1,Fu=`${En}.keys`,Le={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},$u=[Le.Default,Le.Skip,Le.RefreshTokenAndNetwork];/*! @azure/msal-browser v4.23.0 2025-09-17 */function rs(n){return encodeURIComponent(Lr(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Mt(n){return il(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Lr(n){return il(new TextEncoder().encode(n))}function il(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */function ct(n){return new TextDecoder().decode(Ot(n))}function Ot(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw L(el)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Bu="RSASSA-PKCS1-v1_5",pr="AES-GCM",ol="HKDF",Ei="SHA-256",Ku=2048,zu=new Uint8Array([1,0,1]),Uo="0123456789abcdef",Ho=new Uint32Array(1),Ri="raw",al="encrypt",ji="decrypt",Gu="deriveKey",qu="crypto_subtle_undefined",Pi={name:Bu,hash:Ei,modulusLength:Ku,publicExponent:zu};function Vu(n){if(!window)throw L(Js);if(!window.crypto)throw L(Tn);if(!n&&!window.crypto.subtle)throw L(Tn,qu)}async function cl(n,e,t){e==null||e.addQueueMeasurement(p.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(Ei,i)}function Wu(n){return window.crypto.getRandomValues(n)}function ln(){return window.crypto.getRandomValues(Ho),Ho[0]}function dt(){const n=Date.now(),e=ln()*1024+(ln()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,o=ln();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;let a="";for(let c=0;c<t.length;c++)a+=Uo.charAt(t[c]>>>4),a+=Uo.charAt(t[c]&15),(c===3||c===5||c===7||c===9)&&(a+="-");return a}async function Qu(n,e){return window.crypto.subtle.generateKey(Pi,n,e)}async function dn(n){return window.crypto.subtle.exportKey(nl,n)}async function Yu(n,e,t){return window.crypto.subtle.importKey(nl,n,Pi,e,t)}async function Ju(n,e){return window.crypto.subtle.sign(Pi,n,e)}async function Oi(){const n=await ll(),t={alg:"dir",kty:"oct",k:Mt(new Uint8Array(n))};return Lr(JSON.stringify(t))}async function Xu(n){const e=ct(n),r=JSON.parse(e).k,i=Ot(r);return window.crypto.subtle.importKey(Ri,i,pr,!1,[ji])}async function Zu(n,e){const t=e.split(".");if(t.length!==5)throw L(us,"jwe_length");const r=await Xu(n).catch(()=>{throw L(us,"import_key")});try{const i=new TextEncoder().encode(t[0]),o=Ot(t[2]),a=Ot(t[3]),c=Ot(t[4]),l=c.byteLength*8,d=new Uint8Array(a.length+c.length);d.set(a),d.set(c,a.length);const h=await window.crypto.subtle.decrypt({name:pr,iv:o,tagLength:l,additionalData:i},r,d);return new TextDecoder().decode(h)}catch{throw L(us,"decrypt")}}async function ll(){const n=await window.crypto.subtle.generateKey({name:pr,length:256},!0,[al,ji]);return window.crypto.subtle.exportKey(Ri,n)}async function Fo(n){return window.crypto.subtle.importKey(Ri,n,ol,!1,[Gu])}async function dl(n,e,t){return window.crypto.subtle.deriveKey({name:ol,salt:e,hash:Ei,info:new TextEncoder().encode(t)},n,{name:pr,length:256},!1,[al,ji])}async function eg(n,e,t){const r=new TextEncoder().encode(e),i=window.crypto.getRandomValues(new Uint8Array(16)),o=await dl(n,i,t),a=await window.crypto.subtle.encrypt({name:pr,iv:new Uint8Array(12)},o,r);return{data:Mt(new Uint8Array(a)),nonce:Mt(i)}}async function $o(n,e,t,r){const i=Ot(r),o=await dl(n,Ot(e),t),a=await window.crypto.subtle.decrypt({name:pr,iv:new Uint8Array(12)},o,i);return new TextDecoder().decode(a)}async function hl(n){const e=await cl(n),t=new Uint8Array(e);return Mt(t)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Mi="storage_not_supported",Ie="stubbed_public_client_application_called",ul="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const tg={[Mi]:"Given storage configuration option was not supported.",[Ie]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ul]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Di extends de{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Di.prototype)}}function ye(n){return new Di(n,tg[n])}/*! @azure/msal-browser v4.23.0 2025-09-17 */function gl(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function rg(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Li(){return window.parent!==window}function sg(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${Be.POPUP_NAME_PREFIX}.`)===0}function kt(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function ng(){const e=new oe(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function ig(){if(oe.hashContainsKnownProperties(window.location.hash)&&Li())throw L(Hc)}function og(n){if(Li()&&!n)throw L(Uc)}function ag(){if(sg())throw L(Fc)}function ml(){if(typeof window>"u")throw L(Js)}function pl(n){if(!n)throw L(Ir)}function Ui(n){ml(),ig(),ag(),pl(n)}function Bo(n,e){if(Ui(n),og(e.system.allowRedirectInIframe),e.cache.cacheLocation===Ce.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw ye(ul)}function fl(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function cg(){return dt()}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Es{navigateInternal(e,t){return Es.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Es.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((r,i)=>{setTimeout(()=>{i(L(Ns,"failed_to_redirect"))},t.timeout)})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class lg{async sendGetRequestAsync(e,t){let r,i={},o=0;const a=Ko(t);try{r=await fetch(e,{method:Do.GET,headers:a})}catch(c){throw Cr(L(window.navigator.onLine?Gc:Ts),void 0,void 0,c)}i=zo(r.headers);try{return o=r.status,{headers:i,body:await r.json(),status:o}}catch(c){throw Cr(L(Nn),o,i,c)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",i=Ko(t);let o,a=0,c={};try{o=await fetch(e,{method:Do.POST,headers:i,body:r})}catch(l){throw Cr(L(window.navigator.onLine?zc:Ts),void 0,void 0,l)}c=zo(o.headers);try{return a=o.status,{headers:c,body:await o.json(),status:a}}catch(l){throw Cr(L(Nn),a,c,l)}}}function Ko(n){try{const e=new Headers;if(!(n&&n.headers))return e;const t=n.headers;return Object.entries(t).forEach(([r,i])=>{e.append(r,i)}),e}catch(e){throw Cr(L(rl),void 0,void 0,e)}}function zo(n){try{const e={};return n.forEach((t,r)=>{e[r]=t}),e}catch{throw L(sl)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const dg=6e4,Rn=1e4,hg=3e4,yl=2e3;function ug({auth:n,cache:e,system:t,telemetry:r},i){const o={clientId:T.EMPTY_STRING,authority:`${T.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:T.EMPTY_STRING,authorityMetadata:T.EMPTY_STRING,redirectUri:typeof window<"u"?kt():"",postLogoutRedirectUri:T.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:ze.AAD,OIDCOptions:{serverResponseType:Hs.FRAGMENT,defaultScopes:[T.OPENID_SCOPE,T.PROFILE_SCOPE,T.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Jn.None,tenant:T.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},a={cacheLocation:Ce.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:Ce.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Ce.LocalStorage),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:me.Info,piiLoggingEnabled:!1},d={...{...rc,loggerOptions:c,networkClient:i?new lg:Cu,navigationClient:new Es,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||dg,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Rn,navigateFrameWait:0,redirectNavigationTimeout:hg,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||yl,pollIntervalMilliseconds:Be.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||c},h={application:{appName:T.EMPTY_STRING,appVersion:T.EMPTY_STRING},client:new tc};if((n==null?void 0:n.protocolMode)!==ze.OIDC&&(n!=null&&n.OIDCOptions)&&new Ct(d.loggerOptions).warning(JSON.stringify(ue(qa))),n!=null&&n.protocolMode&&n.protocolMode===ze.OIDC&&(d!=null&&d.allowPlatformBroker))throw ue(Va);return{auth:{...o,...n,OIDCOptions:{...o.OIDCOptions,...n==null?void 0:n.OIDCOptions}},cache:{...a,...e},system:d,telemetry:{...h,...r}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const gg="@azure/msal-browser",Vt="4.23.0";/*! @azure/msal-browser v4.23.0 2025-09-17 */const Te="msal",Hi="browser",hn="-",It=1,jn=1,mg=`${Te}.${Hi}.log.level`,pg=`${Te}.${Hi}.log.pii`,fg=`${Te}.${Hi}.platform.auth.dom`,Go=`${Te}.version`,qo="account.keys",Vo="token.keys";function gt(n=jn){return n<1?`${Te}.${qo}`:`${Te}.${n}.${qo}`}function $t(n,e=It){return e<1?`${Te}.${Vo}.${n}`:`${Te}.${e}.${Vo}.${n}`}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Fi{static loggerCallback(e,t){switch(e){case me.Error:console.error(t);return;case me.Info:console.info(t);return;case me.Verbose:console.debug(t);return;case me.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=ug(e,this.browserEnvironment);let t;try{t=window[Ce.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(mg),i=(l=t==null?void 0:t.getItem(pg))==null?void 0:l.toLowerCase(),o=i==="true"?!0:i==="false"?!1:void 0,a={...this.config.system.loggerOptions},c=r&&Object.keys(me).includes(r)?me[r]:void 0;c&&(a.loggerCallback=Fi.loggerCallback,a.logLevel=c),o!==void 0&&(a.piiLoggingEnabled=o),this.logger=new Ct(a,gg,Vt),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Wt extends Fi{getModuleName(){return Wt.MODULE_NAME}getId(){return Wt.ID}async initialize(){return this.available=typeof window<"u",this.available}}Wt.MODULE_NAME="";Wt.ID="StandardOperatingContext";/*! @azure/msal-browser v4.23.0 2025-09-17 */class yg{constructor(){this.dbName=En,this.version=Hu,this.tableName=Fu,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",i=>{const o=i;this.db=o.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(L(Ti)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(L(er));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);a.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result)}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,i)=>{if(!this.db)return i(L(er));const c=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);c.addEventListener("success",()=>{this.closeConnection(),r()}),c.addEventListener("error",l=>{this.closeConnection(),i(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(L(er));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);a.addEventListener("success",()=>{this.closeConnection(),t()}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(L(er));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();o.addEventListener("success",a=>{const c=a;this.closeConnection(),e(c.target.result)}),o.addEventListener("error",a=>{this.closeConnection(),t(a)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(L(er));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);a.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result===1)}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(En),i=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(i),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),r.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Xs{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class xg{constructor(e){this.inMemoryCache=new Xs,this.indexedDBCache=new yg,this.logger=e}handleDatabaseAccessError(e){if(e instanceof zr&&e.errorCode===Ti)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class St{constructor(e,t,r){this.logger=e,Vu(r??!1),this.cache=new xg(this.logger),this.performanceClient=t}createNewGuid(){return dt()}base64Encode(e){return Lr(e)}base64Decode(e){return ct(e)}base64UrlEncode(e){return rs(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var h;const t=(h=this.performanceClient)==null?void 0:h.startMeasurement(p.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await Qu(St.EXTRACTABLE,St.POP_KEY_USAGES),i=await dn(r.publicKey),o={e:i.e,kty:i.kty,n:i.n},a=Wo(o),c=await this.hashString(a),l=await dn(r.privateKey),d=await Yu(l,!1,["sign"]);return await this.cache.setItem(c,{privateKey:d,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),c}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw R(Oa)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){var J;const o=(J=this.performanceClient)==null?void 0:J.startMeasurement(p.CryptoOptsSignJwt,i),a=await this.cache.getItem(t);if(!a)throw L(Ii);const c=await dn(a.publicKey),l=Wo(c),d=rs(JSON.stringify({kid:t})),h=Ci.getShrHeaderString({...r==null?void 0:r.header,alg:c.alg,kid:d}),u=rs(h);e.cnf={jwk:JSON.parse(l)};const y=rs(JSON.stringify(e)),x=`${u}.${y}`,N=new TextEncoder().encode(x),v=await Ju(a.privateKey,N),C=Mt(new Uint8Array(v)),j=`${x}.${C}`;return o&&o.end({success:!0}),j}async hashString(e){return hl(e)}}St.POP_KEY_USAGES=["sign","verify"];St.EXTRACTABLE=!0;function Wo(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v4.23.0 2025-09-17 */const bg=24*60*60*1e3,Pn={Lax:"Lax",None:"None"};class xl{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let i=0;i<r.length;i++){const o=r[i],[a,...c]=decodeURIComponent(o).trim().split("="),l=c.join("=");if(a===t)return l}return""}getUserData(){throw R(te)}setItem(e,t,r,i=!0,o=Pn.Lax){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){const c=wg(r);a+=`expires=${c};`}(i||o===Pn.None)&&(a+="Secure;"),document.cookie=a}async setUserData(){return Promise.reject(R(te))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(r=>{const i=decodeURIComponent(r).trim().split("=");t.push(i[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function wg(n){const e=new Date;return new Date(e.getTime()+n*bg).toUTCString()}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Tr(n,e){const t=n.getItem(gt(e));return t?JSON.parse(t):[]}function Nr(n,e,t){const r=e.getItem($t(n,t));if(r){const i=JSON.parse(r);if(i&&i.hasOwnProperty("idToken")&&i.hasOwnProperty("accessToken")&&i.hasOwnProperty("refreshToken"))return i}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function On(n){return n.hasOwnProperty("id")&&n.hasOwnProperty("nonce")&&n.hasOwnProperty("data")}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Qo="msal.cache.encryption",vg="msal.broadcast.cache";class kg{constructor(e,t,r){if(!window.localStorage)throw ye(Mi);this.memoryStorage=new Xs,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel(vg)}async initialize(e){const t=new xl,r=t.getItem(Qo);let i={key:"",id:""};if(r)try{i=JSON.parse(r)}catch{}if(i.key&&i.id){const o=Ze(Ot,p.Base64Decode,this.logger,this.performanceClient,e)(i.key);this.encryptionCookie={id:i.id,key:await I(Fo,p.GenerateHKDF,this.logger,this.performanceClient,e)(o)}}else{const o=dt(),a=await I(ll,p.GenerateBaseKey,this.logger,this.performanceClient,e)(),c=Ze(Mt,p.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(a));this.encryptionCookie={id:o,key:await I(Fo,p.GenerateHKDF,this.logger,this.performanceClient,e)(a)};const l={id:o,key:c};t.setItem(Qo,JSON.stringify(l),0,!0,Pn.None)}await I(this.importExistingCache.bind(this),p.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw L(Ir);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw L(Ir);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const i=await I($o,p.Decrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!i)return null;try{return JSON.parse(i)}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,i){if(!this.initialized||!this.encryptionCookie)throw L(Ir);const{data:o,nonce:a}=await I(eg,p.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:a,data:o,lastUpdatedAt:i};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(c)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Tr(this).forEach(r=>this.removeItem(r));const t=Nr(this.clientId,this);t.idToken.forEach(r=>this.removeItem(r)),t.accessToken.forEach(r=>this.removeItem(r)),t.refreshToken.forEach(r=>this.removeItem(r)),this.getKeys().forEach(r=>{(r.startsWith(Te)||r.indexOf(this.clientId)!==-1)&&this.removeItem(r)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Tr(this);t=await this.importArray(t,e),t.length?this.setItem(gt(),JSON.stringify(t)):this.removeItem(gt());const r=Nr(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem($t(this.clientId),JSON.stringify(r)):this.removeItem($t(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let i;try{i=JSON.parse(r)}catch{return null}return On(i)?i.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):I($o,p.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,i.nonce,this.getContext(e),i.data):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),i)}async importArray(e,t){const r=[],i=[];return e.forEach(o=>{const a=this.getItemFromEncryptedCache(o,t).then(c=>{c?(this.memoryStorage.setItem(o,c),r.push(o)):this.removeItem(o)});i.push(a)}),await Promise.all(i),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(p.LocalStorageUpdated);t.add({isBackground:!0});const{key:r,value:i,context:o}=e.data;if(!r){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(o&&o!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${o}`),t.end({success:!1,errorCode:"contextMismatch"});return}i?(this.memoryStorage.setItem(r,i),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Cg{constructor(){if(!window.sessionStorage)throw ye(Mi)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const D={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};/*! @azure/msal-browser v4.23.0 2025-09-17 */function Yo(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Mn extends An{constructor(e,t,r,i,o,a,c){super(e,r,i,o,c),this.cacheConfig=t,this.logger=i,this.internalStorage=new Xs,this.browserStorage=Jo(e,t.cacheLocation,i,o),this.temporaryCacheStorage=Jo(e,t.temporaryCacheLocation,i,o),this.cookieStorage=new xl,this.eventHandler=a}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){const t=Tr(this.browserStorage,0),r=Nr(this.clientId,this.browserStorage,0);this.performanceClient.addFields({oldAccountCount:t.length,oldAccessCount:r.accessToken.length,oldIdCount:r.idToken.length,oldRefreshCount:r.refreshToken.length},e);const i=Tr(this.browserStorage,1),o=Nr(this.clientId,this.browserStorage,1);this.performanceClient.addFields({currAccountCount:i.length,currAccessCount:o.accessToken.length,currIdCount:o.idToken.length,currRefreshCount:o.refreshToken.length},e),await Promise.all([this.updateV0ToCurrent(jn,t,i,e),this.updateV0ToCurrent(It,r.idToken,o.idToken,e),this.updateV0ToCurrent(It,r.accessToken,o.accessToken,e),this.updateV0ToCurrent(It,r.refreshToken,o.refreshToken,e)]),t.length>0?this.browserStorage.setItem(gt(0),JSON.stringify(t)):this.browserStorage.removeItem(gt(0)),i.length>0?this.browserStorage.setItem(gt(1),JSON.stringify(i)):this.browserStorage.removeItem(gt(1)),this.setTokenKeys(r,e,0),this.setTokenKeys(o,e,1)}async updateV0ToCurrent(e,t,r,i){const o=[];for(const a of[...t]){const c=this.browserStorage.getItem(a),l=this.validateAndParseJson(c||"");if(!l){Yo(t,a);continue}l.lastUpdatedAt||(l.lastUpdatedAt=Date.now().toString(),this.setItem(a,JSON.stringify(l),i));const d=On(l)?await this.browserStorage.decryptData(a,l,i):l;let h;if(d&&(No(d)||Eo(d))&&(h=d.expiresOn),!d||su(l.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)||h&&_s(h,xa)){this.browserStorage.removeItem(a),Yo(t,a),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},i);continue}if(this.cacheConfig.cacheLocation!==Ce.LocalStorage||On(l)){const u=`${Te}.${e}${hn}${a}`,y=this.browserStorage.getItem(u);if(y){const x=this.validateAndParseJson(y);if(Number(l.lastUpdatedAt)>Number(x.lastUpdatedAt)){o.push(this.setUserData(u,JSON.stringify(d),i,l.lastUpdatedAt).then(()=>{this.performanceClient.incrementFields({updatedCacheFromV0Count:1},i)}));continue}}else{o.push(this.setUserData(u,JSON.stringify(d),i,l.lastUpdatedAt).then(()=>{r.push(u),this.performanceClient.incrementFields({upgradedCacheCount:1},i)}));continue}}}return Promise.all(o)}trackVersionChanges(e){const t=this.browserStorage.getItem(Go);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Vt&&this.setItem(Go,Vt,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,r){let i=0,o=[];const a=20;for(let c=0;c<=a;c++)try{this.browserStorage.setItem(e,t),c>0&&(c<=i?this.removeAccessTokenKeys(o.slice(0,c),r,0):(this.removeAccessTokenKeys(o.slice(0,i),r,0),this.removeAccessTokenKeys(o.slice(i,c),r)));break}catch(l){const d=_n(l);if(d.errorCode===ws&&c<a){if(!o.length){const h=e===$t(this.clientId,0)?JSON.parse(t).accessToken:this.getTokenKeys(0).accessToken,u=e===$t(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken;o=[...h,...u],i=h.length}if(o.length<=c)throw d;this.removeAccessToken(o[c],r,!1)}else throw d}}async setUserData(e,t,r,i){let o=0,a=[];const c=20;for(let l=0;l<=c;l++)try{await I(this.browserStorage.setUserData.bind(this.browserStorage),p.SetUserData,this.logger,this.performanceClient)(e,t,r,i),l>0&&(l<=o?this.removeAccessTokenKeys(a.slice(0,l),r,0):(this.removeAccessTokenKeys(a.slice(0,o),r,0),this.removeAccessTokenKeys(a.slice(o,l),r)));break}catch(d){const h=_n(d);if(h.errorCode===ws&&l<c){if(!a.length){const u=this.getTokenKeys(0).accessToken,y=this.getTokenKeys().accessToken;a=[...u,...y],o=u.length}if(a.length<=l)throw h;this.removeAccessToken(a[l],r,!1)}else throw h}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const i=this.validateAndParseJson(r);return!i||!nt.isAccountEntity(i)?null:An.toObject(new nt,i)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const r=this.generateAccountKey(e.getAccountInfo()),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.addAccountKeyToMap(r,t);this.cacheConfig.cacheLocation===Ce.LocalStorage&&o&&this.eventHandler.emitEvent(D.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return Tr(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const r=this.getAccountKeys();return r.indexOf(e)===-1?(r.push(e),this.setItem(gt(),JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const r=this.getAccountKeys(),i=r.indexOf(e);if(i>-1){if(r.splice(i,1),r.length===0){this.removeItem(gt());return}else this.setItem(gt(),JSON.stringify(r),t);this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const r=this.getActiveAccount(t);(r==null?void 0:r.homeAccountId)===e.homeAccountId&&(r==null?void 0:r.environment)===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(i=>{i.includes(e.homeAccountId)&&i.includes(e.environment)&&this.browserStorage.removeItem(i)}),this.cacheConfig.cacheLocation===Ce.LocalStorage&&this.eventHandler.emitEvent(D.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),i=r.idToken.indexOf(e);i>-1&&(this.logger.info("idToken removed from tokenKeys map"),r.idToken.splice(i,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=It){this.logger.trace("removeAccessTokenKey called");const i=this.getTokenKeys(r);let o=0;if(e.forEach(a=>{const c=i.accessToken.indexOf(a);c>-1&&(i.accessToken.splice(c,1),o++)}),o>0){this.logger.info(`removed ${o} accessToken keys from tokenKeys map`),this.setTokenKeys(i,t,r);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),i=r.refreshToken.indexOf(e);i>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),r.refreshToken.splice(i,1),this.setTokenKeys(r,t))}getTokenKeys(e=It){return Nr(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=It){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem($t(this.clientId,r));return}else this.setItem($t(this.clientId,r),JSON.stringify(e),t)}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const i=this.validateAndParseJson(r);return!i||!iu(i)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),i)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();o.idToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),o.idToken.push(r),this.setTokenKeys(o,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const i=this.validateAndParseJson(r);return!i||!No(i)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),i)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys(),a=o.accessToken.indexOf(r);a!==-1&&o.accessToken.splice(a,1),this.logger.trace(`access token ${a===-1?"added to":"updated in"} map`),o.accessToken.push(r),this.setTokenKeys(o,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const i=this.validateAndParseJson(r);return!i||!Eo(i)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),i)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();o.refreshToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),o.refreshToken.push(r),this.setTokenKeys(o,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!lu(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const r=cu(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!ou(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&du(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(ts.WRAPPER_SKU,e),this.internalStorage.setItem(ts.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(ts.WRAPPER_SKU)||T.EMPTY_STRING,t=this.internalStorage.getItem(ts.WRAPPER_VER)||T.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(fo.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const i=this.validateAndParseJson(r);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,tenantId:i.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const r=this.generateCacheKey(fo.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Ge().toString()};this.setItem(r,JSON.stringify(i),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(D.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!au(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const o=this.cookieStorage.getItem(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),o}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===Ce.LocalStorage){const o=this.browserStorage.getItem(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),o}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(Te)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(Te)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(p.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let r=0;t.accessToken.forEach(i=>{const o=this.getAccessTokenCredential(i,e);o!=null&&o.requestedClaimsHash&&i.includes(o.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(i,e),r++)}),r>0&&this.logger.warning(`${r} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return Xe.startsWith(e,Te)?e:`${Te}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===Oe.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==ce.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${Te}.${It}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",r].join(hn).toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${Te}.${jn}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(hn).toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(xe.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(xe.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(xe.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(xe.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(xe.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const r=Lr(JSON.stringify(e));if(this.setTemporaryCache(xe.REQUEST_PARAMS,r,!0),t){const i=Lr(t);this.setTemporaryCache(xe.VERIFIER,i,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(xe.REQUEST_PARAMS,!0);if(!e)throw L(Bc);const t=this.getTemporaryCache(xe.VERIFIER,!0);let r,i="";try{r=JSON.parse(ct(e)),t&&(i=ct(t))}catch(o){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${o}`),L(Kc)}return[r,i]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(xe.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){var r;const t=(r=this.getInteractionInProgress())==null?void 0:r.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${Te}.${xe.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),gl(window),null}}setInteractionInProgress(e,t=Tt.SIGNIN){var i;const r=`${Te}.${xe.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw L(Oc);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&((i=this.getInteractionInProgress())==null?void 0:i.clientId)===this.clientId&&this.removeTemporaryItem(r)}async hydrateCache(e,t){var c,l,d;const r=zs((c=e.account)==null?void 0:c.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const o=Gs((d=e.account)==null?void 0:d.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?To(e.expiresOn):0,e.extExpiresOn?To(e.extExpiresOn):0,ct,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),a={idToken:r,accessToken:o};return this.saveCacheRecord(a,e.correlationId)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(i){if(i instanceof ir&&this.performanceClient&&t)try{const o=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:o.refreshToken.length,cacheIdCount:o.idToken.length,cacheAtCount:o.accessToken.length},t)}catch{}throw i}}}function Jo(n,e,t,r){try{switch(e){case Ce.LocalStorage:return new kg(n,t,r);case Ce.SessionStorage:return new Cg;case Ce.MemoryStorage:default:break}}catch(i){t.error(i)}return new Xs}const Sg=(n,e,t,r)=>{const i={cacheLocation:Ce.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Ce.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Mn(n,i,ys,e,t,r)};/*! @azure/msal-browser v4.23.0 2025-09-17 */function _g(n,e,t,r,i){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(i||{},r):[]}function Ag(n,e,t,r){const i=t.getAccountInfoFilteredBy(n,r);return i?(e.verbose("getAccount: Account matching provided filter found, returning"),i):(e.verbose("getAccount: No matching account found, returning null"),null)}function Ig(n,e,t,r){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;const i=t.getAccountInfoFilteredBy({username:n},r);return i?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),i):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function Tg(n,e,t,r){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const i=t.getAccountInfoFilteredBy({homeAccountId:n},r);return i?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),i):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function Ng(n,e,t,r){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const i=t.getAccountInfoFilteredBy({localAccountId:n},r);return i?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),i):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Eg(n,e,t){e.setActiveAccount(n,t)}function Rg(n,e){return n.getActiveAccount(e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const jg="msal.broadcast.event";class Pg{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Ct({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(jg)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if(typeof window<"u"){const i=r||cg();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){var a;const o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};switch(e){case D.ACCOUNT_ADDED:case D.ACCOUNT_REMOVED:case D.ACTIVE_ACCOUNT_CHANGED:(a=this.broadcastChannel)==null||a.postMessage(o);break;default:this.invokeCallbacks(o);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],i)=>{(r.length===0||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${i}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class bl{constructor(e,t,r,i,o,a,c,l,d){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.platformAuthProvider=l,this.correlationId=d||dt(),this.logger=i.clone(Be.MSAL_SKU,Vt,this.correlationId),this.performanceClient=c}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return oe.getAbsoluteUrl(t,kt())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Mr(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(p.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,a=r!=null&&r.length?r==="true":this.config.auth.instanceAware,c=t&&a?this.config.auth.authority.replace(oe.getDomainFromUrl(o),t.environment):o,l=Me.generateAuthority(c,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),d=await I(bc,p.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!d.isAlias(t.environment))throw ue(Wa);return d}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function $i(n,e,t,r){t.addQueueMeasurement(p.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,o=[...n&&n.scopes||[]],a={...n,correlationId:n.correlationId,authority:i,scopes:o};if(!a.authenticationScheme)a.authenticationScheme=ce.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(a.authenticationScheme===ce.SSH){if(!n.sshJwk)throw ue(Fs);if(!n.sshKid)throw ue(Ga)}r.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!Xe.isEmptyObj(n.claims)&&(a.requestedClaimsHash=await hl(n.claims)),a}async function Og(n,e,t,r,i){r.addQueueMeasurement(p.InitializeSilentRequest,n.correlationId);const o=await I($i,p.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...o,account:e,forceRefresh:n.forceRefresh||!1}}function wl(n,e){let t;const r=n.httpMethod;if(e===ze.EAR){if(t=r||Ft.POST,t!==Ft.POST)throw ue(Qa)}else t=r||Ft.GET;if(n.authorizePostBodyParameters&&t!==Ft.POST)throw ue(Ya);return t}/*! @azure/msal-browser v4.23.0 2025-09-17 */class fr extends bl{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||dt(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=oe.getAbsoluteUrl(e.postLogoutRedirectUri,kt())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=oe.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,kt())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=oe.getAbsoluteUrl(kt(),kt())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(p.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await I(this.getClientConfiguration.bind(this),p.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new Sc(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:a}=e;this.performanceClient.addQueueMeasurement(p.StandardInteractionClientGetClientConfiguration,this.correlationId);const c=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:a}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:c,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Be.MSAL_SKU,version:Vt,cpu:T.EMPTY_STRING,os:T.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(p.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},o=mr.setRequestState(this.browserCrypto,e&&e.state||T.EMPTY_STRING,i),c={...await I($i,p.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:o,nonce:e.nonce||dt(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l={...c,httpMethod:wl(c,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return l;const d=e.account||this.browserStorage.getActiveAccount(this.correlationId);return d&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${d.homeAccountId}`,this.correlationId),l.account=d),l}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Mg(n,e){if(!e)return null;try{return mr.parseRequestState(n,e).libraryState.meta}catch{throw R(lr)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Er(n,e,t){const r=xs(n);if(!r)throw Xa(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),L(Rc)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),L(Ec));return r}function Dg(n,e,t){if(!n.state)throw L(Ai);const r=Mg(e,n.state);if(!r)throw L(jc);if(r.interactionType!==t)throw L(Pc)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class vl{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(p.HandleCodeResponse,t.correlationId);let r;try{r=_u(e,t.state)}catch(i){throw i instanceof Yt&&i.subError===Dr?L(Dr):i}return I(this.handleCodeResponseFromServer.bind(this),p.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(p.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await I(this.authModule.updateAuthority.bind(this.authModule),p.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const o=this.createCcsCredentials(t);o&&(this.authCodeRequest.ccsCredential=o)}return await I(this.authModule.acquireToken.bind(this.authModule),p.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:ot.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:ot.UPN}:null}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Lg="ContentError",kl="user_switch";/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ug="USER_INTERACTION_REQUIRED",Hg="USER_CANCEL",Fg="NO_NETWORK",$g="DISABLED",Bg="ACCOUNT_UNAVAILABLE",Kg="UX_NOT_ALLOWED";/*! @azure/msal-browser v4.23.0 2025-09-17 */const zg=-2147186943,Gg={[kl]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class pt extends de{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,pt.prototype),this.name="NativeAuthError",this.ext=r}}function tr(n){if(n.ext&&n.ext.status&&n.ext.status===$g||n.ext&&n.ext.error&&n.ext.error===zg)return!0;switch(n.errorCode){case Lg:return!0;default:return!1}}function Rs(n,e,t){if(t&&t.status)switch(t.status){case Bg:return Is(vc);case Ug:return new lt(n,e);case Hg:return L(Dr);case Fg:return L(Ts);case Kg:return Is(bi)}return new pt(n,Gg[n]||e,t)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Cl extends fr{async acquireToken(e){this.performanceClient.addQueueMeasurement(p.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(le.acquireTokenSilent_silentFlow),r=await I(this.getClientConfiguration.bind(this),p.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new ku(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const a=(await I(i.acquireCachedToken.bind(i),p.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),a}catch(o){throw o instanceof zr&&o.errorCode===Ii&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),o}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t==null?void 0:t.account)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class gs extends bl{constructor(e,t,r,i,o,a,c,l,d,h,u,y){super(e,t,r,i,o,a,l,d,y),this.apiId=c,this.accountId=h,this.platformAuthProvider=d,this.nativeStorageManager=u,this.silentCacheClient=new Cl(e,this.nativeStorageManager,r,i,o,a,l,d,y);const x=this.platformAuthProvider.getExtensionName();this.skus=Mr.makeExtraSkuString({libraryName:Be.MSAL_SKU,libraryVersion:Vt,extensionName:x,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Lh]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(p.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const r=this.performanceClient.startMeasurement(p.NativeInteractionClientAcquireToken,this.correlationId),i=Ge(),o=this.initializeServerTelemetryManager(this.apiId);try{const a=await this.initializeNativeRequest(e);try{const l=await this.acquireTokensFromCache(this.accountId,a);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),l}catch(l){if(t===Le.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),r.end({success:!1,brokerErrorCode:"cache_request_failed"}),l;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const c=await this.platformAuthProvider.sendMessage(a);return await this.handleNativeResponse(c,a,i).then(l=>(r.end({success:!0,isNativeBroker:!0,requestId:l.requestId}),o.clearNativeBrokerErrorCode(),l)).catch(l=>{throw r.end({success:!1,errorCode:l.errorCode,subErrorCode:l.subError}),l})}catch(a){throw a instanceof pt&&o.setNativeBrokerErrorCode(a.errorCode),r.end({success:!1}),a}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ke.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),R(Cn);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!r)throw R(Cn);try{const i=this.createSilentCacheRequest(t,r),o=await this.silentCacheClient.acquireToken(i),a={...r,idTokenClaims:o==null?void 0:o.idTokenClaims,idToken:o==null?void 0:o.idToken};return{...o,account:a}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r);try{await this.platformAuthProvider.sendMessage(i)}catch(c){if(c instanceof pt&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(c.errorCode),tr(c)))throw c}this.browserStorage.setTemporaryCache(xe.NATIVE_REQUEST,JSON.stringify(i),!0);const o={apiId:le.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...o}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(xe.NATIVE_REQUEST));const a=Ge();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const c=await this.platformAuthProvider.sendMessage(o),l=await this.handleNativeResponse(c,o,a);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),l}catch(c){throw c}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var h,u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=gr(e.id_token,ct),o=this.createHomeAccountIdentifier(e,i),a=(h=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId))==null?void 0:h.homeAccountId;if((u=t.extraParameters)!=null&&u.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(o!==a&&e.account.id!==t.accountId)throw Rs(kl);const c=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=wi(this.browserStorage,c,o,ct,this.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const d=await this.generateAuthenticationResult(e,t,i,l,c.canonicalAuthority,r);return await this.cacheAccount(l,this.correlationId),await this.cacheNativeTokens(e,t,o,i,e.access_token,d.tenantId,r),d}createHomeAccountIdentifier(e,t){return nt.generateHomeAccountId(e.client_info||T.EMPTY_STRING,it.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?ke.fromString(t):ke.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===ce.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new dr(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw R(Wn);return r.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,r,i,o,a){const c=this.addTelemetryFromNativeResponse(e.properties.MATS),l=this.generateScopes(t.scope,e.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||T.EMPTY_STRING,u=d.TenantId||r.tid||T.EMPTY_STRING,y=si(i.getAccountInfo(),void 0,r,e.id_token);y.nativeAccountId!==e.account.id&&(y.nativeAccountId=e.account.id);const x=await this.generatePopAccessToken(e,t),U=t.tokenType===ce.POP?ce.POP:ce.BEARER;return{authority:o,uniqueId:h,tenantId:u,scopes:l.asArray(),account:y,idToken:e.id_token,idTokenClaims:r,accessToken:x,fromCache:c?this.isResponseFromCache(c):!1,expiresOn:ar(a+e.expires_in),tokenType:U,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e.getAccountInfo(),t)}cacheNativeTokens(e,t,r,i,o,a,c){const l=zs(r,t.authority,e.id_token||"",t.clientId,i.tid||""),d=t.tokenType===ce.POP?T.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=c+d,u=this.generateScopes(e.scope,t.scope),y=Gs(r,t.authority,o,t.clientId,i.tid||a,u.printScopes(),h,0,ct,void 0,t.tokenType,void 0,t.keyId),x={idToken:l,accessToken:y};return this.nativeStorageManager.saveCacheRecord(x,this.correlationId,t.storeInCache)}getExpiresInValue(e,t){return e===ce.POP?T.SHR_NONCE_VALIDITY:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:r,...i}=e,o=new ke(r||[]);o.appendScopes(ur);const a={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(a.signPopToken&&e.popKid)throw L(tl);if(this.handleExtraBrokerParams(a),a.extraParameters=a.extraParameters||{},a.extraParameters.telemetry=rt.MATS_TELEMETRY,e.authenticationScheme===ce.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},l=new dr(this.browserCrypto);let d;if(a.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:a.keyId})),a.signPopToken=!1;else{const h=await I(l.generateCnf.bind(l),p.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(c,this.logger);d=h.reqCnfString,a.keyId=h.kid,a.signPopToken=!0}a.reqCnf=d}return this.addRequestSKUs(a),a}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new oe(t);return r.validateAsUri(),r}getPrompt(e){switch(this.apiId){case le.ssoSilent:case le.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Fe.NONE}if(!e){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e){case Fe.NONE:case Fe.CONSENT:case Fe.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),L(Zc)}}handleExtraBrokerParams(e){var o;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(ks)&&e.extraParameters.hasOwnProperty(Cs)&&e.extraParameters.hasOwnProperty(Gt);if(!e.embeddedClientId&&!t)return;let r="";const i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Cs],r=e.extraParameters[Gt]),e.extraParameters={child_client_id:r,child_redirect_uri:i},(o=this.performanceClient)==null||o.addFields({embeddedClientId:r,embeddedRedirectUri:i},this.correlationId)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Bi(n,e,t,r,i){const o=Su({...n.auth,authority:e},t,r,i);if(ui(o,{sku:Be.MSAL_SKU,version:Vt,os:"",cpu:""}),n.auth.protocolMode!==ze.OIDC&&gi(o,n.telemetry.application),t.platformBroker&&($h(o),i.addFields({isPlatformAuthorizeRequest:!0},t.correlationId),t.authenticationScheme===ce.POP)){const a=new St(r,i),c=new dr(a);let l;t.popKid?l=a.encodeKid(t.popKid):l=(await I(c.generateCnf.bind(c),p.PopTokenGenerateCnf,r,i,t.correlationId)(t,r)).reqCnfString,pi(o,l)}return $s(o,t.correlationId,i),o}async function Ki(n,e,t,r,i){if(!t.codeChallenge)throw ue(Zn);const o=await I(Bi,p.GetStandardParams,r,i,t.correlationId)(n,e,t,r,i);return oi(o,$n.CODE),cc(o,t.codeChallenge,T.S256_CODE_CHALLENGE_METHOD),Pt(o,t.extraQueryParameters||{}),vi(e,o,n.auth.encodeExtraQueryParams,t.extraQueryParameters)}async function zi(n,e,t,r,i,o){if(!r.earJwk)throw L(_i);const a=await Bi(e,t,r,i,o);oi(a,$n.IDTOKEN_TOKEN_REFRESHTOKEN),Xh(a,r.earJwk);const c=new Map;Pt(c,r.extraQueryParameters||{});const l=vi(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return Sl(n,l,a)}async function Gi(n,e,t,r,i,o){const a=await Bi(e,t,r,i,o);oi(a,$n.CODE),cc(a,r.codeChallenge,r.codeChallengeMethod||T.S256_CODE_CHALLENGE_METHOD),Zh(a,r.authorizePostBodyParameters||{});const c=new Map;Pt(c,r.extraQueryParameters||{});const l=vi(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return Sl(n,l,a)}function Sl(n,e,t){const r=n.createElement("form");return r.method="post",r.action=e,t.forEach((i,o)=>{const a=n.createElement("input");a.hidden=!0,a.name=o,a.value=i,r.appendChild(a)}),n.body.appendChild(r),r}async function _l(n,e,t,r,i,o,a,c,l,d){if(c.verbose("Account id found, calling WAM for token"),!d)throw L(Ni);const h=new St(c,l),u=new gs(r,i,h,c,a,r.system.navigationClient,t,l,d,e,o,n.correlationId),{userRequestState:y}=mr.parseRequestState(h,n.state);return I(u.acquireToken.bind(u),p.NativeInteractionClientAcquireToken,c,l,n.correlationId)({...n,state:y,prompt:void 0})}async function js(n,e,t,r,i,o,a,c,l,d,h,u){if(mt.removeThrottle(a,i.auth.clientId,n),e.accountId)return I(_l,p.HandleResponsePlatformBroker,d,h,n.correlationId)(n,e.accountId,r,i,a,c,l,d,h,u);const y={...n,code:e.code||"",codeVerifier:t},x=new vl(o,a,y,d,h);return await I(x.handleCodeResponse.bind(x),p.HandleCodeResponse,d,h,n.correlationId)(e,n)}async function qi(n,e,t,r,i,o,a,c,l,d,h){if(mt.removeThrottle(o,r.auth.clientId,n),_c(e,n.state),!e.ear_jwe)throw L(Nc);if(!n.earJwk)throw L(_i);const u=JSON.parse(await I(Zu,p.DecryptEarResponse,l,d,n.correlationId)(n.earJwk,e.ear_jwe));if(u.accountId)return I(_l,p.HandleResponsePlatformBroker,l,d,n.correlationId)(n,u.accountId,t,r,o,a,c,l,d,h);const y=new qt(r.auth.clientId,o,new St(l,d),l,null,null,d);y.validateTokenResponse(u);const x={code:"",state:n.state,nonce:n.nonce,client_info:u.client_info,cloud_graph_host_name:u.cloud_graph_host_name,cloud_instance_host_name:u.cloud_instance_host_name,cloud_instance_name:u.cloud_instance_name,msgraph_host:u.msgraph_host};return await I(y.handleServerTokenResponse.bind(y),p.HandleServerTokenResponse,l,d,n.correlationId)(u,i,Ge(),n,x,void 0,void 0,void 0,void 0)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const qg=32;async function Zs(n,e,t){n.addQueueMeasurement(p.GeneratePkceCodes,t);const r=Ze(Vg,p.GenerateCodeVerifier,e,n,t)(n,e,t),i=await I(Wg,p.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:i}}function Vg(n,e,t){try{const r=new Uint8Array(qg);return Ze(Wu,p.GetRandomValues,e,n,t)(r),Mt(r)}catch{throw L(Si)}}async function Wg(n,e,t,r){e.addQueueMeasurement(p.GenerateCodeChallengeFromVerifier,r);try{const i=await I(cl,p.Sha256Digest,t,e,r)(n,e,r);return Mt(new Uint8Array(i))}catch{throw L(Si)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ps{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(p.NativeMessageHandlerHandshake),this.platformAuthType=rt.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:vr.GetToken,request:e},r={channel:rt.CHANNEL_ID,extensionId:this.extensionId,responseId:dt(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(r)}`),this.messageChannel.port1.postMessage(r);const i=await new Promise((a,c)=>{this.resolvers.set(r.responseId,{resolve:a,reject:c})});return this.validatePlatformBrokerResponse(i)}static async createProvider(e,t,r){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const i=new Ps(e,t,r,rt.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const o=new Ps(e,t,r);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:rt.CHANNEL_ID,extensionId:this.extensionId,responseId:dt(),body:{method:vr.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(L(Jc)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==rt.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===vr.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(L(Xc))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const o=t.body.method;if(o===vr.Response){if(!r)return;const a=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(a)}`),a.status!=="Success")r.reject(Rs(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?r.reject(Rs(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result);else throw wn(fs,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(o===vr.HandshakeResponse){if(!i){this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(o){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${o}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(o):i&&i.reject(o)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw wn(fs,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){var e;return this.getExtensionId()===rt.PREFERRED_EXTENSION_ID?"chrome":(e=this.getExtensionId())!=null&&e.length?"unknown":void 0}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Vi{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=rt.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,r){var i;if(e.trace("PlatformAuthDOMHandler: createProvider called"),(i=window.navigator)!=null&&i.platformAuthentication){const o=await window.navigator.platformAuthentication.getSupportedContracts(rt.MICROSOFT_ENTRA_BROKERID);if(o!=null&&o.includes(rt.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new Vi(e,t,r)}}getExtensionId(){return rt.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return rt.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r)}catch(t){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),t}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:r,authority:i,scope:o,redirectUri:a,correlationId:c,state:l,storeInCache:d,embeddedClientId:h,extraParameters:u,...y}=e,x=this.getDOMExtraParams(y);return{accountId:t,brokerId:this.getExtensionId(),authority:i,clientId:r,correlationId:c||this.correlationId,extraParameters:{...u,...x},isSecurityTokenService:!1,redirectUri:a,scope:o,state:l,storeInCache:d,embeddedClientId:h}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(t.isSuccess===!1&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),Rs(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw wn(fs,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((i,[o,a])=>(i[o]=String(a),i),{})}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Qg(n,e,t,r){n.trace("getPlatformAuthProvider called",t);const i=Yg();n.trace("Has client allowed platform auth via DOM API: "+i);let o;try{i&&(o=await Vi.createProvider(n,e,t)),o||(n.trace("Platform auth via DOM API not available, checking for extension"),o=await Ps.createProvider(n,r||yl,e))}catch(a){n.trace("Platform auth not available",a)}return o}function Yg(){let n;try{return n=window[Ce.SessionStorage],(n==null?void 0:n.getItem(fg))==="true"}catch{return!1}}function Ur(n,e,t,r){if(e.trace("isPlatformAuthAllowed called"),!n.system.allowPlatformBroker)return e.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!t)return e.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(r)switch(r){case ce.BEARER:case ce.POP:return e.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return e.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Jg extends fr{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,c,d,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l,this.eventHandler=o}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||ur,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t);{const o={...e,httpMethod:wl(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(o,r,t)}}catch(i){return Promise.reject(i)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("acquireTokenPopupAsync called");const i=await I(this.initializeAuthorizationRequest.bind(this),p.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,B.Popup);t.popup&&fl(i.authority);const o=Ur(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return i.platformBroker=o,this.config.auth.protocolMode===ze.EAR?this.executeEarFlow(i,t):this.executeCodeFlow(i,t,r)}async executeCodeFlow(e,t,r){var l;const i=e.correlationId,o=this.initializeServerTelemetryManager(le.acquireTokenPopup),a=r||await I(Zs,p.GeneratePkceCodes,this.logger,this.performanceClient,i)(this.performanceClient,this.logger,i),c={...e,codeChallenge:a.challenge};try{const d=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,i)({serverTelemetryManager:o,requestAuthority:c.authority,requestAzureCloudOptions:c.azureCloudOptions,requestExtraQueryParameters:c.extraQueryParameters,account:c.account});if(c.httpMethod===Ft.POST)return await this.executeCodeFlowWithPost(c,t,d,a.verifier);{const h=await I(Ki,p.GetAuthCodeUrl,this.logger,this.performanceClient,i)(this.config,d.authority,c,this.logger,this.performanceClient),u=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(D.POPUP_OPENED,B.Popup,{popupWindow:u},null);const y=await this.monitorPopupForHash(u,t.popupWindowParent),x=Ze(Er,p.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(y,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await I(js,p.HandleResponseCode,this.logger,this.performanceClient,i)(e,x,a.verifier,le.acquireTokenPopup,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(d){throw(l=t.popup)==null||l.close(),d instanceof de&&(d.setCorrelationId(this.correlationId),o.cacheFailedRequest(d)),d}}async executeEarFlow(e,t){const r=e.correlationId,i=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await I(Oi,p.GenerateEarKey,this.logger,this.performanceClient,r)(),a={...e,earJwk:o},c=t.popup||this.openPopup("about:blank",t);(await zi(c.document,this.config,i,a,this.logger,this.performanceClient)).submit();const d=await I(this.monitorPopupForHash.bind(this),p.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,t.popupWindowParent),h=Ze(Er,p.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return I(qi,p.HandleResponseEar,this.logger,this.performanceClient,r)(a,h,le.acquireTokenPopup,this.config,i,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,i){const o=e.correlationId,a=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),c=t.popup||this.openPopup("about:blank",t);(await Gi(c.document,this.config,a,e,this.logger,this.performanceClient)).submit();const d=await I(this.monitorPopupForHash.bind(this),p.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(c,t.popupWindowParent),h=Ze(Er,p.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return I(js,p.HandleResponseCode,this.logger,this.performanceClient,o)(e,h,i,le.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,i){var a,c,l;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(D.LOGOUT_START,B.Popup,e);const o=this.initializeServerTelemetryManager(le.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const d=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r,account:e.account||void 0});try{d.authority.endSessionEndpoint}catch{if((a=e.account)!=null&&a.homeAccountId&&e.postLogoutRedirectUri&&d.authority.protocolMode===ze.OIDC){if(this.eventHandler.emitEvent(D.LOGOUT_SUCCESS,B.Popup,e),i){const y={apiId:le.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},x=oe.getAbsoluteUrl(i,kt());await this.navigationClient.navigateInternal(x,y)}(c=t.popup)==null||c.close();return}}const h=d.getLogoutUri(e);this.eventHandler.emitEvent(D.LOGOUT_SUCCESS,B.Popup,e);const u=this.openPopup(h,t);if(this.eventHandler.emitEvent(D.POPUP_OPENED,B.Popup,{popupWindow:u},null),await this.monitorPopupForHash(u,t.popupWindowParent).catch(()=>{}),i){const y={apiId:le.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},x=oe.getAbsoluteUrl(i,kt());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${x}`),await this.navigationClient.navigateInternal(x,y)}else this.logger.verbose("No main window navigation requested")}catch(d){throw(l=t.popup)==null||l.close(),d instanceof de&&(d.setCorrelationId(this.correlationId),o.cacheFailedRequest(d)),this.eventHandler.emitEvent(D.LOGOUT_FAILURE,B.Popup,null,d),this.eventHandler.emitEvent(D.LOGOUT_END,B.Popup),d}this.eventHandler.emitEvent(D.LOGOUT_END,B.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),L(Qs)}monitorPopupForHash(e,t){return new Promise((r,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),i(L(Dr));return}let a="";try{a=e.location.href}catch{}if(!a||a==="about:blank")return;clearInterval(o);let c="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===Hs.QUERY?c=e.location.search:c=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(c)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw L(Dc);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),L(Mc)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){var x,U,N,v;const o=i.screenLeft?i.screenLeft:i.screenX,a=i.screenTop?i.screenTop:i.screenY,c=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let d=(x=r.popupSize)==null?void 0:x.width,h=(U=r.popupSize)==null?void 0:U.height,u=(N=r.popupPosition)==null?void 0:N.top,y=(v=r.popupPosition)==null?void 0:v.left;return(!d||d<0||d>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),d=Be.POPUP_WIDTH),(!h||h<0||h>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=Be.POPUP_HEIGHT),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,l/2-Be.POPUP_HEIGHT/2+a)),(!y||y<0||y>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),y=Math.max(0,c/2-Be.POPUP_WIDTH/2+o)),i.open(e,t,`width=${d}, height=${h}, top=${u}, left=${y}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${Be.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${Be.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Xg(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const n=window.performance.getEntriesByType("navigation"),e=n.length?n[0]:void 0;return e==null?void 0:e.type}class Zg extends fr{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,c,d,h),this.nativeStorage=l}async acquireToken(e){const t=await I(this.initializeAuthorizationRequest.bind(this),p.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,B.Redirect);t.platformBroker=Ur(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const r=o=>{o.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(D.RESTORE_FROM_BFCACHE,B.Redirect))},i=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${i}`),this.browserStorage.setTemporaryCache(xe.ORIGIN_URI,i,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===ze.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(o){throw o instanceof de&&o.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),o}}async executeCodeFlow(e,t){const r=e.correlationId,i=this.initializeServerTelemetryManager(le.acquireTokenRedirect),o=await I(Zs,p.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),a={...e,codeChallenge:o.challenge};this.browserStorage.cacheAuthorizeRequest(a,o.verifier);try{if(a.httpMethod===Ft.POST)return await this.executeCodeFlowWithPost(a);{const c=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account}),l=await I(Ki,p.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,c.authority,a,this.logger,this.performanceClient);return await this.initiateAuthRequest(l,t)}}catch(c){throw c instanceof de&&(c.setCorrelationId(this.correlationId),i.cacheFailedRequest(c)),c}}async executeEarFlow(e){const t=e.correlationId,r=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=await I(Oi,p.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:i};return this.browserStorage.cacheAuthorizeRequest(o),(await zi(document,this.config,r,o,this.logger,this.performanceClient)).submit(),new Promise((c,l)=>{setTimeout(()=>{l(L(Ns,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await Gi(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((o,a)=>{setTimeout(()=>{a(L(Ns,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,r,i){const o=this.initializeServerTelemetryManager(le.handleRedirectPromise);try{const[a,c]=this.getRedirectResponse(e||"");if(!a)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),Xg()!=="back_forward"?i.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const l=this.browserStorage.getTemporaryCache(xe.ORIGIN_URI,!0)||T.EMPTY_STRING,d=ko(l),h=ko(window.location.href);if(d===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&rg(l),await this.handleResponse(a,t,r,o);if(this.config.auth.navigateToLoginRequestUrl){if(!Li()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(xe.URL_HASH,c,!0);const u={apiId:le.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let y=!0;if(!l||l==="null"){const x=ng();this.browserStorage.setTemporaryCache(xe.ORIGIN_URI,x,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),y=await this.navigationClient.navigateInternal(x,u)}else this.logger.verbose(`Navigating to loginRequestUrl: ${l}`),y=await this.navigationClient.navigateInternal(l,u);if(!y)return await this.handleResponse(a,t,r,o)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(a,t,r,o);return null}catch(a){throw a instanceof de&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Hs.QUERY?t=window.location.search:t=window.location.hash);let r=xs(t);if(r){try{Dg(r,this.browserCrypto,B.Redirect)}catch(o){return o instanceof de&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return gl(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(xe.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(xe.URL_HASH)),i&&(r=xs(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t,r,i){if(!e.state)throw L(Ai);if(e.ear_jwe){const c=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return I(qi,p.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,le.acquireTokenRedirect,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const a=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:t.authority});return I(js,p.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,le.acquireTokenRedirect,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:le.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=t||this.config.auth.onRedirectNavigate;if(typeof i=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),i(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await this.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await this.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),L(Qs)}async logout(e){var i;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(le.logout);try{this.eventHandler.emitEvent(D.LOGOUT_START,B.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const o={apiId:le.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===ze.OIDC)try{a.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.eventHandler.emitEvent(D.LOGOUT_SUCCESS,B.Redirect,t);return}}const c=a.getLogoutUri(t);if(this.eventHandler.emitEvent(D.LOGOUT_SUCCESS,B.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(c)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Tt.SIGNOUT),await this.navigationClient.navigateExternal(c,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Tt.SIGNOUT),await this.navigationClient.navigateExternal(c,o);return}}catch(o){throw o instanceof de&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(D.LOGOUT_FAILURE,B.Redirect,null,o),this.eventHandler.emitEvent(D.LOGOUT_END,B.Redirect),o}this.eventHandler.emitEvent(D.LOGOUT_END,B.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return oe.getAbsoluteUrl(t,kt())}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function em(n,e,t,r,i){if(e.addQueueMeasurement(p.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),L(Qs);return i?I(sm,p.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):Ze(nm,p.SilentHandlerLoadFrameSync,t,e,r)(n)}async function tm(n,e,t,r,i){const o=en();if(!o.contentDocument)throw"No document associated with iframe!";return(await Gi(o.contentDocument,n,e,t,r,i)).submit(),o}async function rm(n,e,t,r,i){const o=en();if(!o.contentDocument)throw"No document associated with iframe!";return(await zi(o.contentDocument,n,e,t,r,i)).submit(),o}async function Xo(n,e,t,r,i,o,a){return r.addQueueMeasurement(p.SilentHandlerMonitorIframeForHash,o),new Promise((c,l)=>{e<Rn&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Rn}ms). This may result in timeouts.`);const d=window.setTimeout(()=>{window.clearInterval(h),l(L(Lc))},e),h=window.setInterval(()=>{let u="";const y=n.contentWindow;try{u=y?y.location.href:""}catch{}if(!u||u==="about:blank")return;let x="";y&&(a===Hs.QUERY?x=y.location.search:x=y.location.hash),window.clearTimeout(d),window.clearInterval(h),c(x)},t)}).finally(()=>{Ze(im,p.RemoveHiddenIframe,i,r,o)(n)})}function sm(n,e,t,r){return t.addQueueMeasurement(p.SilentHandlerLoadFrame,r),new Promise((i,o)=>{const a=en();window.setTimeout(()=>{if(!a){o("Unable to load iframe");return}a.src=n,i(a)},e)})}function nm(n){const e=en();return e.src=n,e}function en(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function im(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class om extends fr{constructor(e,t,r,i,o,a,c,l,d,h,u){super(e,t,r,i,o,a,l,h,u),this.apiId=c,this.nativeStorage=d}async acquireToken(e){this.performanceClient.addQueueMeasurement(p.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Fe.NONE&&t.prompt!==Fe.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Fe.NONE}`),t.prompt=Fe.NONE):t.prompt=Fe.NONE;const r=await I(this.initializeAuthorizationRequest.bind(this),p.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,B.Silent);return r.platformBroker=Ur(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),fl(r.authority),this.config.auth.protocolMode===ze.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const r=this.initializeServerTelemetryManager(this.apiId);try{return t=await I(this.createAuthCodeClient.bind(this),p.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await I(this.silentTokenHelper.bind(this),p.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(i){if(i instanceof de&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),!t||!(i instanceof de)||i.errorCode!==Be.INVALID_GRANT_ERROR)throw i;return this.performanceClient.addFields({retryError:i.errorCode},this.correlationId),await I(this.silentTokenHelper.bind(this),p.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,r=await I(this.getDiscoveredAuthority.bind(this),p.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=await I(Oi,p.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:i},a=await I(rm,p.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,o,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await I(Xo,p.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),d=Ze(Er,p.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);return I(qi,p.HandleResponseEar,this.logger,this.performanceClient,t)(o,d,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(L(Ys))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(p.SilentIframeClientTokenHelper,r);const i=await I(Zs,p.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),o={...t,codeChallenge:i.challenge};let a;if(t.httpMethod===Ft.POST)a=await I(tm,p.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);else{const h=await I(Ki,p.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);a=await I(em,p.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(h,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait)}const c=this.config.auth.OIDCOptions.serverResponseType,l=await I(Xo,p.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),d=Ze(Er,p.DeserializeResponse,this.logger,this.performanceClient,r)(l,c,this.logger);return I(js,p.HandleResponseCode,this.logger,this.performanceClient,r)(t,d,i.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class am extends fr{async acquireToken(e){this.performanceClient.addQueueMeasurement(p.SilentRefreshClientAcquireToken,e.correlationId);const t=await I($i,p.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(le.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return I(o.acquireTokenByRefreshToken.bind(o),p.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(a=>{throw a.setCorrelationId(this.correlationId),i.cacheFailedRequest(a),a})}logout(){return Promise.reject(L(Ys))}async createRefreshTokenClient(e){const t=await I(this.getClientConfiguration.bind(this),p.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new vu(t,this.performanceClient)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class cm{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}async loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw L(Js);const i=e.correlationId||dt(),o=t.id_token?gr(t.id_token,ct):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new Me(Me.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||dt()):void 0,l=await this.loadAccount(e,r.clientInfo||t.client_info||"",i,o,c),d=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,i),h=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,r,i),u=await this.loadRefreshToken(t,l.homeAccountId,l.environment,i);return this.generateAuthenticationResult(e,{account:l,idToken:d,accessToken:h,refreshToken:u},o,c)}async loadAccount(e,t,r,i,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const d=nt.createFromAccountInfo(e.account);return await this.storage.setAccount(d,r),d}else if(!o||!t&&!i)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),L(qc);const a=nt.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,i),c=i==null?void 0:i.tid,l=wi(this.storage,o,a,ct,r,i,t,o.hostnameAndPort,c,void 0,void 0,this.logger);return await this.storage.setAccount(l,r),l}async loadIdToken(e,t,r,i,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=zs(t,r,e.id_token,this.config.auth.clientId,i);return await this.storage.setIdTokenCredential(a,o),a}async loadAccessToken(e,t,r,i,o,a,c){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?ke.fromString(t.scope):new ke(e.scopes),d=a.expiresOn||t.expires_in+Ge(),h=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+Ge(),u=Gs(r,i,t.access_token,this.config.auth.clientId,o,l.printScopes(),d,h,ct);return await this.storage.setAccessTokenCredential(u,c),u}async loadRefreshToken(e,t,r,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=yc(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(o,i),o}generateAuthenticationResult(e,t,r,i){var h,u,y;let o="",a=[],c=null,l;t!=null&&t.accessToken&&(o=t.accessToken.secret,a=ke.fromString(t.accessToken.target).asArray(),c=ar(t.accessToken.expiresOn),l=ar(t.accessToken.extendedExpiresOn));const d=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:d.getAccountInfo(),idToken:((h=t.idToken)==null?void 0:h.secret)||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((u=t.refreshToken)==null?void 0:u.familyId)||"",tokenType:((y=t==null?void 0:t.accessToken)==null?void 0:y.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class lm extends Sc{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class dm extends fr{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,l,d,h),this.apiId=c}async acquireToken(e){if(!e.code)throw L(Vc);const t=await I(this.initializeAuthorizationRequest.bind(this),p.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,B.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},o=await I(this.getClientConfiguration.bind(this),p.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new lm(o);this.logger.verbose("Auth code client created");const c=new vl(a,this.browserStorage,i,this.logger,this.performanceClient);return await I(c.handleCodeResponseFromServer.bind(c),p.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof de&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}logout(){return Promise.reject(L(Ys))}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function hm(n,e,t){var a;const r=((a=window.msal)==null?void 0:a.clientIds)||[],i=r.length,o=r.filter(c=>c===n).length;o>1&&t.warning("There is already an instance of MSAL.js in the window with the same client id."),e.add({msalInstanceCount:i,sameClientIdInstanceCount:o})}/*! @azure/msal-browser v4.23.0 2025-09-17 */function ut(n){const e=n==null?void 0:n.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function ss(n,e){try{Ui(n)}catch(t){throw e.end({success:!1},t),t}}class tn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new St(this.logger,this.performanceClient):ys,this.eventHandler=new Pg(this.logger),this.browserStorage=this.isBrowserEnvironment?new Mn(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,uu(this.config.auth)):Sg(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Ce.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Ce.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Mn(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new cm(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new tn(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(D.INITIALIZE_END);return}const r=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),i=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(p.InitializeClientApplication,r);if(this.eventHandler.emitEvent(D.INITIALIZE_START),!t)try{this.logMultipleInstances(o)}catch{}if(await I(this.browserStorage.initialize.bind(this.browserStorage),p.InitializeCache,this.logger,this.performanceClient,r)(r),i)try{this.platformAuthProvider=await Qg(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(a){this.logger.verbose(a)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),Ze(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),p.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(r)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(D.INITIALIZE_END),o.end({allowPlatformBroker:i,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),pl(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){var l;if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(((l=this.browserStorage.getInteractionInProgress())==null?void 0:l.type)===Tt.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),i=this.browserStorage.getCachedNativeRequest(),o=i&&this.platformAuthProvider&&!e;let a;this.eventHandler.emitEvent(D.HANDLE_REDIRECT_START,B.Redirect);let c;try{if(o&&this.platformAuthProvider){a=this.performanceClient.startMeasurement(p.AcquireTokenRedirect,(i==null?void 0:i.correlationId)||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a.add({isPlatformBrokerRequest:!0});const d=new gs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,le.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,i.accountId,this.nativeInternalStorage,i.correlationId);c=I(d.handleRedirectPromise.bind(d),p.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(this.performanceClient,a.event.correlationId)}else{const[d,h]=this.browserStorage.getCachedRequest(),u=d.correlationId;a=this.performanceClient.startMeasurement(p.AcquireTokenRedirect,u),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const y=this.createRedirectClient(u);c=I(y.handleRedirectPromise.bind(y),p.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(e,d,h,a)}}catch(d){throw this.browserStorage.resetRequestCache(),d}return c.then(d=>(d?(this.browserStorage.resetRequestCache(),r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(D.LOGIN_SUCCESS,B.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_SUCCESS,B.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),a.end({success:!0,accountType:ut(d.account)})):a.event.errorCode?a.end({success:!1}):a.discard(),this.eventHandler.emitEvent(D.HANDLE_REDIRECT_END,B.Redirect),d)).catch(d=>{this.browserStorage.resetRequestCache();const h=d;throw r.length>0?this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_FAILURE,B.Redirect,null,h):this.eventHandler.emitEvent(D.LOGIN_FAILURE,B.Redirect,null,h),this.eventHandler.emitEvent(D.HANDLE_REDIRECT_END,B.Redirect),a.end({success:!1},h),d})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(p.AcquireTokenPreRedirect,t);r.add({accountType:ut(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=a=>{const c=typeof i=="function"?i(a):void 0;return r.add({navigateCallbackResult:c!==!1}),r.event=r.end({success:!0})||r.event,c};else{const a=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=c=>{const l=typeof a=="function"?a(c):void 0;return r.add({navigateCallbackResult:l!==!1}),r.event=r.end({success:!0})||r.event,l}}const o=this.getAllAccounts().length>0;try{Bo(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Tt.SIGNIN),o?this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_START,B.Redirect,e):this.eventHandler.emitEvent(D.LOGIN_START,B.Redirect,e);let a;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?a=new gs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,le.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(l=>{if(r.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof pt&&tr(l))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof lt)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw l}):a=this.createRedirectClient(t).acquireToken(e),await a}catch(a){throw this.browserStorage.resetRequestCache(),r.event.status===2?this.performanceClient.startMeasurement(p.AcquireTokenRedirect,t).end({success:!1},a):r.end({success:!1},a),o?this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_FAILURE,B.Redirect,null,a):this.eventHandler.emitEvent(D.LOGIN_FAILURE,B.Redirect,null,a),a}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(p.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:ut(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),ss(this.initialized,r),this.browserStorage.setInteractionInProgress(!0,Tt.SIGNIN)}catch(c){return Promise.reject(c)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_START,B.Popup,e):this.eventHandler.emitEvent(D.LOGIN_START,B.Popup,e);let o;const a=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?(r.add({isPlatformBrokerRequest:!0}),o=this.acquireTokenNative({...e,correlationId:t},le.acquireTokenPopup).then(c=>(r.end({success:!0,accountType:ut(c.account)}),c)).catch(c=>{if(r.add({brokerErrorName:c.name,brokerErrorCode:c.errorCode}),c instanceof pt&&tr(c))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,a);if(c instanceof lt)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,a);throw c})):o=this.createPopupClient(t).acquireToken(e,a),o.then(c=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(D.LOGIN_SUCCESS,B.Popup,c):this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_SUCCESS,B.Popup,c),r.end({success:!0,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:ut(c.account)}),c)).catch(c=>(i.length>0?this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_FAILURE,B.Popup,null,c):this.eventHandler.emitEvent(D.LOGIN_FAILURE,B.Popup,null,c),r.end({success:!1},c),Promise.reject(c))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var o,a,c;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(p.SsoSilent,t),(o=this.ssoSilentMeasurement)==null||o.add({scenarioId:e.scenarioId,accountType:ut(e.account)}),ss(this.initialized,this.ssoSilentMeasurement),(a=this.ssoSilentMeasurement)==null||a.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(D.SSO_SILENT_START,B.Silent,r);let i;return this.canUsePlatformBroker(r)?((c=this.ssoSilentMeasurement)==null||c.add({isPlatformBrokerRequest:!0}),i=this.acquireTokenNative(r,le.ssoSilent).catch(l=>{var d;if((d=this.ssoSilentMeasurement)==null||d.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof pt&&tr(l))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw l})):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(l=>{var d;return this.eventHandler.emitEvent(D.SSO_SILENT_SUCCESS,B.Silent,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!0,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length,accountType:ut(l.account)}),l}).catch(l=>{var d;throw this.eventHandler.emitEvent(D.SSO_SILENT_FAILURE,B.Silent,null,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!1},l),l}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(p.AcquireTokenByCode,t);ss(this.initialized,r),this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_BY_CODE_START,B.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw L(Qc);if(e.code){const i=e.code;let o=this.hybridAuthCodeResponses.get(i);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(a=>(this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_BY_CODE_SUCCESS,B.Silent,a),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:ut(a.account)}),a)).catch(a=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_BY_CODE_FAILURE,B.Silent,null,a),r.end({success:!1},a),a}),this.hybridAuthCodeResponses.set(i,o)),await o}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){r.add({isPlatformBrokerRequest:!0});const i=await this.acquireTokenNative({...e,correlationId:t},le.acquireTokenByCode,e.nativeAccountId).catch(o=>{throw o instanceof pt&&tr(o)&&(this.platformAuthProvider=void 0),r.add({brokerErrorName:o.name,brokerErrorCode:o.errorCode}),o});return r.end({accountType:ut(i.account),success:!0}),i}else throw L(Yc);else throw L(Wc)}catch(i){throw this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_BY_CODE_FAILURE,B.Silent,null,i),r.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(p.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>{var a;return(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!0,fromCache:o.fromCache}),o}).catch(o=>{var a;throw(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(p.AcquireTokenFromCache,e.correlationId),t){case Le.Default:case Le.AccessToken:case Le.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return I(r.acquireToken.bind(r),p.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw R(jt)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(p.AcquireTokenByRefreshToken,e.correlationId),t){case Le.Default:case Le.AccessTokenAndRefreshToken:case Le.RefreshToken:case Le.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return I(r.acquireToken.bind(r),p.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw R(jt)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(p.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return I(t.acquireToken.bind(t),p.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Bo(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Tt.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Ui(this.initialized),this.browserStorage.setInteractionInProgress(!0,Tt.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return _g(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return Ag(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return Ig(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return Tg(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return Ng(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();Eg(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return Rg(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=nt.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,i){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw L(Ni);return new gs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,i)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!Ur(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Fe.NONE:case Fe.CONSENT:case Fe.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Jg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new Zg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new om(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,le.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new Cl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new am(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new dm(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,le.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return ml(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Ce.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Ce.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?dt():T.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Lo})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Lo})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(p.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),ss(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw L($c);return r.add({accountType:ut(i)}),this.acquireTokenSilentDeduped(e,i,t).then(o=>(r.end({success:!0,fromCache:o.fromCache,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),{...o,state:e.state,correlationId:t})).catch(o=>{throw o instanceof de&&o.setCorrelationId(t),r.end({success:!1},o),o})}async acquireTokenSilentDeduped(e,t,r){const i=qs(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),o=JSON.stringify(i),a=this.activeSilentTokenRequests.get(o);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);const c=I(this.acquireTokenSilentAsync.bind(this),p.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(o,c),c.finally(()=>{this.activeSilentTokenRequests.delete(o)})}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),a}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(p.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_START,B.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await I(Og,p.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||Le.Default;return this.acquireTokenSilentNoIframe(i,o).catch(async c=>{if(um(c,o))if(this.activeIframeRequest)if(o!==Le.Skip){const[d,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,i.correlationId);const u=this.performanceClient.startMeasurement(p.AwaitConcurrentIframe,i.correlationId);u.add({awaitIframeCorrelationId:h});const y=await d;if(u.end({success:y}),y)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,o);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),c}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),I(this.acquireTokenBySilentIframe.bind(this),p.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let d;return this.activeIframeRequest=[new Promise(h=>{d=h}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),I(this.acquireTokenBySilentIframe.bind(this),p.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(h=>(d(!0),h)).catch(h=>{throw d(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw c}).then(c=>(this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_SUCCESS,B.Silent,c),e.correlationId&&this.performanceClient.addFields({fromCache:c.fromCache},e.correlationId),c)).catch(c=>{throw this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_FAILURE,B.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return Ur(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,le.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async r=>{throw this.performanceClient.addFields({brokerErrorName:r.name,brokerErrorCode:r.errorCode},e.correlationId),r instanceof pt&&tr(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,R(jt)):r})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===Le.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),I(this.acquireTokenFromCache.bind(this),p.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===Le.AccessToken)throw r;return this.eventHandler.emitEvent(D.ACQUIRE_TOKEN_NETWORK_START,B.Silent,e),I(this.acquireTokenByRefreshToken.bind(this),p.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await I(Zs,p.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),hm(t,e,this.logger)}}function um(n,e){const t=!(n instanceof lt&&n.subError!==Ws),r=n.errorCode===Be.INVALID_GRANT_ERROR||n.errorCode===jt,i=t&&r||n.errorCode===As||n.errorCode===xi,o=$u.includes(e);return i&&o}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function gm(n,e){const t=new Wt(n);return await t.initialize(),tn.createController(t,e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Wi{static async createPublicClientApplication(e){const t=await gm(e);return new Wi(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new tn(new Wt(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const mm={initialize:()=>Promise.reject(ye(Ie)),acquireTokenPopup:()=>Promise.reject(ye(Ie)),acquireTokenRedirect:()=>Promise.reject(ye(Ie)),acquireTokenSilent:()=>Promise.reject(ye(Ie)),acquireTokenByCode:()=>Promise.reject(ye(Ie)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(ye(Ie)),loginPopup:()=>Promise.reject(ye(Ie)),loginRedirect:()=>Promise.reject(ye(Ie)),logout:()=>Promise.reject(ye(Ie)),logoutRedirect:()=>Promise.reject(ye(Ie)),logoutPopup:()=>Promise.reject(ye(Ie)),ssoSilent:()=>Promise.reject(ye(Ie)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw ye(Ie)},getLogger:()=>{throw ye(Ie)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw ye(Ie)},hydrateCache:()=>Promise.reject(ye(Ie)),clearCache:()=>Promise.reject(ye(Ie))};/*! @azure/msal-browser v4.23.0 2025-09-17 */class pm{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case D.LOGIN_START:return ge.Login;case D.SSO_SILENT_START:return ge.SsoSilent;case D.ACQUIRE_TOKEN_START:if(e.interactionType===B.Redirect||e.interactionType===B.Popup)return ge.AcquireToken;break;case D.HANDLE_REDIRECT_START:return ge.HandleRedirect;case D.LOGOUT_START:return ge.Logout;case D.SSO_SILENT_SUCCESS:case D.SSO_SILENT_FAILURE:if(t&&t!==ge.SsoSilent)break;return ge.None;case D.LOGOUT_END:if(t&&t!==ge.Logout)break;return ge.None;case D.HANDLE_REDIRECT_END:if(t&&t!==ge.HandleRedirect)break;return ge.None;case D.LOGIN_SUCCESS:case D.LOGIN_FAILURE:case D.ACQUIRE_TOKEN_SUCCESS:case D.ACQUIRE_TOKEN_FAILURE:case D.RESTORE_FROM_BFCACHE:if(e.interactionType===B.Redirect||e.interactionType===B.Popup){if(t&&t!==ge.Login&&t!==ge.AcquireToken)break;return ge.None}break}return null}}/*! @azure/msal-react v3.0.19 2025-08-19 */const fm={instance:mm,inProgress:ge.None,accounts:[],logger:new Ct({})},Qi=m.createContext(fm);Qi.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */function Al(n,e){return typeof n=="function"?n(e):n}function Zo(n,e){if(n.length!==e.length)return!1;const t=[...e];return n.every(r=>{const i=t.shift();return!r||!i?!1:r.homeAccountId===i.homeAccountId&&r.localAccountId===i.localAccountId&&r.username===i.username})}function Il(n,e){return n.length>0&&(e.homeAccountId||e.localAccountId||e.username)&&n.filter(r=>!(e.username&&e.username.toLowerCase()!==r.username.toLowerCase()||e.homeAccountId&&e.homeAccountId.toLowerCase()!==r.homeAccountId.toLowerCase()||e.localAccountId&&e.localAccountId.toLowerCase()!==r.localAccountId.toLowerCase()))[0]||null}/*! @azure/msal-react v3.0.19 2025-08-19 */const ym="@azure/msal-react",ea="3.0.19";/*! @azure/msal-react v3.0.19 2025-08-19 */const Os={UNBLOCK_INPROGRESS:"UNBLOCK_INPROGRESS",EVENT:"EVENT"},xm=(n,e)=>{const{type:t,payload:r}=e;let i=n.inProgress;switch(t){case Os.UNBLOCK_INPROGRESS:n.inProgress===ge.Startup&&(i=ge.None,r.logger.info("MsalProvider - handleRedirectPromise resolved, setting inProgress to 'none'"));break;case Os.EVENT:const a=r.message,c=pm.getInteractionStatusFromEvent(a,n.inProgress);c&&(r.logger.info(`MsalProvider - ${a.eventType} results in setting inProgress from ${n.inProgress} to ${c}`),i=c);break;default:throw new Error(`Unknown action type: ${t}`)}if(i===ge.Startup)return n;const o=r.instance.getAllAccounts();return i!==n.inProgress&&!Zo(o,n.accounts)?{...n,inProgress:i,accounts:o}:i!==n.inProgress?{...n,inProgress:i}:Zo(o,n.accounts)?n:{...n,accounts:o}};function bm({instance:n,children:e}){m.useEffect(()=>{n.initializeWrapperLibrary(Uu.React,ea)},[n]);const t=m.useMemo(()=>n.getLogger().clone(ym,ea),[n]),[r,i]=m.useReducer(xm,void 0,()=>({inProgress:ge.Startup,accounts:[]}));m.useEffect(()=>{const a=n.addEventCallback(c=>{i({payload:{instance:n,logger:t,message:c},type:Os.EVENT})});return t.verbose(`MsalProvider - Registered event callback with id: ${a}`),n.initialize().then(()=>{n.handleRedirectPromise().catch(()=>{}).finally(()=>{i({payload:{instance:n,logger:t},type:Os.UNBLOCK_INPROGRESS})})}).catch(()=>{}),()=>{a&&(t.verbose(`MsalProvider - Removing event callback ${a}`),n.removeEventCallback(a))}},[n,t]);const o={instance:n,inProgress:r.inProgress,accounts:r.accounts,logger:t};return zt.createElement(Qi.Provider,{value:o},e)}/*! @azure/msal-react v3.0.19 2025-08-19 */const yr=()=>m.useContext(Qi);/*! @azure/msal-react v3.0.19 2025-08-19 */function wm(n,e){return e&&(e.username||e.homeAccountId||e.localAccountId)?!!Il(n,e):n.length>0}function Yi(n){const{accounts:e,inProgress:t}=yr();return m.useMemo(()=>t===ge.Startup?!1:wm(e,n),[e,t,n])}/*! @azure/msal-react v3.0.19 2025-08-19 */function vm({username:n,homeAccountId:e,localAccountId:t,children:r}){const i=yr(),o=m.useMemo(()=>({username:n,homeAccountId:e,localAccountId:t}),[n,e,t]);return Yi(o)&&i.inProgress!==ge.Startup?zt.createElement(zt.Fragment,null,Al(r,i)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function km({username:n,homeAccountId:e,localAccountId:t,children:r}){const i=yr(),o=m.useMemo(()=>({username:n,homeAccountId:e,localAccountId:t}),[n,e,t]);return!Yi(o)&&i.inProgress!==ge.Startup&&i.inProgress!==ge.HandleRedirect?zt.createElement(zt.Fragment,null,Al(r,i)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function ta(n,e){return!e||!e.homeAccountId&&!e.localAccountId&&!e.username?n.getActiveAccount():Il(n.getAllAccounts(),e)}function Cm(n){const{instance:e,inProgress:t,logger:r}=yr(),[i,o]=m.useState(()=>t===ge.Startup?null:ta(e,n));return m.useEffect(()=>{t!==ge.Startup&&o(a=>{const c=ta(e,n);return nt.accountInfoIsEqual(a,c,!0)?a:(r.info("useAccount - Updating account"),c)})},[t,n,e,r]),i}const Sm={auth:{clientId:{}.VITE_AZURE_CLIENT_ID||"your-client-id-here",authority:{}.VITE_AZURE_AUTHORITY||`https://login.microsoftonline.com/${{}.VITE_AZURE_TENANT_ID}`,redirectUri:{}.VITE_AZURE_REDIRECT_URI||window.location.origin,postLogoutRedirectUri:{}.VITE_AZURE_POST_LOGOUT_REDIRECT_URI||window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(n,e,t)=>{if(!t)switch(n){case 0:console.error("[MSAL Error]:",e);break;case 1:console.warn("[MSAL Warning]:",e);break;case 2:console.info("[MSAL Info]:",e);break;case 3:console.debug("[MSAL Verbose]:",e);break}}}}},_m={scopes:["openid","profile","email","User.Read"]},Am={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},he={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},bt={APP_ROLES:"roles",GROUPS:"groups"},Im="User",Ji=m.createContext(void 0),Lt=()=>{const n=m.useContext(Ji);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},Tm=n=>{const e=n.idTokenClaims,t=[];if(e!=null&&e[bt.APP_ROLES]){const r=Array.isArray(e[bt.APP_ROLES])?e[bt.APP_ROLES]:[e[bt.APP_ROLES]];t.push(...r)}return e!=null&&e[bt.GROUPS]&&(Array.isArray(e[bt.GROUPS])?e[bt.GROUPS]:[e[bt.GROUPS]]).forEach(i=>{i==={}.VITE_AZURE_AD_ADMIN_GROUP_ID?t.push(he.ADMIN):i==={}.VITE_AZURE_AD_CONTROL_PANEL_GROUP_ID&&t.push(he.CONTROL_PANEL)}),[...new Set(t)]},Nm=n=>n.includes(he.ADMIN)?he.ADMIN:n.includes(he.CONTROL_PANEL)?he.CONTROL_PANEL:Im,Em=n=>{if(!n)return null;const e=Tm(n),t=Nm(e),r=n.idTokenClaims;return{id:n.localAccountId||n.homeAccountId,email:n.username,name:n.name||n.username,roles:e,primaryRole:t,groups:(r==null?void 0:r[bt.GROUPS])||[],preferredUsername:r==null?void 0:r.preferred_username,tenantId:n.tenantId}},Rm=({children:n})=>{const{instance:e,accounts:t,inProgress:r}=yr(),i=Cm(t[0]||{}),o=Yi(),[a,c]=m.useState(null),[l,d]=m.useState(!0),[h,u]=m.useState(null);m.useEffect(()=>{const O=Em(i);c(O),go(O?O.id:null)},[i]),m.useEffect(()=>{d(r!==ge.None)},[r]),m.useEffect(()=>{const O=e.addEventCallback(M=>{var Z,G;switch(M.eventType){case D.LOGIN_SUCCESS:console.log("[Auth] Login successful"),u(null);break;case D.LOGIN_FAILURE:console.error("[Auth] Login failed:",M.error),u(((Z=M.error)==null?void 0:Z.message)||"Login failed");break;case D.LOGOUT_SUCCESS:console.log("[Auth] Logout successful"),c(null),u(null);break;case D.ACQUIRE_TOKEN_SUCCESS:console.log("[Auth] Token acquired successfully"),u(null);break;case D.ACQUIRE_TOKEN_FAILURE:console.error("[Auth] Token acquisition failed:",M.error),u(((G=M.error)==null?void 0:G.message)||"Token acquisition failed");break}});return()=>{O&&e.removeEventCallback(O)}},[e]);const y=async O=>{try{u(null),d(!0);const M={..._m,...O};await e.loginPopup(M)}catch(M){throw console.error("[Auth] Login error:",M),u(M.message||"Login failed"),M}finally{d(!1)}},x=async O=>{try{u(null),d(!0);const M={account:i||void 0,...O};await e.logoutPopup(M)}catch(M){throw console.error("[Auth] Logout error:",M),u(M.message||"Logout failed"),M}finally{d(!1)}},U=()=>{u(null)},N=O=>(a==null?void 0:a.roles.includes(O))??!1,v=O=>O.some(M=>N(M)),J={user:a,isAuthenticated:o,isLoading:l,error:h,login:y,logout:x,clearError:U,hasRole:N,hasAnyRole:v,isAdmin:()=>N(he.ADMIN),canAccessControlPanel:()=>v([he.ADMIN,he.CONTROL_PANEL])};return s.jsx(Ji.Provider,{value:J,children:n})},Tl={}.VITE_ENABLE_ENTRA_AUTH==="true",jm=({children:n})=>Tl?s.jsx(vm,{children:n}):s.jsx(s.Fragment,{children:n}),Pm=({children:n})=>Tl?s.jsx(km,{children:n}):null,Om={id:"mock-user-id",email:"anonymous@localhost",name:"Anonymous User",roles:["Admin"],primaryRole:"Admin",groups:[],preferredUsername:"anonymous"},Mm=({children:n})=>{const e={user:Om,isAuthenticated:!0,isLoading:!1,error:null,login:async()=>{console.log("Mock login called - no action taken")},logout:async()=>{console.log("Mock logout called - no action taken")},clearError:()=>{console.log("Mock clearError called - no action taken")},hasRole:()=>!0,hasAnyRole:()=>!0,isAdmin:()=>!0,canAccessControlPanel:()=>!0};return s.jsx(Ji.Provider,{value:e,children:n})},Xi={}.VITE_ENABLE_ENTRA_AUTH==="true";console.log("Authentication mode:",Xi?"Entra ID enabled":"Mock authentication enabled");console.log("VITE_ENABLE_ENTRA_AUTH:",{}.VITE_ENABLE_ENTRA_AUTH);const ra=Xi?new Wi(Sm):null,Dm=({children:n})=>Xi&&ra?s.jsx(bm,{instance:ra,children:s.jsx(Rm,{children:n})}):s.jsx(Mm,{children:n}),Lm=()=>{const{login:n,isLoading:e,error:t}=Lt(),r=()=>{n().catch(console.error)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:s.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:""})}),s.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),s.jsxs("div",{className:"space-y-4",children:[t&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:s.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t})}),s.jsx("button",{onClick:r,disabled:e,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e?s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),s.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),s.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),s.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},sa=({children:n,fallback:e,redirectTo:t})=>{const r=Us();return s.jsxs(s.Fragment,{children:[s.jsx(jm,{children:n}),s.jsx(Pm,{children:e||(t?s.jsx(pa,{to:t,state:{from:r},replace:!0}):s.jsx(Lm,{}))})]})},Um=({children:n,roles:e,requireAll:t=!1,fallback:r,redirectTo:i})=>{const{hasRole:o,hasAnyRole:a,user:c}=Lt(),l=Us();return(t?e.every(h=>o(h)):a(e))?s.jsx(s.Fragment,{children:n}):r?s.jsx(s.Fragment,{children:r}):i?s.jsx(pa,{to:i,state:{from:l},replace:!0}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",e.length>1?"s":"",": ",e.join(", ")]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",c!=null&&c.roles.length&&c.roles.length>1?"s":"",": ",(c==null?void 0:c.roles.join(", "))||"None"]})]})]})})},At=({children:n,requireAuth:e=!0,requireRoles:t=[],requireAll:r=!1,fallback:i,redirectTo:o})=>!e&&t.length===0?s.jsx(s.Fragment,{children:n}):e&&t.length===0?s.jsx(sa,{fallback:i,redirectTo:o,children:n}):s.jsx(sa,{fallback:i,redirectTo:o,children:s.jsx(Um,{roles:t,requireAll:r,fallback:i,redirectTo:o,children:n})}),Hm=()=>{const n=Fn(),e=Us(),{user:t,isAuthenticated:r,isLoading:i,hasRole:o}=Lt();return m.useEffect(()=>{if(i||!r||!t||e.pathname!=="/")return;let a="/";o(he.CONTROL_PANEL)&&!o(he.ADMIN)?a="/summary":(o(he.ADMIN),a="/"),a!==e.pathname&&n(a,{replace:!0})},[t,r,i,e.pathname,n,o]),null};class Fm{constructor(e,t){se(this,"msalInstance");se(this,"accounts");this.msalInstance=e,this.accounts=t}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...Am,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(e){return console.warn("Failed to acquire access token silently:",e),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const e=this.accounts[0];return{userId:e.homeAccountId,username:e.username,name:e.name}}}const $m=()=>{const{instance:n,accounts:e}=yr();return new Fm(n,e)};class Bm{constructor(e,t){se(this,"baseUrl");se(this,"authProvider");this.baseUrl=e,this.authProvider=t}setAuthProvider(e){this.authProvider=e}async handleResponse(e){if(!e.ok){const t=await e.json().catch(()=>({}));throw He(`HTTP_${e.status}`,t.message||`HTTP ${e.status}: ${e.statusText}`,{status:e.status,statusText:e.statusText,data:t})}return e.json()}async request(e,t={}){try{const r=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,i=e.startsWith("/")?e:`/${e}`,o=`${r}${i}`,a={"Content-Type":"application/json",...t.headers};if(this.authProvider)try{const l=await this.authProvider.getAuthHeaders();Object.assign(a,l)}catch(l){console.warn("Failed to get authentication headers:",l)}const c=await fetch(o,{...t,headers:a});return this.handleResponse(c)}catch(r){throw xd(r)?He("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:r}):r instanceof Error&&"code"in r?r:He("UNKNOWN_ERROR","An unexpected error occurred",{originalError:r})}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}const $e=new Bm(sr.api.baseUrl),Km=n=>{$e.setAuthProvider(n)},pe={async checkHealth(){return $e.get(wr.HEALTH)},async initiateSession(n){return $e.post(wr.SESSIONS_INITIATE,n)},async submitPrediction(n){return $e.post(wr.PREDICTIONS_SUBMIT,n)},async getPredictionBySessionId(n){return $e.get(`${wr.PREDICTIONS_BY_SESSION}/${n}`)},async getUserPredictions(n){return $e.get(`${wr.PREDICTIONS_BY_USER}/${n}`)},async saveSessionData(n){return $e.post("sessions",n)},async getSessionData(n){return $e.get(`sessions/${n}`)},async getUserSessions(n){return $e.get(`sessions/users/${n}`)},async getAllSessions(){return $e.get("sessions/all")},async updateSessionData(n,e){return $e.put(`sessions/${n}`,e)},async deleteSessionData(n){return $e.delete(`sessions/${n}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(n){return{success:!1,message:n.message||"Connection test failed"}}},async generateRiskAssessment(n){return $e.post(`sessions/${n}/risk-assessment`)},async getRiskAssessment(n){return $e.get(`sessions/${n}/risk-assessment`)}};class na{constructor(e,t={}){se(this,"sessionId");se(this,"intervalMs");se(this,"maxAttempts");se(this,"backoffFactor");se(this,"currentAttempt",0);se(this,"timeoutId",null);se(this,"isPolling",!1);this.sessionId=e,this.intervalMs=t.intervalMs||sr.polling.intervalMs,this.maxAttempts=t.maxAttempts||sr.polling.maxAttempts,this.backoffFactor=t.backoffFactor||sr.polling.backoffFactor}async start(e,t,r){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const i=async()=>{try{const o=await pe.getPredictionBySessionId(this.sessionId);if(e(o),o.status==="succeeded"||o.status==="success"||o.status==="failed"){this.stop(),t(o);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),r(He("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const a=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(i,a)}catch(o){this.stop(),r(o)}};await i()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const zm=({children:n})=>{const e=$m();return m.useEffect(()=>{Km(e)},[e]),s.jsx(s.Fragment,{children:n})},Nl=()=>{const n=m.useCallback((r,i="polite")=>{je(r,i)},[]),e=m.useCallback(r=>{n(r,"assertive")},[n]),t=m.useCallback(r=>{n(r,"polite")},[n]);return{announce:n,announceError:e,announceSuccess:t}},El=()=>{const n=m.useCallback(t=>{const r=i=>{i.key==="Escape"&&(i.preventDefault(),t())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),e=m.useCallback(t=>r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),t())},[]);return{handleEscape:n,handleEnterSpace:e}},Gm=()=>({skipToMain:m.useCallback(()=>{bd(Sr.SKIP_TO_CONTENT_ID,Sr.FOCUS_TIMEOUT)},[])}),qm=({className:n=""})=>{const{theme:e,toggleTheme:t}=wd(),{user:r,logout:i,isAuthenticated:o,isAdmin:a}=Lt(),c=Us(),{handleEnterSpace:l}=El(),[d,h]=m.useState(!1),[u,y]=m.useState(!1),x=()=>{const j=[{path:"/",label:"Dashboard",icon:"",roles:[he.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"",roles:[he.ADMIN]},{path:"/sessions",label:"Sessions",icon:"",roles:[he.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"",roles:[he.ADMIN]}];return o?j.filter(()=>!!a()):[]};m.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:o,user:r?{id:r.id,name:r.name,roles:r.roles}:null,timestamp:new Date().toISOString()})},[o,r]);const U=x(),N=j=>j==="/"?c.pathname==="/":c.pathname.startsWith(j),v=()=>{h(!d)},C=()=>{h(!1)};return m.useEffect(()=>{h(!1),y(!1)},[c.pathname]),m.useEffect(()=>{const j=J=>{const O=J.target;u&&!O.closest("[data-user-menu]")&&y(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[u]),s.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${n}`,children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsxs("div",{className:"flex justify-between items-center h-16",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs(Ne,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[s.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:""}),s.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),s.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),s.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:U.map(({path:j,label:J,icon:O})=>s.jsxs(Ne,{to:j,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${N(j)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":N(j)?"page":void 0,children:[s.jsx("span",{role:"img","aria-hidden":"true",children:O}),s.jsx("span",{children:J})]},j))}),s.jsxs("div",{className:"flex items-center space-x-4",children:[o&&r&&s.jsxs("div",{className:"relative","data-user-menu":!0,children:[s.jsxs("button",{onClick:()=>y(!u),onKeyDown:l(()=>y(!u)),className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                    transition-colors touch-target\r
                  `,"aria-label":"User menu",type:"button",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:r.name.charAt(0).toUpperCase()}),s.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900 dark:text-white",children:r.name}),s.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&s.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:r.name.charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.email})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:r.primaryRole}),r.roles.length>1&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["+",r.roles.length-1," more"]})]})]}),s.jsx("div",{className:"py-1",children:s.jsx("button",{onClick:()=>{i(),y(!1)},className:`\r
                          w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r
                          hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r
                        `,children:"Sign out"})})]})]}),s.jsx("button",{onClick:t,onKeyDown:l(t),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${e==="light"?"dark":"light"} mode`,type:"button",children:s.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:e==="light"?"":""})}),o&&s.jsx("button",{onClick:v,onKeyDown:l(v),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":d?"Close mobile menu":"Open mobile menu",type:"button",...d?{"aria-expanded":!0}:{"aria-expanded":!1},children:s.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:d?"":""})})]})]}),d&&o&&s.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:s.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:U.map(({path:j,label:J,icon:O})=>s.jsxs(Ne,{to:j,onClick:C,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${N(j)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":N(j)?"page":void 0,children:[s.jsx("span",{role:"img","aria-hidden":"true",children:O}),s.jsx("span",{children:J})]},j))})})]})})},Vm=({size:n=20,className:e="",...t})=>s.jsxs("svg",{width:n,height:n,viewBox:"0 0 23 23",className:e,"aria-label":"Microsoft",...t,children:[s.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),s.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),s.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),s.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),Wm=({children:n,className:e=""})=>{const{skipToMain:t}=Gm();return s.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[s.jsx("a",{href:`#${Sr.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:r=>{r.preventDefault(),t()},children:"Skip to main content"}),s.jsx(qm,{}),s.jsx("main",{id:Sr.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${e}`,tabIndex:-1,children:n}),s.jsx("div",{id:Sr.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),s.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Vm,{size:24,className:"opacity-80"}),s.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),s.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[s.jsxs("p",{children:["Behavioral Health System  ",new Date().getFullYear()]}),s.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant  Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qm=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ym=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),ia=n=>{const e=Ym(n);return e.charAt(0).toUpperCase()+e.slice(1)},Rl=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),Jm=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zm=m.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:a,...c},l)=>m.createElement("svg",{ref:l,...Xm,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Rl("lucide",i),...!o&&!Jm(c)&&{"aria-hidden":"true"},...c},[...a.map(([d,h])=>m.createElement(d,h)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=(n,e)=>{const t=m.forwardRef(({className:r,...i},o)=>m.createElement(Zm,{ref:o,iconNode:e,className:Rl(`lucide-${Qm(ia(n))}`,`lucide-${n}`,r),...i}));return t.displayName=ia(n),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Hr=W("activity",ep);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rp=W("arrow-left",tp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Nt=W("brain",sp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],jl=W("calendar",np);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],oa=W("chart-column",ip);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],ap=W("chart-pie",op);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Pl=W("chevron-down",cp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ol=W("chevron-up",lp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],st=W("circle-alert",dp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ke=W("circle-check-big",hp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ms=W("circle-x",up);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Dt=W("clock",gp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mp=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ds=W("download",mp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pp=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],fp=W("eye-off",pp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yp=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Fr=W("eye",yp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xp=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],bp=W("file-audio",xp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wp=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],vp=W("file-text",wp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kp=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Cp=W("file",kp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],_p=W("files",Sp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ap=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Ml=W("funnel",Ap);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ip=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Zi=W("heart",Ip);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Dn=W("info",Tp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Np=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],Ep=W("languages",Np);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rp=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],jp=W("lightbulb",Rp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Op=W("loader-circle",Pp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mp=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Dp=W("mic-off",Mp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Dl=W("mic",Lp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Ln=W("pause",Up);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],rr=W("play",Hp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fp=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],aa=W("plus",Fp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $p=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Se=W("refresh-cw",$p);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bp=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Kp=W("search",Bp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Gp=W("send",zp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qp=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ll=W("settings",qp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Un=W("shield-alert",Vp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ul=W("target",Wp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Rr=W("trash-2",Qp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Hl=W("trending-down",Yp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jp=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],rn=W("trending-up",Jp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Fl=W("triangle-alert",Xp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ef=W("upload",Zp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tf=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],un=W("user",tf);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rf=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],$l=W("users",rf);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],$r=W("volume-2",sf);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],of=W("volume-x",nf);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const af=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ns=W("x",af),Bl={health:["health"],userPredictions:n=>["predictions","user",n],sessionPrediction:n=>["predictions","session",n],userSessions:n=>["sessions","user",n]},Kl=()=>ma({queryKey:Bl.health,queryFn:()=>pe.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),cf=n=>{const e=n||vt();return ma({queryKey:Bl.userSessions(e),queryFn:()=>pe.getUserSessions(e),enabled:!!e,staleTime:3e4,refetchOnWindowFocus:!1})},lf=()=>{const{announce:n}=Nl(),{canAccessControlPanel:e,user:t}=Lt(),r=()=>(t==null?void 0:t.id)||vt(),{data:i,isLoading:o,error:a}=Kl(),{data:c,isLoading:l}=cf(r());m.useEffect(()=>{n("Dashboard page loaded","polite")},[n]);const d=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"",color:"warning",disabled:!0}],h=(u,y=!1)=>{const x=y?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(u){case"primary":return`${x} border-primary-200 bg-primary-50 ${!y&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!y&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${x} border-secondary-200 bg-secondary-50 ${!y&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!y&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${x} border-accent-200 bg-accent-50 ${!y&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!y&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${x} border-warning-200 bg-warning-50 ${!y&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!y&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${x} border-gray-200 bg-gray-50 ${!y&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!y&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),s.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:d.map(u=>u.disabled?s.jsxs("div",{className:`${h(u.color,!0)} relative`,"aria-label":`${u.title}: Coming Soon`,children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:u.icon}),s.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:u.title}),s.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:u.description})]}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-white font-bold text-sm mb-1",children:""}),s.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},u.href):s.jsx(Ne,{to:u.href,className:h(u.color,!1),"aria-label":`${u.title}: ${u.description}`,children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:u.icon}),s.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:u.title}),s.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:u.description})]})},u.href))})]}),e()&&s.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:" Summary"}),s.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),s.jsx(Ne,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),s.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),l?s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"spinner w-4 h-4"}),s.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(c!=null&&c.sessions)||c.sessions.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:""}),s.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",s.jsx(Ne,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):s.jsxs("div",{className:"space-y-3",children:[c.sessions.sort((u,y)=>new Date(y.createdAt).getTime()-new Date(u.createdAt).getTime()).slice(0,3).map(u=>{var y,x;return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`status-${u.status||"completed"}`,children:u.status||"completed"}),s.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:u.audioFileName||((y=u.sessionId)==null?void 0:y.slice(0,8))||"Unknown"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:u.createdAt,children:u.createdAt?new Date(u.createdAt).toLocaleString():""})]}),s.jsx(Ne,{to:`/sessions/${u.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${u.audioFileName||((x=u.sessionId)==null?void 0:x.slice(0,8))||"Unknown"}`,children:s.jsx(Fr,{className:"w-4 h-4","aria-hidden":"true"})})]},u.sessionId)}),c.sessions.length>3&&s.jsx("div",{className:"text-center pt-3",children:s.jsxs(Ne,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",c.sessions.length," sessions "]})})]})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),s.jsx(Ne,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),o?s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"spinner w-4 h-4"}),s.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):a?s.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[s.jsx("span",{role:"img","aria-label":"Error",children:""}),s.jsx("span",{children:"System health check failed"})]}):s.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[s.jsx("span",{role:"img","aria-label":"Healthy",children:""}),s.jsx("span",{children:"All systems operational"}),(i==null?void 0:i.checks)&&s.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(i.checks).length," services checked)"]})]})]})]})};class df{constructor(){se(this,"ffmpeg",null);se(this,"isLoaded",!1);se(this,"loadingPromise",null);this.ffmpeg=new od}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw He("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await lo(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await lo(`${e}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(e){throw this.loadingPromise=null,He("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:e})}}async convertAudio(e,t={outputFormat:"wav",sampleRate:44100,channels:1},r){try{if(r==null||r({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw He("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:h})=>{r==null||r({stage:"converting",progress:Math.round(h*100),message:`Converting audio... ${Math.round(h*100)}%`})}),r==null||r({stage:"converting",progress:0,message:"Preparing audio file..."});const i="input."+this.getFileExtension(e.name);await this.ffmpeg.writeFile(i,await ad(e));const o=`output.${t.outputFormat}`,a=["-i",i,"-ac",t.channels.toString(),"-ar",t.sampleRate.toString(),"-f",t.outputFormat,o];await this.ffmpeg.exec(a);const c=await this.ffmpeg.readFile(o),l=new Blob([c],{type:`audio/${t.outputFormat}`}),d=new File([l],`${this.getFileNameWithoutExtension(e.name)}.${t.outputFormat}`,{type:`audio/${t.outputFormat}`});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(o),r==null||r({stage:"completed",progress:100,message:"Audio conversion completed"}),d}catch(i){throw He("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:i,fileName:e.name,fileSize:e.size,fileType:e.type})}}getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1).toLowerCase():""}getFileNameWithoutExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(0,t):e}async isFormatSupported(e){try{await this.loadFFmpeg();const t=["wav","mp3","mp4","m4a","aac","flac","ogg"],r=this.getFileExtension(e.name);return t.includes(r)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let gn=null;const hf=()=>(gn||(gn=new df),gn),mn=async(n,e)=>{const r=await hf().convertAudio(n,{outputFormat:"wav",sampleRate:44100,channels:1},e?i=>e(i.progress):void 0);return new Blob([r],{type:"audio/wav"})};class uf{constructor(e){se(this,"containerClient",null);se(this,"sasUrl");if(this.sasUrl=e||sr.azure.blobSasUrl,!this.sasUrl)throw He("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const e=new cd(this.sasUrl);this.containerClient=e.getContainerClient(sr.azure.containerName)}catch(e){throw He("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:e})}return this.containerClient}async uploadFile(e,t,r,i){try{r==null||r({progress:0,stage:"preparing",message:"Preparing upload..."});const o=this.getContainerClient();let a;if(i){const d=i;if(t)a=`users/${d}/audio/${t}`;else{const h=new Date().toISOString().replace(/[:.]/g,"-"),u=Math.random().toString(36).substring(2,8),y=e.name.split(".").pop()||"wav";a=`users/${d}/audio/${h}-${u}.${y}`}}else a=t||this.generateBlobName(e.name);const c=o.getBlockBlobClient(a);r==null||r({progress:10,stage:"uploading",message:"Starting upload..."}),await c.uploadData(e,{blobHTTPHeaders:{blobContentType:e.type},onProgress:d=>{const h=d.loadedBytes&&e.size?Math.round(d.loadedBytes/e.size*90)+10:50;r==null||r({progress:h,stage:"uploading",message:`Uploading... ${h}%`})}});const l=c.url;return r==null||r({progress:100,stage:"completed",message:"Upload completed"}),{url:l,fileName:a,size:e.size}}catch(o){throw He("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:o,fileName:e.name,fileSize:e.size})}}generateBlobName(e,t){const r=t||vt(),i=new Date().toISOString().replace(/[:.]/g,"-"),o=Math.random().toString(36).substring(2,8),a=e.split(".").pop()||"wav";return`users/${r}/audio/${i}-${o}.${a}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(e){try{await this.getContainerClient().getBlockBlobClient(e).deleteIfExists()}catch(t){throw He("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:t,fileName:e})}}async listUserFiles(e){try{const t=e||vt(),r=this.getContainerClient(),i=`users/${t}/`,o=[];for await(const a of r.listBlobsFlat({prefix:i}))o.push(a.name);return o}catch(t){throw He("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:t,userId:e})}}async deleteUserData(e){try{const t=e||vt(),r=await this.listUserFiles(t);let i=0;for(const o of r)await this.deleteFile(o),i++;return i}catch(t){throw He("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:t,userId:e})}}async getUserStorageUsage(e){try{const t=e||vt(),r=this.getContainerClient(),i=`users/${t}/`;let o=0,a=0;for await(const c of r.listBlobsFlat({prefix:i}))o++,a+=c.properties.contentLength||0;return{fileCount:o,totalSizeBytes:a}}catch(t){throw He("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:t,userId:e})}}}let is=null;const gf=n=>((!is||n&&n!==is.sasUrl)&&(is=new uf(n)),is),pn=async(n,e,t,r)=>{const i=gf(),o=n instanceof File?n:new File([n],e,{type:n.type});return(await i.uploadFile(o,e,t?c=>t(c.progress):void 0,r)).url},xr=()=>{const n=m.useRef(null),e=m.useCallback(c=>{if(!n.current){const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),l.style.position="absolute",l.style.left="-10000px",l.style.width="1px",l.style.height="1px",l.style.overflow="hidden",document.body.appendChild(l),n.current=l}n.current.textContent="",setTimeout(()=>{n.current&&(n.current.textContent=c)},100)},[]),t={focusById:c=>{const l=document.getElementById(c);l&&l.focus()},focusFirstInContainer:c=>{const d=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d&&d.focus()},trapFocus:c=>{const l=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),d=l[0],h=l[l.length-1],u=y=>{y.key==="Tab"&&(y.shiftKey?document.activeElement===d&&(h.focus(),y.preventDefault()):document.activeElement===h&&(d.focus(),y.preventDefault()))};return c.addEventListener("keydown",u),()=>{c.removeEventListener("keydown",u)}}},r={handleArrowNavigation:(c,l,d,h)=>{var y;let u=d;switch(c.key){case"ArrowDown":c.preventDefault(),u=d<l.length-1?d+1:0;break;case"ArrowUp":c.preventDefault(),u=d>0?d-1:l.length-1;break;case"Home":c.preventDefault(),u=0;break;case"End":c.preventDefault(),u=l.length-1;break;default:return}h(u),(y=l[u])==null||y.focus()},handleEscape:(c,l)=>{c.key==="Escape"&&(c.preventDefault(),l())}},i=m.useCallback((c="element")=>`${c}-${Math.random().toString(36).substr(2,9)}`,[]),o=m.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),a=m.useCallback((c,l,d)=>{const h={};return c||(h["aria-invalid"]="true",l&&d&&(h["aria-describedby"]=d)),h},[]);return{announceToScreenReader:e,focusManagement:t,keyboardNavigation:r,generateId:i,prefersReducedMotion:o,getValidationAttributes:a}},mf=()=>{const{user:n}=Lt(),[e,t]=m.useState([]),[r,i]=m.useState(()=>fd()),[o,a]=m.useState({}),[c,l]=m.useState({}),[d,h]=m.useState({}),[u,y]=m.useState(!1),[x,U]=m.useState(null),[N,v]=m.useState({stage:"idle",progress:0,message:""}),[C,j]=m.useState(null),[J,O]=m.useState(!1),[M,Z]=m.useState(0),[G,w]=m.useState(null),[g,b]=m.useState({userId:"",age:"",gender:"",race:"",ethnicity:"",language:"",weight:"",zipcode:"",sessionNotes:""}),[S,k]=m.useState(null),[E,H]=m.useState([]),[q,_e]=m.useState({});m.useEffect(()=>{if(!g.userId){const f=`user-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;b(_=>({..._,userId:f}))}},[g.userId]);const qe=m.useCallback(()=>(n==null?void 0:n.id)||vt(),[n==null?void 0:n.id]),we=m.useRef(null),re=m.useRef(null),{announceToScreenReader:Q}=xr(),K=m.useCallback((f,_,P)=>{const F=Date.now().toString()+Math.random().toString(36).substr(2,9),z={id:F,type:f,title:_,message:P,timestamp:Date.now()};H(ee=>[...ee,z]),setTimeout(()=>{H(ee=>ee.filter(Ae=>Ae.id!==F))},f==="error"?8e3:5e3)},[]),ne=m.useCallback(f=>{H(_=>_.filter(P=>P.id!==f))},[]),ht=m.useCallback(()=>{t([]),U(null),v({stage:"idle",progress:0,message:""}),j(null),l({}),a({}),k(null),O(!1),Z(0),w(null),y(!1)},[]),ft=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),Gr=m.useCallback(f=>{const _=ft(),P=URL.createObjectURL(f),F={id:_,file:f,url:P};r?(t($=>[...$,F]),h($=>({...$,[_]:"ready"})),a($=>({...$,[_]:{stage:"idle",progress:0,message:"Ready to process"}}))):U(F),Q(`Audio file selected: ${f.name}`);const z=new Audio(P);z.addEventListener("loadedmetadata",()=>{r?t($=>$.map(ee=>ee.id===_?{...ee,duration:z.duration}:ee)):U($=>$?{...$,duration:z.duration}:null)})},[r,Q]),nn=m.useCallback(f=>{r&&(t(_=>{const P=_.find(F=>F.id===f);return P&&URL.revokeObjectURL(P.url),_.filter(F=>F.id!==f)}),a(_=>{const{[f]:P,...F}=_;return F}),l(_=>{const{[f]:P,...F}=_;return F}),h(_=>{const{[f]:P,...F}=_;return F}))},[r]),Ut=m.useCallback(f=>{const _=f.target.files;!_||_.length===0||Array.from(_).forEach(P=>{const F=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],z=P.name.toLowerCase(),ee=[".wav",".mp3",".m4a",".aac",".flac"].some(et=>z.endsWith(et));if(!F.includes(P.type)&&!ee){k(`Unsupported file type for ${P.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),K("error","Unsupported File",`${P.name} is not a supported audio file format`),Q(`Error: Unsupported file format selected for ${P.name}`);return}const Ve=50*1024*1024;if(P.size>Ve){k(`File ${P.name} is too large. File size must be less than 50MB`),K("error","File Too Large",`${P.name} size must be less than 50MB`),Q(`Error: File ${P.name} is too large`);return}Gr(P),k(null)})},[Q,Gr,K]),qr=m.useCallback(f=>{f.preventDefault()},[]),br=m.useCallback(f=>{f.preventDefault();const _=f.dataTransfer.files;_.length>0&&Ut({target:{files:_}})},[Ut]),ql=m.useCallback(()=>{i(f=>{const _=!f;return yd(_),ht(),_})},[ht]),Vl=m.useCallback(()=>{we.current&&(J?(we.current.pause(),O(!1),Q("Audio paused")):(we.current.play(),O(!0),Q("Audio playing")))},[J,Q]),Wl=m.useCallback(()=>{we.current&&Z(we.current.currentTime)},[]),Vr=m.useCallback(f=>{const _=Math.floor(f/60),P=Math.floor(f%60);return`${_}:${P.toString().padStart(2,"0")}`},[]),Jt=m.useCallback(()=>{const f=[];if(g.age){const _=parseInt(g.age);(isNaN(_)||_<18||_>130)&&f.push("Age must be between 18 and 130")}if(g.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(g.gender)||f.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),g.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(g.race)||f.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),g.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(g.ethnicity)||f.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),g.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(g.zipcode)||f.push("Zipcode must be alphanumeric and contain no more than 10 characters")),g.weight){const _=parseInt(g.weight);(isNaN(_)||_<10||_>1e3)&&f.push("Weight must be between 10 and 1000 pounds (lbs)")}return f},[g]),so=m.useCallback(f=>{if(!f)return;const _=parseInt(f);if(isNaN(_)||_<18||_>130)return"Age must be between 18 and 130"},[]),no=m.useCallback(f=>{if(!f)return;const _=parseInt(f);if(isNaN(_)||_<10||_>1e3)return"Weight must be between 10 and 1000 pounds (lbs)"},[]),io=m.useCallback(f=>{if(!f)return;if(!/^[a-zA-Z0-9]{1,10}$/.test(f))return"Zipcode must be alphanumeric and contain no more than 10 characters"},[]),oo=m.useCallback(f=>{if(f&&f.length>500)return"Session notes must be 500 characters or less"},[]),_t=m.useCallback((f,_)=>{let P;switch(f){case"age":P=so(_);break;case"weight":P=no(_);break;case"zipcode":P=io(_);break;case"sessionNotes":P=oo(_);break;default:return}_e(F=>{const z={...F,[f]:P};return Object.values(z).some(ee=>ee!==void 0)||k(null),z})},[so,no,io,oo]),Wr=m.useCallback(()=>{const f={};let _=!1;return g.age&&(f.age=parseInt(g.age),_=!0),g.gender&&(f.gender=g.gender,_=!0),g.race&&(f.race=g.race,_=!0),g.ethnicity&&(f.ethnicity=g.ethnicity,_=!0),(g.language==="true"||g.language==="false")&&(f.language=g.language==="true",_=!0),g.weight&&(f.weight=parseInt(g.weight),_=!0),g.zipcode&&(f.zipcode=g.zipcode,_=!0),_?f:void 0},[g]),Ql=m.useCallback(async()=>{if(r){if(e.length===0||!g.userId.trim()){k("Please select audio files. User ID is automatically generated."),K("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await ao()}else{if(!x||!g.userId.trim()){k("Please select an audio file. User ID is automatically generated."),K("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await Jl()}},[x,e,g.userId,r]),Qr=m.useCallback(async(f,_)=>{try{a(ae=>({...ae,[f]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const P=Wr(),F={userid:g.userId.trim(),is_initiated:!0};P&&(F.metadata=P);const z=await pe.initiateSession(F),$={sessionId:z.sessionId,userId:g.userId.trim()};a(ae=>({...ae,[f]:{stage:"initiating",progress:10,message:"Saving session data...",sessionId:z.sessionId}}));const ee={sessionId:z.sessionId,userId:qe(),metadata_user_id:g.userId.trim(),...P&&{userMetadata:P},audioFileName:_.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (multi-file):",ee);const ae=await pe.saveSessionData(ee);console.log("Session data saved successfully (multi-file):",ae)}catch(ae){console.error("Failed to save session data (multi-file):",ae),console.error("Session data that failed to save:",ee),K("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}a(ae=>({...ae,[f]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const Ae=await mn(_.file,ae=>{a(V=>({...V,[f]:{stage:"converting",progress:15+ae*.25,message:`Converting audio... ${Math.round(ae)}%`}}))});a(ae=>({...ae,[f]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}}));const Ve=`${g.userId}_${$.sessionId}_${Date.now()}.wav`,et=await pn(Ae,Ve,ae=>{a(V=>({...V,[f]:{stage:"uploading",progress:40+ae*.25,message:`Uploading... ${Math.round(ae)}%`}}))},qe());a(ae=>({...ae,[f]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const ae={...ee,audioUrl:et,audioFileName:Ve,status:"processing",updatedAt:new Date().toISOString()};await pe.updateSessionData($.sessionId,ae)}catch(ae){console.warn("Failed to update session data with audio info:",ae)}await pe.submitPrediction({userId:g.userId.trim(),sessionid:$.sessionId,audioFileUrl:et,audioFileName:Ve}),a(ae=>({...ae,[f]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const Ee=new na($.sessionId);await new Promise((ae,V)=>{Ee.start(X=>{const Xt=X.status==="processing"?80:X.status==="success"?95:70;a(tt=>({...tt,[f]:{stage:"analyzing",progress:Xt,message:`Analysis ${X.status}...`}})),X.predictError&&K("error","Prediction Error",`${X.predictError.error}: ${X.predictError.message}`)},X=>{if(X.predictError){K("error","Analysis Failed",`The analysis completed with an error: ${X.predictError.error} - ${X.predictError.message}`),a(We=>({...We,[f]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),V(new Error(`Prediction error: ${X.predictError.error}`));return}const Xt={sessionId:$.sessionId,depressionScore:X.predictedScoreDepression?parseFloat(X.predictedScoreDepression):0,riskLevel:X.predictedScoreDepression&&parseFloat(X.predictedScoreDepression)>.7?"high":X.predictedScoreDepression&&parseFloat(X.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",X.predictedScoreDepression?`Depression score: ${X.predictedScoreDepression}`:"",X.predictedScoreAnxiety?`Anxiety score: ${X.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(We=>We.trim()!==""),timestamp:X.updatedAt,audioUrl:et,rawApiResponse:X},tt={...ee,audioUrl:et,prediction:X,analysisResults:{depressionScore:X.predictedScoreDepression?parseFloat(X.predictedScoreDepression):void 0,anxietyScore:X.predictedScoreAnxiety?parseFloat(X.predictedScoreAnxiety):void 0,riskLevel:X.predictedScoreDepression&&parseFloat(X.predictedScoreDepression)>.7?"high":X.predictedScoreDepression&&parseFloat(X.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",X.predictedScoreDepression?`Depression score: ${X.predictedScoreDepression}`:"",X.predictedScoreAnxiety?`Anxiety score: ${X.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(We=>We.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};pe.saveSessionData(tt).then(We=>{console.log("Multi-file session data saved with analysis results for session:",$.sessionId),console.log("Save result:",We),K("success","Session Saved","Analysis results have been saved to session storage.")}).catch(We=>{console.error("Failed to save multi-file analysis results to session storage:",We),console.error("Session data that failed to save:",tt),K("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),a(We=>({...We,[f]:{stage:"complete",progress:100,message:"Analysis complete!"}})),l(We=>({...We,[f]:Xt})),ae()},X=>{V(X)})})}catch(P){console.error(`Error processing file ${f}:`,P);let F="UNKNOWN_ERROR",z="An unexpected error occurred",$={};P&&typeof P=="object"?("code"in P&&typeof P.code=="string"&&(F=P.code),"message"in P&&typeof P.message=="string"&&(z=P.message),"details"in P&&typeof P.details=="object"&&($=P.details)):P instanceof Error&&(z=P.message,F=P.name||"ERROR");try{const ee=o[f];if(ee&&ee.sessionId){const Ae={sessionId:ee.sessionId,userId:qe(),metadata_user_id:g.userId.trim(),audioFileName:_.file.name,createdAt:new Date().toISOString(),status:"failed",updatedAt:new Date().toISOString(),error:{code:F,message:z,details:$}};await pe.updateSessionData(ee.sessionId,Ae),console.log(`Updated session ${ee.sessionId} status to failed`)}}catch(ee){console.error("Failed to update session status to failed:",ee)}try{const ee=o[f];if(ee&&(ee.stage==="uploading"||ee.stage==="submitting"||ee.stage==="analyzing")){const Ae=`${g.userId}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${Ae}`)}}catch(ee){console.warn("Error during cleanup attempt:",ee)}throw a(ee=>({...ee,[f]:{stage:"error",progress:0,message:"Processing failed",error:{code:F,message:z,details:$}}})),P}},[g.userId,Wr,pe,pn,mn,K]),ao=m.useCallback(async()=>{y(!0),k(null);const f=Jt();if(f.length>0){k(`Validation error: ${f.join(", ")}`),K("error","Validation Error",f.join(", ")),y(!1);return}const _=e.filter(z=>d[z.id]==="ready");if(_.length===0){K("info","No Files Ready","No files are ready to process"),y(!1);return}const P=_.length;let F=0;try{for(const z of _){F++,K("info","Processing File",`Processing ${z.file.name} (${F}/${P})`),h($=>({...$,[z.id]:"processing"}));try{await Qr(z.id,z),h($=>({...$,[z.id]:"complete"})),K("success","File Complete",`${z.file.name} processed successfully`)}catch($){let ee="FILE_PROCESSING_ERROR",Ae="An unexpected error occurred",Ve={};$&&typeof $=="object"?("code"in $&&typeof $.code=="string"&&(ee=$.code),"message"in $&&typeof $.message=="string"&&(Ae=$.message),"details"in $&&typeof $.details=="object"&&(Ve=$.details)):$ instanceof Error&&(Ae=$.message,ee=$.name||"ERROR"),K("error","File Failed",`Failed to process ${z.file.name}: ${Ae}`),h(et=>({...et,[z.id]:"error"})),a(et=>({...et,[z.id]:{stage:"error",progress:0,message:`Failed: ${Ae}`,error:{code:ee,message:Ae,details:Ve}}}))}}K("success","Batch Complete",`Processed ${F} file${F!==1?"s":""}`),Q(`Batch processing complete. ${F} files processed.`)}catch(z){const $=z instanceof Error?z.message:"An unexpected error occurred";k($),K("error","Batch Failed",$),Q(`Error: ${$}`)}finally{y(!1)}},[e,d,Jt,K,Q,Qr]),Yl=m.useCallback(async f=>{const _=e.find(F=>F.id===f);if(!_)return;const P=Jt();if(P.length>0){k(`Validation error: ${P.join(", ")}`),K("error","Validation Error",P.join(", "));return}h(F=>({...F,[f]:"processing"}));try{await Qr(f,_),h(F=>({...F,[f]:"complete"})),K("success","File Complete",`${_.file.name} processed successfully`)}catch(F){console.error(`Error processing ${_.file.name}:`,F);const z=F instanceof Error?F.message:"An unexpected error occurred";K("error","File Failed",`Failed to process ${_.file.name}: ${z}`),h($=>({...$,[f]:"error"})),a($=>({...$,[f]:{stage:"error",progress:0,message:`Failed: ${z}`}}))}},[e,Jt,K,Qr]),Jl=m.useCallback(async()=>{if(!x||!g.userId.trim()){k("Please select an audio file. User ID is automatically generated."),K("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const f=Jt();if(f.length>0){k(`Validation error: ${f.join(", ")}`),K("error","Validation Error",f.join(", "));return}try{k(null),v({stage:"initiating",progress:5,message:"Initiating session..."}),Q("Starting analysis process - initiating session");const _=Wr(),P={userid:g.userId.trim(),is_initiated:!0};_&&(P.metadata=_);const F=await pe.initiateSession(P),z={sessionId:F.sessionId,userId:g.userId.trim()};v({stage:"initiating",progress:10,message:"Saving session data..."});const $={sessionId:F.sessionId,userId:qe(),metadata_user_id:g.userId.trim(),..._&&{userMetadata:_},audioFileName:x.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (single-file):",$);const Ee=await pe.saveSessionData($);console.log("Session data saved successfully (single-file):",Ee)}catch(Ee){console.error("Failed to save session data (single-file):",Ee),console.error("Session data that failed to save:",$),K("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}v({stage:"converting",progress:15,message:"Converting audio to required format..."}),Q("Session created successfully, now converting audio");const ee=await mn(x.file,Ee=>{v({stage:"converting",progress:15+Ee*.25,message:`Converting audio... ${Math.round(Ee)}%`})});v({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),Q("Audio converted successfully, now uploading");const Ae=`${g.userId}_${z.sessionId}_${Date.now()}.wav`,Ve=await pn(ee,Ae,Ee=>{v({stage:"uploading",progress:40+Ee*.25,message:`Uploading... ${Math.round(Ee)}%`})},qe());v({stage:"submitting",progress:65,message:"Submitting for analysis..."}),Q("Upload complete, submitting for behavioral health analysis");try{const Ee={...$,audioUrl:Ve,audioFileName:Ae,status:"processing",updatedAt:new Date().toISOString()};await pe.updateSessionData(z.sessionId,Ee)}catch(Ee){console.warn("Failed to update session data with audio info:",Ee)}await pe.submitPrediction({userId:g.userId.trim(),sessionid:z.sessionId,audioFileUrl:Ve,audioFileName:Ae}),v({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),Q("Prediction submitted, analysis in progress");const et=new na(z.sessionId);await new Promise((Ee,ae)=>{et.start(V=>{const X=V.status==="processing"?80:V.status==="success"?95:70;v({stage:"analyzing",progress:X,message:`Analysis ${V.status}...`}),V.predictError&&K("error","Prediction Error",`${V.predictError.error}: ${V.predictError.message}`)},V=>{if(V.predictError){K("error","Analysis Failed",`The analysis completed with an error: ${V.predictError.error} - ${V.predictError.message}`),v({stage:"error",progress:0,message:"Analysis failed with errors"}),ae(new Error(`Prediction error: ${V.predictError.error}`));return}const X={sessionId:z.sessionId,depressionScore:V.predictedScoreDepression?parseFloat(V.predictedScoreDepression):0,riskLevel:V.predictedScoreDepression&&parseFloat(V.predictedScoreDepression)>.7?"high":V.predictedScoreDepression&&parseFloat(V.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",V.predictedScoreDepression?`Depression score: ${V.predictedScoreDepression}`:"",V.predictedScoreAnxiety?`Anxiety score: ${V.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(tt=>tt.trim()!==""),timestamp:V.updatedAt,audioUrl:Ve,rawApiResponse:V},Xt={...$,audioUrl:Ve,prediction:V,analysisResults:{depressionScore:V.predictedScoreDepression?parseFloat(V.predictedScoreDepression):void 0,anxietyScore:V.predictedScoreAnxiety?parseFloat(V.predictedScoreAnxiety):void 0,riskLevel:V.predictedScoreDepression&&parseFloat(V.predictedScoreDepression)>.7?"high":V.predictedScoreDepression&&parseFloat(V.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",V.predictedScoreDepression?`Depression score: ${V.predictedScoreDepression}`:"",V.predictedScoreAnxiety?`Anxiety score: ${V.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(tt=>tt.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};pe.saveSessionData(Xt).then(tt=>{console.log("Session data saved with analysis results for session:",z.sessionId),console.log("Save result:",tt),K("success","Session Saved","Analysis results have been saved to session storage.")}).catch(tt=>{console.error("Failed to save analysis results to session storage:",tt),console.error("Session data that failed to save:",Xt),K("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),v({stage:"complete",progress:100,message:"Analysis complete!"}),j(X),K("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),Q("Behavioral health analysis completed successfully"),Ee()},V=>{K("error","Analysis Error",V.message||"An unexpected error occurred during analysis."),ae(V)})})}catch(_){console.error("Processing error:",_);const P=_ instanceof Error?_.message:"An unexpected error occurred";k(P),v({stage:"error",progress:0,message:"Processing failed"}),K("error","Processing Failed",P),Q(`Error: ${P}`)}},[x,g.userId,Q,Jt,Wr]),co=m.useCallback(f=>{switch(f){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return s.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"flex justify-between items-center mb-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),s.jsxs("div",{className:"relative inline-flex items-center",children:[s.jsx("button",{type:"button",onClick:ql,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${r?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${r?"single file":"multi-file"} mode`,children:s.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${r?"translate-x-9":"translate-x-1"}`,children:r?s.jsx(_p,{className:"h-3 w-3 text-blue-600"}):s.jsx(Cp,{className:"h-3 w-3 text-gray-600"})})}),s.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[s.jsx("span",{className:`text-sm font-medium ${r?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),s.jsx("span",{className:`text-sm font-medium ${r?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),s.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:r?s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",r?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),s.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${r?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:r?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),s.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information (Optional)"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID (Auto-generated, editable)"}),s.jsx("input",{type:"text",id:"userId",value:g.userId,onChange:f=>b(_=>({..._,userId:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-generated user ID"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for API calls. Auto-generated but can be customized."})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),s.jsx("input",{type:"number",id:"age",value:g.age,onChange:f=>b(_=>({..._,age:f.target.value})),onBlur:f=>_t("age",f.target.value),onKeyUp:f=>{(f.key==="Enter"||f.key==="Tab")&&_t("age",f.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${q.age?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Age in years",min:"1",max:"150","aria-describedby":q.age?"age-error":void 0}),q.age&&s.jsx("p",{id:"age-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:q.age})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),s.jsx("input",{type:"number",id:"weight",value:g.weight,onChange:f=>b(_=>({..._,weight:f.target.value})),onBlur:f=>_t("weight",f.target.value),onKeyUp:f=>{(f.key==="Enter"||f.key==="Tab")&&_t("weight",f.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${q.weight?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Weight in lbs",min:"1",max:"1000","aria-describedby":q.weight?"weight-error":void 0}),q.weight&&s.jsx("p",{id:"weight-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:q.weight})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),s.jsxs("select",{id:"gender",value:g.gender,onChange:f=>b(_=>({..._,gender:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select gender"}),s.jsx("option",{value:"male",children:"Male"}),s.jsx("option",{value:"female",children:"Female"}),s.jsx("option",{value:"non-binary",children:"Non-binary"}),s.jsx("option",{value:"transgender female",children:"Transgender female"}),s.jsx("option",{value:"transgender male",children:"Transgender male"}),s.jsx("option",{value:"other",children:"Other"}),s.jsx("option",{value:"prefer",children:"Prefer"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),s.jsxs("select",{id:"race",value:g.race,onChange:f=>b(_=>({..._,race:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select race"}),s.jsx("option",{value:"white",children:"White"}),s.jsx("option",{value:"black or african-american",children:"Black or African-American"}),s.jsx("option",{value:"asian",children:"Asian"}),s.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),s.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),s.jsx("option",{value:"two or more races",children:"Two or more races"}),s.jsx("option",{value:"other",children:"Other"}),s.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),s.jsxs("select",{id:"ethnicity",value:g.ethnicity,onChange:f=>b(_=>({..._,ethnicity:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select ethnicity"}),s.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),s.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language"}),s.jsxs("select",{id:"language",value:g.language,onChange:f=>b(_=>({..._,language:f.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select language"}),s.jsx("option",{value:"true",children:"English"}),s.jsx("option",{value:"false",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),s.jsx("input",{type:"text",id:"zipcode",value:g.zipcode,onChange:f=>b(_=>({..._,zipcode:f.target.value})),onBlur:f=>_t("zipcode",f.target.value),onKeyUp:f=>{(f.key==="Enter"||f.key==="Tab")&&_t("zipcode",f.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${q.zipcode?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)","aria-describedby":q.zipcode?"zipcode-error":void 0}),q.zipcode&&s.jsx("p",{id:"zipcode-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:q.zipcode})]}),s.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[s.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),s.jsx("textarea",{id:"sessionNotes",value:g.sessionNotes,onChange:f=>b(_=>({..._,sessionNotes:f.target.value})),onBlur:f=>_t("sessionNotes",f.target.value),onKeyUp:f=>{(f.key==="Enter"||f.key==="Tab")&&_t("sessionNotes",f.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${q.sessionNotes?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,rows:3,placeholder:"Additional notes about this session or patient context","aria-describedby":q.sessionNotes?"sessionNotes-error":void 0}),q.sessionNotes&&s.jsx("p",{id:"sessionNotes-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:q.sessionNotes}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[g.sessionNotes.length,"/500 characters"]})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",r&&s.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!r&&!x||r&&e.length===0?s.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:qr,onDrop:br,children:[s.jsx(ef,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("button",{type:"button",onClick:()=>{var f;return(f=re.current)==null?void 0:f.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[s.jsx(aa,{className:"h-4 w-4 mr-2"}),"Select Audio File",r?"s":""]}),s.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",r?"files":"file"," here"]})]}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",r&&s.jsx("br",{}),r&&"You can select multiple files at once"]}),s.jsx("input",{ref:re,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ut,multiple:r,"aria-label":`Select audio file${r?"s":""} for analysis`})]}):s.jsxs("div",{className:"space-y-4",children:[!r&&x&&s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx($r,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:x.file.name}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(x.file.size/1024/1024).toFixed(2)," MB",x.duration&&`  ${Vr(x.duration)}`]})]})]}),s.jsx("button",{type:"button",onClick:ht,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:s.jsx(ns,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:Vl,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":J?"Pause audio":"Play audio",children:J?s.jsx(Ln,{className:"h-5 w-5","aria-hidden":"true"}):s.jsx(rr,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),s.jsx("div",{className:"flex-1",children:x.duration&&s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Vr(M)," / ",Vr(x.duration)]})})]}),x.duration&&s.jsx("div",{className:"audio-progress",children:s.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${M/x.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":M,"aria-valuemin":0,"aria-valuemax":x.duration})})]}),s.jsx("audio",{ref:we,src:x.url,onTimeUpdate:Wl,onEnded:()=>O(!1),onPlay:()=>O(!0),onPause:()=>O(!1),className:"hidden"})]}),r&&e.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",e.length,")"]}),s.jsxs("button",{type:"button",onClick:()=>{var f;return(f=re.current)==null?void 0:f.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[s.jsx(aa,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map(f=>{const _=d[f.id]||"ready",P=o[f.id];return s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[s.jsx($r,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:f.file.name}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(f.file.size/1024/1024).toFixed(2)," MB",f.duration&&`  ${Vr(f.duration)}`]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[_==="ready"&&s.jsxs("button",{type:"button",onClick:()=>Yl(f.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${f.file.name}`,children:[s.jsx(rr,{className:"h-3 w-3 mr-1"}),"Start"]}),_==="processing"&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),_==="complete"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[s.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Complete"]}),_==="error"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[s.jsx(ns,{className:"h-3 w-3 mr-1"}),"Error"]}),s.jsx("button",{type:"button",onClick:()=>nn(f.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${f.file.name}`,children:s.jsx(Rr,{className:"h-4 w-4"})})]})]}),P&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:P.message}),s.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(P.progress),"%"]})]}),s.jsx("div",{className:"processing-progress mt-1",children:s.jsx("div",{className:`processing-progress__fill progress-animated ${co(P.stage)}`,style:{width:`${P.progress}%`}})})]})]},f.id)})}),s.jsx("input",{ref:re,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ut,multiple:r,"aria-label":"Select additional audio files for analysis"})]})]})]}),S&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(st,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),s.jsx("span",{className:"text-red-700 dark:text-red-300",children:S})]})}),!r&&N.stage!=="idle"&&!C&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:N.message}),s.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(N.progress),"%"]})]}),s.jsx("div",{className:"processing-progress",children:s.jsx("div",{className:`processing-progress__fill progress-animated ${co(N.stage)}`,style:{width:`${N.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":N.progress,"aria-valuemin":0,"aria-valuemax":100})}),N.stage==="analyzing"&&s.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[s.jsx(Op,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),C&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(Ke,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),C.rawApiResponse&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.predicted_score_depression||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.predicted_score_anxiety||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),s.jsx("span",{className:`font-mono ${C.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:C.rawApiResponse.status||"N/A"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.model_category||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.model_granularity||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),s.jsx("span",{className:`font-mono ${C.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:C.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),C.rawApiResponse.actual_score&&s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[C.rawApiResponse.actual_score.depression_binary!==void 0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.actual_score.depression_binary||"N/A"})]}),C.rawApiResponse.actual_score.anxiety_binary!==void 0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:C.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),C.rawApiResponse.actual_score.phq_9&&C.rawApiResponse.actual_score.phq_9.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",C.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),C.rawApiResponse.actual_score.phq_2&&C.rawApiResponse.actual_score.phq_2.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",C.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),C.rawApiResponse.actual_score.gad_7&&C.rawApiResponse.actual_score.gad_7.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",C.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:C.rawApiResponse.created_at?new Date(C.rawApiResponse.created_at).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:C.rawApiResponse.updated_at?new Date(C.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:C.sessionId})]})})]}),C.rawApiResponse.predict_error&&s.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[s.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:C.rawApiResponse.predict_error.error})]}),s.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[s.jsx("span",{className:"font-medium",children:"Message:"})," ",C.rawApiResponse.predict_error.message]})]})]}),s.jsxs("details",{className:"mt-4",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),s.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:s.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(C.rawApiResponse,null,2)})})]})]})})]}),C.insights&&C.insights.length>0&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),s.jsx("ul",{className:"space-y-1",children:C.insights.map((f,_)=>s.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[" ",f]},_))})]}),s.jsx("div",{className:"mt-6 flex space-x-3",children:s.jsx("button",{type:"button",onClick:ht,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(r&&e.length>0||!r&&x)&&!C&&Object.keys(c).length===0&&N.stage==="idle"&&!u&&s.jsx("div",{className:"text-center",children:r?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:s.jsxs("button",{type:"button",onClick:ao,disabled:e.length===0||!g.userId.trim()||!e.some(f=>d[f.id]==="ready")||!!S||Object.values(q).some(f=>f!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[s.jsx(rr,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",e.filter(f=>d[f.id]==="ready").length>0&&` (${e.filter(f=>d[f.id]==="ready").length})`]})}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):s.jsxs("div",{children:[s.jsxs("button",{type:"button",onClick:Ql,disabled:!x||!g.userId.trim()||!!S||Object.values(q).some(f=>f!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[s.jsx(rr,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),s.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),r&&Object.keys(c).length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(Ke,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(c).length," files)"]})]}),s.jsx("div",{className:"space-y-6",children:Object.entries(c).map(([f,_])=>{const P=e.find(z=>z.id===f),F=o[f];return s.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(P==null?void 0:P.file.name)||`File ${f}`}),s.jsxs("div",{className:"flex items-center space-x-2",children:[(F==null?void 0:F.stage)==="complete"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[s.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Complete"]}),(F==null?void 0:F.stage)==="error"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[s.jsx(ns,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(F==null?void 0:F.stage)==="error"&&(F==null?void 0:F.error)&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(st,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:F.error.code})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:F.error.message})]})]}),F.error.details&&Object.keys(F.error.details).length>0&&s.jsxs("details",{className:"mt-3",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),s.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:s.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(F.error.details,null,2)})})]})]})]})]})}),_.rawApiResponse&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:_.rawApiResponse.predicted_score_depression||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:_.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:_.sessionId})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:_.rawApiResponse.status||"N/A"})]})]})}),s.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),s.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:s.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(_.rawApiResponse,null,2)})})]})]}),P&&s.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>{const z=document.getElementById(`audio-${f}`);z.paused?(document.querySelectorAll("audio").forEach($=>$.pause()),w(f),z.play()):(z.pause(),w(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":G===f?"Pause audio":"Play audio",children:G===f?s.jsx(Ln,{className:"h-4 w-4"}):s.jsx(rr,{className:"h-4 w-4"})}),s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[P.file.name,"  ",P.duration?`${Math.round(P.duration)}s`:"Duration unknown"]})]}),s.jsx("audio",{id:`audio-${f}`,src:P.url,onEnded:()=>w(null),className:"hidden"})]})]},f)})})]}),E.length>0&&s.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:E.map(f=>s.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${f.type==="error"?"border-red-500":f.type==="warning"?"border-yellow-500":f.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:s.jsxs("div",{className:"flex items-start",children:[s.jsxs("div",{className:"flex-shrink-0",children:[f.type==="error"&&s.jsx(st,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),f.type==="warning"&&s.jsx(st,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),f.type==="success"&&s.jsx(Ke,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),f.type==="info"&&s.jsx(st,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),s.jsxs("div",{className:"ml-3 flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:f.title}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:f.message})]}),s.jsx("div",{className:"ml-4 flex-shrink-0",children:s.jsx("button",{type:"button",onClick:()=>ne(f.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:s.jsx(ns,{className:"h-4 w-4"})})})]})},f.id))})]})},os={queued:{color:"yellow",icon:Dt,label:"Queued"},running:{color:"blue",icon:Se,label:"Processing"},processing:{color:"blue",icon:Se,label:"Processing"},succeeded:{color:"green",icon:Ke,label:"Completed"},success:{color:"green",icon:Ke,label:"Completed"},completed:{color:"green",icon:Ke,label:"Completed"},failed:{color:"red",icon:Ms,label:"Failed"},error:{color:"red",icon:Ms,label:"Error"}},as=n=>n?n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"",cs=n=>{if(!n)return 0;switch(n.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},pf=()=>{const{user:n}=Lt(),[e,t]=m.useState([]),[r,i]=m.useState(!0),[o,a]=m.useState(null),[c,l]=m.useState(new Set),[d,h]=m.useState(!1),[u,y]=m.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:x}=xr(),U=m.useCallback(()=>(n==null?void 0:n.id)||vt(),[n==null?void 0:n.id]),N=m.useCallback(async()=>{try{i(!0),a(null);const w=U(),b=(await pe.getUserSessions(w)).sessions.map(S=>{var H,q;const k=S.prediction,E=S.analysisResults;return{...S,uploadedAt:S.createdAt,fileName:S.audioFileName||`Audio_${S.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:(E==null?void 0:E.riskLevel)||"unknown",depressionScore:((H=E==null?void 0:E.depressionScore)==null?void 0:H.toString())||(k==null?void 0:k.predicted_score_depression)||(k==null?void 0:k.predictedScoreDepression)||void 0,anxietyScore:((q=E==null?void 0:E.anxietyScore)==null?void 0:q.toString())||(k==null?void 0:k.predicted_score_anxiety)||(k==null?void 0:k.predictedScoreAnxiety)||void 0}});t(b),x(`${b.length} sessions loaded successfully`)}catch(w){const g=w;a(g),x(`Error loading sessions: ${g.message}`)}finally{i(!1)}},[x]);m.useEffect(()=>{N()},[N]);const v=m.useMemo(()=>{let w=e;if(u.search){const g=u.search.toLowerCase();w=w.filter(b=>{var S,k;return b.sessionId.toLowerCase().includes(g)||((S=b.fileName)==null?void 0:S.toLowerCase().includes(g))||((k=os[b.status])==null?void 0:k.label.toLowerCase().includes(g))})}if(u.status!=="all"&&(w=w.filter(g=>g.status===u.status)),u.dateRange!=="all"){const g=new Date,b=new Date;switch(u.dateRange){case"today":b.setHours(0,0,0,0);break;case"week":b.setDate(g.getDate()-7);break;case"month":b.setMonth(g.getMonth()-1);break;case"year":b.setFullYear(g.getFullYear()-1);break}w=w.filter(S=>new Date(S.uploadedAt)>=b)}return w.sort((g,b)=>{let S=0;switch(u.sortBy){case"date":S=new Date(g.uploadedAt).getTime()-new Date(b.uploadedAt).getTime();break;case"status":S=g.status.localeCompare(b.status);break;case"depressionScore":const k=cs(g.depressionScore),E=cs(b.depressionScore);S=k-E;break;case"anxietyScore":const H=cs(g.anxietyScore),q=cs(b.anxietyScore);S=H-q;break}return u.sortOrder==="desc"?-S:S}),w},[e,u]),C=m.useCallback((w,g)=>{y(b=>({...b,[w]:g})),x(`Filter ${w} changed to ${g}`)},[x]),j=m.useCallback(w=>{l(g=>{const b=new Set(g);return b.has(w)?(b.delete(w),x("Session deselected")):(b.add(w),x("Session selected")),b})},[x]),J=m.useCallback(()=>{c.size===v.length?(l(new Set),x("All sessions deselected")):(l(new Set(v.map(g=>g.sessionId))),x(`All ${v.length} sessions selected`))},[c.size,v,x]),O=m.useCallback(async w=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await pe.deleteSessionData(w),t(b=>b.filter(S=>S.sessionId!==w)),l(b=>{const S=new Set(b);return S.delete(w),S}),x("Session deleted successfully")}catch(b){const S=b;x(`Error deleting session: ${S.message}`),alert(`Failed to delete session: ${S.message}`)}},[x]),M=m.useCallback(async()=>{if(c.size===0||!window.confirm(`Are you sure you want to delete ${c.size} session(s)? This action cannot be undone.`))return;const g=Array.from(c);let b=0,S=[];for(const k of g)try{await pe.deleteSessionData(k),b++}catch(E){const H=E;S.push(k),console.error(`Failed to delete session ${k}:`,H.message)}if(b>0&&t(k=>k.filter(E=>!(c.has(E.sessionId)&&!S.includes(E.sessionId)))),l(new Set),S.length===0)x(`${b} sessions deleted successfully`);else{const k=`${b} sessions deleted successfully, ${S.length} failed`;x(k),alert(`${k}. Failed sessions: ${S.join(", ")}`)}},[c,x]),Z=w=>{if(w===0)return"0 B";const g=1024,b=["B","KB","MB","GB"],S=Math.floor(Math.log(w)/Math.log(g));return`${parseFloat((w/Math.pow(g,S)).toFixed(1))} ${b[S]}`},G=({status:w})=>{const g=w.toLowerCase();let b=os[w];b||(g.includes("error")||g.includes("fail")?b=os.error:b=os.queued);const S=b.icon;return s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":b.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":b.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${b.label}`,children:[s.jsx(S,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),b.label]})};return r?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(Se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):o?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(st,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:o.message}),s.jsx("button",{type:"button",onClick:N,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:N,disabled:r,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[s.jsx(Se,{className:`w-4 h-4 mr-2 ${r?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),s.jsx(Ne,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),s.jsxs("div",{className:"relative",children:[s.jsx(Kp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),s.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:u.search,onChange:w=>C("search",w.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),s.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),s.jsxs("button",{type:"button",onClick:()=>h(!d),className:"btn btn--secondary flex items-center","aria-expanded":d,"aria-controls":"filter-panel","aria-label":`${d?"Hide":"Show"} filter options`,children:[s.jsx(Ml,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",d?s.jsx(Ol,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):s.jsx(Pl,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),d&&s.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),s.jsxs("select",{id:"status-filter",value:u.status,onChange:w=>C("status",w.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Statuses"}),s.jsx("option",{value:"queued",children:"Queued"}),s.jsx("option",{value:"processing",children:"Processing"}),s.jsx("option",{value:"running",children:"Running"}),s.jsx("option",{value:"succeeded",children:"Completed"}),s.jsx("option",{value:"success",children:"Success"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"failed",children:"Failed"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),s.jsxs("select",{id:"date-filter",value:u.dateRange,onChange:w=>C("dateRange",w.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Time"}),s.jsx("option",{value:"today",children:"Today"}),s.jsx("option",{value:"week",children:"Past Week"}),s.jsx("option",{value:"month",children:"Past Month"}),s.jsx("option",{value:"year",children:"Past Year"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),s.jsxs("select",{id:"sort-by",value:u.sortBy,onChange:w=>C("sortBy",w.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"date",children:"Date"}),s.jsx("option",{value:"status",children:"Status"}),s.jsx("option",{value:"depressionScore",children:"Depression Score"}),s.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),s.jsxs("select",{id:"sort-order",value:u.sortOrder,onChange:w=>C("sortOrder",w.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"desc",children:"Newest First"}),s.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),v.length>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[v.length," of ",e.length," sessions",c.size>0&&`  ${c.size} selected`]})}),c.size>0&&s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{type:"button",onClick:M,className:"btn btn--danger","aria-label":`Delete ${c.size} selected sessions`,children:[s.jsx(Rr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),v.length>0?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[s.jsx("div",{className:"hidden md:block overflow-x-auto",children:s.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left",children:s.jsx("input",{type:"checkbox",checked:c.size===v.length,onChange:J,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:v.map(w=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsx("input",{type:"checkbox",checked:c.has(w.sessionId),onChange:()=>j(w.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${w.sessionId}`})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:w.fileName}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",w.sessionId.slice(-12)]}),s.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:Z(w.fileSize||0)})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx(G,{status:w.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm",children:w.depressionScore?s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:as(w.depressionScore)}):s.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm",children:w.anxietyScore?s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:as(w.anxietyScore)}):s.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:jr(w.uploadedAt)}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:nr(w.uploadedAt)})]}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Ne,{to:`/sessions/${w.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${w.sessionId}`,children:s.jsx(Fr,{className:"w-4 h-4","aria-hidden":"true"})}),w.status==="succeeded"&&s.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${w.sessionId}`,children:s.jsx(Ds,{className:"w-4 h-4","aria-hidden":"true"})}),s.jsx("button",{type:"button",onClick:()=>O(w.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${w.sessionId}`,children:s.jsx(Rr,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},w.sessionId))})]})}),s.jsx("div",{className:"md:hidden space-y-4 p-4",children:v.map(w=>s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("input",{type:"checkbox",checked:c.has(w.sessionId),onChange:()=>j(w.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${w.sessionId}`}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:w.fileName}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",w.sessionId.slice(-12)]})]})]}),s.jsx(G,{status:w.status})]}),(w.depressionScore||w.anxietyScore)&&s.jsxs("div",{className:"text-sm",children:[w.depressionScore&&s.jsxs("div",{children:["Depression: ",as(w.depressionScore)]}),w.anxietyScore&&s.jsxs("div",{children:["Anxiety: ",as(w.anxietyScore)]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[s.jsx("span",{children:jr(w.uploadedAt)}),s.jsx("span",{children:Z(w.fileSize||0)})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[s.jsxs(Ne,{to:`/sessions/${w.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${w.sessionId}`,children:[s.jsx(Fr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),w.status==="succeeded"&&s.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${w.sessionId}`,children:[s.jsx(Ds,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),s.jsxs("button",{type:"button",onClick:()=>O(w.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${w.sessionId}`,children:[s.jsx(Rr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},w.sessionId))})]}):s.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx(st,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:e.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),e.length===0?s.jsx(Ne,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):s.jsx("button",{type:"button",onClick:()=>y({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},ff={low:{color:"green",label:"Low Risk",icon:Ke,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:Fl,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:Un,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:Un,description:"Urgent intervention required"}},yf=({sessionId:n,existingAssessment:e,onAssessmentUpdated:t})=>{const{announceToScreenReader:r}=xr(),[i,o]=m.useState(e||null),[a,c]=m.useState(!1),[l,d]=m.useState(!1),[h,u]=m.useState(null),y=m.useCallback(async()=>{try{c(!0),u(null),r("Generating AI risk assessment...");const N=await pe.generateRiskAssessment(n);if(N.success&&N.riskAssessment)o(N.riskAssessment),t==null||t(N.riskAssessment),r("Risk assessment generated successfully");else throw new Error(N.message||"Failed to generate risk assessment")}catch(N){const v=N;u(v),r(`Error generating assessment: ${v.message}`)}finally{c(!1)}},[n,t,r]),x=m.useCallback(async()=>{try{d(!0),u(null);const N=await pe.getRiskAssessment(n);N.success&&N.riskAssessment&&(o(N.riskAssessment),t==null||t(N.riskAssessment))}catch(N){u(N)}finally{d(!1)}},[n,t]),U=({riskLevel:N,riskScore:v})=>{const C=ff[N.toLowerCase()];if(!C)return null;const j=C.icon;return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${C.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":C.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${C.label}`,children:[s.jsx(j,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),C.label,v&&s.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[v,"/10"]})]}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:C.description})]})};return!i&&!a&&!l?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Nt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsxs("div",{className:"text-center py-8",children:[s.jsx(Nt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{type:"button",onClick:y,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[s.jsx(Nt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),s.jsxs("button",{type:"button",onClick:x,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[s.jsx(Se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),h&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]})]}):a||l?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Nt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(Se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:a?"Generating AI risk assessment...":"Loading assessment..."})]}),a&&s.jsx("div",{className:"mt-4 text-center",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):i?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[s.jsx(Nt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:s.jsxs("button",{type:"button",onClick:y,disabled:a,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[s.jsx(Se,{className:`w-3 h-3 mr-1 ${a?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),s.jsx(U,{riskLevel:i.overallRiskLevel,riskScore:i.riskScore})]}),i.generatedAt&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[s.jsx(jl,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:nr(i.generatedAt)})]})]}),i.summary&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(vp,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),s.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:s.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:i.summary})})]}),i.keyFactors&&i.keyFactors.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Fl,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),s.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:s.jsx("ul",{className:"space-y-2",children:i.keyFactors.map((N,v)=>s.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[s.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),N]},v))})})]}),i.recommendations&&i.recommendations.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(jp,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),s.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:s.jsx("ul",{className:"space-y-2",children:i.recommendations.map((N,v)=>s.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[s.jsx(Ke,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),N]},v))})})]}),i.immediateActions&&i.immediateActions.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Ul,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:s.jsx("ul",{className:"space-y-2",children:i.immediateActions.map((N,v)=>s.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[s.jsx(Un,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),N]},v))})})]}),i.followUpRecommendations&&i.followUpRecommendations.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(rn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),s.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:s.jsx("ul",{className:"space-y-2",children:i.followUpRecommendations.map((N,v)=>s.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[s.jsx(Dt,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),N]},v))})})]}),s.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[s.jsx(Dt,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",nr(i.generatedAt),i.modelVersion&&s.jsxs("span",{className:"ml-4",children:["Model: ",i.modelVersion]})]})})]}),h&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]}):null},fn={queued:{color:"yellow",icon:Dt,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Dt,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:Se,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:Se,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:Ke,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:Ke,label:"Completed",description:"Analysis completed successfully"},completed:{color:"green",icon:Ke,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:Ms,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:Ms,label:"Error",description:"An error occurred during processing"}},xf=()=>{var G,w,g,b,S,k,E,H,q,_e,qe,we;const{sessionId:n}=sd(),e=Fn(),{announceToScreenReader:t}=xr(),[r,i]=m.useState(null),[o,a]=m.useState(!0),[c,l]=m.useState(null),[d,h]=m.useState(!1),[u,y]=m.useState(!1),[x,U]=m.useState(!1),N=m.useRef(null),v=m.useCallback(async()=>{if(n)try{a(!0),l(null);const re=await pe.getSessionData(n);i(re),t(`Session ${n} loaded successfully`)}catch(re){const Q=re;l(Q),t(`Error loading session: ${Q.message}`)}finally{a(!1)}},[n,t]),C=m.useCallback(async()=>{y(!0),await v(),y(!1),t("Session data refreshed")},[v,t]);m.useEffect(()=>{v()},[v]);const j=m.useCallback(()=>{h(re=>{const Q=!re;return t(`Raw JSON view ${Q?"enabled":"disabled"}`),Q})},[t]),J=m.useCallback(()=>{N.current&&(x?(N.current.pause(),U(!1),t("Audio paused")):(N.current.play().catch(()=>{t("Failed to play audio")}),U(!0),t("Audio playing")))},[x,t]),O=m.useCallback(()=>{if(!r)return;const re=JSON.stringify(r,null,2),Q=new Blob([re],{type:"application/json"}),K=URL.createObjectURL(Q),ne=document.createElement("a");ne.href=K,ne.download=`session-${r.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),URL.revokeObjectURL(K),t("Session data download started")},[r,t]),M=m.useCallback(async()=>{if(!(!(r!=null&&r.audioUrl)||!(r!=null&&r.audioFileName)))try{const re=r.audioUrl;window.open(re,"_blank"),t(`Downloading audio file: ${r.audioFileName}`)}catch(re){console.error("Failed to download audio file:",re),t("Failed to download audio file")}},[r,t]),Z=({status:re})=>{const Q=re.toLowerCase();let K=fn[re];K||(Q.includes("error")||Q.includes("fail")?K=fn.error:K=fn.initiated);const ne=K.icon;return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${K.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":K.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":K.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${K.label}`,children:[s.jsx(ne,{className:`w-4 h-4 mr-2 ${K.color==="blue"&&re==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),K.label]}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:K.description})]})};return o?s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(Se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):c?s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(st,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:c.message}),s.jsxs("div",{className:"mt-4 space-x-3",children:[s.jsx("button",{type:"button",onClick:v,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),s.jsx(Ne,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):r?s.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("button",{type:"button",onClick:()=>e("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[s.jsx(rp,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",r.sessionId]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:j,className:"btn btn--secondary","aria-label":`${d?"Hide":"Show"} raw JSON data`,children:[d?s.jsx(fp,{className:"w-4 h-4 mr-2"}):s.jsx(Fr,{className:"w-4 h-4 mr-2"}),d?"Hide JSON":"Show JSON"]}),s.jsxs("button",{type:"button",onClick:C,disabled:u,className:"btn btn--secondary","aria-label":"Refresh session data",children:[s.jsx(Se,{className:`w-4 h-4 mr-2 ${u?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),s.jsxs("button",{type:"button",onClick:O,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[s.jsx(Ds,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),d&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Dn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:s.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(r,null,2)})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Dn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),s.jsx(Z,{status:r.status})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(jl,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"text-gray-900 dark:text-white",children:jr(r.createdAt)}),s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nr(r.createdAt)})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(Dt,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"text-gray-900 dark:text-white",children:jr(r.updatedAt)}),s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nr(r.updatedAt)})]})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(un,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),s.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:r.userId})]}),r.metadata_user_id&&s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(un,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Metadata User ID"]}),s.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:r.metadata_user_id})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(bp,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),s.jsxs("div",{className:"space-y-4",children:[r.audioFileName&&r.audioUrl&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),s.jsx("button",{onClick:M,className:"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors",title:"Click to download audio file",children:r.audioFileName})]}),r.audioUrl&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:J,className:"btn btn--secondary","aria-label":`${x?"Pause":"Play"} audio`,children:x?s.jsx(Ln,{className:"w-4 h-4"}):s.jsx(rr,{className:"w-4 h-4"})}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:x?"Playing audio...":"Audio playback available"})]}),s.jsx("audio",{ref:N,src:r.audioUrl,onPlay:()=>U(!0),onPause:()=>U(!1),onEnded:()=>U(!1),onError:()=>{U(!1),t("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),r.userMetadata&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(un,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.userMetadata.age&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),s.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.age," years"]})]}),r.userMetadata.gender&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.gender.replace(/[_-]/g," ")})]}),r.userMetadata.weight&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),s.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.weight," lbs"]})]}),r.userMetadata.race&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.race})]}),r.userMetadata.ethnicity&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.ethnicity})]}),r.userMetadata.zipcode&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:r.userMetadata.zipcode})]}),r.userMetadata.language!==void 0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.language?"Yes":"No"})]}),r.userMetadata.sessionNotes&&s.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:r.userMetadata.sessionNotes})]})]})]}),(r.analysisResults||r.prediction)&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Hr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),s.jsxs("div",{className:"space-y-6",children:[(r.analysisResults||r.prediction)&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Nt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((G=r.analysisResults)==null?void 0:G.depressionScore)||((w=r.prediction)==null?void 0:w.predicted_score_depression))&&s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),s.jsx(rn,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((b=(g=r.analysisResults)==null?void 0:g.depressionScore)==null?void 0:b.toFixed(2))||((S=r.prediction)!=null&&S.predicted_score_depression?r.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,re=>re.toUpperCase()):"N/A")})]}),(((k=r.analysisResults)==null?void 0:k.anxietyScore)||((E=r.prediction)==null?void 0:E.predicted_score_anxiety))&&s.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),s.jsx(Zi,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((q=(H=r.analysisResults)==null?void 0:H.anxietyScore)==null?void 0:q.toFixed(2))||((_e=r.prediction)!=null&&_e.predicted_score_anxiety?r.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,re=>re.toUpperCase()):"N/A")})]})]})]}),((qe=r.analysisResults)==null?void 0:qe.insights)&&r.analysisResults.insights.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),s.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:s.jsx("ul",{className:"space-y-2",children:r.analysisResults.insights.map((re,Q)=>s.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[s.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),re]},Q))})})]}),((we=r.analysisResults)==null?void 0:we.completedAt)&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(Ke,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:nr(r.analysisResults.completedAt)})]})})]})]})]}),s.jsx(yf,{sessionId:r.sessionId,existingAssessment:r.riskAssessment||null,onAssessmentUpdated:re=>{i(Q=>Q?{...Q,riskAssessment:re}:null)}})]}):s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsxs("div",{className:"text-center py-16",children:[s.jsx(st,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),s.jsx(Ne,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},bf=()=>{const{user:n}=Lt(),[e,t]=m.useState([]),[r,i]=m.useState(!0),[o,a]=m.useState(null),[c,l]=m.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[d,h]=m.useState(!1),{announceToScreenReader:u}=xr(),y=Fn(),x=m.useCallback(()=>(n==null?void 0:n.id)||vt(),[n==null?void 0:n.id]),U=m.useCallback(g=>{y(`/sessions/${g}`),u(`Navigating to session ${g} details`)},[y,u]),N=m.useCallback(async()=>{try{i(!0),a(null);const g=x(),S=(await pe.getUserSessions(g)).sessions.filter(k=>k.analysisResults||k.prediction);t(S),u(`${S.length} prediction sessions loaded`)}catch(g){const b=g;a(b),u(`Error loading predictions: ${b.message}`)}finally{i(!1)}},[u]);m.useEffect(()=>{N()},[N]);const v=m.useMemo(()=>{if(c.dateRange==="all")return e;const g=new Date,b=new Date;switch(c.dateRange){case"week":b.setDate(g.getDate()-7);break;case"month":b.setMonth(g.getMonth()-1);break;case"quarter":b.setMonth(g.getMonth()-3);break;case"year":b.setFullYear(g.getFullYear()-1);break}return e.filter(S=>new Date(S.createdAt)>=b)},[e,c.dateRange]),C=m.useMemo(()=>v.map(g=>{var E,H;const b=q=>{if(!q)return null;switch(q.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},S=b((E=g.prediction)==null?void 0:E.predicted_score_depression),k=b((H=g.prediction)==null?void 0:H.predicted_score_anxiety);return{date:g.createdAt,depression:S,anxiety:k,overall:null,sessionId:g.sessionId}}).sort((g,b)=>new Date(g.date).getTime()-new Date(b.date).getTime()),[v]),j=m.useMemo(()=>{const g={depression:[],anxiety:[]},b=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],S=v.map(E=>{var H;return(H=E.prediction)==null?void 0:H.predicted_score_depression}).filter(E=>E!==void 0);b.forEach(E=>{const H=S.filter(_e=>_e===E.category).length,q=S.length>0?H/S.length*100:0;H>0&&g.depression.push({category:E.label,count:H,percentage:q,color:E.color})});const k=v.map(E=>{var H;return(H=E.prediction)==null?void 0:H.predicted_score_anxiety}).filter(E=>E!==void 0);return b.forEach(E=>{const H=k.filter(_e=>_e===E.category).length,q=k.length>0?H/k.length*100:0;H>0&&g.anxiety.push({category:E.label,count:H,percentage:q,color:E.color})}),g},[v]),J=m.useMemo(()=>{const g={},b=E=>{if(!E)return 0;switch(E.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},S=v.map(E=>{var H;return(H=E.prediction)==null?void 0:H.predicted_score_depression}).filter(E=>E!==void 0);if(S.length<2)g.depression={direction:"stable",change:0,period:"insufficient data"};else{const E=S.map(b),H=E.slice(0,Math.floor(E.length/2)),q=E.slice(Math.floor(E.length/2)),_e=H.reduce((re,Q)=>re+Q,0)/H.length,we=q.reduce((re,Q)=>re+Q,0)/q.length-_e;g.depression={direction:Math.abs(we)<.5?"stable":we<0?"improving":"worsening",change:Math.abs(we),period:`${v.length} sessions`}}const k=v.map(E=>{var H;return(H=E.prediction)==null?void 0:H.predicted_score_anxiety}).filter(E=>E!==void 0);if(k.length<2)g.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const E=k.map(b),H=E.slice(0,Math.floor(E.length/2)),q=E.slice(Math.floor(E.length/2)),_e=H.reduce((re,Q)=>re+Q,0)/H.length,we=q.reduce((re,Q)=>re+Q,0)/q.length-_e;g.anxiety={direction:Math.abs(we)<.5?"stable":we<0?"improving":"worsening",change:Math.abs(we),period:`${v.length} sessions`}}return g.overall={direction:"stable",change:0,period:"coming soon"},g},[v]),O=m.useMemo(()=>{const g={totalSessions:v.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(v.length===0)return g;const b=v.map(k=>{var E;return(E=k.prediction)==null?void 0:E.predictedScoreDepression}).filter(k=>k!==void 0),S=v.map(k=>{var E;return(E=k.prediction)==null?void 0:E.predictedScoreAnxiety}).filter(k=>k!==void 0);if(b.length>0){const k={};b.forEach(H=>{k[H]=(k[H]||0)+1});const E=Object.entries(k).sort(([,H],[,q])=>q-H)[0][0];g.avgDepression=k[E]}if(S.length>0){const k={};S.forEach(H=>{k[H]=(k[H]||0)+1});const E=Object.entries(k).sort(([,H],[,q])=>q-H)[0][0];g.avgAnxiety=k[E]}return g.latestSession=v.sort((k,E)=>new Date(E.createdAt).getTime()-new Date(k.createdAt).getTime())[0],g.improvementSessions=0,g},[v]),M=m.useCallback((g,b)=>{l(S=>({...S,[g]:b})),u(`Filter ${g} changed to ${b}`)},[u]),Z=m.useCallback(()=>{const g=JSON.stringify(v,null,2),b=new Blob([g],{type:"application/json"}),S=URL.createObjectURL(b),k=document.createElement("a");k.href=S,k.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(S),u("Predictions data download started")},[v,u]),G=({trend:g,label:b})=>{const S=g.direction==="improving"?Hl:g.direction==="worsening"?rn:Hr,k=g.direction==="improving"?"text-green-600 dark:text-green-400":g.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(S,{className:`w-4 h-4 ${k}`,"aria-hidden":"true"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:b}),s.jsxs("span",{className:`text-sm font-medium ${k} capitalize`,children:[g.direction,g.period==="insufficient data"?" (need more sessions)":g.period==="coming soon"?" (analysis coming soon)":` (${g.period})`]})]})},w=({data:g,type:b,onBarClick:S})=>{const k=g.map(ne=>ne[b]).filter(ne=>ne!==null);if(k.length===0)return s.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const E=Math.max(...k),H=Math.min(...k),q=E-H||1,_e=ne=>{switch(ne){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},qe=(ne,ht)=>{if(ht==="depression")switch(ne){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(ht==="anxiety")switch(ne){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(ne){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},we=ne=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(ft=>({...ft,color:qe(ft.score,ne)})),re=new Set(k),K=we(b).filter(ne=>re.has(ne.score));return s.jsxs("div",{children:[s.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:g.map((ne,ht)=>{const ft=ne[b];if(ft===null)return null;const Gr=(ft-H)/q*100,nn=qe(ft,b),Ut=_e(ft),qr=new Date(ne.date).toLocaleDateString();return s.jsx("div",{className:`flex-1 ${nn} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(Gr,8)}%`},onClick:()=>S(ne.sessionId),role:"button",tabIndex:0,onKeyDown:br=>{(br.key==="Enter"||br.key===" ")&&(br.preventDefault(),S(ne.sessionId))},"aria-label":`View session details for ${Ut} score on ${qr}`,children:s.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[s.jsx("div",{className:"font-medium",children:Ut}),s.jsx("div",{className:"text-gray-300",children:qr}),s.jsxs("div",{className:"text-gray-300",children:["Session: ",ne.sessionId.slice(-8)]}),s.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),s.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},ht)})}),K.length>0&&s.jsx("div",{className:"px-4",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),K.map(ne=>s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:`w-3 h-3 ${ne.color} rounded`}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:ne.label})]},ne.score))]})})]})};return r?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(Se,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):o?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(st,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:o.message}),s.jsx("button",{type:"button",onClick:N,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>h(!d),className:"btn btn--secondary","aria-expanded":d?"true":"false","aria-label":`${d?"Hide":"Show"} filter options`,children:[s.jsx(Ml,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",d?s.jsx(Ol,{className:"w-4 h-4 ml-2"}):s.jsx(Pl,{className:"w-4 h-4 ml-2"})]}),s.jsxs("button",{type:"button",onClick:N,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[s.jsx(Se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),s.jsxs("button",{type:"button",onClick:Z,className:"btn btn--primary",disabled:v.length===0,"aria-label":"Download predictions data",children:[s.jsx(Ds,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),d&&s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),s.jsxs("select",{id:"date-range",value:c.dateRange,onChange:g=>M("dateRange",g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Time"}),s.jsx("option",{value:"week",children:"Past Week"}),s.jsx("option",{value:"month",children:"Past Month"}),s.jsx("option",{value:"quarter",children:"Past Quarter"}),s.jsx("option",{value:"year",children:"Past Year"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),s.jsxs("select",{id:"score-type",value:c.scoreType,onChange:g=>M("scoreType",g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Scores"}),s.jsx("option",{value:"depression",children:"Depression"}),s.jsx("option",{value:"anxiety",children:"Anxiety"}),s.jsx("option",{value:"overall",children:"Overall"})]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.showTrends,onChange:g=>M("showTrends",g.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),v.length===0?s.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx(Nt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:e.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),s.jsx(Ne,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Hr,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),s.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:O.totalSessions})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Nt,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const g=v.map(k=>{var E;return(E=k.prediction)==null?void 0:E.predicted_score_depression}).filter(k=>k!==void 0);if(g.length===0)return"";const b={};return g.forEach(k=>{b[k]=(b[k]||0)+1}),Object.entries(b).sort(([,k],[,E])=>E-k)[0][0].replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())})()})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Zi,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const g=v.map(k=>{var E;return(E=k.prediction)==null?void 0:E.predicted_score_anxiety}).filter(k=>k!==void 0);if(g.length===0)return"";const b={};return g.forEach(k=>{b[k]=(b[k]||0)+1}),Object.entries(b).sort(([,k],[,E])=>E-k)[0][0].replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())})()})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(c.scoreType==="all"||c.scoreType==="depression")&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(oa,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),s.jsx(w,{data:C,type:"depression",onBarClick:U}),c.showTrends&&s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:s.jsx(G,{trend:J.depression,label:"Trend:"})})]}),(c.scoreType==="all"||c.scoreType==="anxiety")&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(ap,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),s.jsx(w,{data:C,type:"anxiety",onBarClick:U}),c.showTrends&&s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:s.jsx(G,{trend:J.anxiety,label:"Trend:"})})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(oa,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(j).map(([g,b])=>s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[g," Scores"]}),s.jsx("div",{className:"space-y-2",children:b.map(S=>s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:S.category}),s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[S.count," (",S.percentage.toFixed(1),"%)"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full ${S.color} progress-dynamic progress-animated`,style:{"--progress-width":`${S.percentage}%`}})})]})},S.category))})]},g))})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[s.jsx(Dt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),s.jsx(Ne,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions "})]}),s.jsx("div",{className:"space-y-4",children:v.slice(0,5).map(g=>{var b,S;return s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${g.status==="succeeded"?"bg-green-500":g.status==="processing"?"bg-blue-500":g.status==="failed"?"bg-red-500":"bg-gray-500"}`}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.audioFileName||`Session ${g.sessionId.slice(-8)}`}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:jr(g.createdAt)})]})]})}),s.jsxs("div",{className:"flex items-center space-x-4",children:[((b=g.prediction)==null?void 0:b.predicted_score_depression)&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())})]}),((S=g.prediction)==null?void 0:S.predicted_score_anxiety)&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase())})]}),s.jsx(Ne,{to:`/sessions/${g.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${g.sessionId}`,children:s.jsx(Fr,{className:"w-4 h-4","aria-hidden":"true"})})]})]},g.sessionId)})})]})]})]})},Hn=(n,e)=>e>0?Math.round(n/e*100):0,wf=n=>{const e=n.length,t=new Set(n.map(v=>v.userId)).size,r=n.filter(v=>v.status==="succeeded"&&v.prediction),i=n.filter(v=>v.status==="failed"),o=n.filter(v=>v.status==="processing"),a=Hn(r.length,e),c=t>0?Math.round(e/t*10)/10:0,l=new Date(Date.now()-24*60*60*1e3),d=n.filter(v=>new Date(v.createdAt)>l).length,h={low:0,medium:0,high:0,unknown:0};n.forEach(v=>{var j;const C=((j=v.analysisResults)==null?void 0:j.riskLevel)||"unknown";C in h&&h[C]++});const u={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},y={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};r.forEach(v=>{if(v.prediction){const C=v.prediction.predictedScoreDepression;C&&C in u&&u[C]++;const j=v.prediction.predictedScoreAnxiety;j&&j in y&&y[j]++}});const x=[];for(let v=6;v>=0;v--){const C=new Date;C.setDate(C.getDate()-v);const j=C.toISOString().split("T")[0],J=n.filter(O=>O.createdAt.split("T")[0]===j).length;x.push({date:j,count:J})}const U=new Map;n.forEach(v=>{U.has(v.userId)||U.set(v.userId,{totalSessions:0,successfulSessions:0,sessions:[]});const C=U.get(v.userId);C.totalSessions++,C.sessions.push(v),v.status==="succeeded"&&v.prediction&&C.successfulSessions++});const N=Array.from(U.entries()).map(([v,C])=>{var g;const j=Hn(C.successfulSessions,C.totalSessions),J=C.sessions.filter(b=>{var S;return b.status==="succeeded"&&b.prediction&&((S=b.analysisResults)==null?void 0:S.confidence)}),O=J.length>0?J.reduce((b,S)=>{var k;return b+(((k=S.analysisResults)==null?void 0:k.confidence)||0)},0)/J.length:0,M={low:0,medium:0,high:0,unknown:0};C.sessions.forEach(b=>{var k;const S=((k=b.analysisResults)==null?void 0:k.riskLevel)||"unknown";S in M&&M[S]++});const Z={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},G={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};J.forEach(b=>{if(b.prediction){const S=b.prediction.predictedScoreDepression;S&&S in Z&&Z[S]++;const k=b.prediction.predictedScoreAnxiety;k&&k in G&&G[k]++}});const w=C.sessions.reduce((b,S)=>new Date(S.updatedAt)>new Date(b)?S.updatedAt:b,((g=C.sessions[0])==null?void 0:g.updatedAt)||new Date().toISOString());return{userId:v,totalSessions:C.totalSessions,successfulSessions:C.successfulSessions,successRate:j,avgConfidence:Math.round(O*100)/100,riskDistribution:M,lastActivity:w,depressionScores:Z,anxietyScores:G}}).sort((v,C)=>C.totalSessions-v.totalSessions);return{overview:{totalSessions:e,uniqueUsers:t,successRate:a,avgSessionsPerUser:c,recentActivity:d},sessionStatus:{succeeded:r.length,failed:i.length,processing:o.length,total:e},riskLevels:{...h,total:e},predictions:{depression:{...u,total:r.length},anxiety:{...y,total:r.length}},timeData:x,riskDistribution:h,userStats:N}},ls=({title:n,value:e,subtitle:t,icon:r,trend:i,color:o="text-blue-600"})=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:n}),s.jsx("p",{className:`text-2xl font-bold ${o} dark:text-white mt-1`,children:e}),t&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t})]}),s.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${o}`,children:r})]}),i&&s.jsxs("div",{className:"flex items-center mt-4",children:[i==="up"&&s.jsx(rn,{className:"h-4 w-4 text-green-500 mr-1"}),i==="down"&&s.jsx(Hl,{className:"h-4 w-4 text-red-500 mr-1"}),s.jsx("span",{className:`text-sm ${i==="up"?"text-green-600":i==="down"?"text-red-600":"text-gray-500"}`,children:i==="up"?"Trending up":i==="down"?"Trending down":"Stable"})]})]}),ds=({title:n,data:e,total:t})=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:n}),s.jsx("div",{className:"space-y-3",children:e.map((r,i)=>{const o=Hn(r.value,t);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r.label}),s.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[r.value," (",o,"%)"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${r.color}`,style:{width:`${o}%`},role:"progressbar","aria-label":`${r.label}: ${r.value} (${o}%)`})})]},i)})})]}),vf=({title:n,data:e})=>{const t=Math.max(...e.map(o=>o.count),1),r=0,i=t-r||1;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"relative h-48",children:s.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[s.jsxs("defs",{children:[s.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),s.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),s.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),s.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),e.map((o,a)=>{const c=80/e.length,l=a/(e.length-1)*(100-c)+c/2,d=(o.count-r)/i*95,h=100-d;return s.jsx("rect",{x:l-c/2,y:h,width:c*.6,height:d,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},a)})]})}),s.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:e.map((o,a)=>{const c=new Date(o.date),l=c.toLocaleDateString("en-US",{weekday:"short"}),d=c.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.jsxs("div",{className:"text-center flex-1",children:[s.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:l}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:d}),s.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:o.count})]},a)})})]})},kf=({title:n,depressionData:e,anxietyData:t})=>{const r=[{depression:e.no_to_mild,anxiety:t.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:e.mild_to_moderate,anxiety:t.mild,severity:"Mild",label:"Mild"},{depression:e.moderate_to_severe,anxiety:t.moderate,severity:"Moderate",label:"Moderate"},{depression:e.severe,anxiety:t.moderately_severe+t.severe,severity:"High",label:"Severe"}],i=Math.max(...r.map(a=>Math.max(a.depression,a.anxiety)),10),o=a=>{switch(a){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"relative h-96",children:s.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 400 300",children:[s.jsx("defs",{children:s.jsx("pattern",{id:"correlationGrid",width:"40",height:"30",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 40 0 L 0 0 0 30",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),s.jsx("rect",{width:"400",height:"300",fill:"url(#correlationGrid)"}),s.jsx("line",{x1:"50",y1:"270",x2:"370",y2:"270",stroke:"rgb(107 114 128)",strokeWidth:"2"}),s.jsx("line",{x1:"50",y1:"270",x2:"50",y2:"30",stroke:"rgb(107 114 128)",strokeWidth:"2"}),r.map((a,c)=>{const l=50+a.depression/i*320,d=270-a.anxiety/i*240,h=Math.max(Math.sqrt(a.depression+a.anxiety)*2.5,8);return s.jsxs("g",{children:[s.jsx("circle",{cx:l,cy:d,r:h,className:`${o(a.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),s.jsx("text",{x:l,y:d+4,textAnchor:"middle",className:"text-xs fill-white font-bold",children:a.depression+a.anxiety})]},c)}),s.jsx("text",{x:"210",y:"295",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases "}),s.jsx("text",{x:"30",y:"150",textAnchor:"middle",transform:"rotate(-90 30 150)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:" Anxiety Cases"})]})}),s.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:r.map((a,c)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${o(a.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:a.label})]},c))})]})},Cf=({title:n,sessionStatus:e})=>{const t=[{label:"Total Sessions",value:e.total,color:"bg-blue-500"},{label:"In Processing",value:e.processing,color:"bg-yellow-500"},{label:"Completed",value:e.succeeded,color:"bg-green-500"},{label:"Failed",value:e.failed,color:"bg-red-500"}],r=e.total||1;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"space-y-4",children:t.map((i,o)=>{const a=i.value/r*100,c=o>0?(i.value/t[0].value*100).toFixed(1):"100.0";return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.label}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:i.value}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",c,"%)"]})]})]}),s.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[s.jsx("div",{className:`h-full ${i.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${a}%`},children:a>20&&s.jsx("span",{className:"text-xs font-medium text-white",children:i.value})}),o<t.length-1&&s.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},o)})}),s.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(e.succeeded/e.total*100).toFixed(1),"%"]}),s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(e.failed/e.total*100).toFixed(1),"%"]}),s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},Sf=({userStats:n})=>{const e=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=(a,c)=>{if(c===0)return"text-gray-400";switch(a){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},r=n.length,i=r>0?Math.round(n.reduce((a,c)=>a+c.totalSessions,0)/r*10)/10:0,o=n.length>0?n.reduce((a,c)=>c.successRate>a.successRate?c:a,n[0]):null;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[s.jsx($l,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),s.jsxs("div",{className:"flex space-x-6 text-sm",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:i}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),o&&s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"font-semibold text-green-600",children:[o.successRate,"%"]}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Best Job Success Rate"})]})]})]}),n.length===0?s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):s.jsxs("div",{children:[s.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[s.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white",children:"User ID"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Job Success Rate"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Avg Confidence"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Risk Distribution"}),s.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),s.jsx("tbody",{children:n.map((a,c)=>s.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${c%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[s.jsx("td",{className:"py-3 px-2",children:s.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.jsxs("div",{className:"truncate max-w-[120px]",title:a.userId,children:[a.userId.substring(0,8),"..."]})})}),s.jsxs("td",{className:"py-3 px-2 text-center",children:[s.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:a.totalSessions}),s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a.successfulSessions," successful"]})]}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:`font-medium ${a.successRate>=80?"text-green-600":a.successRate>=60?"text-yellow-600":"text-red-600"}`,children:[a.successRate,"%"]})}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(a.avgConfidence*100).toFixed(1),"%"]})}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("low",a.riskDistribution.low)}`,children:["L:",a.riskDistribution.low]}),s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("medium",a.riskDistribution.medium)}`,children:["M:",a.riskDistribution.medium]}),s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("high",a.riskDistribution.high)}`,children:["H:",a.riskDistribution.high]})]})}),s.jsx("td",{className:"py-3 px-2 text-right",children:s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e(a.lastActivity)})})]},a.userId))})]})})]})]})},_f=()=>{const[n,e]=m.useState(null),[t,r]=m.useState(!1),[i,o]=m.useState(null),[a,c]=m.useState(new Date),{announceToScreenReader:l}=xr(),d=parseInt({}.VITE_CONTROL_PANEL_REFRESH_INTERVAL||"69")*1e3,h=m.useCallback(async()=>{try{r(!0),o(null);let y=[];try{y=(await pe.getAllSessions()).sessions}catch(U){console.warn("getAllSessions endpoint not available, using mock data for demonstration:",U),y=[{sessionId:"demo-session-1",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*2).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_1.wav",prediction:{sessionId:"demo-session-1",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"no_or_minimal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.85,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-2",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*6).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_2.wav",prediction:{sessionId:"demo-session-2",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.92,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-3",userId:"9d8c7b6a-5e4f-4392-8a1b-0c9d8e7f6a5b",status:"failed",createdAt:new Date(Date.now()-1e3*60*60*12).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_3.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing failed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-4",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*24).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_4.wav",prediction:{sessionId:"demo-session-4",status:"succeeded",predictedScoreDepression:"moderate_to_severe",predictedScoreAnxiety:"moderately_severe",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"high",confidence:.78,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-5",userId:"4c3b2a19-8e7f-4d6c-5b4a-392817f6e5d4",status:"processing",createdAt:new Date(Date.now()-1e3*60*30).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_5.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing in progress"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-6",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*36).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_6.wav",prediction:{sessionId:"demo-session-6",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"mild",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.89,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-7",userId:"7f6e5d4c-3b2a-4190-8e7f-6d5c4b3a2918",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*48).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_7.wav",prediction:{sessionId:"demo-session-7",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.82,insights:["Analysis completed"],completedAt:new Date().toISOString()}}]}const x=wf(y);e(x),c(new Date),l("Control panel data loaded successfully")}catch(y){const x=y;o(x),l(`Error loading control panel data: ${x.message}`)}finally{r(!1)}},[l]);m.useEffect(()=>{h()},[h]),m.useEffect(()=>{const y=setInterval(()=>{t||h()},d);return()=>clearInterval(y)},[h,t,d]);const u=m.useCallback(()=>{o(null),h()},[h]);return t?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Se,{className:"h-6 w-6 animate-spin text-blue-500"}),s.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):i?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(st,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:i.message}),s.jsxs("button",{onClick:u,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(Se,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):n?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights dashboard"})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",a.toLocaleTimeString()]}),s.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",d/1e3,"s intervals"]})]}),s.jsxs("button",{onClick:h,disabled:t,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors","aria-label":"Refresh control panel data",children:[s.jsx(Se,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsx(ls,{title:"Total Sessions",value:n.overview.totalSessions,subtitle:"All time",icon:s.jsx(Hr,{className:"h-6 w-6"}),color:"text-blue-600"}),s.jsx(ls,{title:"Unique Users",value:n.overview.uniqueUsers,subtitle:"Active users",icon:s.jsx($l,{className:"h-6 w-6"}),color:"text-green-600"}),s.jsx(ls,{title:"Job Success Rate",value:`${n.overview.successRate}%`,subtitle:"Completed analyses",icon:s.jsx(Ul,{className:"h-6 w-6"}),color:"text-purple-600",trend:n.overview.successRate>75?"up":n.overview.successRate<50?"down":"neutral"}),s.jsx(ls,{title:"Recent Activity",value:n.overview.recentActivity,subtitle:"Last 24 hours",icon:s.jsx(Dt,{className:"h-6 w-6"}),color:"text-orange-600",trend:n.overview.recentActivity>5?"up":n.overview.recentActivity===0?"down":"neutral"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsx(ds,{title:"Session Status Distribution",data:[{label:"Succeeded",value:n.sessionStatus.succeeded,color:"bg-green-500"},{label:"Processing",value:n.sessionStatus.processing,color:"bg-yellow-500"},{label:"Failed",value:n.sessionStatus.failed,color:"bg-red-500"}],total:n.sessionStatus.total}),s.jsx(ds,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:n.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:n.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:n.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:n.riskLevels.unknown,color:"bg-gray-500"}],total:n.riskLevels.total})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsx(ds,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:n.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:n.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:n.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:n.predictions.depression.severe,color:"bg-red-500"}],total:n.predictions.depression.total}),s.jsx(ds,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:n.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:n.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:n.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:n.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:n.predictions.anxiety.severe,color:"bg-red-700"}],total:n.predictions.anxiety.total})]}),s.jsx("div",{className:"mb-8",children:s.jsx(Sf,{userStats:n.userStats})}),s.jsx("div",{className:"mb-8",children:s.jsx(kf,{title:"Depression vs Anxiety Correlation",depressionData:n.predictions.depression,anxietyData:n.predictions.anxiety})}),s.jsx("div",{className:"mb-8",children:s.jsx(Cf,{title:"Session Completion Funnel",sessionStatus:n.sessionStatus})}),s.jsx("div",{className:"mb-8",children:s.jsx(vf,{title:"Sessions Over Time (7 Days)",data:n.timeData})}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Zi,{className:"h-5 w-5 mr-2 text-red-500"}),"System Health Overview"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.overview.successRate,"%"]}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Job Success Rate"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:n.overview.totalSessions}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Sessions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:n.sessionStatus.processing}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Processing"})]})]})]})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})};class Af extends ld.EventEmitter{constructor(t){super();se(this,"recognition",null);se(this,"synthesis",null);se(this,"audioContext",null);se(this,"microphone",null);se(this,"analyzer",null);se(this,"vadProcessor",null);se(this,"stream",null);se(this,"isListening",!1);se(this,"isVADActive",!1);se(this,"silenceTimeout",null);se(this,"speechTimeout",null);se(this,"config",{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:3,audioTracks:!0,noiseReduction:!0,echoCancellation:!0});this.config={...this.config,...t},this.initializeServices()}async initializeServices(){try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new t,this.setupSpeechRecognition()}"speechSynthesis"in window&&(this.synthesis=window.speechSynthesis),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.emit("initialized",{speechRecognition:!!this.recognition,speechSynthesis:!!this.synthesis,voiceActivityDetection:!!this.audioContext})}catch(t){console.error("Error initializing speech services:",t),this.emit("error",{type:"initialization",error:t})}}setupSpeechRecognition(){this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives,this.recognition.onstart=()=>{this.isListening=!0,this.emit("listening",{started:!0})},this.recognition.onresult=t=>{const r=[];for(let o=t.resultIndex;o<t.results.length;o++){const a=t.results[o],c=a[0].transcript,l=a[0].confidence,d=a.isFinal,h=[];for(let u=1;u<a.length&&u<this.config.maxAlternatives;u++)h.push(a[u].transcript);r.push({transcript:c,confidence:l,isFinal:d,alternatives:h})}this.emit("result",{results:r});const i=r.filter(o=>o.isFinal);i.length>0&&this.emit("finalResult",{results:i})},this.recognition.onerror=t=>{console.error("Speech recognition error:",t.error),this.emit("error",{type:"recognition",error:t.error}),(t.error==="no-speech"||t.error==="audio-capture")&&setTimeout(()=>this.restartRecognition(),1e3)},this.recognition.onend=()=>{this.isListening=!1,this.emit("listening",{started:!1}),this.config.continuous&&this.isVADActive&&setTimeout(()=>this.startListening(),100)})}async setupVoiceActivityDetection(){try{if(!this.audioContext)throw new Error("AudioContext not available");this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:this.config.echoCancellation,noiseSuppression:this.config.noiseReduction,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyzer=this.audioContext.createAnalyser(),this.vadProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.analyzer.fftSize=256,this.analyzer.smoothingTimeConstant=.8,this.microphone.connect(this.analyzer),this.analyzer.connect(this.vadProcessor),this.vadProcessor.connect(this.audioContext.destination),this.vadProcessor.onaudioprocess=t=>{this.processVAD(t)},this.emit("vadReady")}catch(t){console.error("Error setting up VAD:",t),this.emit("error",{type:"vad",error:t})}}processVAD(t){if(!this.analyzer)return;const r=this.analyzer.frequencyBinCount,i=new Uint8Array(r);this.analyzer.getByteFrequencyData(i);let o=0;for(let d=0;d<r;d++)o+=i[d];const a=o/r,l=a>30;this.emit("voiceActivity",{isActive:l,volume:a,timestamp:Date.now()}),l?(this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout||(this.speechTimeout=setTimeout(()=>{this.emit("speechStart")},200))):(this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null),this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.emit("speechEnd")},1500)))}async startListening(){try{if(!this.recognition)throw new Error("Speech recognition not available");this.isVADActive||(await this.setupVoiceActivityDetection(),this.isVADActive=!0),this.isListening||this.recognition.start()}catch(t){console.error("Error starting speech recognition:",t),this.emit("error",{type:"start",error:t})}}stopListening(){try{this.recognition&&this.isListening&&this.recognition.stop(),this.isVADActive=!1,this.vadProcessor&&this.vadProcessor.disconnect(),this.analyzer&&this.analyzer.disconnect(),this.microphone&&this.microphone.disconnect(),this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null)}catch(t){console.error("Error stopping speech recognition:",t),this.emit("error",{type:"stop",error:t})}}restartRecognition(){this.isVADActive&&(this.stopListening(),setTimeout(()=>this.startListening(),500))}async speak(t,r){return new Promise((i,o)=>{if(!this.synthesis){o(new Error("Speech synthesis not available"));return}r!=null&&r.interrupt&&this.synthesis.cancel();const a=new SpeechSynthesisUtterance(t);a.rate=(r==null?void 0:r.rate)||.9,a.pitch=(r==null?void 0:r.pitch)||1,a.volume=(r==null?void 0:r.volume)||.8,r!=null&&r.voice&&(a.voice=r.voice),a.onend=()=>{this.emit("speechEnd",{text:t}),i()},a.onerror=c=>{this.emit("error",{type:"synthesis",error:c.error}),o(new Error(`Speech synthesis error: ${c.error}`))},a.onstart=()=>{this.emit("speechStart",{text:t})},this.synthesis.speak(a)})}getAvailableVoices(){return this.synthesis?this.synthesis.getVoices():[]}updateConfig(t){this.config={...this.config,...t},this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives)}isAvailable(){return!!(this.recognition&&this.synthesis)}isCurrentlyListening(){return this.isListening}destroy(){this.stopListening(),this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.removeAllListeners()}}const If=(n={})=>{const e=m.useRef(null),[t,r]=m.useState(!1),[i,o]=m.useState(!1),[a,c]=m.useState(!1),[l,d]=m.useState(0),[h,u]=m.useState(null),[y,x]=m.useState(!1),[U,N]=m.useState([]);m.useEffect(()=>{e.current=new Af(n.config);const O=e.current;return O.on("initialized",M=>{o(M.speechRecognition&&M.speechSynthesis),x(!0),N(O.getAvailableVoices())}),O.on("listening",({started:M})=>{r(M)}),O.on("result",({results:M})=>{var Z;(Z=n.onResult)==null||Z.call(n,M)}),O.on("finalResult",({results:M})=>{var Z;(Z=n.onFinalResult)==null||Z.call(n,M)}),O.on("voiceActivity",M=>{var Z;c(M.isActive),d(M.volume),(Z=n.onVoiceActivity)==null||Z.call(n,M)}),O.on("speechStart",()=>{var M;(M=n.onSpeechStart)==null||M.call(n)}),O.on("speechEnd",()=>{var M;(M=n.onSpeechEnd)==null||M.call(n)}),O.on("error",({type:M,error:Z})=>{var w;const G=`Speech ${M} error: ${Z}`;u(G),(w=n.onError)==null||w.call(n,{type:M,error:Z}),console.error(G)}),n.autoStart&&O.startListening().catch(console.error),()=>{O.destroy()}},[]);const v=m.useCallback(async()=>{try{u(null),e.current&&await e.current.startListening()}catch(O){const M=O instanceof Error?O.message:"Failed to start listening";throw u(M),O}},[]),C=m.useCallback(()=>{try{u(null),e.current&&e.current.stopListening()}catch(O){const M=O instanceof Error?O.message:"Failed to stop listening";u(M)}},[]),j=m.useCallback(async(O,M)=>{try{u(null),e.current&&await e.current.speak(O,M)}catch(Z){const G=Z instanceof Error?Z.message:"Failed to speak";throw u(G),Z}},[]),J=m.useCallback(O=>{e.current&&e.current.updateConfig(O)},[]);return m.useEffect(()=>{if(y&&e.current){const O=()=>{N(e.current.getAvailableVoices())};if(O(),"speechSynthesis"in window)return window.speechSynthesis.addEventListener("voiceschanged",O),()=>{window.speechSynthesis.removeEventListener("voiceschanged",O)}}},[y]),{isListening:t,isAvailable:i,isVoiceActive:a,volume:l,startListening:v,stopListening:C,speak:j,updateConfig:J,availableVoices:U,error:h,isInitialized:y}};class Bt extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class eo extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class at extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Tf extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class Nf extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class Ef extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class ca extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Rf extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class zl{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class sn{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var A;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(A||(A={}));class Br{constructor(){}log(e,t){}}Br.instance=new Br;const jf="9.0.6";class be{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class fe{static get isBrowser(){return!fe.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!fe.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!fe.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Kr(n,e){let t="";return Qt(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${Pf(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Pf(n){const e=new Uint8Array(n);let t="";return e.forEach(r=>{const i=r<16?"0":"";t+=`0x${i}${r.toString(16)} `}),t.substr(0,t.length-1)}function Qt(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Gl(n,e,t,r,i,o){const a={},[c,l]=hr();a[c]=l,n.log(A.Trace,`(${e} transport) sending data. ${Kr(i,o.logMessageContent)}.`);const d=Qt(i)?"arraybuffer":"text",h=await t.post(r,{content:i,headers:{...a,...o.headers},responseType:d,timeout:o.timeout,withCredentials:o.withCredentials});n.log(A.Trace,`(${e} transport) request complete. Response status: ${h.statusCode}.`)}function Of(n){return n===void 0?new Ls(A.Information):n===null?Br.instance:n.log!==void 0?n:new Ls(n)}class Mf{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class Ls{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${A[e]}: ${t}`;switch(e){case A.Critical:case A.Error:this.out.error(r);break;case A.Warning:this.out.warn(r);break;case A.Information:this.out.info(r);break;default:this.out.log(r);break}}}}function hr(){let n="X-SignalR-User-Agent";return fe.isNode&&(n="User-Agent"),[n,Df(jf,Lf(),Hf(),Uf())]}function Df(n,e,t,r){let i="Microsoft SignalR/";const o=n.split(".");return i+=`${o[0]}.${o[1]}`,i+=` (${n}; `,e&&e!==""?i+=`${e}; `:i+="Unknown OS; ",i+=`${t}`,r?i+=`; ${r}`:i+="; Unknown Runtime Version",i+=")",i}function Lf(){if(fe.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Uf(){if(fe.isNode)return process.versions.node}function Hf(){return fe.isNode?"NodeJS":"Browser"}function yn(n){return n.stack?n.stack:n.message?n.message:`${n}`}function Ff(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("could not find globalThis")}class $f extends sn{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||fe.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Ff());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new at;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new at});let i=null;if(e.timeout){const l=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(A.Warning,"Timeout from HTTP request."),r=new eo},l)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Qt(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(l){throw r||(this._logger.log(A.Warning,`Error from HTTP request. ${l}.`),l)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const l=await la(o,"text");throw new Bt(l||o.statusText,o.status)}const c=await la(o,e.responseType);return new zl(o.status,o.statusText,c)}getCookieString(e){let t="";return fe.isNode&&this._jar&&this._jar.getCookies(e,(r,i)=>t=i.join("; ")),t}}function la(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class Bf extends sn{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new at):e.method?e.url?new Promise((t,r)=>{const i=new XMLHttpRequest;i.open(e.method,e.url,!0),i.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Qt(e.content)?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach(a=>{i.setRequestHeader(a,o[a])}),e.responseType&&(i.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{i.abort(),r(new at)}),e.timeout&&(i.timeout=e.timeout),i.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),i.status>=200&&i.status<300?t(new zl(i.status,i.statusText,i.response||i.responseText)):r(new Bt(i.response||i.responseText||i.statusText,i.status))},i.onerror=()=>{this._logger.log(A.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}.`),r(new Bt(i.statusText,i.status))},i.ontimeout=()=>{this._logger.log(A.Warning,"Timeout from HTTP request."),r(new eo)},i.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Kf extends sn{constructor(e){if(super(),typeof fetch<"u"||fe.isNode)this._httpClient=new $f(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new Bf(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new at):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class Je{static write(e){return`${e}${Je.RecordSeparator}`}static parse(e){if(e[e.length-1]!==Je.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(Je.RecordSeparator);return t.pop(),t}}Je.RecordSeparatorCode=30;Je.RecordSeparator=String.fromCharCode(Je.RecordSeparatorCode);class zf{writeHandshakeRequest(e){return Je.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Qt(e)){const c=new Uint8Array(e),l=c.indexOf(Je.RecordSeparatorCode);if(l===-1)throw new Error("Message is incomplete.");const d=l+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,d))),r=c.byteLength>d?c.slice(d).buffer:null}else{const c=e,l=c.indexOf(Je.RecordSeparator);if(l===-1)throw new Error("Message is incomplete.");const d=l+1;t=c.substring(0,d),r=c.length>d?c.substring(d):null}const i=Je.parse(t),o=JSON.parse(i[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[r,o]}}var Y;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(Y||(Y={}));class Gf{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new Mf(this,e)}}class qf{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let i=()=>{},o=()=>{};Qt(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((a,c)=>{i=a,o=c})),this._messages.push(new Vf(t,this._totalMessageCount,i,o))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const i=this._messages[r];if(i._id<=e.sequenceId)t=r,Qt(i._message)?this._bufferedByteCount-=i._message.byteLength:this._bufferedByteCount-=i._message.length,i._resolver();else if(this._bufferedByteCount<this._bufferSize)i._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==Y.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:Y.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case Y.Invocation:case Y.StreamItem:case Y.Completion:case Y.StreamInvocation:case Y.CancelInvocation:return!0;case Y.Close:case Y.Sequence:case Y.Ping:case Y.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:Y.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class Vf{constructor(e,t,r,i){this._message=e,this._id=t,this._resolver=r,this._rejector=i}}const Wf=30*1e3,Qf=15*1e3,Yf=1e5;var ie;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(ie||(ie={}));class to{static create(e,t,r,i,o,a,c){return new to(e,t,r,i,o,a,c)}constructor(e,t,r,i,o,a,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(A.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},be.isRequired(e,"connection"),be.isRequired(t,"logger"),be.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=o??Wf,this.keepAliveIntervalInMilliseconds=a??Qf,this._statefulReconnectBufferSize=c??Yf,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=i,this._handshakeProtocol=new zf,this.connection.onreceive=l=>this._processIncomingData(l),this.connection.onclose=l=>this._connectionClosed(l),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=ie.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:Y.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==ie.Disconnected&&this._connectionState!==ie.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==ie.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=ie.Connecting,this._logger.log(A.Debug,"Starting HubConnection.");try{await this._startInternal(),fe.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=ie.Connected,this._connectionStarted=!0,this._logger.log(A.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=ie.Disconnected,this._logger.log(A.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(A.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(A.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new qf(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(A.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===ie.Disconnected)return this._logger.log(A.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===ie.Disconnecting)return this._logger.log(A.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=ie.Disconnecting,this._logger.log(A.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(A.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===ie.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new at("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,i);let a;const c=new Gf;return c.cancelCallback=()=>{const l=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],a.then(()=>this._sendWithProtocol(l))},this._callbacks[o.invocationId]=(l,d)=>{if(d){c.error(d);return}else l&&(l.type===Y.Completion?l.error?c.error(new Error(l.error)):c.complete():c.next(l.item))},a=this._sendWithProtocol(o).catch(l=>{c.error(l),delete this._callbacks[o.invocationId]}),this._launchStreams(r,a),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,i));return this._launchStreams(r,o),o}invoke(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,i);return new Promise((c,l)=>{this._callbacks[o.invocationId]=(h,u)=>{if(u){l(u);return}else h&&(h.type===Y.Completion?h.error?l(new Error(h.error)):c(h.result):l(new Error(`Unexpected message type: ${h.type}`)))};const d=this._sendWithProtocol(o).catch(h=>{l(h),delete this._callbacks[o.invocationId]});this._launchStreams(r,d)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const i=r.indexOf(t);i!==-1&&(r.splice(i,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(r)))switch(r.type){case Y.Invocation:this._invokeClientMethod(r).catch(i=>{this._logger.log(A.Error,`Invoke client method threw error: ${yn(i)}`)});break;case Y.StreamItem:case Y.Completion:{const i=this._callbacks[r.invocationId];if(i){r.type===Y.Completion&&delete this._callbacks[r.invocationId];try{i(r)}catch(o){this._logger.log(A.Error,`Stream callback threw error: ${yn(o)}`)}}break}case Y.Ping:break;case Y.Close:{this._logger.log(A.Information,"Close message received from server.");const i=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(i):this._stopPromise=this._stopInternal(i);break}case Y.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case Y.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(A.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(i){const o="Error parsing handshake response: "+i;this._logger.log(A.Error,o);const a=new Error(o);throw this._handshakeRejecter(a),a}if(t.error){const i="Server returned handshake error: "+t.error;this._logger.log(A.Error,i);const o=new Error(i);throw this._handshakeRejecter(o),o}else this._logger.log(A.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===ie.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r){this._logger.log(A.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(A.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const i=r.slice(),o=!!e.invocationId;let a,c,l;for(const d of i)try{const h=a;a=await d.apply(this,e.arguments),o&&a&&h&&(this._logger.log(A.Error,`Multiple results provided for '${t}'. Sending error to server.`),l=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(h){c=h,this._logger.log(A.Error,`A callback for the method '${t}' threw error '${h}'.`)}l?await this._sendWithProtocol(l):o?(c?l=this._createCompletionMessage(e.invocationId,`${c}`,null):a!==void 0?l=this._createCompletionMessage(e.invocationId,null,a):(this._logger.log(A.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),l=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(l)):a&&this._logger.log(A.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(A.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new at("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===ie.Disconnecting?this._completeClose(e):this._connectionState===ie.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===ie.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=ie.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),fe.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(A.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,i=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(r++,0,i);if(o===null){this._logger.log(A.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=ie.Reconnecting,e?this._logger.log(A.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(A.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(a=>a.apply(this,[e]))}catch(a){this._logger.log(A.Error,`An onreconnecting callback called with error '${e}' threw error '${a}'.`)}if(this._connectionState!==ie.Reconnecting){this._logger.log(A.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(A.Information,`Reconnect attempt number ${r} will start in ${o} ms.`),await new Promise(a=>{this._reconnectDelayHandle=setTimeout(a,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==ie.Reconnecting){this._logger.log(A.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=ie.Connected,this._logger.log(A.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(a=>a.apply(this,[this.connection.connectionId]))}catch(a){this._logger.log(A.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${a}'.`)}return}catch(a){if(this._logger.log(A.Information,`Reconnect attempt failed because of error '${a}'.`),this._connectionState!==ie.Reconnecting){this._logger.log(A.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===ie.Disconnecting&&this._completeClose();return}i=a instanceof Error?a:new Error(a.toString()),o=this._getNextRetryDelay(r++,Date.now()-t,i)}}this._logger.log(A.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(i){return this._logger.log(A.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${i}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const i=t[r];try{i(null,e)}catch(o){this._logger.log(A.Error,`Stream 'error' callback called with '${e}' threw error: ${yn(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,i){if(r)return i.length!==0?{target:e,arguments:t,streamIds:i,type:Y.Invocation}:{target:e,arguments:t,type:Y.Invocation};{const o=this._invocationId;return this._invocationId++,i.length!==0?{target:e,arguments:t,invocationId:o.toString(),streamIds:i,type:Y.Invocation}:{target:e,arguments:t,invocationId:o.toString(),type:Y.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:i=>{let o;i instanceof Error?o=i.message:i&&i.toString?o=i.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,o)))},next:i=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,i)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let i=0;i<e.length;i++){const o=e[i];if(this._isObservable(o)){const a=this._invocationId;this._invocationId++,t[a]=o,r.push(a.toString()),e.splice(i,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const i=this._invocationId;return this._invocationId++,r.length!==0?{target:e,arguments:t,invocationId:i.toString(),streamIds:r,type:Y.StreamInvocation}:{target:e,arguments:t,invocationId:i.toString(),type:Y.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:Y.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:Y.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:Y.Completion}:{invocationId:e,result:r,type:Y.Completion}}_createCloseMessage(){return{type:Y.Close}}}const Jf=[0,2e3,1e4,3e4,null];class da{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Jf}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Kt{}Kt.Authorization="Authorization";Kt.Cookie="Cookie";class Xf extends sn{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Kt.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Kt.Authorization]&&delete e.headers[Kt.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var ve;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(ve||(ve={}));var De;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(De||(De={}));let Zf=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class ha{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new Zf,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(be.isRequired(e,"url"),be.isRequired(t,"transferFormat"),be.isIn(t,De,"transferFormat"),this._url=e,this._logger.log(A.Trace,"(LongPolling transport) Connecting."),t===De.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,i]=hr(),o={[r]:i,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===De.Binary&&(a.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(A.Trace,`(LongPolling transport) polling: ${c}.`);const l=await this._httpClient.get(c,a);l.statusCode!==200?(this._logger.log(A.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this._closeError=new Bt(l.statusText||"",l.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(A.Trace,`(LongPolling transport) polling: ${r}.`);const i=await this._httpClient.get(r,t);i.statusCode===204?(this._logger.log(A.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):i.statusCode!==200?(this._logger.log(A.Error,`(LongPolling transport) Unexpected response code: ${i.statusCode}.`),this._closeError=new Bt(i.statusText||"",i.statusCode),this._running=!1):i.content?(this._logger.log(A.Trace,`(LongPolling transport) data received. ${Kr(i.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(i.content)):this._logger.log(A.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof eo?this._logger.log(A.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(A.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(A.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Gl(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(A.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(A.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=hr();e[t]=r;const i={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,i)}catch(a){o=a}o?o instanceof Bt&&(o.statusCode===404?this._logger.log(A.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(A.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(A.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(A.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(A.Trace,e),this.onclose(this._closeError)}}}class ey{constructor(e,t,r,i){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=i,this.onreceive=null,this.onclose=null}async connect(e,t){return be.isRequired(e,"url"),be.isRequired(t,"transferFormat"),be.isIn(t,De,"transferFormat"),this._logger.log(A.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,i)=>{let o=!1;if(t!==De.Text){i(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let a;if(fe.isBrowser||fe.isWebWorker)a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),l={};l.Cookie=c;const[d,h]=hr();l[d]=h,a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...l,...this._options.headers}})}try{a.onmessage=c=>{if(this.onreceive)try{this._logger.log(A.Trace,`(SSE transport) data received. ${Kr(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(l){this._close(l);return}},a.onerror=c=>{o?this._close():i(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},a.onopen=()=>{this._logger.log(A.Information,`SSE connected to ${this._url}`),this._eventSource=a,o=!0,r()}}catch(c){i(c);return}})}async send(e){return this._eventSource?Gl(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class ty{constructor(e,t,r,i,o,a){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=i,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,t){be.isRequired(e,"url"),be.isRequired(t,"transferFormat"),be.isIn(t,De,"transferFormat"),this._logger.log(A.Trace,"(WebSockets transport) Connecting.");let r;return this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((i,o)=>{e=e.replace(/^http/,"ws");let a;const c=this._httpClient.getCookieString(e);let l=!1;if(fe.isNode||fe.isReactNative){const d={},[h,u]=hr();d[h]=u,r&&(d[Kt.Authorization]=`Bearer ${r}`),c&&(d[Kt.Cookie]=c),a=new this._webSocketConstructor(e,void 0,{headers:{...d,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);a||(a=new this._webSocketConstructor(e)),t===De.Binary&&(a.binaryType="arraybuffer"),a.onopen=d=>{this._logger.log(A.Information,`WebSocket connected to ${e}.`),this._webSocket=a,l=!0,i()},a.onerror=d=>{let h=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?h=d.error:h="There was an error with the transport",this._logger.log(A.Information,`(WebSockets transport) ${h}.`)},a.onmessage=d=>{if(this._logger.log(A.Trace,`(WebSockets transport) data received. ${Kr(d.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(d.data)}catch(h){this._close(h);return}},a.onclose=d=>{if(l)this._close(d);else{let h=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?h=d.error:h="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(h))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(A.Trace,`(WebSockets transport) sending data. ${Kr(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(A.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const ua=100;class ry{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,be.isRequired(e,"url"),this._logger=Of(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let r=null,i=null;if(fe.isNode&&typeof require<"u"){const o=typeof __webpack_require__=="function"?__non_webpack_require__:require;r=o("ws"),i=o("eventsource")}!fe.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:fe.isNode&&!t.WebSocket&&r&&(t.WebSocket=r),!fe.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:fe.isNode&&!t.EventSource&&typeof i<"u"&&(t.EventSource=i),this._httpClient=new Xf(t.httpClient||new Kf(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||De.Binary,be.isIn(e,De,"transferFormat"),this._logger.log(A.Debug,`Starting connection with transfer format '${De[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(A.Error,t),await this._stopPromise,Promise.reject(new at(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(A.Error,t),Promise.reject(new at(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new ro(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(A.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(A.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(A.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(A.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===ve.WebSockets)this.transport=this._constructTransport(ve.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,i=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new at("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const o=r.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}i++}while(r.url&&i<ua);if(i===ua&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof ha&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(A.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(A.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,i]=hr();t[r]=i;const o=this._resolveNegotiateUrl(e);this._logger.log(A.Debug,`Sending negotiation request: ${o}.`);try{const a=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(a.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${a.statusCode}'`));const c=JSON.parse(a.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new ca("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(a){let c="Failed to complete negotiation with the server: "+a;return a instanceof Bt&&a.statusCode===404&&(c=c+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(A.Error,c),Promise.reject(new ca(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,i){let o=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t)){this._logger.log(A.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,i),this.connectionId=r.connectionId;return}const a=[],c=r.availableTransports||[];let l=r;for(const d of c){const h=this._resolveTransportOrError(d,t,i,(l==null?void 0:l.useStatefulReconnect)===!0);if(h instanceof Error)a.push(`${d.transport} failed:`),a.push(h);else if(this._isITransport(h)){if(this.transport=h,!l){try{l=await this._getNegotiationResponse(e)}catch(u){return Promise.reject(u)}o=this._createConnectUrl(e,l.connectionToken)}try{await this._startTransport(o,i),this.connectionId=l.connectionId;return}catch(u){if(this._logger.log(A.Error,`Failed to start the transport '${d.transport}': ${u}`),l=void 0,a.push(new Ef(`${d.transport} failed: ${u}`,ve[d.transport])),this._connectionState!=="Connecting"){const y="Failed to select transport before stop() was called.";return this._logger.log(A.Debug,y),Promise.reject(new at(y))}}}}return a.length>0?Promise.reject(new Rf(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case ve.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new ty(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ve.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ey(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ve.LongPolling:return new ha(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let i=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{i=!0}else{this._stopConnection(r);return}i&&this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,i){const o=ve[e.transport];if(o==null)return this._logger.log(A.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(sy(t,o))if(e.transferFormats.map(c=>De[c]).indexOf(r)>=0){if(o===ve.WebSockets&&!this._options.WebSocket||o===ve.ServerSentEvents&&!this._options.EventSource)return this._logger.log(A.Debug,`Skipping transport '${ve[o]}' because it is not supported in your environment.'`),new Tf(`'${ve[o]}' is not supported in your environment.`,o);this._logger.log(A.Debug,`Selecting transport '${ve[o]}'.`);try{return this.features.reconnect=o===ve.WebSockets?i:void 0,this._constructTransport(o)}catch(c){return c}}else return this._logger.log(A.Debug,`Skipping transport '${ve[o]}' because it does not support the requested transfer format '${De[r]}'.`),new Error(`'${ve[o]}' does not support ${De[r]}.`);else return this._logger.log(A.Debug,`Skipping transport '${ve[o]}' because it was disabled by the client.`),new Nf(`'${ve[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(A.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(A.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(A.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(A.Error,`Connection disconnected with error '${e}'.`):this._logger.log(A.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(A.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(A.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!fe.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(A.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}function sy(n,e){return!n||(e&n)!==0}class ro{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new hs,this._transportResult=new hs,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new hs),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new hs;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):ro._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(o=>o.byteLength).reduce((o,a)=>o+a),r=new Uint8Array(t);let i=0;for(const o of e)r.set(new Uint8Array(o),i),i+=o.byteLength;return r.buffer}}class hs{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const ny="json";class iy{constructor(){this.name=ny,this.version=2,this.transferFormat=De.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Br.instance);const r=Je.parse(e),i=[];for(const o of r){const a=JSON.parse(o);if(typeof a.type!="number")throw new Error("Invalid payload.");switch(a.type){case Y.Invocation:this._isInvocationMessage(a);break;case Y.StreamItem:this._isStreamItemMessage(a);break;case Y.Completion:this._isCompletionMessage(a);break;case Y.Ping:break;case Y.Close:break;case Y.Ack:this._isAckMessage(a);break;case Y.Sequence:this._isSequenceMessage(a);break;default:t.log(A.Information,"Unknown message type '"+a.type+"' ignored.");continue}i.push(a)}return i}writeMessage(e){return Je.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const oy={trace:A.Trace,debug:A.Debug,info:A.Information,information:A.Information,warn:A.Warning,warning:A.Warning,error:A.Error,critical:A.Critical,none:A.None};function ay(n){const e=oy[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}class cy{configureLogging(e){if(be.isRequired(e,"logging"),ly(e))this.logger=e;else if(typeof e=="string"){const t=ay(e);this.logger=new Ls(t)}else this.logger=new Ls(e);return this}withUrl(e,t){return be.isRequired(e,"url"),be.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return be.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new da(e):this.reconnectPolicy=e:this.reconnectPolicy=new da,this}withServerTimeout(e){return be.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return be.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new ry(this.url,e);return to.create(t,this.logger||Br.instance,this.protocol||new iy,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function ly(n){return n.log!==void 0}class dy{constructor(e="http://localhost:7071"){se(this,"connection",null);se(this,"sessionId",null);se(this,"onAgentMessageHandler");se(this,"onHandoffHandler");se(this,"onAgentTypingHandler");se(this,"onSessionStatusHandler");se(this,"onErrorHandler");this.baseUrl=e,this.setupConnection()}setupConnection(){this.connection=new cy().withUrl(`${this.baseUrl}/api`).withAutomaticReconnect().configureLogging(A.Information).build(),this.connection.on("AgentMessage",e=>{var t;console.log("Received agent message:",e),(t=this.onAgentMessageHandler)==null||t.call(this,e)}),this.connection.on("AgentHandoff",e=>{var t;console.log("Received handoff notification:",e),(t=this.onHandoffHandler)==null||t.call(this,e)}),this.connection.on("AgentTyping",e=>{var t;console.log("Received typing notification:",e),(t=this.onAgentTypingHandler)==null||t.call(this,e)}),this.connection.on("SessionStatus",e=>{var t;console.log("Received session status:",e),(t=this.onSessionStatusHandler)==null||t.call(this,e)}),this.connection.onreconnecting(()=>{console.log("SignalR reconnecting...")}),this.connection.onreconnected(()=>{console.log("SignalR reconnected"),this.sessionId&&this.joinSession(this.sessionId)}),this.connection.onclose(e=>{var t;console.error("SignalR connection closed:",e),(t=this.onErrorHandler)==null||t.call(this,`Connection closed: ${(e==null?void 0:e.message)||"Unknown error"}`)})}async start(){if(!this.connection)throw new Error("SignalR connection not initialized");try{await this.connection.start(),console.log("SignalR connection started")}catch(e){throw console.error("Error starting SignalR connection:",e),e}}async stop(){this.connection&&this.connection.state===ie.Connected&&(await this.connection.stop(),console.log("SignalR connection stopped"))}async joinSession(e){if(!this.connection||this.connection.state!==ie.Connected)throw new Error("SignalR connection is not active");try{this.sessionId=e,await this.connection.invoke("JoinSession",e),console.log(`Joined session: ${e}`)}catch(t){throw console.error("Error joining session:",t),t}}async sendUserMessage(e){if(!this.connection||this.connection.state!==ie.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)throw new Error("No active session");try{await this.connection.invoke("SendUserMessage",this.sessionId,e),console.log("User message sent:",e)}catch(t){throw console.error("Error sending user message:",t),t}}async getSessionStatus(){if(!this.connection||this.connection.state!==ie.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)return null;try{return await this.connection.invoke("GetSessionStatus",this.sessionId)}catch(e){throw console.error("Error getting session status:",e),e}}onAgentMessage(e){this.onAgentMessageHandler=e}onAgentHandoff(e){this.onHandoffHandler=e}onAgentTyping(e){this.onAgentTypingHandler=e}onSessionStatus(e){this.onSessionStatusHandler=e}onError(e){this.onErrorHandler=e}get connectionState(){var e;return((e=this.connection)==null?void 0:e.state)||ie.Disconnected}get isConnected(){var e;return((e=this.connection)==null?void 0:e.state)===ie.Connected}get currentSessionId(){return this.sessionId}dispose(){this.stop(),this.connection=null,this.sessionId=null,this.onAgentMessageHandler=void 0,this.onHandoffHandler=void 0,this.onAgentTypingHandler=void 0,this.onSessionStatusHandler=void 0,this.onErrorHandler=void 0}}const Qe=new dy,hy=()=>{const[n,e]=m.useState(ie.Disconnected),[t,r]=m.useState(!1),[i,o]=m.useState(null),[a,c]=m.useState(null),[l,d]=m.useState(null),[h,u]=m.useState([]),[y,x]=m.useState([]),[U,N]=m.useState({}),v=m.useRef(!1);m.useEffect(()=>{if(v.current)return;v.current=!0,Qe.onAgentMessage(w=>{u(g=>[...g,w])}),Qe.onAgentHandoff(w=>{x(g=>[...g,w])}),Qe.onAgentTyping(w=>{N(g=>({...g,[w.agentName]:w.isTyping}))}),Qe.onSessionStatus(w=>{d(w)}),Qe.onError(w=>{o(w)});const G=setInterval(()=>{const w=Qe.connectionState;e(w),r(w===ie.Connected)},1e3);return()=>{clearInterval(G),Qe.dispose()}},[]);const C=m.useCallback(async()=>{try{o(null),await Qe.start(),r(!0)}catch(G){const w=G instanceof Error?G.message:"Failed to connect";throw o(w),G}},[]),j=m.useCallback(async()=>{try{await Qe.stop(),r(!1),c(null),d(null)}catch(G){const w=G instanceof Error?G.message:"Failed to disconnect";throw o(w),G}},[]),J=m.useCallback(async G=>{try{o(null),await Qe.joinSession(G),c(G);const w=await Qe.getSessionStatus();d(w)}catch(w){const g=w instanceof Error?w.message:"Failed to join session";throw o(g),w}},[]),O=m.useCallback(async G=>{try{o(null),await Qe.sendUserMessage(G)}catch(w){const g=w instanceof Error?w.message:"Failed to send message";throw o(g),w}},[]),M=m.useCallback(()=>{u([]),x([]),N({})},[]),Z=m.useCallback(async()=>{try{const G=await Qe.getSessionStatus();d(G)}catch(G){const w=G instanceof Error?G.message:"Failed to refresh session status";throw o(w),G}},[]);return{connectionState:n,isConnected:t,error:i,sessionId:a,sessionStatus:l,agentMessages:h,handoffNotifications:y,agentTyping:U,connect:C,disconnect:j,joinSession:J,sendMessage:O,clearMessages:M,refreshSessionStatus:Z}},uy=({volume:n,isVoiceActive:e,isListening:t,size:r="md",className:i=""})=>{const o={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},a=r==="sm"?3:r==="md"?5:7,c=r==="sm"?16:r==="md"?24:32,l=Math.min(n/100,1);return s.jsx("div",{className:`flex items-center justify-center ${o[r]} ${i}`,children:s.jsx("div",{className:"flex items-end space-x-1 h-full",children:Array.from({length:a}).map((d,h)=>{const u=h/a,y=t&&(e||h===0),x=l>u,U=y&&x?Math.max(4,l*c):4,N=h*100;return s.jsx("div",{className:`w-1 transition-all duration-150 rounded-sm voice-bar ${y?x?"bg-green-500 animate-pulse":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700"}`,"data-height":U,"data-delay":N},h)})})})},gy=({config:n,availableVoices:e,selectedVoice:t,onConfigUpdate:r,onVoiceSelect:i,isOpen:o,onClose:a})=>{const[c,l]=m.useState(n),d=(u,y)=>{const x={...c,[u]:y};l(x),r({[u]:y})},h=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French (France)"},{code:"de-DE",name:"German (Germany)"},{code:"it-IT",name:"Italian (Italy)"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"}];return o?s.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"speech-settings-title",role:"dialog","aria-modal":"true",children:s.jsxs("div",{className:"flex items-center justify-center min-h-full p-4",children:[s.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:a}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Ll,{className:"h-6 w-6 text-primary-600 dark:text-primary-400"}),s.jsx("h2",{id:"speech-settings-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Speech Settings"})]}),s.jsxs("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Close settings",children:[s.jsx("span",{className:"sr-only",children:"Close"}),s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Dl,{className:"h-5 w-5 text-gray-500"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Recognition"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[s.jsx(Ep,{className:"inline h-4 w-4 mr-1"}),"Language"]}),s.jsx("select",{value:c.language,onChange:u=>d("language",u.target.value),title:"Select language for speech recognition",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:h.map(u=>s.jsx("option",{value:u.code,children:u.name},u.code))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recognition Alternatives"}),s.jsxs("select",{value:c.maxAlternatives,onChange:u=>d("maxAlternatives",parseInt(u.target.value)),title:"Select number of recognition alternatives",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:1,children:"1 (fastest)"}),s.jsx("option",{value:2,children:"2 (balanced)"}),s.jsx("option",{value:3,children:"3 (best accuracy)"})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.continuous,onChange:u=>d("continuous",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Continuous listening (auto-restart)"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.interimResults,onChange:u=>d("interimResults",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Show interim results (real-time transcription)"})]})]})]}),s.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Audio Processing"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.noiseReduction,onChange:u=>d("noiseReduction",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.echoCancellation,onChange:u=>d("echoCancellation",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Echo cancellation"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.audioTracks,onChange:u=>d("audioTracks",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Enhanced audio processing"})]})]})]}),s.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx($r,{className:"h-5 w-5 text-gray-500"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Synthesis"})]}),s.jsxs("button",{onClick:()=>window.speechSynthesis.getVoices(),className:"flex items-center space-x-1 px-3 py-1 text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",title:"Refresh available voices",children:[s.jsx(Se,{className:"h-4 w-4"}),s.jsx("span",{children:"Refresh"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Selection"}),s.jsxs("select",{value:(t==null?void 0:t.name)||"",onChange:u=>{const y=e.find(x=>x.name===u.target.value);y&&i(y)},title:"Select voice for speech synthesis",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Default system voice"}),e.map((u,y)=>s.jsxs("option",{value:u.name,children:[u.name," (",u.lang,") ",u.default?"(Default)":""]},y))]}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.length," voices available"]})]}),t&&s.jsx("div",{children:s.jsxs("button",{onClick:()=>{const u=new SpeechSynthesisUtterance("Hello! This is a test of the selected voice.");u.voice=t,window.speechSynthesis.speak(u)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-800 dark:text-primary-200 dark:hover:bg-primary-700",children:[s.jsx($r,{className:"h-4 w-4 mr-1"}),"Test Voice"]})})]})]}),s.jsx("div",{className:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:s.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",children:"Close"})})]})]})}):null},my=()=>{const{handleEnterSpace:n}=El(),[e,t]=m.useState([]),[r,i]=m.useState(""),[o,a]=m.useState(!1),[c,l]=m.useState({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),[d,h]=m.useState(!1),[u,y]=m.useState(!1),[x,U]=m.useState(),N=m.useRef(null),v=m.useRef(null),C=hy(),j=If({config:{continuous:!0,interimResults:!0,language:"en-US",maxAlternatives:2},onFinalResult:g=>{g.length>0&&g[0].transcript.trim()&&(i(g[0].transcript.trim()),je(`Voice input captured: ${g[0].transcript}`))},onVoiceActivity:g=>{},onError:g=>{console.error("Advanced speech error:",g),je("Voice input error occurred")}});m.useEffect(()=>{var g;(g=N.current)==null||g.scrollIntoView({behavior:"smooth"})},[e]),m.useEffect(()=>((async()=>{try{C.isConnected||(await C.connect(),je("Connected to real-time communication"));const b=`session-${Date.now()}`;await C.joinSession(b),je("Joined communication session")}catch(b){console.error("Failed to initialize SignalR:",b),je("Failed to connect to real-time communication")}})(),()=>{C.disconnect()}),[C]),m.useEffect(()=>{if(C.agentMessages.length>0){const g=C.agentMessages[C.agentMessages.length-1],b={id:`signalr-${Date.now()}`,content:g.content,role:"assistant",timestamp:new Date(g.timestamp)};t(S=>S.some(E=>E.content===b.content&&Math.abs(E.timestamp.getTime()-b.timestamp.getTime())<1e3)?S:[...S,b]),l(S=>({...S,name:g.agentName,id:g.agentName.toLowerCase().replace(/\s+/g,"-"),isTyping:!1})),O(g.content),je(`Message from ${g.agentName}: ${g.content}`)}},[C.agentMessages]),m.useEffect(()=>{if(C.handoffNotifications.length>0){const g=C.handoffNotifications[C.handoffNotifications.length-1];l(S=>({...S,name:g.toAgent,id:g.toAgent.toLowerCase().replace(/\s+/g,"-"),isTyping:!1}));const b={id:`handoff-${Date.now()}`,content:`Agent handoff: ${g.reason}. You are now speaking with ${g.toAgent}.`,role:"assistant",timestamp:new Date(g.timestamp)};t(S=>[...S,b]),je(`Agent handoff: You are now speaking with ${g.toAgent}`)}},[C.handoffNotifications]),m.useEffect(()=>{Object.keys(C.agentTyping).filter(b=>C.agentTyping[b]).length>0?l(b=>({...b,isTyping:!0})):l(b=>({...b,isTyping:!1}))},[C.agentTyping]),m.useEffect(()=>{t([{id:"1",content:"Hello! I'm your behavioral health assistant. I can help you with depression screenings, provide support, or just have a friendly conversation. What would you like to explore today?",role:"assistant",timestamp:new Date}])},[]);const J=async()=>{try{j.isListening?(j.stopListening(),je("Voice input stopped")):(await j.startListening(),je("Voice input started"))}catch(g){console.error("Error toggling speech:",g),je("Error with voice input")}},O=async g=>{if(d&&j.isAvailable)try{await j.speak(g,{rate:.9,pitch:1,volume:.8,voice:x,interrupt:!0})}catch(b){console.error("Error speaking message:",b)}},M=()=>{h(!d),d?(je("Audio output disabled"),j.isAvailable&&window.speechSynthesis&&window.speechSynthesis.cancel()):je("Audio output enabled")},Z=async()=>{if(!r.trim()||o)return;const g={id:Date.now().toString(),content:r.trim(),role:"user",timestamp:new Date};t(S=>[...S,g]);const b=r.trim();i(""),a(!0),l(S=>({...S,isTyping:!0}));try{if(C.isConnected){const S={content:b,timestamp:new Date().toISOString(),metadata:{speechConfidence:1,voiceActivityLevel:j.volume,processingTime:0}};await C.sendMessage(S),je("Message sent to agent")}else{await new Promise(_e=>setTimeout(_e,1e3+Math.random()*2e3));let S="I understand what you're saying. Let me help you with that.",k=c.id,E=c.name;const H=b.toLowerCase();H.includes("phq")||H.includes("depression")||H.includes("screening")?(S="I can help you with a depression screening. I'll start with the PHQ-2, which is a quick 2-question assessment. This will help determine if a more comprehensive evaluation might be helpful. Shall we begin?",k="phq2",E="PHQ-2 Agent"):H.includes("joke")||H.includes("funny")||H.includes("humor")?(S="Hey there!  I'm here to brighten your day with some wholesome humor! I can share clean jokes, funny stories, or just have some playful banter. What sounds good to you?",k="comedian",E="Comedy Agent"):(H.includes("crisis")||H.includes("emergency")||H.includes("help"))&&(S="I'm here to help. If you're experiencing a mental health crisis, please reach out for immediate support: Call 988 (Suicide & Crisis Lifeline) or contact your local emergency services. I'm also here to provide support and connect you with appropriate resources.");const q={id:(Date.now()+1).toString(),content:S,role:"assistant",timestamp:new Date};t(_e=>[..._e,q]),k!==c.id&&(l({id:k,name:E,isActive:!0,isTyping:!1}),je(`Agent changed to ${E}`)),O(S)}}catch(S){console.error("Error sending message:",S);const k={id:(Date.now()+1).toString(),content:"I'm sorry, I encountered an error processing your message. Please try again.",role:"assistant",timestamp:new Date};t(E=>[...E,k]),je("Error sending message")}finally{a(!1),C.isConnected||l(S=>({...S,isTyping:!1}))}},G=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),Z())},w=()=>{t([]),l({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),je("Conversation cleared")};return s.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${c.isTyping?"bg-primary-500 animate-pulse":c.isActive?"bg-green-500":"bg-gray-400"}`,children:s.jsx("span",{className:"text-white text-lg",children:""})}),c.isActive&&s.jsx("div",{className:"absolute -inset-1 rounded-full bg-green-400 opacity-30 animate-ping"}),j.isListening&&s.jsx("div",{className:"absolute -bottom-1 -right-1",children:s.jsx(uy,{volume:j.volume,isVoiceActive:j.isVoiceActive,isListening:j.isListening,size:"sm"})})]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Agent Experience"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Current Agent: ",c.name,c.isTyping&&s.jsx("span",{className:"ml-2 text-primary-600 dark:text-primary-400",children:s.jsx("span",{className:"animate-pulse",children:"Typing..."})})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${C.isConnected?"bg-green-500":"bg-red-500"}`}),s.jsx("span",{className:`text-xs ${C.isConnected?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:C.isConnected?"Connected":"Offline"})]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>y(!0),onKeyDown:n(()=>y(!0)),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Open speech settings",title:"Speech settings",children:s.jsx(Ll,{size:20})}),s.jsx("button",{onClick:M,onKeyDown:n(M),className:`p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${d?"bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,"aria-label":`${d?"Disable":"Enable"} audio output`,title:`${d?"Disable":"Enable"} audio output`,children:d?s.jsx($r,{size:20}):s.jsx(of,{size:20})}),s.jsx("button",{onClick:w,onKeyDown:n(w),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Clear conversation",title:"Clear conversation",children:s.jsx(Rr,{size:20})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.map(g=>s.jsx("div",{className:`flex ${g.role==="user"?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${g.role==="user"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[s.jsx("p",{className:"text-sm",children:g.content}),s.jsx("p",{className:`text-xs mt-1 opacity-70 ${g.role==="user"?"text-primary-200":"text-gray-500 dark:text-gray-400"}`,children:g.timestamp.toLocaleTimeString()})]})},g.id)),c.isTyping&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"}),s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"})]})})}),s.jsx("div",{ref:N})]}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-end space-x-2",children:[j.isAvailable&&s.jsx("button",{onClick:J,onKeyDown:n(J),disabled:o,className:`p-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${j.isListening?"bg-red-600 text-white hover:bg-red-700":"bg-primary-600 text-white hover:bg-primary-700 disabled:bg-gray-400"}`,"aria-label":j.isListening?"Stop voice input":"Start voice input",title:j.isListening?"Stop voice input":"Start voice input",children:j.isListening?s.jsx(Dp,{size:20}):s.jsx(Dl,{size:20})}),s.jsx("div",{className:"flex-1",children:s.jsx("textarea",{ref:v,value:r,onChange:g=>i(g.target.value),onKeyPress:G,placeholder:"Type your message here or use voice input...",disabled:o,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-700 min-h-[44px] max-h-[120px]",rows:1,"aria-label":"Message input"})}),s.jsx("button",{onClick:Z,onKeyDown:n(Z),disabled:!r.trim()||o,className:"p-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Send message",title:"Send message",children:s.jsx(Gp,{size:20})})]}),s.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[j.isListening&&s.jsxs("span",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse"}),s.jsx("span",{children:"Listening..."})]}),j.isVoiceActive&&s.jsxs("span",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[s.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),s.jsx("span",{children:"Voice detected"})]}),j.isAvailable&&s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Voice input available"}),j.error&&s.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Speech error: ",j.error]}),C.error&&s.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Connection error: ",C.error]}),d&&s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Audio output enabled"}),C.sessionId&&s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Session: ",C.sessionId.slice(-8)]})]}),s.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"})]})]}),s.jsx(gy,{config:{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:2,audioTracks:!0,noiseReduction:!0,echoCancellation:!0},availableVoices:j.availableVoices,selectedVoice:x,onConfigUpdate:g=>j.updateConfig(g),onVoiceSelect:g=>U(g),isOpen:u,onClose:()=>y(!1)})]})},py=()=>{const{data:n,isLoading:e,error:t,refetch:r}=Kl(),{announce:i}=Nl();zt.useEffect(()=>{i("System Health page loaded","polite")},[i]);const o=d=>{if(!d)return"Just now";try{const h=new Date(d);return isNaN(h.getTime())?"Just now":h.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},a=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},c=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"";case"degraded":return"";case"unhealthy":return"";default:return""}},l=d=>{const h="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(d==null?void 0:d.toLowerCase()){case"healthy":return`${h} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${h} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${h} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${h} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),s.jsxs("button",{type:"button",onClick:()=>r(),disabled:e,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[s.jsx(Se,{className:`w-4 h-4 ${e?"animate-spin":""}`}),s.jsx("span",{children:"Refresh"})]})]}),e&&s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Se,{className:"w-6 h-6 text-blue-600 animate-spin"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),t&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(st,{className:"w-6 h-6 text-red-500 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:t.message||"Unable to retrieve system health status"}),s.jsx("button",{type:"button",onClick:()=>r(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),n&&!e&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),s.jsxs("div",{className:l(n.status),children:[s.jsx("span",{className:"mr-1",children:c(n.status)}),n.status]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:c(n.status)}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),s.jsx("div",{className:`font-medium ${a(n.status)}`,children:n.status})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:""}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),s.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:n.totalDuration?`${n.totalDuration}ms`:"N/A"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:""}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),s.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o(n.timestamp)})]})]})]}),n.checks&&Object.keys(n.checks).length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Hr,{className:"w-5 h-5 mr-2"}),"Service Details"]}),s.jsx("div",{className:"space-y-4",children:Object.entries(n.checks).map(([d,h])=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-lg",children:c(h.status)}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.replace(/-/g," ")}),h.description&&s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.description})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[h.duration&&s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[h.duration,"ms"]}),s.jsx("div",{className:l(h.status),children:h.status})]})]},d))})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Dn,{className:"w-5 h-5 mr-2"}),"System Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},fy=()=>s.jsxs("div",{className:"text-center py-16",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),s.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),yy=new ed({defaultOptions:{queries:{retry:(n,e)=>{if(e&&typeof e=="object"&&"code"in e){const t=e.code;if(t!=null&&t.startsWith("HTTP_4")&&t!=="HTTP_408")return!1}return n<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}});function xy(){return s.jsxs(td,{client:yy,children:[s.jsx(vd,{children:s.jsx(Dm,{children:s.jsx(zm,{children:s.jsx(nd,{children:s.jsx(Wm,{children:s.jsxs(id,{children:[s.jsx(yt,{path:"/",element:s.jsxs(At,{requireRoles:[he.ADMIN,he.CONTROL_PANEL],children:[s.jsx(Hm,{}),s.jsx(lf,{})]})}),s.jsx(yt,{path:"/upload",element:s.jsx(At,{requireRoles:[he.ADMIN],children:s.jsx(mf,{})})}),s.jsx(yt,{path:"/sessions",element:s.jsx(At,{requireRoles:[he.ADMIN],children:s.jsx(pf,{})})}),s.jsx(yt,{path:"/sessions/:sessionId",element:s.jsx(At,{requireRoles:[he.ADMIN],children:s.jsx(xf,{})})}),s.jsx(yt,{path:"/predictions",element:s.jsx(At,{requireRoles:[he.ADMIN],children:s.jsx(bf,{})})}),s.jsx(yt,{path:"/summary",element:s.jsx(At,{requireRoles:[he.ADMIN,he.CONTROL_PANEL],children:s.jsx(_f,{})})}),s.jsx(yt,{path:"/agent-experience",element:s.jsx(At,{requireRoles:[he.ADMIN,he.CONTROL_PANEL],children:s.jsx(my,{})})}),s.jsx(yt,{path:"/health",element:s.jsx(At,{requireRoles:[he.ADMIN],children:s.jsx(py,{})})}),s.jsx(yt,{path:"*",element:s.jsx(fy,{})})]})})})})})}),!1]})}const ga=localStorage.getItem("bh_theme"),by=window.matchMedia("(prefers-color-scheme: dark)").matches,wy=ga==="dark"||!ga&&by;wy?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");xn.createRoot(document.getElementById("root")).render(s.jsx(zt.StrictMode,{children:s.jsx(xy,{})}));
//# sourceMappingURL=index-400ee2a4.js.map
