var Xl=Object.defineProperty;var Zl=(n,e,t)=>e in n?Xl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Y=(n,e,t)=>(Zl(n,typeof e!="symbol"?e+"":e,t),t);import{j as s,u as oa,Q as ed,a as td}from"./query-7a13343f.js";import{a as rd,r as p,R as Bt,u as Ds,N as aa,b as Dn,L as Te,c as sd,B as nd,d as id,e as ft}from"./vendor-b4aac61f.js";import{F as od,t as eo,f as ad}from"./ffmpeg-c0c62554.js";import{B as cd,e as ld}from"./azure-e79d136e.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var mn={},to=rd;mn.createRoot=to.createRoot,mn.hydrateRoot=to.hydrateRoot;/*! @azure/msal-common v15.12.0 2025-08-19 */const I={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Tt={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Ut={GET:"GET",POST:"POST"},cr=[I.OPENID_SCOPE,I.PROFILE_SCOPE,I.OFFLINE_ACCESS_SCOPE],ro=[...cr,I.EMAIL_SCOPE],Ue={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},so={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Nt={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Wr={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Fe={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Ln={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},Ls={QUERY:"query",FRAGMENT:"fragment"},dd={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},ca={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Qr={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Nr={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},je={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Un="appmetadata",hd="client_info",us="1",gs={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Ve={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Ne={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},ne={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},vr={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},no={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Yt={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},rn={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Lt={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},ud={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},la=300;/*! @azure/msal-common v15.12.0 2025-08-19 */const ms="unexpected_error",gd="post_request_failed";/*! @azure/msal-common v15.12.0 2025-08-19 */const io={[ms]:"Unexpected error in authentication.",[gd]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class ae extends Error{constructor(e,t,r){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,ae.prototype),this.errorCode=e||I.EMPTY_STRING,this.errorMessage=t||I.EMPTY_STRING,this.subError=r||I.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function pn(n,e){return new ae(n,e?`${io[n]} ${e}`:io[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */const Hn="client_info_decoding_error",da="client_info_empty_error",Fn="token_parsing_error",ha="null_or_empty_token",bt="endpoints_resolution_error",ua="network_error",ga="openid_config_error",ma="hash_not_deserialized",ir="invalid_state",pa="state_mismatch",fn="state_not_found",fa="nonce_mismatch",$n="auth_time_not_found",ya="max_age_transpired",md="multiple_matching_tokens",pd="multiple_matching_accounts",xa="multiple_matching_appMetadata",ba="request_cannot_be_made",wa="cannot_remove_empty_scope",va="cannot_append_scopeset",yn="empty_input_scopeset",fd="device_code_polling_cancelled",yd="device_code_expired",xd="device_code_unknown_error",Bn="no_account_in_silent_request",ka="invalid_cache_record",Kn="invalid_cache_environment",xn="no_account_found",bn="no_crypto_object",bd="unexpected_credential_type",wd="invalid_assertion",vd="invalid_client_credential",Et="token_refresh_required",kd="user_timeout_reached",Ca="token_claims_cnf_required_for_signedjwt",Sa="authorization_code_missing_from_server_response",_a="binding_key_not_removed",Aa="end_session_endpoint_not_supported",zn="key_id_missing",Cd="no_network_connectivity",Sd="user_canceled",_d="missing_tenant_id_error",W="method_not_implemented",Ad="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.12.0 2025-08-19 */const oo={[Hn]:"The client info could not be parsed/decoded correctly",[da]:"The client info was empty",[Fn]:"Token cannot be parsed",[ha]:"The token is null or empty",[bt]:"Endpoints cannot be resolved",[ua]:"Network request failed",[ga]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[ma]:"The hash parameters could not be deserialized",[ir]:"State was not the expected format",[pa]:"State mismatch error",[fn]:"State not found",[fa]:"Nonce mismatch error",[$n]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[ya]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[md]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[pd]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[xa]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[ba]:"Token request cannot be made without authorization code or refresh token.",[wa]:"Cannot remove null or empty scope from ScopeSet",[va]:"Cannot append ScopeSet",[yn]:"Empty input ScopeSet cannot be processed",[fd]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[yd]:"Device code is expired.",[xd]:"Device code stopped polling for unknown reasons.",[Bn]:"Please pass an account object, silent flow is not supported without account information",[ka]:"Cache record object was null or undefined.",[Kn]:"Invalid environment when attempting to create cache entry",[xn]:"No account found in cache for given key.",[bn]:"No crypto object detected.",[bd]:"Unexpected credential type.",[wd]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[vd]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Et]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[kd]:"User defined timeout for device code polling reached",[Ca]:"Cannot generate a POP jwt if the token_claims are not populated",[Sa]:"Server response does not contain an authorization code to proceed",[_a]:"Could not remove the credential's binding key from storage.",[Aa]:"The provided authority does not support logout",[zn]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Cd]:"No network connectivity. Check your internet connection.",[Sd]:"User cancelled the flow.",[_d]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[W]:"This method has not been implemented",[Ad]:"The nested app auth bridge is disabled"};class Gn extends ae{constructor(e,t){super(e,t?`${oo[e]}: ${t}`:oo[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Gn.prototype)}}function R(n,e){return new Gn(n,e)}/*! @azure/msal-common v15.12.0 2025-08-19 */const ps={createNewGuid:()=>{throw R(W)},base64Decode:()=>{throw R(W)},base64Encode:()=>{throw R(W)},base64UrlEncode:()=>{throw R(W)},encodeKid:()=>{throw R(W)},async getPublicKeyThumbprint(){throw R(W)},async removeTokenBindingKey(){throw R(W)},async clearKeystore(){throw R(W)},async signJwt(){throw R(W)},async hashString(){throw R(W)}};/*! @azure/msal-common v15.12.0 2025-08-19 */var me;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(me||(me={}));class kt{constructor(e,t,r){this.level=me.Info;const i=()=>{},o=e||kt.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||i,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:me.Info,this.correlationId=o.correlationId||I.EMPTY_STRING,this.packageName=t||I.EMPTY_STRING,this.packageVersion=r||I.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:me.Info}}clone(e,t,r){return new kt({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const o=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${me[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:me.Error,containsPii:!1,correlationId:t||I.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:me.Error,containsPii:!0,correlationId:t||I.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:me.Warning,containsPii:!1,correlationId:t||I.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:me.Warning,containsPii:!0,correlationId:t||I.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:me.Info,containsPii:!1,correlationId:t||I.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:me.Info,containsPii:!0,correlationId:t||I.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:me.Verbose,containsPii:!1,correlationId:t||I.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:me.Verbose,containsPii:!0,correlationId:t||I.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:me.Trace,containsPii:!1,correlationId:t||I.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:me.Trace,containsPii:!0,correlationId:t||I.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ia="@azure/msal-common",qn="15.12.0";/*! @azure/msal-common v15.12.0 2025-08-19 */const Vn={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.12.0 2025-08-19 */const Ta="redirect_uri_empty",Id="claims_request_parsing_error",Na="authority_uri_insecure",br="url_parse_error",Ea="empty_url_error",Ra="empty_input_scopes_error",Wn="invalid_claims",ja="token_request_empty",Pa="logout_request_empty",Td="invalid_code_challenge_method",Qn="pkce_params_missing",Yn="invalid_cloud_discovery_metadata",Oa="invalid_authority_metadata",Ma="untrusted_authority",Us="missing_ssh_jwk",Da="missing_ssh_kid",Nd="missing_nonce_authentication_header",Ed="invalid_authentication_header",La="cannot_set_OIDCOptions",Ua="cannot_allow_platform_broker",Ha="authority_mismatch",Fa="invalid_request_method_for_EAR",$a="invalid_authorize_post_body_parameters";/*! @azure/msal-common v15.12.0 2025-08-19 */const Rd={[Ta]:"A redirect URI is required for all calls, and none has been set.",[Id]:"Could not parse the given claims request object.",[Na]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[br]:"URL could not be parsed into appropriate segments.",[Ea]:"URL was empty or null.",[Ra]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Wn]:"Given claims parameter must be a stringified JSON object.",[ja]:"Token request was empty and not found in cache.",[Pa]:"The logout request was null or undefined.",[Td]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Qn]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Yn]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Oa]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Ma]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Us]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Da]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[Nd]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Ed]:"Invalid authentication header provided",[La]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Ua]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[Ha]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[$a]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[Fa]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};class Jn extends ae{constructor(e){super(e,Rd[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Jn.prototype)}}function ue(n){return new Jn(n)}/*! @azure/msal-common v15.12.0 2025-08-19 */class Qe{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),i=o=>decodeURIComponent(o.replace(/\+/g," "));return r.forEach(o=>{if(o.trim()){const[a,c]=o.split(/=(.+)/g,2);a&&c&&(t[i(a)]=i(c))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Ce{constructor(e){const t=e?Qe.trimArrayEntries([...e]):[],r=t?Qe.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw ue(Ra);this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){const r=(e||I.EMPTY_STRING).split(" ");return new Ce(r)}static createSearchScopes(e){const t=e&&e.length>0?e:[...cr],r=new Ce(t);return r.containsOnlyOIDCScopes()?r.removeScope(I.OFFLINE_ACCESS_SCOPE):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new Ce(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return ro.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw R(va)}}removeScope(e){if(!e)throw R(wa);this.scopes.delete(e.trim())}removeOIDCScopes(){ro.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw R(yn);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw R(yn);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):I.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.12.0 2025-08-19 */function ao(n,e){return!!n&&!!e&&n===e.split(".")[1]}function Xn(n,e,t,r){if(r){const{oid:i,sub:o,tid:a,name:c,tfp:l,acr:d,preferred_username:h,upn:u,login_hint:g}=r,A=a||l||d||"";return{tenantId:A,localAccountId:i||o||"",name:c,username:h||u||"",loginHint:g,isHomeTenant:ao(A,n)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:ao(t,n)}}function Zn(n,e,t,r){let i=n;if(e){const{isHomeTenant:o,...a}=e;i={...n,...a}}if(t){const{isHomeTenant:o,...a}=Xn(n.homeAccountId,n.localAccountId,n.tenantId,t);return i={...i,...a,idTokenClaims:t,idToken:r},i}return i}/*! @azure/msal-common v15.12.0 2025-08-19 */function lr(n,e){const t=jd(n);try{const r=e(t);return JSON.parse(r)}catch{throw R(Fn)}}function jd(n){if(!n)throw R(ha);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw R(Fn);return t[2]}function Ba(n,e){if(e===0||Date.now()-3e5>n+e)throw R(ya)}/*! @azure/msal-common v15.12.0 2025-08-19 */function co(n){if(!n)return n;let e=n.toLowerCase();return Qe.endsWith(e,"?")?e=e.slice(0,-1):Qe.endsWith(e,"?/")&&(e=e.slice(0,-2)),Qe.endsWith(e,"/")||(e+="/"),e}function Ka(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function fs(n){if(!n||n.indexOf("=")<0)return null;try{const e=Ka(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw R(ma)}return null}function Er(n,e=!0,t){const r=new Array;return n.forEach((i,o)=>{!e&&t&&o in t?r.push(`${o}=${i}`):r.push(`${o}=${encodeURIComponent(i)}`)}),r.join("&")}function lo(n){if(!n)return n;const e=n.split("#")[0];try{const t=new URL(e),r=t.origin+t.pathname+t.search;return co(r)}catch{return co(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class ee{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw ue(Ea);e.includes("#")||(this._urlString=ee.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Qe.endsWith(t,"?")?t=t.slice(0,-1):Qe.endsWith(t,"?/")&&(t=t.slice(0,-2)),Qe.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw ue(br)}if(!e.HostNameAndPort||!e.PathSegments)throw ue(br);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw ue(Na)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return ee.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Nt.COMMON||r[0]===Nt.ORGANIZATIONS)&&(r[0]=e),ee.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ue(br);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=r.AbsolutePath.split("/");return i=i.filter(o=>o&&o.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw ue(br);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===I.FORWARD_SLASH){const i=new ee(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new ee(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!fs(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const za={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},ho=za.endpointMetadata,ei=za.instanceDiscoveryMetadata,Ga=new Set;ei.metadata.forEach(n=>{n.aliases.forEach(e=>{Ga.add(e)})});function Pd(n,e){var i;let t;const r=n.canonicalAuthority;if(r){const o=new ee(r).getUrlComponents().HostNameAndPort;t=uo(o,(i=n.cloudDiscoveryMetadata)==null?void 0:i.metadata,Ve.CONFIG,e)||uo(o,ei.metadata,Ve.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function uo(n,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=ys(e,n);if(i)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function Od(n){return ys(ei.metadata,n)}function ys(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v15.12.0 2025-08-19 */const xs="cache_quota_exceeded",ti="cache_error_unknown";/*! @azure/msal-common v15.12.0 2025-08-19 */const sn={[xs]:"Exceeded cache storage capacity.",[ti]:"Unexpected error occurred when using cache storage."};class er extends ae{constructor(e,t){const r=t||(sn[e]?sn[e]:sn[ti]);super(`${e}: ${r}`),Object.setPrototypeOf(this,er.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function wn(n){return n instanceof Error?n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"||n.message.includes("exceeded the quota")?new er(xs):new er(n.name,n.message):new er(ti)}/*! @azure/msal-common v15.12.0 2025-08-19 */class vn{constructor(e,t,r,i,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Ia,qn),this.staticAuthorityOptions=o,this.performanceClient=i}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(Object.keys(e).length===0||Object.values(e).every(i=>!i))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const r=this.getAllAccounts(e,t);return r.length>1?r.sort(o=>o.idTokenClaims?-1:1)[0]:r.length===1?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?r[0].getAccountInfo():null}buildTenantProfiles(e,t,r){return e.flatMap(i=>this.getTenantProfilesFromAccountEntity(i,t,r==null?void 0:r.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,i,o){let a=null,c;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;const l=this.getIdToken(e,i,t,r.tenantId);return l&&(c=lr(l.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(c,o))?null:(a=Zn(e,r,c,l==null?void 0:l.secret),a)}getTenantProfilesFromAccountEntity(e,t,r,i){const o=e.getAccountInfo();let a=o.tenantProfiles||new Map;const c=this.getTokenKeys();if(r){const d=a.get(r);if(d)a=new Map([[r,d]]);else return[]}const l=[];return a.forEach(d=>{const h=this.getTenantedAccountInfoByFilter(o,c,d,t,i);h&&l.push(h)}),l}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,r){var i;if(!e)throw R(ka);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(r==null?void 0:r.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(r==null?void 0:r.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(r==null?void 0:r.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(o){throw(i=this.commonLogger)==null||i.error("CacheManager.saveCacheRecord: failed"),o instanceof ae?o:wn(o)}}async saveAccessToken(e,t){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},i=this.getTokenKeys(),o=Ce.fromString(e.target);i.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,r,!1))return;const c=this.getAccessTokenCredential(a,t);c&&this.credentialMatchesFilter(c,r)&&Ce.fromString(c.target).intersectingScopeSets(o)&&this.removeAccessToken(a,t)}),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),i=[];return r.forEach(o=>{var d;const a=this.getAccount(o,t);if(!a||e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId)||e.username&&!this.matchUsername(a.username,e.username)||e.environment&&!this.matchEnvironment(a,e.environment)||e.realm&&!this.matchRealm(a,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const c={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},l=(d=a.tenantProfiles)==null?void 0:d.filter(h=>this.tenantProfileMatchesFilter(h,c));l&&l.length===0||i.push(a)}),i}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===je.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===ne.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const o=this.getAppMetadata(i);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(r[i]=o))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const o=this.getAuthorityMetadata(i);o&&o.aliases.indexOf(e)!==-1&&(r=o)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(r=>{this.removeAccount(r,e)})}removeAccount(e,t){this.removeAccountContext(e,t);const r=this.getAccountKeys(),i=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);r.filter(i).forEach(o=>{this.removeItem(o,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const r=this.getTokenKeys(),i=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);r.idToken.filter(i).forEach(o=>{this.removeIdToken(o,t)}),r.accessToken.filter(i).forEach(o=>{this.removeAccessToken(o,t)}),r.refreshToken.filter(i).forEach(o=>{this.removeRefreshToken(o,t)})}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!r||r.credentialType.toLowerCase()!==je.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||r.tokenType!==ne.POP)return;const i=r.keyId;i&&this.cryptoImpl.removeTokenBindingKey(i).catch(()=>{var o;this.commonLogger.error(`Failed to remove token binding key ${i}`,t),(o=this.performanceClient)==null||o.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(r=>{this.isAppMetadata(r)&&this.removeItem(r,e)}),!0}getIdToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getIdToken called");const a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:je.ID_TOKEN,clientId:this.clientId,realm:i},c=this.getIdTokensByFilter(a,t,r),l=c.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let d=c;if(!i){const h=new Map;c.forEach((g,A)=>{g.realm===e.tenantId&&h.set(A,g)});const u=h.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),c.values().next().value;if(u===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;d=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),d.forEach((h,u)=>{this.removeIdToken(u,t)}),o&&t&&o.addFields({multiMatchedID:c.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),c.values().next().value}getIdTokensByFilter(e,t,r){const i=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return i.forEach(a=>{if(!this.idTokenKeyMatchesFilter(a,{clientId:this.clientId,...e}))return;const c=this.getIdTokenCredential(a,t);c&&this.credentialMatchesFilter(c,e)&&o.set(a,c)}),o}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,i){const o=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",o);const a=Ce.createSearchScopes(t.scopes),c=t.authenticationScheme||ne.BEARER,l=c&&c.toLowerCase()!==ne.BEARER.toLowerCase()?je.ACCESS_TOKEN_WITH_AUTH_SCHEME:je.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(A=>{if(this.accessTokenKeyMatchesFilter(A,d,!0)){const E=this.getAccessTokenCredential(A,o);E&&this.credentialMatchesFilter(E,d)&&u.push(E)}});const g=u.length;return g<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",o),null):g>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",o),u.forEach(A=>{this.removeAccessToken(this.generateCredentialKey(A),o)}),this.performanceClient.addFields({multiMatchedAT:u.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",o),u[0])}accessTokenKeyMatchesFilter(e,t,r){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const o=t.target.asArray();for(let a=0;a<o.length;a++){if(r&&!i.includes(o[a].toLowerCase()))return!1;if(!r&&i.includes(o[a].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),i=[];return r.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;const a=this.getAccessTokenCredential(o,t);a&&this.credentialMatchesFilter(a,e)&&i.push(a)}),i}getRefreshToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const a=t?us:void 0,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:je.REFRESH_TOKEN,clientId:this.clientId,familyId:a},l=i&&i.refreshToken||this.getTokenKeys().refreshToken,d=[];l.forEach(u=>{if(this.refreshTokenKeyMatchesFilter(u,c)){const g=this.getRefreshTokenCredential(u,r);g&&this.credentialMatchesFilter(g,c)&&d.push(g)}});const h=d.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&o&&r&&o.addFields({multiMatchedRT:h},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),d[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),i=Object.keys(r).map(a=>r[a]),o=i.length;if(o<1)return null;if(o>1)throw R(xa);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===us)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=Pd(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==je.ACCESS_TOKEN&&e.credentialType!==je.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:Ce.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Un)!==-1}isAuthorityMetadata(e){return e.indexOf(gs.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${gs.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Md extends vn{async setAccount(){throw R(W)}getAccount(){throw R(W)}async setIdTokenCredential(){throw R(W)}getIdTokenCredential(){throw R(W)}async setAccessTokenCredential(){throw R(W)}getAccessTokenCredential(){throw R(W)}async setRefreshTokenCredential(){throw R(W)}getRefreshTokenCredential(){throw R(W)}setAppMetadata(){throw R(W)}getAppMetadata(){throw R(W)}setServerTelemetry(){throw R(W)}getServerTelemetry(){throw R(W)}setAuthorityMetadata(){throw R(W)}getAuthorityMetadata(){throw R(W)}getAuthorityMetadataKeys(){throw R(W)}setThrottlingCache(){throw R(W)}getThrottlingCache(){throw R(W)}removeItem(){throw R(W)}getKeys(){throw R(W)}getAccountKeys(){throw R(W)}getTokenKeys(){throw R(W)}generateCredentialKey(){throw R(W)}generateAccountKey(){throw R(W)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const ze={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};/*! @azure/msal-common v15.12.0 2025-08-19 */const m={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},Dd={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.12.0 2025-08-19 */class go{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class qa{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Dd.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new go}}startPerformanceMeasurement(){return new go}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Va={tokenRenewalOffsetSeconds:la,preventCorsPreflight:!1},Ld={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:me.Info,correlationId:I.EMPTY_STRING},Ud={claimsBasedCachingEnabled:!1},Hd={async sendGetRequestAsync(){throw R(W)},async sendPostRequestAsync(){throw R(W)}},Fd={sku:I.SKU,version:qn,cpu:I.EMPTY_STRING,os:I.EMPTY_STRING},$d={clientSecret:I.EMPTY_STRING,clientAssertion:void 0},Bd={azureCloudInstance:Vn.None,tenant:`${I.DEFAULT_COMMON_TENANT}`},Kd={application:{appName:"",appVersion:""}};function zd({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:o,cryptoInterface:a,clientCredentials:c,libraryInfo:l,telemetry:d,serverTelemetryManager:h,persistencePlugin:u,serializableCache:g}){const A={...Ld,...t};return{authOptions:Gd(n),systemOptions:{...Va,...e},loggerOptions:A,cacheOptions:{...Ud,...r},storageInterface:i||new Md(n.clientId,ps,new kt(A),new qa),networkInterface:o||Hd,cryptoInterface:a||ps,clientCredentials:c||$d,libraryInfo:{...Fd,...l},telemetry:{...Kd,...d},serverTelemetryManager:h||null,persistencePlugin:u||null,serializableCache:g||null}}function Gd(n){return{clientCapabilities:[],azureCloudOptions:Bd,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...n}}function Wa(n){return n.authOptions.authority.options.protocolMode===ze.OIDC}/*! @azure/msal-common v15.12.0 2025-08-19 */const ot={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.12.0 2025-08-19 */function bs(n,e){if(!n)throw R(da);try{const t=e(n);return JSON.parse(t)}catch{throw R(Hn)}}function tr(n){if(!n)throw R(Hn);const e=n.split(Nr.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?I.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Kt="client_id",Qa="redirect_uri",qd="response_type",Vd="response_mode",Wd="grant_type",Qd="claims",Yd="scope",Jd="refresh_token",Xd="state",Zd="nonce",eh="prompt",th="code",rh="code_challenge",sh="code_challenge_method",nh="code_verifier",ih="client-request-id",oh="x-client-SKU",ah="x-client-VER",ch="x-client-OS",lh="x-client-CPU",dh="x-client-current-telemetry",hh="x-client-last-telemetry",uh="x-ms-lib-capability",gh="x-app-name",mh="x-app-ver",ph="post_logout_redirect_uri",fh="id_token_hint",yh="client_secret",xh="client_assertion",bh="client_assertion_type",Ya="token_type",Ja="req_cnf",mo="return_spa_code",wh="nativebroker",vh="logout_hint",kh="sid",Ch="login_hint",Sh="domain_hint",_h="x-client-xtra-sku",ws="brk_client_id",vs="brk_redirect_uri",kn="instance_aware",Ah="ear_jwk",Ih="ear_jwe_crypto";/*! @azure/msal-common v15.12.0 2025-08-19 */function Hs(n,e,t){if(!e)return;const r=n.get(Kt);r&&n.has(ws)&&(t==null||t.addFields({embeddedClientId:r,embeddedRedirectUri:n.get(Qa)},e))}function ri(n,e){n.set(qd,e)}function Th(n,e){n.set(Vd,e||dd.QUERY)}function Nh(n){n.set(wh,"1")}function si(n,e,t=!0,r=cr){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const i=t?[...e||[],...r]:e||[],o=new Ce(i);n.set(Yd,o.printScopes())}function ni(n,e){n.set(Kt,e)}function ii(n,e){n.set(Qa,e)}function Eh(n,e){n.set(ph,e)}function Rh(n,e){n.set(fh,e)}function jh(n,e){n.set(Sh,e)}function Yr(n,e){n.set(Ch,e)}function ks(n,e){n.set(Ue.CCS_HEADER,`UPN:${e}`)}function kr(n,e){n.set(Ue.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function po(n,e){n.set(kh,e)}function oi(n,e,t){const r=Uh(e,t);try{JSON.parse(r)}catch{throw ue(Wn)}n.set(Qd,r)}function ai(n,e){n.set(ih,e)}function ci(n,e){n.set(oh,e.sku),n.set(ah,e.version),e.os&&n.set(ch,e.os),e.cpu&&n.set(lh,e.cpu)}function li(n,e){e!=null&&e.appName&&n.set(gh,e.appName),e!=null&&e.appVersion&&n.set(mh,e.appVersion)}function Ph(n,e){n.set(eh,e)}function Xa(n,e){e&&n.set(Xd,e)}function Oh(n,e){n.set(Zd,e)}function Za(n,e,t){if(e&&t)n.set(rh,e),n.set(sh,t);else throw ue(Qn)}function Mh(n,e){n.set(th,e)}function Dh(n,e){n.set(Jd,e)}function Lh(n,e){n.set(nh,e)}function ec(n,e){n.set(yh,e)}function tc(n,e){e&&n.set(xh,e)}function rc(n,e){e&&n.set(bh,e)}function sc(n,e){n.set(Wd,e)}function di(n){n.set(hd,"1")}function nc(n){n.has(kn)||n.set(kn,"true")}function Rt(n,e){Object.entries(e).forEach(([t,r])=>{!n.has(t)&&r&&n.set(t,r)})}function Uh(n,e){let t;if(!n)t={};else try{t=JSON.parse(n)}catch{throw ue(Wn)}return e&&e.length>0&&(t.hasOwnProperty(Wr.ACCESS_TOKEN)||(t[Wr.ACCESS_TOKEN]={}),t[Wr.ACCESS_TOKEN][Wr.XMS_CC]={values:e}),JSON.stringify(t)}function hi(n,e){e&&(n.set(Ya,ne.POP),n.set(Ja,e))}function ic(n,e){e&&(n.set(Ya,ne.SSH),n.set(Ja,e))}function oc(n,e){n.set(dh,e.generateCurrentRequestHeaderValue()),n.set(hh,e.generateLastRequestHeaderValue())}function ac(n){n.set(uh,vr.X_MS_LIB_CAPABILITY_VALUE)}function Hh(n,e){n.set(vh,e)}function Fs(n,e,t){n.has(ws)||n.set(ws,e),n.has(vs)||n.set(vs,t)}function Fh(n,e){n.set(Ah,encodeURIComponent(e));const t="eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0";n.set(Ih,t)}function $h(n,e){Object.entries(e).forEach(([t,r])=>{r&&n.set(t,r)})}/*! @azure/msal-common v15.12.0 2025-08-19 */const it={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.12.0 2025-08-19 */function Bh(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.12.0 2025-08-19 */function Kh(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v15.12.0 2025-08-19 */function zh(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ye=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const a=r==null?void 0:r.startMeasurement(e,i);if(i){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},i)}try{const c=n(...o);return a==null||a.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(c){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},c),c}},_=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const a=r==null?void 0:r.startMeasurement(e,i);if(i){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},i)}return r==null||r.setPreQueueTime(e,i),n(...o).then(c=>(t.trace(`Returning result from ${e}`),a==null||a.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},c),c})};/*! @azure/msal-common v15.12.0 2025-08-19 */class $s{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(m.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=Yt.ENVIRONMENT_VARIABLE;else{const o=$s.IMDS_OPTIONS;try{const a=await _(this.getRegionFromIMDS.bind(this),m.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(I.IMDS_VERSION,o);if(a.status===Tt.SUCCESS&&(r=a.body,t.region_source=Yt.IMDS),a.status===Tt.BAD_REQUEST){const c=await _(this.getCurrentVersion.bind(this),m.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(o);if(!c)return t.region_source=Yt.FAILED_AUTO_DETECTION,null;const l=await _(this.getRegionFromIMDS.bind(this),m.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(c,o);l.status===Tt.SUCCESS&&(r=l.body,t.region_source=Yt.IMDS)}}catch{return t.region_source=Yt.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=Yt.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(m.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${I.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,I.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(m.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${I.IMDS_ENDPOINT}?format=json`,e);return r.status===Tt.BAD_REQUEST&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}$s.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.12.0 2025-08-19 */function Ge(){return Math.round(new Date().getTime()/1e3)}function fo(n){return n.getTime()/1e3}function rr(n){return n?new Date(Number(n)*1e3):new Date}function Cs(n,e){const t=Number(n)||0;return Ge()+e>t}function Gh(n,e){const t=Number(n)+e*24*60*60*1e3;return Date.now()>t}function qh(n){return Number(n)>Ge()}/*! @azure/msal-common v15.12.0 2025-08-19 */function Bs(n,e,t,r,i){return{credentialType:je.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i,lastUpdatedAt:Date.now().toString()}}function Ks(n,e,t,r,i,o,a,c,l,d,h,u,g,A,E){var k,P;const T={homeAccountId:n,credentialType:je.ACCESS_TOKEN,secret:t,cachedAt:Ge().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:e,clientId:r,realm:i,target:o,tokenType:h||ne.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(T.userAssertionHash=u),d&&(T.refreshOn=d.toString()),A&&(T.requestedClaims=A,T.requestedClaimsHash=E),((k=T.tokenType)==null?void 0:k.toLowerCase())!==ne.BEARER.toLowerCase())switch(T.credentialType=je.ACCESS_TOKEN_WITH_AUTH_SCHEME,T.tokenType){case ne.POP:const j=lr(t,l);if(!((P=j==null?void 0:j.cnf)!=null&&P.kid))throw R(Ca);T.keyId=j.cnf.kid;break;case ne.SSH:T.keyId=g}return T}function cc(n,e,t,r,i,o,a){const c={credentialType:je.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,lastUpdatedAt:Date.now().toString()};return o&&(c.userAssertionHash=o),i&&(c.familyId=i),a&&(c.expiresOn=a.toString()),c}function ui(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function yo(n){return n?ui(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===je.ACCESS_TOKEN||n.credentialType===je.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function Vh(n){return n?ui(n)&&n.hasOwnProperty("realm")&&n.credentialType===je.ID_TOKEN:!1}function xo(n){return n?ui(n)&&n.credentialType===je.REFRESH_TOKEN:!1}function Wh(n,e){const t=n.indexOf(Ne.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function Qh(n,e){let t=!1;n&&(t=n.indexOf(vr.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function Yh({environment:n,clientId:e}){return[Un,n,e].join(Nr.CACHE_KEY_SEPARATOR).toLowerCase()}function Jh(n,e){return e?n.indexOf(Un)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function Xh(n,e){return e?n.indexOf(gs.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function bo(){return Ge()+gs.REFRESH_TIME_SECONDS}function Jr(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function nn(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function wo(n){return n.expiresAt<=Ge()}/*! @azure/msal-common v15.12.0 2025-08-19 */class Me{constructor(e,t,r,i,o,a,c,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=c,this.correlationId=a,this.managedIdentity=l||!1,this.regionDiscovery=new $s(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(I.CIAM_AUTH_URL))return it.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case I.ADFS:return it.Adfs;case I.DSTS:return it.Dsts}return it.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new ee(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw R(bt)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw R(bt)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw R(bt)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw R(Aa);return this.replacePath(this.metadata.end_session_endpoint)}else throw R(bt)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw R(bt)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw R(bt)}canReplaceTenant(e){return e.PathSegments.length===1&&!Me.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===it.Default&&this.protocolMode!==ze.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new ee(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((c,l)=>{let d=o[l];if(l===0&&this.canReplaceTenant(i)){const h=new ee(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];d!==h&&(this.logger.verbose(`Replacing tenant domain name ${d} with id ${h}`),d=h)}c!==d&&(t=t.replace(`/${d}/`,`/${c}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===it.Adfs||this.protocolMode===ze.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,o;(i=this.performanceClient)==null||i.addQueueMeasurement(m.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await _(this.updateCloudDiscoveryMetadata.bind(this),m.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await _(this.updateEndpointMetadata.bind(this),m.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(o=this.performanceClient)==null||o.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:bo(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==Ve.CACHE&&(r==null?void 0:r.source)!==Ve.CACHE&&(e.expiresAt=bo(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,o,a;(i=this.performanceClient)==null||i.addQueueMeasurement(m.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Ve.HARDCODED_VALUES&&(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&t.metadata){const c=await _(this.updateMetadataWithRegionalInformation.bind(this),m.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Jr(e,c,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await _(this.getEndpointMetadataFromNetwork.bind(this),m.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(a=this.authorityOptions.azureRegionConfiguration)!=null&&a.azureRegion&&(r=await _(this.updateMetadataWithRegionalInformation.bind(this),m.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),Jr(e,r,!0),Ve.NETWORK;throw R(ga,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Jr(e,t,!1),{source:Ve.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return Jr(e,i,!1),{source:Ve.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=wo(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Ve.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new ee(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw ue(Oa)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(m.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return Bh(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in ho?ho[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,i,o;(r=this.performanceClient)==null||r.addQueueMeasurement(m.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==I.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=rn.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Me.replaceWithRegionalInformation(e,t);const a=await _(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),m.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((o=this.authorityOptions.azureRegionConfiguration)==null?void 0:o.environmentRegion,this.regionDiscoveryMetadata);if(a)return this.regionDiscoveryMetadata.region_outcome=rn.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=a,Me.replaceWithRegionalInformation(e,a);this.regionDiscoveryMetadata.region_outcome=rn.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(m.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await _(this.getCloudDiscoveryMetadataFromNetwork.bind(this),m.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return nn(e,r,!0),Ve.NETWORK;throw ue(Ma)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||I.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||I.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||I.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),nn(e,t,!1),Ve.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=Od(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),nn(e,i,!1),Ve.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=wo(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),Ve.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===it.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=ys(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),ue(Yn)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(m.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${I.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const o=await this.networkInterface.sendGetRequestAsync(e,t);let a,c;if(Kh(o.body))a=o.body,c=a.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else if(zh(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),a=o.body,a.error===I.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),c=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=ys(c,this.hostnameAndPort)}catch(o){if(o instanceof ae)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{const a=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${a.name}
Error Description: ${a.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=Me.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&ee.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Vn.None){const i=t.tenant?t.tenant:I.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${i}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return I.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw R(bt)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Ga.has(e)}static isPublicCloudAuthority(e){return I.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const i=new ee(e);i.validateAsUri();const o=i.getUrlComponents();let a=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(a=`${t}.${I.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const c=ee.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:a}).urlString;return r?`${c}?${r}`:c}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Me.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Me.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Me.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const i=new ee(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(I.CIAM_AUTH_URL)){const o=i.HostNameAndPort.split(".")[0];t=`${t}${o}${I.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Me.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Nt.COMMON,Nt.CONSUMERS,Nt.ORGANIZATIONS]);function Zh(n){var i;const r=(i=new ee(n).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(r){case Nt.COMMON:case Nt.ORGANIZATIONS:case Nt.CONSUMERS:return;default:return r}}function lc(n){return n.endsWith(I.FORWARD_SLASH)?n:`${n}${I.FORWARD_SLASH}`}function eu(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw ue(Yn)}return{canonicalAuthority:n.authority?lc(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.12.0 2025-08-19 */async function dc(n,e,t,r,i,o,a){a==null||a.addQueueMeasurement(m.AuthorityFactoryCreateDiscoveredInstance,o);const c=Me.transformCIAMAuthority(lc(n)),l=new Me(c,e,t,r,i,o,a);try{return await _(l.resolveEndpointsAsync.bind(l),m.AuthorityResolveEndpointsAsync,i,a,o)(),l}catch{throw R(bt)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Wt extends ae{constructor(e,t,r,i,o){super(e,t,r),this.name="ServerError",this.errorNo=i,this.status=o,Object.setPrototypeOf(this,Wt.prototype)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function zs(n,e,t){var r;return{clientId:n,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||((r=e.tokenBodyParameters)==null?void 0:r.clientId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class gt{static generateThrottlingStorageKey(e){return`${vr.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,r){var a;const i=gt.generateThrottlingStorageKey(t),o=e.getThrottlingCache(i);if(o){if(o.throttleTime<Date.now()){e.removeItem(i,r);return}throw new Wt(((a=o.errorCodes)==null?void 0:a.join(" "))||I.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,r,i){if(gt.checkResponseStatus(r)||gt.checkResponseForRetryAfter(r)){const o={throttleTime:gt.calculateThrottleTime(parseInt(r.headers[Ue.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(gt.generateThrottlingStorageKey(t),o,i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Ue.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||vr.DEFAULT_THROTTLE_TIME_SECONDS),r+vr.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,i){const o=zs(t,r,i),a=this.generateThrottlingStorageKey(o);e.removeItem(a,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Gs extends ae{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Gs.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function wr(n,e,t,r){return n.errorMessage=`${n.errorMessage}, additionalErrorInfo: error.name:${r==null?void 0:r.name}, error.message:${r==null?void 0:r.message}`,new Gs(n,e,t)}/*! @azure/msal-common v15.12.0 2025-08-19 */class gi{constructor(e,t){this.config=zd(e),this.logger=new kt(this.config.loggerOptions,Ia,qn),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Ue.CONTENT_TYPE]=I.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case ot.HOME_ACCOUNT_ID:try{const r=tr(e.credential);t[Ue.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case ot.UPN:t[Ue.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,i,o,a){var l;a&&((l=this.performanceClient)==null||l.addQueueMeasurement(a,o));const c=await this.sendPostRequest(i,e,{body:t,headers:r},o);return this.config.serverTelemetryManager&&c.status<500&&c.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),c}async sendPostRequest(e,t,r,i){var a,c,l;gt.preProcess(this.cacheManager,e,i);let o;try{o=await _(this.networkClient.sendPostRequestAsync.bind(this.networkClient),m.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,i)(t,r);const d=o.headers||{};(c=this.performanceClient)==null||c.addFields({refreshTokenSize:((a=o.body.refresh_token)==null?void 0:a.length)||0,httpVerToken:d[Ue.X_MS_HTTP_VERSION]||"",requestId:d[Ue.X_MS_REQUEST_ID]||""},i)}catch(d){if(d instanceof Gs){const h=d.responseHeaders;throw h&&((l=this.performanceClient)==null||l.addFields({httpVerToken:h[Ue.X_MS_HTTP_VERSION]||"",requestId:h[Ue.X_MS_REQUEST_ID]||"",contentTypeHeader:h[Ue.CONTENT_TYPE]||void 0,contentLengthHeader:h[Ue.CONTENT_LENGTH]||void 0,httpStatus:d.httpStatus},i)),d.error}throw d instanceof ae?d:R(ua)}return gt.postProcess(this.cacheManager,e,o,i),o}async updateAuthority(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(m.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,i=await dc(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&Fs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&Rt(t,e.tokenQueryParameters),ai(t,e.correlationId),Hs(t,e.correlationId,this.performanceClient),Er(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function hc(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */class rt{getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,loginHint:this.loginHint,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,r){var d,h,u,g,A,E,T;const i=new rt;t.authorityType===it.Adfs?i.authorityType=Qr.ADFS_ACCOUNT_TYPE:t.protocolMode===ze.OIDC?i.authorityType=Qr.GENERIC_ACCOUNT_TYPE:i.authorityType=Qr.MSSTS_ACCOUNT_TYPE;let o;e.clientInfo&&r&&(o=bs(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const a=e.environment||t&&t.getPreferredCache();if(!a)throw R(Kn);i.environment=a,i.realm=(o==null?void 0:o.utid)||hc(e.idTokenClaims)||"",i.localAccountId=(o==null?void 0:o.uid)||((d=e.idTokenClaims)==null?void 0:d.oid)||((h=e.idTokenClaims)==null?void 0:h.sub)||"";const c=((u=e.idTokenClaims)==null?void 0:u.preferred_username)||((g=e.idTokenClaims)==null?void 0:g.upn),l=(A=e.idTokenClaims)!=null&&A.emails?e.idTokenClaims.emails[0]:null;if(i.username=c||l||"",i.loginHint=(E=e.idTokenClaims)==null?void 0:E.login_hint,i.name=((T=e.idTokenClaims)==null?void 0:T.name)||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const k=Xn(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[k]}return i}static createFromAccountInfo(e,t,r){var o;const i=new rt;return i.authorityType=e.authorityType||Qr.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.loginHint=e.loginHint,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(((o=e.tenantProfiles)==null?void 0:o.values())||[]),i}static generateHomeAccountId(e,t,r,i,o){if(!(t===it.Adfs||t===it.Dsts)){if(e)try{const a=bs(e,i.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}r.warning("No client info in response")}return(o==null?void 0:o.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let i=!0;if(r){const o=e.idTokenClaims||{},a=t.idTokenClaims||{};i=o.iat===a.iat&&o.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ss="no_tokens_found",uc="native_account_unavailable",mi="refresh_token_expired",pi="ux_not_allowed",tu="interaction_required",ru="consent_required",su="login_required",qs="bad_token";/*! @azure/msal-common v15.12.0 2025-08-19 */const vo=[tu,ru,su,qs,pi],nu=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],iu={[Ss]:"No refresh token found in the cache. Please sign-in.",[uc]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[mi]:"Refresh token has expired.",[qs]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[pi]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};class lt extends ae{constructor(e,t,r,i,o,a,c,l){super(e,t,r),Object.setPrototypeOf(this,lt.prototype),this.timestamp=i||I.EMPTY_STRING,this.traceId=o||I.EMPTY_STRING,this.correlationId=a||I.EMPTY_STRING,this.claims=c||I.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function gc(n,e,t){const r=!!n&&vo.indexOf(n)>-1,i=!!t&&nu.indexOf(t)>-1,o=!!e&&vo.some(a=>e.indexOf(a)>-1);return r||o||i}function _s(n){return new lt(n,iu[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */class dr{static setRequestState(e,t,r){const i=dr.generateLibraryState(e,r);return t?`${i}${I.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw R(bn);const r={id:e.createNewGuid()};t&&(r.meta=t);const i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw R(bn);if(!t)throw R(ir);try{const r=t.split(I.RESOURCE_DELIM),i=r[0],o=r.length>1?r.slice(1).join(I.RESOURCE_DELIM):I.EMPTY_STRING,a=e.base64Decode(i),c=JSON.parse(a);return{userRequestState:o||I.EMPTY_STRING,libraryState:c}}catch{throw R(ir)}}}/*! @azure/msal-common v15.12.0 2025-08-19 */const ou={SW:"sw"};class or{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(m.PopTokenGenerateCnf,e.correlationId);const r=await _(this.generateKid.bind(this),m.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:i}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(m.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:ou.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,i){const{resourceRequestMethod:o,resourceRequestUri:a,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=a?new ee(a):void 0,u=h==null?void 0:h.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Ge(),m:o==null?void 0:o.toUpperCase(),u:u==null?void 0:u.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:u==null?void 0:u.AbsolutePath,q:u!=null&&u.QueryString?[[],u.QueryString]:void 0,client_claims:c||void 0,...i},t,d,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class au{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.12.0 2025-08-19 */class zt{constructor(e,t,r,i,o,a,c){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=c}validateTokenResponse(e,t){var r;if(e.error||e.error_description||e.suberror){const i=`Error(s): ${e.error_codes||I.NOT_AVAILABLE} - Timestamp: ${e.timestamp||I.NOT_AVAILABLE} - Description: ${e.error_description||I.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||I.NOT_AVAILABLE} - Trace ID: ${e.trace_id||I.NOT_AVAILABLE}`,o=(r=e.error_codes)!=null&&r.length?e.error_codes[0]:void 0,a=new Wt(e.error,i,e.suberror,o,e.status);if(t&&e.status&&e.status>=Tt.SERVER_ERROR_RANGE_START&&e.status<=Tt.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${a}`);return}else if(t&&e.status&&e.status>=Tt.CLIENT_ERROR_RANGE_START&&e.status<=Tt.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${a}`);return}throw gc(e.error,e.error_description,e.suberror)?new lt(e.error,e.error_description,e.suberror,e.timestamp||I.EMPTY_STRING,e.trace_id||I.EMPTY_STRING,e.correlation_id||I.EMPTY_STRING,e.claims||I.EMPTY_STRING,o):a}}async handleServerTokenResponse(e,t,r,i,o,a,c,l,d){var E;(E=this.performanceClient)==null||E.addQueueMeasurement(m.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=lr(e.id_token||I.EMPTY_STRING,this.cryptoObj.base64Decode),o&&o.nonce&&h.nonce!==o.nonce)throw R(fa);if(i.maxAge||i.maxAge===0){const T=h.auth_time;if(!T)throw R($n);Ba(T,i.maxAge)}}this.homeAccountIdentifier=rt.generateHomeAccountId(e.client_info||I.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let u;o&&o.state&&(u=dr.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0;const g=this.generateCacheRecord(e,t,r,i,h,a,o);let A;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),A=new au(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(A)),c&&!l&&g.account){const T=this.cacheStorage.generateAccountKey(g.account.getAccountInfo());if(!this.cacheStorage.getAccount(T,i.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await zt.generateAuthenticationResult(this.cryptoObj,t,g,!1,i,h,u,void 0,d)}await this.cacheStorage.saveCacheRecord(g,i.correlationId,i.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&A&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(A))}return zt.generateAuthenticationResult(this.cryptoObj,t,g,!1,i,h,u,e,d)}generateCacheRecord(e,t,r,i,o,a,c){const l=t.getPreferredCache();if(!l)throw R(Kn);const d=hc(o);let h,u;e.id_token&&o&&(h=Bs(this.homeAccountIdentifier,l,e.id_token,this.clientId,d||""),u=fi(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i.correlationId,o,e.client_info,l,d,c,void 0,this.logger));let g=null;if(e.access_token){const T=e.scope?Ce.fromString(e.scope):new Ce(i.scopes||[]),k=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,P=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,j=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,G=r+k,M=G+P,D=j&&j>0?r+j:void 0;g=Ks(this.homeAccountIdentifier,l,e.access_token,this.clientId,d||t.tenant||"",T.printScopes(),G,M,this.cryptoObj.base64Decode,D,e.token_type,a,e.key_id,i.claims,i.requestedClaimsHash)}let A=null;if(e.refresh_token){let T;if(e.refresh_token_expires_in){const k=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;T=r+k}A=cc(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,a,T)}let E=null;return e.foci&&(E={clientId:this.clientId,environment:l,familyId:e.foci}),{account:u,idToken:h,accessToken:g,refreshToken:A,appMetadata:E}}static async generateAuthenticationResult(e,t,r,i,o,a,c,l,d){var G,M,D,C,y;let h=I.EMPTY_STRING,u=[],g=null,A,E,T=I.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===ne.POP&&!o.popKid){const f=new or(e),{secret:x,keyId:w}=r.accessToken;if(!w)throw R(zn);h=await f.signPopToken(x,w,o)}else h=r.accessToken.secret;u=Ce.fromString(r.accessToken.target).asArray(),g=rr(r.accessToken.expiresOn),A=rr(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(E=rr(r.accessToken.refreshOn))}r.appMetadata&&(T=r.appMetadata.familyId===us?us:"");const k=(a==null?void 0:a.oid)||(a==null?void 0:a.sub)||"",P=(a==null?void 0:a.tid)||"";l!=null&&l.spa_accountid&&r.account&&(r.account.nativeAccountId=l==null?void 0:l.spa_accountid);const j=r.account?Zn(r.account.getAccountInfo(),void 0,a,(G=r.idToken)==null?void 0:G.secret):null;return{authority:t.canonicalAuthority,uniqueId:k,tenantId:P,scopes:u,account:j,idToken:((M=r==null?void 0:r.idToken)==null?void 0:M.secret)||"",idTokenClaims:a||{},accessToken:h,fromCache:i,expiresOn:g,extExpiresOn:A,refreshOn:E,correlationId:o.correlationId,requestId:d||I.EMPTY_STRING,familyId:T,tokenType:((D=r.accessToken)==null?void 0:D.tokenType)||I.EMPTY_STRING,state:c?c.userRequestState:I.EMPTY_STRING,cloudGraphHostName:((C=r.account)==null?void 0:C.cloudGraphHostName)||I.EMPTY_STRING,msGraphHost:((y=r.account)==null?void 0:y.msGraphHost)||I.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function fi(n,e,t,r,i,o,a,c,l,d,h,u){u==null||u.verbose("setCachedAccount called");const A=n.getAccountKeys().find(j=>j.startsWith(t));let E=null;A&&(E=n.getAccount(A,i));const T=E||rt.createAccount({homeAccountId:t,idTokenClaims:o,clientInfo:a,environment:c,cloudGraphHostName:d==null?void 0:d.cloud_graph_host_name,msGraphHost:d==null?void 0:d.msgraph_host,nativeAccountId:h},e,r),k=T.tenantProfiles||[],P=l||T.realm;if(P&&!k.find(j=>j.tenantId===P)){const j=Xn(t,T.localAccountId,P,o);k.push(j)}return T.tenantProfiles=k,T}/*! @azure/msal-common v15.12.0 2025-08-19 */async function mc(n,e,t){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.12.0 2025-08-19 */class pc extends gi{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async acquireToken(e,t){var c,l;if((c=this.performanceClient)==null||c.addQueueMeasurement(m.AuthClientAcquireToken,e.correlationId),!e.code)throw R(ba);const r=Ge(),i=await _(this.executeTokenRequest.bind(this),m.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=(l=i.headers)==null?void 0:l[Ue.X_MS_REQUEST_ID],a=new zt(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return a.validateTokenResponse(i.body),_(a.handleServerTokenResponse.bind(a),m.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,r,e,t,void 0,void 0,void 0,o)}getLogoutUri(e){if(!e)throw ue(Pa);const t=this.createLogoutUrlQueryString(e);return ee.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var d;(d=this.performanceClient)==null||d.addQueueMeasurement(m.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),i=ee.appendQueryString(e.tokenEndpoint,r),o=await _(this.createTokenRequestBody.bind(this),m.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let a;if(t.clientInfo)try{const h=bs(t.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${h.uid}${Nr.CLIENT_INFO_SEPARATOR}${h.utid}`,type:ot.HOME_ACCOUNT_ID}}catch(h){this.logger.verbose("Could not parse client info for CCS Header: "+h)}const c=this.createTokenRequestHeaders(a||t.ccsCredential),l=zs(this.config.authOptions.clientId,t);return _(this.executePostToTokenEndpoint.bind(this),m.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,o,c,l,t.correlationId,m.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,o;(i=this.performanceClient)==null||i.addQueueMeasurement(m.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(ni(t,e.embeddedClientId||((o=e.tokenBodyParameters)==null?void 0:o[Kt])||this.config.authOptions.clientId),this.includeRedirectUri)ii(t,e.redirectUri);else if(!e.redirectUri)throw ue(Ta);if(si(t,e.scopes,!0,this.oidcDefaultScopes),Mh(t,e.code),ci(t,this.config.libraryInfo),li(t,this.config.telemetry.application),ac(t),this.serverTelemetryManager&&!Wa(this.config)&&oc(t,this.serverTelemetryManager),e.codeVerifier&&Lh(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&ec(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;tc(t,await mc(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),rc(t,a.assertionType)}if(sc(t,ca.AUTHORIZATION_CODE_GRANT),di(t),e.authenticationScheme===ne.POP){const a=new or(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await _(a.generateCnf.bind(a),m.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,hi(t,c)}else if(e.authenticationScheme===ne.SSH)if(e.sshJwk)ic(t,e.sshJwk);else throw ue(Us);(!Qe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&oi(t,e.claims,this.config.authOptions.clientCapabilities);let r;if(e.clientInfo)try{const a=bs(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${a.uid}${Nr.CLIENT_INFO_SEPARATOR}${a.utid}`,type:ot.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case ot.HOME_ACCOUNT_ID:try{const a=tr(r.credential);kr(t,a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case ot.UPN:ks(t,r.credential);break}return e.embeddedClientId&&Fs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Rt(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[mo])&&Rt(t,{[mo]:"1"}),Hs(t,e.correlationId,this.performanceClient),Er(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&Eh(t,e.postLogoutRedirectUri),e.correlationId&&ai(t,e.correlationId),e.idTokenHint&&Rh(t,e.idTokenHint),e.state&&Xa(t,e.state),e.logoutHint&&Hh(t,e.logoutHint),e.extraQueryParameters&&Rt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&nc(t),Er(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const cu=300;class lu extends gi{constructor(e,t){super(e,t)}async acquireToken(e){var a,c;(a=this.performanceClient)==null||a.addQueueMeasurement(m.RefreshTokenClientAcquireToken,e.correlationId);const t=Ge(),r=await _(this.executeTokenRequest.bind(this),m.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(c=r.headers)==null?void 0:c[Ue.X_MS_REQUEST_ID],o=new zt(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(r.body),_(o.handleServerTokenResponse.bind(o),m.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var r;if(!e)throw ue(ja);if((r=this.performanceClient)==null||r.addQueueMeasurement(m.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw R(Bn);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await _(this.acquireTokenWithCachedRefreshToken.bind(this),m.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const o=i instanceof lt&&i.errorCode===Ss,a=i instanceof Wt&&i.errorCode===no.INVALID_GRANT_ERROR&&i.subError===no.CLIENT_MISMATCH_ERROR;if(o||a)return _(this.acquireTokenWithCachedRefreshToken.bind(this),m.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return _(this.acquireTokenWithCachedRefreshToken.bind(this),m.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var o,a,c;(o=this.performanceClient)==null||o.addQueueMeasurement(m.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=Ye(this.cacheManager.getRefreshToken.bind(this.cacheManager),m.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw _s(Ss);if(r.expiresOn&&Cs(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||cu))throw(a=this.performanceClient)==null||a.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),_s(mi);const i={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||ne.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:ot.HOME_ACCOUNT_ID}};try{return await _(this.acquireToken.bind(this),m.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(l){if(l instanceof lt&&((c=this.performanceClient)==null||c.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),l.subError===qs)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const d=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(d,e.correlationId)}throw l}}async executeTokenRequest(e,t){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(m.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),i=ee.appendQueryString(t.tokenEndpoint,r),o=await _(this.createTokenRequestBody.bind(this),m.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),a=this.createTokenRequestHeaders(e.ccsCredential),c=zs(this.config.authOptions.clientId,e);return _(this.executePostToTokenEndpoint.bind(this),m.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,o,a,c,e.correlationId,m.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i,o;(r=this.performanceClient)==null||r.addQueueMeasurement(m.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(ni(t,e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[Kt])||this.config.authOptions.clientId),e.redirectUri&&ii(t,e.redirectUri),si(t,e.scopes,!0,(o=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:o.defaultScopes),sc(t,ca.REFRESH_TOKEN_GRANT),di(t),ci(t,this.config.libraryInfo),li(t,this.config.telemetry.application),ac(t),this.serverTelemetryManager&&!Wa(this.config)&&oc(t,this.serverTelemetryManager),Dh(t,e.refreshToken),this.config.clientCredentials.clientSecret&&ec(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;tc(t,await mc(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),rc(t,a.assertionType)}if(e.authenticationScheme===ne.POP){const a=new or(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await _(a.generateCnf.bind(a),m.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,hi(t,c)}else if(e.authenticationScheme===ne.SSH)if(e.sshJwk)ic(t,e.sshJwk);else throw ue(Us);if((!Qe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&oi(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ot.HOME_ACCOUNT_ID:try{const a=tr(e.ccsCredential.credential);kr(t,a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case ot.UPN:ks(t,e.ccsCredential.credential);break}return e.embeddedClientId&&Fs(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Rt(t,e.tokenBodyParameters),Hs(t,e.correlationId,this.performanceClient),Er(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class du extends gi{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(m.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Lt.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Qe.isEmptyObj(e.claims))throw this.setCacheOutcome(Lt.FORCE_REFRESH_OR_CLAIMS,e.correlationId),R(Et);if(!e.account)throw R(Bn);const r=e.account.tenantId||Zh(e.authority),i=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,i,r);if(o){if(qh(o.cachedAt)||Cs(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Lt.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),R(Et);o.refreshOn&&Cs(o.refreshOn,0)&&(t=Lt.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Lt.NO_CACHED_ACCESS_TOKEN,e.correlationId),R(Et);const a=e.authority||this.authority.getPreferredCache(),c={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,i,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(a)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await _(this.generateResultFromCacheRecord.bind(this),m.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(c,e),t]}setCacheOutcome(e,t){var r,i;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==Lt.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(m.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=lr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const o=r==null?void 0:r.auth_time;if(!o)throw R($n);Ba(o,t.maxAge)}return zt.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const hu={sendGetRequestAsync:()=>Promise.reject(R(W)),sendPostRequestAsync:()=>Promise.reject(R(W))};/*! @azure/msal-common v15.12.0 2025-08-19 */function uu(n,e,t,r){var c,l;const i=e.correlationId,o=new Map;ni(o,e.embeddedClientId||((c=e.extraQueryParameters)==null?void 0:c[Kt])||n.clientId);const a=[...e.scopes||[],...e.extraScopesToConsent||[]];if(si(o,a,!0,(l=n.authority.options.OIDCOptions)==null?void 0:l.defaultScopes),ii(o,e.redirectUri),ai(o,i),Th(o,e.responseMode),di(o),e.prompt&&(Ph(o,e.prompt),r==null||r.addFields({prompt:e.prompt},i)),e.domainHint&&(jh(o,e.domainHint),r==null||r.addFields({domainHintFromRequest:!0},i)),e.prompt!==Fe.SELECT_ACCOUNT)if(e.sid&&e.prompt===Fe.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),po(o,e.sid),r==null||r.addFields({sidFromRequest:!0},i);else if(e.account){const d=pu(e.account);let h=fu(e.account);if(h&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),h=null),h){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),Yr(o,h),r==null||r.addFields({loginHintFromClaim:!0},i);try{const u=tr(e.account.homeAccountId);kr(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(d&&e.prompt===Fe.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),po(o,d),r==null||r.addFields({sidFromClaim:!0},i);try{const u=tr(e.account.homeAccountId);kr(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),Yr(o,e.loginHint),ks(o,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},i);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),Yr(o,e.account.username),r==null||r.addFields({loginHintFromUpn:!0},i);try{const u=tr(e.account.homeAccountId);kr(o,u)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),Yr(o,e.loginHint),ks(o,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},i));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&Oh(o,e.nonce),e.state&&Xa(o,e.state),(e.claims||n.clientCapabilities&&n.clientCapabilities.length>0)&&oi(o,e.claims,n.clientCapabilities),e.embeddedClientId&&Fs(o,n.clientId,n.redirectUri),n.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(kn))&&nc(o),o}function yi(n,e,t,r){const i=Er(e,t,r);return ee.appendQueryString(n.authorizationEndpoint,i)}function gu(n,e){if(fc(n,e),!n.code)throw R(Sa);return n}function fc(n,e){if(!n.state||!e)throw n.state?R(fn,"Cached State"):R(fn,"Server State");let t,r;try{t=decodeURIComponent(n.state)}catch{throw R(ir,n.state)}try{r=decodeURIComponent(e)}catch{throw R(ir,n.state)}if(t!==r)throw R(pa);if(n.error||n.error_description||n.suberror){const i=mu(n);throw gc(n.error,n.error_description,n.suberror)?new lt(n.error||"",n.error_description,n.suberror,n.timestamp||"",n.trace_id||"",n.correlation_id||"",n.claims||"",i):new Wt(n.error||"",n.error_description,n.suberror,i)}}function mu(n){var r,i;const e="code=",t=(r=n.error_uri)==null?void 0:r.lastIndexOf(e);return t&&t>=0?(i=n.error_uri)==null?void 0:i.substring(t+e.length):void 0}function pu(n){var e;return((e=n.idTokenClaims)==null?void 0:e.sid)||null}function fu(n){var e;return n.loginHint||((e=n.idTokenClaims)==null?void 0:e.login_hint)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */const ko=",",yc="|";function yu(n){const{skus:e,libraryName:t,libraryVersion:r,extensionName:i,extensionVersion:o}=n,a=new Map([[0,[t,r]],[2,[i,o]]]);let c=[];if(e!=null&&e.length){if(c=e.split(ko),c.length<4)return e}else c=Array.from({length:4},()=>yc);return a.forEach((l,d)=>{var h,u;l.length===2&&((h=l[0])!=null&&h.length)&&((u=l[1])!=null&&u.length)&&xu({skuArr:c,index:d,skuName:l[0],skuVersion:l[1]})}),c.join(ko)}function xu(n){const{skuArr:e,index:t,skuName:r,skuVersion:i}=n;t>=e.length||(e[t]=[r,i].join(yc))}class Rr{constructor(e,t){this.cacheOutcome=Lt.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||I.EMPTY_STRING,this.wrapperVer=e.wrapperVer||I.EMPTY_STRING,this.telemetryCacheKey=Ne.CACHE_KEY+Nr.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Ne.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r!=null&&r.length&&t.push(`broker_error=${r}`);const i=t.join(Ne.VALUE_SEPARATOR),o=this.getRegionDiscoveryFields(),a=[e,o].join(Ne.VALUE_SEPARATOR);return[Ne.SCHEMA_VERSION,a,i].join(Ne.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Rr.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Ne.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(Ne.VALUE_SEPARATOR),o=e.errors.length,a=t<o?Ne.OVERFLOW_TRUE:Ne.OVERFLOW_FALSE,c=[o,a].join(Ne.VALUE_SEPARATOR);return[Ne.SCHEMA_VERSION,e.cacheHits,r,i,c].join(Ne.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Ne.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof ae?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Ne.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Rr.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,i=0;const o=e.errors.length;for(t=0;t<o;t++){const a=e.failedRequests[2*t]||I.EMPTY_STRING,c=e.failedRequests[2*t+1]||I.EMPTY_STRING,l=e.errors[t]||I.EMPTY_STRING;if(i+=a.toString().length+c.toString().length+l.length+3,i<Ne.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||I.EMPTY_STRING),e.push(this.regionSource||I.EMPTY_STRING),e.push(this.regionOutcome||I.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return yu(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const xc="missing_kid_error",bc="missing_alg_error";/*! @azure/msal-common v15.12.0 2025-08-19 */const bu={[xc]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[bc]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class xi extends ae{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,xi.prototype)}}function Co(n){return new xi(n,bu[n])}/*! @azure/msal-common v15.12.0 2025-08-19 */class bi{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Co(xc);if(!e.alg)throw Co(bc);const t=new bi({typ:e.typ||ud.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const wi="pkce_not_created",vi="ear_jwk_empty",wc="ear_jwe_empty",Cn="crypto_nonexistent",Vs="empty_navigate_uri",vc="hash_empty_error",ki="no_state_in_hash",kc="hash_does_not_contain_known_properties",Cc="unable_to_parse_state",Sc="state_interaction_type_mismatch",_c="interaction_in_progress",Ac="popup_window_error",Ic="empty_window_error",jr="user_cancelled",wu="monitor_popup_timeout",Tc="monitor_window_timeout",Nc="redirect_in_iframe",Ec="block_iframe_reload",Rc="block_nested_popups",vu="iframe_closed_prematurely",Ws="silent_logout_unsupported",jc="no_account_error",ku="silent_prompt_value_error",Pc="no_token_request_cache_error",Oc="unable_to_parse_token_request_cache_error",Cu="auth_request_not_set_error",Su="invalid_cache_type",Qs="non_browser_environment",Jt="database_not_open",As="no_network_connectivity",Mc="post_request_failed",Dc="get_request_failed",Sn="failed_to_parse_response",Lc="unable_to_load_token",Ci="crypto_key_not_found",Uc="auth_code_required",Hc="auth_code_or_nativeAccountId_required",Fc="spa_code_and_nativeAccountId_present",Si="database_unavailable",$c="unable_to_acquire_token_from_native_platform",Bc="native_handshake_timeout",Kc="native_extension_not_installed",_i="native_connection_not_established",Cr="uninitialized_public_client_application",zc="native_prompt_not_supported",Gc="invalid_base64_string",qc="invalid_pop_token_request",Vc="failed_to_build_headers",Wc="failed_to_parse_headers",ds="failed_to_decrypt_ear_response",Is="timed_out";/*! @azure/msal-browser v4.23.0 2025-09-17 */const yt="For more visit: aka.ms/msaljs/browser-errors",_u={[wi]:"The PKCE code challenge and verifier could not be generated.",[vi]:"No EAR encryption key provided. This is unexpected.",[wc]:"Server response does not contain ear_jwe property. This is unexpected.",[Cn]:"The crypto object or function is not available.",[Vs]:"Navigation URI is empty. Please check stack trace for more info.",[vc]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${yt}`,[ki]:"Hash does not contain state. Please verify that the request originated from msal.",[kc]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${yt}`,[Cc]:"Unable to parse state. Please verify that the request originated from msal.",[Sc]:"Hash contains state but the interaction type does not match the caller.",[_c]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${yt}`,[Ac]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Ic]:"window.open returned null or undefined window object.",[jr]:"User cancelled the flow.",[wu]:`Token acquisition in popup failed due to timeout.  ${yt}`,[Tc]:`Token acquisition in iframe failed due to timeout.  ${yt}`,[Nc]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Ec]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${yt}`,[Rc]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[vu]:"The iframe being monitored was closed prematurely.",[Ws]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[jc]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[ku]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Pc]:"No token request found in cache.",[Oc]:"The cached token request could not be parsed.",[Cu]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Su]:"Invalid cache type",[Qs]:"Login and token requests are not supported in non-browser environments.",[Jt]:"Database is not open!",[As]:"No network connectivity. Check your internet connection.",[Mc]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Dc]:"Network request failed. Please check the network trace to determine root cause.",[Sn]:"Failed to parse network response. Check network trace.",[Lc]:"Error loading token to cache.",[Ci]:"Cryptographic Key or Keypair not found in browser storage.",[Uc]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Hc]:"An authorization code or nativeAccountId must be provided to this flow.",[Fc]:"Request cannot contain both spa code and native account id.",[Si]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[$c]:`Unable to acquire token from native platform.  ${yt}`,[Bc]:"Timed out while attempting to establish connection to browser extension",[Kc]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[_i]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${yt}`,[Cr]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${yt}`,[zc]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Gc]:"Invalid base64 encoded string.",[qc]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Vc]:"Failed to build request headers object.",[Wc]:"Failed to parse response headers",[ds]:"Failed to decrypt ear response",[Is]:"The request timed out."};class $r extends ae{constructor(e,t){super(e,_u[e],t),Object.setPrototypeOf(this,$r.prototype),this.name="BrowserAuthError"}}function U(n,e){return new $r(n,e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ke={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Ze={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},yr={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Se={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},So={GET:"GET",POST:"POST"},At={SIGNIN:"signin",SIGNOUT:"signout"},be={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},Xr={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},oe={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var B;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(B||(B={}));const ge={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},_o={scopes:cr},Qc="jwk",Au={React:"@azure/msal-react",Angular:"@azure/msal-angular"},_n="msal.db",Iu=1,Tu=`${_n}.keys`,Le={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Nu=[Le.Default,Le.Skip,Le.RefreshTokenAndNetwork];/*! @azure/msal-browser v4.23.0 2025-09-17 */function Zr(n){return encodeURIComponent(Pr(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Pt(n){return Yc(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Pr(n){return Yc(new TextEncoder().encode(n))}function Yc(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */function ct(n){return new TextDecoder().decode(jt(n))}function jt(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw U(Gc)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Eu="RSASSA-PKCS1-v1_5",hr="AES-GCM",Jc="HKDF",Ai="SHA-256",Ru=2048,ju=new Uint8Array([1,0,1]),Ao="0123456789abcdef",Io=new Uint32Array(1),Ii="raw",Xc="encrypt",Ti="decrypt",Pu="deriveKey",Ou="crypto_subtle_undefined",Ni={name:Eu,hash:Ai,modulusLength:Ru,publicExponent:ju};function Mu(n){if(!window)throw U(Qs);if(!window.crypto)throw U(Cn);if(!n&&!window.crypto.subtle)throw U(Cn,Ou)}async function Zc(n,e,t){e==null||e.addQueueMeasurement(m.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(Ai,i)}function Du(n){return window.crypto.getRandomValues(n)}function on(){return window.crypto.getRandomValues(Io),Io[0]}function dt(){const n=Date.now(),e=on()*1024+(on()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,o=on();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;let a="";for(let c=0;c<t.length;c++)a+=Ao.charAt(t[c]>>>4),a+=Ao.charAt(t[c]&15),(c===3||c===5||c===7||c===9)&&(a+="-");return a}async function Lu(n,e){return window.crypto.subtle.generateKey(Ni,n,e)}async function an(n){return window.crypto.subtle.exportKey(Qc,n)}async function Uu(n,e,t){return window.crypto.subtle.importKey(Qc,n,Ni,e,t)}async function Hu(n,e){return window.crypto.subtle.sign(Ni,n,e)}async function Ei(){const n=await el(),t={alg:"dir",kty:"oct",k:Pt(new Uint8Array(n))};return Pr(JSON.stringify(t))}async function Fu(n){const e=ct(n),r=JSON.parse(e).k,i=jt(r);return window.crypto.subtle.importKey(Ii,i,hr,!1,[Ti])}async function $u(n,e){const t=e.split(".");if(t.length!==5)throw U(ds,"jwe_length");const r=await Fu(n).catch(()=>{throw U(ds,"import_key")});try{const i=new TextEncoder().encode(t[0]),o=jt(t[2]),a=jt(t[3]),c=jt(t[4]),l=c.byteLength*8,d=new Uint8Array(a.length+c.length);d.set(a),d.set(c,a.length);const h=await window.crypto.subtle.decrypt({name:hr,iv:o,tagLength:l,additionalData:i},r,d);return new TextDecoder().decode(h)}catch{throw U(ds,"decrypt")}}async function el(){const n=await window.crypto.subtle.generateKey({name:hr,length:256},!0,[Xc,Ti]);return window.crypto.subtle.exportKey(Ii,n)}async function To(n){return window.crypto.subtle.importKey(Ii,n,Jc,!1,[Pu])}async function tl(n,e,t){return window.crypto.subtle.deriveKey({name:Jc,salt:e,hash:Ai,info:new TextEncoder().encode(t)},n,{name:hr,length:256},!1,[Xc,Ti])}async function Bu(n,e,t){const r=new TextEncoder().encode(e),i=window.crypto.getRandomValues(new Uint8Array(16)),o=await tl(n,i,t),a=await window.crypto.subtle.encrypt({name:hr,iv:new Uint8Array(12)},o,r);return{data:Pt(new Uint8Array(a)),nonce:Pt(i)}}async function No(n,e,t,r){const i=jt(r),o=await tl(n,jt(e),t),a=await window.crypto.subtle.decrypt({name:hr,iv:new Uint8Array(12)},o,i);return new TextDecoder().decode(a)}async function rl(n){const e=await Zc(n),t=new Uint8Array(e);return Pt(t)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ri="storage_not_supported",Ae="stubbed_public_client_application_called",sl="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ku={[Ri]:"Given storage configuration option was not supported.",[Ae]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[sl]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class ji extends ae{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,ji.prototype)}}function xe(n){return new ji(n,Ku[n])}/*! @azure/msal-browser v4.23.0 2025-09-17 */function nl(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function zu(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Pi(){return window.parent!==window}function Gu(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${Ke.POPUP_NAME_PREFIX}.`)===0}function wt(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function qu(){const e=new ee(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function Vu(){if(ee.hashContainsKnownProperties(window.location.hash)&&Pi())throw U(Ec)}function Wu(n){if(Pi()&&!n)throw U(Nc)}function Qu(){if(Gu())throw U(Rc)}function il(){if(typeof window>"u")throw U(Qs)}function ol(n){if(!n)throw U(Cr)}function Oi(n){il(),Vu(),Qu(),ol(n)}function Eo(n,e){if(Oi(n),Wu(e.system.allowRedirectInIframe),e.cache.cacheLocation===Se.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw xe(sl)}function al(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Yu(){return dt()}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ts{navigateInternal(e,t){return Ts.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Ts.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((r,i)=>{setTimeout(()=>{i(U(Is,"failed_to_redirect"))},t.timeout)})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ju{async sendGetRequestAsync(e,t){let r,i={},o=0;const a=Ro(t);try{r=await fetch(e,{method:So.GET,headers:a})}catch(c){throw wr(U(window.navigator.onLine?Dc:As),void 0,void 0,c)}i=jo(r.headers);try{return o=r.status,{headers:i,body:await r.json(),status:o}}catch(c){throw wr(U(Sn),o,i,c)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",i=Ro(t);let o,a=0,c={};try{o=await fetch(e,{method:So.POST,headers:i,body:r})}catch(l){throw wr(U(window.navigator.onLine?Mc:As),void 0,void 0,l)}c=jo(o.headers);try{return a=o.status,{headers:c,body:await o.json(),status:a}}catch(l){throw wr(U(Sn),a,c,l)}}}function Ro(n){try{const e=new Headers;if(!(n&&n.headers))return e;const t=n.headers;return Object.entries(t).forEach(([r,i])=>{e.append(r,i)}),e}catch(e){throw wr(U(Vc),void 0,void 0,e)}}function jo(n){try{const e={};return n.forEach((t,r)=>{e[r]=t}),e}catch{throw U(Wc)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Xu=6e4,An=1e4,Zu=3e4,cl=2e3;function eg({auth:n,cache:e,system:t,telemetry:r},i){const o={clientId:I.EMPTY_STRING,authority:`${I.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:I.EMPTY_STRING,authorityMetadata:I.EMPTY_STRING,redirectUri:typeof window<"u"?wt():"",postLogoutRedirectUri:I.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:ze.AAD,OIDCOptions:{serverResponseType:Ls.FRAGMENT,defaultScopes:[I.OPENID_SCOPE,I.PROFILE_SCOPE,I.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Vn.None,tenant:I.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},a={cacheLocation:Se.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:Se.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Se.LocalStorage),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:me.Info,piiLoggingEnabled:!1},d={...{...Va,loggerOptions:c,networkClient:i?new Ju:hu,navigationClient:new Ts,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Xu,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||An,navigateFrameWait:0,redirectNavigationTimeout:Zu,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||cl,pollIntervalMilliseconds:Ke.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||c},h={application:{appName:I.EMPTY_STRING,appVersion:I.EMPTY_STRING},client:new qa};if((n==null?void 0:n.protocolMode)!==ze.OIDC&&(n!=null&&n.OIDCOptions)&&new kt(d.loggerOptions).warning(JSON.stringify(ue(La))),n!=null&&n.protocolMode&&n.protocolMode===ze.OIDC&&(d!=null&&d.allowPlatformBroker))throw ue(Ua);return{auth:{...o,...n,OIDCOptions:{...o.OIDCOptions,...n==null?void 0:n.OIDCOptions}},cache:{...a,...e},system:d,telemetry:{...h,...r}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const tg="@azure/msal-browser",Gt="4.23.0";/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ie="msal",Mi="browser",cn="-",_t=1,In=1,rg=`${Ie}.${Mi}.log.level`,sg=`${Ie}.${Mi}.log.pii`,ng=`${Ie}.${Mi}.platform.auth.dom`,Po=`${Ie}.version`,Oo="account.keys",Mo="token.keys";function ut(n=In){return n<1?`${Ie}.${Oo}`:`${Ie}.${n}.${Oo}`}function Ht(n,e=_t){return e<1?`${Ie}.${Mo}.${n}`:`${Ie}.${e}.${Mo}.${n}`}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Di{static loggerCallback(e,t){switch(e){case me.Error:console.error(t);return;case me.Info:console.info(t);return;case me.Verbose:console.debug(t);return;case me.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=eg(e,this.browserEnvironment);let t;try{t=window[Se.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(rg),i=(l=t==null?void 0:t.getItem(sg))==null?void 0:l.toLowerCase(),o=i==="true"?!0:i==="false"?!1:void 0,a={...this.config.system.loggerOptions},c=r&&Object.keys(me).includes(r)?me[r]:void 0;c&&(a.loggerCallback=Di.loggerCallback,a.logLevel=c),o!==void 0&&(a.piiLoggingEnabled=o),this.logger=new kt(a,tg,Gt),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class qt extends Di{getModuleName(){return qt.MODULE_NAME}getId(){return qt.ID}async initialize(){return this.available=typeof window<"u",this.available}}qt.MODULE_NAME="";qt.ID="StandardOperatingContext";/*! @azure/msal-browser v4.23.0 2025-09-17 */class ig{constructor(){this.dbName=_n,this.version=Iu,this.tableName=Tu,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",i=>{const o=i;this.db=o.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(U(Si)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(U(Jt));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);a.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result)}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,i)=>{if(!this.db)return i(U(Jt));const c=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);c.addEventListener("success",()=>{this.closeConnection(),r()}),c.addEventListener("error",l=>{this.closeConnection(),i(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(U(Jt));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);a.addEventListener("success",()=>{this.closeConnection(),t()}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(U(Jt));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();o.addEventListener("success",a=>{const c=a;this.closeConnection(),e(c.target.result)}),o.addEventListener("error",a=>{this.closeConnection(),t(a)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(U(Jt));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);a.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result===1)}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(_n),i=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(i),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),r.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ys{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class og{constructor(e){this.inMemoryCache=new Ys,this.indexedDBCache=new ig,this.logger=e}handleDatabaseAccessError(e){if(e instanceof $r&&e.errorCode===Si)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ct{constructor(e,t,r){this.logger=e,Mu(r??!1),this.cache=new og(this.logger),this.performanceClient=t}createNewGuid(){return dt()}base64Encode(e){return Pr(e)}base64Decode(e){return ct(e)}base64UrlEncode(e){return Zr(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var h;const t=(h=this.performanceClient)==null?void 0:h.startMeasurement(m.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await Lu(Ct.EXTRACTABLE,Ct.POP_KEY_USAGES),i=await an(r.publicKey),o={e:i.e,kty:i.kty,n:i.n},a=Do(o),c=await this.hashString(a),l=await an(r.privateKey),d=await Uu(l,!1,["sign"]);return await this.cache.setItem(c,{privateKey:d,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),c}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw R(_a)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){var G;const o=(G=this.performanceClient)==null?void 0:G.startMeasurement(m.CryptoOptsSignJwt,i),a=await this.cache.getItem(t);if(!a)throw U(Ci);const c=await an(a.publicKey),l=Do(c),d=Zr(JSON.stringify({kid:t})),h=bi.getShrHeaderString({...r==null?void 0:r.header,alg:c.alg,kid:d}),u=Zr(h);e.cnf={jwk:JSON.parse(l)};const g=Zr(JSON.stringify(e)),A=`${u}.${g}`,T=new TextEncoder().encode(A),k=await Hu(a.privateKey,T),P=Pt(new Uint8Array(k)),j=`${A}.${P}`;return o&&o.end({success:!0}),j}async hashString(e){return rl(e)}}Ct.POP_KEY_USAGES=["sign","verify"];Ct.EXTRACTABLE=!0;function Do(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v4.23.0 2025-09-17 */const ag=24*60*60*1e3,Tn={Lax:"Lax",None:"None"};class ll{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let i=0;i<r.length;i++){const o=r[i],[a,...c]=decodeURIComponent(o).trim().split("="),l=c.join("=");if(a===t)return l}return""}getUserData(){throw R(W)}setItem(e,t,r,i=!0,o=Tn.Lax){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){const c=cg(r);a+=`expires=${c};`}(i||o===Tn.None)&&(a+="Secure;"),document.cookie=a}async setUserData(){return Promise.reject(R(W))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(r=>{const i=decodeURIComponent(r).trim().split("=");t.push(i[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function cg(n){const e=new Date;return new Date(e.getTime()+n*ag).toUTCString()}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Sr(n,e){const t=n.getItem(ut(e));return t?JSON.parse(t):[]}function _r(n,e,t){const r=e.getItem(Ht(n,t));if(r){const i=JSON.parse(r);if(i&&i.hasOwnProperty("idToken")&&i.hasOwnProperty("accessToken")&&i.hasOwnProperty("refreshToken"))return i}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Nn(n){return n.hasOwnProperty("id")&&n.hasOwnProperty("nonce")&&n.hasOwnProperty("data")}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Lo="msal.cache.encryption",lg="msal.broadcast.cache";class dg{constructor(e,t,r){if(!window.localStorage)throw xe(Ri);this.memoryStorage=new Ys,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel(lg)}async initialize(e){const t=new ll,r=t.getItem(Lo);let i={key:"",id:""};if(r)try{i=JSON.parse(r)}catch{}if(i.key&&i.id){const o=Ye(jt,m.Base64Decode,this.logger,this.performanceClient,e)(i.key);this.encryptionCookie={id:i.id,key:await _(To,m.GenerateHKDF,this.logger,this.performanceClient,e)(o)}}else{const o=dt(),a=await _(el,m.GenerateBaseKey,this.logger,this.performanceClient,e)(),c=Ye(Pt,m.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(a));this.encryptionCookie={id:o,key:await _(To,m.GenerateHKDF,this.logger,this.performanceClient,e)(a)};const l={id:o,key:c};t.setItem(Lo,JSON.stringify(l),0,!0,Tn.None)}await _(this.importExistingCache.bind(this),m.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw U(Cr);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw U(Cr);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const i=await _(No,m.Decrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!i)return null;try{return JSON.parse(i)}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,i){if(!this.initialized||!this.encryptionCookie)throw U(Cr);const{data:o,nonce:a}=await _(Bu,m.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:a,data:o,lastUpdatedAt:i};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(c)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Sr(this).forEach(r=>this.removeItem(r));const t=_r(this.clientId,this);t.idToken.forEach(r=>this.removeItem(r)),t.accessToken.forEach(r=>this.removeItem(r)),t.refreshToken.forEach(r=>this.removeItem(r)),this.getKeys().forEach(r=>{(r.startsWith(Ie)||r.indexOf(this.clientId)!==-1)&&this.removeItem(r)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Sr(this);t=await this.importArray(t,e),t.length?this.setItem(ut(),JSON.stringify(t)):this.removeItem(ut());const r=_r(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(Ht(this.clientId),JSON.stringify(r)):this.removeItem(Ht(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let i;try{i=JSON.parse(r)}catch{return null}return Nn(i)?i.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):_(No,m.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,i.nonce,this.getContext(e),i.data):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),i)}async importArray(e,t){const r=[],i=[];return e.forEach(o=>{const a=this.getItemFromEncryptedCache(o,t).then(c=>{c?(this.memoryStorage.setItem(o,c),r.push(o)):this.removeItem(o)});i.push(a)}),await Promise.all(i),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(m.LocalStorageUpdated);t.add({isBackground:!0});const{key:r,value:i,context:o}=e.data;if(!r){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(o&&o!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${o}`),t.end({success:!1,errorCode:"contextMismatch"});return}i?(this.memoryStorage.setItem(r,i),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class hg{constructor(){if(!window.sessionStorage)throw xe(Ri)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const L={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};/*! @azure/msal-browser v4.23.0 2025-09-17 */function Uo(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class En extends vn{constructor(e,t,r,i,o,a,c){super(e,r,i,o,c),this.cacheConfig=t,this.logger=i,this.internalStorage=new Ys,this.browserStorage=Ho(e,t.cacheLocation,i,o),this.temporaryCacheStorage=Ho(e,t.temporaryCacheLocation,i,o),this.cookieStorage=new ll,this.eventHandler=a}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){const t=Sr(this.browserStorage,0),r=_r(this.clientId,this.browserStorage,0);this.performanceClient.addFields({oldAccountCount:t.length,oldAccessCount:r.accessToken.length,oldIdCount:r.idToken.length,oldRefreshCount:r.refreshToken.length},e);const i=Sr(this.browserStorage,1),o=_r(this.clientId,this.browserStorage,1);this.performanceClient.addFields({currAccountCount:i.length,currAccessCount:o.accessToken.length,currIdCount:o.idToken.length,currRefreshCount:o.refreshToken.length},e),await Promise.all([this.updateV0ToCurrent(In,t,i,e),this.updateV0ToCurrent(_t,r.idToken,o.idToken,e),this.updateV0ToCurrent(_t,r.accessToken,o.accessToken,e),this.updateV0ToCurrent(_t,r.refreshToken,o.refreshToken,e)]),t.length>0?this.browserStorage.setItem(ut(0),JSON.stringify(t)):this.browserStorage.removeItem(ut(0)),i.length>0?this.browserStorage.setItem(ut(1),JSON.stringify(i)):this.browserStorage.removeItem(ut(1)),this.setTokenKeys(r,e,0),this.setTokenKeys(o,e,1)}async updateV0ToCurrent(e,t,r,i){const o=[];for(const a of[...t]){const c=this.browserStorage.getItem(a),l=this.validateAndParseJson(c||"");if(!l){Uo(t,a);continue}l.lastUpdatedAt||(l.lastUpdatedAt=Date.now().toString(),this.setItem(a,JSON.stringify(l),i));const d=Nn(l)?await this.browserStorage.decryptData(a,l,i):l;let h;if(d&&(yo(d)||xo(d))&&(h=d.expiresOn),!d||Gh(l.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)||h&&Cs(h,la)){this.browserStorage.removeItem(a),Uo(t,a),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},i);continue}if(this.cacheConfig.cacheLocation!==Se.LocalStorage||Nn(l)){const u=`${Ie}.${e}${cn}${a}`,g=this.browserStorage.getItem(u);if(g){const A=this.validateAndParseJson(g);if(Number(l.lastUpdatedAt)>Number(A.lastUpdatedAt)){o.push(this.setUserData(u,JSON.stringify(d),i,l.lastUpdatedAt).then(()=>{this.performanceClient.incrementFields({updatedCacheFromV0Count:1},i)}));continue}}else{o.push(this.setUserData(u,JSON.stringify(d),i,l.lastUpdatedAt).then(()=>{r.push(u),this.performanceClient.incrementFields({upgradedCacheCount:1},i)}));continue}}}return Promise.all(o)}trackVersionChanges(e){const t=this.browserStorage.getItem(Po);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Gt&&this.setItem(Po,Gt,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,r){let i=0,o=[];const a=20;for(let c=0;c<=a;c++)try{this.browserStorage.setItem(e,t),c>0&&(c<=i?this.removeAccessTokenKeys(o.slice(0,c),r,0):(this.removeAccessTokenKeys(o.slice(0,i),r,0),this.removeAccessTokenKeys(o.slice(i,c),r)));break}catch(l){const d=wn(l);if(d.errorCode===xs&&c<a){if(!o.length){const h=e===Ht(this.clientId,0)?JSON.parse(t).accessToken:this.getTokenKeys(0).accessToken,u=e===Ht(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken;o=[...h,...u],i=h.length}if(o.length<=c)throw d;this.removeAccessToken(o[c],r,!1)}else throw d}}async setUserData(e,t,r,i){let o=0,a=[];const c=20;for(let l=0;l<=c;l++)try{await _(this.browserStorage.setUserData.bind(this.browserStorage),m.SetUserData,this.logger,this.performanceClient)(e,t,r,i),l>0&&(l<=o?this.removeAccessTokenKeys(a.slice(0,l),r,0):(this.removeAccessTokenKeys(a.slice(0,o),r,0),this.removeAccessTokenKeys(a.slice(o,l),r)));break}catch(d){const h=wn(d);if(h.errorCode===xs&&l<c){if(!a.length){const u=this.getTokenKeys(0).accessToken,g=this.getTokenKeys().accessToken;a=[...u,...g],o=u.length}if(a.length<=l)throw h;this.removeAccessToken(a[l],r,!1)}else throw h}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const i=this.validateAndParseJson(r);return!i||!rt.isAccountEntity(i)?null:vn.toObject(new rt,i)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const r=this.generateAccountKey(e.getAccountInfo()),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.addAccountKeyToMap(r,t);this.cacheConfig.cacheLocation===Se.LocalStorage&&o&&this.eventHandler.emitEvent(L.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return Sr(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const r=this.getAccountKeys();return r.indexOf(e)===-1?(r.push(e),this.setItem(ut(),JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const r=this.getAccountKeys(),i=r.indexOf(e);if(i>-1){if(r.splice(i,1),r.length===0){this.removeItem(ut());return}else this.setItem(ut(),JSON.stringify(r),t);this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const r=this.getActiveAccount(t);(r==null?void 0:r.homeAccountId)===e.homeAccountId&&(r==null?void 0:r.environment)===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(i=>{i.includes(e.homeAccountId)&&i.includes(e.environment)&&this.browserStorage.removeItem(i)}),this.cacheConfig.cacheLocation===Se.LocalStorage&&this.eventHandler.emitEvent(L.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),i=r.idToken.indexOf(e);i>-1&&(this.logger.info("idToken removed from tokenKeys map"),r.idToken.splice(i,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=_t){this.logger.trace("removeAccessTokenKey called");const i=this.getTokenKeys(r);let o=0;if(e.forEach(a=>{const c=i.accessToken.indexOf(a);c>-1&&(i.accessToken.splice(c,1),o++)}),o>0){this.logger.info(`removed ${o} accessToken keys from tokenKeys map`),this.setTokenKeys(i,t,r);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),i=r.refreshToken.indexOf(e);i>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),r.refreshToken.splice(i,1),this.setTokenKeys(r,t))}getTokenKeys(e=_t){return _r(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=_t){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(Ht(this.clientId,r));return}else this.setItem(Ht(this.clientId,r),JSON.stringify(e),t)}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const i=this.validateAndParseJson(r);return!i||!Vh(i)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),i)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();o.idToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),o.idToken.push(r),this.setTokenKeys(o,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const i=this.validateAndParseJson(r);return!i||!yo(i)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),i)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys(),a=o.accessToken.indexOf(r);a!==-1&&o.accessToken.splice(a,1),this.logger.trace(`access token ${a===-1?"added to":"updated in"} map`),o.accessToken.push(r),this.setTokenKeys(o,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const i=this.validateAndParseJson(r);return!i||!xo(i)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),i)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,await this.setUserData(r,JSON.stringify(e),t,i);const o=this.getTokenKeys();o.refreshToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),o.refreshToken.push(r),this.setTokenKeys(o,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Jh(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const r=Yh(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Wh(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&Xh(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Xr.WRAPPER_SKU,e),this.internalStorage.setItem(Xr.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Xr.WRAPPER_SKU)||I.EMPTY_STRING,t=this.internalStorage.getItem(Xr.WRAPPER_VER)||I.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(so.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const i=this.validateAndParseJson(r);return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,tenantId:i.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const r=this.generateCacheKey(so.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Ge().toString()};this.setItem(r,JSON.stringify(i),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(L.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!Qh(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const o=this.cookieStorage.getItem(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),o}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===Se.LocalStorage){const o=this.browserStorage.getItem(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),o}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(i,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(Ie)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(Ie)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(m.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let r=0;t.accessToken.forEach(i=>{const o=this.getAccessTokenCredential(i,e);o!=null&&o.requestedClaimsHash&&i.includes(o.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(i,e),r++)}),r>0&&this.logger.warning(`${r} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return Qe.startsWith(e,Ie)?e:`${Ie}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===je.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==ne.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${Ie}.${_t}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",r].join(cn).toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${Ie}.${In}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(cn).toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(be.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(be.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(be.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(be.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(be.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const r=Pr(JSON.stringify(e));if(this.setTemporaryCache(be.REQUEST_PARAMS,r,!0),t){const i=Pr(t);this.setTemporaryCache(be.VERIFIER,i,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(be.REQUEST_PARAMS,!0);if(!e)throw U(Pc);const t=this.getTemporaryCache(be.VERIFIER,!0);let r,i="";try{r=JSON.parse(ct(e)),t&&(i=ct(t))}catch(o){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${o}`),U(Oc)}return[r,i]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(be.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){var r;const t=(r=this.getInteractionInProgress())==null?void 0:r.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${Ie}.${be.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),nl(window),null}}setInteractionInProgress(e,t=At.SIGNIN){var i;const r=`${Ie}.${be.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw U(_c);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&((i=this.getInteractionInProgress())==null?void 0:i.clientId)===this.clientId&&this.removeTemporaryItem(r)}async hydrateCache(e,t){var c,l,d;const r=Bs((c=e.account)==null?void 0:c.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const o=Ks((d=e.account)==null?void 0:d.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?fo(e.expiresOn):0,e.extExpiresOn?fo(e.extExpiresOn):0,ct,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),a={idToken:r,accessToken:o};return this.saveCacheRecord(a,e.correlationId)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(i){if(i instanceof er&&this.performanceClient&&t)try{const o=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:o.refreshToken.length,cacheIdCount:o.idToken.length,cacheAtCount:o.accessToken.length},t)}catch{}throw i}}}function Ho(n,e,t,r){try{switch(e){case Se.LocalStorage:return new dg(n,t,r);case Se.SessionStorage:return new hg;case Se.MemoryStorage:default:break}}catch(i){t.error(i)}return new Ys}const ug=(n,e,t,r)=>{const i={cacheLocation:Se.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Se.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new En(n,i,ps,e,t,r)};/*! @azure/msal-browser v4.23.0 2025-09-17 */function gg(n,e,t,r,i){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(i||{},r):[]}function mg(n,e,t,r){const i=t.getAccountInfoFilteredBy(n,r);return i?(e.verbose("getAccount: Account matching provided filter found, returning"),i):(e.verbose("getAccount: No matching account found, returning null"),null)}function pg(n,e,t,r){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;const i=t.getAccountInfoFilteredBy({username:n},r);return i?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),i):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function fg(n,e,t,r){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const i=t.getAccountInfoFilteredBy({homeAccountId:n},r);return i?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),i):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function yg(n,e,t,r){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const i=t.getAccountInfoFilteredBy({localAccountId:n},r);return i?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),i):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function xg(n,e,t){e.setActiveAccount(n,t)}function bg(n,e){return n.getActiveAccount(e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const wg="msal.broadcast.event";class vg{constructor(e){this.eventCallbacks=new Map,this.logger=e||new kt({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(wg)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if(typeof window<"u"){const i=r||Yu();return this.eventCallbacks.has(i)?(this.logger.error(`Event callback with id: ${i} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(i,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${i}`),i)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,i){var a;const o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};switch(e){case L.ACCOUNT_ADDED:case L.ACCOUNT_REMOVED:case L.ACTIVE_ACCOUNT_CHANGED:(a=this.broadcastChannel)==null||a.postMessage(o);break;default:this.invokeCallbacks(o);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],i)=>{(r.length===0||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${i}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class dl{constructor(e,t,r,i,o,a,c,l,d){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.platformAuthProvider=l,this.correlationId=d||dt(),this.logger=i.clone(Ke.MSAL_SKU,Gt,this.correlationId),this.performanceClient=c}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return ee.getAbsoluteUrl(t,wt())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Rr(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(m.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,a=r!=null&&r.length?r==="true":this.config.auth.instanceAware,c=t&&a?this.config.auth.authority.replace(ee.getDomainFromUrl(o),t.environment):o,l=Me.generateAuthority(c,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),d=await _(dc,m.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!d.isAlias(t.environment))throw ue(Ha);return d}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Li(n,e,t,r){t.addQueueMeasurement(m.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,o=[...n&&n.scopes||[]],a={...n,correlationId:n.correlationId,authority:i,scopes:o};if(!a.authenticationScheme)a.authenticationScheme=ne.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(a.authenticationScheme===ne.SSH){if(!n.sshJwk)throw ue(Us);if(!n.sshKid)throw ue(Da)}r.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!Qe.isEmptyObj(n.claims)&&(a.requestedClaimsHash=await rl(n.claims)),a}async function kg(n,e,t,r,i){r.addQueueMeasurement(m.InitializeSilentRequest,n.correlationId);const o=await _(Li,m.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...o,account:e,forceRefresh:n.forceRefresh||!1}}function hl(n,e){let t;const r=n.httpMethod;if(e===ze.EAR){if(t=r||Ut.POST,t!==Ut.POST)throw ue(Fa)}else t=r||Ut.GET;if(n.authorizePostBodyParameters&&t!==Ut.POST)throw ue($a);return t}/*! @azure/msal-browser v4.23.0 2025-09-17 */class ur extends dl{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||dt(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=ee.getAbsoluteUrl(e.postLogoutRedirectUri,wt())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=ee.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,wt())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=ee.getAbsoluteUrl(wt(),wt())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(m.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await _(this.getClientConfiguration.bind(this),m.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new pc(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:a}=e;this.performanceClient.addQueueMeasurement(m.StandardInteractionClientGetClientConfiguration,this.correlationId);const c=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:a}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:c,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Ke.MSAL_SKU,version:Gt,cpu:I.EMPTY_STRING,os:I.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(m.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},o=dr.setRequestState(this.browserCrypto,e&&e.state||I.EMPTY_STRING,i),c={...await _(Li,m.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:o,nonce:e.nonce||dt(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l={...c,httpMethod:hl(c,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return l;const d=e.account||this.browserStorage.getActiveAccount(this.correlationId);return d&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${d.homeAccountId}`,this.correlationId),l.account=d),l}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Cg(n,e){if(!e)return null;try{return dr.parseRequestState(n,e).libraryState.meta}catch{throw R(ir)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Ar(n,e,t){const r=fs(n);if(!r)throw Ka(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),U(kc)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),U(vc));return r}function Sg(n,e,t){if(!n.state)throw U(ki);const r=Cg(e,n.state);if(!r)throw U(Cc);if(r.interactionType!==t)throw U(Sc)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class ul{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(m.HandleCodeResponse,t.correlationId);let r;try{r=gu(e,t.state)}catch(i){throw i instanceof Wt&&i.subError===jr?U(jr):i}return _(this.handleCodeResponseFromServer.bind(this),m.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(m.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await _(this.authModule.updateAuthority.bind(this.authModule),m.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const o=this.createCcsCredentials(t);o&&(this.authCodeRequest.ccsCredential=o)}return await _(this.authModule.acquireToken.bind(this.authModule),m.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:ot.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:ot.UPN}:null}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const _g="ContentError",gl="user_switch";/*! @azure/msal-browser v4.23.0 2025-09-17 */const Ag="USER_INTERACTION_REQUIRED",Ig="USER_CANCEL",Tg="NO_NETWORK",Ng="DISABLED",Eg="ACCOUNT_UNAVAILABLE",Rg="UX_NOT_ALLOWED";/*! @azure/msal-browser v4.23.0 2025-09-17 */const jg=-2147186943,Pg={[gl]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class mt extends ae{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,mt.prototype),this.name="NativeAuthError",this.ext=r}}function Xt(n){if(n.ext&&n.ext.status&&n.ext.status===Ng||n.ext&&n.ext.error&&n.ext.error===jg)return!0;switch(n.errorCode){case _g:return!0;default:return!1}}function Ns(n,e,t){if(t&&t.status)switch(t.status){case Eg:return _s(uc);case Ag:return new lt(n,e);case Ig:return U(jr);case Tg:return U(As);case Rg:return _s(pi)}return new mt(n,Pg[n]||e,t)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class ml extends ur{async acquireToken(e){this.performanceClient.addQueueMeasurement(m.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(oe.acquireTokenSilent_silentFlow),r=await _(this.getClientConfiguration.bind(this),m.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new du(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const a=(await _(i.acquireCachedToken.bind(i),m.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),a}catch(o){throw o instanceof $r&&o.errorCode===Ci&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),o}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t==null?void 0:t.account)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class hs extends dl{constructor(e,t,r,i,o,a,c,l,d,h,u,g){super(e,t,r,i,o,a,l,d,g),this.apiId=c,this.accountId=h,this.platformAuthProvider=d,this.nativeStorageManager=u,this.silentCacheClient=new ml(e,this.nativeStorageManager,r,i,o,a,l,d,g);const A=this.platformAuthProvider.getExtensionName();this.skus=Rr.makeExtraSkuString({libraryName:Ke.MSAL_SKU,libraryVersion:Gt,extensionName:A,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[_h]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(m.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const r=this.performanceClient.startMeasurement(m.NativeInteractionClientAcquireToken,this.correlationId),i=Ge(),o=this.initializeServerTelemetryManager(this.apiId);try{const a=await this.initializeNativeRequest(e);try{const l=await this.acquireTokensFromCache(this.accountId,a);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),l}catch(l){if(t===Le.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),r.end({success:!1,brokerErrorCode:"cache_request_failed"}),l;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const c=await this.platformAuthProvider.sendMessage(a);return await this.handleNativeResponse(c,a,i).then(l=>(r.end({success:!0,isNativeBroker:!0,requestId:l.requestId}),o.clearNativeBrokerErrorCode(),l)).catch(l=>{throw r.end({success:!1,errorCode:l.errorCode,subErrorCode:l.subError}),l})}catch(a){throw a instanceof mt&&o.setNativeBrokerErrorCode(a.errorCode),r.end({success:!1}),a}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:Ce.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),R(xn);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!r)throw R(xn);try{const i=this.createSilentCacheRequest(t,r),o=await this.silentCacheClient.acquireToken(i),a={...r,idTokenClaims:o==null?void 0:o.idTokenClaims,idToken:o==null?void 0:o.idToken};return{...o,account:a}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r);try{await this.platformAuthProvider.sendMessage(i)}catch(c){if(c instanceof mt&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(c.errorCode),Xt(c)))throw c}this.browserStorage.setTemporaryCache(be.NATIVE_REQUEST,JSON.stringify(i),!0);const o={apiId:oe.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...o}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(be.NATIVE_REQUEST));const a=Ge();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const c=await this.platformAuthProvider.sendMessage(o),l=await this.handleNativeResponse(c,o,a);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),l}catch(c){throw c}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var h,u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=lr(e.id_token,ct),o=this.createHomeAccountIdentifier(e,i),a=(h=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId))==null?void 0:h.homeAccountId;if((u=t.extraParameters)!=null&&u.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(o!==a&&e.account.id!==t.accountId)throw Ns(gl);const c=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=fi(this.browserStorage,c,o,ct,this.correlationId,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const d=await this.generateAuthenticationResult(e,t,i,l,c.canonicalAuthority,r);return await this.cacheAccount(l,this.correlationId),await this.cacheNativeTokens(e,t,o,i,e.access_token,d.tenantId,r),d}createHomeAccountIdentifier(e,t){return rt.generateHomeAccountId(e.client_info||I.EMPTY_STRING,it.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?Ce.fromString(t):Ce.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===ne.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new or(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw R(zn);return r.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,r,i,o,a){const c=this.addTelemetryFromNativeResponse(e.properties.MATS),l=this.generateScopes(t.scope,e.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||I.EMPTY_STRING,u=d.TenantId||r.tid||I.EMPTY_STRING,g=Zn(i.getAccountInfo(),void 0,r,e.id_token);g.nativeAccountId!==e.account.id&&(g.nativeAccountId=e.account.id);const A=await this.generatePopAccessToken(e,t),E=t.tokenType===ne.POP?ne.POP:ne.BEARER;return{authority:o,uniqueId:h,tenantId:u,scopes:l.asArray(),account:g,idToken:e.id_token,idTokenClaims:r,accessToken:A,fromCache:c?this.isResponseFromCache(c):!1,expiresOn:rr(a+e.expires_in),tokenType:E,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e.getAccountInfo(),t)}cacheNativeTokens(e,t,r,i,o,a,c){const l=Bs(r,t.authority,e.id_token||"",t.clientId,i.tid||""),d=t.tokenType===ne.POP?I.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=c+d,u=this.generateScopes(e.scope,t.scope),g=Ks(r,t.authority,o,t.clientId,i.tid||a,u.printScopes(),h,0,ct,void 0,t.tokenType,void 0,t.keyId),A={idToken:l,accessToken:g};return this.nativeStorageManager.saveCacheRecord(A,this.correlationId,t.storeInCache)}getExpiresInValue(e,t){return e===ne.POP?I.SHR_NONCE_VALIDITY:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:r,...i}=e,o=new Ce(r||[]);o.appendScopes(cr);const a={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(a.signPopToken&&e.popKid)throw U(qc);if(this.handleExtraBrokerParams(a),a.extraParameters=a.extraParameters||{},a.extraParameters.telemetry=Ze.MATS_TELEMETRY,e.authenticationScheme===ne.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},l=new or(this.browserCrypto);let d;if(a.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:a.keyId})),a.signPopToken=!1;else{const h=await _(l.generateCnf.bind(l),m.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(c,this.logger);d=h.reqCnfString,a.keyId=h.kid,a.signPopToken=!0}a.reqCnf=d}return this.addRequestSKUs(a),a}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new ee(t);return r.validateAsUri(),r}getPrompt(e){switch(this.apiId){case oe.ssoSilent:case oe.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Fe.NONE}if(!e){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e){case Fe.NONE:case Fe.CONSENT:case Fe.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),U(zc)}}handleExtraBrokerParams(e){var o;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(ws)&&e.extraParameters.hasOwnProperty(vs)&&e.extraParameters.hasOwnProperty(Kt);if(!e.embeddedClientId&&!t)return;let r="";const i=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[vs],r=e.extraParameters[Kt]),e.extraParameters={child_client_id:r,child_redirect_uri:i},(o=this.performanceClient)==null||o.addFields({embeddedClientId:r,embeddedRedirectUri:i},this.correlationId)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Ui(n,e,t,r,i){const o=uu({...n.auth,authority:e},t,r,i);if(ci(o,{sku:Ke.MSAL_SKU,version:Gt,os:"",cpu:""}),n.auth.protocolMode!==ze.OIDC&&li(o,n.telemetry.application),t.platformBroker&&(Nh(o),i.addFields({isPlatformAuthorizeRequest:!0},t.correlationId),t.authenticationScheme===ne.POP)){const a=new Ct(r,i),c=new or(a);let l;t.popKid?l=a.encodeKid(t.popKid):l=(await _(c.generateCnf.bind(c),m.PopTokenGenerateCnf,r,i,t.correlationId)(t,r)).reqCnfString,hi(o,l)}return Hs(o,t.correlationId,i),o}async function Hi(n,e,t,r,i){if(!t.codeChallenge)throw ue(Qn);const o=await _(Ui,m.GetStandardParams,r,i,t.correlationId)(n,e,t,r,i);return ri(o,Ln.CODE),Za(o,t.codeChallenge,I.S256_CODE_CHALLENGE_METHOD),Rt(o,t.extraQueryParameters||{}),yi(e,o,n.auth.encodeExtraQueryParams,t.extraQueryParameters)}async function Fi(n,e,t,r,i,o){if(!r.earJwk)throw U(vi);const a=await Ui(e,t,r,i,o);ri(a,Ln.IDTOKEN_TOKEN_REFRESHTOKEN),Fh(a,r.earJwk);const c=new Map;Rt(c,r.extraQueryParameters||{});const l=yi(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return pl(n,l,a)}async function $i(n,e,t,r,i,o){const a=await Ui(e,t,r,i,o);ri(a,Ln.CODE),Za(a,r.codeChallenge,r.codeChallengeMethod||I.S256_CODE_CHALLENGE_METHOD),$h(a,r.authorizePostBodyParameters||{});const c=new Map;Rt(c,r.extraQueryParameters||{});const l=yi(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return pl(n,l,a)}function pl(n,e,t){const r=n.createElement("form");return r.method="post",r.action=e,t.forEach((i,o)=>{const a=n.createElement("input");a.hidden=!0,a.name=o,a.value=i,r.appendChild(a)}),n.body.appendChild(r),r}async function fl(n,e,t,r,i,o,a,c,l,d){if(c.verbose("Account id found, calling WAM for token"),!d)throw U(_i);const h=new Ct(c,l),u=new hs(r,i,h,c,a,r.system.navigationClient,t,l,d,e,o,n.correlationId),{userRequestState:g}=dr.parseRequestState(h,n.state);return _(u.acquireToken.bind(u),m.NativeInteractionClientAcquireToken,c,l,n.correlationId)({...n,state:g,prompt:void 0})}async function Es(n,e,t,r,i,o,a,c,l,d,h,u){if(gt.removeThrottle(a,i.auth.clientId,n),e.accountId)return _(fl,m.HandleResponsePlatformBroker,d,h,n.correlationId)(n,e.accountId,r,i,a,c,l,d,h,u);const g={...n,code:e.code||"",codeVerifier:t},A=new ul(o,a,g,d,h);return await _(A.handleCodeResponse.bind(A),m.HandleCodeResponse,d,h,n.correlationId)(e,n)}async function Bi(n,e,t,r,i,o,a,c,l,d,h){if(gt.removeThrottle(o,r.auth.clientId,n),fc(e,n.state),!e.ear_jwe)throw U(wc);if(!n.earJwk)throw U(vi);const u=JSON.parse(await _($u,m.DecryptEarResponse,l,d,n.correlationId)(n.earJwk,e.ear_jwe));if(u.accountId)return _(fl,m.HandleResponsePlatformBroker,l,d,n.correlationId)(n,u.accountId,t,r,o,a,c,l,d,h);const g=new zt(r.auth.clientId,o,new Ct(l,d),l,null,null,d);g.validateTokenResponse(u);const A={code:"",state:n.state,nonce:n.nonce,client_info:u.client_info,cloud_graph_host_name:u.cloud_graph_host_name,cloud_instance_host_name:u.cloud_instance_host_name,cloud_instance_name:u.cloud_instance_name,msgraph_host:u.msgraph_host};return await _(g.handleServerTokenResponse.bind(g),m.HandleServerTokenResponse,l,d,n.correlationId)(u,i,Ge(),n,A,void 0,void 0,void 0,void 0)}/*! @azure/msal-browser v4.23.0 2025-09-17 */const Og=32;async function Js(n,e,t){n.addQueueMeasurement(m.GeneratePkceCodes,t);const r=Ye(Mg,m.GenerateCodeVerifier,e,n,t)(n,e,t),i=await _(Dg,m.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:i}}function Mg(n,e,t){try{const r=new Uint8Array(Og);return Ye(Du,m.GetRandomValues,e,n,t)(r),Pt(r)}catch{throw U(wi)}}async function Dg(n,e,t,r){e.addQueueMeasurement(m.GenerateCodeChallengeFromVerifier,r);try{const i=await _(Zc,m.Sha256Digest,t,e,r)(n,e,r);return Pt(new Uint8Array(i))}catch{throw U(wi)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Rs{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(m.NativeMessageHandlerHandshake),this.platformAuthType=Ze.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:yr.GetToken,request:e},r={channel:Ze.CHANNEL_ID,extensionId:this.extensionId,responseId:dt(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(r)}`),this.messageChannel.port1.postMessage(r);const i=await new Promise((a,c)=>{this.resolvers.set(r.responseId,{resolve:a,reject:c})});return this.validatePlatformBrokerResponse(i)}static async createProvider(e,t,r){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const i=new Rs(e,t,r,Ze.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const o=new Rs(e,t,r);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Ze.CHANNEL_ID,extensionId:this.extensionId,responseId:dt(),body:{method:yr.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(U(Bc)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Ze.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===yr.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(U(Kc))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const o=t.body.method;if(o===yr.Response){if(!r)return;const a=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(a)}`),a.status!=="Success")r.reject(Ns(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?r.reject(Ns(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result);else throw pn(ms,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(o===yr.HandshakeResponse){if(!i){this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(o){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${o}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(o):i&&i.reject(o)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw pn(ms,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){var e;return this.getExtensionId()===Ze.PREFERRED_EXTENSION_ID?"chrome":(e=this.getExtensionId())!=null&&e.length?"unknown":void 0}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Ki{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=Ze.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,r){var i;if(e.trace("PlatformAuthDOMHandler: createProvider called"),(i=window.navigator)!=null&&i.platformAuthentication){const o=await window.navigator.platformAuthentication.getSupportedContracts(Ze.MICROSOFT_ENTRA_BROKERID);if(o!=null&&o.includes(Ze.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new Ki(e,t,r)}}getExtensionId(){return Ze.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return Ze.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r)}catch(t){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),t}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:r,authority:i,scope:o,redirectUri:a,correlationId:c,state:l,storeInCache:d,embeddedClientId:h,extraParameters:u,...g}=e,A=this.getDOMExtraParams(g);return{accountId:t,brokerId:this.getExtensionId(),authority:i,clientId:r,correlationId:c||this.correlationId,extraParameters:{...u,...A},isSecurityTokenService:!1,redirectUri:a,scope:o,state:l,storeInCache:d,embeddedClientId:h}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(t.isSuccess===!1&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),Ns(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw pn(ms,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((i,[o,a])=>(i[o]=String(a),i),{})}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Lg(n,e,t,r){n.trace("getPlatformAuthProvider called",t);const i=Ug();n.trace("Has client allowed platform auth via DOM API: "+i);let o;try{i&&(o=await Ki.createProvider(n,e,t)),o||(n.trace("Platform auth via DOM API not available, checking for extension"),o=await Rs.createProvider(n,r||cl,e))}catch(a){n.trace("Platform auth not available",a)}return o}function Ug(){let n;try{return n=window[Se.SessionStorage],(n==null?void 0:n.getItem(ng))==="true"}catch{return!1}}function Or(n,e,t,r){if(e.trace("isPlatformAuthAllowed called"),!n.system.allowPlatformBroker)return e.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!t)return e.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(r)switch(r){case ne.BEARER:case ne.POP:return e.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return e.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Hg extends ur{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,c,d,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l,this.eventHandler=o}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||cr,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t);{const o={...e,httpMethod:hl(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(o,r,t)}}catch(i){return Promise.reject(i)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("acquireTokenPopupAsync called");const i=await _(this.initializeAuthorizationRequest.bind(this),m.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,B.Popup);t.popup&&al(i.authority);const o=Or(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return i.platformBroker=o,this.config.auth.protocolMode===ze.EAR?this.executeEarFlow(i,t):this.executeCodeFlow(i,t,r)}async executeCodeFlow(e,t,r){var l;const i=e.correlationId,o=this.initializeServerTelemetryManager(oe.acquireTokenPopup),a=r||await _(Js,m.GeneratePkceCodes,this.logger,this.performanceClient,i)(this.performanceClient,this.logger,i),c={...e,codeChallenge:a.challenge};try{const d=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,i)({serverTelemetryManager:o,requestAuthority:c.authority,requestAzureCloudOptions:c.azureCloudOptions,requestExtraQueryParameters:c.extraQueryParameters,account:c.account});if(c.httpMethod===Ut.POST)return await this.executeCodeFlowWithPost(c,t,d,a.verifier);{const h=await _(Hi,m.GetAuthCodeUrl,this.logger,this.performanceClient,i)(this.config,d.authority,c,this.logger,this.performanceClient),u=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(L.POPUP_OPENED,B.Popup,{popupWindow:u},null);const g=await this.monitorPopupForHash(u,t.popupWindowParent),A=Ye(Ar,m.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await _(Es,m.HandleResponseCode,this.logger,this.performanceClient,i)(e,A,a.verifier,oe.acquireTokenPopup,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(d){throw(l=t.popup)==null||l.close(),d instanceof ae&&(d.setCorrelationId(this.correlationId),o.cacheFailedRequest(d)),d}}async executeEarFlow(e,t){const r=e.correlationId,i=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await _(Ei,m.GenerateEarKey,this.logger,this.performanceClient,r)(),a={...e,earJwk:o},c=t.popup||this.openPopup("about:blank",t);(await Fi(c.document,this.config,i,a,this.logger,this.performanceClient)).submit();const d=await _(this.monitorPopupForHash.bind(this),m.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,t.popupWindowParent),h=Ye(Ar,m.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return _(Bi,m.HandleResponseEar,this.logger,this.performanceClient,r)(a,h,oe.acquireTokenPopup,this.config,i,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,i){const o=e.correlationId,a=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),c=t.popup||this.openPopup("about:blank",t);(await $i(c.document,this.config,a,e,this.logger,this.performanceClient)).submit();const d=await _(this.monitorPopupForHash.bind(this),m.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(c,t.popupWindowParent),h=Ye(Ar,m.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return _(Es,m.HandleResponseCode,this.logger,this.performanceClient,o)(e,h,i,oe.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,i){var a,c,l;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(L.LOGOUT_START,B.Popup,e);const o=this.initializeServerTelemetryManager(oe.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const d=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r,account:e.account||void 0});try{d.authority.endSessionEndpoint}catch{if((a=e.account)!=null&&a.homeAccountId&&e.postLogoutRedirectUri&&d.authority.protocolMode===ze.OIDC){if(this.eventHandler.emitEvent(L.LOGOUT_SUCCESS,B.Popup,e),i){const g={apiId:oe.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},A=ee.getAbsoluteUrl(i,wt());await this.navigationClient.navigateInternal(A,g)}(c=t.popup)==null||c.close();return}}const h=d.getLogoutUri(e);this.eventHandler.emitEvent(L.LOGOUT_SUCCESS,B.Popup,e);const u=this.openPopup(h,t);if(this.eventHandler.emitEvent(L.POPUP_OPENED,B.Popup,{popupWindow:u},null),await this.monitorPopupForHash(u,t.popupWindowParent).catch(()=>{}),i){const g={apiId:oe.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},A=ee.getAbsoluteUrl(i,wt());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${A}`),await this.navigationClient.navigateInternal(A,g)}else this.logger.verbose("No main window navigation requested")}catch(d){throw(l=t.popup)==null||l.close(),d instanceof ae&&(d.setCorrelationId(this.correlationId),o.cacheFailedRequest(d)),this.eventHandler.emitEvent(L.LOGOUT_FAILURE,B.Popup,null,d),this.eventHandler.emitEvent(L.LOGOUT_END,B.Popup),d}this.eventHandler.emitEvent(L.LOGOUT_END,B.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),U(Vs)}monitorPopupForHash(e,t){return new Promise((r,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),i(U(jr));return}let a="";try{a=e.location.href}catch{}if(!a||a==="about:blank")return;clearInterval(o);let c="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===Ls.QUERY?c=e.location.search:c=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(c)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw U(Ic);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),U(Ac)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){var A,E,T,k;const o=i.screenLeft?i.screenLeft:i.screenX,a=i.screenTop?i.screenTop:i.screenY,c=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let d=(A=r.popupSize)==null?void 0:A.width,h=(E=r.popupSize)==null?void 0:E.height,u=(T=r.popupPosition)==null?void 0:T.top,g=(k=r.popupPosition)==null?void 0:k.left;return(!d||d<0||d>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),d=Ke.POPUP_WIDTH),(!h||h<0||h>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=Ke.POPUP_HEIGHT),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,l/2-Ke.POPUP_HEIGHT/2+a)),(!g||g<0||g>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),g=Math.max(0,c/2-Ke.POPUP_WIDTH/2+o)),i.open(e,t,`width=${d}, height=${h}, top=${u}, left=${g}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${Ke.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${Ke.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Fg(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const n=window.performance.getEntriesByType("navigation"),e=n.length?n[0]:void 0;return e==null?void 0:e.type}class $g extends ur{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,c,d,h),this.nativeStorage=l}async acquireToken(e){const t=await _(this.initializeAuthorizationRequest.bind(this),m.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,B.Redirect);t.platformBroker=Or(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const r=o=>{o.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(L.RESTORE_FROM_BFCACHE,B.Redirect))},i=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${i}`),this.browserStorage.setTemporaryCache(be.ORIGIN_URI,i,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===ze.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(o){throw o instanceof ae&&o.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),o}}async executeCodeFlow(e,t){const r=e.correlationId,i=this.initializeServerTelemetryManager(oe.acquireTokenRedirect),o=await _(Js,m.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),a={...e,codeChallenge:o.challenge};this.browserStorage.cacheAuthorizeRequest(a,o.verifier);try{if(a.httpMethod===Ut.POST)return await this.executeCodeFlowWithPost(a);{const c=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account}),l=await _(Hi,m.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,c.authority,a,this.logger,this.performanceClient);return await this.initiateAuthRequest(l,t)}}catch(c){throw c instanceof ae&&(c.setCorrelationId(this.correlationId),i.cacheFailedRequest(c)),c}}async executeEarFlow(e){const t=e.correlationId,r=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=await _(Ei,m.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:i};return this.browserStorage.cacheAuthorizeRequest(o),(await Fi(document,this.config,r,o,this.logger,this.performanceClient)).submit(),new Promise((c,l)=>{setTimeout(()=>{l(U(Is,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await $i(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((o,a)=>{setTimeout(()=>{a(U(Is,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,r,i){const o=this.initializeServerTelemetryManager(oe.handleRedirectPromise);try{const[a,c]=this.getRedirectResponse(e||"");if(!a)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),Fg()!=="back_forward"?i.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const l=this.browserStorage.getTemporaryCache(be.ORIGIN_URI,!0)||I.EMPTY_STRING,d=lo(l),h=lo(window.location.href);if(d===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&zu(l),await this.handleResponse(a,t,r,o);if(this.config.auth.navigateToLoginRequestUrl){if(!Pi()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(be.URL_HASH,c,!0);const u={apiId:oe.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let g=!0;if(!l||l==="null"){const A=qu();this.browserStorage.setTemporaryCache(be.ORIGIN_URI,A,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),g=await this.navigationClient.navigateInternal(A,u)}else this.logger.verbose(`Navigating to loginRequestUrl: ${l}`),g=await this.navigationClient.navigateInternal(l,u);if(!g)return await this.handleResponse(a,t,r,o)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(a,t,r,o);return null}catch(a){throw a instanceof ae&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Ls.QUERY?t=window.location.search:t=window.location.hash);let r=fs(t);if(r){try{Sg(r,this.browserCrypto,B.Redirect)}catch(o){return o instanceof ae&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return nl(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(be.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(be.URL_HASH)),i&&(r=fs(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t,r,i){if(!e.state)throw U(ki);if(e.ear_jwe){const c=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return _(Bi,m.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,oe.acquireTokenRedirect,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const a=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:t.authority});return _(Es,m.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,oe.acquireTokenRedirect,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:oe.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=t||this.config.auth.onRedirectNavigate;if(typeof i=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),i(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await this.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await this.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),U(Vs)}async logout(e){var i;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(oe.logout);try{this.eventHandler.emitEvent(L.LOGOUT_START,B.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const o={apiId:oe.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===ze.OIDC)try{a.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.eventHandler.emitEvent(L.LOGOUT_SUCCESS,B.Redirect,t);return}}const c=a.getLogoutUri(t);if(this.eventHandler.emitEvent(L.LOGOUT_SUCCESS,B.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(c)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,At.SIGNOUT),await this.navigationClient.navigateExternal(c,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,At.SIGNOUT),await this.navigationClient.navigateExternal(c,o);return}}catch(o){throw o instanceof ae&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(L.LOGOUT_FAILURE,B.Redirect,null,o),this.eventHandler.emitEvent(L.LOGOUT_END,B.Redirect),o}this.eventHandler.emitEvent(L.LOGOUT_END,B.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return ee.getAbsoluteUrl(t,wt())}}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function Bg(n,e,t,r,i){if(e.addQueueMeasurement(m.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),U(Vs);return i?_(Gg,m.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):Ye(qg,m.SilentHandlerLoadFrameSync,t,e,r)(n)}async function Kg(n,e,t,r,i){const o=Xs();if(!o.contentDocument)throw"No document associated with iframe!";return(await $i(o.contentDocument,n,e,t,r,i)).submit(),o}async function zg(n,e,t,r,i){const o=Xs();if(!o.contentDocument)throw"No document associated with iframe!";return(await Fi(o.contentDocument,n,e,t,r,i)).submit(),o}async function Fo(n,e,t,r,i,o,a){return r.addQueueMeasurement(m.SilentHandlerMonitorIframeForHash,o),new Promise((c,l)=>{e<An&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${An}ms). This may result in timeouts.`);const d=window.setTimeout(()=>{window.clearInterval(h),l(U(Tc))},e),h=window.setInterval(()=>{let u="";const g=n.contentWindow;try{u=g?g.location.href:""}catch{}if(!u||u==="about:blank")return;let A="";g&&(a===Ls.QUERY?A=g.location.search:A=g.location.hash),window.clearTimeout(d),window.clearInterval(h),c(A)},t)}).finally(()=>{Ye(Vg,m.RemoveHiddenIframe,i,r,o)(n)})}function Gg(n,e,t,r){return t.addQueueMeasurement(m.SilentHandlerLoadFrame,r),new Promise((i,o)=>{const a=Xs();window.setTimeout(()=>{if(!a){o("Unable to load iframe");return}a.src=n,i(a)},e)})}function qg(n){const e=Xs();return e.src=n,e}function Xs(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function Vg(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Wg extends ur{constructor(e,t,r,i,o,a,c,l,d,h,u){super(e,t,r,i,o,a,l,h,u),this.apiId=c,this.nativeStorage=d}async acquireToken(e){this.performanceClient.addQueueMeasurement(m.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Fe.NONE&&t.prompt!==Fe.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Fe.NONE}`),t.prompt=Fe.NONE):t.prompt=Fe.NONE;const r=await _(this.initializeAuthorizationRequest.bind(this),m.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,B.Silent);return r.platformBroker=Or(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),al(r.authority),this.config.auth.protocolMode===ze.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const r=this.initializeServerTelemetryManager(this.apiId);try{return t=await _(this.createAuthCodeClient.bind(this),m.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await _(this.silentTokenHelper.bind(this),m.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(i){if(i instanceof ae&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),!t||!(i instanceof ae)||i.errorCode!==Ke.INVALID_GRANT_ERROR)throw i;return this.performanceClient.addFields({retryError:i.errorCode},this.correlationId),await _(this.silentTokenHelper.bind(this),m.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,r=await _(this.getDiscoveredAuthority.bind(this),m.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=await _(Ei,m.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:i},a=await _(zg,m.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,o,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await _(Fo,m.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),d=Ye(Ar,m.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);return _(Bi,m.HandleResponseEar,this.logger,this.performanceClient,t)(o,d,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(U(Ws))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(m.SilentIframeClientTokenHelper,r);const i=await _(Js,m.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),o={...t,codeChallenge:i.challenge};let a;if(t.httpMethod===Ut.POST)a=await _(Kg,m.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);else{const h=await _(Hi,m.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);a=await _(Bg,m.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(h,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait)}const c=this.config.auth.OIDCOptions.serverResponseType,l=await _(Fo,m.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),d=Ye(Ar,m.DeserializeResponse,this.logger,this.performanceClient,r)(l,c,this.logger);return _(Es,m.HandleResponseCode,this.logger,this.performanceClient,r)(t,d,i.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Qg extends ur{async acquireToken(e){this.performanceClient.addQueueMeasurement(m.SilentRefreshClientAcquireToken,e.correlationId);const t=await _(Li,m.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(oe.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return _(o.acquireTokenByRefreshToken.bind(o),m.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(a=>{throw a.setCorrelationId(this.correlationId),i.cacheFailedRequest(a),a})}logout(){return Promise.reject(U(Ws))}async createRefreshTokenClient(e){const t=await _(this.getClientConfiguration.bind(this),m.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new lu(t,this.performanceClient)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Yg{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}async loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw U(Qs);const i=e.correlationId||dt(),o=t.id_token?lr(t.id_token,ct):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new Me(Me.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||dt()):void 0,l=await this.loadAccount(e,r.clientInfo||t.client_info||"",i,o,c),d=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,i),h=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,r,i),u=await this.loadRefreshToken(t,l.homeAccountId,l.environment,i);return this.generateAuthenticationResult(e,{account:l,idToken:d,accessToken:h,refreshToken:u},o,c)}async loadAccount(e,t,r,i,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const d=rt.createFromAccountInfo(e.account);return await this.storage.setAccount(d,r),d}else if(!o||!t&&!i)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),U(Lc);const a=rt.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,i),c=i==null?void 0:i.tid,l=fi(this.storage,o,a,ct,r,i,t,o.hostnameAndPort,c,void 0,void 0,this.logger);return await this.storage.setAccount(l,r),l}async loadIdToken(e,t,r,i,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=Bs(t,r,e.id_token,this.config.auth.clientId,i);return await this.storage.setIdTokenCredential(a,o),a}async loadAccessToken(e,t,r,i,o,a,c){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?Ce.fromString(t.scope):new Ce(e.scopes),d=a.expiresOn||t.expires_in+Ge(),h=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+Ge(),u=Ks(r,i,t.access_token,this.config.auth.clientId,o,l.printScopes(),d,h,ct);return await this.storage.setAccessTokenCredential(u,c),u}async loadRefreshToken(e,t,r,i){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=cc(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(o,i),o}generateAuthenticationResult(e,t,r,i){var h,u,g;let o="",a=[],c=null,l;t!=null&&t.accessToken&&(o=t.accessToken.secret,a=Ce.fromString(t.accessToken.target).asArray(),c=rr(t.accessToken.expiresOn),l=rr(t.accessToken.extendedExpiresOn));const d=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:d.getAccountInfo(),idToken:((h=t.idToken)==null?void 0:h.secret)||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((u=t.refreshToken)==null?void 0:u.familyId)||"",tokenType:((g=t==null?void 0:t.accessToken)==null?void 0:g.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Jg extends pc{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */class Xg extends ur{constructor(e,t,r,i,o,a,c,l,d,h){super(e,t,r,i,o,a,l,d,h),this.apiId=c}async acquireToken(e){if(!e.code)throw U(Uc);const t=await _(this.initializeAuthorizationRequest.bind(this),m.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,B.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},o=await _(this.getClientConfiguration.bind(this),m.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Jg(o);this.logger.verbose("Auth code client created");const c=new ul(a,this.browserStorage,i,this.logger,this.performanceClient);return await _(c.handleCodeResponseFromServer.bind(c),m.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof ae&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}logout(){return Promise.reject(U(Ws))}}/*! @azure/msal-browser v4.23.0 2025-09-17 */function Zg(n,e,t){var a;const r=((a=window.msal)==null?void 0:a.clientIds)||[],i=r.length,o=r.filter(c=>c===n).length;o>1&&t.warning("There is already an instance of MSAL.js in the window with the same client id."),e.add({msalInstanceCount:i,sameClientIdInstanceCount:o})}/*! @azure/msal-browser v4.23.0 2025-09-17 */function ht(n){const e=n==null?void 0:n.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function es(n,e){try{Oi(n)}catch(t){throw e.end({success:!1},t),t}}class Zs{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Ct(this.logger,this.performanceClient):ps,this.eventHandler=new vg(this.logger),this.browserStorage=this.isBrowserEnvironment?new En(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,eu(this.config.auth)):ug(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Se.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:Se.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new En(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new Yg(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new Zs(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(L.INITIALIZE_END);return}const r=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),i=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(m.InitializeClientApplication,r);if(this.eventHandler.emitEvent(L.INITIALIZE_START),!t)try{this.logMultipleInstances(o)}catch{}if(await _(this.browserStorage.initialize.bind(this.browserStorage),m.InitializeCache,this.logger,this.performanceClient,r)(r),i)try{this.platformAuthProvider=await Lg(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(a){this.logger.verbose(a)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),Ye(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),m.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(r)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(L.INITIALIZE_END),o.end({allowPlatformBroker:i,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),ol(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){var l;if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(((l=this.browserStorage.getInteractionInProgress())==null?void 0:l.type)===At.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),i=this.browserStorage.getCachedNativeRequest(),o=i&&this.platformAuthProvider&&!e;let a;this.eventHandler.emitEvent(L.HANDLE_REDIRECT_START,B.Redirect);let c;try{if(o&&this.platformAuthProvider){a=this.performanceClient.startMeasurement(m.AcquireTokenRedirect,(i==null?void 0:i.correlationId)||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a.add({isPlatformBrokerRequest:!0});const d=new hs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,oe.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,i.accountId,this.nativeInternalStorage,i.correlationId);c=_(d.handleRedirectPromise.bind(d),m.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(this.performanceClient,a.event.correlationId)}else{const[d,h]=this.browserStorage.getCachedRequest(),u=d.correlationId;a=this.performanceClient.startMeasurement(m.AcquireTokenRedirect,u),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const g=this.createRedirectClient(u);c=_(g.handleRedirectPromise.bind(g),m.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(e,d,h,a)}}catch(d){throw this.browserStorage.resetRequestCache(),d}return c.then(d=>(d?(this.browserStorage.resetRequestCache(),r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(L.LOGIN_SUCCESS,B.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_SUCCESS,B.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),a.end({success:!0,accountType:ht(d.account)})):a.event.errorCode?a.end({success:!1}):a.discard(),this.eventHandler.emitEvent(L.HANDLE_REDIRECT_END,B.Redirect),d)).catch(d=>{this.browserStorage.resetRequestCache();const h=d;throw r.length>0?this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_FAILURE,B.Redirect,null,h):this.eventHandler.emitEvent(L.LOGIN_FAILURE,B.Redirect,null,h),this.eventHandler.emitEvent(L.HANDLE_REDIRECT_END,B.Redirect),a.end({success:!1},h),d})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(m.AcquireTokenPreRedirect,t);r.add({accountType:ht(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=a=>{const c=typeof i=="function"?i(a):void 0;return r.add({navigateCallbackResult:c!==!1}),r.event=r.end({success:!0})||r.event,c};else{const a=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=c=>{const l=typeof a=="function"?a(c):void 0;return r.add({navigateCallbackResult:l!==!1}),r.event=r.end({success:!0})||r.event,l}}const o=this.getAllAccounts().length>0;try{Eo(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,At.SIGNIN),o?this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_START,B.Redirect,e):this.eventHandler.emitEvent(L.LOGIN_START,B.Redirect,e);let a;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?a=new hs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,oe.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(l=>{if(r.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof mt&&Xt(l))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof lt)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw l}):a=this.createRedirectClient(t).acquireToken(e),await a}catch(a){throw this.browserStorage.resetRequestCache(),r.event.status===2?this.performanceClient.startMeasurement(m.AcquireTokenRedirect,t).end({success:!1},a):r.end({success:!1},a),o?this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_FAILURE,B.Redirect,null,a):this.eventHandler.emitEvent(L.LOGIN_FAILURE,B.Redirect,null,a),a}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(m.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:ht(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),es(this.initialized,r),this.browserStorage.setInteractionInProgress(!0,At.SIGNIN)}catch(c){return Promise.reject(c)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_START,B.Popup,e):this.eventHandler.emitEvent(L.LOGIN_START,B.Popup,e);let o;const a=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?(r.add({isPlatformBrokerRequest:!0}),o=this.acquireTokenNative({...e,correlationId:t},oe.acquireTokenPopup).then(c=>(r.end({success:!0,accountType:ht(c.account)}),c)).catch(c=>{if(r.add({brokerErrorName:c.name,brokerErrorCode:c.errorCode}),c instanceof mt&&Xt(c))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,a);if(c instanceof lt)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,a);throw c})):o=this.createPopupClient(t).acquireToken(e,a),o.then(c=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(L.LOGIN_SUCCESS,B.Popup,c):this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_SUCCESS,B.Popup,c),r.end({success:!0,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:ht(c.account)}),c)).catch(c=>(i.length>0?this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_FAILURE,B.Popup,null,c):this.eventHandler.emitEvent(L.LOGIN_FAILURE,B.Popup,null,c),r.end({success:!1},c),Promise.reject(c))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var o,a,c;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(m.SsoSilent,t),(o=this.ssoSilentMeasurement)==null||o.add({scenarioId:e.scenarioId,accountType:ht(e.account)}),es(this.initialized,this.ssoSilentMeasurement),(a=this.ssoSilentMeasurement)==null||a.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(L.SSO_SILENT_START,B.Silent,r);let i;return this.canUsePlatformBroker(r)?((c=this.ssoSilentMeasurement)==null||c.add({isPlatformBrokerRequest:!0}),i=this.acquireTokenNative(r,oe.ssoSilent).catch(l=>{var d;if((d=this.ssoSilentMeasurement)==null||d.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof mt&&Xt(l))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw l})):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(l=>{var d;return this.eventHandler.emitEvent(L.SSO_SILENT_SUCCESS,B.Silent,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!0,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length,accountType:ht(l.account)}),l}).catch(l=>{var d;throw this.eventHandler.emitEvent(L.SSO_SILENT_FAILURE,B.Silent,null,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!1},l),l}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(m.AcquireTokenByCode,t);es(this.initialized,r),this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_BY_CODE_START,B.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw U(Fc);if(e.code){const i=e.code;let o=this.hybridAuthCodeResponses.get(i);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(a=>(this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_BY_CODE_SUCCESS,B.Silent,a),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:ht(a.account)}),a)).catch(a=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_BY_CODE_FAILURE,B.Silent,null,a),r.end({success:!1},a),a}),this.hybridAuthCodeResponses.set(i,o)),await o}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){r.add({isPlatformBrokerRequest:!0});const i=await this.acquireTokenNative({...e,correlationId:t},oe.acquireTokenByCode,e.nativeAccountId).catch(o=>{throw o instanceof mt&&Xt(o)&&(this.platformAuthProvider=void 0),r.add({brokerErrorName:o.name,brokerErrorCode:o.errorCode}),o});return r.end({accountType:ht(i.account),success:!0}),i}else throw U($c);else throw U(Hc)}catch(i){throw this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_BY_CODE_FAILURE,B.Silent,null,i),r.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(m.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>{var a;return(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!0,fromCache:o.fromCache}),o}).catch(o=>{var a;throw(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(m.AcquireTokenFromCache,e.correlationId),t){case Le.Default:case Le.AccessToken:case Le.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return _(r.acquireToken.bind(r),m.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw R(Et)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(m.AcquireTokenByRefreshToken,e.correlationId),t){case Le.Default:case Le.AccessTokenAndRefreshToken:case Le.RefreshToken:case Le.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return _(r.acquireToken.bind(r),m.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw R(Et)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(m.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return _(t.acquireToken.bind(t),m.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Eo(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,At.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Oi(this.initialized),this.browserStorage.setInteractionInProgress(!0,At.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return gg(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return mg(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return pg(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return fg(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return yg(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();xg(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return bg(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=rt.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,i){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw U(_i);return new hs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,i)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!Or(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Fe.NONE:case Fe.CONSENT:case Fe.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Hg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new $g(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new Wg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,oe.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new ml(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new Qg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new Xg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,oe.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return il(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Se.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Se.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?dt():I.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||_o})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||_o})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(m.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),es(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw U(jc);return r.add({accountType:ht(i)}),this.acquireTokenSilentDeduped(e,i,t).then(o=>(r.end({success:!0,fromCache:o.fromCache,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),{...o,state:e.state,correlationId:t})).catch(o=>{throw o instanceof ae&&o.setCorrelationId(t),r.end({success:!1},o),o})}async acquireTokenSilentDeduped(e,t,r){const i=zs(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),o=JSON.stringify(i),a=this.activeSilentTokenRequests.get(o);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);const c=_(this.acquireTokenSilentAsync.bind(this),m.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(o,c),c.finally(()=>{this.activeSilentTokenRequests.delete(o)})}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),a}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(m.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_START,B.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await _(kg,m.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||Le.Default;return this.acquireTokenSilentNoIframe(i,o).catch(async c=>{if(em(c,o))if(this.activeIframeRequest)if(o!==Le.Skip){const[d,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,i.correlationId);const u=this.performanceClient.startMeasurement(m.AwaitConcurrentIframe,i.correlationId);u.add({awaitIframeCorrelationId:h});const g=await d;if(u.end({success:g}),g)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,o);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),c}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),_(this.acquireTokenBySilentIframe.bind(this),m.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let d;return this.activeIframeRequest=[new Promise(h=>{d=h}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),_(this.acquireTokenBySilentIframe.bind(this),m.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(h=>(d(!0),h)).catch(h=>{throw d(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw c}).then(c=>(this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_SUCCESS,B.Silent,c),e.correlationId&&this.performanceClient.addFields({fromCache:c.fromCache},e.correlationId),c)).catch(c=>{throw this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_FAILURE,B.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return Or(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,oe.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async r=>{throw this.performanceClient.addFields({brokerErrorName:r.name,brokerErrorCode:r.errorCode},e.correlationId),r instanceof mt&&Xt(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,R(Et)):r})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===Le.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),_(this.acquireTokenFromCache.bind(this),m.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===Le.AccessToken)throw r;return this.eventHandler.emitEvent(L.ACQUIRE_TOKEN_NETWORK_START,B.Silent,e),_(this.acquireTokenByRefreshToken.bind(this),m.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await _(Js,m.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),Zg(t,e,this.logger)}}function em(n,e){const t=!(n instanceof lt&&n.subError!==qs),r=n.errorCode===Ke.INVALID_GRANT_ERROR||n.errorCode===Et,i=t&&r||n.errorCode===Ss||n.errorCode===mi,o=Nu.includes(e);return i&&o}/*! @azure/msal-browser v4.23.0 2025-09-17 */async function tm(n,e){const t=new qt(n);return await t.initialize(),Zs.createController(t,e)}/*! @azure/msal-browser v4.23.0 2025-09-17 */class zi{static async createPublicClientApplication(e){const t=await tm(e);return new zi(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new Zs(new qt(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}/*! @azure/msal-browser v4.23.0 2025-09-17 */const rm={initialize:()=>Promise.reject(xe(Ae)),acquireTokenPopup:()=>Promise.reject(xe(Ae)),acquireTokenRedirect:()=>Promise.reject(xe(Ae)),acquireTokenSilent:()=>Promise.reject(xe(Ae)),acquireTokenByCode:()=>Promise.reject(xe(Ae)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(xe(Ae)),loginPopup:()=>Promise.reject(xe(Ae)),loginRedirect:()=>Promise.reject(xe(Ae)),logout:()=>Promise.reject(xe(Ae)),logoutRedirect:()=>Promise.reject(xe(Ae)),logoutPopup:()=>Promise.reject(xe(Ae)),ssoSilent:()=>Promise.reject(xe(Ae)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw xe(Ae)},getLogger:()=>{throw xe(Ae)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw xe(Ae)},hydrateCache:()=>Promise.reject(xe(Ae)),clearCache:()=>Promise.reject(xe(Ae))};/*! @azure/msal-browser v4.23.0 2025-09-17 */class sm{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case L.LOGIN_START:return ge.Login;case L.SSO_SILENT_START:return ge.SsoSilent;case L.ACQUIRE_TOKEN_START:if(e.interactionType===B.Redirect||e.interactionType===B.Popup)return ge.AcquireToken;break;case L.HANDLE_REDIRECT_START:return ge.HandleRedirect;case L.LOGOUT_START:return ge.Logout;case L.SSO_SILENT_SUCCESS:case L.SSO_SILENT_FAILURE:if(t&&t!==ge.SsoSilent)break;return ge.None;case L.LOGOUT_END:if(t&&t!==ge.Logout)break;return ge.None;case L.HANDLE_REDIRECT_END:if(t&&t!==ge.HandleRedirect)break;return ge.None;case L.LOGIN_SUCCESS:case L.LOGIN_FAILURE:case L.ACQUIRE_TOKEN_SUCCESS:case L.ACQUIRE_TOKEN_FAILURE:case L.RESTORE_FROM_BFCACHE:if(e.interactionType===B.Redirect||e.interactionType===B.Popup){if(t&&t!==ge.Login&&t!==ge.AcquireToken)break;return ge.None}break}return null}}/*! @azure/msal-react v3.0.19 2025-08-19 */const nm={instance:rm,inProgress:ge.None,accounts:[],logger:new kt({})},Gi=p.createContext(nm);Gi.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */function yl(n,e){return typeof n=="function"?n(e):n}function $o(n,e){if(n.length!==e.length)return!1;const t=[...e];return n.every(r=>{const i=t.shift();return!r||!i?!1:r.homeAccountId===i.homeAccountId&&r.localAccountId===i.localAccountId&&r.username===i.username})}function xl(n,e){return n.length>0&&(e.homeAccountId||e.localAccountId||e.username)&&n.filter(r=>!(e.username&&e.username.toLowerCase()!==r.username.toLowerCase()||e.homeAccountId&&e.homeAccountId.toLowerCase()!==r.homeAccountId.toLowerCase()||e.localAccountId&&e.localAccountId.toLowerCase()!==r.localAccountId.toLowerCase()))[0]||null}/*! @azure/msal-react v3.0.19 2025-08-19 */const im="@azure/msal-react",Bo="3.0.19";/*! @azure/msal-react v3.0.19 2025-08-19 */const js={UNBLOCK_INPROGRESS:"UNBLOCK_INPROGRESS",EVENT:"EVENT"},om=(n,e)=>{const{type:t,payload:r}=e;let i=n.inProgress;switch(t){case js.UNBLOCK_INPROGRESS:n.inProgress===ge.Startup&&(i=ge.None,r.logger.info("MsalProvider - handleRedirectPromise resolved, setting inProgress to 'none'"));break;case js.EVENT:const a=r.message,c=sm.getInteractionStatusFromEvent(a,n.inProgress);c&&(r.logger.info(`MsalProvider - ${a.eventType} results in setting inProgress from ${n.inProgress} to ${c}`),i=c);break;default:throw new Error(`Unknown action type: ${t}`)}if(i===ge.Startup)return n;const o=r.instance.getAllAccounts();return i!==n.inProgress&&!$o(o,n.accounts)?{...n,inProgress:i,accounts:o}:i!==n.inProgress?{...n,inProgress:i}:$o(o,n.accounts)?n:{...n,accounts:o}};function am({instance:n,children:e}){p.useEffect(()=>{n.initializeWrapperLibrary(Au.React,Bo)},[n]);const t=p.useMemo(()=>n.getLogger().clone(im,Bo),[n]),[r,i]=p.useReducer(om,void 0,()=>({inProgress:ge.Startup,accounts:[]}));p.useEffect(()=>{const a=n.addEventCallback(c=>{i({payload:{instance:n,logger:t,message:c},type:js.EVENT})});return t.verbose(`MsalProvider - Registered event callback with id: ${a}`),n.initialize().then(()=>{n.handleRedirectPromise().catch(()=>{}).finally(()=>{i({payload:{instance:n,logger:t},type:js.UNBLOCK_INPROGRESS})})}).catch(()=>{}),()=>{a&&(t.verbose(`MsalProvider - Removing event callback ${a}`),n.removeEventCallback(a))}},[n,t]);const o={instance:n,inProgress:r.inProgress,accounts:r.accounts,logger:t};return Bt.createElement(Gi.Provider,{value:o},e)}/*! @azure/msal-react v3.0.19 2025-08-19 */const gr=()=>p.useContext(Gi);/*! @azure/msal-react v3.0.19 2025-08-19 */function cm(n,e){return e&&(e.username||e.homeAccountId||e.localAccountId)?!!xl(n,e):n.length>0}function qi(n){const{accounts:e,inProgress:t}=gr();return p.useMemo(()=>t===ge.Startup?!1:cm(e,n),[e,t,n])}/*! @azure/msal-react v3.0.19 2025-08-19 */function lm({username:n,homeAccountId:e,localAccountId:t,children:r}){const i=gr(),o=p.useMemo(()=>({username:n,homeAccountId:e,localAccountId:t}),[n,e,t]);return qi(o)&&i.inProgress!==ge.Startup?Bt.createElement(Bt.Fragment,null,yl(r,i)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function dm({username:n,homeAccountId:e,localAccountId:t,children:r}){const i=gr(),o=p.useMemo(()=>({username:n,homeAccountId:e,localAccountId:t}),[n,e,t]);return!qi(o)&&i.inProgress!==ge.Startup&&i.inProgress!==ge.HandleRedirect?Bt.createElement(Bt.Fragment,null,yl(r,i)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function Ko(n,e){return!e||!e.homeAccountId&&!e.localAccountId&&!e.username?n.getActiveAccount():xl(n.getAllAccounts(),e)}function hm(n){const{instance:e,inProgress:t,logger:r}=gr(),[i,o]=p.useState(()=>t===ge.Startup?null:Ko(e,n));return p.useEffect(()=>{t!==ge.Startup&&o(a=>{const c=Ko(e,n);return rt.accountInfoIsEqual(a,c,!0)?a:(r.info("useAccount - Updating account"),c)})},[t,n,e,r]),i}let ts;const um=new Uint8Array(16);function gm(){if(!ts&&(ts=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ts))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ts(um)}const Ee=[];for(let n=0;n<256;++n)Ee.push((n+256).toString(16).slice(1));function mm(n,e=0){return Ee[n[e+0]]+Ee[n[e+1]]+Ee[n[e+2]]+Ee[n[e+3]]+"-"+Ee[n[e+4]]+Ee[n[e+5]]+"-"+Ee[n[e+6]]+Ee[n[e+7]]+"-"+Ee[n[e+8]]+Ee[n[e+9]]+"-"+Ee[n[e+10]]+Ee[n[e+11]]+Ee[n[e+12]]+Ee[n[e+13]]+Ee[n[e+14]]+Ee[n[e+15]]}const pm=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zo={randomUUID:pm};function bl(n,e,t){if(zo.randomUUID&&!e&&!n)return zo.randomUUID();n=n||{};const r=n.random||(n.rng||gm)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let i=0;i<16;++i)e[t+i]=r[i];return e}return mm(r)}const sr={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!0},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},Ot={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},xr={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},Ir={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300};let Rn=null;const Go=n=>{Rn=n},vt=()=>{if(Rn)return Rn;let n=localStorage.getItem(Ot.USER_ID);return(!n||n.trim().length===0)&&(n=bl(),localStorage.setItem(Ot.USER_ID,n)),n},fm=n=>{if(!n||n.trim().length===0)throw new Error("User ID cannot be empty");localStorage.setItem(Ot.USER_ID,n.trim())},qo=()=>{const n=bl();return localStorage.setItem(Ot.USER_ID,n),n},ym=()=>localStorage.getItem("bh_user_id_custom")==="true",xm=n=>{localStorage.setItem("bh_user_id_custom",n.toString())},bm=()=>{const n=localStorage.getItem(Ot.THEME);return n==="light"||n==="dark"?n:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Vo=n=>{localStorage.setItem(Ot.THEME,n),n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},wm=()=>{const n=localStorage.getItem(Ot.PROCESSING_MODE);return n==="true"||n==="false"?n==="true":!1},vm=n=>{localStorage.setItem(Ot.PROCESSING_MODE,n.toString())},Mr=n=>{const e=new Date,t=new Date(n),r=e.getTime()-t.getTime(),i=Math.floor(r/(1e3*60)),o=Math.floor(r/(1e3*60*60)),a=Math.floor(r/(1e3*60*60*24));return i<1?"Just now":i<60?`${i}m ago`:o<24?`${o}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()},nr=n=>new Date(n).toLocaleString(),He=(n,e,t)=>({code:n,message:e,details:t,timestamp:new Date().toISOString()}),km=n=>n instanceof TypeError&&n.message.includes("fetch")?!0:n instanceof Error?n.message.includes("Network")||n.message.includes("connection")||n.message.includes("timeout"):!1,Re=(n,e="polite")=>{const t=document.createElement("div");t.setAttribute("aria-live",e),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=n,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)},Cm=(n,e=100)=>{setTimeout(()=>{const t=document.getElementById(n);t&&t.focus()},e)},wl=p.createContext(void 0),Sm=()=>{const n=p.useContext(wl);if(n===void 0)throw new Error("useTheme must be used within a ThemeProvider");return n},_m=({children:n})=>{const[e,t]=p.useState(bm),r=a=>{t(a),Vo(a)},i=()=>{r(e==="light"?"dark":"light")};p.useEffect(()=>{Vo(e)},[e]),p.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),c=l=>{localStorage.getItem("bh_theme")||t(l.matches?"dark":"light")};return a.addEventListener("change",c),()=>a.removeEventListener("change",c)},[]);const o={theme:e,toggleTheme:i,setTheme:r};return s.jsx(wl.Provider,{value:o,children:n})},Am={auth:{clientId:"63e9b3fd-de9d-4083-879c-9c13f3aac54d",authority:"https://login.microsoftonline.com/3d6eb90f-fb5d-4624-99d7-1b8c4e077d07",redirectUri:"http://localhost:5173",postLogoutRedirectUri:"http://localhost:5173"},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(n,e,t)=>{if(!t)switch(n){case 0:console.error("[MSAL Error]:",e);break;case 1:console.warn("[MSAL Warning]:",e);break;case 2:console.info("[MSAL Info]:",e);break;case 3:console.debug("[MSAL Verbose]:",e);break}}}}},Im={scopes:["openid","profile","email","User.Read"]},Tm={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},se={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},xt={APP_ROLES:"roles",GROUPS:"groups"},Nm="User",vl=p.createContext(void 0),Br=()=>{const n=p.useContext(vl);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},Em=n=>{const e=n.idTokenClaims,t=[];if(e!=null&&e[xt.APP_ROLES]){const r=Array.isArray(e[xt.APP_ROLES])?e[xt.APP_ROLES]:[e[xt.APP_ROLES]];t.push(...r)}return e!=null&&e[xt.GROUPS]&&(Array.isArray(e[xt.GROUPS])?e[xt.GROUPS]:[e[xt.GROUPS]]).forEach(i=>{i==={}.VITE_AZURE_AD_ADMIN_GROUP_ID?t.push(se.ADMIN):i==={}.VITE_AZURE_AD_CONTROL_PANEL_GROUP_ID&&t.push(se.CONTROL_PANEL)}),[...new Set(t)]},Rm=n=>n.includes(se.ADMIN)?se.ADMIN:n.includes(se.CONTROL_PANEL)?se.CONTROL_PANEL:Nm,jm=n=>{if(!n)return null;const e=Em(n),t=Rm(e),r=n.idTokenClaims;return{id:n.localAccountId||n.homeAccountId,email:n.username,name:n.name||n.username,roles:e,primaryRole:t,groups:(r==null?void 0:r[xt.GROUPS])||[],preferredUsername:r==null?void 0:r.preferred_username,tenantId:n.tenantId}},Pm=({children:n})=>{const{instance:e,accounts:t,inProgress:r}=gr(),i=hm(t[0]||{}),o=qi(),[a,c]=p.useState(null),[l,d]=p.useState(!0),[h,u]=p.useState(null);p.useEffect(()=>{const M=jm(i);c(M),Go(M?M.id:null)},[i]),p.useEffect(()=>{d(r!==ge.None)},[r]),p.useEffect(()=>{const M=e.addEventCallback(D=>{var C,y;switch(D.eventType){case L.LOGIN_SUCCESS:console.log("[Auth] Login successful"),u(null);break;case L.LOGIN_FAILURE:console.error("[Auth] Login failed:",D.error),u(((C=D.error)==null?void 0:C.message)||"Login failed");break;case L.LOGOUT_SUCCESS:console.log("[Auth] Logout successful"),c(null),u(null);break;case L.ACQUIRE_TOKEN_SUCCESS:console.log("[Auth] Token acquired successfully"),u(null);break;case L.ACQUIRE_TOKEN_FAILURE:console.error("[Auth] Token acquisition failed:",D.error),u(((y=D.error)==null?void 0:y.message)||"Token acquisition failed");break}});return()=>{M&&e.removeEventCallback(M)}},[e]);const g=async M=>{try{u(null),d(!0);const D={...Im,...M};await e.loginPopup(D)}catch(D){throw console.error("[Auth] Login error:",D),u(D.message||"Login failed"),D}finally{d(!1)}},A=async M=>{try{u(null),d(!0);const D={account:i||void 0,...M};await e.logoutPopup(D)}catch(D){throw console.error("[Auth] Logout error:",D),u(D.message||"Logout failed"),D}finally{d(!1)}},E=()=>{u(null)},T=M=>(a==null?void 0:a.roles.includes(M))??!1,k=M=>M.some(D=>T(D)),G={user:a,isAuthenticated:o,isLoading:l,error:h,login:g,logout:A,clearError:E,hasRole:T,hasAnyRole:k,isAdmin:()=>T(se.ADMIN),canAccessControlPanel:()=>k([se.ADMIN,se.CONTROL_PANEL])};return s.jsx(vl.Provider,{value:G,children:n})},Om=()=>{const{login:n,isLoading:e,error:t}=Br(),r=()=>{n().catch(console.error)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:s.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:""})}),s.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),s.jsxs("div",{className:"space-y-4",children:[t&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:s.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t})}),s.jsx("button",{onClick:r,disabled:e,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e?s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),s.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),s.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),s.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),s.jsx("div",{className:"text-center",children:s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},Wo=({children:n,fallback:e,redirectTo:t})=>{const r=Ds();return s.jsxs(s.Fragment,{children:[s.jsx(lm,{children:n}),s.jsx(dm,{children:e||(t?s.jsx(aa,{to:t,state:{from:r},replace:!0}):s.jsx(Om,{}))})]})},Mm=({children:n,roles:e,requireAll:t=!1,fallback:r,redirectTo:i})=>{const{hasRole:o,hasAnyRole:a,user:c}=Br(),l=Ds();return(t?e.every(h=>o(h)):a(e))?s.jsx(s.Fragment,{children:n}):r?s.jsx(s.Fragment,{children:r}):i?s.jsx(aa,{to:i,state:{from:l},replace:!0}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[s.jsx("div",{className:"text-6xl mb-4",children:""}),s.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",e.length>1?"s":"",": ",e.join(", ")]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",c!=null&&c.roles.length&&c.roles.length>1?"s":"",": ",(c==null?void 0:c.roles.join(", "))||"None"]})]})]})})},St=({children:n,requireAuth:e=!0,requireRoles:t=[],requireAll:r=!1,fallback:i,redirectTo:o})=>!e&&t.length===0?s.jsx(s.Fragment,{children:n}):e&&t.length===0?s.jsx(Wo,{fallback:i,redirectTo:o,children:n}):s.jsx(Wo,{fallback:i,redirectTo:o,children:s.jsx(Mm,{roles:t,requireAll:r,fallback:i,redirectTo:o,children:n})}),Dm=()=>{const n=Dn(),e=Ds(),{user:t,isAuthenticated:r,isLoading:i,hasRole:o}=Br();return p.useEffect(()=>{if(i||!r||!t||e.pathname!=="/")return;let a="/";o(se.CONTROL_PANEL)&&!o(se.ADMIN)?a="/summary":(o(se.ADMIN),a="/"),a!==e.pathname&&n(a,{replace:!0})},[t,r,i,e.pathname,n,o]),null};class Lm{constructor(e,t){Y(this,"msalInstance");Y(this,"accounts");this.msalInstance=e,this.accounts=t}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...Tm,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(e){return console.warn("Failed to acquire access token silently:",e),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const e=this.accounts[0];return{userId:e.homeAccountId,username:e.username,name:e.name}}}const Um=()=>{const{instance:n,accounts:e}=gr();return new Lm(n,e)};class Hm{constructor(e,t){Y(this,"baseUrl");Y(this,"authProvider");this.baseUrl=e,this.authProvider=t}setAuthProvider(e){this.authProvider=e}async handleResponse(e){if(!e.ok){const t=await e.json().catch(()=>({}));throw He(`HTTP_${e.status}`,t.message||`HTTP ${e.status}: ${e.statusText}`,{status:e.status,statusText:e.statusText,data:t})}return e.json()}async request(e,t={}){try{const r=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,i=e.startsWith("/")?e:`/${e}`,o=`${r}${i}`,a={"Content-Type":"application/json",...t.headers};if(this.authProvider)try{const l=await this.authProvider.getAuthHeaders();Object.assign(a,l)}catch(l){console.warn("Failed to get authentication headers:",l)}const c=await fetch(o,{...t,headers:a});return this.handleResponse(c)}catch(r){throw km(r)?He("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:r}):r instanceof Error&&"code"in r?r:He("UNKNOWN_ERROR","An unexpected error occurred",{originalError:r})}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}const Be=new Hm(sr.api.baseUrl),Fm=n=>{Be.setAuthProvider(n)},we={async checkHealth(){return Be.get(xr.HEALTH)},async initiateSession(n){return Be.post(xr.SESSIONS_INITIATE,n)},async submitPrediction(n){return Be.post(xr.PREDICTIONS_SUBMIT,n)},async getPredictionBySessionId(n){return Be.get(`${xr.PREDICTIONS_BY_SESSION}/${n}`)},async getUserPredictions(n){return Be.get(`${xr.PREDICTIONS_BY_USER}/${n}`)},async saveSessionData(n){return Be.post("sessions",n)},async getSessionData(n){return Be.get(`sessions/${n}`)},async getUserSessions(n){return Be.get(`sessions/users/${n}`)},async getAllSessions(){return Be.get("sessions/all")},async updateSessionData(n,e){return Be.put(`sessions/${n}`,e)},async deleteSessionData(n){return Be.delete(`sessions/${n}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(n){return{success:!1,message:n.message||"Connection test failed"}}},async generateRiskAssessment(n){return Be.post(`sessions/${n}/risk-assessment`)},async getRiskAssessment(n){return Be.get(`sessions/${n}/risk-assessment`)}};class Qo{constructor(e,t={}){Y(this,"sessionId");Y(this,"intervalMs");Y(this,"maxAttempts");Y(this,"backoffFactor");Y(this,"currentAttempt",0);Y(this,"timeoutId",null);Y(this,"isPolling",!1);this.sessionId=e,this.intervalMs=t.intervalMs||sr.polling.intervalMs,this.maxAttempts=t.maxAttempts||sr.polling.maxAttempts,this.backoffFactor=t.backoffFactor||sr.polling.backoffFactor}async start(e,t,r){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const i=async()=>{try{const o=await we.getPredictionBySessionId(this.sessionId);if(e(o),o.status==="succeeded"||o.status==="success"||o.status==="failed"){this.stop(),t(o);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),r(He("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const a=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(i,a)}catch(o){this.stop(),r(o)}};await i()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const $m=({children:n})=>{const e=Um();return p.useEffect(()=>{Fm(e)},[e]),s.jsx(s.Fragment,{children:n})},kl=()=>{const n=p.useCallback((r,i="polite")=>{Re(r,i)},[]),e=p.useCallback(r=>{n(r,"assertive")},[n]),t=p.useCallback(r=>{n(r,"polite")},[n]);return{announce:n,announceError:e,announceSuccess:t}},Cl=()=>{const n=p.useCallback(t=>{const r=i=>{i.key==="Escape"&&(i.preventDefault(),t())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),e=p.useCallback(t=>r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),t())},[]);return{handleEscape:n,handleEnterSpace:e}},Bm=()=>({skipToMain:p.useCallback(()=>{Cm(Ir.SKIP_TO_CONTENT_ID,Ir.FOCUS_TIMEOUT)},[])}),Km=({className:n=""})=>{const{theme:e,toggleTheme:t}=Sm(),{user:r,logout:i,isAuthenticated:o,isAdmin:a}=Br(),c=Ds(),{handleEnterSpace:l}=Cl(),[d,h]=p.useState(!1),[u,g]=p.useState(!1),A=()=>{const j=[{path:"/",label:"Dashboard",icon:"",roles:[se.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"",roles:[se.ADMIN]},{path:"/sessions",label:"Sessions",icon:"",roles:[se.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"",roles:[se.ADMIN]},{path:"/summary",label:"Summary",icon:"",roles:[se.ADMIN]},{path:"/agent-experience",label:"Agent Experience",icon:"",roles:[se.ADMIN]}];return o?j.filter(()=>!!a()):[]};p.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:o,user:r?{id:r.id,name:r.name,roles:r.roles}:null,timestamp:new Date().toISOString()})},[o,r]);const E=A(),T=j=>j==="/"?c.pathname==="/":c.pathname.startsWith(j),k=()=>{h(!d)},P=()=>{h(!1)};return p.useEffect(()=>{h(!1),g(!1)},[c.pathname]),p.useEffect(()=>{const j=G=>{const M=G.target;u&&!M.closest("[data-user-menu]")&&g(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[u]),s.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${n}`,children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsxs("div",{className:"flex justify-between items-center h-16",children:[s.jsx("div",{className:"flex items-center",children:s.jsxs(Te,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[s.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:""}),s.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),s.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),s.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:E.map(({path:j,label:G,icon:M})=>s.jsxs(Te,{to:j,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${T(j)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":T(j)?"page":void 0,children:[s.jsx("span",{role:"img","aria-hidden":"true",children:M}),s.jsx("span",{children:G})]},j))}),s.jsxs("div",{className:"flex items-center space-x-4",children:[o&&r&&s.jsxs("div",{className:"relative","data-user-menu":!0,children:[s.jsxs("button",{onClick:()=>g(!u),onKeyDown:l(()=>g(!u)),className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                    transition-colors touch-target\r
                  `,"aria-label":"User menu",type:"button",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:r.name.charAt(0).toUpperCase()}),s.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900 dark:text-white",children:r.name}),s.jsx("svg",{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),u&&s.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:r.name.charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.email})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:r.primaryRole}),r.roles.length>1&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["+",r.roles.length-1," more"]})]})]}),s.jsx("div",{className:"py-1",children:s.jsx("button",{onClick:()=>{i(),g(!1)},className:`\r
                          w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r
                          hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r
                        `,children:"Sign out"})})]})]}),s.jsx("button",{onClick:t,onKeyDown:l(t),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${e==="light"?"dark":"light"} mode`,type:"button",children:s.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:e==="light"?"":""})}),o&&s.jsx("button",{onClick:k,onKeyDown:l(k),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":d?"Close mobile menu":"Open mobile menu",type:"button",...d?{"aria-expanded":!0}:{"aria-expanded":!1},children:s.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:d?"":""})})]})]}),d&&o&&s.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:s.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:E.map(({path:j,label:G,icon:M})=>s.jsxs(Te,{to:j,onClick:P,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${T(j)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":T(j)?"page":void 0,children:[s.jsx("span",{role:"img","aria-hidden":"true",children:M}),s.jsx("span",{children:G})]},j))})})]})})},zm=({size:n=20,className:e="",...t})=>s.jsxs("svg",{width:n,height:n,viewBox:"0 0 23 23",className:e,"aria-label":"Microsoft",...t,children:[s.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),s.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),s.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),s.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),Gm=({children:n,className:e=""})=>{const{skipToMain:t}=Bm();return s.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[s.jsx("a",{href:`#${Ir.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:r=>{r.preventDefault(),t()},children:"Skip to main content"}),s.jsx(Km,{}),s.jsx("main",{id:Ir.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${e}`,tabIndex:-1,children:n}),s.jsx("div",{id:Ir.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),s.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(zm,{size:24,className:"opacity-80"}),s.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),s.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[s.jsxs("p",{children:["Behavioral Health System  ",new Date().getFullYear()]}),s.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant  Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qm=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Vm=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),Yo=n=>{const e=Vm(n);return e.charAt(0).toUpperCase()+e.slice(1)},Sl=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),Wm=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ym=p.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:a,...c},l)=>p.createElement("svg",{ref:l,...Qm,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Sl("lucide",i),...!o&&!Wm(c)&&{"aria-hidden":"true"},...c},[...a.map(([d,h])=>p.createElement(d,h)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=(n,e)=>{const t=p.forwardRef(({className:r,...i},o)=>p.createElement(Ym,{ref:o,iconNode:e,className:Sl(`lucide-${qm(Yo(n))}`,`lucide-${n}`,r),...i}));return t.displayName=Yo(n),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jm=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Dr=z("activity",Jm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xm=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Zm=z("arrow-left",Xm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],It=z("brain",ep);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],_l=z("calendar",tp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rp=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Jo=z("chart-column",rp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],np=z("chart-pie",sp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Al=z("chevron-down",ip);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Il=z("chevron-up",op);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],et=z("circle-alert",ap);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],tt=z("circle-check-big",cp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ps=z("circle-x",lp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dp=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Mt=z("clock",dp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Os=z("download",hp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],gp=z("eye-off",up);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mp=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Lr=z("eye",mp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pp=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],fp=z("file-audio",pp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yp=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],xp=z("file-text",yp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bp=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],wp=z("file",bp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vp=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],kp=z("files",vp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cp=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Tl=z("funnel",Cp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Vi=z("heart",Sp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _p=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],jn=z("info",_p);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ap=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],Ip=z("languages",Ap);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tp=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Np=z("lightbulb",Tp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ep=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Rp=z("loader-circle",Ep);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jp=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Pp=z("mic-off",jp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Nl=z("mic",Op);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mp=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Pn=z("pause",Mp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Zt=z("play",Dp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Xo=z("plus",Lp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],_e=z("refresh-cw",Up);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Fp=z("search",Hp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $p=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Bp=z("send",$p);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kp=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],El=z("settings",Kp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zp=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],On=z("shield-alert",zp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Rl=z("target",Gp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qp=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Tr=z("trash-2",qp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vp=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],jl=z("trending-down",Vp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wp=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],en=z("trending-up",Wp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Pl=z("triangle-alert",Qp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yp=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Jp=z("upload",Yp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Zo=z("user",Xp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ol=z("users",Zp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ur=z("volume-2",ef);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tf=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],rf=z("volume-x",tf);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],rs=z("x",sf),Ml={health:["health"],userPredictions:n=>["predictions","user",n],sessionPrediction:n=>["predictions","session",n],userSessions:n=>["sessions","user",n]},Dl=()=>oa({queryKey:Ml.health,queryFn:()=>we.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),nf=n=>{const e=n||vt();return oa({queryKey:Ml.userSessions(e),queryFn:()=>we.getUserSessions(e),enabled:!!e,staleTime:3e4,refetchOnWindowFocus:!1})},of=()=>{const n=vt(),{announce:e}=kl(),{canAccessControlPanel:t}=Br(),{data:r,isLoading:i,error:o}=Dl(),{data:a,isLoading:c}=nf(n);p.useEffect(()=>{e("Dashboard page loaded","polite")},[e]);const l=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"",color:"warning",disabled:!0}],d=(h,u=!1)=>{const g=u?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(h){case"primary":return`${g} border-primary-200 bg-primary-50 ${!u&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!u&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${g} border-secondary-200 bg-secondary-50 ${!u&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!u&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${g} border-accent-200 bg-accent-50 ${!u&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!u&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${g} border-warning-200 bg-warning-50 ${!u&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!u&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${g} border-gray-200 bg-gray-50 ${!u&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!u&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),s.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:l.map(h=>h.disabled?s.jsxs("div",{className:`${d(h.color,!0)} relative`,"aria-label":`${h.title}: Coming Soon`,children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:h.icon}),s.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:h.title}),s.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:h.description})]}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-white font-bold text-sm mb-1",children:""}),s.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},h.href):s.jsx(Te,{to:h.href,className:d(h.color,!1),"aria-label":`${h.title}: ${h.description}`,children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:h.icon}),s.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:h.title}),s.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:h.description})]})},h.href))})]}),t()&&s.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:" Summary"}),s.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),s.jsx(Te,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),s.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"Patient User ID"}),s.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-md",children:s.jsx("code",{className:"text-sm font-mono text-text-primary-light dark:text-text-primary-dark break-all",children:n})}),s.jsx("p",{className:"mt-2 text-sm text-text-muted-light dark:text-text-muted-dark",children:"This ID is automatically generated and stored locally to track your sessions."})]}),s.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),c?s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"spinner w-4 h-4"}),s.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(a!=null&&a.sessions)||a.sessions.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:""}),s.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",s.jsx(Te,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):s.jsxs("div",{className:"space-y-3",children:[a.sessions.slice(0,3).map(h=>{var u,g;return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`status-${h.status||"completed"}`,children:h.status||"completed"}),s.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:h.audioFileName||((u=h.sessionId)==null?void 0:u.slice(0,8))||"Unknown"}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:h.createdAt,children:h.createdAt?new Date(h.createdAt).toLocaleString():""})]}),s.jsx(Te,{to:`/sessions/${h.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${h.audioFileName||((g=h.sessionId)==null?void 0:g.slice(0,8))||"Unknown"}`,children:s.jsx(Lr,{className:"w-4 h-4","aria-hidden":"true"})})]},h.sessionId)}),a.sessions.length>3&&s.jsx("div",{className:"text-center pt-3",children:s.jsxs(Te,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",a.sessions.length," sessions "]})})]})]}),s.jsxs("div",{className:"card",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),s.jsx(Te,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),i?s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"spinner w-4 h-4"}),s.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):o?s.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[s.jsx("span",{role:"img","aria-label":"Error",children:""}),s.jsx("span",{children:"System health check failed"})]}):s.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[s.jsx("span",{role:"img","aria-label":"Healthy",children:""}),s.jsx("span",{children:"All systems operational"}),(r==null?void 0:r.checks)&&s.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(r.checks).length," services checked)"]})]})]})]})};class af{constructor(){Y(this,"ffmpeg",null);Y(this,"isLoaded",!1);Y(this,"loadingPromise",null);this.ffmpeg=new od}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw He("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await eo(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await eo(`${e}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(e){throw this.loadingPromise=null,He("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:e})}}async convertAudio(e,t={outputFormat:"wav",sampleRate:44100,channels:1},r){try{if(r==null||r({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw He("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:h})=>{r==null||r({stage:"converting",progress:Math.round(h*100),message:`Converting audio... ${Math.round(h*100)}%`})}),r==null||r({stage:"converting",progress:0,message:"Preparing audio file..."});const i="input."+this.getFileExtension(e.name);await this.ffmpeg.writeFile(i,await ad(e));const o=`output.${t.outputFormat}`,a=["-i",i,"-ac",t.channels.toString(),"-ar",t.sampleRate.toString(),"-f",t.outputFormat,o];await this.ffmpeg.exec(a);const c=await this.ffmpeg.readFile(o),l=new Blob([c],{type:`audio/${t.outputFormat}`}),d=new File([l],`${this.getFileNameWithoutExtension(e.name)}.${t.outputFormat}`,{type:`audio/${t.outputFormat}`});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(o),r==null||r({stage:"completed",progress:100,message:"Audio conversion completed"}),d}catch(i){throw He("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:i,fileName:e.name,fileSize:e.size,fileType:e.type})}}getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1).toLowerCase():""}getFileNameWithoutExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(0,t):e}async isFormatSupported(e){try{await this.loadFFmpeg();const t=["wav","mp3","mp4","m4a","aac","flac","ogg"],r=this.getFileExtension(e.name);return t.includes(r)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let ln=null;const cf=()=>(ln||(ln=new af),ln),dn=async(n,e)=>{const r=await cf().convertAudio(n,{outputFormat:"wav",sampleRate:44100,channels:1},e?i=>e(i.progress):void 0);return new Blob([r],{type:"audio/wav"})};class lf{constructor(e){Y(this,"containerClient",null);Y(this,"sasUrl");if(this.sasUrl=e||sr.azure.blobSasUrl,!this.sasUrl)throw He("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const e=new cd(this.sasUrl);this.containerClient=e.getContainerClient(sr.azure.containerName)}catch(e){throw He("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:e})}return this.containerClient}async uploadFile(e,t,r,i){try{r==null||r({progress:0,stage:"preparing",message:"Preparing upload..."});const o=this.getContainerClient(),a=t||this.generateBlobName(e.name,i),c=o.getBlockBlobClient(a);r==null||r({progress:10,stage:"uploading",message:"Starting upload..."}),await c.uploadData(e,{blobHTTPHeaders:{blobContentType:e.type},onProgress:d=>{const h=d.loadedBytes&&e.size?Math.round(d.loadedBytes/e.size*90)+10:50;r==null||r({progress:h,stage:"uploading",message:`Uploading... ${h}%`})}});const l=c.url;return r==null||r({progress:100,stage:"completed",message:"Upload completed"}),{url:l,fileName:a,size:e.size}}catch(o){throw He("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:o,fileName:e.name,fileSize:e.size})}}generateBlobName(e,t){const r=t||vt(),i=new Date().toISOString().replace(/[:.]/g,"-"),o=Math.random().toString(36).substring(2,8),a=e.split(".").pop()||"wav";return`users/${r}/audio/${i}-${o}.${a}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(e){try{await this.getContainerClient().getBlockBlobClient(e).deleteIfExists()}catch(t){throw He("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:t,fileName:e})}}async listUserFiles(e){try{const t=e||vt(),r=this.getContainerClient(),i=`users/${t}/`,o=[];for await(const a of r.listBlobsFlat({prefix:i}))o.push(a.name);return o}catch(t){throw He("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:t,userId:e})}}async deleteUserData(e){try{const t=e||vt(),r=await this.listUserFiles(t);let i=0;for(const o of r)await this.deleteFile(o),i++;return i}catch(t){throw He("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:t,userId:e})}}async getUserStorageUsage(e){try{const t=e||vt(),r=this.getContainerClient(),i=`users/${t}/`;let o=0,a=0;for await(const c of r.listBlobsFlat({prefix:i}))o++,a+=c.properties.contentLength||0;return{fileCount:o,totalSizeBytes:a}}catch(t){throw He("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:t,userId:e})}}}let ss=null;const df=n=>((!ss||n&&n!==ss.sasUrl)&&(ss=new lf(n)),ss),hn=async(n,e,t,r)=>{const i=df(),o=n instanceof File?n:new File([n],e,{type:n.type});return(await i.uploadFile(o,e,t?c=>t(c.progress):void 0,r)).url},mr=()=>{const n=p.useRef(null),e=p.useCallback(c=>{if(!n.current){const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),l.style.position="absolute",l.style.left="-10000px",l.style.width="1px",l.style.height="1px",l.style.overflow="hidden",document.body.appendChild(l),n.current=l}n.current.textContent="",setTimeout(()=>{n.current&&(n.current.textContent=c)},100)},[]),t={focusById:c=>{const l=document.getElementById(c);l&&l.focus()},focusFirstInContainer:c=>{const d=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d&&d.focus()},trapFocus:c=>{const l=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),d=l[0],h=l[l.length-1],u=g=>{g.key==="Tab"&&(g.shiftKey?document.activeElement===d&&(h.focus(),g.preventDefault()):document.activeElement===h&&(d.focus(),g.preventDefault()))};return c.addEventListener("keydown",u),()=>{c.removeEventListener("keydown",u)}}},r={handleArrowNavigation:(c,l,d,h)=>{var g;let u=d;switch(c.key){case"ArrowDown":c.preventDefault(),u=d<l.length-1?d+1:0;break;case"ArrowUp":c.preventDefault(),u=d>0?d-1:l.length-1;break;case"Home":c.preventDefault(),u=0;break;case"End":c.preventDefault(),u=l.length-1;break;default:return}h(u),(g=l[u])==null||g.focus()},handleEscape:(c,l)=>{c.key==="Escape"&&(c.preventDefault(),l())}},i=p.useCallback((c="element")=>`${c}-${Math.random().toString(36).substr(2,9)}`,[]),o=p.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),a=p.useCallback((c,l,d)=>{const h={};return c||(h["aria-invalid"]="true",l&&d&&(h["aria-describedby"]=d)),h},[]);return{announceToScreenReader:e,focusManagement:t,keyboardNavigation:r,generateId:i,prefersReducedMotion:o,getValidationAttributes:a}},hf=()=>{const[n,e]=p.useState([]),[t,r]=p.useState(()=>wm()),[i,o]=p.useState({}),[a,c]=p.useState({}),[l,d]=p.useState({}),[h,u]=p.useState(!1),[g,A]=p.useState(null),[E,T]=p.useState({stage:"idle",progress:0,message:""}),[k,P]=p.useState(null),[j,G]=p.useState(!1),[M,D]=p.useState(0),[C,y]=p.useState(null),[f,x]=p.useState({age:"",gender:"",race:"",ethnicity:"",language:"",weight:"",zipcode:"",sessionNotes:""}),[w,v]=p.useState(null),[H,Q]=p.useState([]),[ce,st]=p.useState(()=>ym()),[fe,Pe]=p.useState(""),[X,le]=p.useState(null),$=vt(),ye=p.useRef(null),Je=p.useRef(null),{announceToScreenReader:ie}=mr(),te=p.useCallback((b,N,O)=>{const F=Date.now().toString()+Math.random().toString(36).substr(2,9),q={id:F,type:b,title:N,message:O,timestamp:Date.now()};Q(de=>[...de,q]),setTimeout(()=>{Q(de=>de.filter(Oe=>Oe.id!==F))},b==="error"?8e3:5e3)},[]),Kr=p.useCallback(b=>{Q(N=>N.filter(O=>O.id!==b))},[]),Dt=p.useCallback(()=>{e([]),A(null),T({stage:"idle",progress:0,message:""}),P(null),c({}),o({}),v(null),G(!1),D(0),y(null),u(!1)},[]),pr=p.useCallback(()=>{st(b=>{const N=!b;if(xm(N),le(null),N)Pe($),ie("Switched to custom User ID mode");else{Pe("");const O=qo();ie(`Switched to auto-generated mode. New User ID: ${O}`)}return N})},[$,ie]),Hl=p.useCallback(b=>{Pe(b),le(null)},[]),Fl=p.useCallback(()=>{const b=fe.trim();if(!b){le("User ID cannot be empty");return}if(b.length<3){le("User ID must be at least 3 characters long");return}if(b.length>100){le("User ID must be less than 100 characters");return}if(/[<>"/\\|?*\x00-\x1f]/.test(b)){le('User ID contains invalid characters. Please avoid special characters like < > " / \\ | ? *');return}try{fm(b),le(null),ie(`Custom User ID applied: ${b}`),window.location.reload()}catch(O){const F=O instanceof Error?O.message:"Failed to set User ID";le(F)}},[fe,ie]),$l=p.useCallback(()=>{const b=qo();ie(`New User ID generated: ${b}`),window.location.reload()},[ie]),Bl=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),Ji=p.useCallback(b=>{const N=Bl(),O=URL.createObjectURL(b),F={id:N,file:b,url:O};t?(e(K=>[...K,F]),d(K=>({...K,[N]:"ready"})),o(K=>({...K,[N]:{stage:"idle",progress:0,message:"Ready to process"}}))):A(F),ie(`Audio file selected: ${b.name}`);const q=new Audio(O);q.addEventListener("loadedmetadata",()=>{t?e(K=>K.map(de=>de.id===N?{...de,duration:q.duration}:de)):A(K=>K?{...K,duration:q.duration}:null)})},[t,ie]),Kl=p.useCallback(b=>{t&&(e(N=>{const O=N.find(F=>F.id===b);return O&&URL.revokeObjectURL(O.url),N.filter(F=>F.id!==b)}),o(N=>{const{[b]:O,...F}=N;return F}),c(N=>{const{[b]:O,...F}=N;return F}),d(N=>{const{[b]:O,...F}=N;return F}))},[t]),zr=p.useCallback(b=>{const N=b.target.files;!N||N.length===0||Array.from(N).forEach(O=>{const F=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],q=O.name.toLowerCase(),de=[".wav",".mp3",".m4a",".aac",".flac"].some(nt=>q.endsWith(nt));if(!F.includes(O.type)&&!de){v(`Unsupported file type for ${O.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),te("error","Unsupported File",`${O.name} is not a supported audio file format`),ie(`Error: Unsupported file format selected for ${O.name}`);return}const Xe=50*1024*1024;if(O.size>Xe){v(`File ${O.name} is too large. File size must be less than 50MB`),te("error","File Too Large",`${O.name} size must be less than 50MB`),ie(`Error: File ${O.name} is too large`);return}Ji(O),v(null)})},[ie,Ji,te]),zl=p.useCallback(b=>{b.preventDefault()},[]),Gl=p.useCallback(b=>{b.preventDefault();const N=b.dataTransfer.files;N.length>0&&zr({target:{files:N}})},[zr]),ql=p.useCallback(()=>{r(b=>{const N=!b;return vm(N),Dt(),N})},[Dt]),Vl=p.useCallback(()=>{ye.current&&(j?(ye.current.pause(),G(!1),ie("Audio paused")):(ye.current.play(),G(!0),ie("Audio playing")))},[j,ie]),Wl=p.useCallback(()=>{ye.current&&D(ye.current.currentTime)},[]),Gr=p.useCallback(b=>{const N=Math.floor(b/60),O=Math.floor(b%60);return`${N}:${O.toString().padStart(2,"0")}`},[]),Qt=p.useCallback(()=>{const b=[];if(f.age){const N=parseInt(f.age);(isNaN(N)||N<18||N>130)&&b.push("Age must be between 18 and 130")}if(f.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(f.gender)||b.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),f.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(f.race)||b.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),f.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(f.ethnicity)||b.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),f.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(f.zipcode)||b.push("Zipcode must be alphanumeric and contain no more than 10 characters")),f.weight){const N=parseInt(f.weight);(isNaN(N)||N<10||N>1e3)&&b.push("Weight must be between 10 and 1000 pounds (lbs)")}return b},[f]),qr=p.useCallback(()=>{const b={};let N=!1;return f.age&&(b.age=parseInt(f.age),N=!0),f.gender&&(b.gender=f.gender,N=!0),f.race&&(b.race=f.race,N=!0),f.ethnicity&&(b.ethnicity=f.ethnicity,N=!0),(f.language==="true"||f.language==="false")&&(b.language=f.language==="true",N=!0),f.weight&&(b.weight=parseInt(f.weight),N=!0),f.zipcode&&(b.zipcode=f.zipcode,N=!0),N?b:void 0},[f]),Ql=p.useCallback(async()=>{if(t){if(n.length===0||!$.trim()){v("Please select audio files. User ID is automatically generated."),te("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await Xi()}else{if(!g||!$.trim()){v("Please select an audio file. User ID is automatically generated."),te("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await Jl()}},[g,n,$,t]),Vr=p.useCallback(async(b,N)=>{try{o(he=>({...he,[b]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const O=qr(),F={userid:$.trim(),is_initiated:!0};O&&(F.metadata=O);const q=await we.initiateSession(F),K={sessionId:q.sessionId,userId:$.trim()};o(he=>({...he,[b]:{stage:"initiating",progress:10,message:"Saving session data..."}}));const de={sessionId:q.sessionId,userId:$.trim(),userMetadata:O,audioFileName:N.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await we.saveSessionData(de)}catch{}o(he=>({...he,[b]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const Oe=await dn(N.file,he=>{o(J=>({...J,[b]:{stage:"converting",progress:15+he*.25,message:`Converting audio... ${Math.round(he)}%`}}))});o(he=>({...he,[b]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}}));const Xe=`${$}_${K.sessionId}_${Date.now()}.wav`,nt=await hn(Oe,Xe,he=>{o(J=>({...J,[b]:{stage:"uploading",progress:40+he*.25,message:`Uploading... ${Math.round(he)}%`}}))});o(he=>({...he,[b]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const he={...de,audioUrl:nt,audioFileName:Xe,status:"processing",updatedAt:new Date().toISOString()};await we.updateSessionData(K.sessionId,he)}catch(he){console.warn("Failed to update session data with audio info:",he)}await we.submitPrediction({userId:$.trim(),sessionid:K.sessionId,audioFileUrl:nt,audioFileName:Xe}),o(he=>({...he,[b]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const $e=new Qo(K.sessionId);await new Promise((he,J)=>{$e.start(re=>{const fr=re.status==="processing"?80:re.status==="success"?95:70;o(pt=>({...pt,[b]:{stage:"analyzing",progress:fr,message:`Analysis ${re.status}...`}})),re.predictError&&te("error","Prediction Error",`${re.predictError.error}: ${re.predictError.message}`)},re=>{if(re.predictError){te("error","Analysis Failed",`The analysis completed with an error: ${re.predictError.error} - ${re.predictError.message}`),o(pt=>({...pt,[b]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),J(new Error(`Prediction error: ${re.predictError.error}`));return}const fr={sessionId:K.sessionId,depressionScore:re.predictedScoreDepression?parseFloat(re.predictedScoreDepression):0,riskLevel:re.predictedScoreDepression&&parseFloat(re.predictedScoreDepression)>.7?"high":re.predictedScoreDepression&&parseFloat(re.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",re.predictedScoreDepression?`Depression score: ${re.predictedScoreDepression}`:"",re.predictedScoreAnxiety?`Anxiety score: ${re.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(pt=>pt.trim()!==""),timestamp:re.updatedAt,audioUrl:nt,rawApiResponse:re};o(pt=>({...pt,[b]:{stage:"complete",progress:100,message:"Analysis complete!"}})),c(pt=>({...pt,[b]:fr})),he()},re=>{J(re)})})}catch(O){console.error(`Error processing file ${b}:`,O);let F="UNKNOWN_ERROR",q="An unexpected error occurred",K={};O&&typeof O=="object"?("code"in O&&typeof O.code=="string"&&(F=O.code),"message"in O&&typeof O.message=="string"&&(q=O.message),"details"in O&&typeof O.details=="object"&&(K=O.details)):O instanceof Error&&(q=O.message,F=O.name||"ERROR");try{const de=i[b];if(de&&(de.stage==="uploading"||de.stage==="submitting"||de.stage==="analyzing")){const Oe=`${$}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${Oe}`)}}catch(de){console.warn("Error during cleanup attempt:",de)}throw o(de=>({...de,[b]:{stage:"error",progress:0,message:"Processing failed",error:{code:F,message:q,details:K}}})),O}},[$,qr,we,hn,dn,te]),Xi=p.useCallback(async()=>{u(!0),v(null);const b=Qt();if(b.length>0){v(`Validation error: ${b.join(", ")}`),te("error","Validation Error",b.join(", ")),u(!1);return}const N=n.filter(q=>l[q.id]==="ready");if(N.length===0){te("info","No Files Ready","No files are ready to process"),u(!1);return}const O=N.length;let F=0;try{for(const q of N){F++,te("info","Processing File",`Processing ${q.file.name} (${F}/${O})`),d(K=>({...K,[q.id]:"processing"}));try{await Vr(q.id,q),d(K=>({...K,[q.id]:"complete"})),te("success","File Complete",`${q.file.name} processed successfully`)}catch(K){let de="FILE_PROCESSING_ERROR",Oe="An unexpected error occurred",Xe={};K&&typeof K=="object"?("code"in K&&typeof K.code=="string"&&(de=K.code),"message"in K&&typeof K.message=="string"&&(Oe=K.message),"details"in K&&typeof K.details=="object"&&(Xe=K.details)):K instanceof Error&&(Oe=K.message,de=K.name||"ERROR"),te("error","File Failed",`Failed to process ${q.file.name}: ${Oe}`),d(nt=>({...nt,[q.id]:"error"})),o(nt=>({...nt,[q.id]:{stage:"error",progress:0,message:`Failed: ${Oe}`,error:{code:de,message:Oe,details:Xe}}}))}}te("success","Batch Complete",`Processed ${F} file${F!==1?"s":""}`),ie(`Batch processing complete. ${F} files processed.`)}catch(q){const K=q instanceof Error?q.message:"An unexpected error occurred";v(K),te("error","Batch Failed",K),ie(`Error: ${K}`)}finally{u(!1)}},[n,l,Qt,te,ie,Vr]),Yl=p.useCallback(async b=>{const N=n.find(F=>F.id===b);if(!N)return;const O=Qt();if(O.length>0){v(`Validation error: ${O.join(", ")}`),te("error","Validation Error",O.join(", "));return}d(F=>({...F,[b]:"processing"}));try{await Vr(b,N),d(F=>({...F,[b]:"complete"})),te("success","File Complete",`${N.file.name} processed successfully`)}catch(F){console.error(`Error processing ${N.file.name}:`,F);const q=F instanceof Error?F.message:"An unexpected error occurred";te("error","File Failed",`Failed to process ${N.file.name}: ${q}`),d(K=>({...K,[b]:"error"})),o(K=>({...K,[b]:{stage:"error",progress:0,message:`Failed: ${q}`}}))}},[n,Qt,te,Vr]),Jl=p.useCallback(async()=>{if(!g||!$.trim()){v("Please select an audio file. User ID is automatically generated."),te("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const b=Qt();if(b.length>0){v(`Validation error: ${b.join(", ")}`),te("error","Validation Error",b.join(", "));return}try{v(null),T({stage:"initiating",progress:5,message:"Initiating session..."}),ie("Starting analysis process - initiating session");const N=qr(),O={userid:$.trim(),is_initiated:!0};N&&(O.metadata=N);const F=await we.initiateSession(O),q={sessionId:F.sessionId,userId:$.trim()};T({stage:"initiating",progress:10,message:"Saving session data..."});const K={sessionId:F.sessionId,userId:$.trim(),userMetadata:N,audioFileName:g.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await we.saveSessionData(K)}catch{}T({stage:"converting",progress:15,message:"Converting audio to required format..."}),ie("Session created successfully, now converting audio");const de=await dn(g.file,$e=>{T({stage:"converting",progress:15+$e*.25,message:`Converting audio... ${Math.round($e)}%`})});T({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),ie("Audio converted successfully, now uploading");const Oe=`${$}_${q.sessionId}_${Date.now()}.wav`,Xe=await hn(de,Oe,$e=>{T({stage:"uploading",progress:40+$e*.25,message:`Uploading... ${Math.round($e)}%`})});T({stage:"submitting",progress:65,message:"Submitting for analysis..."}),ie("Upload complete, submitting for behavioral health analysis");try{const $e={...K,audioUrl:Xe,audioFileName:Oe,status:"processing",updatedAt:new Date().toISOString()};await we.updateSessionData(q.sessionId,$e)}catch($e){console.warn("Failed to update session data with audio info:",$e)}await we.submitPrediction({userId:$.trim(),sessionid:q.sessionId,audioFileUrl:Xe,audioFileName:Oe}),T({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),ie("Prediction submitted, analysis in progress");const nt=new Qo(q.sessionId);await new Promise(($e,he)=>{nt.start(J=>{const re=J.status==="processing"?80:J.status==="success"?95:70;T({stage:"analyzing",progress:re,message:`Analysis ${J.status}...`}),J.predictError&&te("error","Prediction Error",`${J.predictError.error}: ${J.predictError.message}`)},J=>{if(J.predictError){te("error","Analysis Failed",`The analysis completed with an error: ${J.predictError.error} - ${J.predictError.message}`),T({stage:"error",progress:0,message:"Analysis failed with errors"}),he(new Error(`Prediction error: ${J.predictError.error}`));return}const re={sessionId:q.sessionId,depressionScore:J.predictedScoreDepression?parseFloat(J.predictedScoreDepression):0,riskLevel:J.predictedScoreDepression&&parseFloat(J.predictedScoreDepression)>.7?"high":J.predictedScoreDepression&&parseFloat(J.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",J.predictedScoreDepression?`Depression score: ${J.predictedScoreDepression}`:"",J.predictedScoreAnxiety?`Anxiety score: ${J.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(fr=>fr.trim()!==""),timestamp:J.updatedAt,audioUrl:Xe,rawApiResponse:J};T({stage:"complete",progress:100,message:"Analysis complete!"}),P(re),te("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),ie("Behavioral health analysis completed successfully"),$e()},J=>{te("error","Analysis Error",J.message||"An unexpected error occurred during analysis."),he(J)})})}catch(N){console.error("Processing error:",N);const O=N instanceof Error?N.message:"An unexpected error occurred";v(O),T({stage:"error",progress:0,message:"Processing failed"}),te("error","Processing Failed",O),ie(`Error: ${O}`)}},[g,$,ie,Qt,qr]),Zi=p.useCallback(b=>{switch(b){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return s.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"flex justify-between items-center mb-6",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),s.jsxs("div",{className:"relative inline-flex items-center",children:[s.jsx("button",{type:"button",onClick:ql,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${t?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${t?"single file":"multi-file"} mode`,children:s.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${t?"translate-x-9":"translate-x-1"}`,children:t?s.jsx(kp,{className:"h-3 w-3 text-blue-600"}):s.jsx(wp,{className:"h-3 w-3 text-gray-600"})})}),s.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[s.jsx("span",{className:`text-sm font-medium ${t?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),s.jsx("span",{className:`text-sm font-medium ${t?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),s.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${t?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:t?s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",t?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),s.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${t?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:t?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),s.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"md:col-span-2 lg:col-span-3 mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"User ID Management"}),s.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md border space-y-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current User ID:"}),s.jsx("code",{className:"text-sm font-mono text-gray-900 dark:text-gray-100 break-all block bg-white dark:bg-gray-800 p-2 rounded border",children:$})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",onClick:pr,className:"px-3 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors","aria-describedby":"user-id-mode-help",children:ce?"Switch to Auto-Generated":"Use Custom User ID"}),!ce&&s.jsx("button",{type:"button",onClick:$l,className:"px-3 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800 transition-colors",title:"Generate a new random User ID",children:"Generate New ID"})]}),ce&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:fe,onChange:b=>Hl(b.target.value),placeholder:"Enter custom User ID (any unique string)",className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-describedby":"custom-user-id-help","aria-invalid":X?"true":"false"}),s.jsx("button",{type:"button",onClick:Fl,disabled:!fe.trim(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Apply"})]}),X&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",role:"alert",children:X}),s.jsx("p",{id:"custom-user-id-help",className:"text-xs text-gray-500 dark:text-gray-400",children:'Any unique string (3-100 characters). Examples: "patient-001", "john.doe@clinic", "study-participant-42"'})]}),s.jsx("p",{id:"user-id-mode-help",className:"text-xs text-gray-500 dark:text-gray-400",children:ce?"Custom mode: Use any unique identifier for tracking (e.g., patient ID, username, study code)":"Auto mode: System generates unique UUIDs automatically"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age (Optional)"}),s.jsx("input",{type:"number",id:"age",value:f.age,onChange:b=>x(N=>({...N,age:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Age in years",min:"1",max:"150"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight (Optional)"}),s.jsx("input",{type:"number",id:"weight",value:f.weight,onChange:b=>x(N=>({...N,weight:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Weight in lbs",min:"1",max:"1000"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender (Optional)"}),s.jsxs("select",{id:"gender",value:f.gender,onChange:b=>x(N=>({...N,gender:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select gender"}),s.jsx("option",{value:"male",children:"Male"}),s.jsx("option",{value:"female",children:"Female"}),s.jsx("option",{value:"non-binary",children:"Non-binary"}),s.jsx("option",{value:"transgender female",children:"Transgender female"}),s.jsx("option",{value:"transgender male",children:"Transgender male"}),s.jsx("option",{value:"other",children:"Other"}),s.jsx("option",{value:"prefer",children:"Prefer"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race (Optional)"}),s.jsxs("select",{id:"race",value:f.race,onChange:b=>x(N=>({...N,race:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select race"}),s.jsx("option",{value:"white",children:"White"}),s.jsx("option",{value:"black or african-american",children:"Black or African-American"}),s.jsx("option",{value:"asian",children:"Asian"}),s.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),s.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),s.jsx("option",{value:"two or more races",children:"Two or more races"}),s.jsx("option",{value:"other",children:"Other"}),s.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity (Optional)"}),s.jsxs("select",{id:"ethnicity",value:f.ethnicity,onChange:b=>x(N=>({...N,ethnicity:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select ethnicity"}),s.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),s.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language (Optional)"}),s.jsxs("select",{id:"language",value:f.language,onChange:b=>x(N=>({...N,language:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Select language"}),s.jsx("option",{value:"true",children:"English"}),s.jsx("option",{value:"false",children:"Other"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code (Optional)"}),s.jsx("input",{type:"text",id:"zipcode",value:f.zipcode,onChange:b=>x(N=>({...N,zipcode:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)"})]}),s.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[s.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes (Optional)"}),s.jsx("textarea",{id:"sessionNotes",value:f.sessionNotes,onChange:b=>x(N=>({...N,sessionNotes:b.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Additional notes about this session or patient context"})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",t&&s.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!t&&!g||t&&n.length===0?s.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:zl,onDrop:Gl,children:[s.jsx(Jp,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("button",{type:"button",onClick:()=>{var b;return(b=Je.current)==null?void 0:b.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[s.jsx(Xo,{className:"h-4 w-4 mr-2"}),"Select Audio File",t?"s":""]}),s.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",t?"files":"file"," here"]})]}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",t&&s.jsx("br",{}),t&&"You can select multiple files at once"]}),s.jsx("input",{ref:Je,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:zr,multiple:t,"aria-label":`Select audio file${t?"s":""} for analysis`})]}):s.jsxs("div",{className:"space-y-4",children:[!t&&g&&s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(Ur,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:g.file.name}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(g.file.size/1024/1024).toFixed(2)," MB",g.duration&&`  ${Gr(g.duration)}`]})]})]}),s.jsx("button",{type:"button",onClick:Dt,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:s.jsx(rs,{className:"h-5 w-5"})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:Vl,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":j?"Pause audio":"Play audio",children:j?s.jsx(Pn,{className:"h-5 w-5","aria-hidden":"true"}):s.jsx(Zt,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),s.jsx("div",{className:"flex-1",children:g.duration&&s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Gr(M)," / ",Gr(g.duration)]})})]}),g.duration&&s.jsx("div",{className:"audio-progress",children:s.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${M/g.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":M,"aria-valuemin":0,"aria-valuemax":g.duration})})]}),s.jsx("audio",{ref:ye,src:g.url,onTimeUpdate:Wl,onEnded:()=>G(!1),onPlay:()=>G(!0),onPause:()=>G(!1),className:"hidden"})]}),t&&n.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",n.length,")"]}),s.jsxs("button",{type:"button",onClick:()=>{var b;return(b=Je.current)==null?void 0:b.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[s.jsx(Xo,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(b=>{const N=l[b.id]||"ready",O=i[b.id];return s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[s.jsx(Ur,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:b.file.name}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(b.file.size/1024/1024).toFixed(2)," MB",b.duration&&`  ${Gr(b.duration)}`]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[N==="ready"&&s.jsxs("button",{type:"button",onClick:()=>Yl(b.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${b.file.name}`,children:[s.jsx(Zt,{className:"h-3 w-3 mr-1"}),"Start"]}),N==="processing"&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),N==="complete"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[s.jsx(tt,{className:"h-3 w-3 mr-1"}),"Complete"]}),N==="error"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[s.jsx(rs,{className:"h-3 w-3 mr-1"}),"Error"]}),s.jsx("button",{type:"button",onClick:()=>Kl(b.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${b.file.name}`,children:s.jsx(Tr,{className:"h-4 w-4"})})]})]}),O&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:O.message}),s.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(O.progress),"%"]})]}),s.jsx("div",{className:"processing-progress mt-1",children:s.jsx("div",{className:`processing-progress__fill progress-animated ${Zi(O.stage)}`,style:{width:`${O.progress}%`}})})]})]},b.id)})}),s.jsx("input",{ref:Je,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:zr,multiple:t,"aria-label":"Select additional audio files for analysis"})]})]})]}),w&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(et,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),s.jsx("span",{className:"text-red-700 dark:text-red-300",children:w})]})}),!t&&E.stage!=="idle"&&!k&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:E.message}),s.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(E.progress),"%"]})]}),s.jsx("div",{className:"processing-progress",children:s.jsx("div",{className:`processing-progress__fill progress-animated ${Zi(E.stage)}`,style:{width:`${E.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":E.progress,"aria-valuemin":0,"aria-valuemax":100})}),E.stage==="analyzing"&&s.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[s.jsx(Rp,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),k&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(tt,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),k.rawApiResponse&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.predicted_score_depression||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.predicted_score_anxiety||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),s.jsx("span",{className:`font-mono ${k.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:k.rawApiResponse.status||"N/A"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.model_category||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.model_granularity||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),s.jsx("span",{className:`font-mono ${k.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:k.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),k.rawApiResponse.actual_score&&s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[k.rawApiResponse.actual_score.depression_binary!==void 0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.actual_score.depression_binary||"N/A"})]}),k.rawApiResponse.actual_score.anxiety_binary!==void 0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:k.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),k.rawApiResponse.actual_score.phq_9&&k.rawApiResponse.actual_score.phq_9.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",k.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),k.rawApiResponse.actual_score.phq_2&&k.rawApiResponse.actual_score.phq_2.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",k.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),k.rawApiResponse.actual_score.gad_7&&k.rawApiResponse.actual_score.gad_7.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),s.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",k.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:k.rawApiResponse.created_at?new Date(k.rawApiResponse.created_at).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:k.rawApiResponse.updated_at?new Date(k.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:k.sessionId})]})})]}),k.rawApiResponse.predict_error&&s.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[s.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:k.rawApiResponse.predict_error.error})]}),s.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[s.jsx("span",{className:"font-medium",children:"Message:"})," ",k.rawApiResponse.predict_error.message]})]})]}),s.jsxs("details",{className:"mt-4",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),s.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:s.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(k.rawApiResponse,null,2)})})]})]})})]}),k.insights&&k.insights.length>0&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),s.jsx("ul",{className:"space-y-1",children:k.insights.map((b,N)=>s.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[" ",b]},N))})]}),s.jsx("div",{className:"mt-6 flex space-x-3",children:s.jsx("button",{type:"button",onClick:Dt,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(t&&n.length>0||!t&&g)&&!k&&Object.keys(a).length===0&&E.stage==="idle"&&!h&&s.jsx("div",{className:"text-center",children:t?s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:s.jsxs("button",{type:"button",onClick:Xi,disabled:n.length===0||!$.trim()||!n.some(b=>l[b.id]==="ready"),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[s.jsx(Zt,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",n.filter(b=>l[b.id]==="ready").length>0&&` (${n.filter(b=>l[b.id]==="ready").length})`]})}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):s.jsxs("div",{children:[s.jsxs("button",{type:"button",onClick:Ql,disabled:!g||!$.trim(),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[s.jsx(Zt,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),s.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),t&&Object.keys(a).length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(tt,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(a).length," files)"]})]}),s.jsx("div",{className:"space-y-6",children:Object.entries(a).map(([b,N])=>{const O=n.find(q=>q.id===b),F=i[b];return s.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(O==null?void 0:O.file.name)||`File ${b}`}),s.jsxs("div",{className:"flex items-center space-x-2",children:[(F==null?void 0:F.stage)==="complete"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[s.jsx(tt,{className:"h-3 w-3 mr-1"}),"Complete"]}),(F==null?void 0:F.stage)==="error"&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[s.jsx(rs,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(F==null?void 0:F.stage)==="error"&&(F==null?void 0:F.error)&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(et,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:F.error.code})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),s.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:F.error.message})]})]}),F.error.details&&Object.keys(F.error.details).length>0&&s.jsxs("details",{className:"mt-3",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),s.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:s.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(F.error.details,null,2)})})]})]})]})]})}),N.rawApiResponse&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.predicted_score_depression||"N/A"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.sessionId})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.status||"N/A"})]})]})}),s.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),s.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:s.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(N.rawApiResponse,null,2)})})]})]}),O&&s.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>{const q=document.getElementById(`audio-${b}`);q.paused?(document.querySelectorAll("audio").forEach(K=>K.pause()),y(b),q.play()):(q.pause(),y(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":C===b?"Pause audio":"Play audio",children:C===b?s.jsx(Pn,{className:"h-4 w-4"}):s.jsx(Zt,{className:"h-4 w-4"})}),s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[O.file.name,"  ",O.duration?`${Math.round(O.duration)}s`:"Duration unknown"]})]}),s.jsx("audio",{id:`audio-${b}`,src:O.url,onEnded:()=>y(null),className:"hidden"})]})]},b)})})]}),H.length>0&&s.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:H.map(b=>s.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${b.type==="error"?"border-red-500":b.type==="warning"?"border-yellow-500":b.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:s.jsxs("div",{className:"flex items-start",children:[s.jsxs("div",{className:"flex-shrink-0",children:[b.type==="error"&&s.jsx(et,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),b.type==="warning"&&s.jsx(et,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),b.type==="success"&&s.jsx(tt,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),b.type==="info"&&s.jsx(et,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),s.jsxs("div",{className:"ml-3 flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:b.title}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:b.message})]}),s.jsx("div",{className:"ml-4 flex-shrink-0",children:s.jsx("button",{type:"button",onClick:()=>Kr(b.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:s.jsx(rs,{className:"h-4 w-4"})})})]})},b.id))})]})},ns={queued:{color:"yellow",icon:Mt,label:"Queued"},running:{color:"blue",icon:_e,label:"Processing"},processing:{color:"blue",icon:_e,label:"Processing"},succeeded:{color:"green",icon:tt,label:"Completed"},success:{color:"green",icon:tt,label:"Completed"},failed:{color:"red",icon:Ps,label:"Failed"},error:{color:"red",icon:Ps,label:"Error"}},is=n=>n?n.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"",os=n=>{if(!n)return 0;switch(n.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},uf=()=>{const[n,e]=p.useState([]),[t,r]=p.useState(!0),[i,o]=p.useState(null),[a,c]=p.useState(new Set),[l,d]=p.useState(!1),[h,u]=p.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:g}=mr(),A=p.useCallback(async()=>{try{r(!0),o(null);const C=vt(),f=(await we.getUserSessions(C)).sessions.map(x=>{var v;const w=x.prediction;return{...x,uploadedAt:x.createdAt,fileName:x.audioFileName||`Audio_${x.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:((v=x.analysisResults)==null?void 0:v.riskLevel)||"unknown",depressionScore:(w==null?void 0:w.predicted_score_depression)||(w==null?void 0:w.predictedScoreDepression)||void 0,anxietyScore:(w==null?void 0:w.predicted_score_anxiety)||(w==null?void 0:w.predictedScoreAnxiety)||void 0}});e(f),g(`${f.length} sessions loaded successfully`)}catch(C){const y=C;o(y),g(`Error loading sessions: ${y.message}`)}finally{r(!1)}},[g]);p.useEffect(()=>{A()},[A]);const E=p.useMemo(()=>{let C=n;if(h.search){const y=h.search.toLowerCase();C=C.filter(f=>{var x,w;return f.sessionId.toLowerCase().includes(y)||((x=f.fileName)==null?void 0:x.toLowerCase().includes(y))||((w=ns[f.status])==null?void 0:w.label.toLowerCase().includes(y))})}if(h.status!=="all"&&(C=C.filter(y=>y.status===h.status)),h.dateRange!=="all"){const y=new Date,f=new Date;switch(h.dateRange){case"today":f.setHours(0,0,0,0);break;case"week":f.setDate(y.getDate()-7);break;case"month":f.setMonth(y.getMonth()-1);break;case"year":f.setFullYear(y.getFullYear()-1);break}C=C.filter(x=>new Date(x.uploadedAt)>=f)}return C.sort((y,f)=>{let x=0;switch(h.sortBy){case"date":x=new Date(y.uploadedAt).getTime()-new Date(f.uploadedAt).getTime();break;case"status":x=y.status.localeCompare(f.status);break;case"depressionScore":const w=os(y.depressionScore),v=os(f.depressionScore);x=w-v;break;case"anxietyScore":const H=os(y.anxietyScore),Q=os(f.anxietyScore);x=H-Q;break}return h.sortOrder==="desc"?-x:x}),C},[n,h]),T=p.useCallback((C,y)=>{u(f=>({...f,[C]:y})),g(`Filter ${C} changed to ${y}`)},[g]),k=p.useCallback(C=>{c(y=>{const f=new Set(y);return f.has(C)?(f.delete(C),g("Session deselected")):(f.add(C),g("Session selected")),f})},[g]),P=p.useCallback(()=>{a.size===E.length?(c(new Set),g("All sessions deselected")):(c(new Set(E.map(y=>y.sessionId))),g(`All ${E.length} sessions selected`))},[a.size,E,g]),j=p.useCallback(async C=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await we.deleteSessionData(C),e(f=>f.filter(x=>x.sessionId!==C)),c(f=>{const x=new Set(f);return x.delete(C),x}),g("Session deleted successfully")}catch(f){const x=f;g(`Error deleting session: ${x.message}`),alert(`Failed to delete session: ${x.message}`)}},[g]),G=p.useCallback(async()=>{if(a.size===0||!window.confirm(`Are you sure you want to delete ${a.size} session(s)? This action cannot be undone.`))return;const y=Array.from(a);let f=0,x=[];for(const w of y)try{await we.deleteSessionData(w),f++}catch(v){const H=v;x.push(w),console.error(`Failed to delete session ${w}:`,H.message)}if(f>0&&e(w=>w.filter(v=>!(a.has(v.sessionId)&&!x.includes(v.sessionId)))),c(new Set),x.length===0)g(`${f} sessions deleted successfully`);else{const w=`${f} sessions deleted successfully, ${x.length} failed`;g(w),alert(`${w}. Failed sessions: ${x.join(", ")}`)}},[a,g]),M=C=>{if(C===0)return"0 B";const y=1024,f=["B","KB","MB","GB"],x=Math.floor(Math.log(C)/Math.log(y));return`${parseFloat((C/Math.pow(y,x)).toFixed(1))} ${f[x]}`},D=({status:C})=>{const y=C.toLowerCase();let f=ns[C];f||(y.includes("error")||y.includes("fail")?f=ns.error:f=ns.failed);const x=f.icon;return s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":f.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":f.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${f.label}`,children:[s.jsx(x,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),f.label]})};return t?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(_e,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):i?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(et,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:i.message}),s.jsx("button",{type:"button",onClick:A,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:A,disabled:t,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[s.jsx(_e,{className:`w-4 h-4 mr-2 ${t?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),s.jsx(Te,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),s.jsxs("div",{className:"relative",children:[s.jsx(Fp,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),s.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:h.search,onChange:C=>T("search",C.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),s.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),s.jsxs("button",{type:"button",onClick:()=>d(!l),className:"btn btn--secondary flex items-center","aria-expanded":l?"true":"false","aria-controls":"filter-panel","aria-label":`${l?"Hide":"Show"} filter options`,children:[s.jsx(Tl,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",l?s.jsx(Il,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):s.jsx(Al,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),l&&s.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),s.jsxs("select",{id:"status-filter",value:h.status,onChange:C=>T("status",C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Statuses"}),s.jsx("option",{value:"queued",children:"Queued"}),s.jsx("option",{value:"processing",children:"Processing"}),s.jsx("option",{value:"running",children:"Running"}),s.jsx("option",{value:"succeeded",children:"Completed"}),s.jsx("option",{value:"success",children:"Success"}),s.jsx("option",{value:"failed",children:"Failed"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),s.jsxs("select",{id:"date-filter",value:h.dateRange,onChange:C=>T("dateRange",C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Time"}),s.jsx("option",{value:"today",children:"Today"}),s.jsx("option",{value:"week",children:"Past Week"}),s.jsx("option",{value:"month",children:"Past Month"}),s.jsx("option",{value:"year",children:"Past Year"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),s.jsxs("select",{id:"sort-by",value:h.sortBy,onChange:C=>T("sortBy",C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"date",children:"Date"}),s.jsx("option",{value:"status",children:"Status"}),s.jsx("option",{value:"depressionScore",children:"Depression Score"}),s.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),s.jsxs("select",{id:"sort-order",value:h.sortOrder,onChange:C=>T("sortOrder",C.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"desc",children:"Newest First"}),s.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),E.length>0&&s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[E.length," of ",n.length," sessions",a.size>0&&`  ${a.size} selected`]})}),a.size>0&&s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("button",{type:"button",onClick:G,className:"btn btn--danger","aria-label":`Delete ${a.size} selected sessions`,children:[s.jsx(Tr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),E.length>0?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[s.jsx("div",{className:"hidden md:block overflow-x-auto",children:s.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left",children:s.jsx("input",{type:"checkbox",checked:a.size===E.length,onChange:P,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),s.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:E.map(C=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[s.jsx("td",{className:"px-6 py-4",children:s.jsx("input",{type:"checkbox",checked:a.has(C.sessionId),onChange:()=>k(C.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${C.sessionId}`})}),s.jsx("td",{className:"px-6 py-4",children:s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:C.fileName}),s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",C.sessionId.slice(-12)]}),s.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:M(C.fileSize||0)})]})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx(D,{status:C.status})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm",children:C.depressionScore?s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:is(C.depressionScore)}):s.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"text-sm",children:C.anxietyScore?s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:is(C.anxietyScore)}):s.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),s.jsxs("td",{className:"px-6 py-4",children:[s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Mr(C.uploadedAt)}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:nr(C.uploadedAt)})]}),s.jsx("td",{className:"px-6 py-4 text-right",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Te,{to:`/sessions/${C.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${C.sessionId}`,children:s.jsx(Lr,{className:"w-4 h-4","aria-hidden":"true"})}),C.status==="succeeded"&&s.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${C.sessionId}`,children:s.jsx(Os,{className:"w-4 h-4","aria-hidden":"true"})}),s.jsx("button",{type:"button",onClick:()=>j(C.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${C.sessionId}`,children:s.jsx(Tr,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},C.sessionId))})]})}),s.jsx("div",{className:"md:hidden space-y-4 p-4",children:E.map(C=>s.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("input",{type:"checkbox",checked:a.has(C.sessionId),onChange:()=>k(C.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${C.sessionId}`}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:C.fileName}),s.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",C.sessionId.slice(-12)]})]})]}),s.jsx(D,{status:C.status})]}),(C.depressionScore||C.anxietyScore)&&s.jsxs("div",{className:"text-sm",children:[C.depressionScore&&s.jsxs("div",{children:["Depression: ",is(C.depressionScore)]}),C.anxietyScore&&s.jsxs("div",{children:["Anxiety: ",is(C.anxietyScore)]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[s.jsx("span",{children:Mr(C.uploadedAt)}),s.jsx("span",{children:M(C.fileSize||0)})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[s.jsxs(Te,{to:`/sessions/${C.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${C.sessionId}`,children:[s.jsx(Lr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),C.status==="succeeded"&&s.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${C.sessionId}`,children:[s.jsx(Os,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),s.jsxs("button",{type:"button",onClick:()=>j(C.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${C.sessionId}`,children:[s.jsx(Tr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},C.sessionId))})]}):s.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx(et,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:n.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),n.length===0?s.jsx(Te,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):s.jsx("button",{type:"button",onClick:()=>u({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},gf={low:{color:"green",label:"Low Risk",icon:tt,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:Pl,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:On,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:On,description:"Urgent intervention required"}},mf=({sessionId:n,existingAssessment:e,onAssessmentUpdated:t})=>{const{announceToScreenReader:r}=mr(),[i,o]=p.useState(e||null),[a,c]=p.useState(!1),[l,d]=p.useState(!1),[h,u]=p.useState(null),g=p.useCallback(async()=>{try{c(!0),u(null),r("Generating AI risk assessment...");const T=await we.generateRiskAssessment(n);if(T.success&&T.riskAssessment)o(T.riskAssessment),t==null||t(T.riskAssessment),r("Risk assessment generated successfully");else throw new Error(T.message||"Failed to generate risk assessment")}catch(T){const k=T;u(k),r(`Error generating assessment: ${k.message}`)}finally{c(!1)}},[n,t,r]),A=p.useCallback(async()=>{try{d(!0),u(null);const T=await we.getRiskAssessment(n);T.success&&T.riskAssessment&&(o(T.riskAssessment),t==null||t(T.riskAssessment))}catch(T){u(T)}finally{d(!1)}},[n,t]),E=({riskLevel:T,riskScore:k})=>{const P=gf[T.toLowerCase()];if(!P)return null;const j=P.icon;return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${P.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":P.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${P.label}`,children:[s.jsx(j,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),P.label,k&&s.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[k,"/10"]})]}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:P.description})]})};return!i&&!a&&!l?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(It,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsxs("div",{className:"text-center py-8",children:[s.jsx(It,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{type:"button",onClick:g,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[s.jsx(It,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),s.jsxs("button",{type:"button",onClick:A,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[s.jsx(_e,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),h&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]})]}):a||l?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(It,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(_e,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:a?"Generating AI risk assessment...":"Loading assessment..."})]}),a&&s.jsx("div",{className:"mt-4 text-center",children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):i?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[s.jsx(It,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),s.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:s.jsxs("button",{type:"button",onClick:g,disabled:a,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[s.jsx(_e,{className:`w-3 h-3 mr-1 ${a?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),s.jsx(E,{riskLevel:i.overallRiskLevel,riskScore:i.riskScore})]}),i.generatedAt&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[s.jsx(_l,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:nr(i.generatedAt)})]})]}),i.summary&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(xp,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),s.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:s.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:i.summary})})]}),i.keyFactors&&i.keyFactors.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Pl,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),s.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:s.jsx("ul",{className:"space-y-2",children:i.keyFactors.map((T,k)=>s.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[s.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},k))})})]}),i.recommendations&&i.recommendations.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Np,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),s.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:s.jsx("ul",{className:"space-y-2",children:i.recommendations.map((T,k)=>s.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[s.jsx(tt,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},k))})})]}),i.immediateActions&&i.immediateActions.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(Rl,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:s.jsx("ul",{className:"space-y-2",children:i.immediateActions.map((T,k)=>s.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[s.jsx(On,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},k))})})]}),i.followUpRecommendations&&i.followUpRecommendations.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(en,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),s.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:s.jsx("ul",{className:"space-y-2",children:i.followUpRecommendations.map((T,k)=>s.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[s.jsx(Mt,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},k))})})]}),s.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[s.jsx(Mt,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",nr(i.generatedAt),i.modelVersion&&s.jsxs("span",{className:"ml-4",children:["Model: ",i.modelVersion]})]})})]}),h&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]}):null},un={queued:{color:"yellow",icon:Mt,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Mt,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:_e,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:_e,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:tt,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:tt,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:Ps,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:Ps,label:"Error",description:"An error occurred during processing"}},pf=()=>{var C,y,f,x,w,v,H,Q,ce,st,fe,Pe;const{sessionId:n}=sd(),e=Dn(),{announceToScreenReader:t}=mr(),[r,i]=p.useState(null),[o,a]=p.useState(!0),[c,l]=p.useState(null),[d,h]=p.useState(!1),[u,g]=p.useState(!1),[A,E]=p.useState(!1),T=p.useRef(null),k=p.useCallback(async()=>{if(n)try{a(!0),l(null);const X=await we.getSessionData(n);i(X),t(`Session ${n} loaded successfully`)}catch(X){const le=X;l(le),t(`Error loading session: ${le.message}`)}finally{a(!1)}},[n,t]),P=p.useCallback(async()=>{g(!0),await k(),g(!1),t("Session data refreshed")},[k,t]);p.useEffect(()=>{k()},[k]);const j=p.useCallback(()=>{h(X=>{const le=!X;return t(`Raw JSON view ${le?"enabled":"disabled"}`),le})},[t]),G=p.useCallback(()=>{T.current&&(A?(T.current.pause(),E(!1),t("Audio paused")):(T.current.play().catch(()=>{t("Failed to play audio")}),E(!0),t("Audio playing")))},[A,t]),M=p.useCallback(()=>{if(!r)return;const X=JSON.stringify(r,null,2),le=new Blob([X],{type:"application/json"}),$=URL.createObjectURL(le),ye=document.createElement("a");ye.href=$,ye.download=`session-${r.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL($),t("Session data download started")},[r,t]),D=({status:X})=>{const le=X.toLowerCase();let $=un[X];$||(le.includes("error")||le.includes("fail")?$=un.error:$=un.failed);const ye=$.icon;return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${$.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":$.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":$.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${$.label}`,children:[s.jsx(ye,{className:`w-4 h-4 mr-2 ${$.color==="blue"&&X==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),$.label]}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:$.description})]})};return o?s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(_e,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):c?s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(et,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:c.message}),s.jsxs("div",{className:"mt-4 space-x-3",children:[s.jsx("button",{type:"button",onClick:k,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),s.jsx(Te,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):r?s.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("button",{type:"button",onClick:()=>e("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[s.jsx(Zm,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",r.sessionId]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:j,className:"btn btn--secondary","aria-label":`${d?"Hide":"Show"} raw JSON data`,children:[d?s.jsx(gp,{className:"w-4 h-4 mr-2"}):s.jsx(Lr,{className:"w-4 h-4 mr-2"}),d?"Hide JSON":"Show JSON"]}),s.jsxs("button",{type:"button",onClick:P,disabled:u,className:"btn btn--secondary","aria-label":"Refresh session data",children:[s.jsx(_e,{className:`w-4 h-4 mr-2 ${u?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),s.jsxs("button",{type:"button",onClick:M,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[s.jsx(Os,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),d&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(jn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:s.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(r,null,2)})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(jn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),s.jsx(D,{status:r.status})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(_l,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"text-gray-900 dark:text-white",children:Mr(r.createdAt)}),s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nr(r.createdAt)})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(Mt,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"text-gray-900 dark:text-white",children:Mr(r.updatedAt)}),s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nr(r.updatedAt)})]})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s.jsx(Zo,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),s.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:r.userId})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(fp,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),s.jsxs("div",{className:"space-y-4",children:[r.audioFileName&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-medium",children:r.audioFileName})]}),r.audioUrl&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{type:"button",onClick:G,className:"btn btn--secondary","aria-label":`${A?"Pause":"Play"} audio`,children:A?s.jsx(Pn,{className:"w-4 h-4"}):s.jsx(Zt,{className:"w-4 h-4"})}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:A?"Playing audio...":"Audio playback available"})]}),s.jsx("audio",{ref:T,src:r.audioUrl,onPlay:()=>E(!0),onPause:()=>E(!1),onEnded:()=>E(!1),onError:()=>{E(!1),t("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),r.userMetadata&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Zo,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.userMetadata.age&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),s.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.age," years"]})]}),r.userMetadata.gender&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.gender.replace(/[_-]/g," ")})]}),r.userMetadata.weight&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),s.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.weight," lbs"]})]}),r.userMetadata.race&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.race})]}),r.userMetadata.ethnicity&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.ethnicity})]}),r.userMetadata.zipcode&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:r.userMetadata.zipcode})]}),r.userMetadata.language!==void 0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.language?"Yes":"No"})]}),r.userMetadata.sessionNotes&&s.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:r.userMetadata.sessionNotes})]})]})]}),(r.analysisResults||r.prediction)&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Dr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),s.jsxs("div",{className:"space-y-6",children:[(r.analysisResults||r.prediction)&&s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[s.jsx(It,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((C=r.analysisResults)==null?void 0:C.depressionScore)||((y=r.prediction)==null?void 0:y.predicted_score_depression))&&s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),s.jsx(en,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((x=(f=r.analysisResults)==null?void 0:f.depressionScore)==null?void 0:x.toFixed(2))||((w=r.prediction)!=null&&w.predicted_score_depression?r.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,X=>X.toUpperCase()):"N/A")})]}),(((v=r.analysisResults)==null?void 0:v.anxietyScore)||((H=r.prediction)==null?void 0:H.predicted_score_anxiety))&&s.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),s.jsx(Vi,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((ce=(Q=r.analysisResults)==null?void 0:Q.anxietyScore)==null?void 0:ce.toFixed(2))||((st=r.prediction)!=null&&st.predicted_score_anxiety?r.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,X=>X.toUpperCase()):"N/A")})]})]})]}),((fe=r.analysisResults)==null?void 0:fe.insights)&&r.analysisResults.insights.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),s.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:s.jsx("ul",{className:"space-y-2",children:r.analysisResults.insights.map((X,le)=>s.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[s.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),X]},le))})})]}),((Pe=r.analysisResults)==null?void 0:Pe.completedAt)&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),s.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(tt,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),s.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:nr(r.analysisResults.completedAt)})]})})]})]})]}),s.jsx(mf,{sessionId:r.sessionId,existingAssessment:r.riskAssessment||null,onAssessmentUpdated:X=>{i(le=>le?{...le,riskAssessment:X}:null)}})]}):s.jsx("div",{className:"max-w-6xl mx-auto p-6",children:s.jsxs("div",{className:"text-center py-16",children:[s.jsx(et,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),s.jsx(Te,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},ff=()=>{const[n,e]=p.useState([]),[t,r]=p.useState(!0),[i,o]=p.useState(null),[a,c]=p.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[l,d]=p.useState(!1),{announceToScreenReader:h}=mr(),u=Dn(),g=p.useCallback(y=>{u(`/sessions/${y}`),h(`Navigating to session ${y} details`)},[u,h]),A=p.useCallback(async()=>{try{r(!0),o(null);const y=vt(),x=(await we.getUserSessions(y)).sessions.filter(w=>w.analysisResults||w.prediction);e(x),h(`${x.length} prediction sessions loaded`)}catch(y){const f=y;o(f),h(`Error loading predictions: ${f.message}`)}finally{r(!1)}},[h]);p.useEffect(()=>{A()},[A]);const E=p.useMemo(()=>{if(a.dateRange==="all")return n;const y=new Date,f=new Date;switch(a.dateRange){case"week":f.setDate(y.getDate()-7);break;case"month":f.setMonth(y.getMonth()-1);break;case"quarter":f.setMonth(y.getMonth()-3);break;case"year":f.setFullYear(y.getFullYear()-1);break}return n.filter(x=>new Date(x.createdAt)>=f)},[n,a.dateRange]),T=p.useMemo(()=>E.map(y=>{var v,H;const f=Q=>{if(!Q)return null;switch(Q.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},x=f((v=y.prediction)==null?void 0:v.predicted_score_depression),w=f((H=y.prediction)==null?void 0:H.predicted_score_anxiety);return{date:y.createdAt,depression:x,anxiety:w,overall:null,sessionId:y.sessionId}}).sort((y,f)=>new Date(y.date).getTime()-new Date(f.date).getTime()),[E]),k=p.useMemo(()=>{const y={depression:[],anxiety:[]},f=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],x=E.map(v=>{var H;return(H=v.prediction)==null?void 0:H.predicted_score_depression}).filter(v=>v!==void 0);f.forEach(v=>{const H=x.filter(ce=>ce===v.category).length,Q=x.length>0?H/x.length*100:0;H>0&&y.depression.push({category:v.label,count:H,percentage:Q,color:v.color})});const w=E.map(v=>{var H;return(H=v.prediction)==null?void 0:H.predicted_score_anxiety}).filter(v=>v!==void 0);return f.forEach(v=>{const H=w.filter(ce=>ce===v.category).length,Q=w.length>0?H/w.length*100:0;H>0&&y.anxiety.push({category:v.label,count:H,percentage:Q,color:v.color})}),y},[E]),P=p.useMemo(()=>{const y={},f=v=>{if(!v)return 0;switch(v.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},x=E.map(v=>{var H;return(H=v.prediction)==null?void 0:H.predicted_score_depression}).filter(v=>v!==void 0);if(x.length<2)y.depression={direction:"stable",change:0,period:"insufficient data"};else{const v=x.map(f),H=v.slice(0,Math.floor(v.length/2)),Q=v.slice(Math.floor(v.length/2)),ce=H.reduce((Pe,X)=>Pe+X,0)/H.length,fe=Q.reduce((Pe,X)=>Pe+X,0)/Q.length-ce;y.depression={direction:Math.abs(fe)<.5?"stable":fe<0?"improving":"worsening",change:Math.abs(fe),period:`${E.length} sessions`}}const w=E.map(v=>{var H;return(H=v.prediction)==null?void 0:H.predicted_score_anxiety}).filter(v=>v!==void 0);if(w.length<2)y.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const v=w.map(f),H=v.slice(0,Math.floor(v.length/2)),Q=v.slice(Math.floor(v.length/2)),ce=H.reduce((Pe,X)=>Pe+X,0)/H.length,fe=Q.reduce((Pe,X)=>Pe+X,0)/Q.length-ce;y.anxiety={direction:Math.abs(fe)<.5?"stable":fe<0?"improving":"worsening",change:Math.abs(fe),period:`${E.length} sessions`}}return y.overall={direction:"stable",change:0,period:"coming soon"},y},[E]),j=p.useMemo(()=>{const y={totalSessions:E.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(E.length===0)return y;const f=E.map(w=>{var v;return(v=w.prediction)==null?void 0:v.predictedScoreDepression}).filter(w=>w!==void 0),x=E.map(w=>{var v;return(v=w.prediction)==null?void 0:v.predictedScoreAnxiety}).filter(w=>w!==void 0);if(f.length>0){const w={};f.forEach(H=>{w[H]=(w[H]||0)+1});const v=Object.entries(w).sort(([,H],[,Q])=>Q-H)[0][0];y.avgDepression=w[v]}if(x.length>0){const w={};x.forEach(H=>{w[H]=(w[H]||0)+1});const v=Object.entries(w).sort(([,H],[,Q])=>Q-H)[0][0];y.avgAnxiety=w[v]}return y.latestSession=E.sort((w,v)=>new Date(v.createdAt).getTime()-new Date(w.createdAt).getTime())[0],y.improvementSessions=0,y},[E]),G=p.useCallback((y,f)=>{c(x=>({...x,[y]:f})),h(`Filter ${y} changed to ${f}`)},[h]),M=p.useCallback(()=>{const y=JSON.stringify(E,null,2),f=new Blob([y],{type:"application/json"}),x=URL.createObjectURL(f),w=document.createElement("a");w.href=x,w.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(x),h("Predictions data download started")},[E,h]),D=({trend:y,label:f})=>{const x=y.direction==="improving"?jl:y.direction==="worsening"?en:Dr,w=y.direction==="improving"?"text-green-600 dark:text-green-400":y.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(x,{className:`w-4 h-4 ${w}`,"aria-hidden":"true"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:f}),s.jsxs("span",{className:`text-sm font-medium ${w} capitalize`,children:[y.direction,y.period==="insufficient data"?" (need more sessions)":y.period==="coming soon"?" (analysis coming soon)":` (${y.period})`]})]})},C=({data:y,type:f,onBarClick:x})=>{const w=y.map($=>$[f]).filter($=>$!==null);if(w.length===0)return s.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const v=Math.max(...w),H=Math.min(...w),Q=v-H||1,ce=$=>{switch($){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},st=($,ye)=>{if(ye==="depression")switch($){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(ye==="anxiety")switch($){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch($){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},fe=$=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(Je=>({...Je,color:st(Je.score,$)})),Pe=new Set(w),le=fe(f).filter($=>Pe.has($.score));return s.jsxs("div",{children:[s.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:y.map(($,ye)=>{const Je=$[f];if(Je===null)return null;const ie=(Je-H)/Q*100,te=st(Je,f),Kr=ce(Je),Dt=new Date($.date).toLocaleDateString();return s.jsx("div",{className:`flex-1 ${te} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(ie,8)}%`},onClick:()=>x($.sessionId),role:"button",tabIndex:0,onKeyDown:pr=>{(pr.key==="Enter"||pr.key===" ")&&(pr.preventDefault(),x($.sessionId))},"aria-label":`View session details for ${Kr} score on ${Dt}`,children:s.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[s.jsx("div",{className:"font-medium",children:Kr}),s.jsx("div",{className:"text-gray-300",children:Dt}),s.jsxs("div",{className:"text-gray-300",children:["Session: ",$.sessionId.slice(-8)]}),s.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),s.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},ye)})}),le.length>0&&s.jsx("div",{className:"px-4",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),le.map($=>s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:`w-3 h-3 ${$.color} rounded`}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:$.label})]},$.score))]})})]})};return t?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsxs("div",{className:"flex items-center justify-center py-16",children:[s.jsx(_e,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):i?s.jsx("div",{className:"max-w-7xl mx-auto p-6",children:s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(et,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:i.message}),s.jsx("button",{type:"button",onClick:A,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{type:"button",onClick:()=>d(!l),className:"btn btn--secondary","aria-expanded":l?"true":"false","aria-label":`${l?"Hide":"Show"} filter options`,children:[s.jsx(Tl,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",l?s.jsx(Il,{className:"w-4 h-4 ml-2"}):s.jsx(Al,{className:"w-4 h-4 ml-2"})]}),s.jsxs("button",{type:"button",onClick:A,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[s.jsx(_e,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),s.jsxs("button",{type:"button",onClick:M,className:"btn btn--primary",disabled:E.length===0,"aria-label":"Download predictions data",children:[s.jsx(Os,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),l&&s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),s.jsxs("select",{id:"date-range",value:a.dateRange,onChange:y=>G("dateRange",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Time"}),s.jsx("option",{value:"week",children:"Past Week"}),s.jsx("option",{value:"month",children:"Past Month"}),s.jsx("option",{value:"quarter",children:"Past Quarter"}),s.jsx("option",{value:"year",children:"Past Year"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),s.jsxs("select",{id:"score-type",value:a.scoreType,onChange:y=>G("scoreType",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Scores"}),s.jsx("option",{value:"depression",children:"Depression"}),s.jsx("option",{value:"anxiety",children:"Anxiety"}),s.jsx("option",{value:"overall",children:"Overall"})]})]}),s.jsx("div",{className:"flex items-end",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:a.showTrends,onChange:y=>G("showTrends",y.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),E.length===0?s.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx(It,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:n.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),s.jsx(Te,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Dr,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),s.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:j.totalSessions})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(It,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const y=E.map(w=>{var v;return(v=w.prediction)==null?void 0:v.predicted_score_depression}).filter(w=>w!==void 0);if(y.length===0)return"";const f={};return y.forEach(w=>{f[w]=(f[w]||0)+1}),Object.entries(f).sort(([,w],[,v])=>v-w)[0][0].replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())})()})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(Vi,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const y=E.map(w=>{var v;return(v=w.prediction)==null?void 0:v.predicted_score_anxiety}).filter(w=>w!==void 0);if(y.length===0)return"";const f={};return y.forEach(w=>{f[w]=(f[w]||0)+1}),Object.entries(f).sort(([,w],[,v])=>v-w)[0][0].replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())})()})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(a.scoreType==="all"||a.scoreType==="depression")&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Jo,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),s.jsx(C,{data:T,type:"depression",onBarClick:g}),a.showTrends&&s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:s.jsx(D,{trend:P.depression,label:"Trend:"})})]}),(a.scoreType==="all"||a.scoreType==="anxiety")&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(np,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),s.jsx(C,{data:T,type:"anxiety",onBarClick:g}),a.showTrends&&s.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:s.jsx(D,{trend:P.anxiety,label:"Trend:"})})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Jo,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(k).map(([y,f])=>s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[y," Scores"]}),s.jsx("div",{className:"space-y-2",children:f.map(x=>s.jsx("div",{className:"flex items-center",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x.category}),s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[x.count," (",x.percentage.toFixed(1),"%)"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full ${x.color} progress-dynamic progress-animated`,style:{"--progress-width":`${x.percentage}%`}})})]})},x.category))})]},y))})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[s.jsx(Mt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),s.jsx(Te,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions "})]}),s.jsx("div",{className:"space-y-4",children:E.slice(0,5).map(y=>{var f,x;return s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${y.status==="succeeded"?"bg-green-500":y.status==="processing"?"bg-blue-500":y.status==="failed"?"bg-red-500":"bg-gray-500"}`}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.audioFileName||`Session ${y.sessionId.slice(-8)}`}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Mr(y.createdAt)})]})]})}),s.jsxs("div",{className:"flex items-center space-x-4",children:[((f=y.prediction)==null?void 0:f.predicted_score_depression)&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())})]}),((x=y.prediction)==null?void 0:x.predicted_score_anxiety)&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())})]}),s.jsx(Te,{to:`/sessions/${y.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${y.sessionId}`,children:s.jsx(Lr,{className:"w-4 h-4","aria-hidden":"true"})})]})]},y.sessionId)})})]})]})]})},Mn=(n,e)=>e>0?Math.round(n/e*100):0,yf=n=>{const e=n.length,t=new Set(n.map(k=>k.userId)).size,r=n.filter(k=>k.status==="succeeded"&&k.prediction),i=n.filter(k=>k.status==="failed"),o=n.filter(k=>k.status==="processing"),a=Mn(r.length,e),c=t>0?Math.round(e/t*10)/10:0,l=new Date(Date.now()-24*60*60*1e3),d=n.filter(k=>new Date(k.createdAt)>l).length,h={low:0,medium:0,high:0,unknown:0};n.forEach(k=>{var j;const P=((j=k.analysisResults)==null?void 0:j.riskLevel)||"unknown";P in h&&h[P]++});const u={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},g={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};r.forEach(k=>{if(k.prediction){const P=k.prediction.predictedScoreDepression;P&&P in u&&u[P]++;const j=k.prediction.predictedScoreAnxiety;j&&j in g&&g[j]++}});const A=[];for(let k=6;k>=0;k--){const P=new Date;P.setDate(P.getDate()-k);const j=P.toISOString().split("T")[0],G=n.filter(M=>M.createdAt.split("T")[0]===j).length;A.push({date:j,count:G})}const E=new Map;n.forEach(k=>{E.has(k.userId)||E.set(k.userId,{totalSessions:0,successfulSessions:0,sessions:[]});const P=E.get(k.userId);P.totalSessions++,P.sessions.push(k),k.status==="succeeded"&&k.prediction&&P.successfulSessions++});const T=Array.from(E.entries()).map(([k,P])=>{var x;const j=Mn(P.successfulSessions,P.totalSessions),G=P.sessions.filter(w=>{var v;return w.status==="succeeded"&&w.prediction&&((v=w.analysisResults)==null?void 0:v.confidence)}),M=G.length>0?G.reduce((w,v)=>{var H;return w+(((H=v.analysisResults)==null?void 0:H.confidence)||0)},0)/G.length:0,D={low:0,medium:0,high:0,unknown:0};P.sessions.forEach(w=>{var H;const v=((H=w.analysisResults)==null?void 0:H.riskLevel)||"unknown";v in D&&D[v]++});const C={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},y={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};G.forEach(w=>{if(w.prediction){const v=w.prediction.predictedScoreDepression;v&&v in C&&C[v]++;const H=w.prediction.predictedScoreAnxiety;H&&H in y&&y[H]++}});const f=P.sessions.reduce((w,v)=>new Date(v.updatedAt)>new Date(w)?v.updatedAt:w,((x=P.sessions[0])==null?void 0:x.updatedAt)||new Date().toISOString());return{userId:k,totalSessions:P.totalSessions,successfulSessions:P.successfulSessions,successRate:j,avgConfidence:Math.round(M*100)/100,riskDistribution:D,lastActivity:f,depressionScores:C,anxietyScores:y}}).sort((k,P)=>P.totalSessions-k.totalSessions);return{overview:{totalSessions:e,uniqueUsers:t,successRate:a,avgSessionsPerUser:c,recentActivity:d},sessionStatus:{succeeded:r.length,failed:i.length,processing:o.length,total:e},riskLevels:{...h,total:e},predictions:{depression:{...u,total:r.length},anxiety:{...g,total:r.length}},timeData:A,riskDistribution:h,userStats:T}},as=({title:n,value:e,subtitle:t,icon:r,trend:i,color:o="text-blue-600"})=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:n}),s.jsx("p",{className:`text-2xl font-bold ${o} dark:text-white mt-1`,children:e}),t&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t})]}),s.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${o}`,children:r})]}),i&&s.jsxs("div",{className:"flex items-center mt-4",children:[i==="up"&&s.jsx(en,{className:"h-4 w-4 text-green-500 mr-1"}),i==="down"&&s.jsx(jl,{className:"h-4 w-4 text-red-500 mr-1"}),s.jsx("span",{className:`text-sm ${i==="up"?"text-green-600":i==="down"?"text-red-600":"text-gray-500"}`,children:i==="up"?"Trending up":i==="down"?"Trending down":"Stable"})]})]}),cs=({title:n,data:e,total:t})=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:n}),s.jsx("div",{className:"space-y-3",children:e.map((r,i)=>{const o=Mn(r.value,t);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r.label}),s.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[r.value," (",o,"%)"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${r.color}`,style:{width:`${o}%`},role:"progressbar","aria-label":`${r.label}: ${r.value} (${o}%)`})})]},i)})})]}),xf=({title:n,data:e})=>{const t=Math.max(...e.map(o=>o.count),1),r=0,i=t-r||1;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"relative h-48",children:s.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[s.jsxs("defs",{children:[s.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),s.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),s.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),s.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),e.map((o,a)=>{const c=80/e.length,l=a/(e.length-1)*(100-c)+c/2,d=(o.count-r)/i*95,h=100-d;return s.jsx("rect",{x:l-c/2,y:h,width:c*.6,height:d,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},a)})]})}),s.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:e.map((o,a)=>{const c=new Date(o.date),l=c.toLocaleDateString("en-US",{weekday:"short"}),d=c.toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.jsxs("div",{className:"text-center flex-1",children:[s.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:l}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:d}),s.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:o.count})]},a)})})]})},bf=({title:n,depressionData:e,anxietyData:t})=>{const r=[{depression:e.no_to_mild,anxiety:t.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:e.mild_to_moderate,anxiety:t.mild,severity:"Mild",label:"Mild"},{depression:e.moderate_to_severe,anxiety:t.moderate,severity:"Moderate",label:"Moderate"},{depression:e.severe,anxiety:t.moderately_severe+t.severe,severity:"High",label:"Severe"}],i=Math.max(...r.map(a=>Math.max(a.depression,a.anxiety)),10),o=a=>{switch(a){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"relative h-96",children:s.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 400 300",children:[s.jsx("defs",{children:s.jsx("pattern",{id:"correlationGrid",width:"40",height:"30",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 40 0 L 0 0 0 30",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),s.jsx("rect",{width:"400",height:"300",fill:"url(#correlationGrid)"}),s.jsx("line",{x1:"50",y1:"270",x2:"370",y2:"270",stroke:"rgb(107 114 128)",strokeWidth:"2"}),s.jsx("line",{x1:"50",y1:"270",x2:"50",y2:"30",stroke:"rgb(107 114 128)",strokeWidth:"2"}),r.map((a,c)=>{const l=50+a.depression/i*320,d=270-a.anxiety/i*240,h=Math.max(Math.sqrt(a.depression+a.anxiety)*2.5,8);return s.jsxs("g",{children:[s.jsx("circle",{cx:l,cy:d,r:h,className:`${o(a.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),s.jsx("text",{x:l,y:d+4,textAnchor:"middle",className:"text-xs fill-white font-bold",children:a.depression+a.anxiety})]},c)}),s.jsx("text",{x:"210",y:"295",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases "}),s.jsx("text",{x:"30",y:"150",textAnchor:"middle",transform:"rotate(-90 30 150)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:" Anxiety Cases"})]})}),s.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:r.map((a,c)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`w-3 h-3 rounded-full ${o(a.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:a.label})]},c))})]})},wf=({title:n,sessionStatus:e})=>{const t=[{label:"Total Sessions",value:e.total,color:"bg-blue-500"},{label:"In Processing",value:e.processing,color:"bg-yellow-500"},{label:"Completed",value:e.succeeded,color:"bg-green-500"},{label:"Failed",value:e.failed,color:"bg-red-500"}],r=e.total||1;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:n}),s.jsx("div",{className:"space-y-4",children:t.map((i,o)=>{const a=i.value/r*100,c=o>0?(i.value/t[0].value*100).toFixed(1):"100.0";return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.label}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:i.value}),s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",c,"%)"]})]})]}),s.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[s.jsx("div",{className:`h-full ${i.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${a}%`},children:a>20&&s.jsx("span",{className:"text-xs font-medium text-white",children:i.value})}),o<t.length-1&&s.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:s.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},o)})}),s.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(e.succeeded/e.total*100).toFixed(1),"%"]}),s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(e.failed/e.total*100).toFixed(1),"%"]}),s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},vf=({userStats:n})=>{const e=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),t=(a,c)=>{if(c===0)return"text-gray-400";switch(a){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},r=n.length,i=r>0?Math.round(n.reduce((a,c)=>a+c.totalSessions,0)/r*10)/10:0,o=n.length>0?n.reduce((a,c)=>c.successRate>a.successRate?c:a,n[0]):null;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[s.jsx(Ol,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),s.jsxs("div",{className:"flex space-x-6 text-sm",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:r}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:i}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),o&&s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"font-semibold text-green-600",children:[o.successRate,"%"]}),s.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Best Job Success Rate"})]})]})]}),n.length===0?s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):s.jsxs("div",{children:[s.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),s.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[s.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white",children:"User ID"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Job Success Rate"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Avg Confidence"}),s.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Risk Distribution"}),s.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),s.jsx("tbody",{children:n.map((a,c)=>s.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${c%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[s.jsx("td",{className:"py-3 px-2",children:s.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:s.jsxs("div",{className:"truncate max-w-[120px]",title:a.userId,children:[a.userId.substring(0,8),"..."]})})}),s.jsxs("td",{className:"py-3 px-2 text-center",children:[s.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:a.totalSessions}),s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a.successfulSessions," successful"]})]}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:`font-medium ${a.successRate>=80?"text-green-600":a.successRate>=60?"text-yellow-600":"text-red-600"}`,children:[a.successRate,"%"]})}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(a.avgConfidence*100).toFixed(1),"%"]})}),s.jsx("td",{className:"py-3 px-2 text-center",children:s.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("low",a.riskDistribution.low)}`,children:["L:",a.riskDistribution.low]}),s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("medium",a.riskDistribution.medium)}`,children:["M:",a.riskDistribution.medium]}),s.jsxs("span",{className:`px-1 py-0.5 rounded ${t("high",a.riskDistribution.high)}`,children:["H:",a.riskDistribution.high]})]})}),s.jsx("td",{className:"py-3 px-2 text-right",children:s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e(a.lastActivity)})})]},a.userId))})]})})]})]})},kf=()=>{const[n,e]=p.useState(null),[t,r]=p.useState(!1),[i,o]=p.useState(null),[a,c]=p.useState(new Date),{announceToScreenReader:l}=mr(),d=parseInt("69")*1e3,h=p.useCallback(async()=>{try{r(!0),o(null);let g=[];try{g=(await we.getAllSessions()).sessions}catch(E){console.warn("getAllSessions endpoint not available, using mock data for demonstration:",E),g=[{sessionId:"demo-session-1",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*2).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_1.wav",prediction:{sessionId:"demo-session-1",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"no_or_minimal",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.85,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-2",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*6).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_2.wav",prediction:{sessionId:"demo-session-2",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.92,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-3",userId:"9d8c7b6a-5e4f-4392-8a1b-0c9d8e7f6a5b",status:"failed",createdAt:new Date(Date.now()-1e3*60*60*12).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_3.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing failed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-4",userId:"a8b7c6d5-e4f3-4a2b-9c8d-7e6f5a4b3c2d",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*24).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_4.wav",prediction:{sessionId:"demo-session-4",status:"succeeded",predictedScoreDepression:"moderate_to_severe",predictedScoreAnxiety:"moderately_severe",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"high",confidence:.78,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-5",userId:"4c3b2a19-8e7f-4d6c-5b4a-392817f6e5d4",status:"processing",createdAt:new Date(Date.now()-1e3*60*30).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_5.wav",analysisResults:{riskLevel:"unknown",confidence:0,insights:["Processing in progress"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-6",userId:"f1e2d3c4-b5a6-4c7d-8e9f-0a1b2c3d4e5f",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*36).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_6.wav",prediction:{sessionId:"demo-session-6",status:"succeeded",predictedScoreDepression:"no_to_mild",predictedScoreAnxiety:"mild",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"low",confidence:.89,insights:["Analysis completed"],completedAt:new Date().toISOString()}},{sessionId:"demo-session-7",userId:"7f6e5d4c-3b2a-4190-8e7f-6d5c4b3a2918",status:"succeeded",createdAt:new Date(Date.now()-1e3*60*60*48).toISOString(),updatedAt:new Date().toISOString(),audioFileName:"session_7.wav",prediction:{sessionId:"demo-session-7",status:"succeeded",predictedScoreDepression:"mild_to_moderate",predictedScoreAnxiety:"moderate",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},analysisResults:{riskLevel:"medium",confidence:.82,insights:["Analysis completed"],completedAt:new Date().toISOString()}}]}const A=yf(g);e(A),c(new Date),l("Control panel data loaded successfully")}catch(g){const A=g;o(A),l(`Error loading control panel data: ${A.message}`)}finally{r(!1)}},[l]);p.useEffect(()=>{h()},[h]),p.useEffect(()=>{const g=setInterval(()=>{t||h()},d);return()=>clearInterval(g)},[h,t,d]);const u=p.useCallback(()=>{o(null),h()},[h]);return t?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_e,{className:"h-6 w-6 animate-spin text-blue-500"}),s.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):i?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx(et,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:i.message}),s.jsxs("button",{onClick:u,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(_e,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):n?s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights dashboard"})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",a.toLocaleTimeString()]}),s.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",d/1e3,"s intervals"]})]}),s.jsxs("button",{onClick:h,disabled:t,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors","aria-label":"Refresh control panel data",children:[s.jsx(_e,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsx(as,{title:"Total Sessions",value:n.overview.totalSessions,subtitle:"All time",icon:s.jsx(Dr,{className:"h-6 w-6"}),color:"text-blue-600"}),s.jsx(as,{title:"Unique Users",value:n.overview.uniqueUsers,subtitle:"Active users",icon:s.jsx(Ol,{className:"h-6 w-6"}),color:"text-green-600"}),s.jsx(as,{title:"Job Success Rate",value:`${n.overview.successRate}%`,subtitle:"Completed analyses",icon:s.jsx(Rl,{className:"h-6 w-6"}),color:"text-purple-600",trend:n.overview.successRate>75?"up":n.overview.successRate<50?"down":"neutral"}),s.jsx(as,{title:"Recent Activity",value:n.overview.recentActivity,subtitle:"Last 24 hours",icon:s.jsx(Mt,{className:"h-6 w-6"}),color:"text-orange-600",trend:n.overview.recentActivity>5?"up":n.overview.recentActivity===0?"down":"neutral"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsx(cs,{title:"Session Status Distribution",data:[{label:"Succeeded",value:n.sessionStatus.succeeded,color:"bg-green-500"},{label:"Processing",value:n.sessionStatus.processing,color:"bg-yellow-500"},{label:"Failed",value:n.sessionStatus.failed,color:"bg-red-500"}],total:n.sessionStatus.total}),s.jsx(cs,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:n.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:n.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:n.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:n.riskLevels.unknown,color:"bg-gray-500"}],total:n.riskLevels.total})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[s.jsx(cs,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:n.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:n.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:n.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:n.predictions.depression.severe,color:"bg-red-500"}],total:n.predictions.depression.total}),s.jsx(cs,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:n.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:n.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:n.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:n.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:n.predictions.anxiety.severe,color:"bg-red-700"}],total:n.predictions.anxiety.total})]}),s.jsx("div",{className:"mb-8",children:s.jsx(vf,{userStats:n.userStats})}),s.jsx("div",{className:"mb-8",children:s.jsx(bf,{title:"Depression vs Anxiety Correlation",depressionData:n.predictions.depression,anxietyData:n.predictions.anxiety})}),s.jsx("div",{className:"mb-8",children:s.jsx(wf,{title:"Session Completion Funnel",sessionStatus:n.sessionStatus})}),s.jsx("div",{className:"mb-8",children:s.jsx(xf,{title:"Sessions Over Time (7 Days)",data:n.timeData})}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Vi,{className:"h-5 w-5 mr-2 text-red-500"}),"System Health Overview"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.overview.successRate,"%"]}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Job Success Rate"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:n.overview.totalSessions}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Sessions"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:n.sessionStatus.processing}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Processing"})]})]})]})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:s.jsx("div",{className:"max-w-7xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})};class Cf extends ld.EventEmitter{constructor(t){super();Y(this,"recognition",null);Y(this,"synthesis",null);Y(this,"audioContext",null);Y(this,"microphone",null);Y(this,"analyzer",null);Y(this,"vadProcessor",null);Y(this,"stream",null);Y(this,"isListening",!1);Y(this,"isVADActive",!1);Y(this,"silenceTimeout",null);Y(this,"speechTimeout",null);Y(this,"config",{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:3,audioTracks:!0,noiseReduction:!0,echoCancellation:!0});this.config={...this.config,...t},this.initializeServices()}async initializeServices(){try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new t,this.setupSpeechRecognition()}"speechSynthesis"in window&&(this.synthesis=window.speechSynthesis),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.emit("initialized",{speechRecognition:!!this.recognition,speechSynthesis:!!this.synthesis,voiceActivityDetection:!!this.audioContext})}catch(t){console.error("Error initializing speech services:",t),this.emit("error",{type:"initialization",error:t})}}setupSpeechRecognition(){this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives,this.recognition.onstart=()=>{this.isListening=!0,this.emit("listening",{started:!0})},this.recognition.onresult=t=>{const r=[];for(let o=t.resultIndex;o<t.results.length;o++){const a=t.results[o],c=a[0].transcript,l=a[0].confidence,d=a.isFinal,h=[];for(let u=1;u<a.length&&u<this.config.maxAlternatives;u++)h.push(a[u].transcript);r.push({transcript:c,confidence:l,isFinal:d,alternatives:h})}this.emit("result",{results:r});const i=r.filter(o=>o.isFinal);i.length>0&&this.emit("finalResult",{results:i})},this.recognition.onerror=t=>{console.error("Speech recognition error:",t.error),this.emit("error",{type:"recognition",error:t.error}),(t.error==="no-speech"||t.error==="audio-capture")&&setTimeout(()=>this.restartRecognition(),1e3)},this.recognition.onend=()=>{this.isListening=!1,this.emit("listening",{started:!1}),this.config.continuous&&this.isVADActive&&setTimeout(()=>this.startListening(),100)})}async setupVoiceActivityDetection(){try{if(!this.audioContext)throw new Error("AudioContext not available");this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:this.config.echoCancellation,noiseSuppression:this.config.noiseReduction,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyzer=this.audioContext.createAnalyser(),this.vadProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.analyzer.fftSize=256,this.analyzer.smoothingTimeConstant=.8,this.microphone.connect(this.analyzer),this.analyzer.connect(this.vadProcessor),this.vadProcessor.connect(this.audioContext.destination),this.vadProcessor.onaudioprocess=t=>{this.processVAD(t)},this.emit("vadReady")}catch(t){console.error("Error setting up VAD:",t),this.emit("error",{type:"vad",error:t})}}processVAD(t){if(!this.analyzer)return;const r=this.analyzer.frequencyBinCount,i=new Uint8Array(r);this.analyzer.getByteFrequencyData(i);let o=0;for(let d=0;d<r;d++)o+=i[d];const a=o/r,l=a>30;this.emit("voiceActivity",{isActive:l,volume:a,timestamp:Date.now()}),l?(this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout||(this.speechTimeout=setTimeout(()=>{this.emit("speechStart")},200))):(this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null),this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.emit("speechEnd")},1500)))}async startListening(){try{if(!this.recognition)throw new Error("Speech recognition not available");this.isVADActive||(await this.setupVoiceActivityDetection(),this.isVADActive=!0),this.isListening||this.recognition.start()}catch(t){console.error("Error starting speech recognition:",t),this.emit("error",{type:"start",error:t})}}stopListening(){try{this.recognition&&this.isListening&&this.recognition.stop(),this.isVADActive=!1,this.vadProcessor&&this.vadProcessor.disconnect(),this.analyzer&&this.analyzer.disconnect(),this.microphone&&this.microphone.disconnect(),this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null)}catch(t){console.error("Error stopping speech recognition:",t),this.emit("error",{type:"stop",error:t})}}restartRecognition(){this.isVADActive&&(this.stopListening(),setTimeout(()=>this.startListening(),500))}async speak(t,r){return new Promise((i,o)=>{if(!this.synthesis){o(new Error("Speech synthesis not available"));return}r!=null&&r.interrupt&&this.synthesis.cancel();const a=new SpeechSynthesisUtterance(t);a.rate=(r==null?void 0:r.rate)||.9,a.pitch=(r==null?void 0:r.pitch)||1,a.volume=(r==null?void 0:r.volume)||.8,r!=null&&r.voice&&(a.voice=r.voice),a.onend=()=>{this.emit("speechEnd",{text:t}),i()},a.onerror=c=>{this.emit("error",{type:"synthesis",error:c.error}),o(new Error(`Speech synthesis error: ${c.error}`))},a.onstart=()=>{this.emit("speechStart",{text:t})},this.synthesis.speak(a)})}getAvailableVoices(){return this.synthesis?this.synthesis.getVoices():[]}updateConfig(t){this.config={...this.config,...t},this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives)}isAvailable(){return!!(this.recognition&&this.synthesis)}isCurrentlyListening(){return this.isListening}destroy(){this.stopListening(),this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.removeAllListeners()}}const Sf=(n={})=>{const e=p.useRef(null),[t,r]=p.useState(!1),[i,o]=p.useState(!1),[a,c]=p.useState(!1),[l,d]=p.useState(0),[h,u]=p.useState(null),[g,A]=p.useState(!1),[E,T]=p.useState([]);p.useEffect(()=>{e.current=new Cf(n.config);const M=e.current;return M.on("initialized",D=>{o(D.speechRecognition&&D.speechSynthesis),A(!0),T(M.getAvailableVoices())}),M.on("listening",({started:D})=>{r(D)}),M.on("result",({results:D})=>{var C;(C=n.onResult)==null||C.call(n,D)}),M.on("finalResult",({results:D})=>{var C;(C=n.onFinalResult)==null||C.call(n,D)}),M.on("voiceActivity",D=>{var C;c(D.isActive),d(D.volume),(C=n.onVoiceActivity)==null||C.call(n,D)}),M.on("speechStart",()=>{var D;(D=n.onSpeechStart)==null||D.call(n)}),M.on("speechEnd",()=>{var D;(D=n.onSpeechEnd)==null||D.call(n)}),M.on("error",({type:D,error:C})=>{var f;const y=`Speech ${D} error: ${C}`;u(y),(f=n.onError)==null||f.call(n,{type:D,error:C}),console.error(y)}),n.autoStart&&M.startListening().catch(console.error),()=>{M.destroy()}},[]);const k=p.useCallback(async()=>{try{u(null),e.current&&await e.current.startListening()}catch(M){const D=M instanceof Error?M.message:"Failed to start listening";throw u(D),M}},[]),P=p.useCallback(()=>{try{u(null),e.current&&e.current.stopListening()}catch(M){const D=M instanceof Error?M.message:"Failed to stop listening";u(D)}},[]),j=p.useCallback(async(M,D)=>{try{u(null),e.current&&await e.current.speak(M,D)}catch(C){const y=C instanceof Error?C.message:"Failed to speak";throw u(y),C}},[]),G=p.useCallback(M=>{e.current&&e.current.updateConfig(M)},[]);return p.useEffect(()=>{if(g&&e.current){const M=()=>{T(e.current.getAvailableVoices())};if(M(),"speechSynthesis"in window)return window.speechSynthesis.addEventListener("voiceschanged",M),()=>{window.speechSynthesis.removeEventListener("voiceschanged",M)}}},[g]),{isListening:t,isAvailable:i,isVoiceActive:a,volume:l,startListening:k,stopListening:P,speak:j,updateConfig:G,availableVoices:E,error:h,isInitialized:g}};class Ft extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class Wi extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class at extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class _f extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class Af extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class If extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class ea extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Tf extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class Ll{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class tn{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var S;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(S||(S={}));class Hr{constructor(){}log(e,t){}}Hr.instance=new Hr;const Nf="9.0.6";class ve{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class pe{static get isBrowser(){return!pe.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!pe.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!pe.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Fr(n,e){let t="";return Vt(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${Ef(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Ef(n){const e=new Uint8Array(n);let t="";return e.forEach(r=>{const i=r<16?"0":"";t+=`0x${i}${r.toString(16)} `}),t.substr(0,t.length-1)}function Vt(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Ul(n,e,t,r,i,o){const a={},[c,l]=ar();a[c]=l,n.log(S.Trace,`(${e} transport) sending data. ${Fr(i,o.logMessageContent)}.`);const d=Vt(i)?"arraybuffer":"text",h=await t.post(r,{content:i,headers:{...a,...o.headers},responseType:d,timeout:o.timeout,withCredentials:o.withCredentials});n.log(S.Trace,`(${e} transport) request complete. Response status: ${h.statusCode}.`)}function Rf(n){return n===void 0?new Ms(S.Information):n===null?Hr.instance:n.log!==void 0?n:new Ms(n)}class jf{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class Ms{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${S[e]}: ${t}`;switch(e){case S.Critical:case S.Error:this.out.error(r);break;case S.Warning:this.out.warn(r);break;case S.Information:this.out.info(r);break;default:this.out.log(r);break}}}}function ar(){let n="X-SignalR-User-Agent";return pe.isNode&&(n="User-Agent"),[n,Pf(Nf,Of(),Df(),Mf())]}function Pf(n,e,t,r){let i="Microsoft SignalR/";const o=n.split(".");return i+=`${o[0]}.${o[1]}`,i+=` (${n}; `,e&&e!==""?i+=`${e}; `:i+="Unknown OS; ",i+=`${t}`,r?i+=`; ${r}`:i+="; Unknown Runtime Version",i+=")",i}function Of(){if(pe.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Mf(){if(pe.isNode)return process.versions.node}function Df(){return pe.isNode?"NodeJS":"Browser"}function gn(n){return n.stack?n.stack:n.message?n.message:`${n}`}function Lf(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("could not find globalThis")}class Uf extends tn{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||pe.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Lf());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new at;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new at});let i=null;if(e.timeout){const l=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(S.Warning,"Timeout from HTTP request."),r=new Wi},l)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Vt(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(l){throw r||(this._logger.log(S.Warning,`Error from HTTP request. ${l}.`),l)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const l=await ta(o,"text");throw new Ft(l||o.statusText,o.status)}const c=await ta(o,e.responseType);return new Ll(o.status,o.statusText,c)}getCookieString(e){let t="";return pe.isNode&&this._jar&&this._jar.getCookies(e,(r,i)=>t=i.join("; ")),t}}function ta(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class Hf extends tn{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new at):e.method?e.url?new Promise((t,r)=>{const i=new XMLHttpRequest;i.open(e.method,e.url,!0),i.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Vt(e.content)?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach(a=>{i.setRequestHeader(a,o[a])}),e.responseType&&(i.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{i.abort(),r(new at)}),e.timeout&&(i.timeout=e.timeout),i.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),i.status>=200&&i.status<300?t(new Ll(i.status,i.statusText,i.response||i.responseText)):r(new Ft(i.response||i.responseText||i.statusText,i.status))},i.onerror=()=>{this._logger.log(S.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}.`),r(new Ft(i.statusText,i.status))},i.ontimeout=()=>{this._logger.log(S.Warning,"Timeout from HTTP request."),r(new Wi)},i.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Ff extends tn{constructor(e){if(super(),typeof fetch<"u"||pe.isNode)this._httpClient=new Uf(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new Hf(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new at):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class We{static write(e){return`${e}${We.RecordSeparator}`}static parse(e){if(e[e.length-1]!==We.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(We.RecordSeparator);return t.pop(),t}}We.RecordSeparatorCode=30;We.RecordSeparator=String.fromCharCode(We.RecordSeparatorCode);class $f{writeHandshakeRequest(e){return We.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Vt(e)){const c=new Uint8Array(e),l=c.indexOf(We.RecordSeparatorCode);if(l===-1)throw new Error("Message is incomplete.");const d=l+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,d))),r=c.byteLength>d?c.slice(d).buffer:null}else{const c=e,l=c.indexOf(We.RecordSeparator);if(l===-1)throw new Error("Message is incomplete.");const d=l+1;t=c.substring(0,d),r=c.length>d?c.substring(d):null}const i=We.parse(t),o=JSON.parse(i[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[r,o]}}var V;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(V||(V={}));class Bf{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new jf(this,e)}}class Kf{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let i=()=>{},o=()=>{};Vt(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((a,c)=>{i=a,o=c})),this._messages.push(new zf(t,this._totalMessageCount,i,o))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const i=this._messages[r];if(i._id<=e.sequenceId)t=r,Vt(i._message)?this._bufferedByteCount-=i._message.byteLength:this._bufferedByteCount-=i._message.length,i._resolver();else if(this._bufferedByteCount<this._bufferSize)i._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==V.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:V.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case V.Invocation:case V.StreamItem:case V.Completion:case V.StreamInvocation:case V.CancelInvocation:return!0;case V.Close:case V.Sequence:case V.Ping:case V.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:V.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class zf{constructor(e,t,r,i){this._message=e,this._id=t,this._resolver=r,this._rejector=i}}const Gf=30*1e3,qf=15*1e3,Vf=1e5;var Z;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(Z||(Z={}));class Qi{static create(e,t,r,i,o,a,c){return new Qi(e,t,r,i,o,a,c)}constructor(e,t,r,i,o,a,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(S.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},ve.isRequired(e,"connection"),ve.isRequired(t,"logger"),ve.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=o??Gf,this.keepAliveIntervalInMilliseconds=a??qf,this._statefulReconnectBufferSize=c??Vf,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=i,this._handshakeProtocol=new $f,this.connection.onreceive=l=>this._processIncomingData(l),this.connection.onclose=l=>this._connectionClosed(l),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Z.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:V.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==Z.Disconnected&&this._connectionState!==Z.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Z.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Z.Connecting,this._logger.log(S.Debug,"Starting HubConnection.");try{await this._startInternal(),pe.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Z.Connected,this._connectionStarted=!0,this._logger.log(S.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=Z.Disconnected,this._logger.log(S.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(S.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(S.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new Kf(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(S.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===Z.Disconnected)return this._logger.log(S.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Z.Disconnecting)return this._logger.log(S.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=Z.Disconnecting,this._logger.log(S.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(S.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===Z.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new at("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,i);let a;const c=new Bf;return c.cancelCallback=()=>{const l=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],a.then(()=>this._sendWithProtocol(l))},this._callbacks[o.invocationId]=(l,d)=>{if(d){c.error(d);return}else l&&(l.type===V.Completion?l.error?c.error(new Error(l.error)):c.complete():c.next(l.item))},a=this._sendWithProtocol(o).catch(l=>{c.error(l),delete this._callbacks[o.invocationId]}),this._launchStreams(r,a),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,i));return this._launchStreams(r,o),o}invoke(e,...t){const[r,i]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,i);return new Promise((c,l)=>{this._callbacks[o.invocationId]=(h,u)=>{if(u){l(u);return}else h&&(h.type===V.Completion?h.error?l(new Error(h.error)):c(h.result):l(new Error(`Unexpected message type: ${h.type}`)))};const d=this._sendWithProtocol(o).catch(h=>{l(h),delete this._callbacks[o.invocationId]});this._launchStreams(r,d)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const i=r.indexOf(t);i!==-1&&(r.splice(i,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(r)))switch(r.type){case V.Invocation:this._invokeClientMethod(r).catch(i=>{this._logger.log(S.Error,`Invoke client method threw error: ${gn(i)}`)});break;case V.StreamItem:case V.Completion:{const i=this._callbacks[r.invocationId];if(i){r.type===V.Completion&&delete this._callbacks[r.invocationId];try{i(r)}catch(o){this._logger.log(S.Error,`Stream callback threw error: ${gn(o)}`)}}break}case V.Ping:break;case V.Close:{this._logger.log(S.Information,"Close message received from server.");const i=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(i):this._stopPromise=this._stopInternal(i);break}case V.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case V.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(S.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(i){const o="Error parsing handshake response: "+i;this._logger.log(S.Error,o);const a=new Error(o);throw this._handshakeRejecter(a),a}if(t.error){const i="Server returned handshake error: "+t.error;this._logger.log(S.Error,i);const o=new Error(i);throw this._handshakeRejecter(o),o}else this._logger.log(S.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===Z.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r){this._logger.log(S.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(S.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const i=r.slice(),o=!!e.invocationId;let a,c,l;for(const d of i)try{const h=a;a=await d.apply(this,e.arguments),o&&a&&h&&(this._logger.log(S.Error,`Multiple results provided for '${t}'. Sending error to server.`),l=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(h){c=h,this._logger.log(S.Error,`A callback for the method '${t}' threw error '${h}'.`)}l?await this._sendWithProtocol(l):o?(c?l=this._createCompletionMessage(e.invocationId,`${c}`,null):a!==void 0?l=this._createCompletionMessage(e.invocationId,null,a):(this._logger.log(S.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),l=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(l)):a&&this._logger.log(S.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(S.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new at("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Z.Disconnecting?this._completeClose(e):this._connectionState===Z.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===Z.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=Z.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),pe.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(S.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,i=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(r++,0,i);if(o===null){this._logger.log(S.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=Z.Reconnecting,e?this._logger.log(S.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(S.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(a=>a.apply(this,[e]))}catch(a){this._logger.log(S.Error,`An onreconnecting callback called with error '${e}' threw error '${a}'.`)}if(this._connectionState!==Z.Reconnecting){this._logger.log(S.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(S.Information,`Reconnect attempt number ${r} will start in ${o} ms.`),await new Promise(a=>{this._reconnectDelayHandle=setTimeout(a,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==Z.Reconnecting){this._logger.log(S.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=Z.Connected,this._logger.log(S.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(a=>a.apply(this,[this.connection.connectionId]))}catch(a){this._logger.log(S.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${a}'.`)}return}catch(a){if(this._logger.log(S.Information,`Reconnect attempt failed because of error '${a}'.`),this._connectionState!==Z.Reconnecting){this._logger.log(S.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===Z.Disconnecting&&this._completeClose();return}i=a instanceof Error?a:new Error(a.toString()),o=this._getNextRetryDelay(r++,Date.now()-t,i)}}this._logger.log(S.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(i){return this._logger.log(S.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${i}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const i=t[r];try{i(null,e)}catch(o){this._logger.log(S.Error,`Stream 'error' callback called with '${e}' threw error: ${gn(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,i){if(r)return i.length!==0?{target:e,arguments:t,streamIds:i,type:V.Invocation}:{target:e,arguments:t,type:V.Invocation};{const o=this._invocationId;return this._invocationId++,i.length!==0?{target:e,arguments:t,invocationId:o.toString(),streamIds:i,type:V.Invocation}:{target:e,arguments:t,invocationId:o.toString(),type:V.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:i=>{let o;i instanceof Error?o=i.message:i&&i.toString?o=i.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,o)))},next:i=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,i)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let i=0;i<e.length;i++){const o=e[i];if(this._isObservable(o)){const a=this._invocationId;this._invocationId++,t[a]=o,r.push(a.toString()),e.splice(i,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const i=this._invocationId;return this._invocationId++,r.length!==0?{target:e,arguments:t,invocationId:i.toString(),streamIds:r,type:V.StreamInvocation}:{target:e,arguments:t,invocationId:i.toString(),type:V.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:V.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:V.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:V.Completion}:{invocationId:e,result:r,type:V.Completion}}_createCloseMessage(){return{type:V.Close}}}const Wf=[0,2e3,1e4,3e4,null];class ra{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Wf}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class $t{}$t.Authorization="Authorization";$t.Cookie="Cookie";class Qf extends tn{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[$t.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[$t.Authorization]&&delete e.headers[$t.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var ke;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(ke||(ke={}));var De;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(De||(De={}));let Yf=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class sa{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new Yf,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(ve.isRequired(e,"url"),ve.isRequired(t,"transferFormat"),ve.isIn(t,De,"transferFormat"),this._url=e,this._logger.log(S.Trace,"(LongPolling transport) Connecting."),t===De.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,i]=ar(),o={[r]:i,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===De.Binary&&(a.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(S.Trace,`(LongPolling transport) polling: ${c}.`);const l=await this._httpClient.get(c,a);l.statusCode!==200?(this._logger.log(S.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this._closeError=new Ft(l.statusText||"",l.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(S.Trace,`(LongPolling transport) polling: ${r}.`);const i=await this._httpClient.get(r,t);i.statusCode===204?(this._logger.log(S.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):i.statusCode!==200?(this._logger.log(S.Error,`(LongPolling transport) Unexpected response code: ${i.statusCode}.`),this._closeError=new Ft(i.statusText||"",i.statusCode),this._running=!1):i.content?(this._logger.log(S.Trace,`(LongPolling transport) data received. ${Fr(i.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(i.content)):this._logger.log(S.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof Wi?this._logger.log(S.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(S.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(S.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Ul(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(S.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(S.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=ar();e[t]=r;const i={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,i)}catch(a){o=a}o?o instanceof Ft&&(o.statusCode===404?this._logger.log(S.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(S.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(S.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(S.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(S.Trace,e),this.onclose(this._closeError)}}}class Jf{constructor(e,t,r,i){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=i,this.onreceive=null,this.onclose=null}async connect(e,t){return ve.isRequired(e,"url"),ve.isRequired(t,"transferFormat"),ve.isIn(t,De,"transferFormat"),this._logger.log(S.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,i)=>{let o=!1;if(t!==De.Text){i(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let a;if(pe.isBrowser||pe.isWebWorker)a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),l={};l.Cookie=c;const[d,h]=ar();l[d]=h,a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...l,...this._options.headers}})}try{a.onmessage=c=>{if(this.onreceive)try{this._logger.log(S.Trace,`(SSE transport) data received. ${Fr(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(l){this._close(l);return}},a.onerror=c=>{o?this._close():i(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},a.onopen=()=>{this._logger.log(S.Information,`SSE connected to ${this._url}`),this._eventSource=a,o=!0,r()}}catch(c){i(c);return}})}async send(e){return this._eventSource?Ul(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class Xf{constructor(e,t,r,i,o,a){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=i,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,t){ve.isRequired(e,"url"),ve.isRequired(t,"transferFormat"),ve.isIn(t,De,"transferFormat"),this._logger.log(S.Trace,"(WebSockets transport) Connecting.");let r;return this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((i,o)=>{e=e.replace(/^http/,"ws");let a;const c=this._httpClient.getCookieString(e);let l=!1;if(pe.isNode||pe.isReactNative){const d={},[h,u]=ar();d[h]=u,r&&(d[$t.Authorization]=`Bearer ${r}`),c&&(d[$t.Cookie]=c),a=new this._webSocketConstructor(e,void 0,{headers:{...d,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);a||(a=new this._webSocketConstructor(e)),t===De.Binary&&(a.binaryType="arraybuffer"),a.onopen=d=>{this._logger.log(S.Information,`WebSocket connected to ${e}.`),this._webSocket=a,l=!0,i()},a.onerror=d=>{let h=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?h=d.error:h="There was an error with the transport",this._logger.log(S.Information,`(WebSockets transport) ${h}.`)},a.onmessage=d=>{if(this._logger.log(S.Trace,`(WebSockets transport) data received. ${Fr(d.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(d.data)}catch(h){this._close(h);return}},a.onclose=d=>{if(l)this._close(d);else{let h=null;typeof ErrorEvent<"u"&&d instanceof ErrorEvent?h=d.error:h="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(h))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(S.Trace,`(WebSockets transport) sending data. ${Fr(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(S.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const na=100;class Zf{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,ve.isRequired(e,"url"),this._logger=Rf(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let r=null,i=null;if(pe.isNode&&typeof require<"u"){const o=typeof __webpack_require__=="function"?__non_webpack_require__:require;r=o("ws"),i=o("eventsource")}!pe.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:pe.isNode&&!t.WebSocket&&r&&(t.WebSocket=r),!pe.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:pe.isNode&&!t.EventSource&&typeof i<"u"&&(t.EventSource=i),this._httpClient=new Qf(t.httpClient||new Ff(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||De.Binary,ve.isIn(e,De,"transferFormat"),this._logger.log(S.Debug,`Starting connection with transfer format '${De[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(S.Error,t),await this._stopPromise,Promise.reject(new at(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(S.Error,t),Promise.reject(new at(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Yi(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(S.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(S.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(S.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(S.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===ke.WebSockets)this.transport=this._constructTransport(ke.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,i=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new at("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const o=r.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}i++}while(r.url&&i<na);if(i===na&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof sa&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(S.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(S.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,i]=ar();t[r]=i;const o=this._resolveNegotiateUrl(e);this._logger.log(S.Debug,`Sending negotiation request: ${o}.`);try{const a=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(a.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${a.statusCode}'`));const c=JSON.parse(a.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new ea("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(a){let c="Failed to complete negotiation with the server: "+a;return a instanceof Ft&&a.statusCode===404&&(c=c+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(S.Error,c),Promise.reject(new ea(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,i){let o=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t)){this._logger.log(S.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,i),this.connectionId=r.connectionId;return}const a=[],c=r.availableTransports||[];let l=r;for(const d of c){const h=this._resolveTransportOrError(d,t,i,(l==null?void 0:l.useStatefulReconnect)===!0);if(h instanceof Error)a.push(`${d.transport} failed:`),a.push(h);else if(this._isITransport(h)){if(this.transport=h,!l){try{l=await this._getNegotiationResponse(e)}catch(u){return Promise.reject(u)}o=this._createConnectUrl(e,l.connectionToken)}try{await this._startTransport(o,i),this.connectionId=l.connectionId;return}catch(u){if(this._logger.log(S.Error,`Failed to start the transport '${d.transport}': ${u}`),l=void 0,a.push(new If(`${d.transport} failed: ${u}`,ke[d.transport])),this._connectionState!=="Connecting"){const g="Failed to select transport before stop() was called.";return this._logger.log(S.Debug,g),Promise.reject(new at(g))}}}}return a.length>0?Promise.reject(new Tf(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case ke.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Xf(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ke.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Jf(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ke.LongPolling:return new sa(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let i=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{i=!0}else{this._stopConnection(r);return}i&&this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,i){const o=ke[e.transport];if(o==null)return this._logger.log(S.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(ey(t,o))if(e.transferFormats.map(c=>De[c]).indexOf(r)>=0){if(o===ke.WebSockets&&!this._options.WebSocket||o===ke.ServerSentEvents&&!this._options.EventSource)return this._logger.log(S.Debug,`Skipping transport '${ke[o]}' because it is not supported in your environment.'`),new _f(`'${ke[o]}' is not supported in your environment.`,o);this._logger.log(S.Debug,`Selecting transport '${ke[o]}'.`);try{return this.features.reconnect=o===ke.WebSockets?i:void 0,this._constructTransport(o)}catch(c){return c}}else return this._logger.log(S.Debug,`Skipping transport '${ke[o]}' because it does not support the requested transfer format '${De[r]}'.`),new Error(`'${ke[o]}' does not support ${De[r]}.`);else return this._logger.log(S.Debug,`Skipping transport '${ke[o]}' because it was disabled by the client.`),new Af(`'${ke[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(S.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(S.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(S.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(S.Error,`Connection disconnected with error '${e}'.`):this._logger.log(S.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(S.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(S.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!pe.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(S.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}function ey(n,e){return!n||(e&n)!==0}class Yi{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new ls,this._transportResult=new ls,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new ls),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new ls;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):Yi._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(o=>o.byteLength).reduce((o,a)=>o+a),r=new Uint8Array(t);let i=0;for(const o of e)r.set(new Uint8Array(o),i),i+=o.byteLength;return r.buffer}}class ls{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const ty="json";class ry{constructor(){this.name=ty,this.version=2,this.transferFormat=De.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Hr.instance);const r=We.parse(e),i=[];for(const o of r){const a=JSON.parse(o);if(typeof a.type!="number")throw new Error("Invalid payload.");switch(a.type){case V.Invocation:this._isInvocationMessage(a);break;case V.StreamItem:this._isStreamItemMessage(a);break;case V.Completion:this._isCompletionMessage(a);break;case V.Ping:break;case V.Close:break;case V.Ack:this._isAckMessage(a);break;case V.Sequence:this._isSequenceMessage(a);break;default:t.log(S.Information,"Unknown message type '"+a.type+"' ignored.");continue}i.push(a)}return i}writeMessage(e){return We.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const sy={trace:S.Trace,debug:S.Debug,info:S.Information,information:S.Information,warn:S.Warning,warning:S.Warning,error:S.Error,critical:S.Critical,none:S.None};function ny(n){const e=sy[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}class iy{configureLogging(e){if(ve.isRequired(e,"logging"),oy(e))this.logger=e;else if(typeof e=="string"){const t=ny(e);this.logger=new Ms(t)}else this.logger=new Ms(e);return this}withUrl(e,t){return ve.isRequired(e,"url"),ve.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return ve.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new ra(e):this.reconnectPolicy=e:this.reconnectPolicy=new ra,this}withServerTimeout(e){return ve.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return ve.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new Zf(this.url,e);return Qi.create(t,this.logger||Hr.instance,this.protocol||new ry,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function oy(n){return n.log!==void 0}class ay{constructor(e="http://localhost:7071"){Y(this,"connection",null);Y(this,"sessionId",null);Y(this,"onAgentMessageHandler");Y(this,"onHandoffHandler");Y(this,"onAgentTypingHandler");Y(this,"onSessionStatusHandler");Y(this,"onErrorHandler");this.baseUrl=e,this.setupConnection()}setupConnection(){this.connection=new iy().withUrl(`${this.baseUrl}/api`).withAutomaticReconnect().configureLogging(S.Information).build(),this.connection.on("AgentMessage",e=>{var t;console.log("Received agent message:",e),(t=this.onAgentMessageHandler)==null||t.call(this,e)}),this.connection.on("AgentHandoff",e=>{var t;console.log("Received handoff notification:",e),(t=this.onHandoffHandler)==null||t.call(this,e)}),this.connection.on("AgentTyping",e=>{var t;console.log("Received typing notification:",e),(t=this.onAgentTypingHandler)==null||t.call(this,e)}),this.connection.on("SessionStatus",e=>{var t;console.log("Received session status:",e),(t=this.onSessionStatusHandler)==null||t.call(this,e)}),this.connection.onreconnecting(()=>{console.log("SignalR reconnecting...")}),this.connection.onreconnected(()=>{console.log("SignalR reconnected"),this.sessionId&&this.joinSession(this.sessionId)}),this.connection.onclose(e=>{var t;console.error("SignalR connection closed:",e),(t=this.onErrorHandler)==null||t.call(this,`Connection closed: ${(e==null?void 0:e.message)||"Unknown error"}`)})}async start(){if(!this.connection)throw new Error("SignalR connection not initialized");try{await this.connection.start(),console.log("SignalR connection started")}catch(e){throw console.error("Error starting SignalR connection:",e),e}}async stop(){this.connection&&this.connection.state===Z.Connected&&(await this.connection.stop(),console.log("SignalR connection stopped"))}async joinSession(e){if(!this.connection||this.connection.state!==Z.Connected)throw new Error("SignalR connection is not active");try{this.sessionId=e,await this.connection.invoke("JoinSession",e),console.log(`Joined session: ${e}`)}catch(t){throw console.error("Error joining session:",t),t}}async sendUserMessage(e){if(!this.connection||this.connection.state!==Z.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)throw new Error("No active session");try{await this.connection.invoke("SendUserMessage",this.sessionId,e),console.log("User message sent:",e)}catch(t){throw console.error("Error sending user message:",t),t}}async getSessionStatus(){if(!this.connection||this.connection.state!==Z.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)return null;try{return await this.connection.invoke("GetSessionStatus",this.sessionId)}catch(e){throw console.error("Error getting session status:",e),e}}onAgentMessage(e){this.onAgentMessageHandler=e}onAgentHandoff(e){this.onHandoffHandler=e}onAgentTyping(e){this.onAgentTypingHandler=e}onSessionStatus(e){this.onSessionStatusHandler=e}onError(e){this.onErrorHandler=e}get connectionState(){var e;return((e=this.connection)==null?void 0:e.state)||Z.Disconnected}get isConnected(){var e;return((e=this.connection)==null?void 0:e.state)===Z.Connected}get currentSessionId(){return this.sessionId}dispose(){this.stop(),this.connection=null,this.sessionId=null,this.onAgentMessageHandler=void 0,this.onHandoffHandler=void 0,this.onAgentTypingHandler=void 0,this.onSessionStatusHandler=void 0,this.onErrorHandler=void 0}}const qe=new ay,cy=()=>{const[n,e]=p.useState(Z.Disconnected),[t,r]=p.useState(!1),[i,o]=p.useState(null),[a,c]=p.useState(null),[l,d]=p.useState(null),[h,u]=p.useState([]),[g,A]=p.useState([]),[E,T]=p.useState({}),k=p.useRef(!1);p.useEffect(()=>{if(k.current)return;k.current=!0,qe.onAgentMessage(f=>{u(x=>[...x,f])}),qe.onAgentHandoff(f=>{A(x=>[...x,f])}),qe.onAgentTyping(f=>{T(x=>({...x,[f.agentName]:f.isTyping}))}),qe.onSessionStatus(f=>{d(f)}),qe.onError(f=>{o(f)});const y=setInterval(()=>{const f=qe.connectionState;e(f),r(f===Z.Connected)},1e3);return()=>{clearInterval(y),qe.dispose()}},[]);const P=p.useCallback(async()=>{try{o(null),await qe.start(),r(!0)}catch(y){const f=y instanceof Error?y.message:"Failed to connect";throw o(f),y}},[]),j=p.useCallback(async()=>{try{await qe.stop(),r(!1),c(null),d(null)}catch(y){const f=y instanceof Error?y.message:"Failed to disconnect";throw o(f),y}},[]),G=p.useCallback(async y=>{try{o(null),await qe.joinSession(y),c(y);const f=await qe.getSessionStatus();d(f)}catch(f){const x=f instanceof Error?f.message:"Failed to join session";throw o(x),f}},[]),M=p.useCallback(async y=>{try{o(null),await qe.sendUserMessage(y)}catch(f){const x=f instanceof Error?f.message:"Failed to send message";throw o(x),f}},[]),D=p.useCallback(()=>{u([]),A([]),T({})},[]),C=p.useCallback(async()=>{try{const y=await qe.getSessionStatus();d(y)}catch(y){const f=y instanceof Error?y.message:"Failed to refresh session status";throw o(f),y}},[]);return{connectionState:n,isConnected:t,error:i,sessionId:a,sessionStatus:l,agentMessages:h,handoffNotifications:g,agentTyping:E,connect:P,disconnect:j,joinSession:G,sendMessage:M,clearMessages:D,refreshSessionStatus:C}},ly=({volume:n,isVoiceActive:e,isListening:t,size:r="md",className:i=""})=>{const o={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},a=r==="sm"?3:r==="md"?5:7,c=r==="sm"?16:r==="md"?24:32,l=Math.min(n/100,1);return s.jsx("div",{className:`flex items-center justify-center ${o[r]} ${i}`,children:s.jsx("div",{className:"flex items-end space-x-1 h-full",children:Array.from({length:a}).map((d,h)=>{const u=h/a,g=t&&(e||h===0),A=l>u,E=g&&A?Math.max(4,l*c):4,T=h*100;return s.jsx("div",{className:`w-1 transition-all duration-150 rounded-sm voice-bar ${g?A?"bg-green-500 animate-pulse":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700"}`,"data-height":E,"data-delay":T},h)})})})},dy=({config:n,availableVoices:e,selectedVoice:t,onConfigUpdate:r,onVoiceSelect:i,isOpen:o,onClose:a})=>{const[c,l]=p.useState(n),d=(u,g)=>{const A={...c,[u]:g};l(A),r({[u]:g})},h=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French (France)"},{code:"de-DE",name:"German (Germany)"},{code:"it-IT",name:"Italian (Italy)"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"}];return o?s.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"speech-settings-title",role:"dialog","aria-modal":"true",children:s.jsxs("div",{className:"flex items-center justify-center min-h-full p-4",children:[s.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:a}),s.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(El,{className:"h-6 w-6 text-primary-600 dark:text-primary-400"}),s.jsx("h2",{id:"speech-settings-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Speech Settings"})]}),s.jsxs("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Close settings",children:[s.jsx("span",{className:"sr-only",children:"Close"}),s.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Nl,{className:"h-5 w-5 text-gray-500"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Recognition"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[s.jsx(Ip,{className:"inline h-4 w-4 mr-1"}),"Language"]}),s.jsx("select",{value:c.language,onChange:u=>d("language",u.target.value),title:"Select language for speech recognition",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:h.map(u=>s.jsx("option",{value:u.code,children:u.name},u.code))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recognition Alternatives"}),s.jsxs("select",{value:c.maxAlternatives,onChange:u=>d("maxAlternatives",parseInt(u.target.value)),title:"Select number of recognition alternatives",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:1,children:"1 (fastest)"}),s.jsx("option",{value:2,children:"2 (balanced)"}),s.jsx("option",{value:3,children:"3 (best accuracy)"})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.continuous,onChange:u=>d("continuous",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Continuous listening (auto-restart)"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.interimResults,onChange:u=>d("interimResults",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Show interim results (real-time transcription)"})]})]})]}),s.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Audio Processing"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.noiseReduction,onChange:u=>d("noiseReduction",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.echoCancellation,onChange:u=>d("echoCancellation",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Echo cancellation"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.audioTracks,onChange:u=>d("audioTracks",u.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Enhanced audio processing"})]})]})]}),s.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ur,{className:"h-5 w-5 text-gray-500"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Synthesis"})]}),s.jsxs("button",{onClick:()=>window.speechSynthesis.getVoices(),className:"flex items-center space-x-1 px-3 py-1 text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",title:"Refresh available voices",children:[s.jsx(_e,{className:"h-4 w-4"}),s.jsx("span",{children:"Refresh"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Selection"}),s.jsxs("select",{value:(t==null?void 0:t.name)||"",onChange:u=>{const g=e.find(A=>A.name===u.target.value);g&&i(g)},title:"Select voice for speech synthesis",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[s.jsx("option",{value:"",children:"Default system voice"}),e.map((u,g)=>s.jsxs("option",{value:u.name,children:[u.name," (",u.lang,") ",u.default?"(Default)":""]},g))]}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[e.length," voices available"]})]}),t&&s.jsx("div",{children:s.jsxs("button",{onClick:()=>{const u=new SpeechSynthesisUtterance("Hello! This is a test of the selected voice.");u.voice=t,window.speechSynthesis.speak(u)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-800 dark:text-primary-200 dark:hover:bg-primary-700",children:[s.jsx(Ur,{className:"h-4 w-4 mr-1"}),"Test Voice"]})})]})]}),s.jsx("div",{className:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:s.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",children:"Close"})})]})]})}):null},hy=()=>{const{handleEnterSpace:n}=Cl(),[e,t]=p.useState([]),[r,i]=p.useState(""),[o,a]=p.useState(!1),[c,l]=p.useState({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),[d,h]=p.useState(!1),[u,g]=p.useState(!1),[A,E]=p.useState(),T=p.useRef(null),k=p.useRef(null),P=cy(),j=Sf({config:{continuous:!0,interimResults:!0,language:"en-US",maxAlternatives:2},onFinalResult:x=>{x.length>0&&x[0].transcript.trim()&&(i(x[0].transcript.trim()),Re(`Voice input captured: ${x[0].transcript}`))},onVoiceActivity:x=>{},onError:x=>{console.error("Advanced speech error:",x),Re("Voice input error occurred")}});p.useEffect(()=>{var x;(x=T.current)==null||x.scrollIntoView({behavior:"smooth"})},[e]),p.useEffect(()=>((async()=>{try{P.isConnected||(await P.connect(),Re("Connected to real-time communication"));const w=`session-${Date.now()}`;await P.joinSession(w),Re("Joined communication session")}catch(w){console.error("Failed to initialize SignalR:",w),Re("Failed to connect to real-time communication")}})(),()=>{P.disconnect()}),[P]),p.useEffect(()=>{if(P.agentMessages.length>0){const x=P.agentMessages[P.agentMessages.length-1],w={id:`signalr-${Date.now()}`,content:x.content,role:"assistant",timestamp:new Date(x.timestamp)};t(v=>v.some(Q=>Q.content===w.content&&Math.abs(Q.timestamp.getTime()-w.timestamp.getTime())<1e3)?v:[...v,w]),l(v=>({...v,name:x.agentName,id:x.agentName.toLowerCase().replace(/\s+/g,"-"),isTyping:!1})),M(x.content),Re(`Message from ${x.agentName}: ${x.content}`)}},[P.agentMessages]),p.useEffect(()=>{if(P.handoffNotifications.length>0){const x=P.handoffNotifications[P.handoffNotifications.length-1];l(v=>({...v,name:x.toAgent,id:x.toAgent.toLowerCase().replace(/\s+/g,"-"),isTyping:!1}));const w={id:`handoff-${Date.now()}`,content:`Agent handoff: ${x.reason}. You are now speaking with ${x.toAgent}.`,role:"assistant",timestamp:new Date(x.timestamp)};t(v=>[...v,w]),Re(`Agent handoff: You are now speaking with ${x.toAgent}`)}},[P.handoffNotifications]),p.useEffect(()=>{Object.keys(P.agentTyping).filter(w=>P.agentTyping[w]).length>0?l(w=>({...w,isTyping:!0})):l(w=>({...w,isTyping:!1}))},[P.agentTyping]),p.useEffect(()=>{t([{id:"1",content:"Hello! I'm your behavioral health assistant. I can help you with depression screenings, provide support, or just have a friendly conversation. What would you like to explore today?",role:"assistant",timestamp:new Date}])},[]);const G=async()=>{try{j.isListening?(j.stopListening(),Re("Voice input stopped")):(await j.startListening(),Re("Voice input started"))}catch(x){console.error("Error toggling speech:",x),Re("Error with voice input")}},M=async x=>{if(d&&j.isAvailable)try{await j.speak(x,{rate:.9,pitch:1,volume:.8,voice:A,interrupt:!0})}catch(w){console.error("Error speaking message:",w)}},D=()=>{h(!d),d?(Re("Audio output disabled"),j.isAvailable&&window.speechSynthesis&&window.speechSynthesis.cancel()):Re("Audio output enabled")},C=async()=>{if(!r.trim()||o)return;const x={id:Date.now().toString(),content:r.trim(),role:"user",timestamp:new Date};t(v=>[...v,x]);const w=r.trim();i(""),a(!0),l(v=>({...v,isTyping:!0}));try{if(P.isConnected){const v={content:w,timestamp:new Date().toISOString(),metadata:{speechConfidence:1,voiceActivityLevel:j.volume,processingTime:0}};await P.sendMessage(v),Re("Message sent to agent")}else{await new Promise(fe=>setTimeout(fe,1e3+Math.random()*2e3));let v="I understand what you're saying. Let me help you with that.",H=c.id,Q=c.name;const ce=w.toLowerCase();ce.includes("phq")||ce.includes("depression")||ce.includes("screening")?(v="I can help you with a depression screening. I'll start with the PHQ-2, which is a quick 2-question assessment. This will help determine if a more comprehensive evaluation might be helpful. Shall we begin?",H="phq2",Q="PHQ-2 Agent"):ce.includes("joke")||ce.includes("funny")||ce.includes("humor")?(v="Hey there!  I'm here to brighten your day with some wholesome humor! I can share clean jokes, funny stories, or just have some playful banter. What sounds good to you?",H="comedian",Q="Comedy Agent"):(ce.includes("crisis")||ce.includes("emergency")||ce.includes("help"))&&(v="I'm here to help. If you're experiencing a mental health crisis, please reach out for immediate support: Call 988 (Suicide & Crisis Lifeline) or contact your local emergency services. I'm also here to provide support and connect you with appropriate resources.");const st={id:(Date.now()+1).toString(),content:v,role:"assistant",timestamp:new Date};t(fe=>[...fe,st]),H!==c.id&&(l({id:H,name:Q,isActive:!0,isTyping:!1}),Re(`Agent changed to ${Q}`)),M(v)}}catch(v){console.error("Error sending message:",v);const H={id:(Date.now()+1).toString(),content:"I'm sorry, I encountered an error processing your message. Please try again.",role:"assistant",timestamp:new Date};t(Q=>[...Q,H]),Re("Error sending message")}finally{a(!1),P.isConnected||l(v=>({...v,isTyping:!1}))}},y=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),C())},f=()=>{t([]),l({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),Re("Conversation cleared")};return s.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${c.isTyping?"bg-primary-500 animate-pulse":c.isActive?"bg-green-500":"bg-gray-400"}`,children:s.jsx("span",{className:"text-white text-lg",children:""})}),c.isActive&&s.jsx("div",{className:"absolute -inset-1 rounded-full bg-green-400 opacity-30 animate-ping"}),j.isListening&&s.jsx("div",{className:"absolute -bottom-1 -right-1",children:s.jsx(ly,{volume:j.volume,isVoiceActive:j.isVoiceActive,isListening:j.isListening,size:"sm"})})]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Agent Experience"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Current Agent: ",c.name,c.isTyping&&s.jsx("span",{className:"ml-2 text-primary-600 dark:text-primary-400",children:s.jsx("span",{className:"animate-pulse",children:"Typing..."})})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${P.isConnected?"bg-green-500":"bg-red-500"}`}),s.jsx("span",{className:`text-xs ${P.isConnected?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:P.isConnected?"Connected":"Offline"})]})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>g(!0),onKeyDown:n(()=>g(!0)),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Open speech settings",title:"Speech settings",children:s.jsx(El,{size:20})}),s.jsx("button",{onClick:D,onKeyDown:n(D),className:`p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${d?"bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,"aria-label":`${d?"Disable":"Enable"} audio output`,title:`${d?"Disable":"Enable"} audio output`,children:d?s.jsx(Ur,{size:20}):s.jsx(rf,{size:20})}),s.jsx("button",{onClick:f,onKeyDown:n(f),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Clear conversation",title:"Clear conversation",children:s.jsx(Tr,{size:20})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.map(x=>s.jsx("div",{className:`flex ${x.role==="user"?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${x.role==="user"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[s.jsx("p",{className:"text-sm",children:x.content}),s.jsx("p",{className:`text-xs mt-1 opacity-70 ${x.role==="user"?"text-primary-200":"text-gray-500 dark:text-gray-400"}`,children:x.timestamp.toLocaleTimeString()})]})},x.id)),c.isTyping&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"}),s.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"})]})})}),s.jsx("div",{ref:T})]}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"flex items-end space-x-2",children:[j.isAvailable&&s.jsx("button",{onClick:G,onKeyDown:n(G),disabled:o,className:`p-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${j.isListening?"bg-red-600 text-white hover:bg-red-700":"bg-primary-600 text-white hover:bg-primary-700 disabled:bg-gray-400"}`,"aria-label":j.isListening?"Stop voice input":"Start voice input",title:j.isListening?"Stop voice input":"Start voice input",children:j.isListening?s.jsx(Pp,{size:20}):s.jsx(Nl,{size:20})}),s.jsx("div",{className:"flex-1",children:s.jsx("textarea",{ref:k,value:r,onChange:x=>i(x.target.value),onKeyPress:y,placeholder:"Type your message here or use voice input...",disabled:o,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-700 min-h-[44px] max-h-[120px]",rows:1,"aria-label":"Message input"})}),s.jsx("button",{onClick:C,onKeyDown:n(C),disabled:!r.trim()||o,className:"p-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Send message",title:"Send message",children:s.jsx(Bp,{size:20})})]}),s.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[j.isListening&&s.jsxs("span",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[s.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse"}),s.jsx("span",{children:"Listening..."})]}),j.isVoiceActive&&s.jsxs("span",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[s.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),s.jsx("span",{children:"Voice detected"})]}),j.isAvailable&&s.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Voice input available"}),j.error&&s.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Speech error: ",j.error]}),P.error&&s.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Connection error: ",P.error]}),d&&s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Audio output enabled"}),P.sessionId&&s.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Session: ",P.sessionId.slice(-8)]})]}),s.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"})]})]}),s.jsx(dy,{config:{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:2,audioTracks:!0,noiseReduction:!0,echoCancellation:!0},availableVoices:j.availableVoices,selectedVoice:A,onConfigUpdate:x=>j.updateConfig(x),onVoiceSelect:x=>E(x),isOpen:u,onClose:()=>g(!1)})]})},uy=()=>{const{data:n,isLoading:e,error:t,refetch:r}=Dl(),{announce:i}=kl();Bt.useEffect(()=>{i("System Health page loaded","polite")},[i]);const o=d=>{if(!d)return"Just now";try{const h=new Date(d);return isNaN(h.getTime())?"Just now":h.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},a=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},c=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"";case"degraded":return"";case"unhealthy":return"";default:return""}},l=d=>{const h="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(d==null?void 0:d.toLowerCase()){case"healthy":return`${h} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${h} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${h} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${h} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return s.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),s.jsxs("button",{type:"button",onClick:()=>r(),disabled:e,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[s.jsx(_e,{className:`w-4 h-4 ${e?"animate-spin":""}`}),s.jsx("span",{children:"Refresh"})]})]}),e&&s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(_e,{className:"w-6 h-6 text-blue-600 animate-spin"}),s.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),t&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(et,{className:"w-6 h-6 text-red-500 mr-3"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),s.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:t.message||"Unable to retrieve system health status"}),s.jsx("button",{type:"button",onClick:()=>r(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),n&&!e&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),s.jsxs("div",{className:l(n.status),children:[s.jsx("span",{className:"mr-1",children:c(n.status)}),n.status]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:c(n.status)}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),s.jsx("div",{className:`font-medium ${a(n.status)}`,children:n.status})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:""}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),s.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:n.totalDuration?`${n.totalDuration}ms`:"N/A"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-3xl mb-2",children:""}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),s.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o(n.timestamp)})]})]})]}),n.checks&&Object.keys(n.checks).length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(Dr,{className:"w-5 h-5 mr-2"}),"Service Details"]}),s.jsx("div",{className:"space-y-4",children:Object.entries(n.checks).map(([d,h])=>s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-lg",children:c(h.status)}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.replace(/-/g," ")}),h.description&&s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.description})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[h.duration&&s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[h.duration,"ms"]}),s.jsx("div",{className:l(h.status),children:h.status})]})]},d))})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[s.jsx(jn,{className:"w-5 h-5 mr-2"}),"System Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},gy=()=>s.jsxs("div",{className:"text-center py-16",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),s.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),my=new ed({defaultOptions:{queries:{retry:(n,e)=>{if(e&&typeof e=="object"&&"code"in e){const t=e.code;if(t!=null&&t.startsWith("HTTP_4")&&t!=="HTTP_408")return!1}return n<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}}),py=new zi(Am);function fy(){return s.jsx(am,{instance:py,children:s.jsxs(td,{client:my,children:[s.jsx(_m,{children:s.jsx(Pm,{children:s.jsx($m,{children:s.jsx(nd,{children:s.jsx(Gm,{children:s.jsxs(id,{children:[s.jsx(ft,{path:"/",element:s.jsxs(St,{requireRoles:[se.ADMIN,se.CONTROL_PANEL],children:[s.jsx(Dm,{}),s.jsx(of,{})]})}),s.jsx(ft,{path:"/upload",element:s.jsx(St,{requireRoles:[se.ADMIN],children:s.jsx(hf,{})})}),s.jsx(ft,{path:"/sessions",element:s.jsx(St,{requireRoles:[se.ADMIN],children:s.jsx(uf,{})})}),s.jsx(ft,{path:"/sessions/:sessionId",element:s.jsx(St,{requireRoles:[se.ADMIN],children:s.jsx(pf,{})})}),s.jsx(ft,{path:"/predictions",element:s.jsx(St,{requireRoles:[se.ADMIN],children:s.jsx(ff,{})})}),s.jsx(ft,{path:"/summary",element:s.jsx(St,{requireRoles:[se.ADMIN,se.CONTROL_PANEL],children:s.jsx(kf,{})})}),s.jsx(ft,{path:"/agent-experience",element:s.jsx(St,{requireRoles:[se.ADMIN,se.CONTROL_PANEL],children:s.jsx(hy,{})})}),s.jsx(ft,{path:"/health",element:s.jsx(St,{requireRoles:[se.ADMIN],children:s.jsx(uy,{})})}),s.jsx(ft,{path:"*",element:s.jsx(gy,{})})]})})})})})}),!1]})})}const ia=localStorage.getItem("bh_theme"),yy=window.matchMedia("(prefers-color-scheme: dark)").matches,xy=ia==="dark"||!ia&&yy;xy?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");mn.createRoot(document.getElementById("root")).render(s.jsx(Bt.StrictMode,{children:s.jsx(fy,{})}));
//# sourceMappingURL=index-4892159a.js.map
