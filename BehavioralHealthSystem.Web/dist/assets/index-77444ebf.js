var Br=Object.defineProperty;var Vr=(r,t,s)=>t in r?Br(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var X=(r,t,s)=>(Vr(r,typeof t!="symbol"?t+"":t,s),s);import{j as e,u as tr,Q as Wr,a as qr}from"./query-7a13343f.js";import{a as Gr,r as h,u as Nt,N as sr,b as Zt,L as ve,c as Yr,R as rr,B as Kr,d as Jr,e as Oe}from"./vendor-b4aac61f.js";import{F as Zr,t as $s,f as Xr}from"./ffmpeg-c0c62554.js";import{B as Qr,e as ea}from"./azure-e79d136e.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var cs={},Fs=Gr;cs.createRoot=Fs.createRoot,cs.hydrateRoot=Fs.hydrateRoot;let zt;const ta=new Uint8Array(16);function sa(){if(!zt&&(zt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zt(ta)}const ke=[];for(let r=0;r<256;++r)ke.push((r+256).toString(16).slice(1));function ra(r,t=0){return ke[r[t+0]]+ke[r[t+1]]+ke[r[t+2]]+ke[r[t+3]]+"-"+ke[r[t+4]]+ke[r[t+5]]+"-"+ke[r[t+6]]+ke[r[t+7]]+"-"+ke[r[t+8]]+ke[r[t+9]]+"-"+ke[r[t+10]]+ke[r[t+11]]+ke[r[t+12]]+ke[r[t+13]]+ke[r[t+14]]+ke[r[t+15]]}const aa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ls={randomUUID:aa};function na(r,t,s){if(Ls.randomUUID&&!t&&!r)return Ls.randomUUID();r=r||{};const a=r.random||(r.rng||sa)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,t){s=s||0;for(let n=0;n<16;++n)t[s+n]=a[n];return t}return ra(a)}const at={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!1},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},it={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},gt={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},xt={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300},ze=()=>{let r=localStorage.getItem(it.USER_ID);return(!r||r.trim().length===0)&&(r=na(),localStorage.setItem(it.USER_ID,r)),r},ia=()=>{const r=localStorage.getItem(it.THEME);return r==="light"||r==="dark"?r:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Us=r=>{localStorage.setItem(it.THEME,r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},ar=()=>{const r=localStorage.getItem(it.PROCESSING_MODE);return r==="single"||r==="batch-files"||r==="batch-csv"?r:r==="true"?"batch-files":"single"},Os=r=>{localStorage.setItem(it.PROCESSING_MODE,r)},oa=()=>ar()!=="single",ft=r=>{const t=new Date,s=new Date(r),a=t.getTime()-s.getTime(),n=Math.floor(a/(1e3*60)),o=Math.floor(a/(1e3*60*60)),l=Math.floor(a/(1e3*60*60*24));return n<1?"Just now":n<60?`${n}m ago`:o<24?`${o}h ago`:l<7?`${l}d ago`:s.toLocaleDateString()},nt=r=>new Date(r).toLocaleString(),Ie=(r,t,s)=>({code:r,message:t,details:s,timestamp:new Date().toISOString()}),la=r=>r instanceof TypeError&&r.message.includes("fetch")?!0:r instanceof Error?r.message.includes("Network")||r.message.includes("connection")||r.message.includes("timeout"):!1,je=(r,t="polite")=>{const s=document.createElement("div");s.setAttribute("aria-live",t),s.setAttribute("aria-atomic","true"),s.className="sr-only",s.textContent=r,document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},1e3)},ca=(r,t=100)=>{setTimeout(()=>{const s=document.getElementById(r);s&&s.focus()},t)},nr=h.createContext(void 0),da=()=>{const r=h.useContext(nr);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},ha=({children:r})=>{const[t,s]=h.useState(ia),a=l=>{s(l),Us(l)},n=()=>{a(t==="light"?"dark":"light")};h.useEffect(()=>{Us(t)},[t]),h.useEffect(()=>{const l=window.matchMedia("(prefers-color-scheme: dark)"),d=g=>{localStorage.getItem("bh_theme")||s(g.matches?"dark":"light")};return l.addEventListener("change",d),()=>l.removeEventListener("change",d)},[]);const o={theme:t,toggleTheme:n,setTheme:a};return e.jsx(nr.Provider,{value:o,children:r})};/*! @azure/msal-common v15.12.0 2025-08-19 */const Se={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"};/*! @azure/msal-common v15.12.0 2025-08-19 */class gs extends Error{constructor(t,s,a){const n=s?`${t}: ${s}`:t;super(n),Object.setPrototypeOf(this,gs.prototype),this.errorCode=t||Se.EMPTY_STRING,this.errorMessage=s||Se.EMPTY_STRING,this.subError=a||Se.EMPTY_STRING,this.name="AuthError"}setCorrelationId(t){this.correlationId=t}}/*! @azure/msal-common v15.12.0 2025-08-19 */var Ne;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Verbose=3]="Verbose",r[r.Trace=4]="Trace"})(Ne||(Ne={}));class Gt{constructor(t,s,a){this.level=Ne.Info;const n=()=>{},o=t||Gt.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||n,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:Ne.Info,this.correlationId=o.correlationId||Se.EMPTY_STRING,this.packageName=s||Se.EMPTY_STRING,this.packageVersion=a||Se.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Ne.Info}}clone(t,s,a){return new Gt({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:a||this.correlationId},t,s)}logMessage(t,s){if(s.logLevel>this.level||!this.piiLoggingEnabled&&s.containsPii)return;const o=`${`[${new Date().toUTCString()}] : [${s.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${Ne[s.logLevel]} - ${t}`;this.executeCallback(s.logLevel,o,s.containsPii||!1)}executeCallback(t,s,a){this.localCallback&&this.localCallback(t,s,a)}error(t,s){this.logMessage(t,{logLevel:Ne.Error,containsPii:!1,correlationId:s||Se.EMPTY_STRING})}errorPii(t,s){this.logMessage(t,{logLevel:Ne.Error,containsPii:!0,correlationId:s||Se.EMPTY_STRING})}warning(t,s){this.logMessage(t,{logLevel:Ne.Warning,containsPii:!1,correlationId:s||Se.EMPTY_STRING})}warningPii(t,s){this.logMessage(t,{logLevel:Ne.Warning,containsPii:!0,correlationId:s||Se.EMPTY_STRING})}info(t,s){this.logMessage(t,{logLevel:Ne.Info,containsPii:!1,correlationId:s||Se.EMPTY_STRING})}infoPii(t,s){this.logMessage(t,{logLevel:Ne.Info,containsPii:!0,correlationId:s||Se.EMPTY_STRING})}verbose(t,s){this.logMessage(t,{logLevel:Ne.Verbose,containsPii:!1,correlationId:s||Se.EMPTY_STRING})}verbosePii(t,s){this.logMessage(t,{logLevel:Ne.Verbose,containsPii:!0,correlationId:s||Se.EMPTY_STRING})}trace(t,s){this.logMessage(t,{logLevel:Ne.Trace,containsPii:!1,correlationId:s||Se.EMPTY_STRING})}tracePii(t,s){this.logMessage(t,{logLevel:Ne.Trace,containsPii:!0,correlationId:s||Se.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */var zs;(function(r){r.Redirect="redirect",r.Popup="popup",r.Silent="silent",r.None="none"})(zs||(zs={}));const ua={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"};/*! @azure/msal-browser v4.23.0 2025-09-17 */const ga="storage_not_supported",ye="stubbed_public_client_application_called",ma="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const xa={[ga]:"Given storage configuration option was not supported.",[ye]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ma]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class ms extends gs{constructor(t,s){super(t,s),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,ms.prototype)}}function we(r){return new ms(r,xa[r])}/*! @azure/msal-browser v4.23.0 2025-09-17 */const pa={initialize:()=>Promise.reject(we(ye)),acquireTokenPopup:()=>Promise.reject(we(ye)),acquireTokenRedirect:()=>Promise.reject(we(ye)),acquireTokenSilent:()=>Promise.reject(we(ye)),acquireTokenByCode:()=>Promise.reject(we(ye)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(we(ye)),loginPopup:()=>Promise.reject(we(ye)),loginRedirect:()=>Promise.reject(we(ye)),logout:()=>Promise.reject(we(ye)),logoutRedirect:()=>Promise.reject(we(ye)),logoutPopup:()=>Promise.reject(we(ye)),ssoSilent:()=>Promise.reject(we(ye)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw we(ye)},getLogger:()=>{throw we(ye)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw we(ye)},hydrateCache:()=>Promise.reject(we(ye)),clearCache:()=>Promise.reject(we(ye))};/*! @azure/msal-react v3.0.19 2025-08-19 */const fa={instance:pa,inProgress:ua.None,accounts:[],logger:new Gt({})},ir=h.createContext(fa);ir.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */const ya=()=>h.useContext(ir),ba={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},be={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},or=h.createContext(void 0),We=()=>{const r=h.useContext(or);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},va=({children:r})=>e.jsx(e.Fragment,{children:r}),wa=({children:r})=>null,ka={id:"mock-user-id",email:"anonymous@localhost",name:"Anonymous User",roles:["Admin"],primaryRole:"Admin",groups:[],preferredUsername:"anonymous"},ja=({children:r})=>{const t={user:ka,isAuthenticated:!0,isLoading:!1,error:null,login:async()=>{console.log("Mock login called - no action taken")},logout:async()=>{console.log("Mock logout called - no action taken")},clearError:()=>{console.log("Mock clearError called - no action taken")},hasRole:()=>!0,hasAnyRole:()=>!0,isAdmin:()=>!0,canAccessControlPanel:()=>!0};return e.jsx(or.Provider,{value:t,children:r})};console.log("Authentication mode:","Mock authentication enabled");console.log("VITE_ENABLE_ENTRA_AUTH:","false");const Na=({children:r})=>e.jsx(ja,{children:r}),Sa=()=>{const{login:r,isLoading:t,error:s}=We(),a=()=>{r().catch(console.error)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:e.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:"ðŸ§ "})}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),e.jsxs("div",{className:"space-y-4",children:[s&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:s})}),e.jsx("button",{onClick:a,disabled:t,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:t?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),e.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),e.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),e.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},Hs=({children:r,fallback:t,redirectTo:s})=>{const a=Nt();return e.jsxs(e.Fragment,{children:[e.jsx(va,{children:r}),e.jsx(wa,{children:t||(s?e.jsx(sr,{to:s,state:{from:a},replace:!0}):e.jsx(Sa,{}))})]})},_a=({children:r,roles:t,requireAll:s=!1,fallback:a,redirectTo:n})=>{const{hasRole:o,hasAnyRole:l,user:d}=We(),g=Nt();return(s?t.every(f=>o(f)):l(t))?e.jsx(e.Fragment,{children:r}):a?e.jsx(e.Fragment,{children:a}):n?e.jsx(sr,{to:n,state:{from:g},replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸš«"}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",t.length>1?"s":"",": ",t.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",d!=null&&d.roles.length&&d.roles.length>1?"s":"",": ",(d==null?void 0:d.roles.join(", "))||"None"]})]})]})})},He=({children:r,requireAuth:t=!0,requireRoles:s=[],requireAll:a=!1,fallback:n,redirectTo:o})=>!t&&s.length===0?e.jsx(e.Fragment,{children:r}):t&&s.length===0?e.jsx(Hs,{fallback:n,redirectTo:o,children:r}):e.jsx(Hs,{fallback:n,redirectTo:o,children:e.jsx(_a,{roles:s,requireAll:a,fallback:n,redirectTo:o,children:r})}),Ca=()=>{const r=Zt(),t=Nt(),{user:s,isAuthenticated:a,isLoading:n,hasRole:o}=We();return h.useEffect(()=>{if(n||!a||!s||t.pathname!=="/")return;let l="/";o(be.CONTROL_PANEL)&&!o(be.ADMIN)?l="/summary":(o(be.ADMIN),l="/"),l!==t.pathname&&r(l,{replace:!0})},[s,a,n,t.pathname,r,o]),null};class Aa{constructor(t,s){X(this,"msalInstance");X(this,"accounts");this.msalInstance=t,this.accounts=s}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...ba,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(t){return console.warn("Failed to acquire access token silently:",t),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const t=this.accounts[0];return{userId:t.homeAccountId,username:t.username,name:t.name}}}const Ia=()=>{const{instance:r,accounts:t}=ya();return new Aa(r,t)};class Ea{constructor(t,s){X(this,"baseUrl");X(this,"authProvider");this.baseUrl=t,this.authProvider=s}setAuthProvider(t){this.authProvider=t}async handleResponse(t){if(!t.ok){const s=await t.json().catch(()=>({}));throw Ie(`HTTP_${t.status}`,s.message||`HTTP ${t.status}: ${t.statusText}`,{status:t.status,statusText:t.statusText,data:s})}return t.json()}async request(t,s={}){try{const a=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,n=t.startsWith("/")?t:`/${t}`,o=`${a}${n}`,l={"Content-Type":"application/json",...s.headers};if(this.authProvider)try{const g=await this.authProvider.getAuthHeaders();Object.assign(l,g)}catch(g){console.warn("Failed to get authentication headers:",g)}const d=await fetch(o,{...s,headers:l});return this.handleResponse(d)}catch(a){throw la(a)?Ie("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:a}):a instanceof Error&&"code"in a?a:Ie("UNKNOWN_ERROR","An unexpected error occurred",{originalError:a})}}async get(t){return this.request(t,{method:"GET"})}async post(t,s){return this.request(t,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(t,s){return this.request(t,{method:"PUT",body:s?JSON.stringify(s):void 0})}async delete(t){return this.request(t,{method:"DELETE"})}}const Ae=new Ea(at.api.baseUrl),Ra=r=>{Ae.setAuthProvider(r)},oe={async checkHealth(){return Ae.get(gt.HEALTH)},async initiateSession(r){return Ae.post(gt.SESSIONS_INITIATE,r)},async submitPrediction(r){return Ae.post(gt.PREDICTIONS_SUBMIT,r)},async getPredictionBySessionId(r){return Ae.get(`${gt.PREDICTIONS_BY_SESSION}/${r}`)},async getUserPredictions(r){return Ae.get(`${gt.PREDICTIONS_BY_USER}/${r}`)},async saveSessionData(r){return Ae.post("sessions",r)},async getSessionData(r){return Ae.get(`sessions/${r}`)},async getUserSessions(r){return Ae.get(`sessions/users/${r}`)},async getAllSessions(){return Ae.get("sessions/all")},async updateSessionData(r,t){return Ae.put(`sessions/${r}`,t)},async deleteSessionData(r){return Ae.delete(`sessions/${r}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(r){return{success:!1,message:r.message||"Connection test failed"}}},async generateRiskAssessment(r){return Ae.post(`sessions/${r}/risk-assessment`)},async getRiskAssessment(r){return Ae.get(`sessions/${r}/risk-assessment`)},async correctGrammar(r){return Ae.post("CorrectGrammar",{text:r})}};class Bs{constructor(t,s={}){X(this,"sessionId");X(this,"intervalMs");X(this,"maxAttempts");X(this,"backoffFactor");X(this,"currentAttempt",0);X(this,"timeoutId",null);X(this,"isPolling",!1);this.sessionId=t,this.intervalMs=s.intervalMs||at.polling.intervalMs,this.maxAttempts=s.maxAttempts||at.polling.maxAttempts,this.backoffFactor=s.backoffFactor||at.polling.backoffFactor}async start(t,s,a){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const n=async()=>{try{const o=await oe.getPredictionBySessionId(this.sessionId);if(t(o),o.status==="succeeded"||o.status==="success"||o.status==="failed"){this.stop(),s(o);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),a(Ie("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const l=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(n,l)}catch(o){this.stop(),a(o)}};await n()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const Ma=({children:r})=>{const t=Ia();return h.useEffect(()=>{Ra(t)},[t]),e.jsx(e.Fragment,{children:r})},lr=()=>{const r=h.useCallback((a,n="polite")=>{je(a,n)},[]),t=h.useCallback(a=>{r(a,"assertive")},[r]),s=h.useCallback(a=>{r(a,"polite")},[r]);return{announce:r,announceError:t,announceSuccess:s}},cr=()=>{const r=h.useCallback(s=>{const a=n=>{n.key==="Escape"&&(n.preventDefault(),s())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),t=h.useCallback(s=>a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),s())},[]);return{handleEscape:r,handleEnterSpace:t}},Ta=()=>({skipToMain:h.useCallback(()=>{ca(xt.SKIP_TO_CONTENT_ID,xt.FOCUS_TIMEOUT)},[])}),Da=({className:r=""})=>{const{theme:t,toggleTheme:s}=da(),{user:a,logout:n,isAuthenticated:o,isAdmin:l}=We(),d=Nt(),{handleEnterSpace:g}=cr(),[m,f]=h.useState(!1),[v,I]=h.useState(!1),U=!1,B=()=>[{path:"/",label:"Dashboard",icon:"ðŸ ",roles:[be.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"ðŸ“¤",roles:[be.ADMIN]},{path:"/sessions",label:"Sessions",icon:"ðŸ“Š",roles:[be.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"ðŸ“ˆ",roles:[be.ADMIN]}];h.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:o,user:a?{id:a.id,name:a.name,roles:a.roles}:null,timestamp:new Date().toISOString()})},[o,a]);const $=B(),_=J=>J==="/"?d.pathname==="/":d.pathname.startsWith(J),F=()=>{f(!m)},G=()=>{f(!1)};return h.useEffect(()=>{f(!1),I(!1)},[d.pathname]),h.useEffect(()=>{const J=C=>{const S=C.target;v&&!S.closest("[data-user-menu]")&&I(!1)};return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)},[v]),e.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${r}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(ve,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[e.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:"ðŸ§ "}),e.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),e.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),e.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:$.map(({path:J,label:C,icon:S})=>e.jsxs(ve,{to:J,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${_(J)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":_(J)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:S}),e.jsx("span",{children:C})]},J))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative","data-user-menu":!0,children:[e.jsxs("div",{className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-400 cursor-not-allowed opacity-50\r
                    dark:text-gray-500 transition-colors touch-target\r
                  `,"aria-label":"User authentication disabled",title:"Authentication is disabled",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-medium",children:"?"}),e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Auth Disabled"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),U]}),e.jsx("button",{onClick:s,onKeyDown:g(s),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,type:"button",children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:t==="light"?"ðŸŒ™":"â˜€ï¸"})}),$.length>0&&e.jsx("button",{onClick:F,onKeyDown:g(F),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":m?"Close mobile menu":"Open mobile menu",type:"button",...m?{"aria-expanded":!0}:{"aria-expanded":!1},children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:m?"âœ•":"â˜°"})})]})]}),m&&$.length>0&&e.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:e.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:$.map(({path:J,label:C,icon:S})=>e.jsxs(ve,{to:J,onClick:G,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${_(J)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":_(J)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:S}),e.jsx("span",{children:C})]},J))})})]})})},Pa=({size:r=20,className:t="",...s})=>e.jsxs("svg",{width:r,height:r,viewBox:"0 0 23 23",className:t,"aria-label":"Microsoft",...s,children:[e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),e.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),e.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),e.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),$a=({children:r,className:t=""})=>{const{skipToMain:s}=Ta();return e.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[e.jsx("a",{href:`#${xt.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:a=>{a.preventDefault(),s()},children:"Skip to main content"}),e.jsx(Da,{}),e.jsx("main",{id:xt.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${t}`,tabIndex:-1,children:r}),e.jsx("div",{id:xt.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),e.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pa,{size:24,className:"opacity-80"}),e.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),e.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[e.jsxs("p",{children:["Behavioral Health System Â© ",new Date().getFullYear()]}),e.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant â€¢ Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),La=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,s,a)=>a?a.toUpperCase():s.toLowerCase()),Vs=r=>{const t=La(r);return t.charAt(0).toUpperCase()+t.slice(1)},dr=(...r)=>r.filter((t,s,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===s).join(" ").trim(),Ua=r=>{for(const t in r)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=h.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:n="",children:o,iconNode:l,...d},g)=>h.createElement("svg",{ref:g,...Oa,width:t,height:t,stroke:r,strokeWidth:a?Number(s)*24/Number(t):s,className:dr("lucide",n),...!o&&!Ua(d)&&{"aria-hidden":"true"},...d},[...l.map(([m,f])=>h.createElement(m,f)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=(r,t)=>{const s=h.forwardRef(({className:a,...n},o)=>h.createElement(za,{ref:o,iconNode:t,className:dr(`lucide-${Fa(Vs(r))}`,`lucide-${r}`,a),...n}));return s.displayName=Vs(r),s};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],yt=Y("activity",Ha);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Va=Y("arrow-left",Ba);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Ve=Y("brain",Wa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],hr=Y("calendar",qa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ga=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Ws=Y("chart-column",Ga);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Ka=Y("chart-pie",Ya);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ur=Y("chevron-down",Ja);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],gr=Y("chevron-up",Za);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Te=Y("circle-alert",Xa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ee=Y("circle-check-big",Qa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Yt=Y("circle-x",en);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ze=Y("clock",tn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Kt=Y("download",sn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],an=Y("eye-off",rn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],bt=Y("eye",nn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],ln=Y("file-audio",on);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],dn=Y("file-text",cn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],mr=Y("funnel",hn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],xr=Y("heart",un);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],vt=Y("info",gn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],xn=Y("languages",mn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],fn=Y("lightbulb",pn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],qs=Y("loader-circle",yn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],vn=Y("mic-off",bn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],pr=Y("mic",wn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ds=Y("pause",kn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],rt=Y("play",jn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ts=Y("plus",Nn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ce=Y("refresh-cw",Sn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Cn=Y("search",_n);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],In=Y("send",An);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fr=Y("settings",En);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],hs=Y("shield-alert",Rn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Tn=Y("square-pen",Mn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Pn=Y("target",Dn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],pt=Y("trash-2",$n);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],yr=Y("trending-down",Fn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Xt=Y("trending-up",Ln);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],br=Y("triangle-alert",Un);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Gs=Y("upload",On);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ss=Y("user",zn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],vr=Y("users",Hn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],wt=Y("volume-2",Bn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Wn=Y("volume-x",Vn);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Be=Y("x",qn),wr={health:["health"],userPredictions:r=>["predictions","user",r],sessionPrediction:r=>["predictions","session",r],userSessions:r=>["sessions","user",r]},kr=()=>tr({queryKey:wr.health,queryFn:()=>oe.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),Gn=r=>{const t=r||ze();return tr({queryKey:wr.userSessions(t),queryFn:()=>oe.getUserSessions(t),enabled:!!t,staleTime:3e4,refetchOnWindowFocus:!1})},Yn=()=>{const{announce:r}=lr(),{canAccessControlPanel:t,user:s}=We(),a=()=>(s==null?void 0:s.id)||ze(),{data:n,isLoading:o,error:l}=kr(),{data:d,isLoading:g}=Gn(a());h.useEffect(()=>{r("Dashboard page loaded","polite")},[r]);const m=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"ðŸ“¤",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"ðŸ“Š",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"ðŸ“ˆ",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"ðŸ¤–",color:"warning",disabled:!0}],f=(v,I=!1)=>{const U=I?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(v){case"primary":return`${U} border-primary-200 bg-primary-50 ${!I&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!I&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${U} border-secondary-200 bg-secondary-50 ${!I&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!I&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${U} border-accent-200 bg-accent-50 ${!I&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!I&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${U} border-warning-200 bg-warning-50 ${!I&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!I&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${U} border-gray-200 bg-gray-50 ${!I&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!I&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:m.map(v=>v.disabled?e.jsxs("div",{className:`${f(v.color,!0)} relative`,"aria-label":`${v.title}: Coming Soon`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:v.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:v.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:v.description})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-bold text-sm mb-1",children:"ðŸš§"}),e.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},v.href):e.jsx(ve,{to:v.href,className:f(v.color,!1),"aria-label":`${v.title}: ${v.description}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:v.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:v.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:v.description})]})},v.href))})]}),t()&&e.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),e.jsx(ve,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),e.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),g?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(d!=null&&d.sessions)||d.sessions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:"ðŸ“­"}),e.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",e.jsx(ve,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):e.jsxs("div",{className:"space-y-3",children:[d.sessions.sort((v,I)=>new Date(I.createdAt).getTime()-new Date(v.createdAt).getTime()).slice(0,3).map(v=>{var I,U;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`status-${v.status||"completed"}`,children:v.status||"completed"}),e.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:v.audioFileName||((I=v.sessionId)==null?void 0:I.slice(0,8))||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:v.createdAt,children:v.createdAt?new Date(v.createdAt).toLocaleString():""})]}),e.jsx(ve,{to:`/sessions/${v.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${v.audioFileName||((U=v.sessionId)==null?void 0:U.slice(0,8))||"Unknown"}`,children:e.jsx(bt,{className:"w-4 h-4","aria-hidden":"true"})})]},v.sessionId)}),d.sessions.length>3&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(ve,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",d.sessions.length," sessions â†’"]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),e.jsx(ve,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):l?e.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[e.jsx("span",{role:"img","aria-label":"Error",children:"âš ï¸"}),e.jsx("span",{children:"System health check failed"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[e.jsx("span",{role:"img","aria-label":"Healthy",children:"âœ…"}),e.jsx("span",{children:"All systems operational"}),(n==null?void 0:n.checks)&&e.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(n.checks).length," services checked)"]})]})]})]})};class Kn{constructor(){X(this,"ffmpeg",null);X(this,"isLoaded",!1);X(this,"loadingPromise",null);this.ffmpeg=new Zr}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw Ie("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const t="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await $s(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:await $s(`${t}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(t){throw this.loadingPromise=null,Ie("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:t})}}async convertAudio(t,s={outputFormat:"wav",sampleRate:44100,channels:1},a){try{if(a==null||a({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw Ie("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:f})=>{a==null||a({stage:"converting",progress:Math.round(f*100),message:`Converting audio... ${Math.round(f*100)}%`})}),a==null||a({stage:"converting",progress:0,message:"Preparing audio file..."});const n="input."+this.getFileExtension(t.name);await this.ffmpeg.writeFile(n,await Xr(t));const o=`output.${s.outputFormat}`,l=["-i",n,"-ac",s.channels.toString(),"-ar",s.sampleRate.toString(),"-f",s.outputFormat,o];await this.ffmpeg.exec(l);const d=await this.ffmpeg.readFile(o),g=new Blob([d],{type:`audio/${s.outputFormat}`}),m=new File([g],`${this.getFileNameWithoutExtension(t.name)}.${s.outputFormat}`,{type:`audio/${s.outputFormat}`});return await this.ffmpeg.deleteFile(n),await this.ffmpeg.deleteFile(o),a==null||a({stage:"completed",progress:100,message:"Audio conversion completed"}),m}catch(n){throw Ie("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:n,fileName:t.name,fileSize:t.size,fileType:t.type})}}getFileExtension(t){const s=t.lastIndexOf(".");return s!==-1?t.slice(s+1).toLowerCase():""}getFileNameWithoutExtension(t){const s=t.lastIndexOf(".");return s!==-1?t.slice(0,s):t}async isFormatSupported(t){try{await this.loadFFmpeg();const s=["wav","mp3","mp4","m4a","aac","flac","ogg"],a=this.getFileExtension(t.name);return s.includes(a)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let rs=null;const Jn=()=>(rs||(rs=new Kn),rs),as=async(r,t)=>{const a=await Jn().convertAudio(r,{outputFormat:"wav",sampleRate:44100,channels:1},t?n=>t(n.progress):void 0);return new Blob([a],{type:"audio/wav"})};class Zn{constructor(t){X(this,"containerClient",null);X(this,"sasUrl");if(this.sasUrl=t||at.azure.blobSasUrl,!this.sasUrl)throw Ie("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const t=new Qr(this.sasUrl);this.containerClient=t.getContainerClient(at.azure.containerName)}catch(t){throw Ie("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:t})}return this.containerClient}async uploadFile(t,s,a,n){try{a==null||a({progress:0,stage:"preparing",message:"Preparing upload..."});const o=this.getContainerClient();let l;if(n){const m=n;if(s)l=`users/${m}/audio/${s}`;else{const f=new Date().toISOString().replace(/[:.]/g,"-"),v=Math.random().toString(36).substring(2,8),I=t.name.split(".").pop()||"wav";l=`users/${m}/audio/${f}-${v}.${I}`}}else l=s||this.generateBlobName(t.name);const d=o.getBlockBlobClient(l);a==null||a({progress:10,stage:"uploading",message:"Starting upload..."}),await d.uploadData(t,{blobHTTPHeaders:{blobContentType:t.type},onProgress:m=>{const f=m.loadedBytes&&t.size?Math.round(m.loadedBytes/t.size*90)+10:50;a==null||a({progress:f,stage:"uploading",message:`Uploading... ${f}%`})}});const g=d.url;return a==null||a({progress:100,stage:"completed",message:"Upload completed"}),{url:g,fileName:l,size:t.size}}catch(o){throw Ie("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:o,fileName:t.name,fileSize:t.size})}}generateBlobName(t,s){const a=s||ze(),n=new Date().toISOString().replace(/[:.]/g,"-"),o=Math.random().toString(36).substring(2,8),l=t.split(".").pop()||"wav";return`users/${a}/audio/${n}-${o}.${l}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(t){try{await this.getContainerClient().getBlockBlobClient(t).deleteIfExists()}catch(s){throw Ie("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:s,fileName:t})}}async listUserFiles(t){try{const s=t||ze(),a=this.getContainerClient(),n=`users/${s}/`,o=[];for await(const l of a.listBlobsFlat({prefix:n}))o.push(l.name);return o}catch(s){throw Ie("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:s,userId:t})}}async deleteUserData(t){try{const s=t||ze(),a=await this.listUserFiles(s);let n=0;for(const o of a)await this.deleteFile(o),n++;return n}catch(s){throw Ie("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:s,userId:t})}}async getUserStorageUsage(t){try{const s=t||ze(),a=this.getContainerClient(),n=`users/${s}/`;let o=0,l=0;for await(const d of a.listBlobsFlat({prefix:n}))o++,l+=d.properties.contentLength||0;return{fileCount:o,totalSizeBytes:l}}catch(s){throw Ie("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:s,userId:t})}}}let Ht=null;const Xn=r=>((!Ht||r&&r!==Ht.sasUrl)&&(Ht=new Zn(r)),Ht),ns=async(r,t,s,a)=>{const n=Xn(),o=r instanceof File?r:new File([r],t,{type:r.type});return(await n.uploadFile(o,t,s?d=>s(d.progress):void 0,a)).url},lt=()=>{const r=h.useRef(null),t=h.useCallback(d=>{if(!r.current){const g=document.createElement("div");g.setAttribute("aria-live","polite"),g.setAttribute("aria-atomic","true"),g.style.position="absolute",g.style.left="-10000px",g.style.width="1px",g.style.height="1px",g.style.overflow="hidden",document.body.appendChild(g),r.current=g}r.current.textContent="",setTimeout(()=>{r.current&&(r.current.textContent=d)},100)},[]),s={focusById:d=>{const g=document.getElementById(d);g&&g.focus()},focusFirstInContainer:d=>{const m=d.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];m&&m.focus()},trapFocus:d=>{const g=d.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),m=g[0],f=g[g.length-1],v=I=>{I.key==="Tab"&&(I.shiftKey?document.activeElement===m&&(f.focus(),I.preventDefault()):document.activeElement===f&&(m.focus(),I.preventDefault()))};return d.addEventListener("keydown",v),()=>{d.removeEventListener("keydown",v)}}},a={handleArrowNavigation:(d,g,m,f)=>{var I;let v=m;switch(d.key){case"ArrowDown":d.preventDefault(),v=m<g.length-1?m+1:0;break;case"ArrowUp":d.preventDefault(),v=m>0?m-1:g.length-1;break;case"Home":d.preventDefault(),v=0;break;case"End":d.preventDefault(),v=g.length-1;break;default:return}f(v),(I=g[v])==null||I.focus()},handleEscape:(d,g)=>{d.key==="Escape"&&(d.preventDefault(),g())}},n=h.useCallback((d="element")=>`${d}-${Math.random().toString(36).substr(2,9)}`,[]),o=h.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),l=h.useCallback((d,g,m)=>{const f={};return d||(f["aria-invalid"]="true",g&&m&&(f["aria-describedby"]=m)),f},[]);return{announceToScreenReader:t,focusManagement:s,keyboardNavigation:a,generateId:n,prefersReducedMotion:o,getValidationAttributes:l}},mt={userId:"",age:"",gender:"",race:"",ethnicity:"",language:"",weight:"",zipcode:"",sessionNotes:""},Qn=()=>{var Ns,Ss,_s,Cs,As,Is,Es,Rs,Ms,Ts,Ds;const{user:r}=We(),t=Nt(),[s,a]=h.useState([]),[n,o]=h.useState(()=>ar()),[l,d]=h.useState(()=>oa()),[g,m]=h.useState({}),[f,v]=h.useState({}),[I,U]=h.useState({}),[B,$]=h.useState(!1),[_,F]=h.useState(null),[G,J]=h.useState([]),[C,S]=h.useState({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""}),[R,L]=h.useState({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""}),[w,p]=h.useState(null),[u,b]=h.useState({stage:"idle",progress:0,message:""}),[x,j]=h.useState(null),[E,T]=h.useState(!1),[V,ee]=h.useState(0),[pe,he]=h.useState(null),P=t.state,[k,M]=h.useState({userId:"",age:((Ss=(Ns=P==null?void 0:P.userMetadata)==null?void 0:Ns.age)==null?void 0:Ss.toString())||"",gender:((_s=P==null?void 0:P.userMetadata)==null?void 0:_s.gender)||"",race:((Cs=P==null?void 0:P.userMetadata)==null?void 0:Cs.race)||"",ethnicity:((As=P==null?void 0:P.userMetadata)==null?void 0:As.ethnicity)||"",language:((Es=(Is=P==null?void 0:P.userMetadata)==null?void 0:Is.language)==null?void 0:Es.toString())||"",weight:((Ms=(Rs=P==null?void 0:P.userMetadata)==null?void 0:Rs.weight)==null?void 0:Ms.toString())||"",zipcode:((Ts=P==null?void 0:P.userMetadata)==null?void 0:Ts.zipcode)||"",sessionNotes:((Ds=P==null?void 0:P.userMetadata)==null?void 0:Ds.sessionNotes)||""}),[fe,ie]=h.useState(null),[St,Qe]=h.useState([]),[de,ct]=h.useState({}),[qe,es]=h.useState(!1),[_t,Ct]=h.useState(null),[ue,Re]=h.useState(mt),[Pe,dt]=h.useState({});h.useEffect(()=>{if(!k.userId){const i=`user-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;M(c=>({...c,userId:i}))}},[k.userId]),h.useEffect(()=>{d(n!=="single")},[n]);const ht=h.useCallback(()=>(r==null?void 0:r.id)||ze(),[r==null?void 0:r.id]),Ue=h.useRef(null),et=h.useRef(null),{announceToScreenReader:te}=lt(),W=h.useCallback((i,c,y)=>{const A=Date.now().toString()+Math.random().toString(36).substr(2,9),D={id:A,type:i,title:c,message:y,timestamp:Date.now()};Qe(z=>[...z,D]),setTimeout(()=>{Qe(z=>z.filter(q=>q.id!==A))},i==="error"?8e3:5e3)},[]),Sr=h.useCallback(i=>{Qe(c=>c.filter(y=>y.id!==i))},[]);h.useEffect(()=>{if(P&&(W("info","Session Data Pre-filled",`Metadata and audio file from session ${P.originalSessionId?P.originalSessionId.slice(0,8)+"...":""} have been loaded. Click "Start Analysis" to begin processing.`),P.audioUrl&&P.audioFileName)){const i={name:P.audioFileName,size:0,type:"audio/wav",lastModified:Date.now(),stream:()=>new ReadableStream,arrayBuffer:()=>Promise.resolve(new ArrayBuffer(0)),text:()=>Promise.resolve(""),slice:()=>new Blob},c={id:`prefilled-${Date.now()}`,file:i,url:P.audioUrl,duration:void 0};l?a([c]):p(c)}},[P,W,l]);const ut=h.useCallback(()=>{Ue.current&&(Ue.current.pause(),Ue.current.currentTime=0),s.forEach(i=>{i.url&&URL.revokeObjectURL(i.url)}),w!=null&&w.url&&URL.revokeObjectURL(w.url),et.current&&(et.current.value=""),a([]),p(null),v({}),m({}),U({}),b({stage:"idle",progress:0,message:""}),j(null),ie(null),$(!1),F(null),J([]),S({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""}),L({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""}),T(!1),ee(0),he(null),ct({}),dt({}),Ct(null),Re(mt),es(!1),Qe([])},[s,w]),ys=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),At=h.useCallback((i,c)=>{const y=ys(),A=URL.createObjectURL(i);let D;n==="batch-csv"&&c?D=c:n==="batch-files"?D={userId:ys(),age:k.age,gender:k.gender,race:k.race,ethnicity:k.ethnicity,language:k.language,weight:k.weight,zipcode:k.zipcode,sessionNotes:k.sessionNotes}:D=k;const O={id:y,file:i,url:A,userMetadata:D};l?(a(q=>[...q,O]),U(q=>({...q,[y]:"ready"})),m(q=>({...q,[y]:{stage:"idle",progress:0,message:"Ready to process"}}))):p(O),te(`Audio file selected: ${i.name}`);const z=new Audio(A);z.addEventListener("loadedmetadata",()=>{l?a(q=>q.map(re=>re.id===y?{...re,duration:z.duration}:re)):p(q=>q?{...q,duration:z.duration}:null)})},[l,te,n,k]),_r=h.useCallback(i=>{l&&(a(c=>{const y=c.find(A=>A.id===i);return y&&URL.revokeObjectURL(y.url),c.filter(A=>A.id!==i)}),m(c=>{const{[i]:y,...A}=c;return A}),v(c=>{const{[i]:y,...A}=c;return A}),U(c=>{const{[i]:y,...A}=c;return A}))},[l]),bs=h.useCallback((i,c)=>{n!=="single"?a(y=>y.map(A=>A.id===i?{...A,userMetadata:c}:A)):w&&w.id===i&&p(y=>y?{...y,userMetadata:c}:null)},[n,w]),vs=h.useCallback(()=>{const i=[];if(ue.age){const c=parseInt(ue.age);(isNaN(c)||c<18||c>130)&&i.push("Age must be between 18 and 130")}if(ue.weight){const c=parseInt(ue.weight);(isNaN(c)||c<10||c>1e3)&&i.push("Weight must be between 10 and 1000 pounds (lbs)")}return ue.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(ue.zipcode)||i.push("Zipcode must be alphanumeric and contain no more than 10 characters")),ue.sessionNotes&&ue.sessionNotes.length>500&&i.push("Session notes must be 500 characters or less"),i},[ue]),It=h.useCallback(i=>{if(!i)return;const c=parseInt(i);if(isNaN(c)||c<18||c>130)return"Age must be between 18 and 130"},[]),Et=h.useCallback(i=>{if(!i)return;const c=parseInt(i);if(isNaN(c)||c<10||c>1e3)return"Weight must be between 10 and 1000 pounds (lbs)"},[]),Rt=h.useCallback(i=>{if(!i)return;if(!/^[0-9]{5}$/.test(i))return"Zipcode must be 5 digits (e.g., 12345)"},[]),Mt=h.useCallback(i=>{if(i&&i.length>500)return"Session notes must be 500 characters or less"},[]),Tt=h.useCallback(i=>{if(!i)return;if(!["female","male","non-binary","transgender female","transgender male","other","prefer"].includes(i))return"Please select a valid gender option"},[]),Dt=h.useCallback(i=>{if(!i)return;if(!["white","black or african-american","asian","american indian or alaskan native","native hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(i))return"Please select a valid race option"},[]),Pt=h.useCallback(i=>{},[]),$t=h.useCallback((i,c)=>{let y;switch(i){case"age":y=It(c);break;case"weight":y=Et(c);break;case"zipcode":y=Rt(c);break;case"sessionNotes":y=Mt(c);break;case"gender":y=Tt(c);break;case"race":y=Dt(c);break;case"ethnicity":y=Pt(c);break;default:return}dt(A=>({...A,[i]:y}))},[It,Et,Rt,Mt,Tt,Dt,Pt]),Cr=h.useCallback((i,c)=>{Ct(i),Re(c||{...mt,userId:crypto.randomUUID()}),dt({})},[]),Ar=h.useCallback(()=>{if(_t){const i=vs();if(i.length>0){i.forEach(c=>{W("error","Validation Error",c)});return}bs(_t,ue),Ct(null),Re(mt),dt({})}},[_t,ue,bs,vs,W]),ws=h.useCallback(()=>{Ct(null),Re(mt),dt({})},[]),Ir=h.useCallback(i=>{var A;const c=(A=i.target.files)==null?void 0:A[0];if(!c)return;if(!c.name.toLowerCase().endsWith(".csv")){J(["Please select a valid CSV file"]);return}const y=new FileReader;y.onload=D=>{var O;try{const q=((O=D.target)==null?void 0:O.result).split(`
`).filter(se=>se.trim());if(q.length<2){J(["CSV must contain at least a header row and one data row"]);return}const re=q[0].split(",").map(se=>se.trim().replace(/"/g,"")),ae=["userId","fileUrl"],Ce=["age","gender","race","ethnicity","language","weight","zipcode","sessionNotes","fileName"],H=ae.filter(se=>!re.includes(se));if(H.length>0){J([`Missing required columns: ${H.join(", ")}`]);return}const ge=[],Z=[];for(let se=1;se<q.length;se++){const st=q[se].split(",").map(Ge=>Ge.trim().replace(/"/g,"")),ne={userId:"",fileUrl:""};re.forEach((Ge,Hr)=>{const Ps=st[Hr]||"";(Ge==="userId"||Ge==="fileUrl"||Ce.includes(Ge))&&(ne[Ge]=Ps)}),!ne.userId||!ne.fileUrl?Z.push(`Row ${se+1}: Missing required values for userId or fileUrl`):ne.fileUrl.startsWith("http")?ge.push(ne):Z.push(`Row ${se+1}: fileUrl must be a valid URL`)}if(Z.length>0){J(Z);return}F({rows:ge,fileName:c.name}),J([]),te(`CSV file loaded with ${ge.length} valid rows`)}catch{J(["Error parsing CSV file. Please check file format."])}},y.readAsText(c)},[te]),Er=h.useCallback(async()=>{if(!_)return;const i=_.rows.length;S({isProcessing:!0,currentFile:0,totalFiles:i,currentFileName:"",message:"Starting CSV batch processing..."});try{for(let c=0;c<_.rows.length;c++){const y=_.rows[c],A=y.fileName||y.fileUrl.split("/").pop()||"audio-file.wav";S(D=>({...D,currentFile:c+1,currentFileName:A,message:`Processing file ${c+1} of ${i}: ${A}`}));try{const D=await fetch(y.fileUrl);if(!D.ok)throw new Error(`Failed to fetch audio file: ${D.statusText}`);const O=await D.blob(),z=new window.File([O],A,{type:O.type||"audio/wav"}),q={userId:y.userId,age:y.age,gender:y.gender,race:y.race,ethnicity:y.ethnicity,language:y.language,weight:y.weight,zipcode:y.zipcode,sessionNotes:y.sessionNotes};At(z,q)}catch(D){console.error(`Error processing CSV row for ${y.userId}:`,D),W("error","File Processing Error",`Failed to process ${A}: ${D instanceof Error?D.message:"Unknown error"}`)}await new Promise(D=>setTimeout(D,100))}S(c=>({...c,message:`Successfully processed ${i} files from CSV`})),W("success","CSV Processing Complete",`Successfully loaded ${i} files from CSV for batch processing`),te(`CSV batch processing complete. ${i} files loaded successfully.`)}catch(c){console.error("CSV batch processing error:",c),W("error","CSV Processing Failed","An error occurred during CSV batch processing")}finally{setTimeout(()=>{S({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""})},2e3)}},[_,At,W,te,s]),Ft=h.useCallback(i=>{const c=i.target.files;!c||c.length===0||Array.from(c).forEach(y=>{const A=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],D=y.name.toLowerCase(),z=[".wav",".mp3",".m4a",".aac",".flac"].some(ae=>D.endsWith(ae));if(!A.includes(y.type)&&!z){ie(`Unsupported file type for ${y.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),W("error","Unsupported File",`${y.name} is not a supported audio file format`),te(`Error: Unsupported file format selected for ${y.name}`);return}const re=50*1024*1024;if(y.size>re){ie(`File ${y.name} is too large. File size must be less than 50MB`),W("error","File Too Large",`${y.name} size must be less than 50MB`),te(`Error: File ${y.name} is too large`);return}At(y),ie(null)})},[te,At,W]),Rr=h.useCallback(i=>{i.preventDefault()},[]),Mr=h.useCallback(i=>{i.preventDefault();const c=i.dataTransfer.files;c.length>0&&Ft({target:{files:c}})},[Ft]);h.useCallback(()=>{d(i=>{const c=!i;return Os(c?"batch-files":"single"),ut(),c})},[ut]);const Tr=h.useCallback(()=>{Ue.current&&(E?(Ue.current.pause(),T(!1),te("Audio paused")):(Ue.current.play(),T(!0),te("Audio playing")))},[E,te]),Dr=h.useCallback(()=>{Ue.current&&ee(Ue.current.currentTime)},[]),Lt=h.useCallback(i=>{const c=Math.floor(i/60),y=Math.floor(i%60);return`${c}:${y.toString().padStart(2,"0")}`},[]),$e=h.useCallback((i,c=0)=>{if(!i)return c;const y=parseFloat(i);return isNaN(y)?c:y},[]),tt=h.useCallback(()=>{const i=[];if(k.age){const c=parseInt(k.age);(isNaN(c)||c<18||c>130)&&i.push("Age must be between 18 and 130")}if(k.gender&&(["female","male","non-binary","transgender female","transgender male","other","prefer"].includes(k.gender)||i.push("Invalid gender. Must be: female, male, non-binary, transgender female, transgender male, other, or prefer")),k.race&&(["white","black or african-american","asian","american indian or alaskan native","native hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(k.race)||i.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native hawaiian or pacific islander, two or more races, other, prefer not to say")),k.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(k.ethnicity)||i.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),k.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(k.zipcode)||i.push("Zipcode must be alphanumeric and contain no more than 10 characters")),k.weight){const c=parseInt(k.weight);(isNaN(c)||c<10||c>1e3)&&i.push("Weight must be between 10 and 1000 pounds (lbs)")}return i},[k]),Fe=h.useCallback((i,c)=>{let y;switch(i){case"age":y=It(c);break;case"weight":y=Et(c);break;case"zipcode":y=Rt(c);break;case"sessionNotes":y=Mt(c);break;case"gender":y=Tt(c);break;case"race":y=Dt(c);break;case"ethnicity":y=Pt(c);break;default:return}ct(A=>{const D={...A,[i]:y};return Object.values(D).some(z=>z!==void 0)?y===void 0&&ie(z=>z&&z.toLowerCase().includes("validation")?null:z):ie(null),D})},[It,Et,Rt,Mt,Tt,Dt,Pt]),Pr=h.useCallback(async()=>{if(k.sessionNotes.trim()){es(!0);try{const i=await oe.correctGrammar(k.sessionNotes);M(c=>({...c,sessionNotes:i.correctedText})),W("success","Grammar Corrected","Grammar and spelling corrected successfully")}catch(i){console.error("Grammar correction failed:",i),W("error","Grammar Correction Failed",i.message||"Failed to correct grammar. Please try again.")}finally{es(!1)}}},[k.sessionNotes]),Ut=h.useCallback(()=>{const i={};let c=!1;if(k.age){const y=parseInt(k.age);isNaN(y)||(i.age=y,c=!0)}if(k.gender&&(i.gender=k.gender,c=!0),k.gender&&(i.gender=k.gender,c=!0),k.race&&(i.race=k.race,c=!0),k.ethnicity&&(i.ethnicity=k.ethnicity,c=!0),k.zipcode&&(i.zipcode=k.zipcode,c=!0),(k.language==="true"||k.language==="false")&&(i.language=k.language==="true",c=!0),k.weight){const y=parseInt(k.weight);isNaN(y)||(i.weight=y,c=!0)}return c?i:void 0},[k]),$r=h.useCallback(i=>{const c={};let y=!1;if(i.age){const A=parseInt(i.age);isNaN(A)||(c.age=A,y=!0)}if(i.weight){const A=parseInt(i.weight);isNaN(A)||(c.weight=A,y=!0)}return(i.language==="true"||i.language==="false")&&(c.language=i.language==="true",y=!0),i.gender&&(c.gender=i.gender,y=!0),i.race&&(c.race=i.race,y=!0),i.ethnicity&&(c.ethnicity=i.ethnicity,y=!0),i.zipcode&&(c.zipcode=i.zipcode,y=!0),y?c:void 0},[]),Fr=h.useCallback(()=>{n!=="batch-files"||s.length===0||(a(i=>i.map(c=>{var y,A,D,O,z,q,re,ae,Ce;return{...c,userMetadata:{userId:k.userId||((y=c.userMetadata)==null?void 0:y.userId)||crypto.randomUUID(),age:k.age||((A=c.userMetadata)==null?void 0:A.age)||"",gender:k.gender||((D=c.userMetadata)==null?void 0:D.gender)||"",race:k.race||((O=c.userMetadata)==null?void 0:O.race)||"",ethnicity:k.ethnicity||((z=c.userMetadata)==null?void 0:z.ethnicity)||"",language:k.language||((q=c.userMetadata)==null?void 0:q.language)||"",weight:k.weight||((re=c.userMetadata)==null?void 0:re.weight)||"",zipcode:k.zipcode||((ae=c.userMetadata)==null?void 0:ae.zipcode)||"",sessionNotes:k.sessionNotes||((Ce=c.userMetadata)==null?void 0:Ce.sessionNotes)||""}}})),W("success","Applied to All Files","Patient information has been applied to all uploaded files"),te("Patient information has been applied to all uploaded files"))},[n,s,k,W,te]),Lr=h.useCallback(()=>{const i=["userId","fileUrl","age","gender","race","ethnicity","primary language","weight","zipcode","sessionNotes","fileName"],c=[{userId:k.userId||"user-sample-1",fileUrl:"https://yourstorageaccount.blob.core.windows.net/audio/sample1.wav",age:k.age||"30",gender:k.gender||"male",race:k.race||"white",ethnicity:k.ethnicity||"not hispanic or latino","primary language":k.language==="true"?"english":k.language==="false"?"other":k.language||"english",weight:k.weight||"150",zipcode:k.zipcode||"12345",sessionNotes:k.sessionNotes||"Sample session notes",fileName:"sample1.wav"},{userId:k.userId?`${k.userId}-2`:"user-sample-2",fileUrl:"https://yourstorageaccount.blob.core.windows.net/audio/sample2.wav",age:k.age||"25",gender:k.gender||"female",race:k.race||"asian",ethnicity:k.ethnicity||"not hispanic or latino","primary language":k.language==="true"?"english":k.language==="false"?"other":k.language||"other",weight:k.weight||"120",zipcode:k.zipcode||"54321",sessionNotes:k.sessionNotes||"Another sample session",fileName:"sample2.wav"}],y=[i.join(","),...c.map(z=>i.map(q=>{const re=z[q]||"";return re.includes(",")||re.includes('"')?`"${re.replace(/"/g,'""')}"`:re}).join(","))].join(`
`),A=new Blob([y],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),O=URL.createObjectURL(A);D.setAttribute("href",O),D.setAttribute("download","batch-processing-template.csv"),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(O),W("success","CSV Template Downloaded","CSV template file has been downloaded with sample data"),te("CSV template file downloaded successfully")},[k,W,te]),Ur=h.useCallback(async()=>{if(l){if(s.length===0||!k.userId.trim()){ie("Please select audio files. User ID is automatically generated."),W("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await ks()}else{if(!w||!k.userId.trim()){ie("Please select an audio file. User ID is automatically generated."),W("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await zr()}},[w,s,k.userId,l]),Ot=h.useCallback(async(i,c)=>{try{m(H=>({...H,[i]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const y=c.userMetadata||k,A=c.userMetadata?$r(c.userMetadata):Ut(),D={userid:y.userId.trim(),is_initiated:!0};A&&(D.metadata=A);const O=await oe.initiateSession(D),z={sessionId:O.sessionId,userId:y.userId.trim()};m(H=>({...H,[i]:{stage:"initiating",progress:10,message:"Saving session data...",sessionId:O.sessionId}}));const q={sessionId:O.sessionId,userId:ht(),metadata_user_id:y.userId.trim(),...A&&{userMetadata:A},audioFileName:c.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (multi-file):",q);const H=await oe.saveSessionData(q);console.log("Session data saved successfully (multi-file):",H)}catch(H){console.error("Failed to save session data (multi-file):",H),console.error("Session data that failed to save:",q),W("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let re,ae;if(c.url&&!c.url.startsWith("blob:"))m(H=>({...H,[i]:{stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}})),re=c.url,ae=c.file.name,m(H=>({...H,[i]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));else{m(ge=>({...ge,[i]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const H=await as(c.file,ge=>{m(Z=>({...Z,[i]:{stage:"converting",progress:15+ge*.25,message:`Converting audio... ${Math.round(ge)}%`}}))});m(ge=>({...ge,[i]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}})),ae=`${k.userId}_${z.sessionId}_${Date.now()}.wav`,re=await ns(H,ae,ge=>{m(Z=>({...Z,[i]:{stage:"uploading",progress:40+ge*.25,message:`Uploading... ${Math.round(ge)}%`}}))},ht())}m(H=>({...H,[i]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const H={...q,audioUrl:re,audioFileName:ae,status:"processing",updatedAt:new Date().toISOString()};await oe.updateSessionData(z.sessionId,H)}catch(H){console.warn("Failed to update session data with audio info:",H)}await oe.submitPrediction({userId:k.userId.trim(),sessionid:z.sessionId,audioFileUrl:re,audioFileName:ae}),m(H=>({...H,[i]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const Ce=new Bs(z.sessionId);await new Promise((H,ge)=>{Ce.start(Z=>{const se=Z.status==="processing"?80:Z.status==="success"?95:70;m(st=>({...st,[i]:{stage:"analyzing",progress:se,message:`Analysis ${Z.status}...`}})),Z.predictError&&W("error","Prediction Error",`${Z.predictError.error}: ${Z.predictError.message}`)},Z=>{if(Z.predictError){W("error","Analysis Failed",`The analysis completed with an error: ${Z.predictError.error} - ${Z.predictError.message}`),m(ne=>({...ne,[i]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),ge(new Error(`Prediction error: ${Z.predictError.error}`));return}const se={sessionId:z.sessionId,depressionScore:$e(Z.predictedScoreDepression,0),riskLevel:(()=>{const ne=$e(Z.predictedScoreDepression,0);return ne>.7?"high":ne>.4?"medium":"low"})(),confidence:.85,insights:["Analysis completed using Kintsugi Health API",Z.predictedScoreDepression?`Depression score: ${Z.predictedScoreDepression}`:"",Z.predictedScoreAnxiety?`Anxiety score: ${Z.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(ne=>ne.trim()!==""),timestamp:Z.updatedAt,audioUrl:re,rawApiResponse:Z},st={...q,audioUrl:re,prediction:Z,analysisResults:{depressionScore:$e(Z.predictedScoreDepression),anxietyScore:$e(Z.predictedScoreAnxiety),riskLevel:(()=>{const ne=$e(Z.predictedScoreDepression,0);return ne>.7?"high":ne>.4?"medium":"low"})(),confidence:.85,insights:["Analysis completed using Kintsugi Health API",Z.predictedScoreDepression?`Depression score: ${Z.predictedScoreDepression}`:"",Z.predictedScoreAnxiety?`Anxiety score: ${Z.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(ne=>ne.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};oe.saveSessionData(st).then(ne=>{console.log("Multi-file session data saved with analysis results for session:",z.sessionId),console.log("Save result:",ne),W("success","Session Saved","Analysis results have been saved to session storage.")}).catch(ne=>{console.error("Failed to save multi-file analysis results to session storage:",ne),console.error("Session data that failed to save:",st),W("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),m(ne=>({...ne,[i]:{stage:"complete",progress:100,message:"Analysis complete!"}})),v(ne=>({...ne,[i]:se})),H()},Z=>{ge(Z)})})}catch(y){console.error(`Error processing file ${i}:`,y);let A="UNKNOWN_ERROR",D="An unexpected error occurred",O={};y&&typeof y=="object"?("code"in y&&typeof y.code=="string"&&(A=y.code),"message"in y&&typeof y.message=="string"&&(D=y.message),"details"in y&&typeof y.details=="object"&&(O=y.details)):y instanceof Error&&(D=y.message,A=y.name||"ERROR");try{const z=g[i];if(z&&z.sessionId){const q={sessionId:z.sessionId,userId:ht(),metadata_user_id:k.userId.trim(),audioFileName:c.file.name,createdAt:new Date().toISOString(),status:"failed",updatedAt:new Date().toISOString(),error:{code:A,message:D,details:O}};await oe.updateSessionData(z.sessionId,q),console.log(`Updated session ${z.sessionId} status to failed`)}}catch(z){console.error("Failed to update session status to failed:",z)}try{const z=g[i];if(z&&(z.stage==="uploading"||z.stage==="submitting"||z.stage==="analyzing")){const q=`${k.userId}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${q}`)}}catch(z){console.warn("Error during cleanup attempt:",z)}throw m(z=>({...z,[i]:{stage:"error",progress:0,message:"Processing failed",error:{code:A,message:D,details:O}}})),y}},[k.userId,Ut,oe,ns,as,W,$e]),ks=h.useCallback(async()=>{if($(!0),ie(null),n==="batch-files"||n==="batch-csv"){if(s.filter(D=>!D.userMetadata).length>0){ie("Some files are missing user metadata"),W("error","Validation Error","All files must have user metadata in batch mode"),$(!1);return}}else{const A=tt();if(A.length>0){ie(`Validation error: ${A.join(", ")}`),W("error","Validation Error",A.join(", ")),$(!1);return}}const i=s.filter(A=>I[A.id]==="ready");if(i.length===0){W("info","No Files Ready","No files are ready to process"),$(!1);return}const c=i.length;let y=0;L({isProcessing:!0,currentFile:0,totalFiles:c,currentFileName:"",message:"Starting batch file processing..."});try{for(const A of i){y++;const D=A.file.name;L(O=>({...O,currentFile:y,currentFileName:D,message:`Processing file ${y} of ${c}: ${D}`})),W("info","Processing File",`Processing ${D} (${y}/${c})`),U(O=>({...O,[A.id]:"processing"}));try{await Ot(A.id,A),U(O=>({...O,[A.id]:"complete"})),W("success","File Complete",`${D} processed successfully`),await new Promise(O=>setTimeout(O,100))}catch(O){let z="FILE_PROCESSING_ERROR",q="An unexpected error occurred",re={};O&&typeof O=="object"?("code"in O&&typeof O.code=="string"&&(z=O.code),"message"in O&&typeof O.message=="string"&&(q=O.message),"details"in O&&typeof O.details=="object"&&(re=O.details)):O instanceof Error&&(q=O.message,z=O.name||"ERROR"),W("error","File Failed",`Failed to process ${A.file.name}: ${q}`),U(ae=>({...ae,[A.id]:"error"})),m(ae=>({...ae,[A.id]:{stage:"error",progress:0,message:`Failed: ${q}`,error:{code:z,message:q,details:re}}}))}}W("success","Batch Complete",`Processed ${y} file${y!==1?"s":""}`),te(`Batch processing complete. ${y} files processed.`),L(A=>({...A,message:`Successfully processed ${y} files`}))}catch(A){const D=A instanceof Error?A.message:"An unexpected error occurred";ie(D),W("error","Batch Failed",D),te(`Error: ${D}`)}finally{$(!1),setTimeout(()=>{L({isProcessing:!1,currentFile:0,totalFiles:0,currentFileName:"",message:""})},2e3)}},[s,I,tt,W,te,Ot]),Or=h.useCallback(async i=>{const c=s.find(A=>A.id===i);if(!c)return;const y=tt();if(y.length>0){ie(`Validation error: ${y.join(", ")}`),W("error","Validation Error",y.join(", "));return}U(A=>({...A,[i]:"processing"}));try{await Ot(i,c),U(A=>({...A,[i]:"complete"})),W("success","File Complete",`${c.file.name} processed successfully`)}catch(A){console.error(`Error processing ${c.file.name}:`,A);const D=A instanceof Error?A.message:"An unexpected error occurred";W("error","File Failed",`Failed to process ${c.file.name}: ${D}`),U(O=>({...O,[i]:"error"})),m(O=>({...O,[i]:{stage:"error",progress:0,message:`Failed: ${D}`}}))}},[s,tt,W,Ot]),zr=h.useCallback(async()=>{if(!w||!k.userId.trim()){ie("Please select an audio file. User ID is automatically generated."),W("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const i=tt();if(i.length>0){ie(`Validation error: ${i.join(", ")}`),W("error","Validation Error",i.join(", "));return}try{ie(null),b({stage:"initiating",progress:5,message:"Initiating session..."}),te("Starting analysis process - initiating session");const c=Ut(),y={userid:k.userId.trim(),is_initiated:!0};c&&(y.metadata=c);const A=await oe.initiateSession(y),D={sessionId:A.sessionId,userId:k.userId.trim()};b({stage:"initiating",progress:10,message:"Saving session data..."});const O={sessionId:A.sessionId,userId:ht(),metadata_user_id:k.userId.trim(),...c&&{userMetadata:c},audioFileName:w.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (single-file):",O);const ae=await oe.saveSessionData(O);console.log("Session data saved successfully (single-file):",ae)}catch(ae){console.error("Failed to save session data (single-file):",ae),console.error("Session data that failed to save:",O),W("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let z,q;if(w.url&&!w.url.startsWith("blob:"))b({stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}),te("Session created successfully, reusing previously processed audio file"),z=w.url,q=w.file.name,b({stage:"submitting",progress:65,message:"Submitting for analysis..."});else{b({stage:"converting",progress:15,message:"Converting audio to required format..."}),te("Session created successfully, now converting audio");const ae=await as(w.file,Ce=>{b({stage:"converting",progress:15+Ce*.25,message:`Converting audio... ${Math.round(Ce)}%`})});b({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),te("Audio converted successfully, now uploading"),q=`${k.userId}_${D.sessionId}_${Date.now()}.wav`,z=await ns(ae,q,Ce=>{b({stage:"uploading",progress:40+Ce*.25,message:`Uploading... ${Math.round(Ce)}%`})},ht())}b({stage:"submitting",progress:65,message:"Submitting for analysis..."}),te("Upload complete, submitting for behavioral health analysis");try{const ae={...O,audioUrl:z,audioFileName:q,status:"processing",updatedAt:new Date().toISOString()};await oe.updateSessionData(D.sessionId,ae)}catch(ae){console.warn("Failed to update session data with audio info:",ae)}await oe.submitPrediction({userId:k.userId.trim(),sessionid:D.sessionId,audioFileUrl:z,audioFileName:q}),b({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),te("Prediction submitted, analysis in progress");const re=new Bs(D.sessionId);await new Promise((ae,Ce)=>{re.start(H=>{const ge=H.status==="processing"?80:H.status==="success"?95:70;b({stage:"analyzing",progress:ge,message:`Analysis ${H.status}...`}),H.predictError&&W("error","Prediction Error",`${H.predictError.error}: ${H.predictError.message}`)},H=>{if(H.predictError){W("error","Analysis Failed",`The analysis completed with an error: ${H.predictError.error} - ${H.predictError.message}`),b({stage:"error",progress:0,message:"Analysis failed with errors"}),Ce(new Error(`Prediction error: ${H.predictError.error}`));return}const ge={sessionId:D.sessionId,depressionScore:$e(H.predictedScoreDepression,0),riskLevel:(()=>{const se=$e(H.predictedScoreDepression,0);return se>.7?"high":se>.4?"medium":"low"})(),confidence:.85,insights:["Analysis completed using Kintsugi Health API",H.predictedScoreDepression?`Depression score: ${H.predictedScoreDepression}`:"",H.predictedScoreAnxiety?`Anxiety score: ${H.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(se=>se.trim()!==""),timestamp:H.updatedAt,audioUrl:z,rawApiResponse:H},Z={...O,audioUrl:z,prediction:H,analysisResults:{depressionScore:$e(H.predictedScoreDepression),anxietyScore:$e(H.predictedScoreAnxiety),riskLevel:(()=>{const se=$e(H.predictedScoreDepression,0);return se>.7?"high":se>.4?"medium":"low"})(),confidence:.85,insights:["Analysis completed using Kintsugi Health API",H.predictedScoreDepression?`Depression score: ${H.predictedScoreDepression}`:"",H.predictedScoreAnxiety?`Anxiety score: ${H.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(se=>se.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};oe.saveSessionData(Z).then(se=>{console.log("Session data saved with analysis results for session:",D.sessionId),console.log("Save result:",se),W("success","Session Saved","Analysis results have been saved to session storage.")}).catch(se=>{console.error("Failed to save analysis results to session storage:",se),console.error("Session data that failed to save:",Z),W("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),b({stage:"complete",progress:100,message:"Analysis complete!"}),j(ge),W("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),te("Behavioral health analysis completed successfully"),ae()},H=>{W("error","Analysis Error",H.message||"An unexpected error occurred during analysis."),Ce(H)})})}catch(c){console.error("Processing error:",c);const y=c instanceof Error?c.message:"An unexpected error occurred";ie(y),b({stage:"error",progress:0,message:"Processing failed"}),W("error","Processing Failed",y),te(`Error: ${y}`)}},[w,k.userId,te,tt,Ut,$e]),js=h.useCallback(i=>{switch(i){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),e.jsx("div",{className:"flex items-center space-x-2",children:["single","batch-files","batch-csv"].map(i=>e.jsxs("button",{type:"button",onClick:()=>{o(i),Os(i),ut(),te(`Switched to ${i==="single"?"Single File":i==="batch-files"?"Batch Files":"CSV Batch"} mode`)},className:`px-3 py-1 text-xs font-medium rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${n===i?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:[i==="single"&&"Single File",i==="batch-files"&&"Batch Files",i==="batch-csv"&&"CSV Batch"]},i))})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${n==="single"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":n==="batch-files"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}`,children:n==="single"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm12 2H4v8h12V6z",clipRule:"evenodd"})}),"Single File Processing"]}):n==="batch-files"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch File Processing"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"CSV Batch Processing"]})})]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",n==="single"?"an audio file":n==="batch-files"?"multiple audio files":"audio files via CSV"," for behavioral health analysis using AI-powered speech pattern recognition"]}),e.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${n==="single"?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300":n==="batch-files"?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-purple-50 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300"}`,children:n==="single"?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]}):n==="batch-files"?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual patient metadata for each file"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload CSV file with patient data and blob storage URLs for batch processing"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:n==="batch-files"?"Patient Information (Optional, Apply to All Files)":n==="batch-csv"?"Default Patient Information (Optional, Override with CSV Data)":"Patient Information (Optional)"}),n==="batch-files"&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Note:"}),' Information entered here will be applied to all uploaded files. After uploading, you can click "Edit Info" on individual files to customize their metadata.']})}),n==="batch-csv"&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md",children:e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"Note:"})," This serves as default information. Data from your CSV file will override these values for each row."]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID (Auto-generated, editable)"}),e.jsx("input",{type:"text",id:"userId",value:k.userId,onChange:i=>M(c=>({...c,userId:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-generated user ID"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for API calls. Auto-generated but can be customized."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsx("input",{type:"number",id:"age",value:k.age,onChange:i=>{const c=i.target.value;M(y=>({...y,age:c})),Fe("age",c)},onBlur:i=>Fe("age",i.target.value),onKeyUp:i=>{(i.key==="Enter"||i.key==="Tab")&&Fe("age",i.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${de.age?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Age in years",min:"1",max:"150","aria-describedby":de.age?"age-error":void 0}),de.age&&e.jsx("p",{id:"age-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:de.age})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsx("input",{type:"number",id:"weight",value:k.weight,onChange:i=>{const c=i.target.value;M(y=>({...y,weight:c})),Fe("weight",c)},onBlur:i=>Fe("weight",i.target.value),onKeyUp:i=>{(i.key==="Enter"||i.key==="Tab")&&Fe("weight",i.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${de.weight?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Weight in lbs",min:"1",max:"1000","aria-describedby":de.weight?"weight-error":void 0}),de.weight&&e.jsx("p",{id:"weight-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:de.weight})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsxs("select",{id:"gender",value:k.gender,onChange:i=>M(c=>({...c,gender:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"non-binary",children:"Non-binary"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer",children:"Prefer not to specify"}),e.jsx("option",{value:"transgender female",children:"Transgender Female"}),e.jsx("option",{value:"transgender male",children:"Transgender Male"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsxs("select",{id:"race",value:k.race,onChange:i=>M(c=>({...c,race:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select race"}),e.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),e.jsx("option",{value:"asian",children:"Asian"}),e.jsx("option",{value:"black or african-american",children:"Black or African-American"}),e.jsx("option",{value:"native hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer not to say",children:"Prefer not to say"}),e.jsx("option",{value:"two or more races",children:"Two or more races"}),e.jsx("option",{value:"white",children:"White"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsxs("select",{id:"ethnicity",value:k.ethnicity,onChange:i=>M(c=>({...c,ethnicity:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select ethnicity"}),e.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),e.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language"}),e.jsxs("select",{id:"language",value:k.language,onChange:i=>M(c=>({...c,language:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select language"}),e.jsx("option",{value:"true",children:"English"}),e.jsx("option",{value:"false",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",id:"zipcode",value:k.zipcode,onChange:i=>{const c=i.target.value;M(y=>({...y,zipcode:c})),Fe("zipcode",c)},onBlur:i=>Fe("zipcode",i.target.value),onKeyUp:i=>{(i.key==="Enter"||i.key==="Tab")&&Fe("zipcode",i.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${de.zipcode?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)","aria-describedby":de.zipcode?"zipcode-error":void 0}),de.zipcode&&e.jsx("p",{id:"zipcode-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:de.zipcode})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("textarea",{id:"sessionNotes",value:k.sessionNotes,onChange:i=>M(c=>({...c,sessionNotes:i.target.value})),onBlur:i=>Fe("sessionNotes",i.target.value),onKeyUp:i=>{(i.key==="Enter"||i.key==="Tab")&&Fe("sessionNotes",i.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${de.sessionNotes?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,rows:3,placeholder:"Additional notes about this session or patient context","aria-describedby":de.sessionNotes?"sessionNotes-error":void 0}),de.sessionNotes&&e.jsx("p",{id:"sessionNotes-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:de.sessionNotes}),e.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[k.sessionNotes.length,"/500 characters"]}),e.jsxs("button",{type:"button",onClick:()=>Pr(),disabled:!k.sessionNotes.trim()||qe,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-blue-700 bg-blue-50 border border-blue-200 hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:text-blue-300 dark:bg-blue-900/20 dark:border-blue-700 dark:hover:bg-blue-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Correct grammar and spelling in session notes",title:"Correct grammar and spelling",children:[qe?e.jsx(qs,{className:"w-3.5 h-3.5 mr-1.5 animate-spin","aria-hidden":"true"}):e.jsx("svg",{className:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),qe?"Correcting...":"Correct Grammar"]}),n==="batch-csv"&&e.jsxs("button",{type:"button",onClick:Lr,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-purple-700 bg-purple-50 border border-purple-200 hover:bg-purple-100 hover:border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1 dark:text-purple-300 dark:bg-purple-900/20 dark:border-purple-700 dark:hover:bg-purple-900/30 transition-colors ml-2","aria-label":"Download CSV template file with sample data",title:"Download CSV template",children:[e.jsx("svg",{className:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV Template"]}),n==="batch-files"&&s.length>0&&e.jsxs("button",{type:"button",onClick:Fr,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-green-700 bg-green-50 border border-green-200 hover:bg-green-100 hover:border-green-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 dark:text-green-300 dark:bg-green-900/20 dark:border-green-700 dark:hover:bg-green-900/30 transition-colors ml-2","aria-label":"Apply patient information to all uploaded files",title:"Apply to all files",children:[e.jsx("svg",{className:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Apply to All Files"]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:[n==="batch-csv"?"CSV File Upload":"Audio File Upload",n==="batch-files"&&e.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Batch Files Mode)"})]}),n==="batch-csv"&&e.jsxs("div",{className:"space-y-4",children:[_?e.jsxs("div",{className:"border border-green-200 dark:border-green-600 bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"font-medium text-green-800 dark:text-green-200",children:"CSV Loaded Successfully"})]}),e.jsx("button",{onClick:()=>{F(null),J([])},className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(Be,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mb-3",children:[_.rows.length," valid records found in ",_.fileName]}),C.isProcessing&&e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Processing CSV Files"}),e.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:[C.currentFile," of ",C.totalFiles]})]}),e.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-2 rounded-full transition-all duration-300",style:{width:`${C.totalFiles>0?C.currentFile/C.totalFiles*100:0}%`},role:"progressbar","aria-valuenow":C.currentFile,"aria-valuemin":0,"aria-valuemax":C.totalFiles,"aria-label":"CSV processing progress"})}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:C.message}),C.currentFileName&&e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Current file: ",C.currentFileName]})]}),e.jsx("button",{onClick:Er,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800",children:"Load Audio Files from CSV"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-purple-400 dark:hover:border-purple-500 transition-colors",children:[e.jsx(Gs,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>{const i=document.createElement("input");i.type="file",i.accept=".csv",i.onchange=c=>Ir(c),i.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Select CSV File"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Upload a CSV file with patient data and file URLs"})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-2",children:[e.jsx("p",{children:"Required columns: userId, fileUrl"}),e.jsx("p",{children:"Optional columns: age, gender, race, ethnicity, language, weight, zipcode, sessionNotes, fileName"}),e.jsx("p",{children:"Example: userId,fileUrl,age,gender,zipcode"})]})]}),G.length>0&&e.jsxs("div",{className:"border border-red-200 dark:border-red-600 bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Te,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium text-red-800 dark:text-red-200",children:"CSV Validation Errors"})]}),e.jsx("ul",{className:"text-sm text-red-700 dark:text-red-300 space-y-1",children:G.map((i,c)=>e.jsxs("li",{children:["â€¢ ",i]},c))})]})]}),n!=="batch-csv"&&e.jsx("div",{children:n==="single"&&!w||n==="batch-files"&&s.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:Rr,onDrop:Mr,children:[e.jsx(Gs,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>{var i;return(i=et.current)==null?void 0:i.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Select Audio File",n!=="single"?"s":""]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",n!=="single"?"files":"file"," here"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",n!=="single"&&e.jsx("br",{}),n!=="single"&&"You can select multiple files at once"]}),e.jsx("input",{ref:et,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ft,multiple:n!=="single","aria-label":`Select audio file${n!=="single"?"s":""} for analysis`})]}):e.jsxs("div",{className:"space-y-4",children:[n==="single"&&w&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(wt,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:w.file.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(w.file.size/1024/1024).toFixed(2)," MB",w.duration&&` â€¢ ${Lt(w.duration)}`]})]})]}),e.jsx("button",{type:"button",onClick:ut,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:Tr,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":E?"Pause audio":"Play audio",children:E?e.jsx(ds,{className:"h-5 w-5","aria-hidden":"true"}):e.jsx(rt,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:w.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Lt(V)," / ",Lt(w.duration)]})})]}),w.duration&&e.jsx("div",{className:"audio-progress",children:e.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${V/w.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":V,"aria-valuemin":0,"aria-valuemax":w.duration})})]}),e.jsx("audio",{ref:Ue,src:w.url,onTimeUpdate:Dr,onEnded:()=>T(!1),onPlay:()=>T(!0),onPause:()=>T(!1),className:"hidden"})]}),n!=="single"&&s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",s.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var i;return(i=et.current)==null?void 0:i.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(i=>{var A;const c=I[i.id]||"ready",y=g[i.id];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsx(wt,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:i.file.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(i.file.size/1024/1024).toFixed(2)," MB",i.duration&&` â€¢ ${Lt(i.duration)}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(A=i.userMetadata)!=null&&A.userId?e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["ID: ",i.userMetadata.userId.slice(0,8),"...",i.userMetadata.age&&` â€¢ Age: ${i.userMetadata.age}`,i.userMetadata.gender&&` â€¢ ${i.userMetadata.gender}`]}):e.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-400",children:"No metadata set"}),e.jsxs("button",{onClick:()=>Cr(i.id,i.userMetadata),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500","aria-label":`Edit metadata for ${i.file.name}`,children:[e.jsx(Tn,{className:"h-3 w-3 mr-1"}),"Edit Info"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c==="ready"&&e.jsxs("button",{type:"button",onClick:()=>Or(i.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${i.file.name}`,children:[e.jsx(rt,{className:"h-3 w-3 mr-1"}),"Start"]}),c==="processing"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),c==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Complete"]}),c==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"Error"]}),e.jsx("button",{type:"button",onClick:()=>_r(i.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${i.file.name}`,children:e.jsx(pt,{className:"h-4 w-4"})})]})]}),y&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:y.message}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(y.progress),"%"]})]}),e.jsx("div",{className:"processing-progress mt-1",children:e.jsx("div",{className:`processing-progress__fill ${js(y.stage)}`,style:{width:`${y.progress}%`}})})]})]},i.id)})}),e.jsx("input",{ref:et,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ft,multiple:n==="batch-files"||n==="batch-csv","aria-label":"Select additional audio files for analysis"})]})]})}),fe&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:fe})]})}),n==="single"&&u.stage!=="idle"&&!x&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:u.message}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(u.progress),"%"]})]}),e.jsx("div",{className:"processing-progress",children:e.jsx("div",{className:`processing-progress__fill progress-animated ${js(u.stage)}`,style:{width:`${u.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":u.progress,"aria-valuemin":0,"aria-valuemax":100})}),u.stage==="analyzing"&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(qs,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),x&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ee,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),x.rawApiResponse&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.predicted_score_anxiety||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`font-mono ${x.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:x.rawApiResponse.status||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.model_category||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.model_granularity||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),e.jsx("span",{className:`font-mono ${x.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:x.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),x.rawApiResponse.actual_score&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[x.rawApiResponse.actual_score.depression_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.actual_score.depression_binary||"N/A"})]}),x.rawApiResponse.actual_score.anxiety_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),x.rawApiResponse.actual_score.phq_9&&x.rawApiResponse.actual_score.phq_9.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",x.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),x.rawApiResponse.actual_score.phq_2&&x.rawApiResponse.actual_score.phq_2.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",x.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),x.rawApiResponse.actual_score.gad_7&&x.rawApiResponse.actual_score.gad_7.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",x.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:x.rawApiResponse.created_at?new Date(x.rawApiResponse.created_at).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:x.rawApiResponse.updated_at?new Date(x.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:x.sessionId})]})})]}),x.rawApiResponse.predict_error&&e.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:x.rawApiResponse.predict_error.error})]}),e.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[e.jsx("span",{className:"font-medium",children:"Message:"})," ",x.rawApiResponse.predict_error.message]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(x.rawApiResponse,null,2)})})]})]})})]}),x.insights&&x.insights.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),e.jsx("ul",{className:"space-y-1",children:x.insights.map((i,c)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["â€¢ ",i]},c))})]}),e.jsx("div",{className:"mt-6 flex space-x-3",children:e.jsx("button",{type:"button",onClick:ut,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(()=>{const i=n!=="single"&&s.length>0||n==="single"&&w,c=n==="batch-csv"&&_&&!C.isProcessing;return(i||c)&&!x&&Object.keys(f).length===0&&u.stage==="idle"&&!B})()&&e.jsx("div",{className:"text-center",children:n!=="single"?e.jsxs("div",{className:"space-y-4",children:[R.isProcessing&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Processing Batch Files"}),e.jsxs("span",{className:"text-sm text-green-700 dark:text-green-300",children:[R.currentFile," of ",R.totalFiles]})]}),e.jsx("div",{className:"w-full bg-green-200 dark:bg-green-800 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-green-600 dark:bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${R.totalFiles>0?R.currentFile/R.totalFiles*100:0}%`},role:"progressbar","aria-valuenow":R.currentFile,"aria-valuemin":0,"aria-valuemax":R.totalFiles,"aria-label":"Batch processing progress"})}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:R.message}),R.currentFileName&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["Current file: ",R.currentFileName]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsxs("button",{type:"button",onClick:ks,disabled:s.length===0||!k.userId.trim()||!s.some(i=>I[i.id]==="ready")||!!fe||Object.values(de).some(i=>i!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(rt,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",s.filter(i=>I[i.id]==="ready").length>0&&` (${s.filter(i=>I[i.id]==="ready").length})`]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:Ur,disabled:!w||!k.userId.trim()||!!fe||Object.values(de).some(i=>i!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(rt,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),n!=="single"&&Object.keys(f).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ee,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(f).length," files)"]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(f).map(([i,c])=>{const y=s.find(D=>D.id===i),A=g[i];return e.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(y==null?void 0:y.file.name)||`File ${i}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(A==null?void 0:A.stage)==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Complete"]}),(A==null?void 0:A.stage)==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(A==null?void 0:A.stage)==="error"&&(A==null?void 0:A.error)&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Te,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:A.error.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:A.error.message})]})]}),A.error.details&&Object.keys(A.error.details).length>0&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),e.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:e.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(A.error.details,null,2)})})]})]})]})]})}),c.rawApiResponse&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:c.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:c.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:c.sessionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:c.rawApiResponse.status||"N/A"})]})]})}),e.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(c.rawApiResponse,null,2)})})]})]}),y&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{const D=document.getElementById(`audio-${i}`);D.paused?(document.querySelectorAll("audio").forEach(O=>O.pause()),he(i),D.play()):(D.pause(),he(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":pe===i?"Pause audio":"Play audio",children:pe===i?e.jsx(ds,{className:"h-4 w-4"}):e.jsx(rt,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[y.file.name," â€¢ ",y.duration?`${Math.round(y.duration)}s`:"Duration unknown"]})]}),e.jsx("audio",{id:`audio-${i}`,src:y.url,onEnded:()=>he(null),className:"hidden"})]})]},i)})})]}),St.length>0&&e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:St.map(i=>e.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${i.type==="error"?"border-red-500":i.type==="warning"?"border-yellow-500":i.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-shrink-0",children:[i.type==="error"&&e.jsx(Te,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),i.type==="warning"&&e.jsx(Te,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),i.type==="success"&&e.jsx(Ee,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),i.type==="info"&&e.jsx(Te,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:i.message})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>Sr(i.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:e.jsx(Be,{className:"h-4 w-4"})})})]})},i.id))}),_t&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Edit Patient Metadata"}),e.jsx("button",{onClick:ws,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Close metadata editor",children:e.jsx(Be,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID"}),e.jsx("input",{id:"temp-userId",type:"text",value:ue.userId,onChange:i=>Re(c=>({...c,userId:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter user ID"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsx("input",{id:"temp-age",type:"number",value:ue.age,onChange:i=>{Re(c=>({...c,age:i.target.value})),$t("age",i.target.value)},className:`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${Pe.age?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter age",min:"18",max:"130"}),Pe.age&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:Pe.age})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsxs("select",{id:"temp-gender",value:ue.gender,onChange:i=>Re(c=>({...c,gender:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"non-binary",children:"Non-binary"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer",children:"Prefer not to specify"}),e.jsx("option",{value:"transgender female",children:"Transgender Female"}),e.jsx("option",{value:"transgender male",children:"Transgender Male"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsxs("select",{id:"temp-race",value:ue.race,onChange:i=>Re(c=>({...c,race:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select race"}),e.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),e.jsx("option",{value:"asian",children:"Asian"}),e.jsx("option",{value:"black or african-american",children:"Black or African-American"}),e.jsx("option",{value:"native hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer not to say",children:"Prefer not to say"}),e.jsx("option",{value:"two or more races",children:"Two or more races"}),e.jsx("option",{value:"white",children:"White"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsxs("select",{id:"temp-ethnicity",value:ue.ethnicity,onChange:i=>Re(c=>({...c,ethnicity:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select ethnicity"}),e.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),e.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language"}),e.jsxs("select",{id:"temp-language",value:ue.language,onChange:i=>Re(c=>({...c,language:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select language"}),e.jsx("option",{value:"true",children:"English"}),e.jsx("option",{value:"false",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight (lbs)"}),e.jsx("input",{id:"temp-weight",type:"number",value:ue.weight,onChange:i=>{Re(c=>({...c,weight:i.target.value})),$t("weight",i.target.value)},className:`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${Pe.weight?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,placeholder:"Weight in pounds",min:"10",max:"1000"}),Pe.weight&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:Pe.weight})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("input",{id:"temp-zipcode",type:"text",value:ue.zipcode,onChange:i=>{Re(c=>({...c,zipcode:i.target.value})),$t("zipcode",i.target.value)},className:`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${Pe.zipcode?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,placeholder:"ZIP code",maxLength:10}),Pe.zipcode&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:Pe.zipcode})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"temp-sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("textarea",{id:"temp-sessionNotes",value:ue.sessionNotes,onChange:i=>{Re(c=>({...c,sessionNotes:i.target.value})),$t("sessionNotes",i.target.value)},className:`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${Pe.sessionNotes?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,placeholder:"Session notes or comments",rows:3,maxLength:500}),Pe.sessionNotes&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:Pe.sessionNotes})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-600 flex justify-end space-x-3",children:[e.jsx("button",{onClick:ws,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{onClick:Ar,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Save Changes"})]})]})})]})]})},Bt={queued:{color:"yellow",icon:Ze,label:"Queued"},running:{color:"blue",icon:ce,label:"Processing"},processing:{color:"blue",icon:ce,label:"Processing"},succeeded:{color:"green",icon:Ee,label:"Completed"},success:{color:"green",icon:Ee,label:"Completed"},completed:{color:"green",icon:Ee,label:"Completed"},failed:{color:"red",icon:Yt,label:"Failed"},error:{color:"red",icon:Yt,label:"Error"}},Vt=r=>r?r.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):"â€”",Wt=r=>{if(!r)return 0;switch(r.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},ei=()=>{const{user:r}=We(),t=Zt(),[s,a]=h.useState([]),[n,o]=h.useState(!0),[l,d]=h.useState(null),[g,m]=h.useState(new Set),[f,v]=h.useState(!1),[I,U]=h.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:B}=lt(),$=h.useCallback(()=>(r==null?void 0:r.id)||ze(),[r==null?void 0:r.id]),_=h.useCallback(async()=>{try{o(!0),d(null);const u=$(),x=(await oe.getUserSessions(u)).sessions.map(j=>{var V,ee;const E=j.prediction,T=j.analysisResults;return{...j,uploadedAt:j.createdAt,fileName:j.audioFileName||`Audio_${j.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:(T==null?void 0:T.riskLevel)||"unknown",depressionScore:((V=T==null?void 0:T.depressionScore)==null?void 0:V.toString())||(E==null?void 0:E.predicted_score_depression)||(E==null?void 0:E.predictedScoreDepression)||void 0,anxietyScore:((ee=T==null?void 0:T.anxietyScore)==null?void 0:ee.toString())||(E==null?void 0:E.predicted_score_anxiety)||(E==null?void 0:E.predictedScoreAnxiety)||void 0}});a(x),B(`${x.length} sessions loaded successfully`)}catch(u){const b=u;d(b),B(`Error loading sessions: ${b.message}`)}finally{o(!1)}},[B]);h.useEffect(()=>{_()},[_]);const F=h.useMemo(()=>{let u=s;if(I.search){const b=I.search.toLowerCase();u=u.filter(x=>{var j,E;return x.sessionId.toLowerCase().includes(b)||((j=x.fileName)==null?void 0:j.toLowerCase().includes(b))||((E=Bt[x.status])==null?void 0:E.label.toLowerCase().includes(b))})}if(I.status!=="all"&&(u=u.filter(b=>b.status===I.status)),I.dateRange!=="all"){const b=new Date,x=new Date;switch(I.dateRange){case"today":x.setHours(0,0,0,0);break;case"week":x.setDate(b.getDate()-7);break;case"month":x.setMonth(b.getMonth()-1);break;case"year":x.setFullYear(b.getFullYear()-1);break}u=u.filter(j=>new Date(j.uploadedAt)>=x)}return u.sort((b,x)=>{let j=0;switch(I.sortBy){case"date":j=new Date(b.uploadedAt).getTime()-new Date(x.uploadedAt).getTime();break;case"status":j=b.status.localeCompare(x.status);break;case"depressionScore":const E=Wt(b.depressionScore),T=Wt(x.depressionScore);j=E-T;break;case"anxietyScore":const V=Wt(b.anxietyScore),ee=Wt(x.anxietyScore);j=V-ee;break}return I.sortOrder==="desc"?-j:j}),u},[s,I]),G=h.useCallback((u,b)=>{U(x=>({...x,[u]:b})),B(`Filter ${u} changed to ${b}`)},[B]),J=h.useCallback(u=>{m(b=>{const x=new Set(b);return x.has(u)?(x.delete(u),B("Session deselected")):(x.add(u),B("Session selected")),x})},[B]),C=h.useCallback(()=>{g.size===F.length?(m(new Set),B("All sessions deselected")):(m(new Set(F.map(b=>b.sessionId))),B(`All ${F.length} sessions selected`))},[g.size,F,B]),S=h.useCallback(async u=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await oe.deleteSessionData(u),a(x=>x.filter(j=>j.sessionId!==u)),m(x=>{const j=new Set(x);return j.delete(u),j}),B("Session deleted successfully")}catch(x){const j=x;B(`Error deleting session: ${j.message}`),alert(`Failed to delete session: ${j.message}`)}},[B]),R=h.useCallback(async u=>{if(window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled."))try{const x=s.find(j=>j.sessionId===u);if(!x){B("Cannot re-run analysis: Session not found"),alert("Cannot re-run analysis: Session not found");return}B("Redirecting to upload page for re-run..."),t("/upload",{state:{originalSessionId:x.sessionId,audioFileName:x.audioFileName,audioUrl:x.audioUrl,userMetadata:x.userMetadata}})}catch(x){const j=x;B(`Error preparing re-run: ${j.message}`),alert(`Failed to prepare re-run: ${j.message}`)}},[B,s,t]),L=h.useCallback(async()=>{if(g.size===0||!window.confirm(`Are you sure you want to delete ${g.size} session(s)? This action cannot be undone.`))return;const b=Array.from(g);let x=0,j=[];for(const E of b)try{await oe.deleteSessionData(E),x++}catch(T){const V=T;j.push(E),console.error(`Failed to delete session ${E}:`,V.message)}if(x>0&&a(E=>E.filter(T=>!(g.has(T.sessionId)&&!j.includes(T.sessionId)))),m(new Set),j.length===0)B(`${x} sessions deleted successfully`);else{const E=`${x} sessions deleted successfully, ${j.length} failed`;B(E),alert(`${E}. Failed sessions: ${j.join(", ")}`)}},[g,B]),w=u=>{if(u===0)return"0 B";const b=1024,x=["B","KB","MB","GB"],j=Math.floor(Math.log(u)/Math.log(b));return`${parseFloat((u/Math.pow(b,j)).toFixed(1))} ${x[j]}`},p=({status:u})=>{const b=u.toLowerCase();let x=Bt[u];x||(b.includes("error")||b.includes("fail")?x=Bt.error:x=Bt.queued);const j=x.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":x.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":x.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${x.label}`,children:[e.jsx(j,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),x.label]})};return n?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):l?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:l.message}),e.jsx("button",{type:"button",onClick:_,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:_,disabled:n,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[e.jsx(ce,{className:`w-4 h-4 mr-2 ${n?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsx(ve,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),e.jsxs("div",{className:"relative",children:[e.jsx(Cn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:I.search,onChange:u=>G("search",u.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),e.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),e.jsxs("button",{type:"button",onClick:()=>v(!f),className:"btn btn--secondary flex items-center","aria-expanded":f,"aria-controls":"filter-panel","aria-label":`${f?"Hide":"Show"} filter options`,children:[e.jsx(mr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",f?e.jsx(gr,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):e.jsx(ur,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),f&&e.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{id:"status-filter",value:I.status,onChange:u=>G("status",u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"queued",children:"Queued"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"succeeded",children:"Completed"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-filter",value:I.dateRange,onChange:u=>G("dateRange",u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),e.jsxs("select",{id:"sort-by",value:I.sortBy,onChange:u=>G("sortBy",u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"depressionScore",children:"Depression Score"}),e.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),e.jsxs("select",{id:"sort-order",value:I.sortOrder,onChange:u=>G("sortOrder",u.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),F.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[F.length," of ",s.length," sessions",g.size>0&&` â€¢ ${g.size} selected`]})}),g.size>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:L,className:"btn btn--danger","aria-label":`Delete ${g.size} selected sessions`,children:[e.jsx(pt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),F.length>0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:g.size===F.length,onChange:C,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:F.map(u=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:g.has(u.sessionId),onChange:()=>J(u.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${u.sessionId}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:u.fileName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",u.sessionId.slice(-12)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:w(u.fileSize||0)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(p,{status:u.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:u.depressionScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Vt(u.depressionScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:u.anxietyScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Vt(u.anxietyScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:ft(u.uploadedAt)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:nt(u.uploadedAt)})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(ve,{to:`/sessions/${u.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${u.sessionId}`,children:e.jsx(bt,{className:"w-4 h-4","aria-hidden":"true"})}),u.status==="succeeded"&&e.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${u.sessionId}`,children:e.jsx(Kt,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>R(u.sessionId),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`Re-run analysis for session ${u.sessionId}`,children:e.jsx(ce,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>S(u.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${u.sessionId}`,children:e.jsx(pt,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},u.sessionId))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4",children:F.map(u=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:g.has(u.sessionId),onChange:()=>J(u.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${u.sessionId}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:u.fileName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",u.sessionId.slice(-12)]})]})]}),e.jsx(p,{status:u.status})]}),(u.depressionScore||u.anxietyScore)&&e.jsxs("div",{className:"text-sm",children:[u.depressionScore&&e.jsxs("div",{children:["Depression: ",Vt(u.depressionScore)]}),u.anxietyScore&&e.jsxs("div",{children:["Anxiety: ",Vt(u.anxietyScore)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:ft(u.uploadedAt)}),e.jsx("span",{children:w(u.fileSize||0)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs(ve,{to:`/sessions/${u.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${u.sessionId}`,children:[e.jsx(bt,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),u.status==="succeeded"&&e.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${u.sessionId}`,children:[e.jsx(Kt,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),e.jsxs("button",{type:"button",onClick:()=>R(u.sessionId),className:"btn btn--secondary text-xs","aria-label":`Re-run analysis for session ${u.sessionId}`,children:[e.jsx(ce,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:()=>S(u.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${u.sessionId}`,children:[e.jsx(pt,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},u.sessionId))})]}):e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(Te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),s.length===0?e.jsx(ve,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):e.jsx("button",{type:"button",onClick:()=>U({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},ti={low:{color:"green",label:"Low Risk",icon:Ee,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:br,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:hs,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:hs,description:"Urgent intervention required"}},si=({sessionId:r,existingAssessment:t,onAssessmentUpdated:s})=>{const{announceToScreenReader:a}=lt(),[n,o]=h.useState(t||null),[l,d]=h.useState(!1),[g,m]=h.useState(!1),[f,v]=h.useState(null),I=h.useCallback(async()=>{try{d(!0),v(null),a("Generating AI risk assessment...");const $=await oe.generateRiskAssessment(r);if($.success&&$.riskAssessment)o($.riskAssessment),s==null||s($.riskAssessment),a("Risk assessment generated successfully");else throw new Error($.message||"Failed to generate risk assessment")}catch($){const _=$;v(_),a(`Error generating assessment: ${_.message}`)}finally{d(!1)}},[r,s,a]),U=h.useCallback(async()=>{try{m(!0),v(null);const $=await oe.getRiskAssessment(r);$.success&&$.riskAssessment&&(o($.riskAssessment),s==null||s($.riskAssessment))}catch($){v($)}finally{m(!1)}},[r,s]),B=({riskLevel:$,riskScore:_})=>{const F=ti[$.toLowerCase()];if(!F)return null;const G=F.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${F.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":F.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${F.label}`,children:[e.jsx(G,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),F.label,_&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[_,"/10"]})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:F.description})]})};return!n&&!l&&!g?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:I,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),e.jsxs("button",{type:"button",onClick:U,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[e.jsx(ce,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:f.message})})]})]}):l||g?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:l?"Generating AI risk assessment...":"Loading assessment..."})]}),l&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):n?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:e.jsxs("button",{type:"button",onClick:I,disabled:l,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[e.jsx(ce,{className:`w-3 h-3 mr-1 ${l?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),e.jsx(B,{riskLevel:n.overallRiskLevel,riskScore:n.riskScore})]}),n.generatedAt&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(hr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:nt(n.generatedAt)})]})]}),n.summary&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(dn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:n.summary})})]}),n.keyFactors&&n.keyFactors.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(br,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:n.keyFactors.map(($,_)=>e.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),$]},_))})})]}),n.recommendations&&n.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(fn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:e.jsx("ul",{className:"space-y-2",children:n.recommendations.map(($,_)=>e.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),$]},_))})})]}),n.immediateActions&&n.immediateActions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Pn,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("ul",{className:"space-y-2",children:n.immediateActions.map(($,_)=>e.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[e.jsx(hs,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),$]},_))})})]}),n.followUpRecommendations&&n.followUpRecommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Xt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsx("ul",{className:"space-y-2",children:n.followUpRecommendations.map(($,_)=>e.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[e.jsx(Ze,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),$]},_))})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",nt(n.generatedAt),n.modelVersion&&e.jsxs("span",{className:"ml-4",children:["Model: ",n.modelVersion]})]})})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:f.message})})]}):null},is={queued:{color:"yellow",icon:Ze,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Ze,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:ce,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:ce,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:Ee,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:Ee,label:"Completed",description:"Analysis completed successfully"},completed:{color:"green",icon:Ee,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:Yt,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:Yt,label:"Error",description:"An error occurred during processing"}},ri=()=>{var w,p,u,b,x,j,E,T,V,ee,pe,he;const{sessionId:r}=Yr(),t=Zt(),{announceToScreenReader:s}=lt(),[a,n]=h.useState(null),[o,l]=h.useState(!0),[d,g]=h.useState(null),[m,f]=h.useState(!1),[v,I]=h.useState(!1),[U,B]=h.useState(!1),$=h.useRef(null),_=h.useCallback(async()=>{if(r)try{l(!0),g(null);const P=await oe.getSessionData(r);n(P),s(`Session ${r} loaded successfully`)}catch(P){const k=P;g(k),s(`Error loading session: ${k.message}`)}finally{l(!1)}},[r,s]),F=h.useCallback(async()=>{I(!0),await _(),I(!1),s("Session data refreshed")},[_,s]);h.useEffect(()=>{_()},[_]);const G=h.useCallback(()=>{f(P=>{const k=!P;return s(`Raw JSON view ${k?"enabled":"disabled"}`),k})},[s]),J=h.useCallback(()=>{$.current&&(U?($.current.pause(),B(!1),s("Audio paused")):($.current.play().catch(()=>{s("Failed to play audio")}),B(!0),s("Audio playing")))},[U,s]),C=h.useCallback(()=>{if(!a)return;const P=JSON.stringify(a,null,2),k=new Blob([P],{type:"application/json"}),M=URL.createObjectURL(k),fe=document.createElement("a");fe.href=M,fe.download=`session-${a.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),URL.revokeObjectURL(M),s("Session data download started")},[a,s]),S=h.useCallback(async()=>{if(!(!(a!=null&&a.audioUrl)||!(a!=null&&a.audioFileName))&&a!=null&&a.audioUrl)try{const P=a.audioUrl;window.open(P,"_blank"),window.open(a.audioUrl,"_blank"),s(`Downloading audio file: ${a.audioFileName||"audio file"}`)}catch(P){console.error("Failed to download audio file:",P),s("Failed to download audio file")}},[a,s]),R=h.useCallback(()=>{!a||!window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.")||(s("Redirecting to upload page for re-run..."),t("/upload",{state:{originalSessionId:a.sessionId,audioFileName:a.audioFileName,audioUrl:a.audioUrl,userMetadata:a.userMetadata}}))},[a,t,s]),L=({status:P})=>{const k=P.toLowerCase();let M=is[P];M||(k.includes("error")||k.includes("fail")?M=is.error:M=is.initiated);const fe=M.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${M.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":M.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":M.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${M.label}`,children:[e.jsx(fe,{className:`w-4 h-4 mr-2 ${M.color==="blue"&&P==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),M.label]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:M.description})]})};return o?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):d?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:d.message}),e.jsxs("div",{className:"mt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:_,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),e.jsx(ve,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):a?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>t("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[e.jsx(Va,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",a.sessionId]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:G,className:"btn btn--secondary","aria-label":`${m?"Hide":"Show"} raw JSON data`,children:[m?e.jsx(an,{className:"w-4 h-4 mr-2"}):e.jsx(bt,{className:"w-4 h-4 mr-2"}),m?"Hide JSON":"Show JSON"]}),e.jsxs("button",{type:"button",onClick:F,disabled:v,className:"btn btn--secondary","aria-label":"Refresh session data",children:[e.jsx(ce,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:R,className:"btn btn--secondary","aria-label":"Re-run analysis for this session",children:[e.jsx(ce,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:C,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[e.jsx(Kt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),m&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(vt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:e.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(a,null,2)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(vt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsx(L,{status:a.status})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(hr,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:ft(a.createdAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nt(a.createdAt)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Ze,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:ft(a.updatedAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:nt(a.updatedAt)})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ss,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.userId})]}),a.metadata_user_id&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ss,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Metadata User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.metadata_user_id})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ln,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),e.jsxs("div",{className:"space-y-4",children:[a.audioFileName&&a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("button",{onClick:S,className:"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors",title:"Click to download audio file",children:a.audioFileName})]}),a.audioFileName&&!a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.audioFileName," (download not available)"]})]}),a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:J,className:"btn btn--secondary","aria-label":`${U?"Pause":"Play"} audio`,children:U?e.jsx(ds,{className:"w-4 h-4"}):e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:U?"Playing audio...":"Audio playback available"})]}),e.jsx("audio",{ref:$,src:a.audioUrl,onPlay:()=>B(!0),onPause:()=>B(!1),onEnded:()=>B(!1),onError:()=>{B(!1),s("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),a.userMetadata&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ss,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.userMetadata.age&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.age," years"]})]}),a.userMetadata.gender&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.gender.replace(/[_-]/g," ")})]}),a.userMetadata.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.weight," lbs"]})]}),a.userMetadata.race&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.race})]}),a.userMetadata.ethnicity&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.ethnicity})]}),a.userMetadata.zipcode&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:a.userMetadata.zipcode})]}),a.userMetadata.language!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.language?"Yes":"No"})]}),a.userMetadata.sessionNotes&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:a.userMetadata.sessionNotes})]})]})]}),(a.analysisResults||a.prediction)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(yt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),e.jsxs("div",{className:"space-y-6",children:[(a.analysisResults||a.prediction)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((w=a.analysisResults)==null?void 0:w.depressionScore)||((p=a.prediction)==null?void 0:p.predicted_score_depression))&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),e.jsx(Xt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((b=(u=a.analysisResults)==null?void 0:u.depressionScore)==null?void 0:b.toFixed(2))||((x=a.prediction)!=null&&x.predicted_score_depression?a.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,P=>P.toUpperCase()):"N/A")})]}),(((j=a.analysisResults)==null?void 0:j.anxietyScore)||((E=a.prediction)==null?void 0:E.predicted_score_anxiety))&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),e.jsx(xr,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((V=(T=a.analysisResults)==null?void 0:T.anxietyScore)==null?void 0:V.toFixed(2))||((ee=a.prediction)!=null&&ee.predicted_score_anxiety?a.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,P=>P.toUpperCase()):"N/A")})]})]})]}),((pe=a.analysisResults)==null?void 0:pe.insights)&&a.analysisResults.insights.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:a.analysisResults.insights.map((P,k)=>e.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),P]},k))})})]}),((he=a.analysisResults)==null?void 0:he.completedAt)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:nt(a.analysisResults.completedAt)})]})})]})]})]}),e.jsx(si,{sessionId:a.sessionId,existingAssessment:a.riskAssessment||null,onAssessmentUpdated:P=>{n(k=>k?{...k,riskAssessment:P}:null)}})]}):e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(Te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),e.jsx(ve,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},ai=()=>{const{user:r}=We(),[t,s]=h.useState([]),[a,n]=h.useState(!0),[o,l]=h.useState(null),[d,g]=h.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[m,f]=h.useState(!1),{announceToScreenReader:v}=lt(),I=Zt(),U=h.useCallback(()=>(r==null?void 0:r.id)||ze(),[r==null?void 0:r.id]),B=h.useCallback(p=>{I(`/sessions/${p}`),v(`Navigating to session ${p} details`)},[I,v]),$=h.useCallback(async()=>{try{n(!0),l(null);const p=U(),b=(await oe.getUserSessions(p)).sessions.filter(x=>x.analysisResults||x.prediction);s(b),v(`${b.length} prediction sessions loaded`)}catch(p){const u=p;l(u),v(`Error loading predictions: ${u.message}`)}finally{n(!1)}},[v]);h.useEffect(()=>{$()},[$]);const _=h.useMemo(()=>{if(d.dateRange==="all")return t;const p=new Date,u=new Date;switch(d.dateRange){case"week":u.setDate(p.getDate()-7);break;case"month":u.setMonth(p.getMonth()-1);break;case"quarter":u.setMonth(p.getMonth()-3);break;case"year":u.setFullYear(p.getFullYear()-1);break}return t.filter(b=>new Date(b.createdAt)>=u)},[t,d.dateRange]),F=h.useMemo(()=>_.map(p=>{var j,E;const u=T=>{if(!T)return null;switch(T.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},b=u((j=p.prediction)==null?void 0:j.predicted_score_depression),x=u((E=p.prediction)==null?void 0:E.predicted_score_anxiety);return{date:p.createdAt,depression:b,anxiety:x,overall:null,sessionId:p.sessionId}}).sort((p,u)=>new Date(p.date).getTime()-new Date(u.date).getTime()),[_]),G=h.useMemo(()=>{const p={depression:[],anxiety:[]},u=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],b=_.map(j=>{var E;return(E=j.prediction)==null?void 0:E.predicted_score_depression}).filter(j=>j!==void 0);u.forEach(j=>{const E=b.filter(V=>V===j.category).length,T=b.length>0?E/b.length*100:0;E>0&&p.depression.push({category:j.label,count:E,percentage:T,color:j.color})});const x=_.map(j=>{var E;return(E=j.prediction)==null?void 0:E.predicted_score_anxiety}).filter(j=>j!==void 0);return u.forEach(j=>{const E=x.filter(V=>V===j.category).length,T=x.length>0?E/x.length*100:0;E>0&&p.anxiety.push({category:j.label,count:E,percentage:T,color:j.color})}),p},[_]),J=h.useMemo(()=>{const p={},u=j=>{if(!j)return 0;switch(j.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},b=_.map(j=>{var E;return(E=j.prediction)==null?void 0:E.predicted_score_depression}).filter(j=>j!==void 0);if(b.length<2)p.depression={direction:"stable",change:0,period:"insufficient data"};else{const j=b.map(u),E=j.slice(0,Math.floor(j.length/2)),T=j.slice(Math.floor(j.length/2)),V=E.reduce((he,P)=>he+P,0)/E.length,pe=T.reduce((he,P)=>he+P,0)/T.length-V;p.depression={direction:Math.abs(pe)<.5?"stable":pe<0?"improving":"worsening",change:Math.abs(pe),period:`${_.length} sessions`}}const x=_.map(j=>{var E;return(E=j.prediction)==null?void 0:E.predicted_score_anxiety}).filter(j=>j!==void 0);if(x.length<2)p.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const j=x.map(u),E=j.slice(0,Math.floor(j.length/2)),T=j.slice(Math.floor(j.length/2)),V=E.reduce((he,P)=>he+P,0)/E.length,pe=T.reduce((he,P)=>he+P,0)/T.length-V;p.anxiety={direction:Math.abs(pe)<.5?"stable":pe<0?"improving":"worsening",change:Math.abs(pe),period:`${_.length} sessions`}}return p.overall={direction:"stable",change:0,period:"coming soon"},p},[_]),C=h.useMemo(()=>{const p={totalSessions:_.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(_.length===0)return p;const u=_.map(x=>{var j;return(j=x.prediction)==null?void 0:j.predictedScoreDepression}).filter(x=>x!==void 0),b=_.map(x=>{var j;return(j=x.prediction)==null?void 0:j.predictedScoreAnxiety}).filter(x=>x!==void 0);if(u.length>0){const x={};u.forEach(E=>{x[E]=(x[E]||0)+1});const j=Object.entries(x).sort(([,E],[,T])=>T-E)[0][0];p.avgDepression=x[j]}if(b.length>0){const x={};b.forEach(E=>{x[E]=(x[E]||0)+1});const j=Object.entries(x).sort(([,E],[,T])=>T-E)[0][0];p.avgAnxiety=x[j]}return p.latestSession=_.sort((x,j)=>new Date(j.createdAt).getTime()-new Date(x.createdAt).getTime())[0],p.improvementSessions=0,p},[_]),S=h.useCallback((p,u)=>{g(b=>({...b,[p]:u})),v(`Filter ${p} changed to ${u}`)},[v]),R=h.useCallback(()=>{const p=JSON.stringify(_,null,2),u=new Blob([p],{type:"application/json"}),b=URL.createObjectURL(u),x=document.createElement("a");x.href=b,x.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(b),v("Predictions data download started")},[_,v]),L=({trend:p,label:u})=>{const b=p.direction==="improving"?yr:p.direction==="worsening"?Xt:yt,x=p.direction==="improving"?"text-green-600 dark:text-green-400":p.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:`w-4 h-4 ${x}`,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:u}),e.jsxs("span",{className:`text-sm font-medium ${x} capitalize`,children:[p.direction,p.period==="insufficient data"?" (need more sessions)":p.period==="coming soon"?" (analysis coming soon)":` (${p.period})`]})]})},w=({data:p,type:u,onBarClick:b})=>{const x=p.map(M=>M[u]).filter(M=>M!==null);if(x.length===0)return e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const j=Math.max(...x),E=Math.min(...x),T=j-E||1,V=M=>{switch(M){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},ee=(M,fe)=>{if(fe==="depression")switch(M){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(fe==="anxiety")switch(M){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(M){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},pe=M=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(ie=>({...ie,color:ee(ie.score,M)})),he=new Set(x),k=pe(u).filter(M=>he.has(M.score));return e.jsxs("div",{children:[e.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:p.map((M,fe)=>{const ie=M[u];if(ie===null)return null;const St=(ie-E)/T*100,Qe=ee(ie,u),de=V(ie),ct=new Date(M.date).toLocaleDateString();return e.jsx("div",{className:`flex-1 ${Qe} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(St,8)}%`},onClick:()=>b(M.sessionId),role:"button",tabIndex:0,onKeyDown:qe=>{(qe.key==="Enter"||qe.key===" ")&&(qe.preventDefault(),b(M.sessionId))},"aria-label":`View session details for ${de} score on ${ct}`,children:e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsx("div",{className:"font-medium",children:de}),e.jsx("div",{className:"text-gray-300",children:ct}),e.jsxs("div",{className:"text-gray-300",children:["Session: ",M.sessionId.slice(-8)]}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},fe)})}),k.length>0&&e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),k.map(M=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 ${M.color} rounded`}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:M.label})]},M.score))]})})]})};return a?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):o?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:o.message}),e.jsx("button",{type:"button",onClick:$,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>f(!m),className:"btn btn--secondary","aria-expanded":m?"true":"false","aria-label":`${m?"Hide":"Show"} filter options`,children:[e.jsx(mr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",m?e.jsx(gr,{className:"w-4 h-4 ml-2"}):e.jsx(ur,{className:"w-4 h-4 ml-2"})]}),e.jsxs("button",{type:"button",onClick:$,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[e.jsx(ce,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:R,className:"btn btn--primary",disabled:_.length===0,"aria-label":"Download predictions data",children:[e.jsx(Kt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),m&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-range",value:d.dateRange,onChange:p=>S("dateRange",p.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"quarter",children:"Past Quarter"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),e.jsxs("select",{id:"score-type",value:d.scoreType,onChange:p=>S("scoreType",p.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Scores"}),e.jsx("option",{value:"depression",children:"Depression"}),e.jsx("option",{value:"anxiety",children:"Anxiety"}),e.jsx("option",{value:"overall",children:"Overall"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.showTrends,onChange:p=>S("showTrends",p.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),_.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(Ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:t.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),e.jsx(ve,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(yt,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:C.totalSessions})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ve,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const p=_.map(x=>{var j;return(j=x.prediction)==null?void 0:j.predicted_score_depression}).filter(x=>x!==void 0);if(p.length===0)return"â€”";const u={};return p.forEach(x=>{u[x]=(u[x]||0)+1}),Object.entries(u).sort(([,x],[,j])=>j-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(xr,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const p=_.map(x=>{var j;return(j=x.prediction)==null?void 0:j.predicted_score_anxiety}).filter(x=>x!==void 0);if(p.length===0)return"â€”";const u={};return p.forEach(x=>{u[x]=(u[x]||0)+1}),Object.entries(u).sort(([,x],[,j])=>j-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(d.scoreType==="all"||d.scoreType==="depression")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ws,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),e.jsx(w,{data:F,type:"depression",onBarClick:B}),d.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(L,{trend:J.depression,label:"Trend:"})})]}),(d.scoreType==="all"||d.scoreType==="anxiety")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ka,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),e.jsx(w,{data:F,type:"anxiety",onBarClick:B}),d.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(L,{trend:J.anxiety,label:"Trend:"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ws,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(G).map(([p,u])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[p," Scores"]}),e.jsx("div",{className:"space-y-2",children:u.map(b=>e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:b.category}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[b.count," (",b.percentage.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${b.color} progress-dynamic progress-animated`,style:{"--progress-width":`${b.percentage}%`}})})]})},b.category))})]},p))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ze,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),e.jsx(ve,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions â†’"})]}),e.jsx("div",{className:"space-y-4",children:_.slice(0,5).map(p=>{var u,b;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p.status==="succeeded"?"bg-green-500":p.status==="processing"?"bg-blue-500":p.status==="failed"?"bg-red-500":"bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.audioFileName||`Session ${p.sessionId.slice(-8)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:ft(p.createdAt)})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[((u=p.prediction)==null?void 0:u.predicted_score_depression)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),((b=p.prediction)==null?void 0:b.predicted_score_anxiety)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),e.jsx(ve,{to:`/sessions/${p.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${p.sessionId}`,children:e.jsx(bt,{className:"w-4 h-4","aria-hidden":"true"})})]})]},p.sessionId)})})]})]})]})},us=(r,t)=>t>0?Math.round(r/t*100):0,ni=r=>{const t=r.length,s=new Set(r.map(C=>C.userId)).size,a=r.filter(C=>C.status==="succeeded"||C.status==="completed"),n=r.filter(C=>C.status==="failed"),o=r.filter(C=>C.status==="processing"),l=us(a.length,t),d=s>0?Math.round(t/s*10)/10:0,g=new Date(Date.now()-24*60*60*1e3),m=r.filter(C=>new Date(C.createdAt)>g).length,f={low:0,medium:0,high:0,unknown:0};r.forEach(C=>{var R;const S=((R=C.analysisResults)==null?void 0:R.riskLevel)||"unknown";S in f&&f[S]++});const v={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},I={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};a.forEach(C=>{var L,w,p,u;let S=null,R=null;if(C.prediction){const b=C.prediction;S=b.predictedScoreDepression||b.predicted_score_depression,R=b.predictedScoreAnxiety||b.predicted_score_anxiety}if(!S&&((L=C.analysisResults)==null?void 0:L.depressionScore)!==null&&((w=C.analysisResults)==null?void 0:w.depressionScore)!==void 0){const b=C.analysisResults.depressionScore;b>=0&&b<=4?S="no_to_mild":b>=5&&b<=9||b>=10&&b<=14?S="mild_to_moderate":b>=15&&b<=19?S="moderate_to_severe":b>=20&&(S="severe")}if(!R&&((p=C.analysisResults)==null?void 0:p.anxietyScore)!==null&&((u=C.analysisResults)==null?void 0:u.anxietyScore)!==void 0){const b=C.analysisResults.anxietyScore;b>=0&&b<=4?R="no_or_minimal":b>=5&&b<=9?R="mild":b>=10&&b<=14?R="moderate":b>=15&&b<=19?R="moderately_severe":b>=20&&(R="severe")}S&&S in v&&v[S]++,R&&R in I&&I[R]++});const U=[];for(let C=6;C>=0;C--){const S=new Date;S.setDate(S.getDate()-C);const R=S.toISOString().split("T")[0],L=r.filter(w=>w.createdAt.split("T")[0]===R).length;U.push({date:R,count:L})}const B=new Map;r.forEach(C=>{const S=C.metadata_user_id||C.userId;B.has(S)||B.set(S,{totalSessions:0,successfulSessions:0,sessions:[]});const R=B.get(S);R.totalSessions++,R.sessions.push(C),(C.status==="succeeded"||C.status==="completed")&&R.successfulSessions++});const $=Array.from(B.entries()).map(([C,S])=>{var E;const R=us(S.successfulSessions,S.totalSessions),L=S.sessions.filter(T=>T.status==="succeeded"||T.status==="completed"),w=L.map(T=>{var V;return(V=T.analysisResults)==null?void 0:V.confidence}).filter(T=>T!=null&&typeof T=="number"),p=w.length>0?w.reduce((T,V)=>T+V,0)/w.length:0,u={low:0,medium:0,high:0,unknown:0};S.sessions.forEach(T=>{var ee;const V=((ee=T.analysisResults)==null?void 0:ee.riskLevel)||"unknown";V in u&&u[V]++});const b={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},x={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};L.forEach(T=>{var pe,he,P,k;let V=null,ee=null;if(T.prediction){const M=T.prediction;V=M.predictedScoreDepression||M.predicted_score_depression,ee=M.predictedScoreAnxiety||M.predicted_score_anxiety}if(!V&&((pe=T.analysisResults)==null?void 0:pe.depressionScore)!==null&&((he=T.analysisResults)==null?void 0:he.depressionScore)!==void 0){const M=T.analysisResults.depressionScore;M>=0&&M<=4?V="no_to_mild":M>=5&&M<=9||M>=10&&M<=14?V="mild_to_moderate":M>=15&&M<=19?V="moderate_to_severe":M>=20&&(V="severe")}if(!ee&&((P=T.analysisResults)==null?void 0:P.anxietyScore)!==null&&((k=T.analysisResults)==null?void 0:k.anxietyScore)!==void 0){const M=T.analysisResults.anxietyScore;M>=0&&M<=4?ee="no_or_minimal":M>=5&&M<=9?ee="mild":M>=10&&M<=14?ee="moderate":M>=15&&M<=19?ee="moderately_severe":M>=20&&(ee="severe")}V&&V in b&&b[V]++,ee&&ee in x&&x[ee]++});const j=S.sessions.reduce((T,V)=>new Date(V.updatedAt)>new Date(T)?V.updatedAt:T,((E=S.sessions[0])==null?void 0:E.updatedAt)||new Date().toISOString());return{userId:C,totalSessions:S.totalSessions,successfulSessions:S.successfulSessions,successRate:R,avgConfidence:Math.round(p*100)/100,riskDistribution:u,lastActivity:j,depressionScores:b,anxietyScores:x}}).sort((C,S)=>S.totalSessions-C.totalSessions),_={ageDistribution:{},genderDistribution:{},raceDistribution:{},ethnicityDistribution:{},languageDistribution:{},weightDistribution:{},zipCodeDistribution:{}},F=C=>{var S,R;if(C.prediction){const L=C.prediction,w=L.predictedScoreDepression||L.predicted_score_depression;return w==="moderate_to_severe"||w==="severe"}return((S=C.analysisResults)==null?void 0:S.depressionScore)!==null&&((R=C.analysisResults)==null?void 0:R.depressionScore)!==void 0?C.analysisResults.depressionScore>=10:!1},G=C=>{var S,R;if(C.prediction){const L=C.prediction,w=L.predictedScoreAnxiety||L.predicted_score_anxiety;return w==="moderate"||w==="moderately_severe"||w==="severe"}return((S=C.analysisResults)==null?void 0:S.anxietyScore)!==null&&((R=C.analysisResults)==null?void 0:R.anxietyScore)!==void 0?C.analysisResults.anxietyScore>=10:!1};return r.filter(C=>C.userMetadata).forEach(C=>{const S=C.userMetadata,R=F(C),L=G(C);if(S.age){let w;S.age<25?w="18-24":S.age<35?w="25-34":S.age<45?w="35-44":S.age<55?w="45-54":S.age<65?w="55-64":w="65+",_.ageDistribution[w]||(_.ageDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.ageDistribution[w].totalSessions++,R&&_.ageDistribution[w].depressionCases++,L&&_.ageDistribution[w].anxietyCases++}if(S.gender){const w=S.gender;_.genderDistribution[w]||(_.genderDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.genderDistribution[w].totalSessions++,R&&_.genderDistribution[w].depressionCases++,L&&_.genderDistribution[w].anxietyCases++}if(S.race){const w=S.race;_.raceDistribution[w]||(_.raceDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.raceDistribution[w].totalSessions++,R&&_.raceDistribution[w].depressionCases++,L&&_.raceDistribution[w].anxietyCases++}if(S.ethnicity){const w=S.ethnicity;_.ethnicityDistribution[w]||(_.ethnicityDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.ethnicityDistribution[w].totalSessions++,R&&_.ethnicityDistribution[w].depressionCases++,L&&_.ethnicityDistribution[w].anxietyCases++}if(S.language!==void 0){const w=S.language?"English":"Other";_.languageDistribution[w]||(_.languageDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.languageDistribution[w].totalSessions++,R&&_.languageDistribution[w].depressionCases++,L&&_.languageDistribution[w].anxietyCases++}if(S.weight){let w;S.weight<120?w="Under 120 lbs":S.weight<150?w="120-149 lbs":S.weight<180?w="150-179 lbs":S.weight<220?w="180-219 lbs":w="220+ lbs",_.weightDistribution[w]||(_.weightDistribution[w]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.weightDistribution[w].totalSessions++,R&&_.weightDistribution[w].depressionCases++,L&&_.weightDistribution[w].anxietyCases++}if(S.zipcode){const w=S.zipcode.substring(0,2);let p;["0","1","2"].some(u=>w.startsWith(u))?p="Northeast":["3","4"].some(u=>w.startsWith(u))?p="Southeast":["5","6"].some(u=>w.startsWith(u))?p="South Central":["7","8"].some(u=>w.startsWith(u))?p="Mountain/West":["9"].some(u=>w.startsWith(u))?p="Pacific":p="Other/International",_.zipCodeDistribution[p]||(_.zipCodeDistribution[p]={depressionCases:0,anxietyCases:0,totalSessions:0}),_.zipCodeDistribution[p].totalSessions++,R&&_.zipCodeDistribution[p].depressionCases++,L&&_.zipCodeDistribution[p].anxietyCases++}}),{overview:{totalSessions:t,uniqueUsers:s,successRate:l,avgSessionsPerUser:d,recentActivity:m},sessionStatus:{succeeded:a.length,failed:n.length,processing:o.length,total:t},riskLevels:{...f,total:t},predictions:{depression:{...v,total:a.length},anxiety:{...I,total:a.length}},timeData:U,riskDistribution:f,userStats:$,correlations:_}},Ys=({title:r,value:t,subtitle:s,icon:a,trend:n,color:o="text-blue-600"})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:r}),e.jsx("p",{className:`text-2xl font-bold ${o} dark:text-white mt-1`,children:t}),s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s})]}),e.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${o}`,children:a})]}),n&&e.jsxs("div",{className:"flex items-center mt-4",children:[n==="up"&&e.jsx(Xt,{className:"h-4 w-4 text-green-500 mr-1"}),n==="down"&&e.jsx(yr,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("span",{className:`text-sm ${n==="up"?"text-green-600":n==="down"?"text-red-600":"text-gray-500"}`,children:n==="up"?"Trending up":n==="down"?"Trending down":"Stable"})]})]}),os=({title:r,data:t,total:s})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),e.jsx("div",{className:"space-y-3",children:t.map((a,n)=>{const o=us(a.value,s);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.label}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[a.value," (",o,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${a.color}`,style:{width:`${o}%`},role:"progressbar","aria-label":`${a.label}: ${a.value} (${o}%)`})})]},n)})})]}),ii=({title:r,data:t})=>{const s=Math.max(...t.map(o=>o.count),1),a=0,n=s-a||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-48",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),t.map((o,l)=>{const d=80/t.length,g=l/(t.length-1)*(100-d)+d/2,m=(o.count-a)/n*95,f=100-m;return e.jsx("rect",{x:g-d/2,y:f,width:d*.6,height:m,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},l)})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:t.map((o,l)=>{const d=new Date(o.date),g=d.toLocaleDateString("en-US",{weekday:"short"}),m=d.toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:g}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:m}),e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:o.count})]},l)})})]})},Ye=({title:r,data:t,subtitle:s})=>{const a=Object.keys(t);return a.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),s&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:s}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No metadata available for this correlation"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),s&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:s}),e.jsx("div",{className:"space-y-4",children:a.map((n,o)=>{const l=t[n],d=l.totalSessions>0?l.depressionCases/l.totalSessions*100:0,g=l.totalSessions>0?l.anxietyCases/l.totalSessions*100:0;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:n}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l.totalSessions," sessions"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Depression Cases"}),e.jsxs("span",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:[l.depressionCases," (",d.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-red-500 rounded-full transition-all duration-500",style:{width:`${d}%`},role:"progressbar","aria-label":`Depression rate: ${d.toFixed(1)}%`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anxiety Cases"}),e.jsxs("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:[l.anxietyCases," (",g.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-orange-500 rounded-full transition-all duration-500",style:{width:`${g}%`},role:"progressbar","aria-label":`Anxiety rate: ${g.toFixed(1)}%`})})]})]},o)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:a.reduce((n,o)=>n+t[o].depressionCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Depression Cases"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:a.reduce((n,o)=>n+t[o].anxietyCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Anxiety Cases"})]})]})})]})},oi=({title:r,depressionData:t,anxietyData:s})=>{const a=[{depression:t.no_to_mild,anxiety:s.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:t.mild_to_moderate,anxiety:s.mild,severity:"Mild",label:"Mild"},{depression:t.moderate_to_severe,anxiety:s.moderate,severity:"Moderate",label:"Moderate"},{depression:t.severe,anxiety:s.moderately_severe+s.severe,severity:"High",label:"Severe"}],n=Math.max(...a.map(l=>Math.max(l.depression,l.anxiety)),10),o=l=>{switch(l){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-[28rem]",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 600 350",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"correlationGrid",width:"50",height:"35",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 35",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),e.jsx("rect",{width:"600",height:"350",fill:"url(#correlationGrid)"}),e.jsx("line",{x1:"70",y1:"310",x2:"550",y2:"310",stroke:"rgb(107 114 128)",strokeWidth:"2"}),e.jsx("line",{x1:"70",y1:"310",x2:"70",y2:"40",stroke:"rgb(107 114 128)",strokeWidth:"2"}),a.map((l,d)=>{const g=70+l.depression/n*480,m=310-l.anxiety/n*270,f=Math.max(Math.sqrt(l.depression+l.anxiety)*3,10);return e.jsxs("g",{children:[e.jsx("circle",{cx:g,cy:m,r:f,className:`${o(l.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),e.jsx("text",{x:g,y:m+5,textAnchor:"middle",className:"text-sm fill-white font-bold",children:l.depression+l.anxiety})]},d)}),e.jsx("text",{x:"310",y:"335",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases â†’"}),e.jsx("text",{x:"40",y:"175",textAnchor:"middle",transform:"rotate(-90 40 175)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"â† Anxiety Cases"})]})}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:a.map((l,d)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o(l.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:l.label})]},d))})]})},li=({title:r,sessionStatus:t})=>{const s=[{label:"Total Sessions",value:t.total,color:"bg-blue-500"},{label:"In Processing",value:t.processing,color:"bg-yellow-500"},{label:"Completed",value:t.succeeded,color:"bg-green-500"},{label:"Failed",value:t.failed,color:"bg-red-500"}],a=t.total||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"space-y-4",children:s.map((n,o)=>{const l=n.value/a*100,d=o>0?(n.value/s[0].value*100).toFixed(1):"100.0";return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:n.value}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",d,"%)"]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:`h-full ${n.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${l}%`},children:l>20&&e.jsx("span",{className:"text-xs font-medium text-white",children:n.value})}),o<s.length-1&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},o)})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(t.succeeded/t.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(t.failed/t.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},ci=({userStats:r})=>{const[t,s]=h.useState(!1),[a,n]=h.useState(!1),o=f=>new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),l=(f,v)=>{if(v===0)return"text-gray-400";switch(f){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},d=r.length,g=d>0?Math.round(r.reduce((f,v)=>f+v.totalSessions,0)/d*10)/10:0,m=r.length>0?r.reduce((f,v)=>v.avgConfidence>f.avgConfidence?v:f,r[0]):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 overflow-visible",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(vr,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),e.jsxs("div",{className:"flex space-x-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:d}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:g}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),m&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-600",children:[(m.avgConfidence*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Highest Avg Confidence"})]})]})]}),r.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto overflow-y-visible relative",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white w-48",children:"User ID"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Risk Distribution"}),e.jsx("button",{type:"button",onClick:()=>n(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Risk Distribution information",children:e.jsx(vt,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]})})}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white relative",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Avg Confidence"}),e.jsx("button",{type:"button",onClick:()=>s(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Average Confidence information",children:e.jsx(vt,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]}),e.jsx("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1",children:"(Analysis accuracy 0-100%)"})]})}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),e.jsx("tbody",{children:r.map((f,v)=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${v%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.jsx("div",{className:"truncate max-w-[200px]",title:f.userId,children:f.userId})})}),e.jsxs("td",{className:"py-3 px-2 text-center",children:[e.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:f.totalSessions}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[f.successfulSessions," successful"]})]}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[e.jsxs("span",{className:`px-1 py-0.5 rounded ${l("low",f.riskDistribution.low)}`,children:["L:",f.riskDistribution.low]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${l("medium",f.riskDistribution.medium)}`,children:["M:",f.riskDistribution.medium]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${l("high",f.riskDistribution.high)}`,children:["H:",f.riskDistribution.high]})]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(f.avgConfidence*100).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:o(f.lastActivity)})})]},f.userId))})]})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>s(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Average Confidence Information"}),e.jsx("button",{type:"button",onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Average Confidence Calculation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Calculated from AI model confidence scores"}),e.jsx("div",{children:"â€¢ Averaged across all successful sessions per user"}),e.jsx("div",{children:"â€¢ Related to risk distribution/evaluation accuracy"}),e.jsx("div",{children:"â€¢ Higher values indicate more reliable assessments"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy range: 0-100%"})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>n(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Risk Distribution Information"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Risk Distribution Explanation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Shows the distribution of risk levels across all user sessions"}),e.jsx("div",{children:"â€¢ Visualized as colored dots representing risk categories"}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full mr-1"}),"Low Risk: Minimal behavioral health concerns"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-500 rounded-full mr-1"}),"Medium Risk: Moderate concerns requiring attention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),"High Risk: Significant concerns requiring intervention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full mr-1"}),"Unknown: Risk level could not be determined"]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy: 0-100% (higher confidence = more reliable risk assessment)"})]})]})})]})},di=()=>{const[r,t]=h.useState(null),[s,a]=h.useState(!1),[n,o]=h.useState(null),[l,d]=h.useState(new Date),{announceToScreenReader:g}=lt(),m=parseInt("69")*1e3,f=h.useCallback(async()=>{try{a(!0),o(null);let I=[];try{const B=Date.now();console.log("ðŸ”„ ControlPanel: Fetching data with cache-buster:",B);const $=await oe.getAllSessions();I=$.sessions,console.log("ðŸ“Š ControlPanel: Fetched sessions data:",{timestamp:B,totalCount:I.length,responseCount:$.count,firstFewSessions:I.slice(0,3).map(_=>({sessionId:_.sessionId,userId:_.userId,status:_.status,createdAt:_.createdAt}))})}catch(B){console.warn("getAllSessions endpoint not available:",B),I=[]}const U=ni(I);console.log("ðŸ“ˆ ControlPanel: Aggregated analytics:",{totalSessions:U.overview.totalSessions,uniqueUsers:U.overview.uniqueUsers,successRate:U.overview.successRate,sessionStatusBreakdown:U.sessionStatus}),t(U),d(new Date),g("Control panel data loaded successfully")}catch(I){const U=I;o(U),g(`Error loading control panel data: ${U.message}`)}finally{a(!1)}},[g]);h.useEffect(()=>{f()},[f]),h.useEffect(()=>{console.log("ðŸ”„ ControlPanel: Setting up auto-refresh with interval:",m/1e3,"seconds");const I=setInterval(()=>{console.log("ðŸ”„ ControlPanel: Auto-refresh triggered, loading state:",s),f()},m);return()=>{console.log("ðŸ”„ ControlPanel: Cleaning up auto-refresh interval"),clearInterval(I)}},[f,m]);const v=h.useCallback(()=>{o(null),f()},[f]);return s?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{className:"h-6 w-6 animate-spin text-blue-500"}),e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):n?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:n.message}),e.jsxs("button",{onClick:v,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights from all users and sessions"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",l.toLocaleTimeString()]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",m/1e3,"s intervals"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:f,disabled:s,className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm","aria-label":"Refresh control panel data",children:[e.jsx(ce,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(Ys,{title:"Total Sessions",value:r.overview.totalSessions,subtitle:"All time",icon:e.jsx(yt,{className:"h-6 w-6"}),color:"text-blue-600"}),e.jsx(Ys,{title:"Unique Users",value:r.overview.uniqueUsers,subtitle:"Active users",icon:e.jsx(vr,{className:"h-6 w-6"}),color:"text-green-600"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsx(os,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:r.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:r.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:r.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:r.riskLevels.unknown,color:"bg-gray-500"}],total:r.riskLevels.total})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(os,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:r.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:r.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:r.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:r.predictions.depression.severe,color:"bg-red-500"}],total:r.predictions.depression.total}),e.jsx(os,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:r.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:r.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:r.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:r.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:r.predictions.anxiety.severe,color:"bg-red-700"}],total:r.predictions.anxiety.total})]}),e.jsx("div",{className:"mb-8",children:e.jsx(ci,{userStats:r.userStats})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Demographic Correlation Analysis"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Correlation between patient demographics and mental health outcomes (Depression & Anxiety cases)"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(oi,{title:"Depression vs Anxiety Correlation",depressionData:r.predictions.depression,anxietyData:r.predictions.anxiety})}),e.jsx(Ye,{title:"Age Groups vs Mental Health Cases",subtitle:"Distribution by age ranges showing depression and anxiety case rates",data:r.correlations.ageDistribution}),e.jsx(Ye,{title:"Gender vs Mental Health Cases",subtitle:"Distribution by gender identity showing case rates",data:r.correlations.genderDistribution}),e.jsx(Ye,{title:"Weight Groups vs Mental Health Cases",subtitle:"Distribution by weight ranges showing case rates",data:r.correlations.weightDistribution}),e.jsx(Ye,{title:"Race vs Mental Health Cases",subtitle:"Distribution by racial identity showing case rates",data:r.correlations.raceDistribution}),e.jsx(Ye,{title:"Ethnicity vs Mental Health Cases",subtitle:"Distribution by ethnic background showing case rates",data:r.correlations.ethnicityDistribution}),e.jsx(Ye,{title:"Primary Language vs Mental Health Cases",subtitle:"Distribution by language preference showing case rates",data:r.correlations.languageDistribution}),e.jsx(Ye,{title:"Geographic Region vs Mental Health Cases",subtitle:"Distribution by ZIP code regions showing case rates",data:r.correlations.zipCodeDistribution})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(li,{title:"Session Completion Funnel",sessionStatus:r.sessionStatus})}),e.jsx("div",{className:"mb-8",children:e.jsx(ii,{title:"Sessions Over Time (7 Days)",data:r.timeData})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})};class hi extends ea.EventEmitter{constructor(s){super();X(this,"recognition",null);X(this,"synthesis",null);X(this,"audioContext",null);X(this,"microphone",null);X(this,"analyzer",null);X(this,"vadProcessor",null);X(this,"stream",null);X(this,"isListening",!1);X(this,"isVADActive",!1);X(this,"silenceTimeout",null);X(this,"speechTimeout",null);X(this,"config",{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:3,audioTracks:!0,noiseReduction:!0,echoCancellation:!0});this.config={...this.config,...s},this.initializeServices()}async initializeServices(){try{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const s=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new s,this.setupSpeechRecognition()}"speechSynthesis"in window&&(this.synthesis=window.speechSynthesis),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.emit("initialized",{speechRecognition:!!this.recognition,speechSynthesis:!!this.synthesis,voiceActivityDetection:!!this.audioContext})}catch(s){console.error("Error initializing speech services:",s),this.emit("error",{type:"initialization",error:s})}}setupSpeechRecognition(){this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives,this.recognition.onstart=()=>{this.isListening=!0,this.emit("listening",{started:!0})},this.recognition.onresult=s=>{const a=[];for(let o=s.resultIndex;o<s.results.length;o++){const l=s.results[o],d=l[0].transcript,g=l[0].confidence,m=l.isFinal,f=[];for(let v=1;v<l.length&&v<this.config.maxAlternatives;v++)f.push(l[v].transcript);a.push({transcript:d,confidence:g,isFinal:m,alternatives:f})}this.emit("result",{results:a});const n=a.filter(o=>o.isFinal);n.length>0&&this.emit("finalResult",{results:n})},this.recognition.onerror=s=>{console.error("Speech recognition error:",s.error),this.emit("error",{type:"recognition",error:s.error}),(s.error==="no-speech"||s.error==="audio-capture")&&setTimeout(()=>this.restartRecognition(),1e3)},this.recognition.onend=()=>{this.isListening=!1,this.emit("listening",{started:!1}),this.config.continuous&&this.isVADActive&&setTimeout(()=>this.startListening(),100)})}async setupVoiceActivityDetection(){try{if(!this.audioContext)throw new Error("AudioContext not available");this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:this.config.echoCancellation,noiseSuppression:this.config.noiseReduction,autoGainControl:!0,sampleRate:16e3,channelCount:1}}),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyzer=this.audioContext.createAnalyser(),this.vadProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.analyzer.fftSize=256,this.analyzer.smoothingTimeConstant=.8,this.microphone.connect(this.analyzer),this.analyzer.connect(this.vadProcessor),this.vadProcessor.connect(this.audioContext.destination),this.vadProcessor.onaudioprocess=s=>{this.processVAD(s)},this.emit("vadReady")}catch(s){console.error("Error setting up VAD:",s),this.emit("error",{type:"vad",error:s})}}processVAD(s){if(!this.analyzer)return;const a=this.analyzer.frequencyBinCount,n=new Uint8Array(a);this.analyzer.getByteFrequencyData(n);let o=0;for(let m=0;m<a;m++)o+=n[m];const l=o/a,g=l>30;this.emit("voiceActivity",{isActive:g,volume:l,timestamp:Date.now()}),g?(this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout||(this.speechTimeout=setTimeout(()=>{this.emit("speechStart")},200))):(this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null),this.silenceTimeout||(this.silenceTimeout=setTimeout(()=>{this.emit("speechEnd")},1500)))}async startListening(){try{if(!this.recognition)throw new Error("Speech recognition not available");this.isVADActive||(await this.setupVoiceActivityDetection(),this.isVADActive=!0),this.isListening||this.recognition.start()}catch(s){console.error("Error starting speech recognition:",s),this.emit("error",{type:"start",error:s})}}stopListening(){try{this.recognition&&this.isListening&&this.recognition.stop(),this.isVADActive=!1,this.vadProcessor&&this.vadProcessor.disconnect(),this.analyzer&&this.analyzer.disconnect(),this.microphone&&this.microphone.disconnect(),this.stream&&(this.stream.getTracks().forEach(s=>s.stop()),this.stream=null),this.silenceTimeout&&(clearTimeout(this.silenceTimeout),this.silenceTimeout=null),this.speechTimeout&&(clearTimeout(this.speechTimeout),this.speechTimeout=null)}catch(s){console.error("Error stopping speech recognition:",s),this.emit("error",{type:"stop",error:s})}}restartRecognition(){this.isVADActive&&(this.stopListening(),setTimeout(()=>this.startListening(),500))}async speak(s,a){return new Promise((n,o)=>{if(!this.synthesis){o(new Error("Speech synthesis not available"));return}a!=null&&a.interrupt&&this.synthesis.cancel();const l=new SpeechSynthesisUtterance(s);l.rate=(a==null?void 0:a.rate)||.9,l.pitch=(a==null?void 0:a.pitch)||1,l.volume=(a==null?void 0:a.volume)||.8,a!=null&&a.voice&&(l.voice=a.voice),l.onend=()=>{this.emit("speechEnd",{text:s}),n()},l.onerror=d=>{this.emit("error",{type:"synthesis",error:d.error}),o(new Error(`Speech synthesis error: ${d.error}`))},l.onstart=()=>{this.emit("speechStart",{text:s})},this.synthesis.speak(l)})}getAvailableVoices(){return this.synthesis?this.synthesis.getVoices():[]}updateConfig(s){this.config={...this.config,...s},this.recognition&&(this.recognition.continuous=this.config.continuous,this.recognition.interimResults=this.config.interimResults,this.recognition.lang=this.config.language,this.recognition.maxAlternatives=this.config.maxAlternatives)}isAvailable(){return!!(this.recognition&&this.synthesis)}isCurrentlyListening(){return this.isListening}destroy(){this.stopListening(),this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.removeAllListeners()}}const ui=(r={})=>{const t=h.useRef(null),[s,a]=h.useState(!1),[n,o]=h.useState(!1),[l,d]=h.useState(!1),[g,m]=h.useState(0),[f,v]=h.useState(null),[I,U]=h.useState(!1),[B,$]=h.useState([]);h.useEffect(()=>{t.current=new hi(r.config);const C=t.current;return C.on("initialized",S=>{o(S.speechRecognition&&S.speechSynthesis),U(!0),$(C.getAvailableVoices())}),C.on("listening",({started:S})=>{a(S)}),C.on("result",({results:S})=>{var R;(R=r.onResult)==null||R.call(r,S)}),C.on("finalResult",({results:S})=>{var R;(R=r.onFinalResult)==null||R.call(r,S)}),C.on("voiceActivity",S=>{var R;d(S.isActive),m(S.volume),(R=r.onVoiceActivity)==null||R.call(r,S)}),C.on("speechStart",()=>{var S;(S=r.onSpeechStart)==null||S.call(r)}),C.on("speechEnd",()=>{var S;(S=r.onSpeechEnd)==null||S.call(r)}),C.on("error",({type:S,error:R})=>{var w;const L=`Speech ${S} error: ${R}`;v(L),(w=r.onError)==null||w.call(r,{type:S,error:R}),console.error(L)}),r.autoStart&&C.startListening().catch(console.error),()=>{C.destroy()}},[]);const _=h.useCallback(async()=>{try{v(null),t.current&&await t.current.startListening()}catch(C){const S=C instanceof Error?C.message:"Failed to start listening";throw v(S),C}},[]),F=h.useCallback(()=>{try{v(null),t.current&&t.current.stopListening()}catch(C){const S=C instanceof Error?C.message:"Failed to stop listening";v(S)}},[]),G=h.useCallback(async(C,S)=>{try{v(null),t.current&&await t.current.speak(C,S)}catch(R){const L=R instanceof Error?R.message:"Failed to speak";throw v(L),R}},[]),J=h.useCallback(C=>{t.current&&t.current.updateConfig(C)},[]);return h.useEffect(()=>{if(I&&t.current){const C=()=>{$(t.current.getAvailableVoices())};if(C(),"speechSynthesis"in window)return window.speechSynthesis.addEventListener("voiceschanged",C),()=>{window.speechSynthesis.removeEventListener("voiceschanged",C)}}},[I]),{isListening:s,isAvailable:n,isVoiceActive:l,volume:g,startListening:_,stopListening:F,speak:G,updateConfig:J,availableVoices:B,error:f,isInitialized:I}};class Ke extends Error{constructor(t,s){const a=new.target.prototype;super(`${t}: Status code '${s}'`),this.statusCode=s,this.__proto__=a}}class xs extends Error{constructor(t="A timeout occurred."){const s=new.target.prototype;super(t),this.__proto__=s}}class Le extends Error{constructor(t="An abort occurred."){const s=new.target.prototype;super(t),this.__proto__=s}}class gi extends Error{constructor(t,s){const a=new.target.prototype;super(t),this.transport=s,this.errorType="UnsupportedTransportError",this.__proto__=a}}class mi extends Error{constructor(t,s){const a=new.target.prototype;super(t),this.transport=s,this.errorType="DisabledTransportError",this.__proto__=a}}class xi extends Error{constructor(t,s){const a=new.target.prototype;super(t),this.transport=s,this.errorType="FailedToStartTransportError",this.__proto__=a}}class Ks extends Error{constructor(t){const s=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=s}}class pi extends Error{constructor(t,s){const a=new.target.prototype;super(t),this.innerErrors=s,this.__proto__=a}}class jr{constructor(t,s,a){this.statusCode=t,this.statusText=s,this.content=a}}class Qt{get(t,s){return this.send({...s,method:"GET",url:t})}post(t,s){return this.send({...s,method:"POST",url:t})}delete(t,s){return this.send({...s,method:"DELETE",url:t})}getCookieString(t){return""}}var N;(function(r){r[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None"})(N||(N={}));class kt{constructor(){}log(t,s){}}kt.instance=new kt;const fi="9.0.6";class me{static isRequired(t,s){if(t==null)throw new Error(`The '${s}' argument is required.`)}static isNotEmpty(t,s){if(!t||t.match(/^\s*$/))throw new Error(`The '${s}' argument should not be empty.`)}static isIn(t,s,a){if(!(t in s))throw new Error(`Unknown ${a} value: ${t}.`)}}class le{static get isBrowser(){return!le.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!le.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!le.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function jt(r,t){let s="";return Xe(r)?(s=`Binary data of length ${r.byteLength}`,t&&(s+=`. Content: '${yi(r)}'`)):typeof r=="string"&&(s=`String data of length ${r.length}`,t&&(s+=`. Content: '${r}'`)),s}function yi(r){const t=new Uint8Array(r);let s="";return t.forEach(a=>{const n=a<16?"0":"";s+=`0x${n}${a.toString(16)} `}),s.substr(0,s.length-1)}function Xe(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}async function Nr(r,t,s,a,n,o){const l={},[d,g]=ot();l[d]=g,r.log(N.Trace,`(${t} transport) sending data. ${jt(n,o.logMessageContent)}.`);const m=Xe(n)?"arraybuffer":"text",f=await s.post(a,{content:n,headers:{...l,...o.headers},responseType:m,timeout:o.timeout,withCredentials:o.withCredentials});r.log(N.Trace,`(${t} transport) request complete. Response status: ${f.statusCode}.`)}function bi(r){return r===void 0?new Jt(N.Information):r===null?kt.instance:r.log!==void 0?r:new Jt(r)}class vi{constructor(t,s){this._subject=t,this._observer=s}dispose(){const t=this._subject.observers.indexOf(this._observer);t>-1&&this._subject.observers.splice(t,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(s=>{})}}class Jt{constructor(t){this._minLevel=t,this.out=console}log(t,s){if(t>=this._minLevel){const a=`[${new Date().toISOString()}] ${N[t]}: ${s}`;switch(t){case N.Critical:case N.Error:this.out.error(a);break;case N.Warning:this.out.warn(a);break;case N.Information:this.out.info(a);break;default:this.out.log(a);break}}}}function ot(){let r="X-SignalR-User-Agent";return le.isNode&&(r="User-Agent"),[r,wi(fi,ki(),Ni(),ji())]}function wi(r,t,s,a){let n="Microsoft SignalR/";const o=r.split(".");return n+=`${o[0]}.${o[1]}`,n+=` (${r}; `,t&&t!==""?n+=`${t}; `:n+="Unknown OS; ",n+=`${s}`,a?n+=`; ${a}`:n+="; Unknown Runtime Version",n+=")",n}function ki(){if(le.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function ji(){if(le.isNode)return process.versions.node}function Ni(){return le.isNode?"NodeJS":"Browser"}function ls(r){return r.stack?r.stack:r.message?r.message:`${r}`}function Si(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("could not find globalThis")}class _i extends Qt{constructor(t){if(super(),this._logger=t,typeof fetch>"u"||le.isNode){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(s("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=s("node-fetch"):this._fetchType=fetch,this._fetchType=s("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Si());if(typeof AbortController>"u"){const s=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=s("abort-controller")}else this._abortControllerType=AbortController}async send(t){if(t.abortSignal&&t.abortSignal.aborted)throw new Le;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");const s=new this._abortControllerType;let a;t.abortSignal&&(t.abortSignal.onabort=()=>{s.abort(),a=new Le});let n=null;if(t.timeout){const g=t.timeout;n=setTimeout(()=>{s.abort(),this._logger.log(N.Warning,"Timeout from HTTP request."),a=new xs},g)}t.content===""&&(t.content=void 0),t.content&&(t.headers=t.headers||{},Xe(t.content)?t.headers["Content-Type"]="application/octet-stream":t.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(t.url,{body:t.content,cache:"no-cache",credentials:t.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...t.headers},method:t.method,mode:"cors",redirect:"follow",signal:s.signal})}catch(g){throw a||(this._logger.log(N.Warning,`Error from HTTP request. ${g}.`),g)}finally{n&&clearTimeout(n),t.abortSignal&&(t.abortSignal.onabort=null)}if(!o.ok){const g=await Js(o,"text");throw new Ke(g||o.statusText,o.status)}const d=await Js(o,t.responseType);return new jr(o.status,o.statusText,d)}getCookieString(t){let s="";return le.isNode&&this._jar&&this._jar.getCookies(t,(a,n)=>s=n.join("; ")),s}}function Js(r,t){let s;switch(t){case"arraybuffer":s=r.arrayBuffer();break;case"text":s=r.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`);default:s=r.text();break}return s}class Ci extends Qt{constructor(t){super(),this._logger=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new Le):t.method?t.url?new Promise((s,a)=>{const n=new XMLHttpRequest;n.open(t.method,t.url,!0),n.withCredentials=t.withCredentials===void 0?!0:t.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.content===""&&(t.content=void 0),t.content&&(Xe(t.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=t.headers;o&&Object.keys(o).forEach(l=>{n.setRequestHeader(l,o[l])}),t.responseType&&(n.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{n.abort(),a(new Le)}),t.timeout&&(n.timeout=t.timeout),n.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),n.status>=200&&n.status<300?s(new jr(n.status,n.statusText,n.response||n.responseText)):a(new Ke(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(N.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),a(new Ke(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(N.Warning,"Timeout from HTTP request."),a(new xs)},n.send(t.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Ai extends Qt{constructor(t){if(super(),typeof fetch<"u"||le.isNode)this._httpClient=new _i(t);else if(typeof XMLHttpRequest<"u")this._httpClient=new Ci(t);else throw new Error("No usable HttpClient found.")}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new Le):t.method?t.url?this._httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this._httpClient.getCookieString(t)}}class De{static write(t){return`${t}${De.RecordSeparator}`}static parse(t){if(t[t.length-1]!==De.RecordSeparator)throw new Error("Message is incomplete.");const s=t.split(De.RecordSeparator);return s.pop(),s}}De.RecordSeparatorCode=30;De.RecordSeparator=String.fromCharCode(De.RecordSeparatorCode);class Ii{writeHandshakeRequest(t){return De.write(JSON.stringify(t))}parseHandshakeResponse(t){let s,a;if(Xe(t)){const d=new Uint8Array(t),g=d.indexOf(De.RecordSeparatorCode);if(g===-1)throw new Error("Message is incomplete.");const m=g+1;s=String.fromCharCode.apply(null,Array.prototype.slice.call(d.slice(0,m))),a=d.byteLength>m?d.slice(m).buffer:null}else{const d=t,g=d.indexOf(De.RecordSeparator);if(g===-1)throw new Error("Message is incomplete.");const m=g+1;s=d.substring(0,m),a=d.length>m?d.substring(m):null}const n=De.parse(s),o=JSON.parse(n[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[a,o]}}var K;(function(r){r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close",r[r.Ack=8]="Ack",r[r.Sequence=9]="Sequence"})(K||(K={}));class Ei{constructor(){this.observers=[]}next(t){for(const s of this.observers)s.next(t)}error(t){for(const s of this.observers)s.error&&s.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new vi(this,t)}}class Ri{constructor(t,s,a){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=t,this._connection=s,this._bufferSize=a}async _send(t){const s=this._protocol.writeMessage(t);let a=Promise.resolve();if(this._isInvocationMessage(t)){this._totalMessageCount++;let n=()=>{},o=()=>{};Xe(s)?this._bufferedByteCount+=s.byteLength:this._bufferedByteCount+=s.length,this._bufferedByteCount>=this._bufferSize&&(a=new Promise((l,d)=>{n=l,o=d})),this._messages.push(new Mi(s,this._totalMessageCount,n,o))}try{this._reconnectInProgress||await this._connection.send(s)}catch{this._disconnected()}await a}_ack(t){let s=-1;for(let a=0;a<this._messages.length;a++){const n=this._messages[a];if(n._id<=t.sequenceId)s=a,Xe(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else if(this._bufferedByteCount<this._bufferSize)n._resolver();else break}s!==-1&&(this._messages=this._messages.slice(s+1))}_shouldProcessMessage(t){if(this._waitForSequenceMessage)return t.type!==K.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(t))return!0;const s=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,s<=this._latestReceivedSequenceId?(s===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=s,this._ackTimer(),!0)}_resetSequence(t){if(t.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=t.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const t=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:K.Sequence,sequenceId:t}));const s=this._messages;for(const a of s)await this._connection.send(a._message);this._reconnectInProgress=!1}_dispose(t){t??(t=new Error("Unable to reconnect to server."));for(const s of this._messages)s._rejector(t)}_isInvocationMessage(t){switch(t.type){case K.Invocation:case K.StreamItem:case K.Completion:case K.StreamInvocation:case K.CancelInvocation:return!0;case K.Close:case K.Sequence:case K.Ping:case K.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:K.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class Mi{constructor(t,s,a,n){this._message=t,this._id=s,this._resolver=a,this._rejector=n}}const Ti=30*1e3,Di=15*1e3,Pi=1e5;var Q;(function(r){r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting"})(Q||(Q={}));class ps{static create(t,s,a,n,o,l,d){return new ps(t,s,a,n,o,l,d)}constructor(t,s,a,n,o,l,d){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(N.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},me.isRequired(t,"connection"),me.isRequired(s,"logger"),me.isRequired(a,"protocol"),this.serverTimeoutInMilliseconds=o??Ti,this.keepAliveIntervalInMilliseconds=l??Di,this._statefulReconnectBufferSize=d??Pi,this._logger=s,this._protocol=a,this.connection=t,this._reconnectPolicy=n,this._handshakeProtocol=new Ii,this.connection.onreceive=g=>this._processIncomingData(g),this.connection.onclose=g=>this._connectionClosed(g),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Q.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:K.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this._connectionState!==Q.Disconnected&&this._connectionState!==Q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Q.Connecting,this._logger.log(N.Debug,"Starting HubConnection.");try{await this._startInternal(),le.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Q.Connected,this._connectionStarted=!0,this._logger.log(N.Debug,"HubConnection connected successfully.")}catch(t){return this._connectionState=Q.Disconnected,this._logger.log(N.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const t=new Promise((s,a)=>{this._handshakeResolver=s,this._handshakeRejecter=a});await this.connection.start(this._protocol.transferFormat);try{let s=this._protocol.version;this.connection.features.reconnect||(s=1);const a={protocol:this._protocol.name,version:s};if(this._logger.log(N.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(a)),this._logger.log(N.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await t,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new Ri(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(s){throw this._logger.log(N.Debug,`Hub handshake failed with error '${s}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(s),s}}async stop(){const t=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await t}catch{}}_stopInternal(t){if(this._connectionState===Q.Disconnected)return this._logger.log(N.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Q.Disconnecting)return this._logger.log(N.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const s=this._connectionState;return this._connectionState=Q.Disconnecting,this._logger.log(N.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(N.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(s===Q.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=t||new Le("The connection was stopped before the hub handshake could complete."),this.connection.stop(t))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(t,...s){const[a,n]=this._replaceStreamingParams(s),o=this._createStreamInvocation(t,s,n);let l;const d=new Ei;return d.cancelCallback=()=>{const g=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],l.then(()=>this._sendWithProtocol(g))},this._callbacks[o.invocationId]=(g,m)=>{if(m){d.error(m);return}else g&&(g.type===K.Completion?g.error?d.error(new Error(g.error)):d.complete():d.next(g.item))},l=this._sendWithProtocol(o).catch(g=>{d.error(g),delete this._callbacks[o.invocationId]}),this._launchStreams(a,l),d}_sendMessage(t){return this._resetKeepAliveInterval(),this.connection.send(t)}_sendWithProtocol(t){return this._messageBuffer?this._messageBuffer._send(t):this._sendMessage(this._protocol.writeMessage(t))}send(t,...s){const[a,n]=this._replaceStreamingParams(s),o=this._sendWithProtocol(this._createInvocation(t,s,!0,n));return this._launchStreams(a,o),o}invoke(t,...s){const[a,n]=this._replaceStreamingParams(s),o=this._createInvocation(t,s,!1,n);return new Promise((d,g)=>{this._callbacks[o.invocationId]=(f,v)=>{if(v){g(v);return}else f&&(f.type===K.Completion?f.error?g(new Error(f.error)):d(f.result):g(new Error(`Unexpected message type: ${f.type}`)))};const m=this._sendWithProtocol(o).catch(f=>{g(f),delete this._callbacks[o.invocationId]});this._launchStreams(a,m)})}on(t,s){!t||!s||(t=t.toLowerCase(),this._methods[t]||(this._methods[t]=[]),this._methods[t].indexOf(s)===-1&&this._methods[t].push(s))}off(t,s){if(!t)return;t=t.toLowerCase();const a=this._methods[t];if(a)if(s){const n=a.indexOf(s);n!==-1&&(a.splice(n,1),a.length===0&&delete this._methods[t])}else delete this._methods[t]}onclose(t){t&&this._closedCallbacks.push(t)}onreconnecting(t){t&&this._reconnectingCallbacks.push(t)}onreconnected(t){t&&this._reconnectedCallbacks.push(t)}_processIncomingData(t){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(t=this._processHandshakeResponse(t),this._receivedHandshakeResponse=!0),t){const s=this._protocol.parseMessages(t,this._logger);for(const a of s)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(a)))switch(a.type){case K.Invocation:this._invokeClientMethod(a).catch(n=>{this._logger.log(N.Error,`Invoke client method threw error: ${ls(n)}`)});break;case K.StreamItem:case K.Completion:{const n=this._callbacks[a.invocationId];if(n){a.type===K.Completion&&delete this._callbacks[a.invocationId];try{n(a)}catch(o){this._logger.log(N.Error,`Stream callback threw error: ${ls(o)}`)}}break}case K.Ping:break;case K.Close:{this._logger.log(N.Information,"Close message received from server.");const n=a.error?new Error("Server returned an error on close: "+a.error):void 0;a.allowReconnect===!0?this.connection.stop(n):this._stopPromise=this._stopInternal(n);break}case K.Ack:this._messageBuffer&&this._messageBuffer._ack(a);break;case K.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(a);break;default:this._logger.log(N.Warning,`Invalid message type: ${a.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(t){let s,a;try{[a,s]=this._handshakeProtocol.parseHandshakeResponse(t)}catch(n){const o="Error parsing handshake response: "+n;this._logger.log(N.Error,o);const l=new Error(o);throw this._handshakeRejecter(l),l}if(s.error){const n="Server returned handshake error: "+s.error;this._logger.log(N.Error,n);const o=new Error(n);throw this._handshakeRejecter(o),o}else this._logger.log(N.Debug,"Server handshake complete.");return this._handshakeResolver(),a}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let t=this._nextKeepAlive-new Date().getTime();t<0&&(t=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===Q.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(t){const s=t.target.toLowerCase(),a=this._methods[s];if(!a){this._logger.log(N.Warning,`No client method with the name '${s}' found.`),t.invocationId&&(this._logger.log(N.Warning,`No result given for '${s}' method and invocation ID '${t.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)));return}const n=a.slice(),o=!!t.invocationId;let l,d,g;for(const m of n)try{const f=l;l=await m.apply(this,t.arguments),o&&l&&f&&(this._logger.log(N.Error,`Multiple results provided for '${s}'. Sending error to server.`),g=this._createCompletionMessage(t.invocationId,"Client provided multiple results.",null)),d=void 0}catch(f){d=f,this._logger.log(N.Error,`A callback for the method '${s}' threw error '${f}'.`)}g?await this._sendWithProtocol(g):o?(d?g=this._createCompletionMessage(t.invocationId,`${d}`,null):l!==void 0?g=this._createCompletionMessage(t.invocationId,null,l):(this._logger.log(N.Warning,`No result given for '${s}' method and invocation ID '${t.invocationId}'.`),g=this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(g)):l&&this._logger.log(N.Error,`Result given for '${s}' method but server is not expecting a result.`)}_connectionClosed(t){this._logger.log(N.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||t||new Le("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Q.Disconnecting?this._completeClose(t):this._connectionState===Q.Connected&&this._reconnectPolicy?this._reconnect(t):this._connectionState===Q.Connected&&this._completeClose(t)}_completeClose(t){if(this._connectionStarted){this._connectionState=Q.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(t??new Error("Connection closed.")),this._messageBuffer=void 0),le.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(s=>s.apply(this,[t]))}catch(s){this._logger.log(N.Error,`An onclose callback called with error '${t}' threw error '${s}'.`)}}}async _reconnect(t){const s=Date.now();let a=0,n=t!==void 0?t:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(a++,0,n);if(o===null){this._logger.log(N.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(t);return}if(this._connectionState=Q.Reconnecting,t?this._logger.log(N.Information,`Connection reconnecting because of error '${t}'.`):this._logger.log(N.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(l=>l.apply(this,[t]))}catch(l){this._logger.log(N.Error,`An onreconnecting callback called with error '${t}' threw error '${l}'.`)}if(this._connectionState!==Q.Reconnecting){this._logger.log(N.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(N.Information,`Reconnect attempt number ${a} will start in ${o} ms.`),await new Promise(l=>{this._reconnectDelayHandle=setTimeout(l,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==Q.Reconnecting){this._logger.log(N.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=Q.Connected,this._logger.log(N.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(l=>l.apply(this,[this.connection.connectionId]))}catch(l){this._logger.log(N.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${l}'.`)}return}catch(l){if(this._logger.log(N.Information,`Reconnect attempt failed because of error '${l}'.`),this._connectionState!==Q.Reconnecting){this._logger.log(N.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===Q.Disconnecting&&this._completeClose();return}n=l instanceof Error?l:new Error(l.toString()),o=this._getNextRetryDelay(a++,Date.now()-s,n)}}this._logger.log(N.Information,`Reconnect retries have been exhausted after ${Date.now()-s} ms and ${a} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(t,s,a){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:s,previousRetryCount:t,retryReason:a})}catch(n){return this._logger.log(N.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${s}) threw error '${n}'.`),null}}_cancelCallbacksWithError(t){const s=this._callbacks;this._callbacks={},Object.keys(s).forEach(a=>{const n=s[a];try{n(null,t)}catch(o){this._logger.log(N.Error,`Stream 'error' callback called with '${t}' threw error: ${ls(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(t,s,a,n){if(a)return n.length!==0?{target:t,arguments:s,streamIds:n,type:K.Invocation}:{target:t,arguments:s,type:K.Invocation};{const o=this._invocationId;return this._invocationId++,n.length!==0?{target:t,arguments:s,invocationId:o.toString(),streamIds:n,type:K.Invocation}:{target:t,arguments:s,invocationId:o.toString(),type:K.Invocation}}}_launchStreams(t,s){if(t.length!==0){s||(s=Promise.resolve());for(const a in t)t[a].subscribe({complete:()=>{s=s.then(()=>this._sendWithProtocol(this._createCompletionMessage(a)))},error:n=>{let o;n instanceof Error?o=n.message:n&&n.toString?o=n.toString():o="Unknown error",s=s.then(()=>this._sendWithProtocol(this._createCompletionMessage(a,o)))},next:n=>{s=s.then(()=>this._sendWithProtocol(this._createStreamItemMessage(a,n)))}})}}_replaceStreamingParams(t){const s=[],a=[];for(let n=0;n<t.length;n++){const o=t[n];if(this._isObservable(o)){const l=this._invocationId;this._invocationId++,s[l]=o,a.push(l.toString()),t.splice(n,1)}}return[s,a]}_isObservable(t){return t&&t.subscribe&&typeof t.subscribe=="function"}_createStreamInvocation(t,s,a){const n=this._invocationId;return this._invocationId++,a.length!==0?{target:t,arguments:s,invocationId:n.toString(),streamIds:a,type:K.StreamInvocation}:{target:t,arguments:s,invocationId:n.toString(),type:K.StreamInvocation}}_createCancelInvocation(t){return{invocationId:t,type:K.CancelInvocation}}_createStreamItemMessage(t,s){return{invocationId:t,item:s,type:K.StreamItem}}_createCompletionMessage(t,s,a){return s?{error:s,invocationId:t,type:K.Completion}:{invocationId:t,result:a,type:K.Completion}}_createCloseMessage(){return{type:K.Close}}}const $i=[0,2e3,1e4,3e4,null];class Zs{constructor(t){this._retryDelays=t!==void 0?[...t,null]:$i}nextRetryDelayInMilliseconds(t){return this._retryDelays[t.previousRetryCount]}}class Je{}Je.Authorization="Authorization";Je.Cookie="Cookie";class Fi extends Qt{constructor(t,s){super(),this._innerClient=t,this._accessTokenFactory=s}async send(t){let s=!0;this._accessTokenFactory&&(!this._accessToken||t.url&&t.url.indexOf("/negotiate?")>0)&&(s=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(t);const a=await this._innerClient.send(t);return s&&a.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(t),await this._innerClient.send(t)):a}_setAuthorizationHeader(t){t.headers||(t.headers={}),this._accessToken?t.headers[Je.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&t.headers[Je.Authorization]&&delete t.headers[Je.Authorization]}getCookieString(t){return this._innerClient.getCookieString(t)}}var xe;(function(r){r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling"})(xe||(xe={}));var _e;(function(r){r[r.Text=1]="Text",r[r.Binary=2]="Binary"})(_e||(_e={}));let Li=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class Xs{get pollAborted(){return this._pollAbort.aborted}constructor(t,s,a){this._httpClient=t,this._logger=s,this._pollAbort=new Li,this._options=a,this._running=!1,this.onreceive=null,this.onclose=null}async connect(t,s){if(me.isRequired(t,"url"),me.isRequired(s,"transferFormat"),me.isIn(s,_e,"transferFormat"),this._url=t,this._logger.log(N.Trace,"(LongPolling transport) Connecting."),s===_e.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[a,n]=ot(),o={[a]:n,...this._options.headers},l={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};s===_e.Binary&&(l.responseType="arraybuffer");const d=`${t}&_=${Date.now()}`;this._logger.log(N.Trace,`(LongPolling transport) polling: ${d}.`);const g=await this._httpClient.get(d,l);g.statusCode!==200?(this._logger.log(N.Error,`(LongPolling transport) Unexpected response code: ${g.statusCode}.`),this._closeError=new Ke(g.statusText||"",g.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,l)}async _poll(t,s){try{for(;this._running;)try{const a=`${t}&_=${Date.now()}`;this._logger.log(N.Trace,`(LongPolling transport) polling: ${a}.`);const n=await this._httpClient.get(a,s);n.statusCode===204?(this._logger.log(N.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):n.statusCode!==200?(this._logger.log(N.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new Ke(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(N.Trace,`(LongPolling transport) data received. ${jt(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(N.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(a){this._running?a instanceof xs?this._logger.log(N.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=a,this._running=!1):this._logger.log(N.Trace,`(LongPolling transport) Poll errored after shutdown: ${a.message}`)}}finally{this._logger.log(N.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(t){return this._running?Nr(this._logger,"LongPolling",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(N.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(N.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const t={},[s,a]=ot();t[s]=a;const n={headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,n)}catch(l){o=l}o?o instanceof Ke&&(o.statusCode===404?this._logger.log(N.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(N.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(N.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(N.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this._closeError&&(t+=" Error: "+this._closeError),this._logger.log(N.Trace,t),this.onclose(this._closeError)}}}class Ui{constructor(t,s,a,n){this._httpClient=t,this._accessToken=s,this._logger=a,this._options=n,this.onreceive=null,this.onclose=null}async connect(t,s){return me.isRequired(t,"url"),me.isRequired(s,"transferFormat"),me.isIn(s,_e,"transferFormat"),this._logger.log(N.Trace,"(SSE transport) Connecting."),this._url=t,this._accessToken&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((a,n)=>{let o=!1;if(s!==_e.Text){n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let l;if(le.isBrowser||le.isWebWorker)l=new this._options.EventSource(t,{withCredentials:this._options.withCredentials});else{const d=this._httpClient.getCookieString(t),g={};g.Cookie=d;const[m,f]=ot();g[m]=f,l=new this._options.EventSource(t,{withCredentials:this._options.withCredentials,headers:{...g,...this._options.headers}})}try{l.onmessage=d=>{if(this.onreceive)try{this._logger.log(N.Trace,`(SSE transport) data received. ${jt(d.data,this._options.logMessageContent)}.`),this.onreceive(d.data)}catch(g){this._close(g);return}},l.onerror=d=>{o?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},l.onopen=()=>{this._logger.log(N.Information,`SSE connected to ${this._url}`),this._eventSource=l,o=!0,a()}}catch(d){n(d);return}})}async send(t){return this._eventSource?Nr(this._logger,"SSE",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(t){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(t))}}class Oi{constructor(t,s,a,n,o,l){this._logger=a,this._accessTokenFactory=s,this._logMessageContent=n,this._webSocketConstructor=o,this._httpClient=t,this.onreceive=null,this.onclose=null,this._headers=l}async connect(t,s){me.isRequired(t,"url"),me.isRequired(s,"transferFormat"),me.isIn(s,_e,"transferFormat"),this._logger.log(N.Trace,"(WebSockets transport) Connecting.");let a;return this._accessTokenFactory&&(a=await this._accessTokenFactory()),new Promise((n,o)=>{t=t.replace(/^http/,"ws");let l;const d=this._httpClient.getCookieString(t);let g=!1;if(le.isNode||le.isReactNative){const m={},[f,v]=ot();m[f]=v,a&&(m[Je.Authorization]=`Bearer ${a}`),d&&(m[Je.Cookie]=d),l=new this._webSocketConstructor(t,void 0,{headers:{...m,...this._headers}})}else a&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(a)}`);l||(l=new this._webSocketConstructor(t)),s===_e.Binary&&(l.binaryType="arraybuffer"),l.onopen=m=>{this._logger.log(N.Information,`WebSocket connected to ${t}.`),this._webSocket=l,g=!0,n()},l.onerror=m=>{let f=null;typeof ErrorEvent<"u"&&m instanceof ErrorEvent?f=m.error:f="There was an error with the transport",this._logger.log(N.Information,`(WebSockets transport) ${f}.`)},l.onmessage=m=>{if(this._logger.log(N.Trace,`(WebSockets transport) data received. ${jt(m.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(m.data)}catch(f){this._close(f);return}},l.onclose=m=>{if(g)this._close(m);else{let f=null;typeof ErrorEvent<"u"&&m instanceof ErrorEvent?f=m.error:f="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(f))}}})}send(t){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(N.Trace,`(WebSockets transport) sending data. ${jt(t,this._logMessageContent)}.`),this._webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(t){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(N.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(t)&&(t.wasClean===!1||t.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)):t instanceof Error?this.onclose(t):this.onclose())}_isCloseEvent(t){return t&&typeof t.wasClean=="boolean"&&typeof t.code=="number"}}const Qs=100;class zi{constructor(t,s={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,me.isRequired(t,"url"),this._logger=bi(s.logger),this.baseUrl=this._resolveUrl(t),s=s||{},s.logMessageContent=s.logMessageContent===void 0?!1:s.logMessageContent,typeof s.withCredentials=="boolean"||s.withCredentials===void 0)s.withCredentials=s.withCredentials===void 0?!0:s.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");s.timeout=s.timeout===void 0?100*1e3:s.timeout;let a=null,n=null;if(le.isNode&&typeof require<"u"){const o=typeof __webpack_require__=="function"?__non_webpack_require__:require;a=o("ws"),n=o("eventsource")}!le.isNode&&typeof WebSocket<"u"&&!s.WebSocket?s.WebSocket=WebSocket:le.isNode&&!s.WebSocket&&a&&(s.WebSocket=a),!le.isNode&&typeof EventSource<"u"&&!s.EventSource?s.EventSource=EventSource:le.isNode&&!s.EventSource&&typeof n<"u"&&(s.EventSource=n),this._httpClient=new Fi(s.httpClient||new Ai(this._logger),s.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=s,this.onreceive=null,this.onclose=null}async start(t){if(t=t||_e.Binary,me.isIn(t,_e,"transferFormat"),this._logger.log(N.Debug,`Starting connection with transfer format '${_e[t]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(t),await this._startInternalPromise,this._connectionState==="Disconnecting"){const s="Failed to start the HttpConnection before stop() was called.";return this._logger.log(N.Error,s),await this._stopPromise,Promise.reject(new Le(s))}else if(this._connectionState!=="Connected"){const s="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(N.Error,s),Promise.reject(new Le(s))}this._connectionStarted=!0}send(t){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new fs(this.transport)),this._sendQueue.send(t))}async stop(t){if(this._connectionState==="Disconnected")return this._logger.log(N.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(N.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(s=>{this._stopPromiseResolver=s}),await this._stopInternal(t),await this._stopPromise}async _stopInternal(t){this._stopError=t;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(s){this._logger.log(N.Error,`HttpConnection.transport.stop() threw error '${s}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(N.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(t){let s=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===xe.WebSockets)this.transport=this._constructTransport(xe.WebSockets),await this._startTransport(s,t);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let a=null,n=0;do{if(a=await this._getNegotiationResponse(s),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new Le("The connection was stopped during negotiation.");if(a.error)throw new Error(a.error);if(a.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(a.url&&(s=a.url),a.accessToken){const o=a.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}n++}while(a.url&&n<Qs);if(n===Qs&&a.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(s,this._options.transport,a,t)}this.transport instanceof Xs&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(N.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(a){return this._logger.log(N.Error,"Failed to start the connection: "+a),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(a)}}async _getNegotiationResponse(t){const s={},[a,n]=ot();s[a]=n;const o=this._resolveNegotiateUrl(t);this._logger.log(N.Debug,`Sending negotiation request: ${o}.`);try{const l=await this._httpClient.post(o,{content:"",headers:{...s,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(l.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${l.statusCode}'`));const d=JSON.parse(l.content);return(!d.negotiateVersion||d.negotiateVersion<1)&&(d.connectionToken=d.connectionId),d.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new Ks("Client didn't negotiate Stateful Reconnect but the server did.")):d}catch(l){let d="Failed to complete negotiation with the server: "+l;return l instanceof Ke&&l.statusCode===404&&(d=d+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(N.Error,d),Promise.reject(new Ks(d))}}_createConnectUrl(t,s){return s?t+(t.indexOf("?")===-1?"?":"&")+`id=${s}`:t}async _createTransport(t,s,a,n){let o=this._createConnectUrl(t,a.connectionToken);if(this._isITransport(s)){this._logger.log(N.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=s,await this._startTransport(o,n),this.connectionId=a.connectionId;return}const l=[],d=a.availableTransports||[];let g=a;for(const m of d){const f=this._resolveTransportOrError(m,s,n,(g==null?void 0:g.useStatefulReconnect)===!0);if(f instanceof Error)l.push(`${m.transport} failed:`),l.push(f);else if(this._isITransport(f)){if(this.transport=f,!g){try{g=await this._getNegotiationResponse(t)}catch(v){return Promise.reject(v)}o=this._createConnectUrl(t,g.connectionToken)}try{await this._startTransport(o,n),this.connectionId=g.connectionId;return}catch(v){if(this._logger.log(N.Error,`Failed to start the transport '${m.transport}': ${v}`),g=void 0,l.push(new xi(`${m.transport} failed: ${v}`,xe[m.transport])),this._connectionState!=="Connecting"){const I="Failed to select transport before stop() was called.";return this._logger.log(N.Debug,I),Promise.reject(new Le(I))}}}}return l.length>0?Promise.reject(new pi(`Unable to connect to the server with any of the available transports. ${l.join(" ")}`,l)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(t){switch(t){case xe.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Oi(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case xe.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Ui(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case xe.LongPolling:return new Xs(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${t}.`)}}_startTransport(t,s){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async a=>{let n=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(t,s),await this.features.resend()}catch{n=!0}else{this._stopConnection(a);return}n&&this._stopConnection(a)}:this.transport.onclose=a=>this._stopConnection(a),this.transport.connect(t,s)}_resolveTransportOrError(t,s,a,n){const o=xe[t.transport];if(o==null)return this._logger.log(N.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(Hi(s,o))if(t.transferFormats.map(d=>_e[d]).indexOf(a)>=0){if(o===xe.WebSockets&&!this._options.WebSocket||o===xe.ServerSentEvents&&!this._options.EventSource)return this._logger.log(N.Debug,`Skipping transport '${xe[o]}' because it is not supported in your environment.'`),new gi(`'${xe[o]}' is not supported in your environment.`,o);this._logger.log(N.Debug,`Selecting transport '${xe[o]}'.`);try{return this.features.reconnect=o===xe.WebSockets?n:void 0,this._constructTransport(o)}catch(d){return d}}else return this._logger.log(N.Debug,`Skipping transport '${xe[o]}' because it does not support the requested transfer format '${_e[a]}'.`),new Error(`'${xe[o]}' does not support ${_e[a]}.`);else return this._logger.log(N.Debug,`Skipping transport '${xe[o]}' because it was disabled by the client.`),new mi(`'${xe[o]}' is disabled by the client.`,o)}_isITransport(t){return t&&typeof t=="object"&&"connect"in t}_stopConnection(t){if(this._logger.log(N.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this._connectionState}.`),this.transport=void 0,t=this._stopError||t,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(N.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(N.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),t?this._logger.log(N.Error,`Connection disconnected with error '${t}'.`):this._logger.log(N.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(s=>{this._logger.log(N.Error,`TransportSendQueue.stop() threw error '${s}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(s){this._logger.log(N.Error,`HttpConnection.onclose(${t}) threw error '${s}'.`)}}}_resolveUrl(t){if(t.lastIndexOf("https://",0)===0||t.lastIndexOf("http://",0)===0)return t;if(!le.isBrowser)throw new Error(`Cannot resolve '${t}'.`);const s=window.document.createElement("a");return s.href=t,this._logger.log(N.Information,`Normalizing '${t}' to '${s.href}'.`),s.href}_resolveNegotiateUrl(t){const s=new URL(t);s.pathname.endsWith("/")?s.pathname+="negotiate":s.pathname+="/negotiate";const a=new URLSearchParams(s.searchParams);return a.has("negotiateVersion")||a.append("negotiateVersion",this._negotiateVersion.toString()),a.has("useStatefulReconnect")?a.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&a.append("useStatefulReconnect","true"),s.search=a.toString(),s.toString()}}function Hi(r,t){return!r||(t&r)!==0}class fs{constructor(t){this._transport=t,this._buffer=[],this._executing=!0,this._sendBufferedData=new qt,this._transportResult=new qt,this._sendLoopPromise=this._sendLoop()}send(t){return this._bufferData(t),this._transportResult||(this._transportResult=new qt),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(t){if(this._buffer.length&&typeof this._buffer[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof t}`);this._buffer.push(t),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new qt;const t=this._transportResult;this._transportResult=void 0;const s=typeof this._buffer[0]=="string"?this._buffer.join(""):fs._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(s),t.resolve()}catch(a){t.reject(a)}}}static _concatBuffers(t){const s=t.map(o=>o.byteLength).reduce((o,l)=>o+l),a=new Uint8Array(s);let n=0;for(const o of t)a.set(new Uint8Array(o),n),n+=o.byteLength;return a.buffer}}class qt{constructor(){this.promise=new Promise((t,s)=>[this._resolver,this._rejecter]=[t,s])}resolve(){this._resolver()}reject(t){this._rejecter(t)}}const Bi="json";class Vi{constructor(){this.name=Bi,this.version=2,this.transferFormat=_e.Text}parseMessages(t,s){if(typeof t!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];s===null&&(s=kt.instance);const a=De.parse(t),n=[];for(const o of a){const l=JSON.parse(o);if(typeof l.type!="number")throw new Error("Invalid payload.");switch(l.type){case K.Invocation:this._isInvocationMessage(l);break;case K.StreamItem:this._isStreamItemMessage(l);break;case K.Completion:this._isCompletionMessage(l);break;case K.Ping:break;case K.Close:break;case K.Ack:this._isAckMessage(l);break;case K.Sequence:this._isSequenceMessage(l);break;default:s.log(N.Information,"Unknown message type '"+l.type+"' ignored.");continue}n.push(l)}return n}writeMessage(t){return De.write(JSON.stringify(t))}_isInvocationMessage(t){this._assertNotEmptyString(t.target,"Invalid payload for Invocation message."),t.invocationId!==void 0&&this._assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(t){if(this._assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),t.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this._assertNotEmptyString(t.error,"Invalid payload for Completion message."),this._assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}_isAckMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(t,s){if(typeof t!="string"||t==="")throw new Error(s)}}const Wi={trace:N.Trace,debug:N.Debug,info:N.Information,information:N.Information,warn:N.Warning,warning:N.Warning,error:N.Error,critical:N.Critical,none:N.None};function qi(r){const t=Wi[r.toLowerCase()];if(typeof t<"u")return t;throw new Error(`Unknown log level: ${r}`)}class Gi{configureLogging(t){if(me.isRequired(t,"logging"),Yi(t))this.logger=t;else if(typeof t=="string"){const s=qi(t);this.logger=new Jt(s)}else this.logger=new Jt(t);return this}withUrl(t,s){return me.isRequired(t,"url"),me.isNotEmpty(t,"url"),this.url=t,typeof s=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...s}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:s},this}withHubProtocol(t){return me.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new Zs(t):this.reconnectPolicy=t:this.reconnectPolicy=new Zs,this}withServerTimeout(t){return me.isRequired(t,"milliseconds"),this._serverTimeoutInMilliseconds=t,this}withKeepAliveInterval(t){return me.isRequired(t,"milliseconds"),this._keepAliveIntervalInMilliseconds=t,this}withStatefulReconnect(t){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=t==null?void 0:t.bufferSize,this}build(){const t=this.httpConnectionOptions||{};if(t.logger===void 0&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const s=new zi(this.url,t);return ps.create(s,this.logger||kt.instance,this.protocol||new Vi,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Yi(r){return r.log!==void 0}class Ki{constructor(t="http://localhost:7071"){X(this,"connection",null);X(this,"sessionId",null);X(this,"onAgentMessageHandler");X(this,"onHandoffHandler");X(this,"onAgentTypingHandler");X(this,"onSessionStatusHandler");X(this,"onErrorHandler");this.baseUrl=t,this.setupConnection()}setupConnection(){this.connection=new Gi().withUrl(`${this.baseUrl}/api`).withAutomaticReconnect().configureLogging(N.Information).build(),this.connection.on("AgentMessage",t=>{var s;console.log("Received agent message:",t),(s=this.onAgentMessageHandler)==null||s.call(this,t)}),this.connection.on("AgentHandoff",t=>{var s;console.log("Received handoff notification:",t),(s=this.onHandoffHandler)==null||s.call(this,t)}),this.connection.on("AgentTyping",t=>{var s;console.log("Received typing notification:",t),(s=this.onAgentTypingHandler)==null||s.call(this,t)}),this.connection.on("SessionStatus",t=>{var s;console.log("Received session status:",t),(s=this.onSessionStatusHandler)==null||s.call(this,t)}),this.connection.onreconnecting(()=>{console.log("SignalR reconnecting...")}),this.connection.onreconnected(()=>{console.log("SignalR reconnected"),this.sessionId&&this.joinSession(this.sessionId)}),this.connection.onclose(t=>{var s;console.error("SignalR connection closed:",t),(s=this.onErrorHandler)==null||s.call(this,`Connection closed: ${(t==null?void 0:t.message)||"Unknown error"}`)})}async start(){if(!this.connection)throw new Error("SignalR connection not initialized");try{await this.connection.start(),console.log("SignalR connection started")}catch(t){throw console.error("Error starting SignalR connection:",t),t}}async stop(){this.connection&&this.connection.state===Q.Connected&&(await this.connection.stop(),console.log("SignalR connection stopped"))}async joinSession(t){if(!this.connection||this.connection.state!==Q.Connected)throw new Error("SignalR connection is not active");try{this.sessionId=t,await this.connection.invoke("JoinSession",t),console.log(`Joined session: ${t}`)}catch(s){throw console.error("Error joining session:",s),s}}async sendUserMessage(t){if(!this.connection||this.connection.state!==Q.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)throw new Error("No active session");try{await this.connection.invoke("SendUserMessage",this.sessionId,t),console.log("User message sent:",t)}catch(s){throw console.error("Error sending user message:",s),s}}async getSessionStatus(){if(!this.connection||this.connection.state!==Q.Connected)throw new Error("SignalR connection is not active");if(!this.sessionId)return null;try{return await this.connection.invoke("GetSessionStatus",this.sessionId)}catch(t){throw console.error("Error getting session status:",t),t}}onAgentMessage(t){this.onAgentMessageHandler=t}onAgentHandoff(t){this.onHandoffHandler=t}onAgentTyping(t){this.onAgentTypingHandler=t}onSessionStatus(t){this.onSessionStatusHandler=t}onError(t){this.onErrorHandler=t}get connectionState(){var t;return((t=this.connection)==null?void 0:t.state)||Q.Disconnected}get isConnected(){var t;return((t=this.connection)==null?void 0:t.state)===Q.Connected}get currentSessionId(){return this.sessionId}dispose(){this.stop(),this.connection=null,this.sessionId=null,this.onAgentMessageHandler=void 0,this.onHandoffHandler=void 0,this.onAgentTypingHandler=void 0,this.onSessionStatusHandler=void 0,this.onErrorHandler=void 0}}const Me=new Ki,Ji=()=>{const[r,t]=h.useState(Q.Disconnected),[s,a]=h.useState(!1),[n,o]=h.useState(null),[l,d]=h.useState(null),[g,m]=h.useState(null),[f,v]=h.useState([]),[I,U]=h.useState([]),[B,$]=h.useState({}),_=h.useRef(!1);h.useEffect(()=>{if(_.current)return;_.current=!0,Me.onAgentMessage(w=>{v(p=>[...p,w])}),Me.onAgentHandoff(w=>{U(p=>[...p,w])}),Me.onAgentTyping(w=>{$(p=>({...p,[w.agentName]:w.isTyping}))}),Me.onSessionStatus(w=>{m(w)}),Me.onError(w=>{o(w)});const L=setInterval(()=>{const w=Me.connectionState;t(w),a(w===Q.Connected)},1e3);return()=>{clearInterval(L),Me.dispose()}},[]);const F=h.useCallback(async()=>{try{o(null),await Me.start(),a(!0)}catch(L){const w=L instanceof Error?L.message:"Failed to connect";throw o(w),L}},[]),G=h.useCallback(async()=>{try{await Me.stop(),a(!1),d(null),m(null)}catch(L){const w=L instanceof Error?L.message:"Failed to disconnect";throw o(w),L}},[]),J=h.useCallback(async L=>{try{o(null),await Me.joinSession(L),d(L);const w=await Me.getSessionStatus();m(w)}catch(w){const p=w instanceof Error?w.message:"Failed to join session";throw o(p),w}},[]),C=h.useCallback(async L=>{try{o(null),await Me.sendUserMessage(L)}catch(w){const p=w instanceof Error?w.message:"Failed to send message";throw o(p),w}},[]),S=h.useCallback(()=>{v([]),U([]),$({})},[]),R=h.useCallback(async()=>{try{const L=await Me.getSessionStatus();m(L)}catch(L){const w=L instanceof Error?L.message:"Failed to refresh session status";throw o(w),L}},[]);return{connectionState:r,isConnected:s,error:n,sessionId:l,sessionStatus:g,agentMessages:f,handoffNotifications:I,agentTyping:B,connect:F,disconnect:G,joinSession:J,sendMessage:C,clearMessages:S,refreshSessionStatus:R}},Zi=({volume:r,isVoiceActive:t,isListening:s,size:a="md",className:n=""})=>{const o={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16"},l=a==="sm"?3:a==="md"?5:7,d=a==="sm"?16:a==="md"?24:32,g=Math.min(r/100,1);return e.jsx("div",{className:`flex items-center justify-center ${o[a]} ${n}`,children:e.jsx("div",{className:"flex items-end space-x-1 h-full",children:Array.from({length:l}).map((m,f)=>{const v=f/l,I=s&&(t||f===0),U=g>v,B=I&&U?Math.max(4,g*d):4,$=f*100;return e.jsx("div",{className:`w-1 transition-all duration-150 rounded-sm voice-bar ${I?U?"bg-green-500 animate-pulse":"bg-gray-300 dark:bg-gray-600":"bg-gray-200 dark:bg-gray-700"}`,"data-height":B,"data-delay":$},f)})})})},Xi=({config:r,availableVoices:t,selectedVoice:s,onConfigUpdate:a,onVoiceSelect:n,isOpen:o,onClose:l})=>{const[d,g]=h.useState(r),m=(v,I)=>{const U={...d,[v]:I};g(U),a({[v]:I})},f=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French (France)"},{code:"de-DE",name:"German (Germany)"},{code:"it-IT",name:"Italian (Italy)"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"}];return o?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"speech-settings-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-full p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:l}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fr,{className:"h-6 w-6 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{id:"speech-settings-title",className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Speech Settings"})]}),e.jsxs("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors","aria-label":"Close settings",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pr,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Recognition"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(xn,{className:"inline h-4 w-4 mr-1"}),"Language"]}),e.jsx("select",{value:d.language,onChange:v=>m("language",v.target.value),title:"Select language for speech recognition",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:f.map(v=>e.jsx("option",{value:v.code,children:v.name},v.code))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recognition Alternatives"}),e.jsxs("select",{value:d.maxAlternatives,onChange:v=>m("maxAlternatives",parseInt(v.target.value)),title:"Select number of recognition alternatives",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:1,children:"1 (fastest)"}),e.jsx("option",{value:2,children:"2 (balanced)"}),e.jsx("option",{value:3,children:"3 (best accuracy)"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.continuous,onChange:v=>m("continuous",v.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Continuous listening (auto-restart)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.interimResults,onChange:v=>m("interimResults",v.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Show interim results (real-time transcription)"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Audio Processing"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.noiseReduction,onChange:v=>m("noiseReduction",v.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Noise reduction"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.echoCancellation,onChange:v=>m("echoCancellation",v.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Echo cancellation"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.audioTracks,onChange:v=>m("audioTracks",v.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Enhanced audio processing"})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(wt,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Speech Synthesis"})]}),e.jsxs("button",{onClick:()=>window.speechSynthesis.getVoices(),className:"flex items-center space-x-1 px-3 py-1 text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors",title:"Refresh available voices",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Voice Selection"}),e.jsxs("select",{value:(s==null?void 0:s.name)||"",onChange:v=>{const I=t.find(U=>U.name===v.target.value);I&&n(I)},title:"Select voice for speech synthesis",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Default system voice"}),t.map((v,I)=>e.jsxs("option",{value:v.name,children:[v.name," (",v.lang,") ",v.default?"(Default)":""]},I))]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[t.length," voices available"]})]}),s&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>{const v=new SpeechSynthesisUtterance("Hello! This is a test of the selected voice.");v.voice=s,window.speechSynthesis.speak(v)},className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-800 dark:text-primary-200 dark:hover:bg-primary-700",children:[e.jsx(wt,{className:"h-4 w-4 mr-1"}),"Test Voice"]})})]})]}),e.jsx("div",{className:"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors",children:"Close"})})]})]})}):null},Qi=()=>{const{handleEnterSpace:r}=cr(),[t,s]=h.useState([]),[a,n]=h.useState(""),[o,l]=h.useState(!1),[d,g]=h.useState({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),[m,f]=h.useState(!1),[v,I]=h.useState(!1),[U,B]=h.useState(),$=h.useRef(null),_=h.useRef(null),F=Ji(),G=ui({config:{continuous:!0,interimResults:!0,language:"en-US",maxAlternatives:2},onFinalResult:p=>{p.length>0&&p[0].transcript.trim()&&(n(p[0].transcript.trim()),je(`Voice input captured: ${p[0].transcript}`))},onVoiceActivity:p=>{},onError:p=>{console.error("Advanced speech error:",p),je("Voice input error occurred")}});h.useEffect(()=>{var p;(p=$.current)==null||p.scrollIntoView({behavior:"smooth"})},[t]),h.useEffect(()=>((async()=>{try{F.isConnected||(await F.connect(),je("Connected to real-time communication"));const u=`session-${Date.now()}`;await F.joinSession(u),je("Joined communication session")}catch(u){console.error("Failed to initialize SignalR:",u),je("Failed to connect to real-time communication")}})(),()=>{F.disconnect()}),[F]),h.useEffect(()=>{if(F.agentMessages.length>0){const p=F.agentMessages[F.agentMessages.length-1],u={id:`signalr-${Date.now()}`,content:p.content,role:"assistant",timestamp:new Date(p.timestamp)};s(b=>b.some(j=>j.content===u.content&&Math.abs(j.timestamp.getTime()-u.timestamp.getTime())<1e3)?b:[...b,u]),g(b=>({...b,name:p.agentName,id:p.agentName.toLowerCase().replace(/\s+/g,"-"),isTyping:!1})),C(p.content),je(`Message from ${p.agentName}: ${p.content}`)}},[F.agentMessages]),h.useEffect(()=>{if(F.handoffNotifications.length>0){const p=F.handoffNotifications[F.handoffNotifications.length-1];g(b=>({...b,name:p.toAgent,id:p.toAgent.toLowerCase().replace(/\s+/g,"-"),isTyping:!1}));const u={id:`handoff-${Date.now()}`,content:`Agent handoff: ${p.reason}. You are now speaking with ${p.toAgent}.`,role:"assistant",timestamp:new Date(p.timestamp)};s(b=>[...b,u]),je(`Agent handoff: You are now speaking with ${p.toAgent}`)}},[F.handoffNotifications]),h.useEffect(()=>{Object.keys(F.agentTyping).filter(u=>F.agentTyping[u]).length>0?g(u=>({...u,isTyping:!0})):g(u=>({...u,isTyping:!1}))},[F.agentTyping]),h.useEffect(()=>{s([{id:"1",content:"Hello! I'm your behavioral health assistant. I can help you with depression screenings, provide support, or just have a friendly conversation. What would you like to explore today?",role:"assistant",timestamp:new Date}])},[]);const J=async()=>{try{G.isListening?(G.stopListening(),je("Voice input stopped")):(await G.startListening(),je("Voice input started"))}catch(p){console.error("Error toggling speech:",p),je("Error with voice input")}},C=async p=>{if(m&&G.isAvailable)try{await G.speak(p,{rate:.9,pitch:1,volume:.8,voice:U,interrupt:!0})}catch(u){console.error("Error speaking message:",u)}},S=()=>{f(!m),m?(je("Audio output disabled"),G.isAvailable&&window.speechSynthesis&&window.speechSynthesis.cancel()):je("Audio output enabled")},R=async()=>{if(!a.trim()||o)return;const p={id:Date.now().toString(),content:a.trim(),role:"user",timestamp:new Date};s(b=>[...b,p]);const u=a.trim();n(""),l(!0),g(b=>({...b,isTyping:!0}));try{if(F.isConnected){const b={content:u,timestamp:new Date().toISOString(),metadata:{speechConfidence:1,voiceActivityLevel:G.volume,processingTime:0}};await F.sendMessage(b),je("Message sent to agent")}else{await new Promise(V=>setTimeout(V,1e3+Math.random()*2e3));let b="I understand what you're saying. Let me help you with that.",x=d.id,j=d.name;const E=u.toLowerCase();E.includes("phq")||E.includes("depression")||E.includes("screening")?(b="I can help you with a depression screening. I'll start with the PHQ-2, which is a quick 2-question assessment. This will help determine if a more comprehensive evaluation might be helpful. Shall we begin?",x="phq2",j="PHQ-2 Agent"):E.includes("joke")||E.includes("funny")||E.includes("humor")?(b="Hey there! ðŸ˜„ I'm here to brighten your day with some wholesome humor! I can share clean jokes, funny stories, or just have some playful banter. What sounds good to you?",x="comedian",j="Comedy Agent"):(E.includes("crisis")||E.includes("emergency")||E.includes("help"))&&(b="I'm here to help. If you're experiencing a mental health crisis, please reach out for immediate support: Call 988 (Suicide & Crisis Lifeline) or contact your local emergency services. I'm also here to provide support and connect you with appropriate resources.");const T={id:(Date.now()+1).toString(),content:b,role:"assistant",timestamp:new Date};s(V=>[...V,T]),x!==d.id&&(g({id:x,name:j,isActive:!0,isTyping:!1}),je(`Agent changed to ${j}`)),C(b)}}catch(b){console.error("Error sending message:",b);const x={id:(Date.now()+1).toString(),content:"I'm sorry, I encountered an error processing your message. Please try again.",role:"assistant",timestamp:new Date};s(j=>[...j,x]),je("Error sending message")}finally{l(!1),F.isConnected||g(b=>({...b,isTyping:!1}))}},L=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),R())},w=()=>{s([]),g({id:"coordinator",name:"Coordinator Agent",isActive:!0,isTyping:!1}),je("Conversation cleared")};return e.jsxs("div",{className:"h-[calc(100vh-8rem)] flex flex-col bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${d.isTyping?"bg-primary-500 animate-pulse":d.isActive?"bg-green-500":"bg-gray-400"}`,children:e.jsx("span",{className:"text-white text-lg",children:"ðŸ¤–"})}),d.isActive&&e.jsx("div",{className:"absolute -inset-1 rounded-full bg-green-400 opacity-30 animate-ping"}),G.isListening&&e.jsx("div",{className:"absolute -bottom-1 -right-1",children:e.jsx(Zi,{volume:G.volume,isVoiceActive:G.isVoiceActive,isListening:G.isListening,size:"sm"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Agent Experience"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Current Agent: ",d.name,d.isTyping&&e.jsx("span",{className:"ml-2 text-primary-600 dark:text-primary-400",children:e.jsx("span",{className:"animate-pulse",children:"Typing..."})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${F.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-xs ${F.isConnected?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:F.isConnected?"Connected":"Offline"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>I(!0),onKeyDown:r(()=>I(!0)),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Open speech settings",title:"Speech settings",children:e.jsx(fr,{size:20})}),e.jsx("button",{onClick:S,onKeyDown:r(S),className:`p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${m?"bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}`,"aria-label":`${m?"Disable":"Enable"} audio output`,title:`${m?"Disable":"Enable"} audio output`,children:m?e.jsx(wt,{size:20}):e.jsx(Wn,{size:20})}),e.jsx("button",{onClick:w,onKeyDown:r(w),className:"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Clear conversation",title:"Clear conversation",children:e.jsx(pt,{size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.map(p=>e.jsx("div",{className:`flex ${p.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${p.role==="user"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"}`,children:[e.jsx("p",{className:"text-sm",children:p.content}),e.jsx("p",{className:`text-xs mt-1 opacity-70 ${p.role==="user"?"text-primary-200":"text-gray-500 dark:text-gray-400"}`,children:p.timestamp.toLocaleTimeString()})]})},p.id)),d.isTyping&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"})]})})}),e.jsx("div",{ref:$})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-end space-x-2",children:[G.isAvailable&&e.jsx("button",{onClick:J,onKeyDown:r(J),disabled:o,className:`p-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${G.isListening?"bg-red-600 text-white hover:bg-red-700":"bg-primary-600 text-white hover:bg-primary-700 disabled:bg-gray-400"}`,"aria-label":G.isListening?"Stop voice input":"Start voice input",title:G.isListening?"Stop voice input":"Start voice input",children:G.isListening?e.jsx(vn,{size:20}):e.jsx(pr,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{ref:_,value:a,onChange:p=>n(p.target.value),onKeyPress:L,placeholder:"Type your message here or use voice input...",disabled:o,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-700 min-h-[44px] max-h-[120px]",rows:1,"aria-label":"Message input"})}),e.jsx("button",{onClick:R,onKeyDown:r(R),disabled:!a.trim()||o,className:"p-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Send message",title:"Send message",children:e.jsx(In,{size:20})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[G.isListening&&e.jsxs("span",{className:"flex items-center space-x-1 text-red-600 dark:text-red-400",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Listening..."})]}),G.isVoiceActive&&e.jsxs("span",{className:"flex items-center space-x-1 text-green-600 dark:text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),e.jsx("span",{children:"Voice detected"})]}),G.isAvailable&&e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Voice input available"}),G.error&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Speech error: ",G.error]}),F.error&&e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Connection error: ",F.error]}),m&&e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Audio output enabled"}),F.sessionId&&e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Session: ",F.sessionId.slice(-8)]})]}),e.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"})]})]}),e.jsx(Xi,{config:{language:"en-US",continuous:!0,interimResults:!0,maxAlternatives:2,audioTracks:!0,noiseReduction:!0,echoCancellation:!0},availableVoices:G.availableVoices,selectedVoice:U,onConfigUpdate:p=>G.updateConfig(p),onVoiceSelect:p=>B(p),isOpen:v,onClose:()=>I(!1)})]})},eo=()=>{const{data:r,isLoading:t,error:s,refetch:a}=kr(),{announce:n}=lr();rr.useEffect(()=>{n("System Health page loaded","polite")},[n]);const o=m=>{if(!m)return"Just now";try{const f=new Date(m);return isNaN(f.getTime())?"Just now":f.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},l=m=>{switch(m==null?void 0:m.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},d=m=>{switch(m==null?void 0:m.toLowerCase()){case"healthy":return"âœ…";case"degraded":return"âš ï¸";case"unhealthy":return"âŒ";default:return"â“"}},g=m=>{const f="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(m==null?void 0:m.toLowerCase()){case"healthy":return`${f} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${f} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${f} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${f} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),e.jsxs("button",{type:"button",onClick:()=>a(),disabled:t,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[e.jsx(ce,{className:`w-4 h-4 ${t?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]}),t&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{className:"w-6 h-6 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),s&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-6 h-6 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:s.message||"Unable to retrieve system health status"}),e.jsx("button",{type:"button",onClick:()=>a(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),r&&!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),e.jsxs("div",{className:g(r.status),children:[e.jsx("span",{className:"mr-1",children:d(r.status)}),r.status]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:d(r.status)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("div",{className:`font-medium ${l(r.status)}`,children:r.status})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"â±ï¸"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.totalDuration?`${r.totalDuration}ms`:"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“…"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o(r.timestamp)})]})]})]}),r.checks&&Object.keys(r.checks).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(yt,{className:"w-5 h-5 mr-2"}),"Service Details"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(r.checks).map(([m,f])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:d(f.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:m.replace(/-/g," ")}),f.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:f.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[f.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f.duration,"ms"]}),e.jsx("div",{className:g(f.status),children:f.status})]})]},m))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(vt,{className:"w-5 h-5 mr-2"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},to=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),e.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),so=new Wr({defaultOptions:{queries:{retry:(r,t)=>{if(t&&typeof t=="object"&&"code"in t){const s=t.code;if(s!=null&&s.startsWith("HTTP_4")&&s!=="HTTP_408")return!1}return r<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}});function ro(){return e.jsxs(qr,{client:so,children:[e.jsx(ha,{children:e.jsx(Na,{children:e.jsx(Ma,{children:e.jsx(Kr,{children:e.jsx($a,{children:e.jsxs(Jr,{children:[e.jsx(Oe,{path:"/",element:e.jsxs(He,{requireRoles:[be.ADMIN,be.CONTROL_PANEL],children:[e.jsx(Ca,{}),e.jsx(Yn,{})]})}),e.jsx(Oe,{path:"/upload",element:e.jsx(He,{requireRoles:[be.ADMIN],children:e.jsx(Qn,{})})}),e.jsx(Oe,{path:"/sessions",element:e.jsx(He,{requireRoles:[be.ADMIN],children:e.jsx(ei,{})})}),e.jsx(Oe,{path:"/sessions/:sessionId",element:e.jsx(He,{requireRoles:[be.ADMIN],children:e.jsx(ri,{})})}),e.jsx(Oe,{path:"/predictions",element:e.jsx(He,{requireRoles:[be.ADMIN],children:e.jsx(ai,{})})}),e.jsx(Oe,{path:"/summary",element:e.jsx(He,{requireRoles:[be.ADMIN,be.CONTROL_PANEL],children:e.jsx(di,{})})}),e.jsx(Oe,{path:"/agent-experience",element:e.jsx(He,{requireRoles:[be.ADMIN,be.CONTROL_PANEL],children:e.jsx(Qi,{})})}),e.jsx(Oe,{path:"/health",element:e.jsx(He,{requireRoles:[be.ADMIN],children:e.jsx(eo,{})})}),e.jsx(Oe,{path:"*",element:e.jsx(to,{})})]})})})})})}),!1]})}const er=localStorage.getItem("bh_theme"),ao=window.matchMedia("(prefers-color-scheme: dark)").matches,no=er==="dark"||!er&&ao;no?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");cs.createRoot(document.getElementById("root")).render(e.jsx(rr.StrictMode,{children:e.jsx(ro,{})}));
//# sourceMappingURL=index-77444ebf.js.map
