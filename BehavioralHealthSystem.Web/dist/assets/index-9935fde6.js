var At=Object.defineProperty;var Ct=(r,s,t)=>s in r?At(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var Z=(r,s,t)=>(Ct(r,typeof s!="symbol"?s+"":s,t),t);import{j as e,u as Xs,Q as _t,a as Rt}from"./query-7a13343f.js";import{a as It,r as c,u as qe,N as et,b as We,L as le,c as Mt,R as st,B as Et,d as Dt,e as je}from"./vendor-b4aac61f.js";import{F as $t,t as Us,f as Ft}from"./ffmpeg-c0c62554.js";import{B as Tt,e as Pt}from"./azure-e79d136e.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(i){if(i.ep)return;i.ep=!0;const d=t(i);fetch(i.href,d)}})();var gs={},Os=It;gs.createRoot=Os.createRoot,gs.hydrateRoot=Os.hydrateRoot;let Qe;const Lt=new Uint8Array(16);function Ut(){if(!Qe&&(Qe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qe(Lt)}const de=[];for(let r=0;r<256;++r)de.push((r+256).toString(16).slice(1));function Ot(r,s=0){return de[r[s+0]]+de[r[s+1]]+de[r[s+2]]+de[r[s+3]]+"-"+de[r[s+4]]+de[r[s+5]]+"-"+de[r[s+6]]+de[r[s+7]]+"-"+de[r[s+8]]+de[r[s+9]]+"-"+de[r[s+10]]+de[r[s+11]]+de[r[s+12]]+de[r[s+13]]+de[r[s+14]]+de[r[s+15]]}const zt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zs={randomUUID:zt};function Bt(r,s,t){if(zs.randomUUID&&!s&&!r)return zs.randomUUID();r=r||{};const a=r.random||(r.rng||Ut)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,s){t=t||0;for(let i=0;i<16;++i)s[t+i]=a[i];return s}return Ot(a)}const $e={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!1},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},Te={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},Le={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},Ue={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300},ke=()=>{let r=localStorage.getItem(Te.USER_ID);return(!r||r.trim().length===0)&&(r=Bt(),localStorage.setItem(Te.USER_ID,r)),r},Ht=()=>{const r=localStorage.getItem(Te.THEME);return r==="light"||r==="dark"?r:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Bs=r=>{localStorage.setItem(Te.THEME,r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},qt=()=>{const r=localStorage.getItem(Te.PROCESSING_MODE);return r==="true"||r==="false"?r==="true":!1},Wt=r=>{localStorage.setItem(Te.PROCESSING_MODE,r.toString())},Oe=r=>{const s=new Date,t=new Date(r),a=s.getTime()-t.getTime(),i=Math.floor(a/(1e3*60)),d=Math.floor(a/(1e3*60*60)),h=Math.floor(a/(1e3*60*60*24));return i<1?"Just now":i<60?`${i}m ago`:d<24?`${d}h ago`:h<7?`${h}d ago`:t.toLocaleDateString()},Fe=r=>new Date(r).toLocaleString(),he=(r,s,t)=>({code:r,message:s,details:t,timestamp:new Date().toISOString()}),Vt=r=>r instanceof TypeError&&r.message.includes("fetch")?!0:r instanceof Error?r.message.includes("Network")||r.message.includes("connection")||r.message.includes("timeout"):!1,Gt=(r,s="polite")=>{const t=document.createElement("div");t.setAttribute("aria-live",s),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=r,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)},Yt=(r,s=100)=>{setTimeout(()=>{const t=document.getElementById(r);t&&t.focus()},s)},tt=c.createContext(void 0),Kt=()=>{const r=c.useContext(tt);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},Jt=({children:r})=>{const[s,t]=c.useState(Ht),a=h=>{t(h),Bs(h)},i=()=>{a(s==="light"?"dark":"light")};c.useEffect(()=>{Bs(s)},[s]),c.useEffect(()=>{const h=window.matchMedia("(prefers-color-scheme: dark)"),u=f=>{localStorage.getItem("bh_theme")||t(f.matches?"dark":"light")};return h.addEventListener("change",u),()=>h.removeEventListener("change",u)},[]);const d={theme:s,toggleTheme:i,setTheme:a};return e.jsx(tt.Provider,{value:d,children:r})};/*! @azure/msal-common v15.12.0 2025-08-19 */const ue={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"};/*! @azure/msal-common v15.12.0 2025-08-19 */class fs extends Error{constructor(s,t,a){const i=t?`${s}: ${t}`:s;super(i),Object.setPrototypeOf(this,fs.prototype),this.errorCode=s||ue.EMPTY_STRING,this.errorMessage=t||ue.EMPTY_STRING,this.subError=a||ue.EMPTY_STRING,this.name="AuthError"}setCorrelationId(s){this.correlationId=s}}/*! @azure/msal-common v15.12.0 2025-08-19 */var me;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Verbose=3]="Verbose",r[r.Trace=4]="Trace"})(me||(me={}));class rs{constructor(s,t,a){this.level=me.Info;const i=()=>{},d=s||rs.createDefaultLoggerOptions();this.localCallback=d.loggerCallback||i,this.piiLoggingEnabled=d.piiLoggingEnabled||!1,this.level=typeof d.logLevel=="number"?d.logLevel:me.Info,this.correlationId=d.correlationId||ue.EMPTY_STRING,this.packageName=t||ue.EMPTY_STRING,this.packageVersion=a||ue.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:me.Info}}clone(s,t,a){return new rs({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:a||this.correlationId},s,t)}logMessage(s,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const d=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${me[t.logLevel]} - ${s}`;this.executeCallback(t.logLevel,d,t.containsPii||!1)}executeCallback(s,t,a){this.localCallback&&this.localCallback(s,t,a)}error(s,t){this.logMessage(s,{logLevel:me.Error,containsPii:!1,correlationId:t||ue.EMPTY_STRING})}errorPii(s,t){this.logMessage(s,{logLevel:me.Error,containsPii:!0,correlationId:t||ue.EMPTY_STRING})}warning(s,t){this.logMessage(s,{logLevel:me.Warning,containsPii:!1,correlationId:t||ue.EMPTY_STRING})}warningPii(s,t){this.logMessage(s,{logLevel:me.Warning,containsPii:!0,correlationId:t||ue.EMPTY_STRING})}info(s,t){this.logMessage(s,{logLevel:me.Info,containsPii:!1,correlationId:t||ue.EMPTY_STRING})}infoPii(s,t){this.logMessage(s,{logLevel:me.Info,containsPii:!0,correlationId:t||ue.EMPTY_STRING})}verbose(s,t){this.logMessage(s,{logLevel:me.Verbose,containsPii:!1,correlationId:t||ue.EMPTY_STRING})}verbosePii(s,t){this.logMessage(s,{logLevel:me.Verbose,containsPii:!0,correlationId:t||ue.EMPTY_STRING})}trace(s,t){this.logMessage(s,{logLevel:me.Trace,containsPii:!1,correlationId:t||ue.EMPTY_STRING})}tracePii(s,t){this.logMessage(s,{logLevel:me.Trace,containsPii:!0,correlationId:t||ue.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */var Hs;(function(r){r.Redirect="redirect",r.Popup="popup",r.Silent="silent",r.None="none"})(Hs||(Hs={}));const Qt={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"};/*! @azure/msal-browser v4.23.0 2025-09-17 */const Zt="storage_not_supported",oe="stubbed_public_client_application_called",Xt="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const er={[Zt]:"Given storage configuration option was not supported.",[oe]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[Xt]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class vs extends fs{constructor(s,t){super(s,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,vs.prototype)}}function ce(r){return new vs(r,er[r])}/*! @azure/msal-browser v4.23.0 2025-09-17 */const sr={initialize:()=>Promise.reject(ce(oe)),acquireTokenPopup:()=>Promise.reject(ce(oe)),acquireTokenRedirect:()=>Promise.reject(ce(oe)),acquireTokenSilent:()=>Promise.reject(ce(oe)),acquireTokenByCode:()=>Promise.reject(ce(oe)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(ce(oe)),loginPopup:()=>Promise.reject(ce(oe)),loginRedirect:()=>Promise.reject(ce(oe)),logout:()=>Promise.reject(ce(oe)),logoutRedirect:()=>Promise.reject(ce(oe)),logoutPopup:()=>Promise.reject(ce(oe)),ssoSilent:()=>Promise.reject(ce(oe)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw ce(oe)},getLogger:()=>{throw ce(oe)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw ce(oe)},hydrateCache:()=>Promise.reject(ce(oe)),clearCache:()=>Promise.reject(ce(oe))};/*! @azure/msal-react v3.0.19 2025-08-19 */const tr={instance:sr,inProgress:Qt.None,accounts:[],logger:new rs({})},rt=c.createContext(tr);rt.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */const rr=()=>c.useContext(rt),ar={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},ie={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},at=c.createContext(void 0),Se=()=>{const r=c.useContext(at);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},ir=({children:r})=>e.jsx(e.Fragment,{children:r}),nr=({children:r})=>null,or={id:"mock-user-id",email:"anonymous@localhost",name:"Anonymous User",roles:["Admin"],primaryRole:"Admin",groups:[],preferredUsername:"anonymous"},lr=({children:r})=>{const s={user:or,isAuthenticated:!0,isLoading:!1,error:null,login:async()=>{console.log("Mock login called - no action taken")},logout:async()=>{console.log("Mock logout called - no action taken")},clearError:()=>{console.log("Mock clearError called - no action taken")},hasRole:()=>!0,hasAnyRole:()=>!0,isAdmin:()=>!0,canAccessControlPanel:()=>!0};return e.jsx(at.Provider,{value:s,children:r})};console.log("Authentication mode:","Mock authentication enabled");console.log("VITE_ENABLE_ENTRA_AUTH:","false");const cr=({children:r})=>e.jsx(lr,{children:r}),dr=()=>{const{login:r,isLoading:s,error:t}=Se(),a=()=>{r().catch(console.error)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:e.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:"ðŸ§ "})}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t})}),e.jsx("button",{onClick:a,disabled:s,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),e.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),e.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),e.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},qs=({children:r,fallback:s,redirectTo:t})=>{const a=qe();return e.jsxs(e.Fragment,{children:[e.jsx(ir,{children:r}),e.jsx(nr,{children:s||(t?e.jsx(et,{to:t,state:{from:a},replace:!0}):e.jsx(dr,{}))})]})},mr=({children:r,roles:s,requireAll:t=!1,fallback:a,redirectTo:i})=>{const{hasRole:d,hasAnyRole:h,user:u}=Se(),f=qe();return(t?s.every(y=>d(y)):h(s))?e.jsx(e.Fragment,{children:r}):a?e.jsx(e.Fragment,{children:a}):i?e.jsx(et,{to:i,state:{from:f},replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸš«"}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",s.length>1?"s":"",": ",s.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",u!=null&&u.roles.length&&u.roles.length>1?"s":"",": ",(u==null?void 0:u.roles.join(", "))||"None"]})]})]})})},Ne=({children:r,requireAuth:s=!0,requireRoles:t=[],requireAll:a=!1,fallback:i,redirectTo:d})=>!s&&t.length===0?e.jsx(e.Fragment,{children:r}):s&&t.length===0?e.jsx(qs,{fallback:i,redirectTo:d,children:r}):e.jsx(qs,{fallback:i,redirectTo:d,children:e.jsx(mr,{roles:t,requireAll:a,fallback:i,redirectTo:d,children:r})}),ur=()=>{const r=We(),s=qe(),{user:t,isAuthenticated:a,isLoading:i,hasRole:d}=Se();return c.useEffect(()=>{if(i||!a||!t||s.pathname!=="/")return;let h="/";d(ie.CONTROL_PANEL)&&!d(ie.ADMIN)?h="/summary":(d(ie.ADMIN),h="/"),h!==s.pathname&&r(h,{replace:!0})},[t,a,i,s.pathname,r,d]),null};class xr{constructor(s,t){Z(this,"msalInstance");Z(this,"accounts");this.msalInstance=s,this.accounts=t}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...ar,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(s){return console.warn("Failed to acquire access token silently:",s),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const s=this.accounts[0];return{userId:s.homeAccountId,username:s.username,name:s.name}}}const hr=()=>{const{instance:r,accounts:s}=rr();return new xr(r,s)};class gr{constructor(s,t){Z(this,"baseUrl");Z(this,"authProvider");this.baseUrl=s,this.authProvider=t}setAuthProvider(s){this.authProvider=s}async handleResponse(s){if(!s.ok){const t=await s.json().catch(()=>({}));throw he(`HTTP_${s.status}`,t.message||`HTTP ${s.status}: ${s.statusText}`,{status:s.status,statusText:s.statusText,data:t})}return s.json()}async request(s,t={}){try{const a=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,i=s.startsWith("/")?s:`/${s}`,d=`${a}${i}`,h={"Content-Type":"application/json",...t.headers};if(this.authProvider)try{const f=await this.authProvider.getAuthHeaders();Object.assign(h,f)}catch(f){console.warn("Failed to get authentication headers:",f)}const u=await fetch(d,{...t,headers:h});return this.handleResponse(u)}catch(a){throw Vt(a)?he("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:a}):a instanceof Error&&"code"in a?a:he("UNKNOWN_ERROR","An unexpected error occurred",{originalError:a})}}async get(s){return this.request(s,{method:"GET"})}async post(s,t){return this.request(s,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(s,t){return this.request(s,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(s){return this.request(s,{method:"DELETE"})}}const xe=new gr($e.api.baseUrl),pr=r=>{xe.setAuthProvider(r)},te={async checkHealth(){return xe.get(Le.HEALTH)},async initiateSession(r){return xe.post(Le.SESSIONS_INITIATE,r)},async submitPrediction(r){return xe.post(Le.PREDICTIONS_SUBMIT,r)},async getPredictionBySessionId(r){return xe.get(`${Le.PREDICTIONS_BY_SESSION}/${r}`)},async getUserPredictions(r){return xe.get(`${Le.PREDICTIONS_BY_USER}/${r}`)},async saveSessionData(r){return xe.post("sessions",r)},async getSessionData(r){return xe.get(`sessions/${r}`)},async getUserSessions(r){return xe.get(`sessions/users/${r}`)},async getAllSessions(){return xe.get("sessions/all")},async updateSessionData(r,s){return xe.put(`sessions/${r}`,s)},async deleteSessionData(r){return xe.delete(`sessions/${r}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(r){return{success:!1,message:r.message||"Connection test failed"}}},async generateRiskAssessment(r){return xe.post(`sessions/${r}/risk-assessment`)},async getRiskAssessment(r){return xe.get(`sessions/${r}/risk-assessment`)},async correctGrammar(r){return xe.post("CorrectGrammar",{text:r})}};class Ws{constructor(s,t={}){Z(this,"sessionId");Z(this,"intervalMs");Z(this,"maxAttempts");Z(this,"backoffFactor");Z(this,"currentAttempt",0);Z(this,"timeoutId",null);Z(this,"isPolling",!1);this.sessionId=s,this.intervalMs=t.intervalMs||$e.polling.intervalMs,this.maxAttempts=t.maxAttempts||$e.polling.maxAttempts,this.backoffFactor=t.backoffFactor||$e.polling.backoffFactor}async start(s,t,a){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const i=async()=>{try{const d=await te.getPredictionBySessionId(this.sessionId);if(s(d),d.status==="succeeded"||d.status==="success"||d.status==="failed"){this.stop(),t(d);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),a(he("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const h=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(i,h)}catch(d){this.stop(),a(d)}};await i()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const yr=({children:r})=>{const s=hr();return c.useEffect(()=>{pr(s)},[s]),e.jsx(e.Fragment,{children:r})},it=()=>{const r=c.useCallback((a,i="polite")=>{Gt(a,i)},[]),s=c.useCallback(a=>{r(a,"assertive")},[r]),t=c.useCallback(a=>{r(a,"polite")},[r]);return{announce:r,announceError:s,announceSuccess:t}},br=()=>{const r=c.useCallback(t=>{const a=i=>{i.key==="Escape"&&(i.preventDefault(),t())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),s=c.useCallback(t=>a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t())},[]);return{handleEscape:r,handleEnterSpace:s}},fr=()=>({skipToMain:c.useCallback(()=>{Yt(Ue.SKIP_TO_CONTENT_ID,Ue.FOCUS_TIMEOUT)},[])}),vr=({className:r=""})=>{const{theme:s,toggleTheme:t}=Kt(),{user:a,logout:i,isAuthenticated:d,isAdmin:h}=Se(),u=qe(),{handleEnterSpace:f}=br(),[v,y]=c.useState(!1),[j,R]=c.useState(!1),q=!1,_=()=>[{path:"/",label:"Dashboard",icon:"ðŸ ",roles:[ie.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"ðŸ“¤",roles:[ie.ADMIN]},{path:"/sessions",label:"Sessions",icon:"ðŸ“Š",roles:[ie.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"ðŸ“ˆ",roles:[ie.ADMIN]}];c.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:d,user:a?{id:a.id,name:a.name,roles:a.roles}:null,timestamp:new Date().toISOString()})},[d,a]);const F=_(),b=K=>K==="/"?u.pathname==="/":u.pathname.startsWith(K),T=()=>{y(!v)},D=()=>{y(!1)};return c.useEffect(()=>{y(!1),R(!1)},[u.pathname]),c.useEffect(()=>{const K=C=>{const w=C.target;j&&!w.closest("[data-user-menu]")&&R(!1)};return document.addEventListener("mousedown",K),()=>document.removeEventListener("mousedown",K)},[j]),e.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${r}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(le,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[e.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:"ðŸ§ "}),e.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),e.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),e.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:F.map(({path:K,label:C,icon:w})=>e.jsxs(le,{to:K,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${b(K)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":b(K)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:w}),e.jsx("span",{children:C})]},K))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative","data-user-menu":!0,children:[e.jsxs("div",{className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-400 cursor-not-allowed opacity-50\r
                    dark:text-gray-500 transition-colors touch-target\r
                  `,"aria-label":"User authentication disabled",title:"Authentication is disabled",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-medium",children:"?"}),e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Auth Disabled"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),q]}),e.jsx("button",{onClick:t,onKeyDown:f(t),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${s==="light"?"dark":"light"} mode`,type:"button",children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:s==="light"?"ðŸŒ™":"â˜€ï¸"})}),F.length>0&&e.jsx("button",{onClick:T,onKeyDown:f(T),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":v?"Close mobile menu":"Open mobile menu",type:"button",...v?{"aria-expanded":!0}:{"aria-expanded":!1},children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:v?"âœ•":"â˜°"})})]})]}),v&&F.length>0&&e.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:e.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:F.map(({path:K,label:C,icon:w})=>e.jsxs(le,{to:K,onClick:D,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${b(K)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":b(K)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:w}),e.jsx("span",{children:C})]},K))})})]})})},jr=({size:r=20,className:s="",...t})=>e.jsxs("svg",{width:r,height:r,viewBox:"0 0 23 23",className:s,"aria-label":"Microsoft",...t,children:[e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),e.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),e.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),e.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),Nr=({children:r,className:s=""})=>{const{skipToMain:t}=fr();return e.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[e.jsx("a",{href:`#${Ue.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:a=>{a.preventDefault(),t()},children:"Skip to main content"}),e.jsx(vr,{}),e.jsx("main",{id:Ue.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${s}`,tabIndex:-1,children:r}),e.jsx("div",{id:Ue.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),e.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(jr,{size:24,className:"opacity-80"}),e.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),e.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[e.jsxs("p",{children:["Behavioral Health System Â© ",new Date().getFullYear()]}),e.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant â€¢ Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wr=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,t,a)=>a?a.toUpperCase():t.toLowerCase()),Vs=r=>{const s=wr(r);return s.charAt(0).toUpperCase()+s.slice(1)},nt=(...r)=>r.filter((s,t,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===t).join(" ").trim(),Sr=r=>{for(const s in r)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ar={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=c.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:i="",children:d,iconNode:h,...u},f)=>c.createElement("svg",{ref:f,...Ar,width:s,height:s,stroke:r,strokeWidth:a?Number(t)*24/Number(s):t,className:nt("lucide",i),...!d&&!Sr(u)&&{"aria-hidden":"true"},...u},[...h.map(([v,y])=>c.createElement(v,y)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=(r,s)=>{const t=c.forwardRef(({className:a,...i},d)=>c.createElement(Cr,{ref:d,iconNode:s,className:nt(`lucide-${kr(Vs(r))}`,`lucide-${r}`,a),...i}));return t.displayName=Vs(r),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ze=V("activity",_r);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ir=V("arrow-left",Rr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Er=V("arrow-right",Mr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],we=V("brain",Dr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ot=V("calendar",$r);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Gs=V("chart-column",Fr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Pr=V("chart-pie",Tr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],lt=V("chevron-down",Lr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ct=V("chevron-up",Ur);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],fe=V("circle-alert",Or);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ge=V("circle-check-big",zr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],as=V("circle-x",Br);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],_e=V("clock",Hr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],is=V("download",qr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Vr=V("eye-off",Wr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Be=V("eye",Gr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Kr=V("file-audio",Yr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Qr=V("file-text",Jr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Xr=V("file",Zr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],sa=V("files",ea);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],dt=V("funnel",ta);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],mt=V("heart",ra);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],He=V("info",aa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],na=V("lightbulb",ia);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ys=V("loader-circle",oa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ca=V("message-circle",la);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ma=V("mic",da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ps=V("pause",ua);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ha=V("phone",xa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ee=V("play",ga);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ks=V("plus",pa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],re=V("refresh-cw",ya);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],fa=V("search",ba);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ja=V("settings",va);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ys=V("shield-alert",Na);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],wa=V("target",ka);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ts=V("trash-2",Sa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ut=V("trending-down",Aa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],os=V("trending-up",Ca);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],js=V("triangle-alert",_a);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ra=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ia=V("upload",Ra);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],cs=V("user",Ma);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],xt=V("users",Ea);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],ns=V("volume-2",Da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Fa=V("volume-x",$a);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],De=V("x",Ta),ht={health:["health"],userPredictions:r=>["predictions","user",r],sessionPrediction:r=>["predictions","session",r],userSessions:r=>["sessions","user",r]},gt=()=>Xs({queryKey:ht.health,queryFn:()=>te.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),Pa=r=>{const s=r||ke();return Xs({queryKey:ht.userSessions(s),queryFn:()=>te.getUserSessions(s),enabled:!!s,staleTime:3e4,refetchOnWindowFocus:!1})},La=()=>{const{announce:r}=it(),{canAccessControlPanel:s,user:t}=Se(),a=()=>(t==null?void 0:t.id)||ke(),{data:i,isLoading:d,error:h}=gt(),{data:u,isLoading:f}=Pa(a());c.useEffect(()=>{r("Dashboard page loaded","polite")},[r]);const v=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"ðŸ“¤",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"ðŸ“Š",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"ðŸ“ˆ",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"ðŸ¤–",color:"warning",disabled:!1},{title:"Speech Avatar Experience",description:"Real-time voice interaction with AI behavioral health agents using Azure Speech Avatar",href:"/speech-avatar-experience",icon:"ðŸŽ™ï¸",color:"accent",disabled:!1}],y=(j,R=!1)=>{const q=R?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(j){case"primary":return`${q} border-primary-200 bg-primary-50 ${!R&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!R&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${q} border-secondary-200 bg-secondary-50 ${!R&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!R&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${q} border-accent-200 bg-accent-50 ${!R&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!R&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${q} border-warning-200 bg-warning-50 ${!R&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!R&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${q} border-gray-200 bg-gray-50 ${!R&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!R&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:v.map(j=>j.disabled?e.jsxs("div",{className:`${y(j.color,!0)} relative`,"aria-label":`${j.title}: Coming Soon`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:j.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:j.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:j.description})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-bold text-sm mb-1",children:"ðŸš§"}),e.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},j.href):e.jsx(le,{to:j.href,className:y(j.color,!1),"aria-label":`${j.title}: ${j.description}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:j.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:j.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:j.description})]})},j.href))})]}),s()&&e.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),e.jsx(le,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),e.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),f?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(u!=null&&u.sessions)||u.sessions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:"ðŸ“­"}),e.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",e.jsx(le,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):e.jsxs("div",{className:"space-y-3",children:[u.sessions.sort((j,R)=>new Date(R.createdAt).getTime()-new Date(j.createdAt).getTime()).slice(0,3).map(j=>{var R,q;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`status-${j.status||"completed"}`,children:j.status||"completed"}),e.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:j.audioFileName||((R=j.sessionId)==null?void 0:R.slice(0,8))||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:j.createdAt,children:j.createdAt?new Date(j.createdAt).toLocaleString():""})]}),e.jsx(le,{to:`/sessions/${j.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${j.audioFileName||((q=j.sessionId)==null?void 0:q.slice(0,8))||"Unknown"}`,children:e.jsx(Be,{className:"w-4 h-4","aria-hidden":"true"})})]},j.sessionId)}),u.sessions.length>3&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(le,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",u.sessions.length," sessions â†’"]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),e.jsx(le,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),d?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):h?e.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[e.jsx("span",{role:"img","aria-label":"Error",children:"âš ï¸"}),e.jsx("span",{children:"System health check failed"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[e.jsx("span",{role:"img","aria-label":"Healthy",children:"âœ…"}),e.jsx("span",{children:"All systems operational"}),(i==null?void 0:i.checks)&&e.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(i.checks).length," services checked)"]})]})]})]})};class Ua{constructor(){Z(this,"ffmpeg",null);Z(this,"isLoaded",!1);Z(this,"loadingPromise",null);this.ffmpeg=new $t}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw he("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const s="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await Us(`${s}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Us(`${s}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(s){throw this.loadingPromise=null,he("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:s})}}async convertAudio(s,t={outputFormat:"wav",sampleRate:44100,channels:1},a){try{if(a==null||a({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw he("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:y})=>{a==null||a({stage:"converting",progress:Math.round(y*100),message:`Converting audio... ${Math.round(y*100)}%`})}),a==null||a({stage:"converting",progress:0,message:"Preparing audio file..."});const i="input."+this.getFileExtension(s.name);await this.ffmpeg.writeFile(i,await Ft(s));const d=`output.${t.outputFormat}`,h=["-i",i,"-ac",t.channels.toString(),"-ar",t.sampleRate.toString(),"-f",t.outputFormat,d];await this.ffmpeg.exec(h);const u=await this.ffmpeg.readFile(d),f=new Blob([u],{type:`audio/${t.outputFormat}`}),v=new File([f],`${this.getFileNameWithoutExtension(s.name)}.${t.outputFormat}`,{type:`audio/${t.outputFormat}`});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(d),a==null||a({stage:"completed",progress:100,message:"Audio conversion completed"}),v}catch(i){throw he("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:i,fileName:s.name,fileSize:s.size,fileType:s.type})}}getFileExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.slice(t+1).toLowerCase():""}getFileNameWithoutExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.slice(0,t):s}async isFormatSupported(s){try{await this.loadFFmpeg();const t=["wav","mp3","mp4","m4a","aac","flac","ogg"],a=this.getFileExtension(s.name);return t.includes(a)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let ds=null;const Oa=()=>(ds||(ds=new Ua),ds),ms=async(r,s)=>{const a=await Oa().convertAudio(r,{outputFormat:"wav",sampleRate:44100,channels:1},s?i=>s(i.progress):void 0);return new Blob([a],{type:"audio/wav"})};class za{constructor(s){Z(this,"containerClient",null);Z(this,"sasUrl");if(this.sasUrl=s||$e.azure.blobSasUrl,!this.sasUrl)throw he("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const s=new Tt(this.sasUrl);this.containerClient=s.getContainerClient($e.azure.containerName)}catch(s){throw he("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:s})}return this.containerClient}async uploadFile(s,t,a,i){try{a==null||a({progress:0,stage:"preparing",message:"Preparing upload..."});const d=this.getContainerClient();let h;if(i){const v=i;if(t)h=`users/${v}/audio/${t}`;else{const y=new Date().toISOString().replace(/[:.]/g,"-"),j=Math.random().toString(36).substring(2,8),R=s.name.split(".").pop()||"wav";h=`users/${v}/audio/${y}-${j}.${R}`}}else h=t||this.generateBlobName(s.name);const u=d.getBlockBlobClient(h);a==null||a({progress:10,stage:"uploading",message:"Starting upload..."}),await u.uploadData(s,{blobHTTPHeaders:{blobContentType:s.type},onProgress:v=>{const y=v.loadedBytes&&s.size?Math.round(v.loadedBytes/s.size*90)+10:50;a==null||a({progress:y,stage:"uploading",message:`Uploading... ${y}%`})}});const f=u.url;return a==null||a({progress:100,stage:"completed",message:"Upload completed"}),{url:f,fileName:h,size:s.size}}catch(d){throw he("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:d,fileName:s.name,fileSize:s.size})}}generateBlobName(s,t){const a=t||ke(),i=new Date().toISOString().replace(/[:.]/g,"-"),d=Math.random().toString(36).substring(2,8),h=s.split(".").pop()||"wav";return`users/${a}/audio/${i}-${d}.${h}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(s){try{await this.getContainerClient().getBlockBlobClient(s).deleteIfExists()}catch(t){throw he("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:t,fileName:s})}}async listUserFiles(s){try{const t=s||ke(),a=this.getContainerClient(),i=`users/${t}/`,d=[];for await(const h of a.listBlobsFlat({prefix:i}))d.push(h.name);return d}catch(t){throw he("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:t,userId:s})}}async deleteUserData(s){try{const t=s||ke(),a=await this.listUserFiles(t);let i=0;for(const d of a)await this.deleteFile(d),i++;return i}catch(t){throw he("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:t,userId:s})}}async getUserStorageUsage(s){try{const t=s||ke(),a=this.getContainerClient(),i=`users/${t}/`;let d=0,h=0;for await(const u of a.listBlobsFlat({prefix:i}))d++,h+=u.properties.contentLength||0;return{fileCount:d,totalSizeBytes:h}}catch(t){throw he("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:t,userId:s})}}}let Ze=null;const Ba=r=>((!Ze||r&&r!==Ze.sasUrl)&&(Ze=new za(r)),Ze),us=async(r,s,t,a)=>{const i=Ba(),d=r instanceof File?r:new File([r],s,{type:r.type});return(await i.uploadFile(d,s,t?u=>t(u.progress):void 0,a)).url},Pe=()=>{const r=c.useRef(null),s=c.useCallback(u=>{if(!r.current){const f=document.createElement("div");f.setAttribute("aria-live","polite"),f.setAttribute("aria-atomic","true"),f.style.position="absolute",f.style.left="-10000px",f.style.width="1px",f.style.height="1px",f.style.overflow="hidden",document.body.appendChild(f),r.current=f}r.current.textContent="",setTimeout(()=>{r.current&&(r.current.textContent=u)},100)},[]),t={focusById:u=>{const f=document.getElementById(u);f&&f.focus()},focusFirstInContainer:u=>{const v=u.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];v&&v.focus()},trapFocus:u=>{const f=u.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),v=f[0],y=f[f.length-1],j=R=>{R.key==="Tab"&&(R.shiftKey?document.activeElement===v&&(y.focus(),R.preventDefault()):document.activeElement===y&&(v.focus(),R.preventDefault()))};return u.addEventListener("keydown",j),()=>{u.removeEventListener("keydown",j)}}},a={handleArrowNavigation:(u,f,v,y)=>{var R;let j=v;switch(u.key){case"ArrowDown":u.preventDefault(),j=v<f.length-1?v+1:0;break;case"ArrowUp":u.preventDefault(),j=v>0?v-1:f.length-1;break;case"Home":u.preventDefault(),j=0;break;case"End":u.preventDefault(),j=f.length-1;break;default:return}y(j),(R=f[j])==null||R.focus()},handleEscape:(u,f)=>{u.key==="Escape"&&(u.preventDefault(),f())}},i=c.useCallback((u="element")=>`${u}-${Math.random().toString(36).substr(2,9)}`,[]),d=c.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),h=c.useCallback((u,f,v)=>{const y={};return u||(y["aria-invalid"]="true",f&&v&&(y["aria-describedby"]=v)),y},[]);return{announceToScreenReader:s,focusManagement:t,keyboardNavigation:a,generateId:i,prefersReducedMotion:d,getValidationAttributes:h}},Ha=()=>{var _s,Rs,Is,Ms,Es,Ds,$s,Fs,Ts,Ps,Ls;const{user:r}=Se(),s=qe(),[t,a]=c.useState([]),[i,d]=c.useState(()=>qt()),[h,u]=c.useState({}),[f,v]=c.useState({}),[y,j]=c.useState({}),[R,q]=c.useState(!1),[_,F]=c.useState(null),[b,T]=c.useState({stage:"idle",progress:0,message:""}),[D,K]=c.useState(null),[C,w]=c.useState(!1),[$,J]=c.useState(0),[S,g]=c.useState(null),n=s.state,[l,m]=c.useState({userId:"",age:((Rs=(_s=n==null?void 0:n.userMetadata)==null?void 0:_s.age)==null?void 0:Rs.toString())||"",gender:((Is=n==null?void 0:n.userMetadata)==null?void 0:Is.gender)||"",race:((Ms=n==null?void 0:n.userMetadata)==null?void 0:Ms.race)||"",ethnicity:((Es=n==null?void 0:n.userMetadata)==null?void 0:Es.ethnicity)||"",language:(($s=(Ds=n==null?void 0:n.userMetadata)==null?void 0:Ds.language)==null?void 0:$s.toString())||"",weight:((Ts=(Fs=n==null?void 0:n.userMetadata)==null?void 0:Fs.weight)==null?void 0:Ts.toString())||"",zipcode:((Ps=n==null?void 0:n.userMetadata)==null?void 0:Ps.zipcode)||"",sessionNotes:((Ls=n==null?void 0:n.userMetadata)==null?void 0:Ls.sessionNotes)||""}),[p,N]=c.useState(null),[I,U]=c.useState([]),[B,O]=c.useState({}),[Q,H]=c.useState(!1);c.useEffect(()=>{if(!l.userId){const o=`user-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;m(x=>({...x,userId:o}))}},[l.userId]);const G=c.useCallback(()=>(r==null?void 0:r.id)||ke(),[r==null?void 0:r.id]),A=c.useRef(null),ae=c.useRef(null),{announceToScreenReader:ee}=Pe(),Y=c.useCallback((o,x,k)=>{const M=Date.now().toString()+Math.random().toString(36).substr(2,9),L={id:M,type:o,title:x,message:k,timestamp:Date.now()};U(z=>[...z,L]),setTimeout(()=>{U(z=>z.filter(se=>se.id!==M))},o==="error"?8e3:5e3)},[]),ls=c.useCallback(o=>{U(x=>x.filter(k=>k.id!==o))},[]);c.useEffect(()=>{if(n&&(Y("info","Session Data Pre-filled",`Metadata and audio file from session ${n.originalSessionId?n.originalSessionId.slice(0,8)+"...":""} have been loaded. Click "Start Analysis" to begin processing.`),n.audioUrl&&n.audioFileName)){const o={name:n.audioFileName,size:0,type:"audio/wav",lastModified:Date.now(),stream:()=>new ReadableStream,arrayBuffer:()=>Promise.resolve(new ArrayBuffer(0)),text:()=>Promise.resolve(""),slice:()=>new Blob},x={id:`prefilled-${Date.now()}`,file:o,url:n.audioUrl,duration:void 0};i?a([x]):F(x)}},[n,Y,i]);const Ae=c.useCallback(()=>{a([]),F(null),T({stage:"idle",progress:0,message:""}),K(null),v({}),u({}),N(null),w(!1),J(0),g(null),q(!1)},[]),Ve=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),Re=c.useCallback(o=>{const x=Ve(),k=URL.createObjectURL(o),M={id:x,file:o,url:k};i?(a(E=>[...E,M]),j(E=>({...E,[x]:"ready"})),u(E=>({...E,[x]:{stage:"idle",progress:0,message:"Ready to process"}}))):F(M),ee(`Audio file selected: ${o.name}`);const L=new Audio(k);L.addEventListener("loadedmetadata",()=>{i?a(E=>E.map(z=>z.id===x?{...z,duration:L.duration}:z)):F(E=>E?{...E,duration:L.duration}:null)})},[i,ee]),pt=c.useCallback(o=>{i&&(a(x=>{const k=x.find(M=>M.id===o);return k&&URL.revokeObjectURL(k.url),x.filter(M=>M.id!==o)}),u(x=>{const{[o]:k,...M}=x;return M}),v(x=>{const{[o]:k,...M}=x;return M}),j(x=>{const{[o]:k,...M}=x;return M}))},[i]),Ge=c.useCallback(o=>{const x=o.target.files;!x||x.length===0||Array.from(x).forEach(k=>{const M=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],L=k.name.toLowerCase(),z=[".wav",".mp3",".m4a",".aac",".flac"].some(ne=>L.endsWith(ne));if(!M.includes(k.type)&&!z){N(`Unsupported file type for ${k.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),Y("error","Unsupported File",`${k.name} is not a supported audio file format`),ee(`Error: Unsupported file format selected for ${k.name}`);return}const ye=50*1024*1024;if(k.size>ye){N(`File ${k.name} is too large. File size must be less than 50MB`),Y("error","File Too Large",`${k.name} size must be less than 50MB`),ee(`Error: File ${k.name} is too large`);return}Re(k),N(null)})},[ee,Re,Y]),yt=c.useCallback(o=>{o.preventDefault()},[]),bt=c.useCallback(o=>{o.preventDefault();const x=o.dataTransfer.files;x.length>0&&Ge({target:{files:x}})},[Ge]),ft=c.useCallback(()=>{d(o=>{const x=!o;return Wt(x),Ae(),x})},[Ae]),vt=c.useCallback(()=>{A.current&&(C?(A.current.pause(),w(!1),ee("Audio paused")):(A.current.play(),w(!0),ee("Audio playing")))},[C,ee]),jt=c.useCallback(()=>{A.current&&J(A.current.currentTime)},[]),Ye=c.useCallback(o=>{const x=Math.floor(o/60),k=Math.floor(o%60);return`${x}:${k.toString().padStart(2,"0")}`},[]),Ie=c.useCallback(()=>{const o=[];if(l.age){const x=parseInt(l.age);(isNaN(x)||x<18||x>130)&&o.push("Age must be between 18 and 130")}if(l.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(l.gender)||o.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),l.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(l.race)||o.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),l.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(l.ethnicity)||o.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),l.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(l.zipcode)||o.push("Zipcode must be alphanumeric and contain no more than 10 characters")),l.weight){const x=parseInt(l.weight);(isNaN(x)||x<10||x>1e3)&&o.push("Weight must be between 10 and 1000 pounds (lbs)")}return o},[l]),Ns=c.useCallback(o=>{if(!o)return;const x=parseInt(o);if(isNaN(x)||x<18||x>130)return"Age must be between 18 and 130"},[]),ks=c.useCallback(o=>{if(!o)return;const x=parseInt(o);if(isNaN(x)||x<10||x>1e3)return"Weight must be between 10 and 1000 pounds (lbs)"},[]),ws=c.useCallback(o=>{if(!o)return;if(!/^[a-zA-Z0-9]{1,10}$/.test(o))return"Zipcode must be alphanumeric and contain no more than 10 characters"},[]),Ss=c.useCallback(o=>{if(o&&o.length>500)return"Session notes must be 500 characters or less"},[]),ve=c.useCallback((o,x)=>{let k;switch(o){case"age":k=Ns(x);break;case"weight":k=ks(x);break;case"zipcode":k=ws(x);break;case"sessionNotes":k=Ss(x);break;default:return}O(M=>{const L={...M,[o]:k};return Object.values(L).some(z=>z!==void 0)?k===void 0&&N(z=>z&&z.toLowerCase().includes("validation")?null:z):N(null),L})},[Ns,ks,ws,Ss]),Nt=c.useCallback(async()=>{if(l.sessionNotes.trim()){H(!0);try{const o=await te.correctGrammar(l.sessionNotes);m(x=>({...x,sessionNotes:o.correctedText})),Y("success","Grammar Corrected","Grammar and spelling corrected successfully")}catch(o){console.error("Grammar correction failed:",o),Y("error","Grammar Correction Failed",o.message||"Failed to correct grammar. Please try again.")}finally{H(!1)}}},[l.sessionNotes]),Ke=c.useCallback(()=>{const o={};let x=!1;return l.age&&(o.age=parseInt(l.age),x=!0),l.gender&&(o.gender=l.gender,x=!0),l.race&&(o.race=l.race,x=!0),l.ethnicity&&(o.ethnicity=l.ethnicity,x=!0),(l.language==="true"||l.language==="false")&&(o.language=l.language==="true",x=!0),l.weight&&(o.weight=parseInt(l.weight),x=!0),l.zipcode&&(o.zipcode=l.zipcode,x=!0),x?o:void 0},[l]),kt=c.useCallback(async()=>{if(i){if(t.length===0||!l.userId.trim()){N("Please select audio files. User ID is automatically generated."),Y("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await As()}else{if(!_||!l.userId.trim()){N("Please select an audio file. User ID is automatically generated."),Y("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await St()}},[_,t,l.userId,i]),Je=c.useCallback(async(o,x)=>{try{u(X=>({...X,[o]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const k=Ke(),M={userid:l.userId.trim(),is_initiated:!0};k&&(M.metadata=k);const L=await te.initiateSession(M),E={sessionId:L.sessionId,userId:l.userId.trim()};u(X=>({...X,[o]:{stage:"initiating",progress:10,message:"Saving session data...",sessionId:L.sessionId}}));const z={sessionId:L.sessionId,userId:G(),metadata_user_id:l.userId.trim(),...k&&{userMetadata:k},audioFileName:x.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (multi-file):",z);const X=await te.saveSessionData(z);console.log("Session data saved successfully (multi-file):",X)}catch(X){console.error("Failed to save session data (multi-file):",X),console.error("Session data that failed to save:",z),Y("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let se,ye;if(x.url&&!x.url.startsWith("blob:"))u(X=>({...X,[o]:{stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}})),se=x.url,ye=x.file.name,u(X=>({...X,[o]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));else{u(P=>({...P,[o]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const X=await ms(x.file,P=>{u(W=>({...W,[o]:{stage:"converting",progress:15+P*.25,message:`Converting audio... ${Math.round(P)}%`}}))});u(P=>({...P,[o]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}})),ye=`${l.userId}_${E.sessionId}_${Date.now()}.wav`,se=await us(X,ye,P=>{u(W=>({...W,[o]:{stage:"uploading",progress:40+P*.25,message:`Uploading... ${Math.round(P)}%`}}))},G())}u(X=>({...X,[o]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const X={...z,audioUrl:se,audioFileName:ye,status:"processing",updatedAt:new Date().toISOString()};await te.updateSessionData(E.sessionId,X)}catch(X){console.warn("Failed to update session data with audio info:",X)}await te.submitPrediction({userId:l.userId.trim(),sessionid:E.sessionId,audioFileUrl:se,audioFileName:ye}),u(X=>({...X,[o]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const ne=new Ws(E.sessionId);await new Promise((X,P)=>{ne.start(W=>{const Me=W.status==="processing"?80:W.status==="success"?95:70;u(be=>({...be,[o]:{stage:"analyzing",progress:Me,message:`Analysis ${W.status}...`}})),W.predictError&&Y("error","Prediction Error",`${W.predictError.error}: ${W.predictError.message}`)},W=>{if(W.predictError){Y("error","Analysis Failed",`The analysis completed with an error: ${W.predictError.error} - ${W.predictError.message}`),u(pe=>({...pe,[o]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),P(new Error(`Prediction error: ${W.predictError.error}`));return}const Me={sessionId:E.sessionId,depressionScore:W.predictedScoreDepression?parseFloat(W.predictedScoreDepression):0,riskLevel:W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.7?"high":W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",W.predictedScoreDepression?`Depression score: ${W.predictedScoreDepression}`:"",W.predictedScoreAnxiety?`Anxiety score: ${W.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(pe=>pe.trim()!==""),timestamp:W.updatedAt,audioUrl:se,rawApiResponse:W},be={...z,audioUrl:se,prediction:W,analysisResults:{depressionScore:W.predictedScoreDepression?parseFloat(W.predictedScoreDepression):void 0,anxietyScore:W.predictedScoreAnxiety?parseFloat(W.predictedScoreAnxiety):void 0,riskLevel:W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.7?"high":W.predictedScoreDepression&&parseFloat(W.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",W.predictedScoreDepression?`Depression score: ${W.predictedScoreDepression}`:"",W.predictedScoreAnxiety?`Anxiety score: ${W.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(pe=>pe.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};te.saveSessionData(be).then(pe=>{console.log("Multi-file session data saved with analysis results for session:",E.sessionId),console.log("Save result:",pe),Y("success","Session Saved","Analysis results have been saved to session storage.")}).catch(pe=>{console.error("Failed to save multi-file analysis results to session storage:",pe),console.error("Session data that failed to save:",be),Y("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),u(pe=>({...pe,[o]:{stage:"complete",progress:100,message:"Analysis complete!"}})),v(pe=>({...pe,[o]:Me})),X()},W=>{P(W)})})}catch(k){console.error(`Error processing file ${o}:`,k);let M="UNKNOWN_ERROR",L="An unexpected error occurred",E={};k&&typeof k=="object"?("code"in k&&typeof k.code=="string"&&(M=k.code),"message"in k&&typeof k.message=="string"&&(L=k.message),"details"in k&&typeof k.details=="object"&&(E=k.details)):k instanceof Error&&(L=k.message,M=k.name||"ERROR");try{const z=h[o];if(z&&z.sessionId){const se={sessionId:z.sessionId,userId:G(),metadata_user_id:l.userId.trim(),audioFileName:x.file.name,createdAt:new Date().toISOString(),status:"failed",updatedAt:new Date().toISOString(),error:{code:M,message:L,details:E}};await te.updateSessionData(z.sessionId,se),console.log(`Updated session ${z.sessionId} status to failed`)}}catch(z){console.error("Failed to update session status to failed:",z)}try{const z=h[o];if(z&&(z.stage==="uploading"||z.stage==="submitting"||z.stage==="analyzing")){const se=`${l.userId}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${se}`)}}catch(z){console.warn("Error during cleanup attempt:",z)}throw u(z=>({...z,[o]:{stage:"error",progress:0,message:"Processing failed",error:{code:M,message:L,details:E}}})),k}},[l.userId,Ke,te,us,ms,Y]),As=c.useCallback(async()=>{q(!0),N(null);const o=Ie();if(o.length>0){N(`Validation error: ${o.join(", ")}`),Y("error","Validation Error",o.join(", ")),q(!1);return}const x=t.filter(L=>y[L.id]==="ready");if(x.length===0){Y("info","No Files Ready","No files are ready to process"),q(!1);return}const k=x.length;let M=0;try{for(const L of x){M++,Y("info","Processing File",`Processing ${L.file.name} (${M}/${k})`),j(E=>({...E,[L.id]:"processing"}));try{await Je(L.id,L),j(E=>({...E,[L.id]:"complete"})),Y("success","File Complete",`${L.file.name} processed successfully`)}catch(E){let z="FILE_PROCESSING_ERROR",se="An unexpected error occurred",ye={};E&&typeof E=="object"?("code"in E&&typeof E.code=="string"&&(z=E.code),"message"in E&&typeof E.message=="string"&&(se=E.message),"details"in E&&typeof E.details=="object"&&(ye=E.details)):E instanceof Error&&(se=E.message,z=E.name||"ERROR"),Y("error","File Failed",`Failed to process ${L.file.name}: ${se}`),j(ne=>({...ne,[L.id]:"error"})),u(ne=>({...ne,[L.id]:{stage:"error",progress:0,message:`Failed: ${se}`,error:{code:z,message:se,details:ye}}}))}}Y("success","Batch Complete",`Processed ${M} file${M!==1?"s":""}`),ee(`Batch processing complete. ${M} files processed.`)}catch(L){const E=L instanceof Error?L.message:"An unexpected error occurred";N(E),Y("error","Batch Failed",E),ee(`Error: ${E}`)}finally{q(!1)}},[t,y,Ie,Y,ee,Je]),wt=c.useCallback(async o=>{const x=t.find(M=>M.id===o);if(!x)return;const k=Ie();if(k.length>0){N(`Validation error: ${k.join(", ")}`),Y("error","Validation Error",k.join(", "));return}j(M=>({...M,[o]:"processing"}));try{await Je(o,x),j(M=>({...M,[o]:"complete"})),Y("success","File Complete",`${x.file.name} processed successfully`)}catch(M){console.error(`Error processing ${x.file.name}:`,M);const L=M instanceof Error?M.message:"An unexpected error occurred";Y("error","File Failed",`Failed to process ${x.file.name}: ${L}`),j(E=>({...E,[o]:"error"})),u(E=>({...E,[o]:{stage:"error",progress:0,message:`Failed: ${L}`}}))}},[t,Ie,Y,Je]),St=c.useCallback(async()=>{if(!_||!l.userId.trim()){N("Please select an audio file. User ID is automatically generated."),Y("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const o=Ie();if(o.length>0){N(`Validation error: ${o.join(", ")}`),Y("error","Validation Error",o.join(", "));return}try{N(null),T({stage:"initiating",progress:5,message:"Initiating session..."}),ee("Starting analysis process - initiating session");const x=Ke(),k={userid:l.userId.trim(),is_initiated:!0};x&&(k.metadata=x);const M=await te.initiateSession(k),L={sessionId:M.sessionId,userId:l.userId.trim()};T({stage:"initiating",progress:10,message:"Saving session data..."});const E={sessionId:M.sessionId,userId:G(),metadata_user_id:l.userId.trim(),...x&&{userMetadata:x},audioFileName:_.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (single-file):",E);const ne=await te.saveSessionData(E);console.log("Session data saved successfully (single-file):",ne)}catch(ne){console.error("Failed to save session data (single-file):",ne),console.error("Session data that failed to save:",E),Y("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let z,se;if(_.url&&!_.url.startsWith("blob:"))T({stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}),ee("Session created successfully, reusing previously processed audio file"),z=_.url,se=_.file.name,T({stage:"submitting",progress:65,message:"Submitting for analysis..."});else{T({stage:"converting",progress:15,message:"Converting audio to required format..."}),ee("Session created successfully, now converting audio");const ne=await ms(_.file,X=>{T({stage:"converting",progress:15+X*.25,message:`Converting audio... ${Math.round(X)}%`})});T({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),ee("Audio converted successfully, now uploading"),se=`${l.userId}_${L.sessionId}_${Date.now()}.wav`,z=await us(ne,se,X=>{T({stage:"uploading",progress:40+X*.25,message:`Uploading... ${Math.round(X)}%`})},G())}T({stage:"submitting",progress:65,message:"Submitting for analysis..."}),ee("Upload complete, submitting for behavioral health analysis");try{const ne={...E,audioUrl:z,audioFileName:se,status:"processing",updatedAt:new Date().toISOString()};await te.updateSessionData(L.sessionId,ne)}catch(ne){console.warn("Failed to update session data with audio info:",ne)}await te.submitPrediction({userId:l.userId.trim(),sessionid:L.sessionId,audioFileUrl:z,audioFileName:se}),T({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),ee("Prediction submitted, analysis in progress");const ye=new Ws(L.sessionId);await new Promise((ne,X)=>{ye.start(P=>{const W=P.status==="processing"?80:P.status==="success"?95:70;T({stage:"analyzing",progress:W,message:`Analysis ${P.status}...`}),P.predictError&&Y("error","Prediction Error",`${P.predictError.error}: ${P.predictError.message}`)},P=>{if(P.predictError){Y("error","Analysis Failed",`The analysis completed with an error: ${P.predictError.error} - ${P.predictError.message}`),T({stage:"error",progress:0,message:"Analysis failed with errors"}),X(new Error(`Prediction error: ${P.predictError.error}`));return}const W={sessionId:L.sessionId,depressionScore:P.predictedScoreDepression?parseFloat(P.predictedScoreDepression):0,riskLevel:P.predictedScoreDepression&&parseFloat(P.predictedScoreDepression)>.7?"high":P.predictedScoreDepression&&parseFloat(P.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",P.predictedScoreDepression?`Depression score: ${P.predictedScoreDepression}`:"",P.predictedScoreAnxiety?`Anxiety score: ${P.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(be=>be.trim()!==""),timestamp:P.updatedAt,audioUrl:z,rawApiResponse:P},Me={...E,audioUrl:z,prediction:P,analysisResults:{depressionScore:P.predictedScoreDepression?parseFloat(P.predictedScoreDepression):void 0,anxietyScore:P.predictedScoreAnxiety?parseFloat(P.predictedScoreAnxiety):void 0,riskLevel:P.predictedScoreDepression&&parseFloat(P.predictedScoreDepression)>.7?"high":P.predictedScoreDepression&&parseFloat(P.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",P.predictedScoreDepression?`Depression score: ${P.predictedScoreDepression}`:"",P.predictedScoreAnxiety?`Anxiety score: ${P.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(be=>be.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};te.saveSessionData(Me).then(be=>{console.log("Session data saved with analysis results for session:",L.sessionId),console.log("Save result:",be),Y("success","Session Saved","Analysis results have been saved to session storage.")}).catch(be=>{console.error("Failed to save analysis results to session storage:",be),console.error("Session data that failed to save:",Me),Y("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),T({stage:"complete",progress:100,message:"Analysis complete!"}),K(W),Y("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),ee("Behavioral health analysis completed successfully"),ne()},P=>{Y("error","Analysis Error",P.message||"An unexpected error occurred during analysis."),X(P)})})}catch(x){console.error("Processing error:",x);const k=x instanceof Error?x.message:"An unexpected error occurred";N(k),T({stage:"error",progress:0,message:"Processing failed"}),Y("error","Processing Failed",k),ee(`Error: ${k}`)}},[_,l.userId,ee,Ie,Ke]),Cs=c.useCallback(o=>{switch(o){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("button",{type:"button",onClick:ft,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${i?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${i?"single file":"multi-file"} mode`,children:e.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${i?"translate-x-9":"translate-x-1"}`,children:i?e.jsx(sa,{className:"h-3 w-3 text-blue-600"}):e.jsx(Xr,{className:"h-3 w-3 text-gray-600"})})}),e.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[e.jsx("span",{className:`text-sm font-medium ${i?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),e.jsx("span",{className:`text-sm font-medium ${i?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${i?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",i?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),e.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${i?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID (Auto-generated, editable)"}),e.jsx("input",{type:"text",id:"userId",value:l.userId,onChange:o=>m(x=>({...x,userId:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-generated user ID"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for API calls. Auto-generated but can be customized."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsx("input",{type:"number",id:"age",value:l.age,onChange:o=>{const x=o.target.value;m(k=>({...k,age:x})),ve("age",x)},onBlur:o=>ve("age",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&ve("age",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${B.age?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Age in years",min:"1",max:"150","aria-describedby":B.age?"age-error":void 0}),B.age&&e.jsx("p",{id:"age-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:B.age})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsx("input",{type:"number",id:"weight",value:l.weight,onChange:o=>{const x=o.target.value;m(k=>({...k,weight:x})),ve("weight",x)},onBlur:o=>ve("weight",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&ve("weight",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${B.weight?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Weight in lbs",min:"1",max:"1000","aria-describedby":B.weight?"weight-error":void 0}),B.weight&&e.jsx("p",{id:"weight-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:B.weight})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsxs("select",{id:"gender",value:l.gender,onChange:o=>m(x=>({...x,gender:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"non-binary",children:"Non-binary"}),e.jsx("option",{value:"transgender female",children:"Transgender female"}),e.jsx("option",{value:"transgender male",children:"Transgender male"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer",children:"Prefer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsxs("select",{id:"race",value:l.race,onChange:o=>m(x=>({...x,race:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select race"}),e.jsx("option",{value:"white",children:"White"}),e.jsx("option",{value:"black or african-american",children:"Black or African-American"}),e.jsx("option",{value:"asian",children:"Asian"}),e.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),e.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),e.jsx("option",{value:"two or more races",children:"Two or more races"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsxs("select",{id:"ethnicity",value:l.ethnicity,onChange:o=>m(x=>({...x,ethnicity:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select ethnicity"}),e.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),e.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language"}),e.jsxs("select",{id:"language",value:l.language,onChange:o=>m(x=>({...x,language:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select language"}),e.jsx("option",{value:"true",children:"English"}),e.jsx("option",{value:"false",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",id:"zipcode",value:l.zipcode,onChange:o=>{const x=o.target.value;m(k=>({...k,zipcode:x})),ve("zipcode",x)},onBlur:o=>ve("zipcode",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&ve("zipcode",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${B.zipcode?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)","aria-describedby":B.zipcode?"zipcode-error":void 0}),B.zipcode&&e.jsx("p",{id:"zipcode-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:B.zipcode})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("textarea",{id:"sessionNotes",value:l.sessionNotes,onChange:o=>m(x=>({...x,sessionNotes:o.target.value})),onBlur:o=>ve("sessionNotes",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&ve("sessionNotes",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${B.sessionNotes?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,rows:3,placeholder:"Additional notes about this session or patient context","aria-describedby":B.sessionNotes?"sessionNotes-error":void 0}),B.sessionNotes&&e.jsx("p",{id:"sessionNotes-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:B.sessionNotes}),e.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.sessionNotes.length,"/500 characters"]}),e.jsxs("button",{type:"button",onClick:()=>Nt(),disabled:!l.sessionNotes.trim()||Q,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-blue-700 bg-blue-50 border border-blue-200 hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:text-blue-300 dark:bg-blue-900/20 dark:border-blue-700 dark:hover:bg-blue-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Correct grammar and spelling in session notes",title:"Correct grammar and spelling",children:[Q?e.jsx(Ys,{className:"w-3.5 h-3.5 mr-1.5 animate-spin","aria-hidden":"true"}):e.jsx("svg",{className:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),Q?"Correcting...":"Correct Grammar"]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",i&&e.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!i&&!_||i&&t.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:yt,onDrop:bt,children:[e.jsx(Ia,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>{var o;return(o=ae.current)==null?void 0:o.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Select Audio File",i?"s":""]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",i?"files":"file"," here"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",i&&e.jsx("br",{}),i&&"You can select multiple files at once"]}),e.jsx("input",{ref:ae,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ge,multiple:i,"aria-label":`Select audio file${i?"s":""} for analysis`})]}):e.jsxs("div",{className:"space-y-4",children:[!i&&_&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ns,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:_.file.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(_.file.size/1024/1024).toFixed(2)," MB",_.duration&&` â€¢ ${Ye(_.duration)}`]})]})]}),e.jsx("button",{type:"button",onClick:Ae,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:e.jsx(De,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:vt,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":C?"Pause audio":"Play audio",children:C?e.jsx(ps,{className:"h-5 w-5","aria-hidden":"true"}):e.jsx(Ee,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:_.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Ye($)," / ",Ye(_.duration)]})})]}),_.duration&&e.jsx("div",{className:"audio-progress",children:e.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${$/_.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":$,"aria-valuemin":0,"aria-valuemax":_.duration})})]}),e.jsx("audio",{ref:A,src:_.url,onTimeUpdate:jt,onEnded:()=>w(!1),onPlay:()=>w(!0),onPause:()=>w(!1),className:"hidden"})]}),i&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",t.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var o;return(o=ae.current)==null?void 0:o.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(o=>{const x=y[o.id]||"ready",k=h[o.id];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsx(ns,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:o.file.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(o.file.size/1024/1024).toFixed(2)," MB",o.duration&&` â€¢ ${Ye(o.duration)}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[x==="ready"&&e.jsxs("button",{type:"button",onClick:()=>wt(o.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${o.file.name}`,children:[e.jsx(Ee,{className:"h-3 w-3 mr-1"}),"Start"]}),x==="processing"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),x==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Complete"]}),x==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Error"]}),e.jsx("button",{type:"button",onClick:()=>pt(o.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${o.file.name}`,children:e.jsx(ts,{className:"h-4 w-4"})})]})]}),k&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:k.message}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(k.progress),"%"]})]}),e.jsx("div",{className:"processing-progress mt-1",children:e.jsx("div",{className:`processing-progress__fill ${Cs(k.stage)}`,style:{width:`${k.progress}%`}})})]})]},o.id)})}),e.jsx("input",{ref:ae,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ge,multiple:i,"aria-label":"Select additional audio files for analysis"})]})]})]}),p&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:p})]})}),!i&&b.stage!=="idle"&&!D&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:b.message}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(b.progress),"%"]})]}),e.jsx("div",{className:"processing-progress",children:e.jsx("div",{className:`processing-progress__fill progress-animated ${Cs(b.stage)}`,style:{width:`${b.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":b.progress,"aria-valuemin":0,"aria-valuemax":100})}),b.stage==="analyzing"&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Ys,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),D&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ge,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),D.rawApiResponse&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.predicted_score_anxiety||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`font-mono ${D.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:D.rawApiResponse.status||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.model_category||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.model_granularity||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),e.jsx("span",{className:`font-mono ${D.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:D.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),D.rawApiResponse.actual_score&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[D.rawApiResponse.actual_score.depression_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.actual_score.depression_binary||"N/A"})]}),D.rawApiResponse.actual_score.anxiety_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:D.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),D.rawApiResponse.actual_score.phq_9&&D.rawApiResponse.actual_score.phq_9.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",D.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),D.rawApiResponse.actual_score.phq_2&&D.rawApiResponse.actual_score.phq_2.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",D.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),D.rawApiResponse.actual_score.gad_7&&D.rawApiResponse.actual_score.gad_7.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",D.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:D.rawApiResponse.created_at?new Date(D.rawApiResponse.created_at).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:D.rawApiResponse.updated_at?new Date(D.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:D.sessionId})]})})]}),D.rawApiResponse.predict_error&&e.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:D.rawApiResponse.predict_error.error})]}),e.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[e.jsx("span",{className:"font-medium",children:"Message:"})," ",D.rawApiResponse.predict_error.message]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(D.rawApiResponse,null,2)})})]})]})})]}),D.insights&&D.insights.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),e.jsx("ul",{className:"space-y-1",children:D.insights.map((o,x)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["â€¢ ",o]},x))})]}),e.jsx("div",{className:"mt-6 flex space-x-3",children:e.jsx("button",{type:"button",onClick:Ae,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(i&&t.length>0||!i&&_)&&!D&&Object.keys(f).length===0&&b.stage==="idle"&&!R&&e.jsx("div",{className:"text-center",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsxs("button",{type:"button",onClick:As,disabled:t.length===0||!l.userId.trim()||!t.some(o=>y[o.id]==="ready")||!!p||Object.values(B).some(o=>o!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",t.filter(o=>y[o.id]==="ready").length>0&&` (${t.filter(o=>y[o.id]==="ready").length})`]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:kt,disabled:!_||!l.userId.trim()||!!p||Object.values(B).some(o=>o!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),i&&Object.keys(f).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ge,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(f).length," files)"]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(f).map(([o,x])=>{const k=t.find(L=>L.id===o),M=h[o];return e.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(k==null?void 0:k.file.name)||`File ${o}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(M==null?void 0:M.stage)==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Complete"]}),(M==null?void 0:M.stage)==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(M==null?void 0:M.stage)==="error"&&(M==null?void 0:M.error)&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(fe,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:M.error.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:M.error.message})]})]}),M.error.details&&Object.keys(M.error.details).length>0&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),e.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:e.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(M.error.details,null,2)})})]})]})]})]})}),x.rawApiResponse&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.sessionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:x.rawApiResponse.status||"N/A"})]})]})}),e.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(x.rawApiResponse,null,2)})})]})]}),k&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{const L=document.getElementById(`audio-${o}`);L.paused?(document.querySelectorAll("audio").forEach(E=>E.pause()),g(o),L.play()):(L.pause(),g(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":S===o?"Pause audio":"Play audio",children:S===o?e.jsx(ps,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[k.file.name," â€¢ ",k.duration?`${Math.round(k.duration)}s`:"Duration unknown"]})]}),e.jsx("audio",{id:`audio-${o}`,src:k.url,onEnded:()=>g(null),className:"hidden"})]})]},o)})})]}),I.length>0&&e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:I.map(o=>e.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${o.type==="error"?"border-red-500":o.type==="warning"?"border-yellow-500":o.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-shrink-0",children:[o.type==="error"&&e.jsx(fe,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),o.type==="warning"&&e.jsx(fe,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),o.type==="success"&&e.jsx(ge,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),o.type==="info"&&e.jsx(fe,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:o.message})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>ls(o.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:e.jsx(De,{className:"h-4 w-4"})})})]})},o.id))})]})},Xe={queued:{color:"yellow",icon:_e,label:"Queued"},running:{color:"blue",icon:re,label:"Processing"},processing:{color:"blue",icon:re,label:"Processing"},succeeded:{color:"green",icon:ge,label:"Completed"},success:{color:"green",icon:ge,label:"Completed"},completed:{color:"green",icon:ge,label:"Completed"},failed:{color:"red",icon:as,label:"Failed"},error:{color:"red",icon:as,label:"Error"}},es=r=>r?r.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):"â€”",ss=r=>{if(!r)return 0;switch(r.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},qa=()=>{const{user:r}=Se(),s=We(),[t,a]=c.useState([]),[i,d]=c.useState(!0),[h,u]=c.useState(null),[f,v]=c.useState(new Set),[y,j]=c.useState(!1),[R,q]=c.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:_}=Pe(),F=c.useCallback(()=>(r==null?void 0:r.id)||ke(),[r==null?void 0:r.id]),b=c.useCallback(async()=>{try{d(!0),u(null);const n=F(),m=(await te.getUserSessions(n)).sessions.map(p=>{var U,B;const N=p.prediction,I=p.analysisResults;return{...p,uploadedAt:p.createdAt,fileName:p.audioFileName||`Audio_${p.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:(I==null?void 0:I.riskLevel)||"unknown",depressionScore:((U=I==null?void 0:I.depressionScore)==null?void 0:U.toString())||(N==null?void 0:N.predicted_score_depression)||(N==null?void 0:N.predictedScoreDepression)||void 0,anxietyScore:((B=I==null?void 0:I.anxietyScore)==null?void 0:B.toString())||(N==null?void 0:N.predicted_score_anxiety)||(N==null?void 0:N.predictedScoreAnxiety)||void 0}});a(m),_(`${m.length} sessions loaded successfully`)}catch(n){const l=n;u(l),_(`Error loading sessions: ${l.message}`)}finally{d(!1)}},[_]);c.useEffect(()=>{b()},[b]);const T=c.useMemo(()=>{let n=t;if(R.search){const l=R.search.toLowerCase();n=n.filter(m=>{var p,N;return m.sessionId.toLowerCase().includes(l)||((p=m.fileName)==null?void 0:p.toLowerCase().includes(l))||((N=Xe[m.status])==null?void 0:N.label.toLowerCase().includes(l))})}if(R.status!=="all"&&(n=n.filter(l=>l.status===R.status)),R.dateRange!=="all"){const l=new Date,m=new Date;switch(R.dateRange){case"today":m.setHours(0,0,0,0);break;case"week":m.setDate(l.getDate()-7);break;case"month":m.setMonth(l.getMonth()-1);break;case"year":m.setFullYear(l.getFullYear()-1);break}n=n.filter(p=>new Date(p.uploadedAt)>=m)}return n.sort((l,m)=>{let p=0;switch(R.sortBy){case"date":p=new Date(l.uploadedAt).getTime()-new Date(m.uploadedAt).getTime();break;case"status":p=l.status.localeCompare(m.status);break;case"depressionScore":const N=ss(l.depressionScore),I=ss(m.depressionScore);p=N-I;break;case"anxietyScore":const U=ss(l.anxietyScore),B=ss(m.anxietyScore);p=U-B;break}return R.sortOrder==="desc"?-p:p}),n},[t,R]),D=c.useCallback((n,l)=>{q(m=>({...m,[n]:l})),_(`Filter ${n} changed to ${l}`)},[_]),K=c.useCallback(n=>{v(l=>{const m=new Set(l);return m.has(n)?(m.delete(n),_("Session deselected")):(m.add(n),_("Session selected")),m})},[_]),C=c.useCallback(()=>{f.size===T.length?(v(new Set),_("All sessions deselected")):(v(new Set(T.map(l=>l.sessionId))),_(`All ${T.length} sessions selected`))},[f.size,T,_]),w=c.useCallback(async n=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await te.deleteSessionData(n),a(m=>m.filter(p=>p.sessionId!==n)),v(m=>{const p=new Set(m);return p.delete(n),p}),_("Session deleted successfully")}catch(m){const p=m;_(`Error deleting session: ${p.message}`),alert(`Failed to delete session: ${p.message}`)}},[_]),$=c.useCallback(async n=>{if(window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled."))try{const m=t.find(p=>p.sessionId===n);if(!m){_("Cannot re-run analysis: Session not found"),alert("Cannot re-run analysis: Session not found");return}_("Redirecting to upload page for re-run..."),s("/upload",{state:{originalSessionId:m.sessionId,audioFileName:m.audioFileName,audioUrl:m.audioUrl,userMetadata:m.userMetadata}})}catch(m){const p=m;_(`Error preparing re-run: ${p.message}`),alert(`Failed to prepare re-run: ${p.message}`)}},[_,t,s]),J=c.useCallback(async()=>{if(f.size===0||!window.confirm(`Are you sure you want to delete ${f.size} session(s)? This action cannot be undone.`))return;const l=Array.from(f);let m=0,p=[];for(const N of l)try{await te.deleteSessionData(N),m++}catch(I){const U=I;p.push(N),console.error(`Failed to delete session ${N}:`,U.message)}if(m>0&&a(N=>N.filter(I=>!(f.has(I.sessionId)&&!p.includes(I.sessionId)))),v(new Set),p.length===0)_(`${m} sessions deleted successfully`);else{const N=`${m} sessions deleted successfully, ${p.length} failed`;_(N),alert(`${N}. Failed sessions: ${p.join(", ")}`)}},[f,_]),S=n=>{if(n===0)return"0 B";const l=1024,m=["B","KB","MB","GB"],p=Math.floor(Math.log(n)/Math.log(l));return`${parseFloat((n/Math.pow(l,p)).toFixed(1))} ${m[p]}`},g=({status:n})=>{const l=n.toLowerCase();let m=Xe[n];m||(l.includes("error")||l.includes("fail")?m=Xe.error:m=Xe.queued);const p=m.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":m.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":m.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${m.label}`,children:[e.jsx(p,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),m.label]})};return i?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):h?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:h.message}),e.jsx("button",{type:"button",onClick:b,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:b,disabled:i,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsx(le,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),e.jsxs("div",{className:"relative",children:[e.jsx(fa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:R.search,onChange:n=>D("search",n.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),e.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),e.jsxs("button",{type:"button",onClick:()=>j(!y),className:"btn btn--secondary flex items-center","aria-expanded":y,"aria-controls":"filter-panel","aria-label":`${y?"Hide":"Show"} filter options`,children:[e.jsx(dt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",y?e.jsx(ct,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):e.jsx(lt,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),y&&e.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{id:"status-filter",value:R.status,onChange:n=>D("status",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"queued",children:"Queued"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"succeeded",children:"Completed"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-filter",value:R.dateRange,onChange:n=>D("dateRange",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),e.jsxs("select",{id:"sort-by",value:R.sortBy,onChange:n=>D("sortBy",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"depressionScore",children:"Depression Score"}),e.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),e.jsxs("select",{id:"sort-order",value:R.sortOrder,onChange:n=>D("sortOrder",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),T.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[T.length," of ",t.length," sessions",f.size>0&&` â€¢ ${f.size} selected`]})}),f.size>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:J,className:"btn btn--danger","aria-label":`Delete ${f.size} selected sessions`,children:[e.jsx(ts,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),T.length>0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:f.size===T.length,onChange:C,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:T.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:f.has(n.sessionId),onChange:()=>K(n.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${n.sessionId}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.fileName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",n.sessionId.slice(-12)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:S(n.fileSize||0)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(g,{status:n.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:n.depressionScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:es(n.depressionScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:n.anxietyScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:es(n.anxietyScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Oe(n.uploadedAt)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:Fe(n.uploadedAt)})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(le,{to:`/sessions/${n.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${n.sessionId}`,children:e.jsx(Be,{className:"w-4 h-4","aria-hidden":"true"})}),n.status==="succeeded"&&e.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${n.sessionId}`,children:e.jsx(is,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>$(n.sessionId),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`Re-run analysis for session ${n.sessionId}`,children:e.jsx(re,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>w(n.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${n.sessionId}`,children:e.jsx(ts,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},n.sessionId))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4",children:T.map(n=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:f.has(n.sessionId),onChange:()=>K(n.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${n.sessionId}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.fileName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",n.sessionId.slice(-12)]})]})]}),e.jsx(g,{status:n.status})]}),(n.depressionScore||n.anxietyScore)&&e.jsxs("div",{className:"text-sm",children:[n.depressionScore&&e.jsxs("div",{children:["Depression: ",es(n.depressionScore)]}),n.anxietyScore&&e.jsxs("div",{children:["Anxiety: ",es(n.anxietyScore)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:Oe(n.uploadedAt)}),e.jsx("span",{children:S(n.fileSize||0)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs(le,{to:`/sessions/${n.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${n.sessionId}`,children:[e.jsx(Be,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),n.status==="succeeded"&&e.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${n.sessionId}`,children:[e.jsx(is,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),e.jsxs("button",{type:"button",onClick:()=>$(n.sessionId),className:"btn btn--secondary text-xs","aria-label":`Re-run analysis for session ${n.sessionId}`,children:[e.jsx(re,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:()=>w(n.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${n.sessionId}`,children:[e.jsx(ts,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},n.sessionId))})]}):e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:t.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),t.length===0?e.jsx(le,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):e.jsx("button",{type:"button",onClick:()=>q({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},Wa={low:{color:"green",label:"Low Risk",icon:ge,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:js,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:ys,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:ys,description:"Urgent intervention required"}},Va=({sessionId:r,existingAssessment:s,onAssessmentUpdated:t})=>{const{announceToScreenReader:a}=Pe(),[i,d]=c.useState(s||null),[h,u]=c.useState(!1),[f,v]=c.useState(!1),[y,j]=c.useState(null),R=c.useCallback(async()=>{try{u(!0),j(null),a("Generating AI risk assessment...");const F=await te.generateRiskAssessment(r);if(F.success&&F.riskAssessment)d(F.riskAssessment),t==null||t(F.riskAssessment),a("Risk assessment generated successfully");else throw new Error(F.message||"Failed to generate risk assessment")}catch(F){const b=F;j(b),a(`Error generating assessment: ${b.message}`)}finally{u(!1)}},[r,t,a]),q=c.useCallback(async()=>{try{v(!0),j(null);const F=await te.getRiskAssessment(r);F.success&&F.riskAssessment&&(d(F.riskAssessment),t==null||t(F.riskAssessment))}catch(F){j(F)}finally{v(!1)}},[r,t]),_=({riskLevel:F,riskScore:b})=>{const T=Wa[F.toLowerCase()];if(!T)return null;const D=T.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${T.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":T.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${T.label}`,children:[e.jsx(D,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),T.label,b&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[b,"/10"]})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:T.description})]})};return!i&&!h&&!f?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:R,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[e.jsx(we,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),e.jsxs("button",{type:"button",onClick:q,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[e.jsx(re,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),y&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:y.message})})]})]}):h||f?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:h?"Generating AI risk assessment...":"Loading assessment..."})]}),h&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):i?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:e.jsxs("button",{type:"button",onClick:R,disabled:h,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[e.jsx(re,{className:`w-3 h-3 mr-1 ${h?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),e.jsx(_,{riskLevel:i.overallRiskLevel,riskScore:i.riskScore})]}),i.generatedAt&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(ot,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Fe(i.generatedAt)})]})]}),i.summary&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Qr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:i.summary})})]}),i.keyFactors&&i.keyFactors.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(js,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:i.keyFactors.map((F,b)=>e.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),F]},b))})})]}),i.recommendations&&i.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(na,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:e.jsx("ul",{className:"space-y-2",children:i.recommendations.map((F,b)=>e.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[e.jsx(ge,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),F]},b))})})]}),i.immediateActions&&i.immediateActions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(wa,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("ul",{className:"space-y-2",children:i.immediateActions.map((F,b)=>e.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[e.jsx(ys,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),F]},b))})})]}),i.followUpRecommendations&&i.followUpRecommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(os,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsx("ul",{className:"space-y-2",children:i.followUpRecommendations.map((F,b)=>e.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[e.jsx(_e,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),F]},b))})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(_e,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",Fe(i.generatedAt),i.modelVersion&&e.jsxs("span",{className:"ml-4",children:["Model: ",i.modelVersion]})]})})]}),y&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:y.message})})]}):null},xs={queued:{color:"yellow",icon:_e,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:_e,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:re,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:re,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:ge,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:ge,label:"Completed",description:"Analysis completed successfully"},completed:{color:"green",icon:ge,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:as,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:as,label:"Error",description:"An error occurred during processing"}},Ga=()=>{var S,g,n,l,m,p,N,I,U,B,O,Q;const{sessionId:r}=Mt(),s=We(),{announceToScreenReader:t}=Pe(),[a,i]=c.useState(null),[d,h]=c.useState(!0),[u,f]=c.useState(null),[v,y]=c.useState(!1),[j,R]=c.useState(!1),[q,_]=c.useState(!1),F=c.useRef(null),b=c.useCallback(async()=>{if(r)try{h(!0),f(null);const H=await te.getSessionData(r);i(H),t(`Session ${r} loaded successfully`)}catch(H){const G=H;f(G),t(`Error loading session: ${G.message}`)}finally{h(!1)}},[r,t]),T=c.useCallback(async()=>{R(!0),await b(),R(!1),t("Session data refreshed")},[b,t]);c.useEffect(()=>{b()},[b]);const D=c.useCallback(()=>{y(H=>{const G=!H;return t(`Raw JSON view ${G?"enabled":"disabled"}`),G})},[t]),K=c.useCallback(()=>{F.current&&(q?(F.current.pause(),_(!1),t("Audio paused")):(F.current.play().catch(()=>{t("Failed to play audio")}),_(!0),t("Audio playing")))},[q,t]),C=c.useCallback(()=>{if(!a)return;const H=JSON.stringify(a,null,2),G=new Blob([H],{type:"application/json"}),A=URL.createObjectURL(G),ae=document.createElement("a");ae.href=A,ae.download=`session-${a.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(A),t("Session data download started")},[a,t]),w=c.useCallback(async()=>{if(!(!(a!=null&&a.audioUrl)||!(a!=null&&a.audioFileName))&&a!=null&&a.audioUrl)try{const H=a.audioUrl;window.open(H,"_blank"),window.open(a.audioUrl,"_blank"),t(`Downloading audio file: ${a.audioFileName||"audio file"}`)}catch(H){console.error("Failed to download audio file:",H),t("Failed to download audio file")}},[a,t]),$=c.useCallback(()=>{!a||!window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.")||(t("Redirecting to upload page for re-run..."),s("/upload",{state:{originalSessionId:a.sessionId,audioFileName:a.audioFileName,audioUrl:a.audioUrl,userMetadata:a.userMetadata}}))},[a,s,t]),J=({status:H})=>{const G=H.toLowerCase();let A=xs[H];A||(G.includes("error")||G.includes("fail")?A=xs.error:A=xs.initiated);const ae=A.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${A.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":A.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":A.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${A.label}`,children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${A.color==="blue"&&H==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),A.label]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:A.description})]})};return d?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):u?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:u.message}),e.jsxs("div",{className:"mt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:b,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),e.jsx(le,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):a?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>s("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[e.jsx(Ir,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",a.sessionId]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:D,className:"btn btn--secondary","aria-label":`${v?"Hide":"Show"} raw JSON data`,children:[v?e.jsx(Vr,{className:"w-4 h-4 mr-2"}):e.jsx(Be,{className:"w-4 h-4 mr-2"}),v?"Hide JSON":"Show JSON"]}),e.jsxs("button",{type:"button",onClick:T,disabled:j,className:"btn btn--secondary","aria-label":"Refresh session data",children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${j?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:$,className:"btn btn--secondary","aria-label":"Re-run analysis for this session",children:[e.jsx(re,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:C,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[e.jsx(is,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),v&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(He,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:e.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(a,null,2)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(He,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsx(J,{status:a.status})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ot,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:Oe(a.createdAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:Fe(a.createdAt)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(_e,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:Oe(a.updatedAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:Fe(a.updatedAt)})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(cs,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.userId})]}),a.metadata_user_id&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(cs,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Metadata User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.metadata_user_id})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Kr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),e.jsxs("div",{className:"space-y-4",children:[a.audioFileName&&a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("button",{onClick:w,className:"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors",title:"Click to download audio file",children:a.audioFileName})]}),a.audioFileName&&!a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.audioFileName," (download not available)"]})]}),a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:K,className:"btn btn--secondary","aria-label":`${q?"Pause":"Play"} audio`,children:q?e.jsx(ps,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:q?"Playing audio...":"Audio playback available"})]}),e.jsx("audio",{ref:F,src:a.audioUrl,onPlay:()=>_(!0),onPause:()=>_(!1),onEnded:()=>_(!1),onError:()=>{_(!1),t("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),a.userMetadata&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(cs,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.userMetadata.age&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.age," years"]})]}),a.userMetadata.gender&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.gender.replace(/[_-]/g," ")})]}),a.userMetadata.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.weight," lbs"]})]}),a.userMetadata.race&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.race})]}),a.userMetadata.ethnicity&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.ethnicity})]}),a.userMetadata.zipcode&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:a.userMetadata.zipcode})]}),a.userMetadata.language!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.language?"Yes":"No"})]}),a.userMetadata.sessionNotes&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:a.userMetadata.sessionNotes})]})]})]}),(a.analysisResults||a.prediction)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ze,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),e.jsxs("div",{className:"space-y-6",children:[(a.analysisResults||a.prediction)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(we,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((S=a.analysisResults)==null?void 0:S.depressionScore)||((g=a.prediction)==null?void 0:g.predicted_score_depression))&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),e.jsx(os,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((l=(n=a.analysisResults)==null?void 0:n.depressionScore)==null?void 0:l.toFixed(2))||((m=a.prediction)!=null&&m.predicted_score_depression?a.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,H=>H.toUpperCase()):"N/A")})]}),(((p=a.analysisResults)==null?void 0:p.anxietyScore)||((N=a.prediction)==null?void 0:N.predicted_score_anxiety))&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),e.jsx(mt,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((U=(I=a.analysisResults)==null?void 0:I.anxietyScore)==null?void 0:U.toFixed(2))||((B=a.prediction)!=null&&B.predicted_score_anxiety?a.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,H=>H.toUpperCase()):"N/A")})]})]})]}),((O=a.analysisResults)==null?void 0:O.insights)&&a.analysisResults.insights.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:a.analysisResults.insights.map((H,G)=>e.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),H]},G))})})]}),((Q=a.analysisResults)==null?void 0:Q.completedAt)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ge,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Fe(a.analysisResults.completedAt)})]})})]})]})]}),e.jsx(Va,{sessionId:a.sessionId,existingAssessment:a.riskAssessment||null,onAssessmentUpdated:H=>{i(G=>G?{...G,riskAssessment:H}:null)}})]}):e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),e.jsx(le,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},Ya=()=>{const{user:r}=Se(),[s,t]=c.useState([]),[a,i]=c.useState(!0),[d,h]=c.useState(null),[u,f]=c.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[v,y]=c.useState(!1),{announceToScreenReader:j}=Pe(),R=We(),q=c.useCallback(()=>(r==null?void 0:r.id)||ke(),[r==null?void 0:r.id]),_=c.useCallback(g=>{R(`/sessions/${g}`),j(`Navigating to session ${g} details`)},[R,j]),F=c.useCallback(async()=>{try{i(!0),h(null);const g=q(),l=(await te.getUserSessions(g)).sessions.filter(m=>m.analysisResults||m.prediction);t(l),j(`${l.length} prediction sessions loaded`)}catch(g){const n=g;h(n),j(`Error loading predictions: ${n.message}`)}finally{i(!1)}},[j]);c.useEffect(()=>{F()},[F]);const b=c.useMemo(()=>{if(u.dateRange==="all")return s;const g=new Date,n=new Date;switch(u.dateRange){case"week":n.setDate(g.getDate()-7);break;case"month":n.setMonth(g.getMonth()-1);break;case"quarter":n.setMonth(g.getMonth()-3);break;case"year":n.setFullYear(g.getFullYear()-1);break}return s.filter(l=>new Date(l.createdAt)>=n)},[s,u.dateRange]),T=c.useMemo(()=>b.map(g=>{var p,N;const n=I=>{if(!I)return null;switch(I.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},l=n((p=g.prediction)==null?void 0:p.predicted_score_depression),m=n((N=g.prediction)==null?void 0:N.predicted_score_anxiety);return{date:g.createdAt,depression:l,anxiety:m,overall:null,sessionId:g.sessionId}}).sort((g,n)=>new Date(g.date).getTime()-new Date(n.date).getTime()),[b]),D=c.useMemo(()=>{const g={depression:[],anxiety:[]},n=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],l=b.map(p=>{var N;return(N=p.prediction)==null?void 0:N.predicted_score_depression}).filter(p=>p!==void 0);n.forEach(p=>{const N=l.filter(U=>U===p.category).length,I=l.length>0?N/l.length*100:0;N>0&&g.depression.push({category:p.label,count:N,percentage:I,color:p.color})});const m=b.map(p=>{var N;return(N=p.prediction)==null?void 0:N.predicted_score_anxiety}).filter(p=>p!==void 0);return n.forEach(p=>{const N=m.filter(U=>U===p.category).length,I=m.length>0?N/m.length*100:0;N>0&&g.anxiety.push({category:p.label,count:N,percentage:I,color:p.color})}),g},[b]),K=c.useMemo(()=>{const g={},n=p=>{if(!p)return 0;switch(p.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},l=b.map(p=>{var N;return(N=p.prediction)==null?void 0:N.predicted_score_depression}).filter(p=>p!==void 0);if(l.length<2)g.depression={direction:"stable",change:0,period:"insufficient data"};else{const p=l.map(n),N=p.slice(0,Math.floor(p.length/2)),I=p.slice(Math.floor(p.length/2)),U=N.reduce((Q,H)=>Q+H,0)/N.length,O=I.reduce((Q,H)=>Q+H,0)/I.length-U;g.depression={direction:Math.abs(O)<.5?"stable":O<0?"improving":"worsening",change:Math.abs(O),period:`${b.length} sessions`}}const m=b.map(p=>{var N;return(N=p.prediction)==null?void 0:N.predicted_score_anxiety}).filter(p=>p!==void 0);if(m.length<2)g.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const p=m.map(n),N=p.slice(0,Math.floor(p.length/2)),I=p.slice(Math.floor(p.length/2)),U=N.reduce((Q,H)=>Q+H,0)/N.length,O=I.reduce((Q,H)=>Q+H,0)/I.length-U;g.anxiety={direction:Math.abs(O)<.5?"stable":O<0?"improving":"worsening",change:Math.abs(O),period:`${b.length} sessions`}}return g.overall={direction:"stable",change:0,period:"coming soon"},g},[b]),C=c.useMemo(()=>{const g={totalSessions:b.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(b.length===0)return g;const n=b.map(m=>{var p;return(p=m.prediction)==null?void 0:p.predictedScoreDepression}).filter(m=>m!==void 0),l=b.map(m=>{var p;return(p=m.prediction)==null?void 0:p.predictedScoreAnxiety}).filter(m=>m!==void 0);if(n.length>0){const m={};n.forEach(N=>{m[N]=(m[N]||0)+1});const p=Object.entries(m).sort(([,N],[,I])=>I-N)[0][0];g.avgDepression=m[p]}if(l.length>0){const m={};l.forEach(N=>{m[N]=(m[N]||0)+1});const p=Object.entries(m).sort(([,N],[,I])=>I-N)[0][0];g.avgAnxiety=m[p]}return g.latestSession=b.sort((m,p)=>new Date(p.createdAt).getTime()-new Date(m.createdAt).getTime())[0],g.improvementSessions=0,g},[b]),w=c.useCallback((g,n)=>{f(l=>({...l,[g]:n})),j(`Filter ${g} changed to ${n}`)},[j]),$=c.useCallback(()=>{const g=JSON.stringify(b,null,2),n=new Blob([g],{type:"application/json"}),l=URL.createObjectURL(n),m=document.createElement("a");m.href=l,m.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(l),j("Predictions data download started")},[b,j]),J=({trend:g,label:n})=>{const l=g.direction==="improving"?ut:g.direction==="worsening"?os:ze,m=g.direction==="improving"?"text-green-600 dark:text-green-400":g.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{className:`w-4 h-4 ${m}`,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n}),e.jsxs("span",{className:`text-sm font-medium ${m} capitalize`,children:[g.direction,g.period==="insufficient data"?" (need more sessions)":g.period==="coming soon"?" (analysis coming soon)":` (${g.period})`]})]})},S=({data:g,type:n,onBarClick:l})=>{const m=g.map(A=>A[n]).filter(A=>A!==null);if(m.length===0)return e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const p=Math.max(...m),N=Math.min(...m),I=p-N||1,U=A=>{switch(A){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},B=(A,ae)=>{if(ae==="depression")switch(A){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(ae==="anxiety")switch(A){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(A){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},O=A=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(ee=>({...ee,color:B(ee.score,A)})),Q=new Set(m),G=O(n).filter(A=>Q.has(A.score));return e.jsxs("div",{children:[e.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:g.map((A,ae)=>{const ee=A[n];if(ee===null)return null;const Y=(ee-N)/I*100,ls=B(ee,n),Ae=U(ee),Ve=new Date(A.date).toLocaleDateString();return e.jsx("div",{className:`flex-1 ${ls} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(Y,8)}%`},onClick:()=>l(A.sessionId),role:"button",tabIndex:0,onKeyDown:Re=>{(Re.key==="Enter"||Re.key===" ")&&(Re.preventDefault(),l(A.sessionId))},"aria-label":`View session details for ${Ae} score on ${Ve}`,children:e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsx("div",{className:"font-medium",children:Ae}),e.jsx("div",{className:"text-gray-300",children:Ve}),e.jsxs("div",{className:"text-gray-300",children:["Session: ",A.sessionId.slice(-8)]}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},ae)})}),G.length>0&&e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),G.map(A=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 ${A.color} rounded`}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:A.label})]},A.score))]})})]})};return a?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(re,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):d?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:d.message}),e.jsx("button",{type:"button",onClick:F,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>y(!v),className:"btn btn--secondary","aria-expanded":v?"true":"false","aria-label":`${v?"Hide":"Show"} filter options`,children:[e.jsx(dt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",v?e.jsx(ct,{className:"w-4 h-4 ml-2"}):e.jsx(lt,{className:"w-4 h-4 ml-2"})]}),e.jsxs("button",{type:"button",onClick:F,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[e.jsx(re,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:$,className:"btn btn--primary",disabled:b.length===0,"aria-label":"Download predictions data",children:[e.jsx(is,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),v&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-range",value:u.dateRange,onChange:g=>w("dateRange",g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"quarter",children:"Past Quarter"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),e.jsxs("select",{id:"score-type",value:u.scoreType,onChange:g=>w("scoreType",g.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Scores"}),e.jsx("option",{value:"depression",children:"Depression"}),e.jsx("option",{value:"anxiety",children:"Anxiety"}),e.jsx("option",{value:"overall",children:"Overall"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:u.showTrends,onChange:g=>w("showTrends",g.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),b.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),e.jsx(le,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ze,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:C.totalSessions})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(we,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const g=b.map(m=>{var p;return(p=m.prediction)==null?void 0:p.predicted_score_depression}).filter(m=>m!==void 0);if(g.length===0)return"â€”";const n={};return g.forEach(m=>{n[m]=(n[m]||0)+1}),Object.entries(n).sort(([,m],[,p])=>p-m)[0][0].replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())})()})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(mt,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const g=b.map(m=>{var p;return(p=m.prediction)==null?void 0:p.predicted_score_anxiety}).filter(m=>m!==void 0);if(g.length===0)return"â€”";const n={};return g.forEach(m=>{n[m]=(n[m]||0)+1}),Object.entries(n).sort(([,m],[,p])=>p-m)[0][0].replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())})()})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(u.scoreType==="all"||u.scoreType==="depression")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),e.jsx(S,{data:T,type:"depression",onBarClick:_}),u.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(J,{trend:K.depression,label:"Trend:"})})]}),(u.scoreType==="all"||u.scoreType==="anxiety")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Pr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),e.jsx(S,{data:T,type:"anxiety",onBarClick:_}),u.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(J,{trend:K.anxiety,label:"Trend:"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Gs,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(D).map(([g,n])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[g," Scores"]}),e.jsx("div",{className:"space-y-2",children:n.map(l=>e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:l.category}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[l.count," (",l.percentage.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${l.color} progress-dynamic progress-animated`,style:{"--progress-width":`${l.percentage}%`}})})]})},l.category))})]},g))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(_e,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),e.jsx(le,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions â†’"})]}),e.jsx("div",{className:"space-y-4",children:b.slice(0,5).map(g=>{var n,l;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${g.status==="succeeded"?"bg-green-500":g.status==="processing"?"bg-blue-500":g.status==="failed"?"bg-red-500":"bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.audioFileName||`Session ${g.sessionId.slice(-8)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Oe(g.createdAt)})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[((n=g.prediction)==null?void 0:n.predicted_score_depression)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())})]}),((l=g.prediction)==null?void 0:l.predicted_score_anxiety)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:g.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase())})]}),e.jsx(le,{to:`/sessions/${g.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${g.sessionId}`,children:e.jsx(Be,{className:"w-4 h-4","aria-hidden":"true"})})]})]},g.sessionId)})})]})]})]})},bs=(r,s)=>s>0?Math.round(r/s*100):0,Ka=r=>{const s=r.length,t=new Set(r.map(C=>C.userId)).size,a=r.filter(C=>C.status==="succeeded"||C.status==="completed"),i=r.filter(C=>C.status==="failed"),d=r.filter(C=>C.status==="processing"),h=bs(a.length,s),u=t>0?Math.round(s/t*10)/10:0,f=new Date(Date.now()-24*60*60*1e3),v=r.filter(C=>new Date(C.createdAt)>f).length,y={low:0,medium:0,high:0,unknown:0};r.forEach(C=>{var $;const w=(($=C.analysisResults)==null?void 0:$.riskLevel)||"unknown";w in y&&y[w]++});const j={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},R={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};a.forEach(C=>{var J,S,g,n;let w=null,$=null;if(C.prediction){const l=C.prediction;w=l.predictedScoreDepression||l.predicted_score_depression,$=l.predictedScoreAnxiety||l.predicted_score_anxiety}if(!w&&((J=C.analysisResults)==null?void 0:J.depressionScore)!==null&&((S=C.analysisResults)==null?void 0:S.depressionScore)!==void 0){const l=C.analysisResults.depressionScore;l>=0&&l<=4?w="no_to_mild":l>=5&&l<=9||l>=10&&l<=14?w="mild_to_moderate":l>=15&&l<=19?w="moderate_to_severe":l>=20&&(w="severe")}if(!$&&((g=C.analysisResults)==null?void 0:g.anxietyScore)!==null&&((n=C.analysisResults)==null?void 0:n.anxietyScore)!==void 0){const l=C.analysisResults.anxietyScore;l>=0&&l<=4?$="no_or_minimal":l>=5&&l<=9?$="mild":l>=10&&l<=14?$="moderate":l>=15&&l<=19?$="moderately_severe":l>=20&&($="severe")}w&&w in j&&j[w]++,$&&$ in R&&R[$]++});const q=[];for(let C=6;C>=0;C--){const w=new Date;w.setDate(w.getDate()-C);const $=w.toISOString().split("T")[0],J=r.filter(S=>S.createdAt.split("T")[0]===$).length;q.push({date:$,count:J})}const _=new Map;r.forEach(C=>{const w=C.metadata_user_id||C.userId;_.has(w)||_.set(w,{totalSessions:0,successfulSessions:0,sessions:[]});const $=_.get(w);$.totalSessions++,$.sessions.push(C),(C.status==="succeeded"||C.status==="completed")&&$.successfulSessions++});const F=Array.from(_.entries()).map(([C,w])=>{var N;const $=bs(w.successfulSessions,w.totalSessions),J=w.sessions.filter(I=>I.status==="succeeded"||I.status==="completed"),S=J.map(I=>{var U;return(U=I.analysisResults)==null?void 0:U.confidence}).filter(I=>I!=null&&typeof I=="number"),g=S.length>0?S.reduce((I,U)=>I+U,0)/S.length:0,n={low:0,medium:0,high:0,unknown:0};w.sessions.forEach(I=>{var B;const U=((B=I.analysisResults)==null?void 0:B.riskLevel)||"unknown";U in n&&n[U]++});const l={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},m={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};J.forEach(I=>{var O,Q,H,G;let U=null,B=null;if(I.prediction){const A=I.prediction;U=A.predictedScoreDepression||A.predicted_score_depression,B=A.predictedScoreAnxiety||A.predicted_score_anxiety}if(!U&&((O=I.analysisResults)==null?void 0:O.depressionScore)!==null&&((Q=I.analysisResults)==null?void 0:Q.depressionScore)!==void 0){const A=I.analysisResults.depressionScore;A>=0&&A<=4?U="no_to_mild":A>=5&&A<=9||A>=10&&A<=14?U="mild_to_moderate":A>=15&&A<=19?U="moderate_to_severe":A>=20&&(U="severe")}if(!B&&((H=I.analysisResults)==null?void 0:H.anxietyScore)!==null&&((G=I.analysisResults)==null?void 0:G.anxietyScore)!==void 0){const A=I.analysisResults.anxietyScore;A>=0&&A<=4?B="no_or_minimal":A>=5&&A<=9?B="mild":A>=10&&A<=14?B="moderate":A>=15&&A<=19?B="moderately_severe":A>=20&&(B="severe")}U&&U in l&&l[U]++,B&&B in m&&m[B]++});const p=w.sessions.reduce((I,U)=>new Date(U.updatedAt)>new Date(I)?U.updatedAt:I,((N=w.sessions[0])==null?void 0:N.updatedAt)||new Date().toISOString());return{userId:C,totalSessions:w.totalSessions,successfulSessions:w.successfulSessions,successRate:$,avgConfidence:Math.round(g*100)/100,riskDistribution:n,lastActivity:p,depressionScores:l,anxietyScores:m}}).sort((C,w)=>w.totalSessions-C.totalSessions),b={ageDistribution:{},genderDistribution:{},raceDistribution:{},ethnicityDistribution:{},languageDistribution:{},weightDistribution:{},zipCodeDistribution:{}},T=C=>{var w,$;if(C.prediction){const J=C.prediction,S=J.predictedScoreDepression||J.predicted_score_depression;return S==="moderate_to_severe"||S==="severe"}return((w=C.analysisResults)==null?void 0:w.depressionScore)!==null&&(($=C.analysisResults)==null?void 0:$.depressionScore)!==void 0?C.analysisResults.depressionScore>=10:!1},D=C=>{var w,$;if(C.prediction){const J=C.prediction,S=J.predictedScoreAnxiety||J.predicted_score_anxiety;return S==="moderate"||S==="moderately_severe"||S==="severe"}return((w=C.analysisResults)==null?void 0:w.anxietyScore)!==null&&(($=C.analysisResults)==null?void 0:$.anxietyScore)!==void 0?C.analysisResults.anxietyScore>=10:!1};return r.filter(C=>C.userMetadata).forEach(C=>{const w=C.userMetadata,$=T(C),J=D(C);if(w.age){let S;w.age<25?S="18-24":w.age<35?S="25-34":w.age<45?S="35-44":w.age<55?S="45-54":w.age<65?S="55-64":S="65+",b.ageDistribution[S]||(b.ageDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.ageDistribution[S].totalSessions++,$&&b.ageDistribution[S].depressionCases++,J&&b.ageDistribution[S].anxietyCases++}if(w.gender){const S=w.gender;b.genderDistribution[S]||(b.genderDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.genderDistribution[S].totalSessions++,$&&b.genderDistribution[S].depressionCases++,J&&b.genderDistribution[S].anxietyCases++}if(w.race){const S=w.race;b.raceDistribution[S]||(b.raceDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.raceDistribution[S].totalSessions++,$&&b.raceDistribution[S].depressionCases++,J&&b.raceDistribution[S].anxietyCases++}if(w.ethnicity){const S=w.ethnicity;b.ethnicityDistribution[S]||(b.ethnicityDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.ethnicityDistribution[S].totalSessions++,$&&b.ethnicityDistribution[S].depressionCases++,J&&b.ethnicityDistribution[S].anxietyCases++}if(w.language!==void 0){const S=w.language?"English":"Other";b.languageDistribution[S]||(b.languageDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.languageDistribution[S].totalSessions++,$&&b.languageDistribution[S].depressionCases++,J&&b.languageDistribution[S].anxietyCases++}if(w.weight){let S;w.weight<120?S="Under 120 lbs":w.weight<150?S="120-149 lbs":w.weight<180?S="150-179 lbs":w.weight<220?S="180-219 lbs":S="220+ lbs",b.weightDistribution[S]||(b.weightDistribution[S]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.weightDistribution[S].totalSessions++,$&&b.weightDistribution[S].depressionCases++,J&&b.weightDistribution[S].anxietyCases++}if(w.zipcode){const S=w.zipcode.substring(0,2);let g;["0","1","2"].some(n=>S.startsWith(n))?g="Northeast":["3","4"].some(n=>S.startsWith(n))?g="Southeast":["5","6"].some(n=>S.startsWith(n))?g="South Central":["7","8"].some(n=>S.startsWith(n))?g="Mountain/West":["9"].some(n=>S.startsWith(n))?g="Pacific":g="Other/International",b.zipCodeDistribution[g]||(b.zipCodeDistribution[g]={depressionCases:0,anxietyCases:0,totalSessions:0}),b.zipCodeDistribution[g].totalSessions++,$&&b.zipCodeDistribution[g].depressionCases++,J&&b.zipCodeDistribution[g].anxietyCases++}}),{overview:{totalSessions:s,uniqueUsers:t,successRate:h,avgSessionsPerUser:u,recentActivity:v},sessionStatus:{succeeded:a.length,failed:i.length,processing:d.length,total:s},riskLevels:{...y,total:s},predictions:{depression:{...j,total:a.length},anxiety:{...R,total:a.length}},timeData:q,riskDistribution:y,userStats:F,correlations:b}},Js=({title:r,value:s,subtitle:t,icon:a,trend:i,color:d="text-blue-600"})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:r}),e.jsx("p",{className:`text-2xl font-bold ${d} dark:text-white mt-1`,children:s}),t&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t})]}),e.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${d}`,children:a})]}),i&&e.jsxs("div",{className:"flex items-center mt-4",children:[i==="up"&&e.jsx(os,{className:"h-4 w-4 text-green-500 mr-1"}),i==="down"&&e.jsx(ut,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("span",{className:`text-sm ${i==="up"?"text-green-600":i==="down"?"text-red-600":"text-gray-500"}`,children:i==="up"?"Trending up":i==="down"?"Trending down":"Stable"})]})]}),hs=({title:r,data:s,total:t})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),e.jsx("div",{className:"space-y-3",children:s.map((a,i)=>{const d=bs(a.value,t);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.label}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[a.value," (",d,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${a.color}`,style:{width:`${d}%`},role:"progressbar","aria-label":`${a.label}: ${a.value} (${d}%)`})})]},i)})})]}),Ja=({title:r,data:s})=>{const t=Math.max(...s.map(d=>d.count),1),a=0,i=t-a||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-48",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),s.map((d,h)=>{const u=80/s.length,f=h/(s.length-1)*(100-u)+u/2,v=(d.count-a)/i*95,y=100-v;return e.jsx("rect",{x:f-u/2,y,width:u*.6,height:v,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},h)})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:s.map((d,h)=>{const u=new Date(d.date),f=u.toLocaleDateString("en-US",{weekday:"short"}),v=u.toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:f}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:v}),e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:d.count})]},h)})})]})},Ce=({title:r,data:s,subtitle:t})=>{const a=Object.keys(s);return a.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:t}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No metadata available for this correlation"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:t}),e.jsx("div",{className:"space-y-4",children:a.map((i,d)=>{const h=s[i],u=h.totalSessions>0?h.depressionCases/h.totalSessions*100:0,f=h.totalSessions>0?h.anxietyCases/h.totalSessions*100:0;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:i}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[h.totalSessions," sessions"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Depression Cases"}),e.jsxs("span",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:[h.depressionCases," (",u.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-red-500 rounded-full transition-all duration-500",style:{width:`${u}%`},role:"progressbar","aria-label":`Depression rate: ${u.toFixed(1)}%`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anxiety Cases"}),e.jsxs("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:[h.anxietyCases," (",f.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-orange-500 rounded-full transition-all duration-500",style:{width:`${f}%`},role:"progressbar","aria-label":`Anxiety rate: ${f.toFixed(1)}%`})})]})]},d)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:a.reduce((i,d)=>i+s[d].depressionCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Depression Cases"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:a.reduce((i,d)=>i+s[d].anxietyCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Anxiety Cases"})]})]})})]})},Qa=({title:r,depressionData:s,anxietyData:t})=>{const a=[{depression:s.no_to_mild,anxiety:t.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:s.mild_to_moderate,anxiety:t.mild,severity:"Mild",label:"Mild"},{depression:s.moderate_to_severe,anxiety:t.moderate,severity:"Moderate",label:"Moderate"},{depression:s.severe,anxiety:t.moderately_severe+t.severe,severity:"High",label:"Severe"}],i=Math.max(...a.map(h=>Math.max(h.depression,h.anxiety)),10),d=h=>{switch(h){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-[28rem]",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 600 350",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"correlationGrid",width:"50",height:"35",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 35",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),e.jsx("rect",{width:"600",height:"350",fill:"url(#correlationGrid)"}),e.jsx("line",{x1:"70",y1:"310",x2:"550",y2:"310",stroke:"rgb(107 114 128)",strokeWidth:"2"}),e.jsx("line",{x1:"70",y1:"310",x2:"70",y2:"40",stroke:"rgb(107 114 128)",strokeWidth:"2"}),a.map((h,u)=>{const f=70+h.depression/i*480,v=310-h.anxiety/i*270,y=Math.max(Math.sqrt(h.depression+h.anxiety)*3,10);return e.jsxs("g",{children:[e.jsx("circle",{cx:f,cy:v,r:y,className:`${d(h.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),e.jsx("text",{x:f,y:v+5,textAnchor:"middle",className:"text-sm fill-white font-bold",children:h.depression+h.anxiety})]},u)}),e.jsx("text",{x:"310",y:"335",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases â†’"}),e.jsx("text",{x:"40",y:"175",textAnchor:"middle",transform:"rotate(-90 40 175)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"â† Anxiety Cases"})]})}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:a.map((h,u)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d(h.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:h.label})]},u))})]})},Za=({title:r,sessionStatus:s})=>{const t=[{label:"Total Sessions",value:s.total,color:"bg-blue-500"},{label:"In Processing",value:s.processing,color:"bg-yellow-500"},{label:"Completed",value:s.succeeded,color:"bg-green-500"},{label:"Failed",value:s.failed,color:"bg-red-500"}],a=s.total||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"space-y-4",children:t.map((i,d)=>{const h=i.value/a*100,u=d>0?(i.value/t[0].value*100).toFixed(1):"100.0";return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:i.value}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",u,"%)"]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:`h-full ${i.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${h}%`},children:h>20&&e.jsx("span",{className:"text-xs font-medium text-white",children:i.value})}),d<t.length-1&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},d)})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(s.succeeded/s.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(s.failed/s.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},Xa=({userStats:r})=>{const[s,t]=c.useState(!1),[a,i]=c.useState(!1),d=y=>new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=(y,j)=>{if(j===0)return"text-gray-400";switch(y){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},u=r.length,f=u>0?Math.round(r.reduce((y,j)=>y+j.totalSessions,0)/u*10)/10:0,v=r.length>0?r.reduce((y,j)=>j.avgConfidence>y.avgConfidence?j:y,r[0]):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 overflow-visible",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(xt,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),e.jsxs("div",{className:"flex space-x-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:u}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:f}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),v&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-600",children:[(v.avgConfidence*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Highest Avg Confidence"})]})]})]}),r.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto overflow-y-visible relative",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white w-48",children:"User ID"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Risk Distribution"}),e.jsx("button",{type:"button",onClick:()=>i(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Risk Distribution information",children:e.jsx(He,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]})})}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white relative",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Avg Confidence"}),e.jsx("button",{type:"button",onClick:()=>t(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Average Confidence information",children:e.jsx(He,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]}),e.jsx("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1",children:"(Analysis accuracy 0-100%)"})]})}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),e.jsx("tbody",{children:r.map((y,j)=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${j%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.jsx("div",{className:"truncate max-w-[200px]",title:y.userId,children:y.userId})})}),e.jsxs("td",{className:"py-3 px-2 text-center",children:[e.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:y.totalSessions}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[y.successfulSessions," successful"]})]}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[e.jsxs("span",{className:`px-1 py-0.5 rounded ${h("low",y.riskDistribution.low)}`,children:["L:",y.riskDistribution.low]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${h("medium",y.riskDistribution.medium)}`,children:["M:",y.riskDistribution.medium]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${h("high",y.riskDistribution.high)}`,children:["H:",y.riskDistribution.high]})]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(y.avgConfidence*100).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:d(y.lastActivity)})})]},y.userId))})]})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>t(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Average Confidence Information"}),e.jsx("button",{type:"button",onClick:()=>t(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(De,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Average Confidence Calculation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Calculated from AI model confidence scores"}),e.jsx("div",{children:"â€¢ Averaged across all successful sessions per user"}),e.jsx("div",{children:"â€¢ Related to risk distribution/evaluation accuracy"}),e.jsx("div",{children:"â€¢ Higher values indicate more reliable assessments"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy range: 0-100%"})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Risk Distribution Information"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(De,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Risk Distribution Explanation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Shows the distribution of risk levels across all user sessions"}),e.jsx("div",{children:"â€¢ Visualized as colored dots representing risk categories"}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full mr-1"}),"Low Risk: Minimal behavioral health concerns"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-500 rounded-full mr-1"}),"Medium Risk: Moderate concerns requiring attention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),"High Risk: Significant concerns requiring intervention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full mr-1"}),"Unknown: Risk level could not be determined"]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy: 0-100% (higher confidence = more reliable risk assessment)"})]})]})})]})},ei=()=>{const[r,s]=c.useState(null),[t,a]=c.useState(!1),[i,d]=c.useState(null),[h,u]=c.useState(new Date),{announceToScreenReader:f}=Pe(),v=parseInt("69")*1e3,y=c.useCallback(async()=>{try{a(!0),d(null);let R=[];try{const _=Date.now();console.log("ðŸ”„ ControlPanel: Fetching data with cache-buster:",_);const F=await te.getAllSessions();R=F.sessions,console.log("ðŸ“Š ControlPanel: Fetched sessions data:",{timestamp:_,totalCount:R.length,responseCount:F.count,firstFewSessions:R.slice(0,3).map(b=>({sessionId:b.sessionId,userId:b.userId,status:b.status,createdAt:b.createdAt}))})}catch(_){console.warn("getAllSessions endpoint not available:",_),R=[]}const q=Ka(R);console.log("ðŸ“ˆ ControlPanel: Aggregated analytics:",{totalSessions:q.overview.totalSessions,uniqueUsers:q.overview.uniqueUsers,successRate:q.overview.successRate,sessionStatusBreakdown:q.sessionStatus}),s(q),u(new Date),f("Control panel data loaded successfully")}catch(R){const q=R;d(q),f(`Error loading control panel data: ${q.message}`)}finally{a(!1)}},[f]);c.useEffect(()=>{y()},[y]),c.useEffect(()=>{console.log("ðŸ”„ ControlPanel: Setting up auto-refresh with interval:",v/1e3,"seconds");const R=setInterval(()=>{console.log("ðŸ”„ ControlPanel: Auto-refresh triggered, loading state:",t),y()},v);return()=>{console.log("ðŸ”„ ControlPanel: Cleaning up auto-refresh interval"),clearInterval(R)}},[y,v]);const j=c.useCallback(()=>{d(null),y()},[y]);return t?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{className:"h-6 w-6 animate-spin text-blue-500"}),e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):i?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:i.message}),e.jsxs("button",{onClick:j,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights from all users and sessions"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",h.toLocaleTimeString()]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",v/1e3,"s intervals"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:y,disabled:t,className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm","aria-label":"Refresh control panel data",children:[e.jsx(re,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(Js,{title:"Total Sessions",value:r.overview.totalSessions,subtitle:"All time",icon:e.jsx(ze,{className:"h-6 w-6"}),color:"text-blue-600"}),e.jsx(Js,{title:"Unique Users",value:r.overview.uniqueUsers,subtitle:"Active users",icon:e.jsx(xt,{className:"h-6 w-6"}),color:"text-green-600"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsx(hs,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:r.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:r.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:r.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:r.riskLevels.unknown,color:"bg-gray-500"}],total:r.riskLevels.total})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(hs,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:r.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:r.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:r.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:r.predictions.depression.severe,color:"bg-red-500"}],total:r.predictions.depression.total}),e.jsx(hs,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:r.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:r.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:r.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:r.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:r.predictions.anxiety.severe,color:"bg-red-700"}],total:r.predictions.anxiety.total})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Xa,{userStats:r.userStats})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Demographic Correlation Analysis"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Correlation between patient demographics and mental health outcomes (Depression & Anxiety cases)"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Qa,{title:"Depression vs Anxiety Correlation",depressionData:r.predictions.depression,anxietyData:r.predictions.anxiety})}),e.jsx(Ce,{title:"Age Groups vs Mental Health Cases",subtitle:"Distribution by age ranges showing depression and anxiety case rates",data:r.correlations.ageDistribution}),e.jsx(Ce,{title:"Gender vs Mental Health Cases",subtitle:"Distribution by gender identity showing case rates",data:r.correlations.genderDistribution}),e.jsx(Ce,{title:"Weight Groups vs Mental Health Cases",subtitle:"Distribution by weight ranges showing case rates",data:r.correlations.weightDistribution}),e.jsx(Ce,{title:"Race vs Mental Health Cases",subtitle:"Distribution by racial identity showing case rates",data:r.correlations.raceDistribution}),e.jsx(Ce,{title:"Ethnicity vs Mental Health Cases",subtitle:"Distribution by ethnic background showing case rates",data:r.correlations.ethnicityDistribution}),e.jsx(Ce,{title:"Primary Language vs Mental Health Cases",subtitle:"Distribution by language preference showing case rates",data:r.correlations.languageDistribution}),e.jsx(Ce,{title:"Geographic Region vs Mental Health Cases",subtitle:"Distribution by ZIP code regions showing case rates",data:r.correlations.zipCodeDistribution})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Za,{title:"Session Completion Funnel",sessionStatus:r.sessionStatus})}),e.jsx("div",{className:"mb-8",children:e.jsx(Ja,{title:"Sessions Over Time (7 Days)",data:r.timeData})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})},si=()=>{const r=We();c.useEffect(()=>{const t=setTimeout(()=>{r("/speech-avatar-experience")},3e3);return()=>clearTimeout(t)},[r]);const s=()=>{r("/speech-avatar-experience")};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full mx-4 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(ca,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Agent Experience Upgraded"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"We've upgraded the agent experience with our new Speech Avatar technology for more natural, real-time conversations."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:s,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:["Go to Speech Avatar Experience",e.jsx(Er,{className:"h-4 w-4"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Redirecting automatically in a few seconds..."})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"What's New:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-1 text-left",children:[e.jsx("li",{children:" Real-time speech interaction"}),e.jsx("li",{children:" Visual avatar representation"}),e.jsx("li",{children:" Enhanced behavioral health assessments"}),e.jsx("li",{children:" Improved agent coordination"})]})]})]})})};class ti{constructor(s){this.connection=s}async update(s,t){const a={type:"session.update",session:s};t&&(a.event_id=t),await this.connection.send(a)}}class ri{constructor(s){this.connection=s}async create(s,t,a){const i={type:"response.create",response:s};t&&(i.event_id=t),a&&(i.additional_instructions=a),await this.connection.send(i)}async cancel(s,t){const a={type:"response.cancel"};s&&(a.response_id=s),t&&(a.event_id=t),await this.connection.send(a)}}class ai{constructor(s){this.connection=s}async append(s,t){const a={type:"input_audio_buffer.append",audio:s};t&&(a.event_id=t),await this.connection.send(a)}async commit(s){const t={type:"input_audio_buffer.commit"};s&&(t.event_id=s),await this.connection.send(t)}async clear(s){const t={type:"input_audio_buffer.clear"};s&&(t.event_id=s),await this.connection.send(t)}}class ii{constructor(s){this.connection=s}async clear(s){const t={type:"output_audio_buffer.clear"};s&&(t.event_id=s),await this.connection.send(t)}}class ni{constructor(s){this.connection=s}async create(s,t,a){const i={type:"conversation.item.create",item:s};t&&(i.previous_item_id=t),a&&(i.event_id=a),await this.connection.send(i)}async delete(s,t){const a={type:"conversation.item.delete",item_id:s};t&&(a.event_id=t),await this.connection.send(a)}async truncate(s,t,a,i){const d={type:"conversation.item.truncate",item_id:s,audio_end_ms:t,content_index:a};i&&(d.event_id=i),await this.connection.send(d)}}class oi{constructor(s){Z(this,"item");this.item=new ni(s)}}class li extends Pt.EventEmitter{constructor(t){super();Z(this,"websocket",null);Z(this,"sessionId",null);Z(this,"isConnected",!1);Z(this,"isSessionReady",!1);Z(this,"sessionReadyResolve",null);Z(this,"currentAudioStream",null);Z(this,"mediaRecorder",null);Z(this,"audioContext",null);Z(this,"audioWorkletNode",null);Z(this,"session");Z(this,"response");Z(this,"inputAudioBuffer");Z(this,"outputAudioBuffer");Z(this,"conversation");this.config=t,this.session=new ti(this),this.response=new ri(this),this.inputAudioBuffer=new ai(this),this.outputAudioBuffer=new ii(this),this.conversation=new oi(this)}async connect(){if(this.isConnected)throw new Error("Already connected");try{const t=this.buildWebSocketUrl();return console.log("ðŸ”— Connecting to Azure Voice Live API:",t.toString()),this.websocket=new WebSocket(t.toString()),new Promise((a,i)=>{if(!this.websocket){i(new Error("Failed to create WebSocket"));return}this.websocket.onopen=()=>{console.log("âœ… WebSocket connected to Azure Voice Live API"),this.isConnected=!0,this.setupMessageHandlers(),a()},this.websocket.onerror=d=>{console.error("âŒ WebSocket connection error:",d),this.isConnected=!1,i(new Error("WebSocket connection failed"))},this.websocket.onclose=d=>{console.log(`ðŸ”— WebSocket closed: ${d.code} - ${d.reason}`);let h="Unknown reason";switch(d.code){case 1e3:h="Normal closure";break;case 1006:h="Connection lost abnormally (no close frame)";break;case 1011:h="Server error";break;case 1012:h="Service restart";break;default:h=`Close code ${d.code}`}console.log(`ðŸ“Š Close reason: ${h}`),this.isConnected=!1,this.isSessionReady=!1,this.cleanup(),this.emit("disconnected",{code:d.code,reason:d.reason||h,wasClean:d.wasClean})}})}catch(t){throw new Error(`Failed to connect: ${t instanceof Error?t.message:"Unknown error"}`)}}async waitForSessionReady(){if(!this.isSessionReady)return new Promise(t=>{this.sessionReadyResolve=t})}buildWebSocketUrl(){const t=new URL(this.config.endpoint.replace("https://","wss://"));return t.pathname="/voice-live/realtime",t.searchParams.set("api-version",this.config.apiVersion||"2025-05-01-preview"),t.searchParams.set("model",this.config.model),t.searchParams.set("api-key",this.config.apiKey),t}setupMessageHandlers(){this.websocket&&(this.websocket.onmessage=t=>{try{const a=JSON.parse(t.data);this.handleServerEvent(a)}catch(a){console.error("âŒ Failed to parse WebSocket message:",a),this.emit("error",new Error("Failed to parse server message"))}})}handleServerEvent(t){var a,i,d,h,u;switch(console.log(`ðŸ“¨ Received event: ${t.type}`),t.type){case"session.created":case"session.updated":this.sessionId=((a=t.session)==null?void 0:a.id)||null,console.log(`âœ… Session ready: ${this.sessionId}`),this.isSessionReady||(this.isSessionReady=!0,this.sessionReadyResolve&&(this.sessionReadyResolve(),this.sessionReadyResolve=null)),this.emit("session.ready",t);break;case"input_audio_buffer.speech_started":console.log("ðŸŽ¤ User started speaking"),this.emit("speech.started");break;case"input_audio_buffer.speech_stopped":console.log("ðŸŽ¤ User stopped speaking"),this.emit("speech.stopped");break;case"response.created":console.log("ðŸ¤– Agent response created"),this.emit("response.created",t);break;case"response.audio.delta":(i=t.delta)!=null&&i.audio&&this.emit("audio.delta",t.delta.audio);break;case"response.audio.done":console.log("ðŸ”Š Audio response completed"),this.emit("audio.done",t);break;case"response.audio_transcript.done":console.log("ðŸ“ Audio transcript completed"),this.emit("audio.transcript.done",t);break;case"response.content_part.done":console.log("ðŸ“„ Content part completed"),this.emit("content.part.done",t);break;case"response.output_item.done":console.log("ðŸ“¤ Output item completed"),this.emit("output.item.done",t);break;case"response.done":console.log("âœ… Response completed"),this.emit("response.done",t);break;case"conversation.item.created":this.emit("item.created",t.item);break;case"error":console.error("âŒ Server error:",t.error),((d=t.error)==null?void 0:d.type)==="invalid_request_error"&&(console.error("ðŸš¨ Protocol error - possibly sending data before session ready:",t.error.message),(h=t.error.message)!=null&&h.includes("input_audio_buffer")&&(console.log("ðŸ›‘ Stopping audio capture due to protocol error"),this.stopAudioCapture().catch(f=>console.error("Failed to stop audio:",f)))),this.emit("error",new Error(((u=t.error)==null?void 0:u.message)||"Server error"));break;default:console.log(`ðŸ“¨ Unhandled event type: ${t.type}`),this.emit("event",t);break}this.emit("server.event",t)}async send(t){if(!this.websocket||!this.isConnected)throw new Error("WebSocket not connected");try{const a=JSON.stringify(t);this.websocket.send(a),console.log(`ðŸ“¤ Sent event: ${t.type}`)}catch(a){throw console.error("âŒ Failed to send event:",a),new Error(`Failed to send event: ${a instanceof Error?a.message:"Unknown error"}`)}}async startAudioCapture(){try{this.currentAudioStream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:24e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),this.audioContext=new AudioContext({sampleRate:24e3}),await this.audioContext.audioWorklet.addModule("/audio-worklet-processor.js");const t=this.audioContext.createMediaStreamSource(this.currentAudioStream);this.audioWorkletNode=new AudioWorkletNode(this.audioContext,"audio-input-processor",{numberOfInputs:1,numberOfOutputs:0,channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers"}),this.audioWorkletNode.port.onmessage=a=>{const{type:i,audioBuffer:d,samples:h,average:u,peak:f,active:v}=a.data;i==="audioLevel"?console.log(`ðŸŽ¤ Audio Input Test - Samples: ${h}, Average: ${(u*100).toFixed(2)}%, Peak: ${(f*100).toFixed(2)}%, Active: ${v?"YES":"NO"}`):i==="audioData"&&this.isConnected&&this.isSessionReady&&this.processAudioChunk(d).catch(y=>{console.error("âŒ Failed to process audio chunk:",y)})},t.connect(this.audioWorkletNode),console.log("ðŸŽ¤ Audio capture started with AudioWorkletNode (replacing deprecated ScriptProcessorNode)"),this.emit("audio.capture.started")}catch(t){throw console.error("âŒ Failed to start audio capture:",t),new Error("Microphone access required for voice interaction")}}async processAudioChunk(t){try{if(!this.isConnected){console.warn("âš ï¸ Skipping audio chunk - WebSocket not connected");return}if(!this.isSessionReady){console.warn("âš ï¸ Skipping audio chunk - Session not ready");return}let a;if(t instanceof Blob?a=await t.arrayBuffer():a=t,a.byteLength%2!==0){console.warn("âš ï¸ Odd byte length detected, padding audio chunk");const d=new Uint8Array(a),h=new Uint8Array(a.byteLength+1);h.set(d),h[d.length]=0,a=h.buffer}const i=btoa(String.fromCharCode(...new Uint8Array(a)));await this.inputAudioBuffer.append(i)}catch(a){console.error("âŒ Failed to process audio chunk:",a),a instanceof Error&&a.message.includes("WebSocket not connected")&&(console.log("ðŸ›‘ Stopping audio capture due to WebSocket disconnection"),await this.stopAudioCapture())}}async stopAudioCapture(){this.audioWorkletNode&&(this.audioWorkletNode.disconnect(),this.audioWorkletNode=null),this.audioContext&&this.audioContext.state!=="closed"&&(await this.audioContext.close(),this.audioContext=null),this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.mediaRecorder=null),this.currentAudioStream&&(this.currentAudioStream.getTracks().forEach(t=>t.stop()),this.currentAudioStream=null),console.log("ðŸ›‘ Audio capture stopped"),this.emit("audio.capture.stopped")}async close(){await this.stopAudioCapture(),this.websocket&&this.isConnected&&this.websocket.close(1e3,"Client disconnecting"),this.cleanup()}cleanup(){this.isConnected=!1,this.isSessionReady=!1,this.sessionReadyResolve=null,this.sessionId=null,this.websocket=null,this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(console.log("ðŸ›‘ Stopping MediaRecorder during cleanup"),this.mediaRecorder.stop()),this.currentAudioStream&&(console.log("ðŸ›‘ Stopping audio stream during cleanup"),this.currentAudioStream.getTracks().forEach(t=>t.stop()),this.currentAudioStream=null),this.mediaRecorder=null,this.audioContext&&(this.audioContext.close(),this.audioContext=null)}get connected(){return this.isConnected}get sessionReady(){return this.isSessionReady}get currentSessionId(){return this.sessionId}}async function Qs(r){const s=new li(r);return await s.connect(),await s.waitForSessionReady(),s}class ci{constructor(s){Z(this,"connection",null);Z(this,"config");this.config=s}async initialize(){try{console.log("ðŸŽ­ Initializing Speech Avatar Service..."),this.connection=await Qs(this.config),await this.configureSession(),console.log("âœ… Speech Avatar Service initialized successfully")}catch(s){throw console.error("âŒ Failed to initialize Speech Avatar Service:",s),s}}async configureSession(){if(!this.connection)throw new Error("Connection not established");const s={modalities:["text","audio"],instructions:this.getBehavioralHealthInstructions(),voice:{name:this.config.voice||"en-US-AvaNeural",type:"azure-standard"},input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"azure_semantic_vad",threshold:.3,prefix_padding_ms:200,silence_duration_ms:500},max_response_output_tokens:4096,temperature:.7};await this.connection.session.update(s)}getBehavioralHealthInstructions(){return`You are Dr. Sarah Chen, a compassionate and experienced Behavioral Health Support Specialist. 

Your role is to:
- Provide empathetic, non-judgmental support
- Use active listening techniques
- Ask thoughtful, open-ended questions
- Validate feelings and experiences
- Suggest coping strategies when appropriate
- Maintain professional boundaries
- Know when to recommend professional help

Communication style:
- Warm, calm, and reassuring tone
- Use "I" statements and reflective responses
- Avoid medical advice or diagnosis
- Keep responses concise but meaningful
- Show genuine care and understanding

Remember: You are a supportive companion, not a therapist. Always encourage seeking professional help for serious concerns.`}async startSession(){var s;console.log("ðŸš€ startSession called, checking connection state..."),console.log("ðŸ” this.connection:",this.connection?"exists":"null"),console.log("ðŸ” connection.connected:",(s=this.connection)==null?void 0:s.connected),this.connection||(console.log("ðŸ”„ Connection is null, reinitializing..."),this.connection=await Qs(this.config),await this.configureSession(),console.log("âœ… Connection reinitialized successfully")),this.connection.connected||(console.log("ðŸ”„ Connection lost, attempting to reconnect..."),await this.connection.connect()),console.log("â³ Waiting for session to be ready..."),await this.connection.waitForSessionReady(),console.log("âœ… Session is ready, starting audio capture..."),await this.connection.startAudioCapture(),console.log("ðŸŽ­ Speech Avatar session started")}async endSession(){this.connection&&(await this.connection.close(),this.connection=null),console.log("ðŸ›‘ Speech Avatar session ended")}onAgentMessage(s){var t;(t=this.connection)==null||t.on("response.audio.done",a=>{var d;const i={agentName:"Speech Avatar",content:((d=a.response)==null?void 0:d.content)||"",timestamp:new Date().toISOString(),confidence:.95,suggestedActions:[]};s(i)})}onUserSpeech(s){var t,a;(t=this.connection)==null||t.on("input_audio_buffer.speech_started",()=>{s(!0)}),(a=this.connection)==null||a.on("input_audio_buffer.speech_stopped",()=>{s(!1)})}onError(s){var t;(t=this.connection)==null||t.on("error",a=>{var i;s(((i=a.error)==null?void 0:i.message)||"Unknown error")})}async stopSession(){await this.endSession()}on(s,t){var a;(a=this.connection)==null||a.on(s,t)}off(s,t){var a;(a=this.connection)==null||a.off(s,t)}get session(){var s;return(s=this.connection)==null?void 0:s.session}get response(){var s;return(s=this.connection)==null?void 0:s.response}get conversation(){var s;return(s=this.connection)==null?void 0:s.conversation}get inputAudioBuffer(){var s;return(s=this.connection)==null?void 0:s.inputAudioBuffer}get outputAudioBuffer(){var s;return(s=this.connection)==null?void 0:s.outputAudioBuffer}get isConnected(){var s;return((s=this.connection)==null?void 0:s.connected)||!1}get isSessionReady(){var s;return((s=this.connection)==null?void 0:s.sessionReady)||!1}}function di({agentType:r="PHQ9",userId:s,onSessionEnd:t,onRiskDetected:a}){var B;const[i,d]=c.useState(!1),[h,u]=c.useState(!1),[f,v]=c.useState(!1),[y,j]=c.useState(null),[R,q]=c.useState(""),[_,F]=c.useState([]),[b,T]=c.useState("disconnected"),[D,K]=c.useState(""),[C,w]=c.useState(!0),$=c.useRef(null),J=c.useRef(null),S=c.useRef(null),g={PHQ9:{name:"Dr. Sarah Chen",role:"Depression Screening Specialist",voice:"en-US-AvaNeural",personality:"empathetic, professional, thorough"},PHQ2:{name:"Dr. Michael Torres",role:"Mental Health Screener",voice:"en-US-GuyNeural",personality:"supportive, gentle, efficient"},CRISIS:{name:"Dr. Jennifer Walsh",role:"Crisis Intervention Specialist",voice:"en-US-JennyNeural",personality:"calm, authoritative, compassionate"},COMEDIAN:{name:"Dr. Alex Rivera",role:"Therapeutic Humor Specialist",voice:"en-US-AriaNeural",personality:"warm, humorous, professional"}}[r],n=c.useCallback(async()=>{try{const O="https://cdc-traci-aif-002.cognitiveservices.azure.com/",Q="7fGpwV46hnYrzploQr6mnERZoTcIUBdKkKuuwlyQMqylmGbqkVTQJQQJ99BIACHYHv6XJ3w3AAAAACOGB48K",H={endpoint:O,apiKey:Q,model:"gpt-4o-realtime-preview",voice:"en-US-AvaNeural",instructions:`You are ${g.name}, a ${g.role}. Your personality is ${g.personality}. Conduct a compassionate, professional behavioral health interaction.`,agentPersonality:{name:"Dr. Sarah Chen",role:"Behavioral Health Support Specialist",traits:g.personality.split(", ")}},G=new ci(H);G.onAgentMessage(A=>{F(ae=>[...ae,A]),q(A.content),(A.content.toLowerCase().includes("crisis")||A.content.toLowerCase().includes("emergency")||A.content.toLowerCase().includes("harm"))&&(a==null||a("high"))}),G.onUserSpeech(A=>{u(A),A&&(v(!1),q("Listening..."))}),G.onError(A=>{K(A),T("error")}),await G.initialize(),$.current=G,T("connected")}catch(O){console.error("Failed to initialize Speech Avatar service:",O);const Q=O instanceof Error?O.message:"Unknown error occurred";K(Q),T("error")}},[g]);c.useEffect(()=>(n(),()=>{$.current&&$.current.stopSession()}),[n]),c.useEffect(()=>{var O;(O=S.current)==null||O.scrollIntoView({behavior:"smooth"})},[_]);const l=c.useCallback(async()=>{try{if(T("connecting"),K(""),$.current)console.log("âœ… Service already available, using existing instance");else{if(console.log("ðŸ”„ Service not available, reinitializing..."),await n(),!$.current)throw new Error("Failed to reinitialize speech service");console.log("âœ… Service successfully reinitialized")}const O="https://cwbhieastus001.azurewebsites.net/api";let Q;try{const G=await fetch(`${O}/speech-avatar/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agentType:r,userId:s,sessionConfig:{agentType:r,sessionId:"",enableAudio:!0,preferredVoice:g.voice}})});if(!G.ok)throw new Error("Backend not available");Q=await G.json()}catch(G){console.warn("Backend not available, using fallback session:",G),Q={sessionId:`fallback-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,status:"initialized",agentType:r}}j(Q.sessionId),await $.current.startSession(),d(!0),T("connected");const H={agentName:g.name,content:N(r),timestamp:new Date().toISOString(),confidence:1};F([H]),q(H.content)}catch(O){console.error("Failed to start session:",O),K("Failed to start session. Please try again."),T("error")}},[s,r,g,n]),m=c.useCallback(async()=>{if(!(!$.current||!y))try{const Q=await fetch(`https://cwbhieastus001.azurewebsites.net/api/speech-avatar/sessions/${y}`,{method:"DELETE"});if(Q.ok){const H=await Q.json();t==null||t(H)}await $.current.stopSession(),d(!1),u(!1),v(!1),j(null),T("disconnected"),q("Session ended. Thank you for your time.")}catch(O){console.error("Failed to end session:",O),K("Failed to end session properly.")}},[y,t]),p=c.useCallback(()=>{w(O=>!O)},[]),N=O=>{switch(O){case"PHQ9":return"Hello! I'm Dr. Sarah Chen. I'd like to have a conversation with you about how you've been feeling lately. This will help us understand your mental health better. Feel free to speak naturally - I'm here to listen.";case"PHQ2":return"Hi there! I'm Dr. Michael Torres. I'd like to ask you a couple of quick questions about your mood over the past two weeks. Just speak naturally, and I'll listen carefully.";case"CRISIS":return"Hello, I'm Dr. Jennifer Walsh, a crisis intervention specialist. I'm here to provide immediate support. Please tell me what's happening and how you're feeling right now.";case"COMEDIAN":return"Hey there! I'm Dr. Alex Rivera. I like to bring a little light-heartedness to our conversations while still taking your mental health seriously. Ready to chat?";default:return"Hello! I'm here to provide behavioral health support. Feel free to share what's on your mind."}},U=(()=>{switch(b){case"connecting":return{text:"Connecting...",color:"text-yellow-600"};case"connected":return{text:"Connected",color:"text-green-600"};case"error":return{text:"Connection Error",color:"text-red-600"};default:return{text:"Disconnected",color:"text-gray-600"}}})();return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:g.name.split(" ").map(O=>O[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:g.name}),e.jsx("p",{className:"text-sm text-gray-600",children:g.role})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${U.color}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${b==="connected"?"bg-green-500":b==="connecting"?"bg-yellow-500":b==="error"?"bg-red-500":"bg-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:U.text})]}),e.jsx("button",{onClick:p,className:`p-2 rounded-full transition-colors ${C?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,title:C?"Mute Audio":"Unmute Audio",children:C?e.jsx(ns,{size:20}):e.jsx(Fa,{size:20})})]})]})}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"w-1/2 bg-gray-900 relative",children:[e.jsx("video",{ref:J,className:"w-full h-full object-cover",autoPlay:!0,muted:!C,playsInline:!0}),!((B=J.current)!=null&&B.srcObject)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-32 h-32 bg-indigo-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx("span",{className:"text-white font-bold text-4xl",children:g.name.split(" ").map(O=>O[0]).join("")})}),e.jsx("p",{className:"text-white text-lg",children:g.name}),e.jsx("p",{className:"text-gray-300",children:g.role})]})}),e.jsxs("div",{className:"absolute bottom-4 left-4",children:[h&&e.jsxs("div",{className:"flex items-center space-x-2 bg-green-600 text-white px-3 py-2 rounded-full",children:[e.jsx(ma,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Listening..."})]}),f&&e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-600 text-white px-3 py-2 rounded-full",children:[e.jsx(ns,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"Speaking..."})]})]})]}),e.jsxs("div",{className:"w-1/2 bg-white flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Current Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:R||"Waiting for conversation to begin..."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[_.map((O,Q)=>e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-blue-900",children:O.agentName}),e.jsx("span",{className:"text-xs text-blue-600",children:new Date(O.timestamp).toLocaleTimeString()})]}),e.jsx("p",{className:"text-blue-800",children:O.content}),O.suggestedActions&&O.suggestedActions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Suggested Actions:"}),e.jsx("ul",{className:"text-sm text-blue-700 mt-1",children:O.suggestedActions.map((H,G)=>e.jsxs("li",{className:"ml-4",children:["â€¢ ",H]},G))})]})]},Q)),e.jsx("div",{ref:S})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border-t border-gray-200",children:[i?e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:m,className:`flex-1 bg-red-600 text-white py-3 px-4 rounded-lg font-semibold \r
                           hover:bg-red-700 transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(ha,{size:18}),e.jsx("span",{children:"End Session"})]}),e.jsx("button",{className:"p-3 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",title:"Settings",children:e.jsx(ja,{size:18})})]}):e.jsx("button",{onClick:l,disabled:b!=="connected",className:`w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold \r
                         hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed`,children:b==="connecting"?"Connecting...":"Start Conversation"}),D&&e.jsxs("div",{className:"mt-3 p-3 bg-red-100 border border-red-400 rounded-lg flex items-center space-x-2",children:[e.jsx(js,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-red-700 text-sm",children:D})]})]})]})]})]})}const mi=()=>{const{data:r,isLoading:s,error:t,refetch:a}=gt(),{announce:i}=it();st.useEffect(()=>{i("System Health page loaded","polite")},[i]);const d=v=>{if(!v)return"Just now";try{const y=new Date(v);return isNaN(y.getTime())?"Just now":y.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},h=v=>{switch(v==null?void 0:v.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},u=v=>{switch(v==null?void 0:v.toLowerCase()){case"healthy":return"âœ…";case"degraded":return"âš ï¸";case"unhealthy":return"âŒ";default:return"â“"}},f=v=>{const y="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(v==null?void 0:v.toLowerCase()){case"healthy":return`${y} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${y} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${y} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${y} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),e.jsxs("button",{type:"button",onClick:()=>a(),disabled:s,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[e.jsx(re,{className:`w-4 h-4 ${s?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]}),s&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(re,{className:"w-6 h-6 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),t&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-6 h-6 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:t.message||"Unable to retrieve system health status"}),e.jsx("button",{type:"button",onClick:()=>a(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),r&&!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),e.jsxs("div",{className:f(r.status),children:[e.jsx("span",{className:"mr-1",children:u(r.status)}),r.status]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:u(r.status)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("div",{className:`font-medium ${h(r.status)}`,children:r.status})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"â±ï¸"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.totalDuration?`${r.totalDuration}ms`:"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“…"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d(r.timestamp)})]})]})]}),r.checks&&Object.keys(r.checks).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ze,{className:"w-5 h-5 mr-2"}),"Service Details"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(r.checks).map(([v,y])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:u(y.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:v.replace(/-/g," ")}),y.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:y.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[y.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[y.duration,"ms"]}),e.jsx("div",{className:f(y.status),children:y.status})]})]},v))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(He,{className:"w-5 h-5 mr-2"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},ui=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),e.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),xi=new _t({defaultOptions:{queries:{retry:(r,s)=>{if(s&&typeof s=="object"&&"code"in s){const t=s.code;if(t!=null&&t.startsWith("HTTP_4")&&t!=="HTTP_408")return!1}return r<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}});function hi(){return e.jsxs(Rt,{client:xi,children:[e.jsx(Jt,{children:e.jsx(cr,{children:e.jsx(yr,{children:e.jsx(Et,{children:e.jsx(Nr,{children:e.jsxs(Dt,{children:[e.jsx(je,{path:"/",element:e.jsxs(Ne,{requireRoles:[ie.ADMIN,ie.CONTROL_PANEL],children:[e.jsx(ur,{}),e.jsx(La,{})]})}),e.jsx(je,{path:"/upload",element:e.jsx(Ne,{requireRoles:[ie.ADMIN],children:e.jsx(Ha,{})})}),e.jsx(je,{path:"/sessions",element:e.jsx(Ne,{requireRoles:[ie.ADMIN],children:e.jsx(qa,{})})}),e.jsx(je,{path:"/sessions/:sessionId",element:e.jsx(Ne,{requireRoles:[ie.ADMIN],children:e.jsx(Ga,{})})}),e.jsx(je,{path:"/predictions",element:e.jsx(Ne,{requireRoles:[ie.ADMIN],children:e.jsx(Ya,{})})}),e.jsx(je,{path:"/summary",element:e.jsx(Ne,{requireRoles:[ie.ADMIN,ie.CONTROL_PANEL],children:e.jsx(ei,{})})}),e.jsx(je,{path:"/agent-experience",element:e.jsx(Ne,{requireRoles:[ie.ADMIN,ie.CONTROL_PANEL],children:e.jsx(si,{})})}),e.jsx(je,{path:"/speech-avatar-experience",element:e.jsx(Ne,{requireRoles:[ie.ADMIN,ie.CONTROL_PANEL],children:e.jsx(di,{userId:"current-user"})})}),e.jsx(je,{path:"/health",element:e.jsx(Ne,{requireRoles:[ie.ADMIN],children:e.jsx(mi,{})})}),e.jsx(je,{path:"*",element:e.jsx(ui,{})})]})})})})})}),!1]})}const Zs=localStorage.getItem("bh_theme"),gi=window.matchMedia("(prefers-color-scheme: dark)").matches,pi=Zs==="dark"||!Zs&&gi;pi?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");gs.createRoot(document.getElementById("root")).render(e.jsx(st.StrictMode,{children:e.jsx(hi,{})}));
//# sourceMappingURL=index-9935fde6.js.map
