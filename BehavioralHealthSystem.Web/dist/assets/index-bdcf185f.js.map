{"version":3,"file":"index-bdcf185f.js","sources":["../../node_modules/react-dom/client.js","../../node_modules/uuid/dist/esm-browser/rng.js","../../node_modules/uuid/dist/esm-browser/stringify.js","../../node_modules/uuid/dist/esm-browser/native.js","../../node_modules/uuid/dist/esm-browser/v4.js","../../src/config/constants.ts","../../src/utils/index.ts","../../src/contexts/ThemeContext.tsx","../../node_modules/@azure/msal-common/dist/utils/Constants.mjs","../../node_modules/@azure/msal-common/dist/error/AuthError.mjs","../../node_modules/@azure/msal-common/dist/logger/Logger.mjs","../../node_modules/@azure/msal-browser/dist/utils/BrowserConstants.mjs","../../node_modules/@azure/msal-browser/dist/error/BrowserConfigurationAuthErrorCodes.mjs","../../node_modules/@azure/msal-browser/dist/error/BrowserConfigurationAuthError.mjs","../../node_modules/@azure/msal-browser/dist/app/IPublicClientApplication.mjs","../../node_modules/@azure/msal-react/dist/MsalContext.js","../../node_modules/@azure/msal-react/dist/hooks/useMsal.js","../../src/config/authConfig.ts","../../src/contexts/AuthContext.tsx","../../src/contexts/MockAuthContext.tsx","../../src/components/auth/ConditionalAuthProvider.tsx","../../src/components/auth/AuthGuards.tsx","../../src/components/auth/RoleBasedRedirect.tsx","../../src/services/authProvider.ts","../../src/services/api.ts","../../src/components/auth/ApiAuthInitializer.tsx","../../src/hooks/accessibility.ts","../../src/components/layout/Header.tsx","../../src/components/icons/MicrosoftLogo.tsx","../../src/components/layout/Layout.tsx","../../node_modules/lucide-react/dist/esm/shared/src/utils.js","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/Icon.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/activity.js","../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/brain.js","../../node_modules/lucide-react/dist/esm/icons/calendar.js","../../node_modules/lucide-react/dist/esm/icons/chart-column.js","../../node_modules/lucide-react/dist/esm/icons/chart-pie.js","../../node_modules/lucide-react/dist/esm/icons/chevron-down.js","../../node_modules/lucide-react/dist/esm/icons/chevron-up.js","../../node_modules/lucide-react/dist/esm/icons/circle-alert.js","../../node_modules/lucide-react/dist/esm/icons/circle-check-big.js","../../node_modules/lucide-react/dist/esm/icons/circle-x.js","../../node_modules/lucide-react/dist/esm/icons/clock.js","../../node_modules/lucide-react/dist/esm/icons/download.js","../../node_modules/lucide-react/dist/esm/icons/eye-off.js","../../node_modules/lucide-react/dist/esm/icons/eye.js","../../node_modules/lucide-react/dist/esm/icons/file-audio.js","../../node_modules/lucide-react/dist/esm/icons/file-text.js","../../node_modules/lucide-react/dist/esm/icons/funnel.js","../../node_modules/lucide-react/dist/esm/icons/heart.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../node_modules/lucide-react/dist/esm/icons/languages.js","../../node_modules/lucide-react/dist/esm/icons/lightbulb.js","../../node_modules/lucide-react/dist/esm/icons/loader-circle.js","../../node_modules/lucide-react/dist/esm/icons/mic-off.js","../../node_modules/lucide-react/dist/esm/icons/mic.js","../../node_modules/lucide-react/dist/esm/icons/pause.js","../../node_modules/lucide-react/dist/esm/icons/play.js","../../node_modules/lucide-react/dist/esm/icons/plus.js","../../node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../../node_modules/lucide-react/dist/esm/icons/search.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../node_modules/lucide-react/dist/esm/icons/settings.js","../../node_modules/lucide-react/dist/esm/icons/shield-alert.js","../../node_modules/lucide-react/dist/esm/icons/square-pen.js","../../node_modules/lucide-react/dist/esm/icons/target.js","../../node_modules/lucide-react/dist/esm/icons/trash-2.js","../../node_modules/lucide-react/dist/esm/icons/trending-down.js","../../node_modules/lucide-react/dist/esm/icons/trending-up.js","../../node_modules/lucide-react/dist/esm/icons/triangle-alert.js","../../node_modules/lucide-react/dist/esm/icons/upload.js","../../node_modules/lucide-react/dist/esm/icons/user.js","../../node_modules/lucide-react/dist/esm/icons/users.js","../../node_modules/lucide-react/dist/esm/icons/volume-2.js","../../node_modules/lucide-react/dist/esm/icons/volume-x.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../src/hooks/api.ts","../../src/pages/Dashboard.tsx","../../src/services/audio.ts","../../src/services/azure.ts","../../src/hooks/useAccessibility.ts","../../src/pages/UploadAnalyze.tsx","../../src/pages/Sessions.tsx","../../src/components/RiskAssessment.tsx","../../src/pages/SessionDetail.tsx","../../src/pages/Predictions.tsx","../../src/pages/ControlPanel.tsx","../../src/services/speechService.ts","../../src/hooks/useSpeech.ts","../../node_modules/@microsoft/signalr/dist/esm/Errors.js","../../node_modules/@microsoft/signalr/dist/esm/HttpClient.js","../../node_modules/@microsoft/signalr/dist/esm/ILogger.js","../../node_modules/@microsoft/signalr/dist/esm/Loggers.js","../../node_modules/@microsoft/signalr/dist/esm/pkg-version.js","../../node_modules/@microsoft/signalr/dist/esm/Utils.js","../../node_modules/@microsoft/signalr/dist/esm/FetchHttpClient.js","../../node_modules/@microsoft/signalr/dist/esm/XhrHttpClient.js","../../node_modules/@microsoft/signalr/dist/esm/DefaultHttpClient.js","../../node_modules/@microsoft/signalr/dist/esm/TextMessageFormat.js","../../node_modules/@microsoft/signalr/dist/esm/HandshakeProtocol.js","../../node_modules/@microsoft/signalr/dist/esm/IHubProtocol.js","../../node_modules/@microsoft/signalr/dist/esm/Subject.js","../../node_modules/@microsoft/signalr/dist/esm/MessageBuffer.js","../../node_modules/@microsoft/signalr/dist/esm/HubConnection.js","../../node_modules/@microsoft/signalr/dist/esm/DefaultReconnectPolicy.js","../../node_modules/@microsoft/signalr/dist/esm/HeaderNames.js","../../node_modules/@microsoft/signalr/dist/esm/AccessTokenHttpClient.js","../../node_modules/@microsoft/signalr/dist/esm/ITransport.js","../../node_modules/@microsoft/signalr/dist/esm/AbortController.js","../../node_modules/@microsoft/signalr/dist/esm/LongPollingTransport.js","../../node_modules/@microsoft/signalr/dist/esm/ServerSentEventsTransport.js","../../node_modules/@microsoft/signalr/dist/esm/WebSocketTransport.js","../../node_modules/@microsoft/signalr/dist/esm/HttpConnection.js","../../node_modules/@microsoft/signalr/dist/esm/JsonHubProtocol.js","../../node_modules/@microsoft/signalr/dist/esm/HubConnectionBuilder.js","../../src/services/signalRService.ts","../../src/hooks/useSignalR.ts","../../src/components/VoiceActivityVisualizer.tsx","../../src/components/SpeechSettings.tsx","../../src/pages/AgentExperience.tsx","../../src/pages/index.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","// Environment configuration\r\nexport const config = {\r\n  api: {\r\n    baseUrl: import.meta.env.VITE_API_BASE || 'http://localhost:7071/api',\r\n  },\r\n  azure: {\r\n    blobSasUrl: import.meta.env.VITE_AZURE_BLOB_SAS_URL || '',\r\n    containerName: import.meta.env.VITE_STORAGE_CONTAINER_NAME || 'audio-uploads',\r\n  },\r\n  polling: {\r\n    intervalMs: parseInt(import.meta.env.VITE_POLL_INTERVAL_MS || '3000', 10),\r\n    maxAttempts: 60, // 3 minutes at 3s intervals\r\n    backoffFactor: 1.2,\r\n  },\r\n  features: {\r\n    enableFFmpegWorker: import.meta.env.VITE_ENABLE_FFMPEG_WORKER === 'true',\r\n    enableDebugLogging: import.meta.env.VITE_ENABLE_DEBUG_LOGGING === 'true',\r\n  },\r\n  audio: {\r\n    acceptedFormats: ['.wav', '.mp3', '.m4a', '.aac', '.flac'],\r\n    maxFileSizeMB: 100,\r\n    targetSampleRate: 44100,\r\n    targetChannels: 1,\r\n  },\r\n} as const;\r\n\r\n// Storage keys\r\nexport const STORAGE_KEYS = {\r\n  USER_ID: 'bh_user_id',\r\n  THEME: 'bh_theme',\r\n  UPLOAD_SESSIONS: 'bh_upload_sessions',\r\n  PROCESSING_MODE: 'bh_processing_mode',\r\n  USER_ID_CUSTOM: 'bh_user_id_custom',\r\n} as const;\r\n\r\n// API endpoints\r\nexport const API_ENDPOINTS = {\r\n  HEALTH: '/health',\r\n  SESSIONS_INITIATE: '/sessions/initiate',\r\n  PREDICTIONS_SUBMIT: '/predictions/submit',\r\n  PREDICTIONS_BY_USER: '/predictions',\r\n  PREDICTIONS_BY_SESSION: '/predictions/sessions',\r\n} as const;\r\n\r\n// Validation constants\r\nexport const VALIDATION = {\r\n  USER_ID_PATTERN: /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,\r\n  SESSION_ID_PATTERN: /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,\r\n  MAX_FILE_SIZE_BYTES: 100 * 1024 * 1024, // 100MB\r\n} as const;\r\n\r\n// Accessibility constants\r\nexport const A11Y = {\r\n  SKIP_TO_CONTENT_ID: 'main-content',\r\n  ANNOUNCEMENTS_ID: 'a11y-announcements',\r\n  FOCUS_TIMEOUT: 100,\r\n  DEBOUNCE_MS: 300,\r\n} as const;\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport { STORAGE_KEYS, VALIDATION } from '@/config/constants';\r\nimport type { Theme, AppError } from '@/types';\r\n\r\n// Global variable to hold the current authenticated user ID\r\nlet currentAuthenticatedUserId: string | null = null;\r\n\r\n// Set the authenticated user ID (called from auth context)\r\nexport const setAuthenticatedUserId = (userId: string | null): void => {\r\n  currentAuthenticatedUserId = userId;\r\n};\r\n\r\n// User ID management - prioritizes authenticated user ID\r\nexport const getUserId = (): string => {\r\n  // If user is authenticated, use their ID\r\n  if (currentAuthenticatedUserId) {\r\n    return currentAuthenticatedUserId;\r\n  }\r\n\r\n  // Fallback to local storage for non-authenticated users\r\n  let userId = localStorage.getItem(STORAGE_KEYS.USER_ID);\r\n  \r\n  // If no User ID exists, generate a new UUID\r\n  if (!userId || userId.trim().length === 0) {\r\n    userId = uuidv4();\r\n    localStorage.setItem(STORAGE_KEYS.USER_ID, userId);\r\n  }\r\n  \r\n  return userId;\r\n};\r\n\r\n// Set a custom user ID\r\nexport const setUserId = (userId: string): void => {\r\n  if (!userId || userId.trim().length === 0) {\r\n    throw new Error('User ID cannot be empty');\r\n  }\r\n  localStorage.setItem(STORAGE_KEYS.USER_ID, userId.trim());\r\n};\r\n\r\n// Generate a new user ID\r\nexport const generateNewUserId = (): string => {\r\n  const newUserId = uuidv4();\r\n  localStorage.setItem(STORAGE_KEYS.USER_ID, newUserId);\r\n  setUserIdMode(false); // Mark as auto-generated\r\n  return newUserId;\r\n};\r\n\r\n// Check if user ID is custom (not auto-generated)\r\nexport const isCustomUserId = (): boolean => {\r\n  return localStorage.getItem('bh_user_id_custom') === 'true';\r\n};\r\n\r\n// Set user ID as custom or auto-generated\r\nexport const setUserIdMode = (isCustom: boolean): void => {\r\n  localStorage.setItem('bh_user_id_custom', isCustom.toString());\r\n};\r\n\r\n// Theme management\r\nexport const getStoredTheme = (): Theme => {\r\n  const stored = localStorage.getItem(STORAGE_KEYS.THEME) as Theme;\r\n  if (stored === 'light' || stored === 'dark') {\r\n    return stored;\r\n  }\r\n  \r\n  // Default to system preference\r\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n};\r\n\r\nexport const setStoredTheme = (theme: Theme): void => {\r\n  localStorage.setItem(STORAGE_KEYS.THEME, theme);\r\n  \r\n  // Apply theme to document\r\n  if (theme === 'dark') {\r\n    document.documentElement.classList.add('dark');\r\n  } else {\r\n    document.documentElement.classList.remove('dark');\r\n  }\r\n};\r\n\r\n// Processing mode management\r\nexport const getStoredProcessingMode = (): string => {\r\n  const stored = localStorage.getItem(STORAGE_KEYS.PROCESSING_MODE);\r\n  \r\n  // Handle new format with explicit mode values\r\n  if (stored === 'single' || stored === 'batch-files' || stored === 'batch-csv') {\r\n    return stored;\r\n  }\r\n  \r\n  // Handle legacy boolean format for backward compatibility\r\n  if (stored === 'true') {\r\n    return 'batch-files';\r\n  }\r\n  if (stored === 'false') {\r\n    return 'single';\r\n  }\r\n  \r\n  // Default to single file mode\r\n  return 'single';\r\n};\r\n\r\nexport const setStoredProcessingMode = (mode: string): void => {\r\n  localStorage.setItem(STORAGE_KEYS.PROCESSING_MODE, mode);\r\n};\r\n\r\n// Legacy function for backward compatibility\r\nexport const getStoredProcessingModeBoolean = (): boolean => {\r\n  const mode = getStoredProcessingMode();\r\n  return mode !== 'single';\r\n};\r\n\r\n// File utilities\r\nexport const formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  \r\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n};\r\n\r\nexport const formatDuration = (seconds: number): string => {\r\n  const minutes = Math.floor(seconds / 60);\r\n  const remainingSeconds = Math.floor(seconds % 60);\r\n  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n};\r\n\r\nexport const getAudioDuration = (file: File): Promise<number> => {\r\n  return new Promise((resolve, reject) => {\r\n    const audio = new Audio();\r\n    const url = URL.createObjectURL(file);\r\n    \r\n    audio.addEventListener('loadedmetadata', () => {\r\n      URL.revokeObjectURL(url);\r\n      resolve(audio.duration);\r\n    });\r\n    \r\n    audio.addEventListener('error', () => {\r\n      URL.revokeObjectURL(url);\r\n      reject(new Error('Unable to load audio metadata'));\r\n    });\r\n    \r\n    audio.src = url;\r\n  });\r\n};\r\n\r\n// Date utilities\r\nexport const formatRelativeTime = (date: string): string => {\r\n  const now = new Date();\r\n  const target = new Date(date);\r\n  const diffMs = now.getTime() - target.getTime();\r\n  const diffMinutes = Math.floor(diffMs / (1000 * 60));\r\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n  \r\n  if (diffMinutes < 1) return 'Just now';\r\n  if (diffMinutes < 60) return `${diffMinutes}m ago`;\r\n  if (diffHours < 24) return `${diffHours}h ago`;\r\n  if (diffDays < 7) return `${diffDays}d ago`;\r\n  \r\n  return target.toLocaleDateString();\r\n};\r\n\r\nexport const formatDateTime = (date: string): string => {\r\n  return new Date(date).toLocaleString();\r\n};\r\n\r\n// Error handling\r\nexport const createAppError = (code: string, message: string, details?: Record<string, unknown>): AppError => ({\r\n  code,\r\n  message,\r\n  details,\r\n  timestamp: new Date().toISOString(),\r\n});\r\n\r\nexport const isNetworkError = (error: unknown): boolean => {\r\n  if (error instanceof TypeError && error.message.includes('fetch')) {\r\n    return true;\r\n  }\r\n  \r\n  if (error instanceof Error) {\r\n    return error.message.includes('Network') || \r\n           error.message.includes('connection') ||\r\n           error.message.includes('timeout');\r\n  }\r\n  \r\n  return false;\r\n};\r\n\r\n// Validation utilities\r\nexport const isValidUUID = (uuid: string): boolean => {\r\n  const uuidPattern = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n  return uuidPattern.test(uuid);\r\n};\r\n\r\nexport const isValidAudioFile = (file: File): { valid: boolean; error?: string } => {\r\n  // Check file size\r\n  if (file.size > VALIDATION.MAX_FILE_SIZE_BYTES) {\r\n    return {\r\n      valid: false,\r\n      error: `File size exceeds maximum limit of ${formatFileSize(VALIDATION.MAX_FILE_SIZE_BYTES)}`\r\n    };\r\n  }\r\n  \r\n  // Check file type\r\n  const validTypes = ['audio/wav', 'audio/mpeg', 'audio/mp4', 'audio/aac', 'audio/flac', 'audio/x-m4a'];\r\n  if (!validTypes.includes(file.type) && !file.name.match(/\\.(wav|mp3|m4a|aac|flac)$/i)) {\r\n    return {\r\n      valid: false,\r\n      error: 'Please select a valid audio file (WAV, MP3, M4A, AAC, or FLAC)'\r\n    };\r\n  }\r\n  \r\n  return { valid: true };\r\n};\r\n\r\n// Accessibility utilities\r\nexport const announceToScreenReader = (message: string, priority: 'polite' | 'assertive' = 'polite'): void => {\r\n  const announcement = document.createElement('div');\r\n  announcement.setAttribute('aria-live', priority);\r\n  announcement.setAttribute('aria-atomic', 'true');\r\n  announcement.className = 'sr-only';\r\n  announcement.textContent = message;\r\n  \r\n  document.body.appendChild(announcement);\r\n  \r\n  // Remove after announcement\r\n  setTimeout(() => {\r\n    document.body.removeChild(announcement);\r\n  }, 1000);\r\n};\r\n\r\nexport const focusElement = (elementId: string, delay = 100): void => {\r\n  setTimeout(() => {\r\n    const element = document.getElementById(elementId);\r\n    if (element) {\r\n      element.focus();\r\n    }\r\n  }, delay);\r\n};\r\n\r\nexport const trapFocus = (container: HTMLElement): { release: () => void } => {\r\n  const focusableElements = container.querySelectorAll(\r\n    'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n  );\r\n  \r\n  const firstFocusable = focusableElements[0] as HTMLElement;\r\n  const lastFocusable = focusableElements[focusableElements.length - 1] as HTMLElement;\r\n  \r\n  const handleTabKey = (e: KeyboardEvent) => {\r\n    if (e.key !== 'Tab') return;\r\n    \r\n    if (e.shiftKey) {\r\n      if (document.activeElement === firstFocusable) {\r\n        lastFocusable?.focus();\r\n        e.preventDefault();\r\n      }\r\n    } else {\r\n      if (document.activeElement === lastFocusable) {\r\n        firstFocusable?.focus();\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  };\r\n  \r\n  container.addEventListener('keydown', handleTabKey);\r\n  firstFocusable?.focus();\r\n  \r\n  return {\r\n    release: () => {\r\n      container.removeEventListener('keydown', handleTabKey);\r\n    }\r\n  };\r\n};\r\n\r\n// Debounce utility\r\nexport const debounce = <T extends (...args: unknown[]) => void>(\r\n  fn: T,\r\n  delay: number\r\n): ((...args: Parameters<T>) => void) => {\r\n  let timeoutId: NodeJS.Timeout;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import { createContext, useContext, useEffect, useState } from 'react';\r\nimport { getStoredTheme, setStoredTheme } from '@/utils';\r\nimport type { Theme } from '@/types';\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  toggleTheme: () => void;\r\n  setTheme: (theme: Theme) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport const useTheme = () => {\r\n  const context = useContext(ThemeContext);\r\n  if (context === undefined) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface ThemeProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const ThemeProvider: React.FC<ThemeProviderProps> = ({ children }) => {\r\n  const [theme, setThemeState] = useState<Theme>(getStoredTheme);\r\n\r\n  const setTheme = (newTheme: Theme) => {\r\n    setThemeState(newTheme);\r\n    setStoredTheme(newTheme);\r\n  };\r\n\r\n  const toggleTheme = () => {\r\n    const newTheme = theme === 'light' ? 'dark' : 'light';\r\n    setTheme(newTheme);\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Apply theme on mount\r\n    setStoredTheme(theme);\r\n  }, [theme]);\r\n\r\n  useEffect(() => {\r\n    // Listen for system theme changes\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n    \r\n    const handleChange = (e: MediaQueryListEvent) => {\r\n      const storedTheme = localStorage.getItem('bh_theme');\r\n      if (!storedTheme) {\r\n        // Only auto-switch if user hasn't set a preference\r\n        setThemeState(e.matches ? 'dark' : 'light');\r\n      }\r\n    };\r\n\r\n    mediaQuery.addEventListener('change', handleChange);\r\n    return () => mediaQuery.removeEventListener('change', handleChange);\r\n  }, []);\r\n\r\n  const value = {\r\n    theme,\r\n    toggleTheme,\r\n    setTheme,\r\n  };\r\n\r\n  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\r\n};\r\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst Constants = {\r\n    LIBRARY_NAME: \"MSAL.JS\",\r\n    SKU: \"msal.js.common\",\r\n    // default authority\r\n    DEFAULT_AUTHORITY: \"https://login.microsoftonline.com/common/\",\r\n    DEFAULT_AUTHORITY_HOST: \"login.microsoftonline.com\",\r\n    DEFAULT_COMMON_TENANT: \"common\",\r\n    // ADFS String\r\n    ADFS: \"adfs\",\r\n    DSTS: \"dstsv2\",\r\n    // Default AAD Instance Discovery Endpoint\r\n    AAD_INSTANCE_DISCOVERY_ENDPT: \"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=\",\r\n    // CIAM URL\r\n    CIAM_AUTH_URL: \".ciamlogin.com\",\r\n    AAD_TENANT_DOMAIN_SUFFIX: \".onmicrosoft.com\",\r\n    // Resource delimiter - used for certain cache entries\r\n    RESOURCE_DELIM: \"|\",\r\n    // Placeholder for non-existent account ids/objects\r\n    NO_ACCOUNT: \"NO_ACCOUNT\",\r\n    // Claims\r\n    CLAIMS: \"claims\",\r\n    // Consumer UTID\r\n    CONSUMER_UTID: \"9188040d-6c67-4c5b-b112-36a304b66dad\",\r\n    // Default scopes\r\n    OPENID_SCOPE: \"openid\",\r\n    PROFILE_SCOPE: \"profile\",\r\n    OFFLINE_ACCESS_SCOPE: \"offline_access\",\r\n    EMAIL_SCOPE: \"email\",\r\n    CODE_GRANT_TYPE: \"authorization_code\",\r\n    RT_GRANT_TYPE: \"refresh_token\",\r\n    S256_CODE_CHALLENGE_METHOD: \"S256\",\r\n    URL_FORM_CONTENT_TYPE: \"application/x-www-form-urlencoded;charset=utf-8\",\r\n    AUTHORIZATION_PENDING: \"authorization_pending\",\r\n    NOT_DEFINED: \"not_defined\",\r\n    EMPTY_STRING: \"\",\r\n    NOT_APPLICABLE: \"N/A\",\r\n    NOT_AVAILABLE: \"Not Available\",\r\n    FORWARD_SLASH: \"/\",\r\n    IMDS_ENDPOINT: \"http://169.254.169.254/metadata/instance/compute/location\",\r\n    IMDS_VERSION: \"2020-06-01\",\r\n    IMDS_TIMEOUT: 2000,\r\n    AZURE_REGION_AUTO_DISCOVER_FLAG: \"TryAutoDetect\",\r\n    REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX: \"login.microsoft.com\",\r\n    KNOWN_PUBLIC_CLOUDS: [\r\n        \"login.microsoftonline.com\",\r\n        \"login.windows.net\",\r\n        \"login.microsoft.com\",\r\n        \"sts.windows.net\",\r\n    ],\r\n    SHR_NONCE_VALIDITY: 240,\r\n    INVALID_INSTANCE: \"invalid_instance\",\r\n};\r\nconst HttpStatus = {\r\n    SUCCESS: 200,\r\n    SUCCESS_RANGE_START: 200,\r\n    SUCCESS_RANGE_END: 299,\r\n    REDIRECT: 302,\r\n    CLIENT_ERROR: 400,\r\n    CLIENT_ERROR_RANGE_START: 400,\r\n    BAD_REQUEST: 400,\r\n    UNAUTHORIZED: 401,\r\n    NOT_FOUND: 404,\r\n    REQUEST_TIMEOUT: 408,\r\n    GONE: 410,\r\n    TOO_MANY_REQUESTS: 429,\r\n    CLIENT_ERROR_RANGE_END: 499,\r\n    SERVER_ERROR: 500,\r\n    SERVER_ERROR_RANGE_START: 500,\r\n    SERVICE_UNAVAILABLE: 503,\r\n    GATEWAY_TIMEOUT: 504,\r\n    SERVER_ERROR_RANGE_END: 599,\r\n    MULTI_SIDED_ERROR: 600,\r\n};\r\nconst HttpMethod = {\r\n    GET: \"GET\",\r\n    POST: \"POST\",\r\n};\r\nconst OIDC_DEFAULT_SCOPES = [\r\n    Constants.OPENID_SCOPE,\r\n    Constants.PROFILE_SCOPE,\r\n    Constants.OFFLINE_ACCESS_SCOPE,\r\n];\r\nconst OIDC_SCOPES = [...OIDC_DEFAULT_SCOPES, Constants.EMAIL_SCOPE];\r\n/**\r\n * Request header names\r\n */\r\nconst HeaderNames = {\r\n    CONTENT_TYPE: \"Content-Type\",\r\n    CONTENT_LENGTH: \"Content-Length\",\r\n    RETRY_AFTER: \"Retry-After\",\r\n    CCS_HEADER: \"X-AnchorMailbox\",\r\n    WWWAuthenticate: \"WWW-Authenticate\",\r\n    AuthenticationInfo: \"Authentication-Info\",\r\n    X_MS_REQUEST_ID: \"x-ms-request-id\",\r\n    X_MS_HTTP_VERSION: \"x-ms-httpver\",\r\n};\r\n/**\r\n * Persistent cache keys MSAL which stay while user is logged in.\r\n */\r\nconst PersistentCacheKeys = {\r\n    ACTIVE_ACCOUNT_FILTERS: \"active-account-filters\", // new cache entry for active_account for a more robust version for browser\r\n};\r\n/**\r\n * String constants related to AAD Authority\r\n */\r\nconst AADAuthorityConstants = {\r\n    COMMON: \"common\",\r\n    ORGANIZATIONS: \"organizations\",\r\n    CONSUMERS: \"consumers\",\r\n};\r\n/**\r\n * Claims request keys\r\n */\r\nconst ClaimsRequestKeys = {\r\n    ACCESS_TOKEN: \"access_token\",\r\n    XMS_CC: \"xms_cc\",\r\n};\r\n/**\r\n * we considered making this \"enum\" in the request instead of string, however it looks like the allowed list of\r\n * prompt values kept changing over past couple of years. There are some undocumented prompt values for some\r\n * internal partners too, hence the choice of generic \"string\" type instead of the \"enum\"\r\n */\r\nconst PromptValue = {\r\n    LOGIN: \"login\",\r\n    SELECT_ACCOUNT: \"select_account\",\r\n    CONSENT: \"consent\",\r\n    NONE: \"none\",\r\n    CREATE: \"create\",\r\n    NO_SESSION: \"no_session\",\r\n};\r\n/**\r\n * allowed values for codeVerifier\r\n */\r\nconst CodeChallengeMethodValues = {\r\n    PLAIN: \"plain\",\r\n    S256: \"S256\",\r\n};\r\n/**\r\n * Allowed values for response_type\r\n */\r\nconst OAuthResponseType = {\r\n    CODE: \"code\",\r\n    IDTOKEN_TOKEN: \"id_token token\",\r\n    IDTOKEN_TOKEN_REFRESHTOKEN: \"id_token token refresh_token\",\r\n};\r\n/**\r\n * allowed values for server response type\r\n * @deprecated Use ResponseMode instead\r\n */\r\nconst ServerResponseType = {\r\n    QUERY: \"query\",\r\n    FRAGMENT: \"fragment\",\r\n};\r\n/**\r\n * allowed values for response_mode\r\n */\r\nconst ResponseMode = {\r\n    QUERY: \"query\",\r\n    FRAGMENT: \"fragment\",\r\n    FORM_POST: \"form_post\",\r\n};\r\n/**\r\n * allowed grant_type\r\n */\r\nconst GrantType = {\r\n    IMPLICIT_GRANT: \"implicit\",\r\n    AUTHORIZATION_CODE_GRANT: \"authorization_code\",\r\n    CLIENT_CREDENTIALS_GRANT: \"client_credentials\",\r\n    RESOURCE_OWNER_PASSWORD_GRANT: \"password\",\r\n    REFRESH_TOKEN_GRANT: \"refresh_token\",\r\n    DEVICE_CODE_GRANT: \"device_code\",\r\n    JWT_BEARER: \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\r\n};\r\n/**\r\n * Account types in Cache\r\n */\r\nconst CacheAccountType = {\r\n    MSSTS_ACCOUNT_TYPE: \"MSSTS\",\r\n    ADFS_ACCOUNT_TYPE: \"ADFS\",\r\n    MSAV1_ACCOUNT_TYPE: \"MSA\",\r\n    GENERIC_ACCOUNT_TYPE: \"Generic\", // NTLM, Kerberos, FBA, Basic etc\r\n};\r\n/**\r\n * Separators used in cache\r\n */\r\nconst Separators = {\r\n    CACHE_KEY_SEPARATOR: \"-\",\r\n    CLIENT_INFO_SEPARATOR: \".\",\r\n};\r\n/**\r\n * Credential Type stored in the cache\r\n */\r\nconst CredentialType = {\r\n    ID_TOKEN: \"IdToken\",\r\n    ACCESS_TOKEN: \"AccessToken\",\r\n    ACCESS_TOKEN_WITH_AUTH_SCHEME: \"AccessToken_With_AuthScheme\",\r\n    REFRESH_TOKEN: \"RefreshToken\",\r\n};\r\n/**\r\n * Combine all cache types\r\n */\r\nconst CacheType = {\r\n    ADFS: 1001,\r\n    MSA: 1002,\r\n    MSSTS: 1003,\r\n    GENERIC: 1004,\r\n    ACCESS_TOKEN: 2001,\r\n    REFRESH_TOKEN: 2002,\r\n    ID_TOKEN: 2003,\r\n    APP_METADATA: 3001,\r\n    UNDEFINED: 9999,\r\n};\r\n/**\r\n * More Cache related constants\r\n */\r\nconst APP_METADATA = \"appmetadata\";\r\nconst CLIENT_INFO = \"client_info\";\r\nconst THE_FAMILY_ID = \"1\";\r\nconst AUTHORITY_METADATA_CONSTANTS = {\r\n    CACHE_KEY: \"authority-metadata\",\r\n    REFRESH_TIME_SECONDS: 3600 * 24, // 24 Hours\r\n};\r\nconst AuthorityMetadataSource = {\r\n    CONFIG: \"config\",\r\n    CACHE: \"cache\",\r\n    NETWORK: \"network\",\r\n    HARDCODED_VALUES: \"hardcoded_values\",\r\n};\r\nconst SERVER_TELEM_CONSTANTS = {\r\n    SCHEMA_VERSION: 5,\r\n    MAX_LAST_HEADER_BYTES: 330,\r\n    MAX_CACHED_ERRORS: 50,\r\n    CACHE_KEY: \"server-telemetry\",\r\n    CATEGORY_SEPARATOR: \"|\",\r\n    VALUE_SEPARATOR: \",\",\r\n    OVERFLOW_TRUE: \"1\",\r\n    OVERFLOW_FALSE: \"0\",\r\n    UNKNOWN_ERROR: \"unknown_error\",\r\n};\r\n/**\r\n * Type of the authentication request\r\n */\r\nconst AuthenticationScheme = {\r\n    BEARER: \"Bearer\",\r\n    POP: \"pop\",\r\n    SSH: \"ssh-cert\",\r\n};\r\n/**\r\n * Constants related to throttling\r\n */\r\nconst ThrottlingConstants = {\r\n    // Default time to throttle RequestThumbprint in seconds\r\n    DEFAULT_THROTTLE_TIME_SECONDS: 60,\r\n    // Default maximum time to throttle in seconds, overrides what the server sends back\r\n    DEFAULT_MAX_THROTTLE_TIME_SECONDS: 3600,\r\n    // Prefix for storing throttling entries\r\n    THROTTLING_PREFIX: \"throttling\",\r\n    // Value assigned to the x-ms-lib-capability header to indicate to the server the library supports throttling\r\n    X_MS_LIB_CAPABILITY_VALUE: \"retry-after, h429\",\r\n};\r\nconst Errors = {\r\n    INVALID_GRANT_ERROR: \"invalid_grant\",\r\n    CLIENT_MISMATCH_ERROR: \"client_mismatch\",\r\n};\r\n/**\r\n * Password grant parameters\r\n */\r\nconst PasswordGrantConstants = {\r\n    username: \"username\",\r\n    password: \"password\",\r\n};\r\n/**\r\n * Region Discovery Sources\r\n */\r\nconst RegionDiscoverySources = {\r\n    FAILED_AUTO_DETECTION: \"1\",\r\n    INTERNAL_CACHE: \"2\",\r\n    ENVIRONMENT_VARIABLE: \"3\",\r\n    IMDS: \"4\",\r\n};\r\n/**\r\n * Region Discovery Outcomes\r\n */\r\nconst RegionDiscoveryOutcomes = {\r\n    CONFIGURED_NO_AUTO_DETECTION: \"2\",\r\n    AUTO_DETECTION_REQUESTED_SUCCESSFUL: \"4\",\r\n    AUTO_DETECTION_REQUESTED_FAILED: \"5\",\r\n};\r\n/**\r\n * Specifies the reason for fetching the access token from the identity provider\r\n */\r\nconst CacheOutcome = {\r\n    // When a token is found in the cache or the cache is not supposed to be hit when making the request\r\n    NOT_APPLICABLE: \"0\",\r\n    // When the token request goes to the identity provider because force_refresh was set to true. Also occurs if claims were requested\r\n    FORCE_REFRESH_OR_CLAIMS: \"1\",\r\n    // When the token request goes to the identity provider because no cached access token exists\r\n    NO_CACHED_ACCESS_TOKEN: \"2\",\r\n    // When the token request goes to the identity provider because cached access token expired\r\n    CACHED_ACCESS_TOKEN_EXPIRED: \"3\",\r\n    // When the token request goes to the identity provider because refresh_in was used and the existing token needs to be refreshed\r\n    PROACTIVELY_REFRESHED: \"4\",\r\n};\r\nconst JsonWebTokenTypes = {\r\n    Jwt: \"JWT\",\r\n    Jwk: \"JWK\",\r\n    Pop: \"pop\",\r\n};\r\nconst ONE_DAY_IN_MS = 86400000;\r\n// Token renewal offset default in seconds\r\nconst DEFAULT_TOKEN_RENEWAL_OFFSET_SEC = 300;\r\nconst EncodingTypes = {\r\n    BASE64: \"base64\",\r\n    HEX: \"hex\",\r\n    UTF8: \"utf-8\",\r\n};\n\nexport { AADAuthorityConstants, APP_METADATA, AUTHORITY_METADATA_CONSTANTS, AuthenticationScheme, AuthorityMetadataSource, CLIENT_INFO, CacheAccountType, CacheOutcome, CacheType, ClaimsRequestKeys, CodeChallengeMethodValues, Constants, CredentialType, DEFAULT_TOKEN_RENEWAL_OFFSET_SEC, EncodingTypes, Errors, GrantType, HeaderNames, HttpMethod, HttpStatus, JsonWebTokenTypes, OAuthResponseType, OIDC_DEFAULT_SCOPES, OIDC_SCOPES, ONE_DAY_IN_MS, PasswordGrantConstants, PersistentCacheKeys, PromptValue, RegionDiscoveryOutcomes, RegionDiscoverySources, ResponseMode, SERVER_TELEM_CONSTANTS, Separators, ServerResponseType, THE_FAMILY_ID, ThrottlingConstants };\n//# sourceMappingURL=Constants.mjs.map\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\nimport { Constants } from '../utils/Constants.mjs';\nimport { postRequestFailed, unexpectedError } from './AuthErrorCodes.mjs';\nimport * as AuthErrorCodes from './AuthErrorCodes.mjs';\nexport { AuthErrorCodes };\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst AuthErrorMessages = {\r\n    [unexpectedError]: \"Unexpected error in authentication.\",\r\n    [postRequestFailed]: \"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details.\",\r\n};\r\n/**\r\n * AuthErrorMessage class containing string constants used by error codes and messages.\r\n * @deprecated Use AuthErrorCodes instead\r\n */\r\nconst AuthErrorMessage = {\r\n    unexpectedError: {\r\n        code: unexpectedError,\r\n        desc: AuthErrorMessages[unexpectedError],\r\n    },\r\n    postRequestFailed: {\r\n        code: postRequestFailed,\r\n        desc: AuthErrorMessages[postRequestFailed],\r\n    },\r\n};\r\n/**\r\n * General error class thrown by the MSAL.js library.\r\n */\r\nclass AuthError extends Error {\r\n    constructor(errorCode, errorMessage, suberror) {\r\n        const errorString = errorMessage\r\n            ? `${errorCode}: ${errorMessage}`\r\n            : errorCode;\r\n        super(errorString);\r\n        Object.setPrototypeOf(this, AuthError.prototype);\r\n        this.errorCode = errorCode || Constants.EMPTY_STRING;\r\n        this.errorMessage = errorMessage || Constants.EMPTY_STRING;\r\n        this.subError = suberror || Constants.EMPTY_STRING;\r\n        this.name = \"AuthError\";\r\n    }\r\n    setCorrelationId(correlationId) {\r\n        this.correlationId = correlationId;\r\n    }\r\n}\r\nfunction createAuthError(code, additionalMessage) {\r\n    return new AuthError(code, additionalMessage\r\n        ? `${AuthErrorMessages[code]} ${additionalMessage}`\r\n        : AuthErrorMessages[code]);\r\n}\n\nexport { AuthError, AuthErrorMessage, AuthErrorMessages, createAuthError };\n//# sourceMappingURL=AuthError.mjs.map\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\nimport { Constants } from '../utils/Constants.mjs';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Log message level.\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"Error\"] = 0] = \"Error\";\r\n    LogLevel[LogLevel[\"Warning\"] = 1] = \"Warning\";\r\n    LogLevel[LogLevel[\"Info\"] = 2] = \"Info\";\r\n    LogLevel[LogLevel[\"Verbose\"] = 3] = \"Verbose\";\r\n    LogLevel[LogLevel[\"Trace\"] = 4] = \"Trace\";\r\n})(LogLevel || (LogLevel = {}));\r\n/**\r\n * Class which facilitates logging of messages to a specific place.\r\n */\r\nclass Logger {\r\n    constructor(loggerOptions, packageName, packageVersion) {\r\n        // Current log level, defaults to info.\r\n        this.level = LogLevel.Info;\r\n        const defaultLoggerCallback = () => {\r\n            return;\r\n        };\r\n        const setLoggerOptions = loggerOptions || Logger.createDefaultLoggerOptions();\r\n        this.localCallback =\r\n            setLoggerOptions.loggerCallback || defaultLoggerCallback;\r\n        this.piiLoggingEnabled = setLoggerOptions.piiLoggingEnabled || false;\r\n        this.level =\r\n            typeof setLoggerOptions.logLevel === \"number\"\r\n                ? setLoggerOptions.logLevel\r\n                : LogLevel.Info;\r\n        this.correlationId =\r\n            setLoggerOptions.correlationId || Constants.EMPTY_STRING;\r\n        this.packageName = packageName || Constants.EMPTY_STRING;\r\n        this.packageVersion = packageVersion || Constants.EMPTY_STRING;\r\n    }\r\n    static createDefaultLoggerOptions() {\r\n        return {\r\n            loggerCallback: () => {\r\n                // allow users to not set loggerCallback\r\n            },\r\n            piiLoggingEnabled: false,\r\n            logLevel: LogLevel.Info,\r\n        };\r\n    }\r\n    /**\r\n     * Create new Logger with existing configurations.\r\n     */\r\n    clone(packageName, packageVersion, correlationId) {\r\n        return new Logger({\r\n            loggerCallback: this.localCallback,\r\n            piiLoggingEnabled: this.piiLoggingEnabled,\r\n            logLevel: this.level,\r\n            correlationId: correlationId || this.correlationId,\r\n        }, packageName, packageVersion);\r\n    }\r\n    /**\r\n     * Log message with required options.\r\n     */\r\n    logMessage(logMessage, options) {\r\n        if (options.logLevel > this.level ||\r\n            (!this.piiLoggingEnabled && options.containsPii)) {\r\n            return;\r\n        }\r\n        const timestamp = new Date().toUTCString();\r\n        // Add correlationId to logs if set, correlationId provided on log messages take precedence\r\n        const logHeader = `[${timestamp}] : [${options.correlationId || this.correlationId || \"\"}]`;\r\n        const log = `${logHeader} : ${this.packageName}@${this.packageVersion} : ${LogLevel[options.logLevel]} - ${logMessage}`;\r\n        // debug(`msal:${LogLevel[options.logLevel]}${options.containsPii ? \"-Pii\": Constants.EMPTY_STRING}${options.context ? `:${options.context}` : Constants.EMPTY_STRING}`)(logMessage);\r\n        this.executeCallback(options.logLevel, log, options.containsPii || false);\r\n    }\r\n    /**\r\n     * Execute callback with message.\r\n     */\r\n    executeCallback(level, message, containsPii) {\r\n        if (this.localCallback) {\r\n            this.localCallback(level, message, containsPii);\r\n        }\r\n    }\r\n    /**\r\n     * Logs error messages.\r\n     */\r\n    error(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Error,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs error messages with PII.\r\n     */\r\n    errorPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Error,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs warning messages.\r\n     */\r\n    warning(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Warning,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs warning messages with PII.\r\n     */\r\n    warningPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Warning,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs info messages.\r\n     */\r\n    info(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Info,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs info messages with PII.\r\n     */\r\n    infoPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Info,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs verbose messages.\r\n     */\r\n    verbose(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Verbose,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs verbose messages with PII.\r\n     */\r\n    verbosePii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Verbose,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs trace messages.\r\n     */\r\n    trace(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Trace,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs trace messages with PII.\r\n     */\r\n    tracePii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Trace,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Returns whether PII Logging is enabled or not.\r\n     */\r\n    isPiiLoggingEnabled() {\r\n        return this.piiLoggingEnabled || false;\r\n    }\r\n}\n\nexport { LogLevel, Logger };\n//# sourceMappingURL=Logger.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { OIDC_DEFAULT_SCOPES } from '@azure/msal-common/browser';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Constants\r\n */\r\nconst BrowserConstants = {\r\n    /**\r\n     * Invalid grant error code\r\n     */\r\n    INVALID_GRANT_ERROR: \"invalid_grant\",\r\n    /**\r\n     * Default popup window width\r\n     */\r\n    POPUP_WIDTH: 483,\r\n    /**\r\n     * Default popup window height\r\n     */\r\n    POPUP_HEIGHT: 600,\r\n    /**\r\n     * Name of the popup window starts with\r\n     */\r\n    POPUP_NAME_PREFIX: \"msal\",\r\n    /**\r\n     * Default popup monitor poll interval in milliseconds\r\n     */\r\n    DEFAULT_POLL_INTERVAL_MS: 30,\r\n    /**\r\n     * Msal-browser SKU\r\n     */\r\n    MSAL_SKU: \"msal.js.browser\",\r\n};\r\nconst PlatformAuthConstants = {\r\n    CHANNEL_ID: \"53ee284d-920a-4b59-9d30-a60315b26836\",\r\n    PREFERRED_EXTENSION_ID: \"ppnbnpeolgkicgegkbkbjmhlideopiji\",\r\n    MATS_TELEMETRY: \"MATS\",\r\n    MICROSOFT_ENTRA_BROKERID: \"MicrosoftEntra\",\r\n    DOM_API_NAME: \"DOM API\",\r\n    PLATFORM_DOM_APIS: \"get-token-and-sign-out\",\r\n    PLATFORM_DOM_PROVIDER: \"PlatformAuthDOMHandler\",\r\n    PLATFORM_EXTENSION_PROVIDER: \"PlatformAuthExtensionHandler\",\r\n};\r\nconst NativeExtensionMethod = {\r\n    HandshakeRequest: \"Handshake\",\r\n    HandshakeResponse: \"HandshakeResponse\",\r\n    GetToken: \"GetToken\",\r\n    Response: \"Response\",\r\n};\r\nconst BrowserCacheLocation = {\r\n    LocalStorage: \"localStorage\",\r\n    SessionStorage: \"sessionStorage\",\r\n    MemoryStorage: \"memoryStorage\",\r\n};\r\n/**\r\n * HTTP Request types supported by MSAL.\r\n */\r\nconst HTTP_REQUEST_TYPE = {\r\n    GET: \"GET\",\r\n    POST: \"POST\",\r\n};\r\nconst INTERACTION_TYPE = {\r\n    SIGNIN: \"signin\",\r\n    SIGNOUT: \"signout\",\r\n};\r\n/**\r\n * Temporary cache keys for MSAL, deleted after any request.\r\n */\r\nconst TemporaryCacheKeys = {\r\n    ORIGIN_URI: \"request.origin\",\r\n    URL_HASH: \"urlHash\",\r\n    REQUEST_PARAMS: \"request.params\",\r\n    VERIFIER: \"code.verifier\",\r\n    INTERACTION_STATUS_KEY: \"interaction.status\",\r\n    NATIVE_REQUEST: \"request.native\",\r\n};\r\n/**\r\n * Cache keys stored in-memory\r\n */\r\nconst InMemoryCacheKeys = {\r\n    WRAPPER_SKU: \"wrapper.sku\",\r\n    WRAPPER_VER: \"wrapper.version\",\r\n};\r\n/**\r\n * API Codes for Telemetry purposes.\r\n * Before adding a new code you must claim it in the MSAL Telemetry tracker as these number spaces are shared across all MSALs\r\n * 0-99 Silent Flow\r\n * 800-899 Auth Code Flow\r\n */\r\nconst ApiId = {\r\n    acquireTokenRedirect: 861,\r\n    acquireTokenPopup: 862,\r\n    ssoSilent: 863,\r\n    acquireTokenSilent_authCode: 864,\r\n    handleRedirectPromise: 865,\r\n    acquireTokenByCode: 866,\r\n    acquireTokenSilent_silentFlow: 61,\r\n    logout: 961,\r\n    logoutPopup: 962,\r\n};\r\n/*\r\n * Interaction type of the API - used for state and telemetry\r\n */\r\nvar InteractionType;\r\n(function (InteractionType) {\r\n    InteractionType[\"Redirect\"] = \"redirect\";\r\n    InteractionType[\"Popup\"] = \"popup\";\r\n    InteractionType[\"Silent\"] = \"silent\";\r\n    InteractionType[\"None\"] = \"none\";\r\n})(InteractionType || (InteractionType = {}));\r\n/**\r\n * Types of interaction currently in progress.\r\n * Used in events in wrapper libraries to invoke functions when certain interaction is in progress or all interactions are complete.\r\n */\r\nconst InteractionStatus = {\r\n    /**\r\n     * Initial status before interaction occurs\r\n     */\r\n    Startup: \"startup\",\r\n    /**\r\n     * Status set when all login calls occuring\r\n     */\r\n    Login: \"login\",\r\n    /**\r\n     * Status set when logout call occuring\r\n     */\r\n    Logout: \"logout\",\r\n    /**\r\n     * Status set for acquireToken calls\r\n     */\r\n    AcquireToken: \"acquireToken\",\r\n    /**\r\n     * Status set for ssoSilent calls\r\n     */\r\n    SsoSilent: \"ssoSilent\",\r\n    /**\r\n     * Status set when handleRedirect in progress\r\n     */\r\n    HandleRedirect: \"handleRedirect\",\r\n    /**\r\n     * Status set when interaction is complete\r\n     */\r\n    None: \"none\",\r\n};\r\nconst DEFAULT_REQUEST = {\r\n    scopes: OIDC_DEFAULT_SCOPES,\r\n};\r\n/**\r\n * JWK Key Format string (Type MUST be defined for window crypto APIs)\r\n */\r\nconst KEY_FORMAT_JWK = \"jwk\";\r\n// Supported wrapper SKUs\r\nconst WrapperSKU = {\r\n    React: \"@azure/msal-react\",\r\n    Angular: \"@azure/msal-angular\",\r\n};\r\n// DatabaseStorage Constants\r\nconst DB_NAME = \"msal.db\";\r\nconst DB_VERSION = 1;\r\nconst DB_TABLE_NAME = `${DB_NAME}.keys`;\r\nconst CacheLookupPolicy = {\r\n    /*\r\n     * acquireTokenSilent will attempt to retrieve an access token from the cache. If the access token is expired\r\n     * or cannot be found the refresh token will be used to acquire a new one. Finally, if the refresh token\r\n     * is expired acquireTokenSilent will attempt to acquire new access and refresh tokens.\r\n     */\r\n    Default: 0,\r\n    /*\r\n     * acquireTokenSilent will only look for access tokens in the cache. It will not attempt to renew access or\r\n     * refresh tokens.\r\n     */\r\n    AccessToken: 1,\r\n    /*\r\n     * acquireTokenSilent will attempt to retrieve an access token from the cache. If the access token is expired or\r\n     * cannot be found, the refresh token will be used to acquire a new one. If the refresh token is expired, it\r\n     * will not be renewed and acquireTokenSilent will fail.\r\n     */\r\n    AccessTokenAndRefreshToken: 2,\r\n    /*\r\n     * acquireTokenSilent will not attempt to retrieve access tokens from the cache and will instead attempt to\r\n     * exchange the cached refresh token for a new access token. If the refresh token is expired, it will not be\r\n     * renewed and acquireTokenSilent will fail.\r\n     */\r\n    RefreshToken: 3,\r\n    /*\r\n     * acquireTokenSilent will not look in the cache for the access token. It will go directly to network with the\r\n     * cached refresh token. If the refresh token is expired an attempt will be made to renew it. This is equivalent to\r\n     * setting \"forceRefresh: true\".\r\n     */\r\n    RefreshTokenAndNetwork: 4,\r\n    /*\r\n     * acquireTokenSilent will attempt to renew both access and refresh tokens. It will not look in the cache. This will\r\n     * always fail if 3rd party cookies are blocked by the browser.\r\n     */\r\n    Skip: 5,\r\n};\r\nconst iFrameRenewalPolicies = [\r\n    CacheLookupPolicy.Default,\r\n    CacheLookupPolicy.Skip,\r\n    CacheLookupPolicy.RefreshTokenAndNetwork,\r\n];\n\nexport { ApiId, BrowserCacheLocation, BrowserConstants, CacheLookupPolicy, DB_NAME, DB_TABLE_NAME, DB_VERSION, DEFAULT_REQUEST, HTTP_REQUEST_TYPE, INTERACTION_TYPE, InMemoryCacheKeys, InteractionStatus, InteractionType, KEY_FORMAT_JWK, NativeExtensionMethod, PlatformAuthConstants, TemporaryCacheKeys, WrapperSKU, iFrameRenewalPolicies };\n//# sourceMappingURL=BrowserConstants.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst storageNotSupported = \"storage_not_supported\";\r\nconst stubbedPublicClientApplicationCalled = \"stubbed_public_client_application_called\";\r\nconst inMemRedirectUnavailable = \"in_mem_redirect_unavailable\";\n\nexport { inMemRedirectUnavailable, storageNotSupported, stubbedPublicClientApplicationCalled };\n//# sourceMappingURL=BrowserConfigurationAuthErrorCodes.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { AuthError } from '@azure/msal-common/browser';\nimport { inMemRedirectUnavailable, stubbedPublicClientApplicationCalled, storageNotSupported } from './BrowserConfigurationAuthErrorCodes.mjs';\nimport * as BrowserConfigurationAuthErrorCodes from './BrowserConfigurationAuthErrorCodes.mjs';\nexport { BrowserConfigurationAuthErrorCodes };\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst BrowserConfigurationAuthErrorMessages = {\r\n    [storageNotSupported]: \"Given storage configuration option was not supported.\",\r\n    [stubbedPublicClientApplicationCalled]: \"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors\",\r\n    [inMemRedirectUnavailable]: \"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true.\",\r\n};\r\n/**\r\n * BrowserAuthErrorMessage class containing string constants used by error codes and messages.\r\n * @deprecated Use BrowserAuthErrorCodes instead\r\n */\r\nconst BrowserConfigurationAuthErrorMessage = {\r\n    storageNotSupportedError: {\r\n        code: storageNotSupported,\r\n        desc: BrowserConfigurationAuthErrorMessages[storageNotSupported],\r\n    },\r\n    stubPcaInstanceCalled: {\r\n        code: stubbedPublicClientApplicationCalled,\r\n        desc: BrowserConfigurationAuthErrorMessages[stubbedPublicClientApplicationCalled],\r\n    },\r\n    inMemRedirectUnavailable: {\r\n        code: inMemRedirectUnavailable,\r\n        desc: BrowserConfigurationAuthErrorMessages[inMemRedirectUnavailable],\r\n    },\r\n};\r\n/**\r\n * Browser library error class thrown by the MSAL.js library for SPAs\r\n */\r\nclass BrowserConfigurationAuthError extends AuthError {\r\n    constructor(errorCode, errorMessage) {\r\n        super(errorCode, errorMessage);\r\n        this.name = \"BrowserConfigurationAuthError\";\r\n        Object.setPrototypeOf(this, BrowserConfigurationAuthError.prototype);\r\n    }\r\n}\r\nfunction createBrowserConfigurationAuthError(errorCode) {\r\n    return new BrowserConfigurationAuthError(errorCode, BrowserConfigurationAuthErrorMessages[errorCode]);\r\n}\n\nexport { BrowserConfigurationAuthError, BrowserConfigurationAuthErrorMessage, BrowserConfigurationAuthErrorMessages, createBrowserConfigurationAuthError };\n//# sourceMappingURL=BrowserConfigurationAuthError.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { createBrowserConfigurationAuthError } from '../error/BrowserConfigurationAuthError.mjs';\nimport { stubbedPublicClientApplicationCalled } from '../error/BrowserConfigurationAuthErrorCodes.mjs';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst stubbedPublicClientApplication = {\r\n    initialize: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenSilent: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenByCode: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    getAllAccounts: () => {\r\n        return [];\r\n    },\r\n    getAccount: () => {\r\n        return null;\r\n    },\r\n    getAccountByHomeId: () => {\r\n        return null;\r\n    },\r\n    getAccountByUsername: () => {\r\n        return null;\r\n    },\r\n    getAccountByLocalId: () => {\r\n        return null;\r\n    },\r\n    handleRedirectPromise: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    loginPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    loginRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logout: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logoutRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logoutPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    ssoSilent: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    addEventCallback: () => {\r\n        return null;\r\n    },\r\n    removeEventCallback: () => {\r\n        return;\r\n    },\r\n    addPerformanceCallback: () => {\r\n        return \"\";\r\n    },\r\n    removePerformanceCallback: () => {\r\n        return false;\r\n    },\r\n    enableAccountStorageEvents: () => {\r\n        return;\r\n    },\r\n    disableAccountStorageEvents: () => {\r\n        return;\r\n    },\r\n    getTokenCache: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    getLogger: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    setLogger: () => {\r\n        return;\r\n    },\r\n    setActiveAccount: () => {\r\n        return;\r\n    },\r\n    getActiveAccount: () => {\r\n        return null;\r\n    },\r\n    initializeWrapperLibrary: () => {\r\n        return;\r\n    },\r\n    setNavigationClient: () => {\r\n        return;\r\n    },\r\n    getConfiguration: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    hydrateCache: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    clearCache: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n};\n\nexport { stubbedPublicClientApplication };\n//# sourceMappingURL=IPublicClientApplication.mjs.map\n","/*! @azure/msal-react v3.0.19 2025-08-19 */\n'use strict';\nimport * as React from 'react';\nimport { Logger, InteractionStatus, stubbedPublicClientApplication } from '@azure/msal-browser';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/*\r\n * Stubbed context implementation\r\n * Only used when there is no provider, which is an unsupported scenario\r\n */\r\nconst defaultMsalContext = {\r\n    instance: stubbedPublicClientApplication,\r\n    inProgress: InteractionStatus.None,\r\n    accounts: [],\r\n    logger: new Logger({}),\r\n};\r\nconst MsalContext = React.createContext(defaultMsalContext);\r\nconst MsalConsumer = MsalContext.Consumer;\n\nexport { MsalConsumer, MsalContext };\n//# sourceMappingURL=MsalContext.js.map\n","/*! @azure/msal-react v3.0.19 2025-08-19 */\n'use strict';\nimport { useContext } from 'react';\nimport { MsalContext } from '../MsalContext.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Returns Msal Context values\r\n */\r\nconst useMsal = () => useContext(MsalContext);\n\nexport { useMsal };\n//# sourceMappingURL=useMsal.js.map\n","import { Configuration, PopupRequest, RedirectRequest } from '@azure/msal-browser';\r\n\r\n/**\r\n * Azure AD B2C / Entra ID Configuration\r\n * \r\n * Configure these values with your Azure AD tenant information:\r\n * - clientId: Application (client) ID from Azure AD app registration\r\n * - authority: Azure AD tenant authority URL\r\n * - redirectUri: Redirect URI configured in Azure AD app registration\r\n */\r\nexport const msalConfig: Configuration = {\r\n  auth: {\r\n    clientId: import.meta.env.VITE_AZURE_CLIENT_ID || 'your-client-id-here', \r\n    authority: import.meta.env.VITE_AZURE_AUTHORITY || `https://login.microsoftonline.com/${import.meta.env.VITE_AZURE_TENANT_ID}`,\r\n    redirectUri: import.meta.env.VITE_AZURE_REDIRECT_URI || window.location.origin,\r\n    postLogoutRedirectUri: import.meta.env.VITE_AZURE_POST_LOGOUT_REDIRECT_URI || window.location.origin,\r\n  },\r\n  cache: {\r\n    cacheLocation: 'sessionStorage', // This configures where your cache will be stored\r\n    storeAuthStateInCookie: false, // Set this to \"true\" if you are having issues on IE11 or Edge\r\n  },\r\n  system: {\r\n    loggerOptions: {\r\n      loggerCallback: (level, message, containsPii) => {\r\n        if (containsPii) {\r\n          return;\r\n        }\r\n        switch (level) {\r\n          case 0: // LogLevel.Error\r\n            console.error('[MSAL Error]:', message);\r\n            break;\r\n          case 1: // LogLevel.Warning\r\n            console.warn('[MSAL Warning]:', message);\r\n            break;\r\n          case 2: // LogLevel.Info\r\n            console.info('[MSAL Info]:', message);\r\n            break;\r\n          case 3: // LogLevel.Verbose\r\n            console.debug('[MSAL Verbose]:', message);\r\n            break;\r\n        }\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * Scopes you add here will be prompted for user consent during sign-in.\r\n * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\r\n */\r\nexport const loginRequest: RedirectRequest = {\r\n  scopes: [\r\n    'openid',\r\n    'profile',\r\n    'email',\r\n    'User.Read', // Microsoft Graph API scope for reading user profile\r\n  ],\r\n};\r\n\r\n/**\r\n * An optional silentRequest object can be used to achieve silent SSO\r\n * between applications by providing a \"login_hint\" property.\r\n */\r\nexport const silentRequest: PopupRequest = {\r\n  scopes: ['openid', 'profile', 'email', 'User.Read'],\r\n  loginHint: 'example@domain.com', // Used for silent SSO\r\n};\r\n\r\n/**\r\n * Application roles for RBAC\r\n * These should match the app roles defined in your Azure AD app registration\r\n */\r\nexport const APP_ROLES = {\r\n  ADMIN: 'Admin',\r\n  CONTROL_PANEL: 'ControlPanel',\r\n} as const;\r\n\r\n/**\r\n * Claims that contain role information\r\n * Roles can be provided via app roles or group membership\r\n */\r\nexport const ROLE_CLAIMS = {\r\n  APP_ROLES: 'roles', // App roles claim\r\n  GROUPS: 'groups', // Group membership claim\r\n} as const;\r\n\r\n/**\r\n * Group IDs for role mapping (if using groups instead of app roles)\r\n * Configure these with your Azure AD group object IDs\r\n */\r\nexport const ROLE_GROUPS = {\r\n  ADMIN_GROUP_ID: import.meta.env.VITE_AZURE_ADMIN_GROUP_ID || 'admin-group-id-here',\r\n  CONTROL_PANEL_GROUP_ID: import.meta.env.VITE_AZURE_CONTROL_PANEL_GROUP_ID || 'control-panel-group-id-here',\r\n} as const;\r\n\r\n/**\r\n * Default user role when no specific role is assigned\r\n */\r\nexport const DEFAULT_ROLE = APP_ROLES.CONTROL_PANEL;\r\n\r\nexport type UserRole = typeof APP_ROLES[keyof typeof APP_ROLES];","import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\nimport { \r\n  EventType, \r\n  EventMessage, \r\n  AccountInfo,\r\n  InteractionStatus,\r\n  PopupRequest,\r\n  RedirectRequest\r\n} from '@azure/msal-browser';\r\nimport { \r\n  useMsal, \r\n  useAccount, \r\n  useIsAuthenticated,\r\n  AuthenticatedTemplate as MsalAuthenticatedTemplate,\r\n  UnauthenticatedTemplate as MsalUnauthenticatedTemplate\r\n} from '@azure/msal-react';\r\nimport { loginRequest, ROLE_CLAIMS, APP_ROLES } from '@/config/authConfig';\r\nimport { setAuthenticatedUserId } from '@/utils';\r\n\r\n// Define the default role for users without specific roles\r\nconst DEFAULT_ROLE = 'User';\r\n\r\n// User information interface\r\nexport interface UserInfo {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  roles: string[];\r\n  primaryRole: string;\r\n  groups: string[];\r\n  preferredUsername?: string;\r\n  tenantId?: string;\r\n}\r\n\r\n// Authentication context interface\r\ninterface AuthContextType {\r\n  // User state\r\n  user: UserInfo | null;\r\n  isAuthenticated: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n\r\n  // Authentication methods\r\n  login: (request?: PopupRequest | RedirectRequest) => Promise<void>;\r\n  logout: (request?: PopupRequest | RedirectRequest) => Promise<void>;\r\n  clearError: () => void;\r\n\r\n  // Authorization helpers\r\n  hasRole: (role: string) => boolean;\r\n  hasAnyRole: (roles: string[]) => boolean;\r\n  isAdmin: () => boolean;\r\n  canAccessControlPanel: () => boolean;\r\n}\r\n\r\n// Create the context\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// Export the context so MockAuthProvider can use the same one\r\nexport { AuthContext };\r\n\r\n// Hook to use the auth context\r\nexport const useAuth = (): AuthContextType => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n/**\r\n * Extract user roles from account info based on group membership or token claims\r\n */\r\nconst extractUserRoles = (account: AccountInfo): string[] => {\r\n  const claims = account.idTokenClaims as any;\r\n  const roles: string[] = [];\r\n\r\n  // Check for roles in token claims (preferred method)\r\n  if (claims?.[ROLE_CLAIMS.APP_ROLES]) {\r\n    const tokenRoles = Array.isArray(claims[ROLE_CLAIMS.APP_ROLES]) \r\n      ? claims[ROLE_CLAIMS.APP_ROLES] \r\n      : [claims[ROLE_CLAIMS.APP_ROLES]];\r\n    roles.push(...tokenRoles);\r\n  }\r\n\r\n  // Check for group-based roles (fallback)\r\n  if (claims?.[ROLE_CLAIMS.GROUPS]) {\r\n    const groups = Array.isArray(claims[ROLE_CLAIMS.GROUPS]) \r\n      ? claims[ROLE_CLAIMS.GROUPS] \r\n      : [claims[ROLE_CLAIMS.GROUPS]];\r\n    \r\n    // Map group IDs to roles based on configuration\r\n    groups.forEach((groupId: string) => {\r\n      if (groupId === process.env.VITE_AZURE_AD_ADMIN_GROUP_ID) {\r\n        roles.push(APP_ROLES.ADMIN);\r\n      } else if (groupId === process.env.VITE_AZURE_AD_CONTROL_PANEL_GROUP_ID) {\r\n        roles.push(APP_ROLES.CONTROL_PANEL);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Remove duplicates and return\r\n  return [...new Set(roles)];\r\n};\r\n\r\n/**\r\n * Get the primary role for a user (highest priority role)\r\n */\r\nconst getPrimaryRole = (roles: string[]): string => {\r\n  // Admin has highest priority\r\n  if (roles.includes(APP_ROLES.ADMIN)) {\r\n    return APP_ROLES.ADMIN;\r\n  }\r\n  if (roles.includes(APP_ROLES.CONTROL_PANEL)) {\r\n    return APP_ROLES.CONTROL_PANEL;\r\n  }\r\n  return DEFAULT_ROLE;\r\n};\r\n\r\n/**\r\n * Create UserInfo from account\r\n */\r\nconst createUserInfo = (account: AccountInfo | null): UserInfo | null => {\r\n  if (!account) {\r\n    return null;\r\n  }\r\n\r\n  const roles = extractUserRoles(account);\r\n  const primaryRole = getPrimaryRole(roles);\r\n  const claims = account.idTokenClaims as any;\r\n\r\n  return {\r\n    id: account.localAccountId || account.homeAccountId,\r\n    email: account.username,\r\n    name: account.name || account.username,\r\n    roles,\r\n    primaryRole,\r\n    groups: claims?.[ROLE_CLAIMS.GROUPS] || [],\r\n    preferredUsername: claims?.preferred_username,\r\n    tenantId: account.tenantId,\r\n  };\r\n};\r\n\r\n// Auth Provider Component\r\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const { instance, accounts, inProgress } = useMsal();\r\n  const account = useAccount(accounts[0] || {});\r\n  const isAuthenticated = useIsAuthenticated();\r\n  \r\n  const [user, setUser] = useState<UserInfo | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Update user info when account changes\r\n  useEffect(() => {\r\n    const userInfo = createUserInfo(account);\r\n    setUser(userInfo);\r\n    \r\n    // Update the global user ID for API calls\r\n    if (userInfo) {\r\n      setAuthenticatedUserId(userInfo.id);\r\n    } else {\r\n      setAuthenticatedUserId(null);\r\n    }\r\n  }, [account]);\r\n\r\n  // Update loading state based on MSAL interaction status\r\n  useEffect(() => {\r\n    setIsLoading(inProgress !== InteractionStatus.None);\r\n  }, [inProgress]);\r\n\r\n  // Handle MSAL events\r\n  useEffect(() => {\r\n    const callbackId = instance.addEventCallback((event: EventMessage) => {\r\n      switch (event.eventType) {\r\n        case EventType.LOGIN_SUCCESS:\r\n          console.log('[Auth] Login successful');\r\n          setError(null);\r\n          break;\r\n        case EventType.LOGIN_FAILURE:\r\n          console.error('[Auth] Login failed:', event.error);\r\n          setError(event.error?.message || 'Login failed');\r\n          break;\r\n        case EventType.LOGOUT_SUCCESS:\r\n          console.log('[Auth] Logout successful');\r\n          setUser(null);\r\n          setError(null);\r\n          break;\r\n        case EventType.ACQUIRE_TOKEN_SUCCESS:\r\n          console.log('[Auth] Token acquired successfully');\r\n          setError(null);\r\n          break;\r\n        case EventType.ACQUIRE_TOKEN_FAILURE:\r\n          console.error('[Auth] Token acquisition failed:', event.error);\r\n          setError(event.error?.message || 'Token acquisition failed');\r\n          break;\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (callbackId) {\r\n        instance.removeEventCallback(callbackId);\r\n      }\r\n    };\r\n  }, [instance]);\r\n\r\n  // Authentication methods\r\n  const login = async (request?: PopupRequest | RedirectRequest): Promise<void> => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n      \r\n      const loginRequestWithDefaults = {\r\n        ...loginRequest,\r\n        ...request,\r\n      };\r\n\r\n      // Use popup login (you can change to redirect if preferred)\r\n      await instance.loginPopup(loginRequestWithDefaults);\r\n    } catch (error: any) {\r\n      console.error('[Auth] Login error:', error);\r\n      setError(error.message || 'Login failed');\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = async (request?: PopupRequest | RedirectRequest): Promise<void> => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n      \r\n      const logoutRequest = {\r\n        account: account || undefined,\r\n        ...request,\r\n      };\r\n\r\n      // Use popup logout (you can change to redirect if preferred)\r\n      await instance.logoutPopup(logoutRequest);\r\n    } catch (error: any) {\r\n      console.error('[Auth] Logout error:', error);\r\n      setError(error.message || 'Logout failed');\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const clearError = (): void => {\r\n    setError(null);\r\n  };\r\n\r\n  // Authorization helpers\r\n  const hasRole = (role: string): boolean => {\r\n    return user?.roles.includes(role) ?? false;\r\n  };\r\n\r\n  const hasAnyRole = (roles: string[]): boolean => {\r\n    return roles.some(role => hasRole(role));\r\n  };\r\n\r\n  const isAdmin = (): boolean => {\r\n    return hasRole(APP_ROLES.ADMIN);\r\n  };\r\n\r\n  const canAccessControlPanel = (): boolean => {\r\n    return hasAnyRole([APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]);\r\n  };\r\n\r\n  // Context value\r\n  const contextValue: AuthContextType = {\r\n    user,\r\n    isAuthenticated,\r\n    isLoading,\r\n    error,\r\n    login,\r\n    logout,\r\n    clearError,\r\n    hasRole,\r\n    hasAnyRole,\r\n    isAdmin,\r\n    canAccessControlPanel,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Conditional authentication templates\r\nconst isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\ninterface AuthTemplateProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AuthenticatedTemplate: React.FC<AuthTemplateProps> = ({ children }) => {\r\n  if (isAuthEnabled) {\r\n    return <MsalAuthenticatedTemplate>{children}</MsalAuthenticatedTemplate>;\r\n  } else {\r\n    // In mock mode, always show authenticated content\r\n    return <>{children}</>;\r\n  }\r\n};\r\n\r\nexport const UnauthenticatedTemplate: React.FC<AuthTemplateProps> = ({ children }) => {\r\n  if (isAuthEnabled) {\r\n    return <MsalUnauthenticatedTemplate>{children}</MsalUnauthenticatedTemplate>;\r\n  } else {\r\n    // In mock mode, never show unauthenticated content\r\n    return null;\r\n  }\r\n};","import React, { ReactNode } from 'react';\r\nimport { UserInfo, AuthContext } from '@/contexts/AuthContext';\r\n\r\n// Mock user for non-authenticated mode\r\nconst mockUser: UserInfo = {\r\n  id: 'mock-user-id',\r\n  email: 'anonymous@localhost',\r\n  name: 'Anonymous User',\r\n  roles: ['Admin'], // Give admin role for unrestricted access\r\n  primaryRole: 'Admin',\r\n  groups: [],\r\n  preferredUsername: 'anonymous',\r\n};\r\n\r\ninterface MockAuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const MockAuthProvider: React.FC<MockAuthProviderProps> = ({ children }) => {\r\n  const mockAuthValue = {\r\n    // User state - always \"authenticated\" with mock user\r\n    user: mockUser,\r\n    isAuthenticated: true,\r\n    isLoading: false,\r\n    error: null,\r\n\r\n    // Authentication methods (no-ops)\r\n    login: async () => {\r\n      console.log('Mock login called - no action taken');\r\n    },\r\n    logout: async () => {\r\n      console.log('Mock logout called - no action taken');\r\n    },\r\n    clearError: () => {\r\n      console.log('Mock clearError called - no action taken');\r\n    },\r\n\r\n    // Authorization helpers (always return true for unrestricted access)\r\n    hasRole: () => true,\r\n    hasAnyRole: () => true,\r\n    isAdmin: () => true,\r\n    canAccessControlPanel: () => true,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={mockAuthValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};","import React, { ReactNode } from 'react';\r\nimport { PublicClientApplication } from '@azure/msal-browser';\r\nimport { MsalProvider } from '@azure/msal-react';\r\nimport { AuthProvider } from '@/contexts/AuthContext';\r\nimport { MockAuthProvider } from '@/contexts/MockAuthContext';\r\nimport { msalConfig } from '@/config/authConfig';\r\n\r\ninterface ConditionalAuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\n// Create MSAL instance only if authentication is enabled\r\nconst isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\n// Log authentication mode for debugging\r\nconsole.log('Authentication mode:', isAuthEnabled ? 'Entra ID enabled' : 'Mock authentication enabled');\r\nconsole.log('VITE_ENABLE_ENTRA_AUTH:', import.meta.env.VITE_ENABLE_ENTRA_AUTH);\r\n\r\nconst msalInstance = isAuthEnabled ? new PublicClientApplication(msalConfig) : null;\r\n\r\nexport const ConditionalAuthProvider: React.FC<ConditionalAuthProviderProps> = ({ children }) => {\r\n  if (isAuthEnabled && msalInstance) {\r\n    // Use real Entra ID authentication\r\n    return (\r\n      <MsalProvider instance={msalInstance}>\r\n        <AuthProvider>\r\n          {children}\r\n        </AuthProvider>\r\n      </MsalProvider>\r\n    );\r\n  } else {\r\n    // Use mock authentication (no login required)\r\n    return (\r\n      <MockAuthProvider>\r\n        {children}\r\n      </MockAuthProvider>\r\n    );\r\n  }\r\n};","import React, { ReactNode } from 'react';\r\nimport { Navigate, useLocation } from 'react-router-dom';\r\nimport { useAuth, AuthenticatedTemplate, UnauthenticatedTemplate } from '@/contexts/AuthContext';\r\nimport { APP_ROLES, type UserRole } from '@/config/authConfig';\r\n\r\n/**\r\n * Props for authorization components\r\n */\r\ninterface AuthorizationProps {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  redirectTo?: string;\r\n}\r\n\r\ninterface RoleGuardProps extends AuthorizationProps {\r\n  roles: UserRole[];\r\n  requireAll?: boolean; // If true, user must have ALL roles, otherwise ANY role\r\n}\r\n\r\n/**\r\n * Login component for unauthenticated users\r\n */\r\nexport const LoginPrompt: React.FC = () => {\r\n  const { login, isLoading, error } = useAuth();\r\n\r\n  const handleLogin = () => {\r\n    login().catch(console.error);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-6xl mb-4 group cursor-pointer inline-block\">\r\n            <span className=\"group-hover:animate-brain-throb transition-transform duration-300\"></span>\r\n          </div>\r\n          <h2 className=\"text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n            Behavioral Health System\r\n          </h2>\r\n          <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\r\n            Please sign in to access the application\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {error && (\r\n            <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4\">\r\n              <div className=\"text-sm text-red-700 dark:text-red-300\">\r\n                {error}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <button\r\n            onClick={handleLogin}\r\n            disabled={isLoading}\r\n            className=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n          >\r\n            {isLoading ? (\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"animate-spin -ml-1 mr-3 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n                Signing in...\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"mr-2 h-4 w-4\" viewBox=\"0 0 21 21\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <rect x=\"1\" y=\"1\" width=\"9\" height=\"9\" fill=\"#f25022\"/>\r\n                  <rect x=\"1\" y=\"11\" width=\"9\" height=\"9\" fill=\"#00a4ef\"/>\r\n                  <rect x=\"11\" y=\"1\" width=\"9\" height=\"9\" fill=\"#7fba00\"/>\r\n                  <rect x=\"11\" y=\"11\" width=\"9\" height=\"9\" fill=\"#ffb900\"/>\r\n                </svg>\r\n                Sign in with Microsoft\r\n              </div>\r\n            )}\r\n          </button>\r\n          \r\n          <div className=\"text-center\">\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n              Sign in using your organizational account\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Component that requires authentication\r\n */\r\nexport const RequireAuth: React.FC<AuthorizationProps> = ({ \r\n  children, \r\n  fallback,\r\n  redirectTo \r\n}) => {\r\n  const location = useLocation();\r\n  \r\n  return (\r\n    <>\r\n      <AuthenticatedTemplate>\r\n        {children}\r\n      </AuthenticatedTemplate>\r\n      <UnauthenticatedTemplate>\r\n        {fallback || (\r\n          redirectTo ? (\r\n            <Navigate to={redirectTo} state={{ from: location }} replace />\r\n          ) : (\r\n            <LoginPrompt />\r\n          )\r\n        )}\r\n      </UnauthenticatedTemplate>\r\n    </>\r\n  );\r\n};\r\n\r\n/**\r\n * Component that requires specific roles\r\n */\r\nexport const RequireRole: React.FC<RoleGuardProps> = ({ \r\n  children, \r\n  roles, \r\n  requireAll = false,\r\n  fallback,\r\n  redirectTo \r\n}) => {\r\n  const { hasRole, hasAnyRole, user } = useAuth();\r\n  const location = useLocation();\r\n  \r\n  // Check if user has required roles\r\n  const hasAccess = requireAll \r\n    ? roles.every(role => hasRole(role))\r\n    : hasAnyRole(roles);\r\n  \r\n  if (!hasAccess) {\r\n    if (fallback) {\r\n      return <>{fallback}</>;\r\n    }\r\n    \r\n    if (redirectTo) {\r\n      return <Navigate to={redirectTo} state={{ from: location }} replace />;\r\n    }\r\n    \r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"max-w-md w-full text-center space-y-4\">\r\n          <div className=\"text-6xl mb-4\"></div>\r\n          <h2 className=\"text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n            Access Denied\r\n          </h2>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">\r\n            You don't have permission to access this resource.\r\n          </p>\r\n          <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\r\n              Required role{roles.length > 1 ? 's' : ''}: {roles.join(', ')}\r\n            </p>\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              Your role{user?.roles.length && user.roles.length > 1 ? 's' : ''}: {user?.roles.join(', ') || 'None'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return <>{children}</>;\r\n};\r\n\r\n/**\r\n * Component that requires admin role\r\n */\r\nexport const RequireAdmin: React.FC<AuthorizationProps> = (props) => (\r\n  <RequireRole {...props} roles={[APP_ROLES.ADMIN]} />\r\n);\r\n\r\n/**\r\n * Component that allows both admin and control panel roles\r\n */\r\nexport const RequireControlPanelAccess: React.FC<AuthorizationProps> = (props) => (\r\n  <RequireRole {...props} roles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]} />\r\n);\r\n\r\n/**\r\n * Hook for conditional rendering based on roles\r\n */\r\nexport const useRoleAccess = () => {\r\n  const { hasRole, hasAnyRole, isAdmin, canAccessControlPanel } = useAuth();\r\n  \r\n  return {\r\n    hasRole,\r\n    hasAnyRole,\r\n    isAdmin,\r\n    canAccessControlPanel,\r\n    // Convenience methods\r\n    canAccessAdminOnly: () => isAdmin(),\r\n    hasControlPanelAccess: () => canAccessControlPanel(),\r\n  };\r\n};\r\n\r\n/**\r\n * Route guard component for protecting routes\r\n */\r\ninterface ProtectedRouteProps {\r\n  children: ReactNode;\r\n  requireAuth?: boolean;\r\n  requireRoles?: UserRole[];\r\n  requireAll?: boolean;\r\n  fallback?: ReactNode;\r\n  redirectTo?: string;\r\n}\r\n\r\nexport const ProtectedRoute: React.FC<ProtectedRouteProps> = ({\r\n  children,\r\n  requireAuth = true,\r\n  requireRoles = [],\r\n  requireAll = false,\r\n  fallback,\r\n  redirectTo\r\n}) => {\r\n  if (!requireAuth && requireRoles.length === 0) {\r\n    return <>{children}</>;\r\n  }\r\n  \r\n  if (requireAuth && requireRoles.length === 0) {\r\n    return (\r\n      <RequireAuth fallback={fallback} redirectTo={redirectTo}>\r\n        {children}\r\n      </RequireAuth>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <RequireAuth fallback={fallback} redirectTo={redirectTo}>\r\n      <RequireRole \r\n        roles={requireRoles} \r\n        requireAll={requireAll} \r\n        fallback={fallback} \r\n        redirectTo={redirectTo}\r\n      >\r\n        {children}\r\n      </RequireRole>\r\n    </RequireAuth>\r\n  );\r\n};","import { useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\n/**\r\n * Component that redirects users to their appropriate default page based on their role\r\n */\r\nexport const RoleBasedRedirect: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user, isAuthenticated, isLoading, hasRole } = useAuth();\r\n\r\n  useEffect(() => {\r\n    // Wait for authentication to complete\r\n    if (isLoading || !isAuthenticated || !user) {\r\n      return;\r\n    }\r\n\r\n    // Only redirect from the root path\r\n    if (location.pathname !== '/') {\r\n      return;\r\n    }\r\n\r\n    // Determine default page based on user's primary role\r\n    let defaultPath = '/';\r\n\r\n    if (hasRole(APP_ROLES.CONTROL_PANEL) && !hasRole(APP_ROLES.ADMIN)) {\r\n      // ControlPanel users go to summary page by default\r\n      defaultPath = '/summary';\r\n    } else if (hasRole(APP_ROLES.ADMIN)) {\r\n      // Admin users stay on dashboard (current behavior)\r\n      defaultPath = '/';\r\n    } else {\r\n      // Default fallback\r\n      defaultPath = '/';\r\n    }\r\n\r\n    // Only navigate if we're changing paths\r\n    if (defaultPath !== location.pathname) {\r\n      navigate(defaultPath, { replace: true });\r\n    }\r\n  }, [user, isAuthenticated, isLoading, location.pathname, navigate, hasRole]);\r\n\r\n  // This component doesn't render anything\r\n  return null;\r\n};","import { useMsal } from '@azure/msal-react';\r\nimport { silentRequest } from '@/config/authConfig';\r\n\r\n/**\r\n * Authentication provider for API client\r\n * Provides access tokens and user context for API requests\r\n */\r\nexport class AuthProvider {\r\n  private msalInstance: any;\r\n  private accounts: any;\r\n\r\n  constructor(msalInstance: any, accounts: any) {\r\n    this.msalInstance = msalInstance;\r\n    this.accounts = accounts;\r\n  }\r\n\r\n  /**\r\n   * Get authentication headers for API requests\r\n   */\r\n  async getAuthHeaders(): Promise<Record<string, string>> {\r\n    if (!this.accounts || this.accounts.length === 0) {\r\n      return {}; // Return empty headers if not authenticated\r\n    }\r\n\r\n    try {\r\n      // Get access token silently\r\n      const response = await this.msalInstance.acquireTokenSilent({\r\n        ...silentRequest,\r\n        account: this.accounts[0],\r\n      });\r\n\r\n      return {\r\n        'Authorization': `Bearer ${response.accessToken}`,\r\n        'X-User-ID': this.accounts[0].homeAccountId,\r\n        'X-User-Principal': this.accounts[0].username,\r\n      };\r\n    } catch (error) {\r\n      console.warn('Failed to acquire access token silently:', error);\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user information for API context\r\n   */\r\n  getUserContext() {\r\n    if (!this.accounts || this.accounts.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const account = this.accounts[0];\r\n    return {\r\n      userId: account.homeAccountId,\r\n      username: account.username,\r\n      name: account.name,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Hook to create auth provider from MSAL context\r\n */\r\nexport const useAuthProvider = () => {\r\n  const { instance, accounts } = useMsal();\r\n  \r\n  return new AuthProvider(instance, accounts);\r\n};","import { config, API_ENDPOINTS } from '@/config/constants';\r\nimport { createAppError, isNetworkError } from '@/utils';\r\nimport type {\r\n  SessionInitiateRequest,\r\n  SessionInitiateResponse,\r\n  PredictionSubmitRequest,\r\n  PredictionSubmitResponse,\r\n  PredictionResult,\r\n  HealthCheckResponse,\r\n  SessionData,\r\n  RiskAssessment,\r\n  AppError,\r\n} from '@/types';\r\n\r\n// Type for authentication context\r\ninterface AuthHeaders {\r\n  getAuthHeaders(): Promise<Record<string, string>>;\r\n}\r\n\r\n// Base API client with error handling and authentication\r\nclass ApiClient {\r\n  private baseUrl: string;\r\n  private authProvider?: AuthHeaders;\r\n\r\n  constructor(baseUrl: string, authProvider?: AuthHeaders) {\r\n    this.baseUrl = baseUrl;\r\n    this.authProvider = authProvider;\r\n  }\r\n\r\n  setAuthProvider(authProvider: AuthHeaders) {\r\n    this.authProvider = authProvider;\r\n  }\r\n\r\n  private async handleResponse<T>(response: Response): Promise<T> {\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      \r\n      throw createAppError(\r\n        `HTTP_${response.status}`,\r\n        errorData.message || `HTTP ${response.status}: ${response.statusText}`,\r\n        {\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          data: errorData,\r\n        }\r\n      );\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  private async request<T>(\r\n    endpoint: string,\r\n    options: RequestInit = {}\r\n  ): Promise<T> {\r\n    try {\r\n      // Handle trailing/leading slashes to avoid double slashes\r\n      const baseUrl = this.baseUrl.endsWith('/') ? this.baseUrl.slice(0, -1) : this.baseUrl;\r\n      const cleanEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\r\n      const url = `${baseUrl}${cleanEndpoint}`;\r\n      \r\n      const defaultHeaders = {\r\n        'Content-Type': 'application/json',\r\n        ...options.headers,\r\n      };\r\n\r\n      // Add authentication headers if available\r\n      if (this.authProvider) {\r\n        try {\r\n          const authHeaders = await this.authProvider.getAuthHeaders();\r\n          Object.assign(defaultHeaders, authHeaders);\r\n        } catch (authError) {\r\n          // Log auth error but continue with request - some endpoints may not require auth\r\n          console.warn('Failed to get authentication headers:', authError);\r\n        }\r\n      }\r\n\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers: defaultHeaders,\r\n      });\r\n\r\n      return this.handleResponse<T>(response);\r\n    } catch (error) {\r\n      if (isNetworkError(error)) {\r\n        throw createAppError(\r\n          'NETWORK_ERROR',\r\n          'Unable to connect to the server. Please check your internet connection.',\r\n          { originalError: error }\r\n        );\r\n      }\r\n      \r\n      if (error instanceof Error && 'code' in error) {\r\n        throw error; // Re-throw AppError\r\n      }\r\n      \r\n      throw createAppError(\r\n        'UNKNOWN_ERROR',\r\n        'An unexpected error occurred',\r\n        { originalError: error }\r\n      );\r\n    }\r\n  }\r\n\r\n  async get<T>(endpoint: string): Promise<T> {\r\n    return this.request<T>(endpoint, { method: 'GET' });\r\n  }\r\n\r\n  async post<T>(endpoint: string, data?: unknown): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: 'POST',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  async put<T>(endpoint: string, data?: unknown): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: 'PUT',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  async delete<T>(endpoint: string): Promise<T> {\r\n    return this.request<T>(endpoint, { method: 'DELETE' });\r\n  }\r\n}\r\n\r\n// Create API client instance\r\nconst apiClient = new ApiClient(config.api.baseUrl);\r\n\r\n// Function to set authentication provider (called from app initialization)\r\nexport const setApiAuthProvider = (authProvider: AuthHeaders) => {\r\n  apiClient.setAuthProvider(authProvider);\r\n};\r\n\r\n// API Service functions\r\nexport const apiService = {\r\n  // Health check\r\n  async checkHealth(): Promise<HealthCheckResponse> {\r\n    return apiClient.get<HealthCheckResponse>(API_ENDPOINTS.HEALTH);\r\n  },\r\n\r\n  // Session management\r\n  async initiateSession(request: SessionInitiateRequest): Promise<SessionInitiateResponse> {\r\n    return apiClient.post<SessionInitiateResponse>(\r\n      API_ENDPOINTS.SESSIONS_INITIATE,\r\n      request\r\n    );\r\n  },\r\n\r\n  // Prediction submission\r\n  async submitPrediction(request: PredictionSubmitRequest): Promise<PredictionSubmitResponse> {\r\n    return apiClient.post<PredictionSubmitResponse>(\r\n      API_ENDPOINTS.PREDICTIONS_SUBMIT,\r\n      request\r\n    );\r\n  },\r\n\r\n  // Get prediction results\r\n  async getPredictionBySessionId(sessionId: string): Promise<PredictionResult> {\r\n    return apiClient.get<PredictionResult>(\r\n      `${API_ENDPOINTS.PREDICTIONS_BY_SESSION}/${sessionId}`\r\n    );\r\n  },\r\n\r\n  // Get user predictions\r\n  async getUserPredictions(userId: string): Promise<PredictionResult[]> {\r\n    return apiClient.get<PredictionResult[]>(\r\n      `${API_ENDPOINTS.PREDICTIONS_BY_USER}/${userId}`\r\n    );\r\n  },\r\n\r\n  // Session Storage API methods\r\n  async saveSessionData(sessionData: SessionData): Promise<{ success: boolean; sessionId: string; message: string }> {\r\n    return apiClient.post<{ success: boolean; sessionId: string; message: string }>(\r\n      'sessions',\r\n      sessionData\r\n    );\r\n  },\r\n\r\n  async getSessionData(sessionId: string): Promise<SessionData> {\r\n    return apiClient.get<SessionData>(`sessions/${sessionId}`);\r\n  },\r\n\r\n  async getUserSessions(userId: string): Promise<{ success: boolean; count: number; sessions: SessionData[] }> {\r\n    return apiClient.get<{ success: boolean; count: number; sessions: SessionData[] }>(\r\n      `sessions/users/${userId}`\r\n    );\r\n  },\r\n\r\n  async getAllSessions(): Promise<{ success: boolean; count: number; sessions: SessionData[] }> {\r\n    return apiClient.get<{ success: boolean; count: number; sessions: SessionData[] }>(\r\n      'sessions/all'\r\n    );\r\n  },\r\n\r\n  async updateSessionData(sessionId: string, sessionData: SessionData): Promise<{ success: boolean; message: string }> {\r\n    return apiClient.put<{ success: boolean; message: string }>(\r\n      `sessions/${sessionId}`,\r\n      sessionData\r\n    );\r\n  },\r\n\r\n  async deleteSessionData(sessionId: string): Promise<{ success: boolean; message: string }> {\r\n    return apiClient.delete<{ success: boolean; message: string }>(\r\n      `sessions/${sessionId}`\r\n    );\r\n  },\r\n\r\n  // Test API connection\r\n  async testConnection(): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      await this.checkHealth();\r\n      return { success: true, message: 'API connection successful' };\r\n    } catch (error) {\r\n      const appError = error as AppError;\r\n      return { \r\n        success: false, \r\n        message: appError.message || 'Connection test failed' \r\n      };\r\n    }\r\n  },\r\n\r\n\r\n\r\n  // Risk Assessment API methods\r\n  async generateRiskAssessment(sessionId: string): Promise<{ success: boolean; riskAssessment?: RiskAssessment; message: string }> {\r\n    return apiClient.post<{ success: boolean; riskAssessment?: RiskAssessment; message: string }>(\r\n      `sessions/${sessionId}/risk-assessment`\r\n    );\r\n  },\r\n\r\n  async getRiskAssessment(sessionId: string): Promise<{ success: boolean; riskAssessment?: RiskAssessment; message: string }> {\r\n    return apiClient.get<{ success: boolean; riskAssessment?: RiskAssessment; message: string }>(\r\n      `sessions/${sessionId}/risk-assessment`\r\n    );\r\n  },\r\n\r\n  // Grammar Correction API methods\r\n  async correctGrammar(text: string): Promise<{ originalText: string; correctedText: string }> {\r\n    return apiClient.post<{ originalText: string; correctedText: string }>(\r\n      'CorrectGrammar',\r\n      { text }\r\n    );\r\n  },\r\n};\r\n\r\n// Polling utilities\r\nexport class PredictionPoller {\r\n  private sessionId: string;\r\n  private intervalMs: number;\r\n  private maxAttempts: number;\r\n  private backoffFactor: number;\r\n  private currentAttempt = 0;\r\n  private timeoutId: number | null = null;\r\n  private isPolling = false;\r\n\r\n  constructor(\r\n    sessionId: string,\r\n    options: {\r\n      intervalMs?: number;\r\n      maxAttempts?: number;\r\n      backoffFactor?: number;\r\n    } = {}\r\n  ) {\r\n    this.sessionId = sessionId;\r\n    this.intervalMs = options.intervalMs || config.polling.intervalMs;\r\n    this.maxAttempts = options.maxAttempts || config.polling.maxAttempts;\r\n    this.backoffFactor = options.backoffFactor || config.polling.backoffFactor;\r\n  }\r\n\r\n  async start(\r\n    onUpdate: (result: PredictionResult) => void,\r\n    onComplete: (result: PredictionResult) => void,\r\n    onError: (error: AppError) => void\r\n  ): Promise<void> {\r\n    if (this.isPolling) {\r\n      return;\r\n    }\r\n\r\n    this.isPolling = true;\r\n    this.currentAttempt = 0;\r\n\r\n    const poll = async (): Promise<void> => {\r\n      try {\r\n        const result = await apiService.getPredictionBySessionId(this.sessionId);\r\n        \r\n        onUpdate(result);\r\n\r\n        if (result.status === 'succeeded' || result.status === 'success' || result.status === 'failed') {\r\n          this.stop();\r\n          onComplete(result);\r\n          return;\r\n        }\r\n\r\n        this.currentAttempt++;\r\n\r\n        if (this.currentAttempt >= this.maxAttempts) {\r\n          this.stop();\r\n          onError(createAppError(\r\n            'POLLING_TIMEOUT',\r\n            'Prediction polling timed out. Please check the session manually.',\r\n            { sessionId: this.sessionId, attempts: this.currentAttempt }\r\n          ));\r\n          return;\r\n        }\r\n\r\n        // Schedule next poll with exponential backoff\r\n        const nextInterval = this.intervalMs * Math.pow(this.backoffFactor, this.currentAttempt);\r\n        this.timeoutId = window.setTimeout(poll, nextInterval);\r\n\r\n      } catch (error) {\r\n        this.stop();\r\n        onError(error as AppError);\r\n      }\r\n    };\r\n\r\n    // Start polling immediately\r\n    await poll();\r\n  }\r\n\r\n  stop(): void {\r\n    this.isPolling = false;\r\n    if (this.timeoutId) {\r\n      clearTimeout(this.timeoutId);\r\n      this.timeoutId = null;\r\n    }\r\n  }\r\n\r\n  getStatus(): { isPolling: boolean; attempt: number; maxAttempts: number } {\r\n    return {\r\n      isPolling: this.isPolling,\r\n      attempt: this.currentAttempt,\r\n      maxAttempts: this.maxAttempts,\r\n    };\r\n  }\r\n}\r\n\r\n\r\n// Export PredictionResult type for external use\r\nexport type { PredictionResult } from '@/types';\r\n","import { useEffect } from 'react';\r\nimport { useAuthProvider } from '@/services/authProvider';\r\nimport { setApiAuthProvider } from '@/services/api';\r\n\r\n/**\r\n * Component that initializes the API authentication provider\r\n * Must be used within MsalProvider context\r\n */\r\nexport const ApiAuthInitializer: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const authProvider = useAuthProvider();\r\n\r\n  useEffect(() => {\r\n    // Set the auth provider for the API client\r\n    setApiAuthProvider(authProvider);\r\n  }, [authProvider]);\r\n\r\n  return <>{children}</>;\r\n};","import { useEffect, useRef, useCallback } from 'react';\r\nimport { announceToScreenReader, focusElement, trapFocus, debounce } from '@/utils';\r\nimport { A11Y } from '@/config/constants';\r\n// import type { A11yAnnouncement } from '@/types'; // Commented out until used\r\n\r\n// Screen reader announcements\r\nexport const useAnnouncements = () => {\r\n  const announce = useCallback((\r\n    message: string, \r\n    priority: 'polite' | 'assertive' = 'polite'\r\n  ) => {\r\n    announceToScreenReader(message, priority);\r\n  }, []);\r\n\r\n  const announceError = useCallback((message: string) => {\r\n    announce(message, 'assertive');\r\n  }, [announce]);\r\n\r\n  const announceSuccess = useCallback((message: string) => {\r\n    announce(message, 'polite');\r\n  }, [announce]);\r\n\r\n  return {\r\n    announce,\r\n    announceError,\r\n    announceSuccess,\r\n  };\r\n};\r\n\r\n// Focus management\r\nexport const useFocusManagement = () => {\r\n  const focusById = useCallback((elementId: string, delay?: number) => {\r\n    focusElement(elementId, delay);\r\n  }, []);\r\n\r\n  const focusFirst = useCallback((container?: HTMLElement) => {\r\n    const target = container || document;\r\n    const firstFocusable = target.querySelector(\r\n      'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\r\n    ) as HTMLElement;\r\n    \r\n    if (firstFocusable) {\r\n      firstFocusable.focus();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    focusById,\r\n    focusFirst,\r\n  };\r\n};\r\n\r\n// Focus trap for modals and dialogs\r\nexport const useFocusTrap = (isActive: boolean) => {\r\n  const containerRef = useRef<HTMLElement>(null);\r\n  const trapRef = useRef<{ release: () => void } | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (isActive && containerRef.current) {\r\n      trapRef.current = trapFocus(containerRef.current);\r\n    }\r\n\r\n    return () => {\r\n      if (trapRef.current) {\r\n        trapRef.current.release();\r\n        trapRef.current = null;\r\n      }\r\n    };\r\n  }, [isActive]);\r\n\r\n  return containerRef;\r\n};\r\n\r\n// Keyboard navigation\r\nexport const useKeyboardNavigation = () => {\r\n  const handleEscape = useCallback((callback: () => void) => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault();\r\n        callback();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, []);\r\n\r\n  const handleEnterSpace = useCallback((callback: () => void) => {\r\n    return (event: React.KeyboardEvent) => {\r\n      if (event.key === 'Enter' || event.key === ' ') {\r\n        event.preventDefault();\r\n        callback();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    handleEscape,\r\n    handleEnterSpace,\r\n  };\r\n};\r\n\r\n// ARIA live regions for dynamic content\r\nexport const useAriaLive = () => {\r\n  const liveRegionRef = useRef<HTMLDivElement>(null);\r\n\r\n  const updateLiveRegion = useCallback((\r\n    message: string,\r\n    priority: 'polite' | 'assertive' = 'polite'\r\n  ) => {\r\n    if (liveRegionRef.current) {\r\n      liveRegionRef.current.setAttribute('aria-live', priority);\r\n      liveRegionRef.current.textContent = message;\r\n    }\r\n  }, []);\r\n\r\n  const clearLiveRegion = useCallback(() => {\r\n    if (liveRegionRef.current) {\r\n      liveRegionRef.current.textContent = '';\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    liveRegionRef,\r\n    updateLiveRegion,\r\n    clearLiveRegion,\r\n  };\r\n};\r\n\r\n// Progress announcements with debouncing\r\nexport const useProgressAnnouncement = () => {\r\n  const lastAnnouncedProgress = useRef(-1);\r\n\r\n  const debouncedProgressAnnounce = debounce((...args: unknown[]) => {\r\n    const progress = args[0] as number;\r\n    const message = args[1] as string;\r\n    // Only announce significant progress changes\r\n    if (Math.abs(progress - lastAnnouncedProgress.current) >= 10 || progress === 100) {\r\n      announceToScreenReader(`${message} ${progress}% complete`, 'polite');\r\n      lastAnnouncedProgress.current = progress;\r\n    }\r\n  }, A11Y.DEBOUNCE_MS);\r\n\r\n  const announceProgress = useCallback(debouncedProgressAnnounce, []);\r\n\r\n  return { announceProgress };\r\n};\r\n\r\n// Skip to content functionality\r\nexport const useSkipToContent = () => {\r\n  const skipToMain = useCallback(() => {\r\n    focusElement(A11Y.SKIP_TO_CONTENT_ID, A11Y.FOCUS_TIMEOUT);\r\n  }, []);\r\n\r\n  return { skipToMain };\r\n};\r\n\r\n// Form accessibility helpers\r\nexport const useFormAccessibility = () => {\r\n  const getFieldId = useCallback((name: string) => `field-${name}`, []);\r\n  const getErrorId = useCallback((name: string) => `error-${name}`, []);\r\n  const getDescriptionId = useCallback((name: string) => `description-${name}`, []);\r\n\r\n  const getFieldProps = useCallback((\r\n    name: string,\r\n    hasError: boolean,\r\n    hasDescription: boolean\r\n  ) => {\r\n    const props: React.InputHTMLAttributes<HTMLInputElement> = {\r\n      id: getFieldId(name),\r\n      'aria-invalid': hasError,\r\n    };\r\n\r\n    const describedBy: string[] = [];\r\n    \r\n    if (hasError) {\r\n      describedBy.push(getErrorId(name));\r\n    }\r\n    \r\n    if (hasDescription) {\r\n      describedBy.push(getDescriptionId(name));\r\n    }\r\n\r\n    if (describedBy.length > 0) {\r\n      props['aria-describedby'] = describedBy.join(' ');\r\n    }\r\n\r\n    return props;\r\n  }, [getFieldId, getErrorId, getDescriptionId]);\r\n\r\n  return {\r\n    getFieldId,\r\n    getErrorId,\r\n    getDescriptionId,\r\n    getFieldProps,\r\n  };\r\n};\r\n\r\n// Status announcements for file uploads and processing\r\nexport const useStatusAnnouncements = () => {\r\n  const announceUploadStart = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Starting upload of ${fileName}`, 'polite');\r\n  }, []);\r\n\r\n  const announceUploadComplete = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Upload of ${fileName} completed successfully`, 'polite');\r\n  }, []);\r\n\r\n  const announceConversionStart = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Starting audio conversion for ${fileName}`, 'polite');\r\n  }, []);\r\n\r\n  const announceConversionComplete = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Audio conversion for ${fileName} completed`, 'polite');\r\n  }, []);\r\n\r\n  const announcePredictionStart = useCallback((sessionId: string) => {\r\n    announceToScreenReader(`Starting behavioral health prediction for session ${sessionId}`, 'polite');\r\n  }, []);\r\n\r\n  const announcePredictionComplete = useCallback((sessionId: string) => {\r\n    announceToScreenReader(`Behavioral health prediction completed for session ${sessionId}`, 'polite');\r\n  }, []);\r\n\r\n  const announceError = useCallback((operation: string, error: string) => {\r\n    announceToScreenReader(`Error during ${operation}: ${error}`, 'assertive');\r\n  }, []);\r\n\r\n  return {\r\n    announceUploadStart,\r\n    announceUploadComplete,\r\n    announceConversionStart,\r\n    announceConversionComplete,\r\n    announcePredictionStart,\r\n    announcePredictionComplete,\r\n    announceError,\r\n  };\r\n};\r\n","import { useState, useEffect } from 'react';\r\nimport { Link, useLocation } from 'react-router-dom';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useKeyboardNavigation } from '@/hooks/accessibility';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\ninterface HeaderProps {\r\n  className?: string;\r\n}\r\n\r\nexport const Header: React.FC<HeaderProps> = ({ className = '' }) => {\r\n  const { theme, toggleTheme } = useTheme();\r\n  const { user, logout, isAuthenticated, isAdmin } = useAuth();\r\n  const location = useLocation();\r\n  const { handleEnterSpace } = useKeyboardNavigation();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [showUserMenu, setShowUserMenu] = useState(false);\r\n\r\n  // Check if authentication is enabled\r\n  const isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\n  // Filter navigation items based on user permissions\r\n  const getNavigationItems = () => {\r\n    const baseItems = [\r\n      { path: '/', label: 'Dashboard', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/upload', label: 'Upload & Analyze', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/sessions', label: 'Sessions', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/predictions', label: 'My Predictions', icon: '', roles: [APP_ROLES.ADMIN] },\r\n    ];\r\n\r\n    // If auth is disabled, show all navigation items\r\n    if (!isAuthEnabled) {\r\n      return baseItems;\r\n    }\r\n\r\n    // If auth is enabled but user is not authenticated, show no items\r\n    if (!isAuthenticated) {\r\n      return [];\r\n    }\r\n\r\n    // Only show navigation items to Admin users, ControlPanel users get no navigation buttons\r\n    return baseItems.filter(() => {\r\n      if (isAdmin()) return true; // Admins can access everything\r\n      return false; // ControlPanel users see no navigation buttons\r\n    });\r\n  };\r\n\r\n  // Debug authentication state\r\n  useEffect(() => {\r\n    console.log('[Header] Authentication state:', {\r\n      isAuthenticated,\r\n      user: user ? { id: user.id, name: user.name, roles: user.roles } : null,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }, [isAuthenticated, user]);\r\n\r\n  const navItems = getNavigationItems();\r\n\r\n  const isActivePath = (path: string) => {\r\n    if (path === '/') {\r\n      return location.pathname === '/';\r\n    }\r\n    return location.pathname.startsWith(path);\r\n  };\r\n\r\n  const toggleMobileMenu = () => {\r\n    setIsMobileMenuOpen(!isMobileMenuOpen);\r\n  };\r\n\r\n  const closeMobileMenu = () => {\r\n    setIsMobileMenuOpen(false);\r\n  };\r\n\r\n  // Close mobile menu when route changes\r\n  useEffect(() => {\r\n    setIsMobileMenuOpen(false);\r\n    setShowUserMenu(false);\r\n  }, [location.pathname]);\r\n\r\n  // Close user menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as Element;\r\n      if (showUserMenu && !target.closest('[data-user-menu]')) {\r\n        setShowUserMenu(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [showUserMenu]);\r\n\r\n  return (\r\n    <header className={`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${className}`}>\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"flex justify-between items-center h-16\">\r\n          {/* Logo and title */}\r\n          <div className=\"flex items-center\">\r\n            <Link\r\n              to=\"/\"\r\n              className=\"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group\"\r\n              aria-label=\"Behavioral Health System - Go to Dashboard\"\r\n            >\r\n              <span className=\"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105\" role=\"img\" aria-label=\"Brain icon\"></span>\r\n              <span className=\"hidden sm:block\">Behavioral Health System</span>\r\n              <span className=\"sm:hidden\">BHS</span>\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Navigation */}\r\n          <nav className=\"hidden md:flex space-x-1\" role=\"navigation\" aria-label=\"Main navigation\">\r\n            {navItems.map(({ path, label, icon }) => (\r\n              <Link\r\n                key={path}\r\n                to={path}\r\n                className={`\r\n                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors\r\n                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                  ${\r\n                    isActivePath(path)\r\n                      ? 'bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100'\r\n                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700'\r\n                  }\r\n                `}\r\n                aria-current={isActivePath(path) ? 'page' : undefined}\r\n              >\r\n                <span role=\"img\" aria-hidden=\"true\">{icon}</span>\r\n                <span>{label}</span>\r\n              </Link>\r\n            ))}\r\n          </nav>\r\n\r\n          {/* User menu and theme toggle */}\r\n          <div className=\"flex items-center space-x-2\">\r\n            {/* User indicator - always visible */}\r\n            <div className=\"relative\" data-user-menu>\r\n              {isAuthEnabled && isAuthenticated && user ? (\r\n                // Authenticated user - fully functional\r\n                <button\r\n                  onClick={() => setShowUserMenu(!showUserMenu)}\r\n                  onKeyDown={handleEnterSpace(() => setShowUserMenu(!showUserMenu))}\r\n                  className=\"\r\n                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                    transition-colors touch-target\r\n                  \"\r\n                  aria-label=\"User menu\"\r\n                  type=\"button\"\r\n                >\r\n                  <div className=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium\">\r\n                    {user.name.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <span className=\"hidden sm:block text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {user.name}\r\n                  </span>\r\n                  <svg\r\n                    className={`w-4 h-4 transition-transform ${showUserMenu ? 'rotate-180' : ''}`}\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </button>\r\n              ) : (\r\n                // Disabled user indicator - grey and unclickable\r\n                <div\r\n                  className=\"\r\n                    flex items-center space-x-2 p-2 rounded-md text-gray-400 cursor-not-allowed opacity-50\r\n                    dark:text-gray-500 transition-colors touch-target\r\n                  \"\r\n                  aria-label=\"User authentication disabled\"\r\n                  title={!isAuthEnabled ? \"Authentication is disabled\" : \"Not signed in\"}\r\n                >\r\n                  <div className=\"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-medium\">\r\n                    ?\r\n                  </div>\r\n                  <span className=\"hidden sm:block text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                    {!isAuthEnabled ? \"Auth Disabled\" : \"Not Signed In\"}\r\n                  </span>\r\n                  <svg\r\n                    className=\"w-4 h-4\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </div>\r\n              )}\r\n\r\n              {/* User dropdown menu - only show for authenticated users */}\r\n              {isAuthEnabled && isAuthenticated && user && showUserMenu && (\r\n                <div className=\"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50\">\r\n                  <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className=\"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium\">\r\n                        {user.name.charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{user.name}</p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{user.email}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"mt-2\">\r\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">\r\n                        {user.primaryRole}\r\n                      </span>\r\n                      {user.roles.length > 1 && (\r\n                        <span className=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                          +{user.roles.length - 1} more\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"py-1\">\r\n                    <button\r\n                      onClick={() => {\r\n                        logout();\r\n                        setShowUserMenu(false);\r\n                      }}\r\n                      className=\"\r\n                        w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r\n                        hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r\n                      \"\r\n                    >\r\n                      Sign out\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              onClick={toggleTheme}\r\n              onKeyDown={handleEnterSpace(toggleTheme)}\r\n              className=\"\r\n                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                transition-colors touch-target\r\n              \"\r\n              aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\r\n              type=\"button\"\r\n            >\r\n              <span className=\"text-xl\" role=\"img\" aria-hidden=\"true\">\r\n                {theme === 'light' ? '' : ''}\r\n              </span>\r\n            </button>\r\n\r\n            {/* Mobile menu button - show when there are navigation items to display */}\r\n            {navItems.length > 0 && (\r\n              <button\r\n                onClick={toggleMobileMenu}\r\n                onKeyDown={handleEnterSpace(toggleMobileMenu)}\r\n                className=\"\r\n                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                  transition-colors touch-target\r\n                \"\r\n                aria-label={isMobileMenuOpen ? \"Close mobile menu\" : \"Open mobile menu\"}\r\n                type=\"button\"\r\n                {...(isMobileMenuOpen ? { 'aria-expanded': true } : { 'aria-expanded': false })}\r\n              >\r\n                <span className=\"text-xl\" role=\"img\" aria-hidden=\"true\">\r\n                  {isMobileMenuOpen ? '' : ''}\r\n                </span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mobile navigation */}\r\n        {isMobileMenuOpen && navItems.length > 0 && (\r\n          <div className=\"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3\">\r\n            <nav className=\"space-y-1\" role=\"navigation\" aria-label=\"Mobile navigation\">\r\n              {navItems.map(({ path, label, icon }) => (\r\n                <Link\r\n                  key={path}\r\n                  to={path}\r\n                  onClick={closeMobileMenu}\r\n                  className={`\r\n                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors\r\n                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                    ${\r\n                      isActivePath(path)\r\n                        ? 'bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100'\r\n                        : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700'\r\n                    }\r\n                  `}\r\n                  aria-current={isActivePath(path) ? 'page' : undefined}\r\n                >\r\n                  <span role=\"img\" aria-hidden=\"true\">{icon}</span>\r\n                  <span>{label}</span>\r\n                </Link>\r\n              ))}\r\n            </nav>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n","import { SVGProps } from 'react';\r\n\r\ninterface MicrosoftLogoProps extends SVGProps<SVGSVGElement> {\r\n  size?: number;\r\n  className?: string;\r\n}\r\n\r\nexport const MicrosoftLogo: React.FC<MicrosoftLogoProps> = ({\r\n  size = 20,\r\n  className = '',\r\n  ...props\r\n}) => {\r\n  return (\r\n    <svg\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 23 23\"\r\n      className={className}\r\n      aria-label=\"Microsoft\"\r\n      {...props}\r\n    >\r\n      {/* Microsoft logo squares */}\r\n      <rect x=\"1\" y=\"1\" width=\"10\" height=\"10\" fill=\"#f25022\" />\r\n      <rect x=\"12\" y=\"1\" width=\"10\" height=\"10\" fill=\"#7fba00\" />\r\n      <rect x=\"1\" y=\"12\" width=\"10\" height=\"10\" fill=\"#00a4ef\" />\r\n      <rect x=\"12\" y=\"12\" width=\"10\" height=\"10\" fill=\"#ffb900\" />\r\n    </svg>\r\n  );\r\n};\r\n","import { ReactNode } from 'react';\r\nimport { Header } from './Header';\r\nimport { useSkipToContent } from '@/hooks/accessibility';\r\nimport { A11Y } from '@/config/constants';\r\nimport { MicrosoftLogo } from '@/components/icons';\r\n\r\ninterface LayoutProps {\r\n  children: ReactNode;\r\n  className?: string;\r\n}\r\n\r\nexport const Layout: React.FC<LayoutProps> = ({ children, className = '' }) => {\r\n  const { skipToMain } = useSkipToContent();\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background-light dark:bg-background-dark\">\r\n      {/* Skip to content link for keyboard navigation */}\r\n      <a\r\n        href={`#${A11Y.SKIP_TO_CONTENT_ID}`}\r\n        className=\"skip-link\"\r\n        onClick={(e) => {\r\n          e.preventDefault();\r\n          skipToMain();\r\n        }}\r\n      >\r\n        Skip to main content\r\n      </a>\r\n\r\n      {/* Header */}\r\n      <Header />\r\n\r\n      {/* Main content */}\r\n      <main\r\n        id={A11Y.SKIP_TO_CONTENT_ID}\r\n        className={`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${className}`}\r\n        tabIndex={-1}\r\n      >\r\n        {children}\r\n      </main>\r\n\r\n      {/* ARIA live region for announcements */}\r\n      <div\r\n        id={A11Y.ANNOUNCEMENTS_ID}\r\n        className=\"sr-only\"\r\n        aria-live=\"polite\"\r\n        aria-atomic=\"true\"\r\n      />\r\n\r\n      {/* Footer */}\r\n      <footer className=\"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex flex-col items-center space-y-4\">\r\n            {/* Microsoft Logo */}\r\n            <div className=\"flex items-center space-x-2\">\r\n              <MicrosoftLogo size={24} className=\"opacity-80\" />\r\n              <span className=\"text-sm text-text-muted-light dark:text-text-muted-dark font-medium\">\r\n                Powered by Microsoft\r\n              </span>\r\n            </div>\r\n            \r\n            {/* Copyright and Compliance */}\r\n            <div className=\"text-center text-sm text-text-muted-light dark:text-text-muted-dark\">\r\n              <p>\r\n                Behavioral Health System &copy; {new Date().getFullYear()}\r\n              </p>\r\n              <p className=\"mt-1\">\r\n                WCAG 2.2 AA Compliant  Section 508 Compliant\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n};\r\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst toCamelCase = (string) => string.replace(\n  /^([A-Z])|[\\s-_]+(\\w)/g,\n  (match, p1, p2) => p2 ? p2.toUpperCase() : p1.toLowerCase()\n);\nconst toPascalCase = (string) => {\n  const camelCase = toCamelCase(string);\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n};\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\nconst hasA11yProp = (props) => {\n  for (const prop in props) {\n    if (prop.startsWith(\"aria-\") || prop === \"role\" || prop === \"title\") {\n      return true;\n    }\n  }\n};\n\nexport { hasA11yProp, mergeClasses, toCamelCase, toKebabCase, toPascalCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses, hasA11yProp } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => createElement(\n    \"svg\",\n    {\n      ref,\n      ...defaultAttributes,\n      width: size,\n      height: size,\n      stroke: color,\n      strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n      className: mergeClasses(\"lucide\", className),\n      ...!children && !hasA11yProp(rest) && { \"aria-hidden\": \"true\" },\n      ...rest\n    },\n    [\n      ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n      ...Array.isArray(children) ? children : [children]\n    ]\n  )\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase, toPascalCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(\n        `lucide-${toKebabCase(toPascalCase(iconName))}`,\n        `lucide-${iconName}`,\n        className\n      ),\n      ...props\n    })\n  );\n  Component.displayName = toPascalCase(iconName);\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2\",\n      key: \"169zse\"\n    }\n  ]\n];\nconst Activity = createLucideIcon(\"activity\", __iconNode);\n\nexport { __iconNode, Activity as default };\n//# sourceMappingURL=activity.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n];\nconst ArrowLeft = createLucideIcon(\"arrow-left\", __iconNode);\n\nexport { __iconNode, ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 18V5\", key: \"adv99a\" }],\n  [\"path\", { d: \"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4\", key: \"1e3is1\" }],\n  [\"path\", { d: \"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5\", key: \"1gqd8o\" }],\n  [\"path\", { d: \"M17.997 5.125a4 4 0 0 1 2.526 5.77\", key: \"iwvgf7\" }],\n  [\"path\", { d: \"M18 18a4 4 0 0 0 2-7.464\", key: \"efp6ie\" }],\n  [\"path\", { d: \"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517\", key: \"1gq6am\" }],\n  [\"path\", { d: \"M6 18a4 4 0 0 1-2-7.464\", key: \"k1g0md\" }],\n  [\"path\", { d: \"M6.003 5.125a4 4 0 0 0-2.526 5.77\", key: \"q97ue3\" }]\n];\nconst Brain = createLucideIcon(\"brain\", __iconNode);\n\nexport { __iconNode, Brain as default };\n//# sourceMappingURL=brain.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }]\n];\nconst Calendar = createLucideIcon(\"calendar\", __iconNode);\n\nexport { __iconNode, Calendar as default };\n//# sourceMappingURL=calendar.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 3v16a2 2 0 0 0 2 2h16\", key: \"c24i48\" }],\n  [\"path\", { d: \"M18 17V9\", key: \"2bz60n\" }],\n  [\"path\", { d: \"M13 17V5\", key: \"1frdt8\" }],\n  [\"path\", { d: \"M8 17v-3\", key: \"17ska0\" }]\n];\nconst ChartColumn = createLucideIcon(\"chart-column\", __iconNode);\n\nexport { __iconNode, ChartColumn as default };\n//# sourceMappingURL=chart-column.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z\",\n      key: \"pzmjnu\"\n    }\n  ],\n  [\"path\", { d: \"M21.21 15.89A10 10 0 1 1 8 2.83\", key: \"k2fpak\" }]\n];\nconst ChartPie = createLucideIcon(\"chart-pie\", __iconNode);\n\nexport { __iconNode, ChartPie as default };\n//# sourceMappingURL=chart-pie.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m6 9 6 6 6-6\", key: \"qrunsl\" }]];\nconst ChevronDown = createLucideIcon(\"chevron-down\", __iconNode);\n\nexport { __iconNode, ChevronDown as default };\n//# sourceMappingURL=chevron-down.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m18 15-6-6-6 6\", key: \"153udz\" }]];\nconst ChevronUp = createLucideIcon(\"chevron-up\", __iconNode);\n\nexport { __iconNode, ChevronUp as default };\n//# sourceMappingURL=chevron-up.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n];\nconst CircleAlert = createLucideIcon(\"circle-alert\", __iconNode);\n\nexport { __iconNode, CircleAlert as default };\n//# sourceMappingURL=circle-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21.801 10A10 10 0 1 1 17 3.335\", key: \"yps3ct\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n];\nconst CircleCheckBig = createLucideIcon(\"circle-check-big\", __iconNode);\n\nexport { __iconNode, CircleCheckBig as default };\n//# sourceMappingURL=circle-check-big.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m15 9-6 6\", key: \"1uzhvr\" }],\n  [\"path\", { d: \"m9 9 6 6\", key: \"z0biqf\" }]\n];\nconst CircleX = createLucideIcon(\"circle-x\", __iconNode);\n\nexport { __iconNode, CircleX as default };\n//# sourceMappingURL=circle-x.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 6v6l4 2\", key: \"mmk7yg\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst Clock = createLucideIcon(\"clock\", __iconNode);\n\nexport { __iconNode, Clock as default };\n//# sourceMappingURL=clock.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 15V3\", key: \"m9g1x1\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"path\", { d: \"m7 10 5 5 5-5\", key: \"brsn70\" }]\n];\nconst Download = createLucideIcon(\"download\", __iconNode);\n\nexport { __iconNode, Download as default };\n//# sourceMappingURL=download.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49\",\n      key: \"ct8e1f\"\n    }\n  ],\n  [\"path\", { d: \"M14.084 14.158a3 3 0 0 1-4.242-4.242\", key: \"151rxh\" }],\n  [\n    \"path\",\n    {\n      d: \"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143\",\n      key: \"13bj9a\"\n    }\n  ],\n  [\"path\", { d: \"m2 2 20 20\", key: \"1ooewy\" }]\n];\nconst EyeOff = createLucideIcon(\"eye-off\", __iconNode);\n\nexport { __iconNode, EyeOff as default };\n//# sourceMappingURL=eye-off.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0\",\n      key: \"1nclc0\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Eye = createLucideIcon(\"eye\", __iconNode);\n\nexport { __iconNode, Eye as default };\n//# sourceMappingURL=eye.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3\", key: \"rslqgf\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\n    \"path\",\n    {\n      d: \"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0\",\n      key: \"9f7x3i\"\n    }\n  ]\n];\nconst FileAudio = createLucideIcon(\"file-audio\", __iconNode);\n\nexport { __iconNode, FileAudio as default };\n//# sourceMappingURL=file-audio.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M10 9H8\", key: \"b1mrlr\" }],\n  [\"path\", { d: \"M16 13H8\", key: \"t4e002\" }],\n  [\"path\", { d: \"M16 17H8\", key: \"z1uh3a\" }]\n];\nconst FileText = createLucideIcon(\"file-text\", __iconNode);\n\nexport { __iconNode, FileText as default };\n//# sourceMappingURL=file-text.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z\",\n      key: \"sc7q7i\"\n    }\n  ]\n];\nconst Funnel = createLucideIcon(\"funnel\", __iconNode);\n\nexport { __iconNode, Funnel as default };\n//# sourceMappingURL=funnel.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5\",\n      key: \"mvr1a0\"\n    }\n  ]\n];\nconst Heart = createLucideIcon(\"heart\", __iconNode);\n\nexport { __iconNode, Heart as default };\n//# sourceMappingURL=heart.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n];\nconst Info = createLucideIcon(\"info\", __iconNode);\n\nexport { __iconNode, Info as default };\n//# sourceMappingURL=info.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m5 8 6 6\", key: \"1wu5hv\" }],\n  [\"path\", { d: \"m4 14 6-6 2-3\", key: \"1k1g8d\" }],\n  [\"path\", { d: \"M2 5h12\", key: \"or177f\" }],\n  [\"path\", { d: \"M7 2h1\", key: \"1t2jsx\" }],\n  [\"path\", { d: \"m22 22-5-10-5 10\", key: \"don7ne\" }],\n  [\"path\", { d: \"M14 18h6\", key: \"1m8k6r\" }]\n];\nconst Languages = createLucideIcon(\"languages\", __iconNode);\n\nexport { __iconNode, Languages as default };\n//# sourceMappingURL=languages.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5\",\n      key: \"1gvzjb\"\n    }\n  ],\n  [\"path\", { d: \"M9 18h6\", key: \"x1upvd\" }],\n  [\"path\", { d: \"M10 22h4\", key: \"ceow96\" }]\n];\nconst Lightbulb = createLucideIcon(\"lightbulb\", __iconNode);\n\nexport { __iconNode, Lightbulb as default };\n//# sourceMappingURL=lightbulb.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]];\nconst LoaderCircle = createLucideIcon(\"loader-circle\", __iconNode);\n\nexport { __iconNode, LoaderCircle as default };\n//# sourceMappingURL=loader-circle.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 19v3\", key: \"npa21l\" }],\n  [\"path\", { d: \"M15 9.34V5a3 3 0 0 0-5.68-1.33\", key: \"1gzdoj\" }],\n  [\"path\", { d: \"M16.95 16.95A7 7 0 0 1 5 12v-2\", key: \"cqa7eg\" }],\n  [\"path\", { d: \"M18.89 13.23A7 7 0 0 0 19 12v-2\", key: \"16hl24\" }],\n  [\"path\", { d: \"m2 2 20 20\", key: \"1ooewy\" }],\n  [\"path\", { d: \"M9 9v3a3 3 0 0 0 5.12 2.12\", key: \"r2i35w\" }]\n];\nconst MicOff = createLucideIcon(\"mic-off\", __iconNode);\n\nexport { __iconNode, MicOff as default };\n//# sourceMappingURL=mic-off.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 19v3\", key: \"npa21l\" }],\n  [\"path\", { d: \"M19 10v2a7 7 0 0 1-14 0v-2\", key: \"1vc78b\" }],\n  [\"rect\", { x: \"9\", y: \"2\", width: \"6\", height: \"13\", rx: \"3\", key: \"s6n7sd\" }]\n];\nconst Mic = createLucideIcon(\"mic\", __iconNode);\n\nexport { __iconNode, Mic as default };\n//# sourceMappingURL=mic.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { x: \"14\", y: \"3\", width: \"5\", height: \"18\", rx: \"1\", key: \"kaeet6\" }],\n  [\"rect\", { x: \"5\", y: \"3\", width: \"5\", height: \"18\", rx: \"1\", key: \"1wsw3u\" }]\n];\nconst Pause = createLucideIcon(\"pause\", __iconNode);\n\nexport { __iconNode, Pause as default };\n//# sourceMappingURL=pause.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z\",\n      key: \"10ikf1\"\n    }\n  ]\n];\nconst Play = createLucideIcon(\"play\", __iconNode);\n\nexport { __iconNode, Play as default };\n//# sourceMappingURL=play.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n];\nconst Plus = createLucideIcon(\"plus\", __iconNode);\n\nexport { __iconNode, Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n];\nconst RefreshCw = createLucideIcon(\"refresh-cw\", __iconNode);\n\nexport { __iconNode, RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m21 21-4.34-4.34\", key: \"14j7rj\" }],\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }]\n];\nconst Search = createLucideIcon(\"search\", __iconNode);\n\nexport { __iconNode, Search as default };\n//# sourceMappingURL=search.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915\",\n      key: \"1i5ecw\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Settings = createLucideIcon(\"settings\", __iconNode);\n\nexport { __iconNode, Settings as default };\n//# sourceMappingURL=settings.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v4\", key: \"1got3b\" }],\n  [\"path\", { d: \"M12 16h.01\", key: \"1drbdi\" }]\n];\nconst ShieldAlert = createLucideIcon(\"shield-alert\", __iconNode);\n\nexport { __iconNode, ShieldAlert as default };\n//# sourceMappingURL=shield-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\", key: \"1m0v6g\" }],\n  [\n    \"path\",\n    {\n      d: \"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z\",\n      key: \"ohrbg2\"\n    }\n  ]\n];\nconst SquarePen = createLucideIcon(\"square-pen\", __iconNode);\n\nexport { __iconNode, SquarePen as default };\n//# sourceMappingURL=square-pen.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"6\", key: \"1vlfrh\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }]\n];\nconst Target = createLucideIcon(\"target\", __iconNode);\n\nexport { __iconNode, Target as default };\n//# sourceMappingURL=target.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 11v6\", key: \"nco0om\" }],\n  [\"path\", { d: \"M14 11v6\", key: \"outv1u\" }],\n  [\"path\", { d: \"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6\", key: \"miytrc\" }],\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\", key: \"e791ji\" }]\n];\nconst Trash2 = createLucideIcon(\"trash-2\", __iconNode);\n\nexport { __iconNode, Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 17h6v-6\", key: \"t6n2it\" }],\n  [\"path\", { d: \"m22 17-8.5-8.5-5 5L2 7\", key: \"x473p\" }]\n];\nconst TrendingDown = createLucideIcon(\"trending-down\", __iconNode);\n\nexport { __iconNode, TrendingDown as default };\n//# sourceMappingURL=trending-down.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 7h6v6\", key: \"box55l\" }],\n  [\"path\", { d: \"m22 7-8.5 8.5-5-5L2 17\", key: \"1t1m79\" }]\n];\nconst TrendingUp = createLucideIcon(\"trending-up\", __iconNode);\n\nexport { __iconNode, TrendingUp as default };\n//# sourceMappingURL=trending-up.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\",\n      key: \"wmoenq\"\n    }\n  ],\n  [\"path\", { d: \"M12 9v4\", key: \"juzpu7\" }],\n  [\"path\", { d: \"M12 17h.01\", key: \"p32p05\" }]\n];\nconst TriangleAlert = createLucideIcon(\"triangle-alert\", __iconNode);\n\nexport { __iconNode, TriangleAlert as default };\n//# sourceMappingURL=triangle-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3v12\", key: \"1x0j5s\" }],\n  [\"path\", { d: \"m17 8-5-5-5 5\", key: \"7q97r8\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }]\n];\nconst Upload = createLucideIcon(\"upload\", __iconNode);\n\nexport { __iconNode, Upload as default };\n//# sourceMappingURL=upload.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n];\nconst User = createLucideIcon(\"user\", __iconNode);\n\nexport { __iconNode, User as default };\n//# sourceMappingURL=user.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"path\", { d: \"M16 3.128a4 4 0 0 1 0 7.744\", key: \"16gr8j\" }],\n  [\"path\", { d: \"M22 21v-2a4 4 0 0 0-3-3.87\", key: \"kshegd\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }]\n];\nconst Users = createLucideIcon(\"users\", __iconNode);\n\nexport { __iconNode, Users as default };\n//# sourceMappingURL=users.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"path\", { d: \"M16 9a5 5 0 0 1 0 6\", key: \"1q6k2b\" }],\n  [\"path\", { d: \"M19.364 18.364a9 9 0 0 0 0-12.728\", key: \"ijwkga\" }]\n];\nconst Volume2 = createLucideIcon(\"volume-2\", __iconNode);\n\nexport { __iconNode, Volume2 as default };\n//# sourceMappingURL=volume-2.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"9\", y2: \"15\", key: \"1ewh16\" }],\n  [\"line\", { x1: \"16\", x2: \"22\", y1: \"9\", y2: \"15\", key: \"5ykzw1\" }]\n];\nconst VolumeX = createLucideIcon(\"volume-x\", __iconNode);\n\nexport { __iconNode, VolumeX as default };\n//# sourceMappingURL=volume-x.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n];\nconst X = createLucideIcon(\"x\", __iconNode);\n\nexport { __iconNode, X as default };\n//# sourceMappingURL=x.js.map\n","import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiService, PredictionPoller } from '@/services/api';\r\nimport { getUserId } from '@/utils';\r\nimport type {\r\n  SessionInitiateRequest,\r\n  PredictionSubmitRequest,\r\n  PredictionResult,\r\n  HealthCheckResponse,\r\n  SessionData,\r\n  AppError,\r\n} from '@/types';\r\n\r\n// Query keys\r\nexport const QUERY_KEYS = {\r\n  health: ['health'] as const,\r\n  userPredictions: (userId: string) => ['predictions', 'user', userId] as const,\r\n  sessionPrediction: (sessionId: string) => ['predictions', 'session', sessionId] as const,\r\n  userSessions: (userId: string) => ['sessions', 'user', userId] as const,\r\n} as const;\r\n\r\n// Health check query\r\nexport const useHealthCheck = () => {\r\n  return useQuery<HealthCheckResponse, AppError>({\r\n    queryKey: QUERY_KEYS.health,\r\n    queryFn: () => apiService.checkHealth(),\r\n    retry: 2,\r\n    staleTime: 30000, // 30 seconds\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Session initiation mutation\r\nexport const useInitiateSession = () => {\r\n  return useMutation({\r\n    mutationFn: (request: SessionInitiateRequest) => \r\n      apiService.initiateSession(request),\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Prediction submission mutation\r\nexport const useSubmitPrediction = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: (request: PredictionSubmitRequest) => \r\n      apiService.submitPrediction(request),\r\n    onSuccess: (_, variables) => {\r\n      // Invalidate related queries\r\n      queryClient.invalidateQueries({\r\n        queryKey: QUERY_KEYS.sessionPrediction(variables.sessionid),\r\n      });\r\n      \r\n      const userId = getUserId();\r\n      queryClient.invalidateQueries({\r\n        queryKey: QUERY_KEYS.userPredictions(userId),\r\n      });\r\n    },\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Get prediction by session ID\r\nexport const useSessionPrediction = (sessionId: string, enabled = true) => {\r\n  return useQuery<PredictionResult, AppError>({\r\n    queryKey: QUERY_KEYS.sessionPrediction(sessionId),\r\n    queryFn: () => apiService.getPredictionBySessionId(sessionId),\r\n    enabled: enabled && Boolean(sessionId),\r\n    retry: (failureCount, error) => {\r\n      // Don't retry on 404s (session not found)\r\n      if (error.code === 'HTTP_404') {\r\n        return false;\r\n      }\r\n      return failureCount < 3;\r\n    },\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Get user predictions\r\nexport const useUserPredictions = (userId?: string) => {\r\n  const effectiveUserId = userId || getUserId();\r\n\r\n  return useQuery<PredictionResult[], AppError>({\r\n    queryKey: QUERY_KEYS.userPredictions(effectiveUserId),\r\n    queryFn: () => apiService.getUserPredictions(effectiveUserId),\r\n    enabled: Boolean(effectiveUserId),\r\n    staleTime: 60000, // 1 minute\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Get user sessions with complete session data\r\nexport const useUserSessions = (userId?: string) => {\r\n  const effectiveUserId = userId || getUserId();\r\n\r\n  return useQuery<{ success: boolean; count: number; sessions: SessionData[] }, AppError>({\r\n    queryKey: QUERY_KEYS.userSessions(effectiveUserId),\r\n    queryFn: () => apiService.getUserSessions(effectiveUserId),\r\n    enabled: Boolean(effectiveUserId),\r\n    staleTime: 30000, // 30 seconds\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Prediction polling hook\r\nexport const usePredictionPolling = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  const startPolling = (\r\n    sessionId: string,\r\n    options?: {\r\n      onUpdate?: (result: PredictionResult) => void;\r\n      onComplete?: (result: PredictionResult) => void;\r\n      onError?: (error: AppError) => void;\r\n    }\r\n  ) => {\r\n    const poller = new PredictionPoller(sessionId);\r\n\r\n    return poller.start(\r\n      (result) => {\r\n        // Update cache\r\n        queryClient.setQueryData(\r\n          QUERY_KEYS.sessionPrediction(sessionId),\r\n          result\r\n        );\r\n        options?.onUpdate?.(result);\r\n      },\r\n      (result) => {\r\n        // Final update and invalidate user predictions\r\n        queryClient.setQueryData(\r\n          QUERY_KEYS.sessionPrediction(sessionId),\r\n          result\r\n        );\r\n        \r\n        const userId = getUserId();\r\n        queryClient.invalidateQueries({\r\n          queryKey: QUERY_KEYS.userPredictions(userId),\r\n        });\r\n        \r\n        options?.onComplete?.(result);\r\n      },\r\n      (error) => {\r\n        options?.onError?.(error);\r\n      }\r\n    );\r\n  };\r\n\r\n  return { startPolling };\r\n};\r\n\r\n// API connection test\r\nexport const useTestConnection = () => {\r\n  return useMutation({\r\n    mutationFn: () => apiService.testConnection(),\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Optimistic updates helper\r\nexport const useOptimisticUpdates = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  const updateSessionStatus = (sessionId: string, status: PredictionResult['status']) => {\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.sessionPrediction(sessionId),\r\n      (old: PredictionResult | undefined) => {\r\n        if (!old) return old;\r\n        return {\r\n          ...old,\r\n          status,\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n      }\r\n    );\r\n  };\r\n\r\n  const addNewSession = (sessionId: string, userId: string) => {\r\n    const newSession: PredictionResult = {\r\n      sessionId,\r\n      status: 'queued',\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    // Add to session cache\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.sessionPrediction(sessionId),\r\n      newSession\r\n    );\r\n\r\n    // Add to user predictions cache\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.userPredictions(userId),\r\n      (old: PredictionResult[] | undefined) => {\r\n        if (!old) return [newSession];\r\n        return [newSession, ...old];\r\n      }\r\n    );\r\n  };\r\n\r\n  return {\r\n    updateSessionStatus,\r\n    addNewSession,\r\n  };\r\n};\r\n","import { useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Eye } from 'lucide-react';\r\nimport { useHealthCheck, useUserSessions } from '@/hooks/api';\r\nimport { useAnnouncements } from '@/hooks/accessibility';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { getUserId } from '@/utils';\r\n\r\nexport const Dashboard: React.FC = () => {\r\n  const { announce } = useAnnouncements();\r\n  const { canAccessControlPanel, user } = useAuth();\r\n  \r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = (): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  };\r\n  \r\n  // Fetch health status and recent sessions\r\n  const { data: healthStatus, isLoading: isHealthLoading, error: healthError } = useHealthCheck();\r\n  const { data: sessionsResponse, isLoading: isSessionsLoading } = useUserSessions(getAuthenticatedUserId());\r\n\r\n  useEffect(() => {\r\n    announce('Dashboard page loaded', 'polite');\r\n  }, [announce]);\r\n\r\n  const quickActions = [\r\n    {\r\n      title: 'Upload & Analyze',\r\n      description: 'Upload audio files for behavioral health analysis',\r\n      href: '/upload',\r\n      icon: '',\r\n      color: 'primary',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'View Sessions',\r\n      description: 'Browse all analysis sessions and their results',\r\n      href: '/sessions',\r\n      icon: '',\r\n      color: 'secondary',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'My Predictions',\r\n      description: 'View your complete prediction history',\r\n      href: '/predictions',\r\n      icon: '',\r\n      color: 'accent',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'Agent Experience',\r\n      description: 'Interactive chat with AI behavioral health agents',\r\n      href: '/agent-experience',\r\n      icon: '',\r\n      color: 'warning',\r\n      disabled: true\r\n    }\r\n  ];\r\n\r\n  const getActionClasses = (color: string, disabled: boolean = false) => {\r\n    const baseClasses = disabled \r\n      ? 'block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60' \r\n      : 'block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2';\r\n    \r\n    switch (color) {\r\n      case 'primary':\r\n        return `${baseClasses} border-primary-200 bg-primary-50 ${!disabled && 'hover:border-primary-300 hover:bg-primary-100'} dark:border-primary-800 dark:bg-primary-900 ${!disabled && 'dark:hover:border-primary-700 dark:hover:bg-primary-800'} focus:ring-primary-500`;\r\n      case 'secondary':\r\n        return `${baseClasses} border-secondary-200 bg-secondary-50 ${!disabled && 'hover:border-secondary-300 hover:bg-secondary-100'} dark:border-secondary-800 dark:bg-secondary-900 ${!disabled && 'dark:hover:border-secondary-700 dark:hover:bg-secondary-800'} focus:ring-secondary-500`;\r\n      case 'accent':\r\n        return `${baseClasses} border-accent-200 bg-accent-50 ${!disabled && 'hover:border-accent-300 hover:bg-accent-100'} dark:border-accent-800 dark:bg-accent-900 ${!disabled && 'dark:hover:border-accent-700 dark:hover:bg-accent-800'} focus:ring-accent-500`;\r\n      case 'warning':\r\n        return `${baseClasses} border-warning-200 bg-warning-50 ${!disabled && 'hover:border-warning-300 hover:bg-warning-100'} dark:border-teal-600 dark:bg-teal-800 ${!disabled && 'dark:hover:border-teal-500 dark:hover:bg-teal-700'} focus:ring-warning-500`;\r\n      default:\r\n        return `${baseClasses} border-gray-200 bg-gray-50 ${!disabled && 'hover:border-gray-300 hover:bg-gray-100'} dark:border-gray-700 dark:bg-gray-800 ${!disabled && 'dark:hover:border-gray-600 dark:hover:bg-gray-700'} focus:ring-gray-500`;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Page header */}\r\n      <div className=\"text-center\">\r\n        <h1 className=\"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark\">\r\n          Behavioral Health System\r\n        </h1>\r\n        <p className=\"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark\">\r\n          Audio-based mental health prediction and analysis\r\n        </p>\r\n      </div>\r\n\r\n      {/* Quick actions */}\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6\">\r\n          Quick Actions\r\n        </h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {quickActions.map((action) => {\r\n            if (action.disabled) {\r\n              return (\r\n                <div\r\n                  key={action.href}\r\n                  className={`${getActionClasses(action.color, true)} relative`}\r\n                  aria-label={`${action.title}: Coming Soon`}\r\n                >\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl mb-2\" role=\"img\" aria-hidden=\"true\">\r\n                      {action.icon}\r\n                    </div>\r\n                    <h3 className=\"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1\">\r\n                      {action.title}\r\n                    </h3>\r\n                    <p className=\"text-xs text-text-secondary-light dark:text-text-secondary-dark\">\r\n                      {action.description}\r\n                    </p>\r\n                  </div>\r\n                  {/* Coming Soon Overlay */}\r\n                  <div className=\"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-white font-bold text-sm mb-1\"></div>\r\n                      <div className=\"text-white font-semibold text-xs\">COMING SOON</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            }\r\n            \r\n            return (\r\n              <Link\r\n                key={action.href}\r\n                to={action.href}\r\n                className={getActionClasses(action.color, false)}\r\n                aria-label={`${action.title}: ${action.description}`}\r\n              >\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl mb-2\" role=\"img\" aria-hidden=\"true\">\r\n                    {action.icon}\r\n                  </div>\r\n                  <h3 className=\"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1\">\r\n                    {action.title}\r\n                  </h3>\r\n                  <p className=\"text-xs text-text-secondary-light dark:text-text-secondary-dark\">\r\n                    {action.description}\r\n                  </p>\r\n                </div>\r\n              </Link>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Summary Access - Only for authorized users */}\r\n      {canAccessControlPanel() && (\r\n        <div className=\"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2\">\r\n                 Summary\r\n              </h2>\r\n              <p className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n                Advanced analytics dashboard\r\n              </p>\r\n            </div>\r\n            <Link\r\n              to=\"/summary\"\r\n              className=\"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block\"\r\n            >\r\n              View Summary\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Recent activity */}\r\n      <div className=\"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900\">\r\n        <h2 className=\"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4\">\r\n          Recent Activity\r\n        </h2>\r\n        {isSessionsLoading ? (\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"spinner w-4 h-4\"></div>\r\n            <span className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              Loading recent sessions...\r\n            </span>\r\n          </div>\r\n        ) : (!sessionsResponse?.sessions || sessionsResponse.sessions.length === 0) ? (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"text-4xl mb-4\" role=\"img\" aria-label=\"No data\"></div>\r\n            <p className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              No sessions yet. \r\n              <Link \r\n                to=\"/upload\" \r\n                className=\"text-primary-600 dark:text-primary-400 hover:underline ml-1\"\r\n              >\r\n                Upload your first audio file\r\n              </Link> to get started.\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {sessionsResponse.sessions\r\n              .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\r\n              .slice(0, 3)\r\n              .map((session) => (\r\n              <div\r\n                key={session.sessionId}\r\n                className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md\"\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className={`status-${session.status || 'completed'}`}>\r\n                    {session.status || 'completed'}\r\n                  </div>\r\n                  <span className=\"text-text-primary-light dark:text-text-primary-dark\">\r\n                    {session.audioFileName || session.sessionId?.slice(0, 8) || 'Unknown'}\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\" title={session.createdAt}>\r\n                    {session.createdAt ? new Date(session.createdAt).toLocaleString() : ''}\r\n                  </span>\r\n                </div>\r\n                <Link\r\n                  to={`/sessions/${session.sessionId || ''}`}\r\n                  className=\"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1\"\r\n                  title=\"View session details\"\r\n                  aria-label={`View details for session ${session.audioFileName || session.sessionId?.slice(0, 8) || 'Unknown'}`}\r\n                >\r\n                  <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                </Link>\r\n              </div>\r\n            ))}\r\n            {sessionsResponse.sessions.length > 3 && (\r\n              <div className=\"text-center pt-3\">\r\n                <Link\r\n                  to=\"/sessions\"\r\n                  className=\"text-primary-600 dark:text-primary-400 hover:underline\"\r\n                >\r\n                  View all {sessionsResponse.sessions.length} sessions \r\n                </Link>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* System status */}\r\n      <div className=\"card\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark\">\r\n            System Status\r\n          </h2>\r\n          <Link\r\n            to=\"/health\"\r\n            className=\"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block\"\r\n          >\r\n            System Health\r\n          </Link>\r\n        </div>\r\n        {isHealthLoading ? (\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"spinner w-4 h-4\"></div>\r\n            <span className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              Checking system health...\r\n            </span>\r\n          </div>\r\n        ) : healthError ? (\r\n          <div className=\"flex items-center space-x-2 text-error-600 dark:text-error-400\">\r\n            <span role=\"img\" aria-label=\"Error\"></span>\r\n            <span>System health check failed</span>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center space-x-2 text-success-600 dark:text-success-400\">\r\n            <span role=\"img\" aria-label=\"Healthy\"></span>\r\n            <span>All systems operational</span>\r\n            {healthStatus?.checks && (\r\n              <span className=\"text-text-muted-light dark:text-text-muted-dark\">\r\n                ({Object.keys(healthStatus.checks).length} services checked)\r\n              </span>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import { FFmpeg } from '@ffmpeg/ffmpeg';\r\nimport { fetchFile, toBlobURL } from '@ffmpeg/util';\r\nimport { config } from '@/config/constants';\r\nimport { createAppError } from '@/utils';\r\nimport type { AudioConversionOptions } from '@/types';\r\n// import type { AppError } from '@/types'; // Commented out until used\r\n\r\nexport interface ConversionProgress {\r\n  stage: 'loading' | 'converting' | 'completed';\r\n  progress: number;\r\n  message: string;\r\n}\r\n\r\nexport class AudioProcessor {\r\n  private ffmpeg: FFmpeg | null = null;\r\n  private isLoaded = false;\r\n  private loadingPromise: Promise<void> | null = null;\r\n\r\n  constructor() {\r\n    this.ffmpeg = new FFmpeg();\r\n  }\r\n\r\n  private async loadFFmpeg(): Promise<void> {\r\n    if (this.isLoaded) return;\r\n    \r\n    if (this.loadingPromise) {\r\n      return this.loadingPromise;\r\n    }\r\n\r\n    this.loadingPromise = this.doLoadFFmpeg();\r\n    return this.loadingPromise;\r\n  }\r\n\r\n  private async doLoadFFmpeg(): Promise<void> {\r\n    if (!this.ffmpeg) {\r\n      throw createAppError(\r\n        'FFMPEG_INIT_ERROR',\r\n        'Failed to initialize FFmpeg'\r\n      );\r\n    }\r\n\r\n    try {\r\n      // Load FFmpeg with CDN URLs for better reliability\r\n      const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm';\r\n      \r\n      await this.ffmpeg.load({\r\n        coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),\r\n        wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),\r\n      });\r\n\r\n      this.isLoaded = true;\r\n    } catch (error) {\r\n      this.loadingPromise = null;\r\n      throw createAppError(\r\n        'FFMPEG_LOAD_ERROR',\r\n        'Failed to load FFmpeg. Please check your internet connection and try again.',\r\n        { originalError: error }\r\n      );\r\n    }\r\n  }\r\n\r\n  async convertAudio(\r\n    file: File,\r\n    options: AudioConversionOptions = {\r\n      outputFormat: 'wav',\r\n      sampleRate: 44100,\r\n      channels: 1,\r\n    },\r\n    onProgress?: (progress: ConversionProgress) => void\r\n  ): Promise<File> {\r\n    try {\r\n      // Notify loading stage\r\n      onProgress?.({\r\n        stage: 'loading',\r\n        progress: 0,\r\n        message: 'Loading audio processor...',\r\n      });\r\n\r\n      await this.loadFFmpeg();\r\n\r\n      if (!this.ffmpeg) {\r\n        throw createAppError('FFMPEG_NOT_LOADED', 'FFmpeg not properly loaded');\r\n      }\r\n\r\n      // Setup progress callback\r\n      this.ffmpeg.on('progress', ({ progress }) => {\r\n        onProgress?.({\r\n          stage: 'converting',\r\n          progress: Math.round(progress * 100),\r\n          message: `Converting audio... ${Math.round(progress * 100)}%`,\r\n        });\r\n      });\r\n\r\n      onProgress?.({\r\n        stage: 'converting',\r\n        progress: 0,\r\n        message: 'Preparing audio file...',\r\n      });\r\n\r\n      // Write input file\r\n      const inputName = 'input.' + this.getFileExtension(file.name);\r\n      await this.ffmpeg.writeFile(inputName, await fetchFile(file));\r\n\r\n      // Build FFmpeg command\r\n      const outputName = `output.${options.outputFormat}`;\r\n      const command = [\r\n        '-i', inputName,\r\n        '-ac', options.channels.toString(),\r\n        '-ar', options.sampleRate.toString(),\r\n        '-f', options.outputFormat,\r\n        outputName\r\n      ];\r\n\r\n      // Execute conversion\r\n      await this.ffmpeg.exec(command);\r\n\r\n      // Read output file\r\n      const outputData = await this.ffmpeg.readFile(outputName);\r\n      const outputBlob = new Blob([outputData as unknown as ArrayBuffer], { type: `audio/${options.outputFormat}` });\r\n      \r\n      // Create new File object with converted audio\r\n      const convertedFile = new File(\r\n        [outputBlob],\r\n        `${this.getFileNameWithoutExtension(file.name)}.${options.outputFormat}`,\r\n        { type: `audio/${options.outputFormat}` }\r\n      );\r\n\r\n      // Clean up temporary files\r\n      await this.ffmpeg.deleteFile(inputName);\r\n      await this.ffmpeg.deleteFile(outputName);\r\n\r\n      onProgress?.({\r\n        stage: 'completed',\r\n        progress: 100,\r\n        message: 'Audio conversion completed',\r\n      });\r\n\r\n      return convertedFile;\r\n\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'AUDIO_CONVERSION_ERROR',\r\n        'Failed to convert audio file. Please try with a different file.',\r\n        { \r\n          originalError: error,\r\n          fileName: file.name,\r\n          fileSize: file.size,\r\n          fileType: file.type\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFileExtension(filename: string): string {\r\n    const lastDot = filename.lastIndexOf('.');\r\n    return lastDot !== -1 ? filename.slice(lastDot + 1).toLowerCase() : '';\r\n  }\r\n\r\n  private getFileNameWithoutExtension(filename: string): string {\r\n    const lastDot = filename.lastIndexOf('.');\r\n    return lastDot !== -1 ? filename.slice(0, lastDot) : filename;\r\n  }\r\n\r\n  async isFormatSupported(file: File): Promise<boolean> {\r\n    try {\r\n      await this.loadFFmpeg();\r\n      \r\n      // Check if file extension is in supported formats\r\n      const supportedFormats = ['wav', 'mp3', 'mp4', 'm4a', 'aac', 'flac', 'ogg'];\r\n      const extension = this.getFileExtension(file.name);\r\n      \r\n      return supportedFormats.includes(extension);\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  dispose(): void {\r\n    if (this.ffmpeg) {\r\n      this.ffmpeg.terminate();\r\n      this.ffmpeg = null;\r\n    }\r\n    this.isLoaded = false;\r\n    this.loadingPromise = null;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet audioProcessorInstance: AudioProcessor | null = null;\r\n\r\nexport const getAudioProcessor = (): AudioProcessor => {\r\n  if (!audioProcessorInstance) {\r\n    audioProcessorInstance = new AudioProcessor();\r\n  }\r\n  return audioProcessorInstance;\r\n};\r\n\r\n// Fallback for browsers that don't support SharedArrayBuffer or other requirements\r\nexport const isFFmpegSupported = (): boolean => {\r\n  try {\r\n    // Check for SharedArrayBuffer support (required for FFmpeg.wasm)\r\n    if (typeof SharedArrayBuffer === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    // Check if in a secure context (required for some FFmpeg features)\r\n    if (!window.isSecureContext) {\r\n      return false;\r\n    }\r\n\r\n    return config.features.enableFFmpegWorker;\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\n\r\n// Server fallback (for when FFmpeg.wasm is not supported)\r\nexport const convertAudioOnServer = async (\r\n  file: File,\r\n  _options: AudioConversionOptions\r\n): Promise<File> => {\r\n  // This would be implemented as a backend endpoint\r\n  // For now, return the original file as fallback\r\n  return file;\r\n};\r\n\r\n// Convenience function for the Upload & Analyze page\r\nexport const convertAudioToWav = async (\r\n  file: File,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const processor = getAudioProcessor();\r\n  \r\n  const convertedFile = await processor.convertAudio(\r\n    file,\r\n    {\r\n      outputFormat: 'wav',\r\n      sampleRate: 44100,\r\n      channels: 1,\r\n    },\r\n    onProgress ? (progress) => onProgress(progress.progress) : undefined\r\n  );\r\n\r\n  // Convert File to Blob\r\n  return new Blob([convertedFile], { type: 'audio/wav' });\r\n};\r\n","import { BlobServiceClient, ContainerClient } from '@azure/storage-blob';\r\nimport { config } from '@/config/constants';\r\nimport { createAppError, getUserId } from '@/utils';\r\n\r\nexport interface UploadProgress {\r\n  progress: number;\r\n  stage: 'preparing' | 'uploading' | 'completed';\r\n  message: string;\r\n}\r\n\r\nexport interface UploadResult {\r\n  url: string;\r\n  fileName: string;\r\n  size: number;\r\n}\r\n\r\nexport class AzureBlobService {\r\n  private containerClient: ContainerClient | null = null;\r\n  private sasUrl: string;\r\n\r\n  constructor(sasUrl?: string) {\r\n    this.sasUrl = sasUrl || config.azure.blobSasUrl;\r\n    \r\n    if (!this.sasUrl) {\r\n      throw createAppError(\r\n        'AZURE_CONFIG_ERROR',\r\n        'Azure Blob Storage SAS URL not configured'\r\n      );\r\n    }\r\n  }\r\n\r\n  private getContainerClient(): ContainerClient {\r\n    if (!this.containerClient) {\r\n      try {\r\n        const blobServiceClient = new BlobServiceClient(this.sasUrl);\r\n        this.containerClient = blobServiceClient.getContainerClient(config.azure.containerName);\r\n      } catch (error) {\r\n        throw createAppError(\r\n          'AZURE_CLIENT_ERROR',\r\n          'Failed to initialize Azure Blob Storage client',\r\n          { originalError: error }\r\n        );\r\n      }\r\n    }\r\n    \r\n    return this.containerClient;\r\n  }\r\n\r\n  async uploadFile(\r\n    file: File,\r\n    fileName?: string,\r\n    onProgress?: (progress: UploadProgress) => void,\r\n    userId?: string\r\n  ): Promise<UploadResult> {\r\n    try {\r\n      onProgress?.({\r\n        progress: 0,\r\n        stage: 'preparing',\r\n        message: 'Preparing upload...',\r\n      });\r\n\r\n      const containerClient = this.getContainerClient();\r\n      // When userId is provided, create proper folder structure with custom filename or generated filename\r\n      let blobName: string;\r\n      if (userId) {\r\n        const effectiveUserId = userId;\r\n        if (fileName) {\r\n          // Use custom filename (includes metadata user ID) within user folder structure\r\n          blobName = `users/${effectiveUserId}/audio/${fileName}`;\r\n        } else {\r\n          // Generate filename with timestamp and random ID\r\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n          const randomId = Math.random().toString(36).substring(2, 8);\r\n          const extension = file.name.split('.').pop() || 'wav';\r\n          blobName = `users/${effectiveUserId}/audio/${timestamp}-${randomId}.${extension}`;\r\n        }\r\n      } else {\r\n        // Fallback to original logic when no userId provided\r\n        blobName = fileName || this.generateBlobName(file.name);\r\n      }\r\n      const blockBlobClient = containerClient.getBlockBlobClient(blobName);\r\n\r\n      // Upload with progress tracking\r\n      onProgress?.({\r\n        progress: 10,\r\n        stage: 'uploading',\r\n        message: 'Starting upload...',\r\n      });\r\n\r\n      await blockBlobClient.uploadData(file, {\r\n        blobHTTPHeaders: {\r\n          blobContentType: file.type,\r\n        },\r\n        onProgress: (uploadProgress) => {\r\n          const progressPercent = uploadProgress.loadedBytes && file.size \r\n            ? Math.round((uploadProgress.loadedBytes / file.size) * 90) + 10\r\n            : 50;\r\n            \r\n          onProgress?.({\r\n            progress: progressPercent,\r\n            stage: 'uploading',\r\n            message: `Uploading... ${progressPercent}%`,\r\n          });\r\n        },\r\n      });\r\n\r\n      // Get the URL for the uploaded blob\r\n      const blobUrl = blockBlobClient.url;\r\n\r\n      onProgress?.({\r\n        progress: 100,\r\n        stage: 'completed',\r\n        message: 'Upload completed',\r\n      });\r\n\r\n      return {\r\n        url: blobUrl,\r\n        fileName: blobName,\r\n        size: file.size,\r\n      };\r\n\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'UPLOAD_ERROR',\r\n        'Failed to upload file to Azure Blob Storage',\r\n        { \r\n          originalError: error,\r\n          fileName: file.name,\r\n          fileSize: file.size\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private generateBlobName(originalFileName: string, userId?: string): string {\r\n    // Get user ID for data isolation\r\n    const effectiveUserId = userId || getUserId();\r\n    \r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n    const randomId = Math.random().toString(36).substring(2, 8);\r\n    const extension = originalFileName.split('.').pop() || 'wav';\r\n    \r\n    // Include user ID in the path for data isolation\r\n    return `users/${effectiveUserId}/audio/${timestamp}-${randomId}.${extension}`;\r\n  }\r\n\r\n  async testConnection(): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const containerClient = this.getContainerClient();\r\n      \r\n      // Try to get container properties to test connection\r\n      await containerClient.getProperties();\r\n      \r\n      return {\r\n        success: true,\r\n        message: 'Azure Blob Storage connection successful',\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        message: 'Failed to connect to Azure Blob Storage. Please check your SAS URL configuration.',\r\n      };\r\n    }\r\n  }\r\n\r\n  async deleteFile(fileName: string): Promise<void> {\r\n    try {\r\n      const containerClient = this.getContainerClient();\r\n      const blockBlobClient = containerClient.getBlockBlobClient(fileName);\r\n      \r\n      await blockBlobClient.deleteIfExists();\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'DELETE_ERROR',\r\n        'Failed to delete file from Azure Blob Storage',\r\n        { originalError: error, fileName }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * List all files for a specific user\r\n   */\r\n  async listUserFiles(userId?: string): Promise<string[]> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const containerClient = this.getContainerClient();\r\n      const userPrefix = `users/${effectiveUserId}/`;\r\n      \r\n      const blobs: string[] = [];\r\n      for await (const blob of containerClient.listBlobsFlat({ prefix: userPrefix })) {\r\n        blobs.push(blob.name);\r\n      }\r\n      \r\n      return blobs;\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'LIST_ERROR',\r\n        'Failed to list user files from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete all files for a specific user (for GDPR compliance)\r\n   */\r\n  async deleteUserData(userId?: string): Promise<number> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const userFiles = await this.listUserFiles(effectiveUserId);\r\n      \r\n      let deletedCount = 0;\r\n      for (const fileName of userFiles) {\r\n        await this.deleteFile(fileName);\r\n        deletedCount++;\r\n      }\r\n      \r\n      return deletedCount;\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'DELETE_USER_DATA_ERROR',\r\n        'Failed to delete user data from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get storage usage for a specific user\r\n   */\r\n  async getUserStorageUsage(userId?: string): Promise<{ fileCount: number; totalSizeBytes: number }> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const containerClient = this.getContainerClient();\r\n      const userPrefix = `users/${effectiveUserId}/`;\r\n      \r\n      let fileCount = 0;\r\n      let totalSizeBytes = 0;\r\n      \r\n      for await (const blob of containerClient.listBlobsFlat({ prefix: userPrefix })) {\r\n        fileCount++;\r\n        totalSizeBytes += blob.properties.contentLength || 0;\r\n      }\r\n      \r\n      return { fileCount, totalSizeBytes };\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'STORAGE_USAGE_ERROR',\r\n        'Failed to get user storage usage from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet blobServiceInstance: AzureBlobService | null = null;\r\n\r\nexport const getBlobService = (sasUrl?: string): AzureBlobService => {\r\n  if (!blobServiceInstance || (sasUrl && sasUrl !== blobServiceInstance['sasUrl'])) {\r\n    blobServiceInstance = new AzureBlobService(sasUrl);\r\n  }\r\n  return blobServiceInstance;\r\n};\r\n\r\n// Check if Azure Blob Storage is properly configured\r\nexport const isAzureBlobConfigured = (): boolean => {\r\n  return Boolean(config.azure.blobSasUrl && config.azure.containerName);\r\n};\r\n\r\n// Convenience function for the Upload & Analyze page with user isolation\r\nexport const uploadToAzureBlob = async (\r\n  file: File | Blob,\r\n  fileName: string,\r\n  onProgress?: (progress: number) => void,\r\n  userId?: string\r\n): Promise<string> => {\r\n  const blobService = getBlobService();\r\n  \r\n  // Convert Blob to File if needed\r\n  const fileToUpload = file instanceof File ? file : new File([file], fileName, { type: file.type });\r\n  \r\n  const result = await blobService.uploadFile(\r\n    fileToUpload,\r\n    fileName,\r\n    onProgress ? (progress) => onProgress(progress.progress) : undefined,\r\n    userId\r\n  );\r\n\r\n  return result.url;\r\n};\r\n","import { useCallback, useRef } from 'react';\r\n\r\n/**\r\n * Hook for accessibility features like screen reader announcements\r\n */\r\nexport const useAccessibility = () => {\r\n  const announcementRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  /**\r\n   * Announce text to screen readers\r\n   */\r\n  const announceToScreenReader = useCallback((message: string) => {\r\n    // Create a live region if it doesn't exist\r\n    if (!announcementRef.current) {\r\n      const liveRegion = document.createElement('div');\r\n      liveRegion.setAttribute('aria-live', 'polite');\r\n      liveRegion.setAttribute('aria-atomic', 'true');\r\n      liveRegion.style.position = 'absolute';\r\n      liveRegion.style.left = '-10000px';\r\n      liveRegion.style.width = '1px';\r\n      liveRegion.style.height = '1px';\r\n      liveRegion.style.overflow = 'hidden';\r\n      document.body.appendChild(liveRegion);\r\n      announcementRef.current = liveRegion;\r\n    }\r\n\r\n    // Clear previous message and set new one\r\n    announcementRef.current.textContent = '';\r\n    setTimeout(() => {\r\n      if (announcementRef.current) {\r\n        announcementRef.current.textContent = message;\r\n      }\r\n    }, 100);\r\n  }, []);\r\n\r\n  /**\r\n   * Focus management utilities\r\n   */\r\n  const focusManagement = {\r\n    /**\r\n     * Set focus to element by ID\r\n     */\r\n    focusById: (elementId: string) => {\r\n      const element = document.getElementById(elementId);\r\n      if (element) {\r\n        element.focus();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Focus the first focusable element within a container\r\n     */\r\n    focusFirstInContainer: (container: HTMLElement) => {\r\n      const focusableElements = container.querySelectorAll(\r\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n      );\r\n      \r\n      const firstElement = focusableElements[0] as HTMLElement;\r\n      if (firstElement) {\r\n        firstElement.focus();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Trap focus within a container (for modals)\r\n     */\r\n    trapFocus: (container: HTMLElement) => {\r\n      const focusableElements = container.querySelectorAll(\r\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n      ) as NodeListOf<HTMLElement>;\r\n\r\n      const firstElement = focusableElements[0];\r\n      const lastElement = focusableElements[focusableElements.length - 1];\r\n\r\n      const handleTabKey = (e: KeyboardEvent) => {\r\n        if (e.key !== 'Tab') return;\r\n\r\n        if (e.shiftKey) {\r\n          if (document.activeElement === firstElement) {\r\n            lastElement.focus();\r\n            e.preventDefault();\r\n          }\r\n        } else {\r\n          if (document.activeElement === lastElement) {\r\n            firstElement.focus();\r\n            e.preventDefault();\r\n          }\r\n        }\r\n      };\r\n\r\n      container.addEventListener('keydown', handleTabKey);\r\n\r\n      // Return cleanup function\r\n      return () => {\r\n        container.removeEventListener('keydown', handleTabKey);\r\n      };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Keyboard navigation helpers\r\n   */\r\n  const keyboardNavigation = {\r\n    /**\r\n     * Handle arrow key navigation for lists\r\n     */\r\n    handleArrowNavigation: (\r\n      event: React.KeyboardEvent,\r\n      items: HTMLElement[],\r\n      currentIndex: number,\r\n      onIndexChange: (newIndex: number) => void\r\n    ) => {\r\n      let newIndex = currentIndex;\r\n\r\n      switch (event.key) {\r\n        case 'ArrowDown':\r\n          event.preventDefault();\r\n          newIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;\r\n          break;\r\n        case 'ArrowUp':\r\n          event.preventDefault();\r\n          newIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;\r\n          break;\r\n        case 'Home':\r\n          event.preventDefault();\r\n          newIndex = 0;\r\n          break;\r\n        case 'End':\r\n          event.preventDefault();\r\n          newIndex = items.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      onIndexChange(newIndex);\r\n      items[newIndex]?.focus();\r\n    },\r\n\r\n    /**\r\n     * Handle escape key to close modals/dropdowns\r\n     */\r\n    handleEscape: (event: React.KeyboardEvent, onEscape: () => void) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault();\r\n        onEscape();\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generate unique IDs for form elements\r\n   */\r\n  const generateId = useCallback((prefix: string = 'element') => {\r\n    return `${prefix}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }, []);\r\n\r\n  /**\r\n   * Check if user prefers reduced motion\r\n   */\r\n  const prefersReducedMotion = useCallback(() => {\r\n    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  }, []);\r\n\r\n  /**\r\n   * Get appropriate ARIA attributes for form validation\r\n   */\r\n  const getValidationAttributes = useCallback((\r\n    isValid: boolean,\r\n    errorMessage?: string,\r\n    describedById?: string\r\n  ) => {\r\n    const attributes: Record<string, string> = {};\r\n\r\n    if (!isValid) {\r\n      attributes['aria-invalid'] = 'true';\r\n      if (errorMessage && describedById) {\r\n        attributes['aria-describedby'] = describedById;\r\n      }\r\n    }\r\n\r\n    return attributes;\r\n  }, []);\r\n\r\n  return {\r\n    announceToScreenReader,\r\n    focusManagement,\r\n    keyboardNavigation,\r\n    generateId,\r\n    prefersReducedMotion,\r\n    getValidationAttributes,\r\n  };\r\n};\r\n","// Enhanced Batch Processing with CSV Support - Updated: Sept 23, 2025\r\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { Upload, Play, Pause, X, AlertCircle, CheckCircle, Loader2, Volume2, Plus, Trash2, Edit } from 'lucide-react';\r\nimport { convertAudioToWav } from '../services/audio';\r\nimport { uploadToAzureBlob } from '../services/azure';\r\nimport { apiService, PredictionPoller } from '../services/api';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { getStoredProcessingMode, setStoredProcessingMode, getStoredProcessingModeBoolean, getUserId } from '../utils';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport type { PredictionResult, AppError, SessionMetadata } from '../types';\r\n\r\ninterface UploadProgress {\r\n  stage: 'idle' | 'starting' | 'initiating' | 'converting' | 'uploading' | 'submitting' | 'analyzing' | 'complete' | 'error';\r\n  progress: number;\r\n  message: string;\r\n  sessionId?: string; // Track session ID for status updates\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: Record<string, unknown>;\r\n    uploadedFileUrl?: string; // Track uploaded file for cleanup\r\n  };\r\n}\r\n\r\ntype UserMetadata = {\r\n  userId: string;\r\n  age?: string;\r\n  gender?: string;\r\n  race?: string;\r\n  ethnicity?: string;\r\n  language?: string;\r\n  weight?: string;\r\n  zipcode?: string;\r\n  sessionNotes?: string;\r\n};\r\n\r\n// Default user metadata for new files\r\nconst defaultUserMetadata: UserMetadata = {\r\n  userId: '',\r\n  age: '',\r\n  gender: '',\r\n  race: '',\r\n  ethnicity: '',\r\n  language: '',\r\n  weight: '',\r\n  zipcode: '',\r\n  sessionNotes: ''\r\n};\r\n\r\ninterface AudioFile {\r\n  id: string;\r\n  file: File;\r\n  url: string;\r\n  duration?: number;\r\n  // Individual patient metadata for each file in batch mode\r\n  userMetadata?: UserMetadata;\r\n}\r\n\r\ninterface ProcessingProgress {\r\n  [fileId: string]: UploadProgress;\r\n}\r\n\r\ninterface FileResults {\r\n  [fileId: string]: AnalysisResult;\r\n}\r\n\r\ninterface FileProcessingState {\r\n  [fileId: string]: 'ready' | 'processing' | 'complete' | 'error';\r\n}\r\n\r\n// CSV batch processing types\r\ninterface CsvBatchRow {\r\n  userId: string;\r\n  age?: string;\r\n  gender?: string;\r\n  race?: string;\r\n  ethnicity?: string;\r\n  language?: string;\r\n  weight?: string;\r\n  zipcode?: string;\r\n  sessionNotes?: string;\r\n  fileUrl: string; // URL to file in blob storage\r\n  fileName?: string; // Optional friendly name\r\n}\r\n\r\ninterface CsvBatchData {\r\n  rows: CsvBatchRow[];\r\n  fileName: string;\r\n}\r\n\r\n// Processing modes\r\ntype ProcessingMode = 'single' | 'batch-files' | 'batch-csv';\r\n\r\ninterface SessionInfo {\r\n  sessionId: string;\r\n  userId: string;\r\n}\r\n\r\ninterface AnalysisResult {\r\n  sessionId: string;\r\n  depressionScore?: number;\r\n  riskLevel?: 'low' | 'medium' | 'high';\r\n  confidence?: number;\r\n  insights?: string[];\r\n  timestamp: string;\r\n  audioUrl?: string;\r\n  rawApiResponse?: any; // Store the complete API response\r\n}\r\n\r\n// Interface for pre-filled data from re-run functionality\r\ninterface PrefilledSessionData {\r\n  userMetadata?: {\r\n    age?: number;\r\n    gender?: string;\r\n    race?: string;\r\n    ethnicity?: string;\r\n    language?: boolean;\r\n    weight?: number;\r\n    zipcode?: string;\r\n    sessionNotes?: string;\r\n  };\r\n  audioUrl?: string;\r\n  audioFileName?: string;\r\n  originalSessionId?: string;\r\n}\r\n\r\nconst UploadAnalyze: React.FC = () => {\r\n  // Auth context for user identification\r\n  const { user } = useAuth();\r\n  const location = useLocation();\r\n  \r\n  const [audioFiles, setAudioFiles] = useState<AudioFile[]>([]);\r\n  const [processingMode, setProcessingMode] = useState<ProcessingMode>(() => {\r\n    const stored = getStoredProcessingMode();\r\n    return stored as ProcessingMode;\r\n  });\r\n  const [isMultiMode, setIsMultiMode] = useState(() => getStoredProcessingModeBoolean()); // Keep for backward compatibility\r\n  \r\n  // Update isMultiMode based on processing mode\r\n  const [processingProgress, setProcessingProgress] = useState<ProcessingProgress>({});\r\n  const [results, setResults] = useState<FileResults>({});\r\n  const [fileStates, setFileStates] = useState<FileProcessingState>({});\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  \r\n  // CSV batch processing state\r\n  const [csvBatchData, setCsvBatchData] = useState<CsvBatchData | null>(null);\r\n  const [csvValidationErrors, setCsvValidationErrors] = useState<string[]>([]);\r\n  const [csvProcessingProgress, setCsvProcessingProgress] = useState({\r\n    isProcessing: false,\r\n    currentFile: 0,\r\n    totalFiles: 0,\r\n    currentFileName: '',\r\n    message: ''\r\n  });\r\n\r\n  // Batch files processing progress state\r\n  const [batchProcessingProgress, setBatchProcessingProgress] = useState({\r\n    isProcessing: false,\r\n    currentFile: 0,\r\n    totalFiles: 0,\r\n    currentFileName: '',\r\n    message: ''\r\n  });\r\n  \r\n  // Legacy single file state for backward compatibility\r\n  const [audioFile, setAudioFile] = useState<AudioFile | null>(null);\r\n  const [progress, setProgress] = useState<UploadProgress>({\r\n    stage: 'idle',\r\n    progress: 0,\r\n    message: ''\r\n  });\r\n  const [result, setResult] = useState<AnalysisResult | null>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [playingFileId, setPlayingFileId] = useState<string | null>(null);\r\n  \r\n  // Get pre-filled data from location state (for re-run functionality)\r\n  const prefilledData = location.state as PrefilledSessionData | undefined;\r\n  \r\n  const [userMetadata, setUserMetadata] = useState({\r\n    userId: '', // Will be auto-generated on component mount\r\n    age: prefilledData?.userMetadata?.age?.toString() || '',\r\n    gender: prefilledData?.userMetadata?.gender || '',\r\n    race: prefilledData?.userMetadata?.race || '',\r\n    ethnicity: prefilledData?.userMetadata?.ethnicity || '',\r\n    language: prefilledData?.userMetadata?.language?.toString() || '',\r\n    weight: prefilledData?.userMetadata?.weight?.toString() || '',\r\n    zipcode: prefilledData?.userMetadata?.zipcode || '',\r\n    sessionNotes: prefilledData?.userMetadata?.sessionNotes || ''\r\n  });\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [toasts, setToasts] = useState<Array<{\r\n    id: string;\r\n    type: 'error' | 'warning' | 'info' | 'success';\r\n    title: string;\r\n    message: string;\r\n    timestamp: number;\r\n  }>>([]);\r\n\r\n  // Validation state for real-time field validation\r\n  const [validationErrors, setValidationErrors] = useState<{\r\n    age?: string;\r\n    weight?: string;\r\n    zipcode?: string;\r\n    sessionNotes?: string;\r\n  }>({});\r\n\r\n  const [isCorrectingGrammar, setIsCorrectingGrammar] = useState(false);\r\n\r\n  // Individual file metadata editing state\r\n  const [editingFileMetadata, setEditingFileMetadata] = useState<string | null>(null);\r\n  const [tempMetadata, setTempMetadata] = useState<UserMetadata>(defaultUserMetadata);\r\n  \r\n  // Validation state for individual file metadata editing\r\n  const [tempValidationErrors, setTempValidationErrors] = useState<{\r\n    age?: string;\r\n    weight?: string;\r\n    zipcode?: string;\r\n    sessionNotes?: string;\r\n  }>({});\r\n\r\n  // User ID management state - REMOVED (now part of metadata)\r\n  \r\n  // Auto-generate user ID when component loads (for form metadata)\r\n  useEffect(() => {\r\n    if (!userMetadata.userId) {\r\n      const newUserId = `user-${Date.now()}-${Math.random().toString(36).substr(2, 6)}`;\r\n      setUserMetadata(prev => ({ ...prev, userId: newUserId }));\r\n    }\r\n  }, [userMetadata.userId]);\r\n\r\n  // Update isMultiMode based on processing mode\r\n  useEffect(() => {\r\n    setIsMultiMode(processingMode !== 'single');\r\n  }, [processingMode]);\r\n\r\n  // Helper function to get authenticated user ID for blob storage\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Toast utility functions\r\n  const addToast = useCallback((type: 'error' | 'warning' | 'info' | 'success', title: string, message: string) => {\r\n    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n    const newToast = {\r\n      id,\r\n      type,\r\n      title,\r\n      message,\r\n      timestamp: Date.now()\r\n    };\r\n    setToasts(prev => [...prev, newToast]);\r\n    \r\n    // Auto-remove toast after 8 seconds for errors, 5 seconds for others\r\n    const duration = type === 'error' ? 8000 : 5000;\r\n    setTimeout(() => {\r\n      setToasts(prev => prev.filter(toast => toast.id !== id));\r\n    }, duration);\r\n  }, []);\r\n\r\n  const removeToast = useCallback((id: string) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id));\r\n  }, []);\r\n\r\n  // Handle pre-filled data from re-run functionality\r\n  useEffect(() => {\r\n    if (prefilledData) {\r\n      // Show a toast to inform user that data has been pre-filled\r\n      addToast('info', 'Session Data Pre-filled', \r\n        `Metadata and audio file from session ${prefilledData.originalSessionId ? prefilledData.originalSessionId.slice(0, 8) + '...' : ''} have been loaded. Click \"Start Analysis\" to begin processing.`);\r\n      \r\n      // If there's an audio URL, create a virtual audio file entry\r\n      if (prefilledData.audioUrl && prefilledData.audioFileName) {\r\n        // Create a mock file object since we already have the URL\r\n        const mockFile = {\r\n          name: prefilledData.audioFileName,\r\n          size: 0,\r\n          type: 'audio/wav',\r\n          lastModified: Date.now(),\r\n          stream: () => new ReadableStream(),\r\n          arrayBuffer: () => Promise.resolve(new ArrayBuffer(0)),\r\n          text: () => Promise.resolve(''),\r\n          slice: () => new Blob()\r\n        } as File;\r\n\r\n        const virtualAudioFile: AudioFile = {\r\n          id: `prefilled-${Date.now()}`,\r\n          file: mockFile,\r\n          url: prefilledData.audioUrl,\r\n          duration: undefined\r\n        };\r\n        \r\n        if (isMultiMode) {\r\n          setAudioFiles([virtualAudioFile]);\r\n        } else {\r\n          setAudioFile(virtualAudioFile);\r\n        }\r\n      }\r\n    }\r\n  }, [prefilledData, addToast, isMultiMode]); // Include dependencies\r\n\r\n  const resetState = useCallback(() => {\r\n    setAudioFiles([]);\r\n    setAudioFile(null);\r\n    setProgress({ stage: 'idle', progress: 0, message: '' });\r\n    setResult(null);\r\n    setResults({});\r\n    setProcessingProgress({});\r\n    setError(null);\r\n    setIsPlaying(false);\r\n    setCurrentTime(0);\r\n    setPlayingFileId(null);\r\n    setIsProcessing(false);\r\n  }, []);\r\n\r\n  const generateFileId = () => {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  };\r\n\r\n  const addAudioFile = useCallback((file: File, metadata?: UserMetadata) => {\r\n    const id = generateFileId();\r\n    const url = URL.createObjectURL(file);\r\n    \r\n    // Create individual userMetadata for this file\r\n    let fileUserMetadata: UserMetadata;\r\n    if (processingMode === 'batch-csv' && metadata) {\r\n      // Use provided metadata for CSV mode\r\n      fileUserMetadata = metadata;\r\n    } else if (processingMode === 'batch-files') {\r\n      // Generate individual metadata for batch files mode\r\n      fileUserMetadata = {\r\n        userId: generateFileId(),\r\n        age: userMetadata.age,\r\n        gender: userMetadata.gender,\r\n        race: userMetadata.race,\r\n        ethnicity: userMetadata.ethnicity,\r\n        language: userMetadata.language,\r\n        weight: userMetadata.weight,\r\n        zipcode: userMetadata.zipcode,\r\n        sessionNotes: userMetadata.sessionNotes\r\n      };\r\n    } else {\r\n      // For single mode, use the existing userMetadata structure\r\n      fileUserMetadata = userMetadata;\r\n    }\r\n    \r\n    const audioFile: AudioFile = { id, file, url, userMetadata: fileUserMetadata };\r\n    \r\n    if (isMultiMode) {\r\n      setAudioFiles(prev => [...prev, audioFile]);\r\n      setFileStates(prev => ({ ...prev, [id]: 'ready' }));\r\n      setProcessingProgress(prev => ({ ...prev, [id]: { stage: 'idle', progress: 0, message: 'Ready to process' } }));\r\n    } else {\r\n      setAudioFile(audioFile);\r\n    }\r\n    \r\n    announceToScreenReader(`Audio file selected: ${file.name}`);\r\n\r\n    // Get audio duration\r\n    const audio = new Audio(url);\r\n    audio.addEventListener('loadedmetadata', () => {\r\n      if (isMultiMode) {\r\n        setAudioFiles(prev => prev.map(af => \r\n          af.id === id ? { ...af, duration: audio.duration } : af\r\n        ));\r\n      } else {\r\n        setAudioFile(prev => prev ? { ...prev, duration: audio.duration } : null);\r\n      }\r\n    });\r\n  }, [isMultiMode, announceToScreenReader, processingMode, userMetadata]);\r\n\r\n  const removeAudioFile = useCallback((fileId: string) => {\r\n    if (isMultiMode) {\r\n      setAudioFiles(prev => {\r\n        const fileToRemove = prev.find(f => f.id === fileId);\r\n        if (fileToRemove) {\r\n          URL.revokeObjectURL(fileToRemove.url);\r\n        }\r\n        return prev.filter(f => f.id !== fileId);\r\n      });\r\n      // Clean up associated progress, results, and states\r\n      setProcessingProgress(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n      setResults(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n      setFileStates(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n    }\r\n  }, [isMultiMode]);\r\n\r\n  // Individual file metadata editing\r\n  const updateFileMetadata = useCallback((fileId: string, newMetadata: UserMetadata) => {\r\n    if (processingMode !== 'single') {\r\n      setAudioFiles(prev => prev.map(file => \r\n        file.id === fileId ? { ...file, userMetadata: newMetadata } : file\r\n      ));\r\n    } else if (audioFile && audioFile.id === fileId) {\r\n      setAudioFile(prev => prev ? { ...prev, userMetadata: newMetadata } : null);\r\n    }\r\n  }, [processingMode, audioFile]);\r\n\r\n  // Temp metadata validation functions for individual file editing\r\n  const validateTempMetadata = useCallback(() => {\r\n    const errors: string[] = [];\r\n\r\n    // Age validation\r\n    if (tempMetadata.age) {\r\n      const age = parseInt(tempMetadata.age);\r\n      if (isNaN(age) || age < 18 || age > 130) {\r\n        errors.push('Age must be between 18 and 130');\r\n      }\r\n    }\r\n\r\n    // Weight validation\r\n    if (tempMetadata.weight) {\r\n      const weight = parseInt(tempMetadata.weight);\r\n      if (isNaN(weight) || weight < 10 || weight > 1000) {\r\n        errors.push('Weight must be between 10 and 1000 pounds (lbs)');\r\n      }\r\n    }\r\n\r\n    // Zipcode validation\r\n    if (tempMetadata.zipcode) {\r\n      const zipcodeRegex = /^[a-zA-Z0-9]{1,10}$/;\r\n      if (!zipcodeRegex.test(tempMetadata.zipcode)) {\r\n        errors.push('Zipcode must be alphanumeric and contain no more than 10 characters');\r\n      }\r\n    }\r\n\r\n    // Session notes validation\r\n    if (tempMetadata.sessionNotes && tempMetadata.sessionNotes.length > 500) {\r\n      errors.push('Session notes must be 500 characters or less');\r\n    }\r\n\r\n    return errors;\r\n  }, [tempMetadata]);\r\n\r\n  // Individual field validation functions for real-time validation\r\n  const validateAge = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    const age = parseInt(value);\r\n    if (isNaN(age) || age < 18 || age > 130) {\r\n      return 'Age must be between 18 and 130';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateWeight = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    const weight = parseInt(value);\r\n    if (isNaN(weight) || weight < 10 || weight > 1000) {\r\n      return 'Weight must be between 10 and 1000 pounds (lbs)';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateZipcode = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined; // Optional field\r\n    const zipcodeRegex = /^[0-9]{5}$/;\r\n    if (!zipcodeRegex.test(value)) {\r\n      return 'Zipcode must be 5 digits (e.g., 12345)';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateSessionNotes = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    if (value.length > 500) {\r\n      return 'Session notes must be 500 characters or less';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateGender = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined; // Optional field\r\n    const validGenders = ['female', 'male', 'non-binary', 'transgender female', 'transgender male', 'other', 'prefer'];\r\n    if (!validGenders.includes(value)) {\r\n      return 'Please select a valid gender option';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateRace = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined; // Optional field\r\n    const validRaces = ['white', 'black or african-american', 'asian', 'american indian or alaskan native', 'native hawaiian or pacific islander', 'two or more races', 'other', 'prefer not to say'];\r\n    if (!validRaces.includes(value)) {\r\n      return 'Please select a valid race option';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateEthnicity = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined; // Optional field\r\n    return undefined;\r\n  }, []);\r\n\r\n  // Real-time field validation handler for temp metadata\r\n  const handleTempFieldValidation = useCallback((field: string, value: string) => {\r\n    let error: string | undefined;\r\n    \r\n    switch (field) {\r\n      case 'age':\r\n        error = validateAge(value);\r\n        break;\r\n      case 'weight':\r\n        error = validateWeight(value);\r\n        break;\r\n      case 'zipcode':\r\n        error = validateZipcode(value);\r\n        break;\r\n      case 'sessionNotes':\r\n        error = validateSessionNotes(value);\r\n        break;\r\n      case 'gender':\r\n        error = validateGender(value);\r\n        break;\r\n      case 'race':\r\n        error = validateRace(value);\r\n        break;\r\n      case 'ethnicity':\r\n        error = validateEthnicity(value);\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    setTempValidationErrors(prev => ({\r\n      ...prev,\r\n      [field]: error\r\n    }));\r\n  }, [validateAge, validateWeight, validateZipcode, validateSessionNotes, validateGender, validateRace, validateEthnicity]);\r\n\r\n  // Open metadata editor for a specific file\r\n  const openMetadataEditor = useCallback((fileId: string, currentMetadata?: UserMetadata) => {\r\n    setEditingFileMetadata(fileId);\r\n    setTempMetadata(currentMetadata || { ...defaultUserMetadata, userId: crypto.randomUUID() });\r\n    setTempValidationErrors({}); // Clear validation errors when opening\r\n  }, []);\r\n\r\n  // Save metadata changes\r\n  const saveMetadataChanges = useCallback(() => {\r\n    if (editingFileMetadata) {\r\n      // Validate temp metadata before saving\r\n      const validationErrors = validateTempMetadata();\r\n      \r\n      if (validationErrors.length > 0) {\r\n        // Show validation errors as toast messages\r\n        validationErrors.forEach(error => {\r\n          addToast('error', 'Validation Error', error);\r\n        });\r\n        return; // Don't save if there are validation errors\r\n      }\r\n      \r\n      updateFileMetadata(editingFileMetadata, tempMetadata);\r\n      setEditingFileMetadata(null);\r\n      setTempMetadata(defaultUserMetadata);\r\n      setTempValidationErrors({}); // Clear validation errors\r\n    }\r\n  }, [editingFileMetadata, tempMetadata, updateFileMetadata, validateTempMetadata, addToast]);\r\n\r\n  // Cancel metadata editing\r\n  const cancelMetadataEdit = useCallback(() => {\r\n    setEditingFileMetadata(null);\r\n    setTempMetadata(defaultUserMetadata);\r\n    setTempValidationErrors({}); // Clear validation errors when canceling\r\n  }, []);\r\n\r\n  const handleCsvFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    if (!file.name.toLowerCase().endsWith('.csv')) {\r\n      setCsvValidationErrors(['Please select a valid CSV file']);\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      try {\r\n        const csvText = e.target?.result as string;\r\n        const rows = csvText.split('\\n').filter(row => row.trim());\r\n        \r\n        if (rows.length < 2) {\r\n          setCsvValidationErrors(['CSV must contain at least a header row and one data row']);\r\n          return;\r\n        }\r\n\r\n        const headers = rows[0].split(',').map(h => h.trim().replace(/\"/g, ''));\r\n        const requiredHeaders = ['userId', 'fileUrl'];\r\n        const optionalHeaders = ['age', 'gender', 'race', 'ethnicity', 'language', 'weight', 'zipcode', 'sessionNotes', 'fileName'];\r\n        \r\n        const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));\r\n        if (missingHeaders.length > 0) {\r\n          setCsvValidationErrors([`Missing required columns: ${missingHeaders.join(', ')}`]);\r\n          return;\r\n        }\r\n\r\n        const parsedRows: CsvBatchRow[] = [];\r\n        const errors: string[] = [];\r\n\r\n        for (let i = 1; i < rows.length; i++) {\r\n          const values = rows[i].split(',').map(v => v.trim().replace(/\"/g, ''));\r\n          const row: CsvBatchRow = { userId: '', fileUrl: '' };\r\n\r\n          headers.forEach((header, index) => {\r\n            const value = values[index] || '';\r\n            if (header === 'userId' || header === 'fileUrl') {\r\n              (row as any)[header] = value;\r\n            } else if (optionalHeaders.includes(header)) {\r\n              (row as any)[header] = value;\r\n            }\r\n          });\r\n\r\n          if (!row.userId || !row.fileUrl) {\r\n            errors.push(`Row ${i + 1}: Missing required values for userId or fileUrl`);\r\n          } else if (!row.fileUrl.startsWith('http')) {\r\n            errors.push(`Row ${i + 1}: fileUrl must be a valid URL`);\r\n          } else {\r\n            parsedRows.push(row);\r\n          }\r\n        }\r\n\r\n        if (errors.length > 0) {\r\n          setCsvValidationErrors(errors);\r\n          return;\r\n        }\r\n\r\n        setCsvBatchData({ rows: parsedRows, fileName: file.name });\r\n        setCsvValidationErrors([]);\r\n        announceToScreenReader(`CSV file loaded with ${parsedRows.length} valid rows`);\r\n      } catch (error) {\r\n        setCsvValidationErrors(['Error parsing CSV file. Please check file format.']);\r\n      }\r\n    };\r\n\r\n    reader.readAsText(file);\r\n  }, [announceToScreenReader]);\r\n\r\n  const processCsvBatch = useCallback(async () => {\r\n    if (!csvBatchData) return;\r\n\r\n    const totalFiles = csvBatchData.rows.length;\r\n    setCsvProcessingProgress({\r\n      isProcessing: true,\r\n      currentFile: 0,\r\n      totalFiles,\r\n      currentFileName: '',\r\n      message: 'Starting CSV batch processing...'\r\n    });\r\n\r\n    try {\r\n      for (let i = 0; i < csvBatchData.rows.length; i++) {\r\n        const row = csvBatchData.rows[i];\r\n        const filename = row.fileName || row.fileUrl.split('/').pop() || 'audio-file.wav';\r\n        \r\n        setCsvProcessingProgress(prev => ({\r\n          ...prev,\r\n          currentFile: i + 1,\r\n          currentFileName: filename,\r\n          message: `Processing file ${i + 1} of ${totalFiles}: ${filename}`\r\n        }));\r\n\r\n        try {\r\n          // Fetch audio file from URL\r\n          const response = await fetch(row.fileUrl);\r\n          if (!response.ok) {\r\n            throw new Error(`Failed to fetch audio file: ${response.statusText}`);\r\n          }\r\n\r\n          const blob = await response.blob();\r\n          const file = new (window as any).File([blob], filename, { type: blob.type || 'audio/wav' }) as File;\r\n\r\n          // Create metadata from CSV row\r\n          const metadata: UserMetadata = {\r\n            userId: row.userId,\r\n            age: row.age,\r\n            gender: row.gender,\r\n            race: row.race,\r\n            ethnicity: row.ethnicity,\r\n            language: row.language,\r\n            weight: row.weight,\r\n            zipcode: row.zipcode,\r\n            sessionNotes: row.sessionNotes\r\n          };\r\n\r\n          // Add the file with its metadata\r\n          addAudioFile(file, metadata);\r\n        } catch (error) {\r\n          console.error(`Error processing CSV row for ${row.userId}:`, error);\r\n          addToast('error', 'File Processing Error', `Failed to process ${filename}: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n          // Continue with other files even if one fails\r\n        }\r\n\r\n        // Small delay to allow UI updates\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n      }\r\n\r\n      setCsvProcessingProgress(prev => ({\r\n        ...prev,\r\n        message: `Successfully processed ${totalFiles} files from CSV`\r\n      }));\r\n\r\n      addToast('success', 'CSV Processing Complete', `Successfully loaded ${totalFiles} files from CSV for batch processing`);\r\n      announceToScreenReader(`CSV batch processing complete. ${totalFiles} files loaded successfully.`);\r\n\r\n    } catch (error) {\r\n      console.error('CSV batch processing error:', error);\r\n      addToast('error', 'CSV Processing Failed', 'An error occurred during CSV batch processing');\r\n    } finally {\r\n      // Reset progress after a short delay to show completion\r\n      setTimeout(() => {\r\n        setCsvProcessingProgress({\r\n          isProcessing: false,\r\n          currentFile: 0,\r\n          totalFiles: 0,\r\n          currentFileName: '',\r\n          message: ''\r\n        });\r\n      }, 2000);\r\n    }\r\n  }, [csvBatchData, addAudioFile, addToast, announceToScreenReader, audioFiles]);\r\n\r\n  const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    // Process multiple files or single file\r\n    Array.from(files).forEach(file => {\r\n      // Validate file type - check both MIME type and file extension\r\n      const supportedMimeTypes = [\r\n        'audio/wav', 'audio/wave', 'audio/x-wav',\r\n        'audio/mp3', 'audio/mpeg', 'audio/mp4',\r\n        'audio/m4a', 'audio/x-m4a', 'audio/mp4a-latm',\r\n        'audio/aac', 'audio/x-aac',\r\n        'audio/flac', 'audio/x-flac'\r\n      ];\r\n      \r\n      const fileName = file.name.toLowerCase();\r\n      const supportedExtensions = ['.wav', '.mp3', '.m4a', '.aac', '.flac'];\r\n      const hasValidExtension = supportedExtensions.some(ext => fileName.endsWith(ext));\r\n      const hasValidMimeType = supportedMimeTypes.includes(file.type);\r\n      \r\n      // Accept file if either MIME type OR extension is valid (some browsers don't set MIME types correctly)\r\n      if (!hasValidMimeType && !hasValidExtension) {\r\n        setError(`Unsupported file type for ${file.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`);\r\n        addToast('error', 'Unsupported File', `${file.name} is not a supported audio file format`);\r\n        announceToScreenReader(`Error: Unsupported file format selected for ${file.name}`);\r\n        return;\r\n      }\r\n\r\n      // Validate file size (50MB limit)\r\n      const maxSize = 50 * 1024 * 1024;\r\n      if (file.size > maxSize) {\r\n        setError(`File ${file.name} is too large. File size must be less than 50MB`);\r\n        addToast('error', 'File Too Large', `${file.name} size must be less than 50MB`);\r\n        announceToScreenReader(`Error: File ${file.name} is too large`);\r\n        return;\r\n      }\r\n\r\n      addAudioFile(file);\r\n      setError(null);\r\n    });\r\n  }, [announceToScreenReader, addAudioFile, addToast]);\r\n\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  }, []);\r\n\r\n  const handleDrop = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    const files = e.dataTransfer.files;\r\n    if (files.length > 0) {\r\n      const mockEvent = { target: { files } } as React.ChangeEvent<HTMLInputElement>;\r\n      handleFileSelect(mockEvent);\r\n    }\r\n  }, [handleFileSelect]);\r\n\r\n  // @ts-ignore - Will be used for backward compatibility\r\n  const toggleMode = useCallback(() => {\r\n    setIsMultiMode(prev => {\r\n      const newMode = !prev;\r\n      const processingModeString = newMode ? 'batch-files' : 'single';\r\n      // Save to localStorage\r\n      setStoredProcessingMode(processingModeString);\r\n      // Clear files when switching modes\r\n      resetState();\r\n      return newMode;\r\n    });\r\n  }, [resetState]);\r\n\r\n  const handlePlayPause = useCallback(() => {\r\n    if (!audioRef.current) return;\r\n\r\n    if (isPlaying) {\r\n      audioRef.current.pause();\r\n      setIsPlaying(false);\r\n      announceToScreenReader('Audio paused');\r\n    } else {\r\n      audioRef.current.play();\r\n      setIsPlaying(true);\r\n      announceToScreenReader('Audio playing');\r\n    }\r\n  }, [isPlaying, announceToScreenReader]);\r\n\r\n  const handleTimeUpdate = useCallback(() => {\r\n    if (audioRef.current) {\r\n      setCurrentTime(audioRef.current.currentTime);\r\n    }\r\n  }, []);\r\n\r\n  const formatTime = useCallback((seconds: number): string => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  }, []);\r\n\r\n  // Safe parsing helper to handle potential NaN values\r\n  const safeParseFloat = useCallback((value: string | undefined | null, defaultValue: number = 0): number => {\r\n    if (!value) return defaultValue;\r\n    const parsed = parseFloat(value);\r\n    return isNaN(parsed) ? defaultValue : parsed;\r\n  }, []);\r\n\r\n  const validateMetadata = useCallback(() => {\r\n    const errors: string[] = [];\r\n\r\n    // Age validation\r\n    if (userMetadata.age) {\r\n      const age = parseInt(userMetadata.age);\r\n      if (isNaN(age) || age < 18 || age > 130) {\r\n        errors.push('Age must be between 18 and 130');\r\n      }\r\n    }\r\n\r\n    // Gender validation\r\n    if (userMetadata.gender) {\r\n      const validGenders = ['female', 'male', 'non-binary', 'transgender female', 'transgender male', 'other', 'prefer'];\r\n      if (!validGenders.includes(userMetadata.gender)) {\r\n        errors.push('Invalid gender. Must be: female, male, non-binary, transgender female, transgender male, other, or prefer');\r\n      }\r\n    }\r\n\r\n    // Race validation\r\n    if (userMetadata.race) {\r\n      const validRaces = ['white', 'black or african-american', 'asian', 'american indian or alaskan native', 'native hawaiian or pacific islander', 'two or more races', 'other', 'prefer not to say'];\r\n      if (!validRaces.includes(userMetadata.race)) {\r\n        errors.push('Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native hawaiian or pacific islander, two or more races, other, prefer not to say');\r\n      }\r\n    }\r\n\r\n    // Ethnicity validation - optional field\r\n    if (userMetadata.ethnicity) {\r\n      const validEthnicities = ['Hispanic, Latino, or Spanish Origin', 'Not Hispanic, Latino, or Spanish Origin'];\r\n      if (!validEthnicities.includes(userMetadata.ethnicity)) {\r\n        errors.push('Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin');\r\n      }\r\n    }\r\n\r\n    // Zipcode validation\r\n    if (userMetadata.zipcode) {\r\n      const zipcodeRegex = /^[a-zA-Z0-9]{1,10}$/;\r\n      if (!zipcodeRegex.test(userMetadata.zipcode)) {\r\n        errors.push('Zipcode must be alphanumeric and contain no more than 10 characters');\r\n      }\r\n    }\r\n\r\n    // Weight validation\r\n    if (userMetadata.weight) {\r\n      const weight = parseInt(userMetadata.weight);\r\n      if (isNaN(weight) || weight < 10 || weight > 1000) {\r\n        errors.push('Weight must be between 10 and 1000 pounds (lbs)');\r\n      }\r\n    }\r\n\r\n    return errors;\r\n  }, [userMetadata]);\r\n\r\n  // Real-time field validation handler\r\n  const handleFieldValidation = useCallback((field: string, value: string) => {\r\n    let error: string | undefined;\r\n    \r\n    switch (field) {\r\n      case 'age':\r\n        error = validateAge(value);\r\n        break;\r\n      case 'weight':\r\n        error = validateWeight(value);\r\n        break;\r\n      case 'zipcode':\r\n        error = validateZipcode(value);\r\n        break;\r\n      case 'sessionNotes':\r\n        error = validateSessionNotes(value);\r\n        break;\r\n      case 'gender':\r\n        error = validateGender(value);\r\n        break;\r\n      case 'race':\r\n        error = validateRace(value);\r\n        break;\r\n      case 'ethnicity':\r\n        error = validateEthnicity(value);\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    setValidationErrors(prev => {\r\n      const newErrors = {\r\n        ...prev,\r\n        [field]: error\r\n      };\r\n      \r\n      // Check if all validation errors are cleared\r\n      const hasAnyErrors = Object.values(newErrors).some(err => err !== undefined);\r\n      \r\n      // Clear global error if no field validation errors exist, or if this specific field error was cleared\r\n      // and the global error contains validation messages\r\n      if (!hasAnyErrors) {\r\n        setError(null);\r\n      } else if (error === undefined) {\r\n        // If this specific field error was cleared, check if global error is validation-related and clear it\r\n        setError(prevError => {\r\n          if (prevError && prevError.toLowerCase().includes('validation')) {\r\n            return null;\r\n          }\r\n          return prevError;\r\n        });\r\n      }\r\n      \r\n      return newErrors;\r\n    });\r\n  }, [validateAge, validateWeight, validateZipcode, validateSessionNotes, validateGender, validateRace, validateEthnicity]);\r\n\r\n  const handleGrammarCorrection = useCallback(async () => {\r\n    if (!userMetadata.sessionNotes.trim()) {\r\n      return;\r\n    }\r\n\r\n    setIsCorrectingGrammar(true);\r\n    try {\r\n      const response = await apiService.correctGrammar(userMetadata.sessionNotes);\r\n      \r\n      // Update the session notes with the corrected text\r\n      setUserMetadata(prev => ({\r\n        ...prev,\r\n        sessionNotes: response.correctedText\r\n      }));\r\n      \r\n      // Show success toast\r\n      addToast('success', 'Grammar Corrected', 'Grammar and spelling corrected successfully');\r\n      \r\n    } catch (error) {\r\n      console.error('Grammar correction failed:', error);\r\n      const appError = error as AppError;\r\n      \r\n      // Show error toast\r\n      addToast('error', 'Grammar Correction Failed', appError.message || 'Failed to correct grammar. Please try again.');\r\n    } finally {\r\n      setIsCorrectingGrammar(false);\r\n    }\r\n  }, [userMetadata.sessionNotes]);\r\n\r\n  const buildMetadata = useCallback(() => {\r\n    const metadata: Partial<SessionMetadata> = {};\r\n    let hasMetadata = false;\r\n\r\n    if (userMetadata.age) {\r\n      const ageNum = parseInt(userMetadata.age);\r\n      if (!isNaN(ageNum)) {\r\n        metadata.age = ageNum;\r\n        hasMetadata = true;\r\n      }\r\n    }\r\n    if (userMetadata.gender) {\r\n      metadata.gender = userMetadata.gender as SessionMetadata['gender'];\r\n      hasMetadata = true;\r\n    }\r\n    // Required fields - always include these if provided\r\n    if (userMetadata.gender) {\r\n      metadata.gender = userMetadata.gender as SessionMetadata['gender'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.race) {\r\n      metadata.race = userMetadata.race as SessionMetadata['race'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.ethnicity) {\r\n      metadata.ethnicity = userMetadata.ethnicity as SessionMetadata['ethnicity'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.zipcode) {\r\n      metadata.zipcode = userMetadata.zipcode;\r\n      hasMetadata = true;\r\n    }\r\n    \r\n    // Optional fields\r\n    if (userMetadata.language === 'true' || userMetadata.language === 'false') {\r\n      metadata.language = userMetadata.language === 'true';\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.weight) {\r\n      const weightNum = parseInt(userMetadata.weight);\r\n      if (!isNaN(weightNum)) {\r\n        metadata.weight = weightNum;\r\n        hasMetadata = true;\r\n      }\r\n    }\r\n\r\n    return hasMetadata ? metadata : undefined;\r\n  }, [userMetadata]);\r\n\r\n  const buildMetadataFromUserData = useCallback((userData: UserMetadata) => {\r\n    const metadata: Partial<SessionMetadata> = {};\r\n    let hasMetadata = false;\r\n\r\n    // Optional fields\r\n    if (userData.age) {\r\n      const ageNum = parseInt(userData.age);\r\n      if (!isNaN(ageNum)) {\r\n        metadata.age = ageNum;\r\n        hasMetadata = true;\r\n      }\r\n    }\r\n    if (userData.weight) {\r\n      const weightNum = parseInt(userData.weight);\r\n      if (!isNaN(weightNum)) {\r\n        metadata.weight = weightNum;\r\n        hasMetadata = true;\r\n      }\r\n    }\r\n    if (userData.language === 'true' || userData.language === 'false') {\r\n      metadata.language = userData.language === 'true';\r\n      hasMetadata = true;\r\n    }\r\n    \r\n    // Required fields - always include these if provided\r\n    if (userData.gender) {\r\n      metadata.gender = userData.gender as SessionMetadata['gender'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userData.race) {\r\n      metadata.race = userData.race as SessionMetadata['race'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userData.ethnicity) {\r\n      metadata.ethnicity = userData.ethnicity as SessionMetadata['ethnicity'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userData.zipcode) {\r\n      metadata.zipcode = userData.zipcode;\r\n      hasMetadata = true;\r\n    }\r\n\r\n    return hasMetadata ? metadata : undefined;\r\n  }, []);\r\n\r\n  // Apply to All Files function for batch-files mode\r\n  const applyToAllFiles = useCallback(() => {\r\n    if (processingMode !== 'batch-files' || audioFiles.length === 0) {\r\n      return;\r\n    }\r\n\r\n    // Apply the current userMetadata (from the main form) to all files' userMetadata\r\n    setAudioFiles(prevFiles => \r\n      prevFiles.map(file => ({\r\n        ...file,\r\n        userMetadata: {\r\n          userId: userMetadata.userId || file.userMetadata?.userId || crypto.randomUUID(),\r\n          age: userMetadata.age || file.userMetadata?.age || '',\r\n          gender: userMetadata.gender || file.userMetadata?.gender || '',\r\n          race: userMetadata.race || file.userMetadata?.race || '',\r\n          ethnicity: userMetadata.ethnicity || file.userMetadata?.ethnicity || '',\r\n          language: userMetadata.language || file.userMetadata?.language || '',\r\n          weight: userMetadata.weight || file.userMetadata?.weight || '',\r\n          zipcode: userMetadata.zipcode || file.userMetadata?.zipcode || '',\r\n          sessionNotes: userMetadata.sessionNotes || file.userMetadata?.sessionNotes || ''\r\n        }\r\n      }))\r\n    );\r\n\r\n    // Show success message\r\n    addToast('success', 'Applied to All Files', 'Patient information has been applied to all uploaded files');\r\n    announceToScreenReader('Patient information has been applied to all uploaded files');\r\n  }, [processingMode, audioFiles, userMetadata, addToast, announceToScreenReader]);\r\n\r\n  // Download CSV template function for batch-csv mode\r\n  const downloadCsvTemplate = useCallback(() => {\r\n    // Define all CSV columns\r\n    const headers = [\r\n      'userId',\r\n      'fileUrl',\r\n      'age',\r\n      'gender',\r\n      'race',\r\n      'ethnicity',\r\n      'primary language',\r\n      'weight',\r\n      'zipcode',\r\n      'sessionNotes',\r\n      'fileName'\r\n    ];\r\n\r\n    // Create sample rows with default patient information if available\r\n    const sampleRows = [\r\n      {\r\n        userId: userMetadata.userId || 'user-sample-1',\r\n        fileUrl: 'https://yourstorageaccount.blob.core.windows.net/audio/sample1.wav',\r\n        age: userMetadata.age || '30',\r\n        gender: userMetadata.gender || 'male',\r\n        race: userMetadata.race || 'white',\r\n        ethnicity: userMetadata.ethnicity || 'not hispanic or latino',\r\n        'primary language': userMetadata.language === 'true' ? 'english' : userMetadata.language === 'false' ? 'other' : userMetadata.language || 'english',\r\n        weight: userMetadata.weight || '150',\r\n        zipcode: userMetadata.zipcode || '12345',\r\n        sessionNotes: userMetadata.sessionNotes || 'Sample session notes',\r\n        fileName: 'sample1.wav'\r\n      },\r\n      {\r\n        userId: userMetadata.userId ? `${userMetadata.userId}-2` : 'user-sample-2',\r\n        fileUrl: 'https://yourstorageaccount.blob.core.windows.net/audio/sample2.wav',\r\n        age: userMetadata.age || '25',\r\n        gender: userMetadata.gender || 'female',\r\n        race: userMetadata.race || 'asian',\r\n        ethnicity: userMetadata.ethnicity || 'not hispanic or latino',\r\n        'primary language': userMetadata.language === 'true' ? 'english' : userMetadata.language === 'false' ? 'other' : userMetadata.language || 'other',\r\n        weight: userMetadata.weight || '120',\r\n        zipcode: userMetadata.zipcode || '54321',\r\n        sessionNotes: userMetadata.sessionNotes || 'Another sample session',\r\n        fileName: 'sample2.wav'\r\n      }\r\n    ];\r\n\r\n    // Convert to CSV format\r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...sampleRows.map(row => \r\n        headers.map(header => {\r\n          const value = row[header as keyof typeof row] || '';\r\n          // Escape values containing commas or quotes\r\n          return value.includes(',') || value.includes('\"') ? `\"${value.replace(/\"/g, '\"\"')}\"` : value;\r\n        }).join(',')\r\n      )\r\n    ].join('\\n');\r\n\r\n    // Create and download the file\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', 'batch-processing-template.csv');\r\n    link.style.visibility = 'hidden';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n\r\n    // Show success message\r\n    addToast('success', 'CSV Template Downloaded', 'CSV template file has been downloaded with sample data');\r\n    announceToScreenReader('CSV template file downloaded successfully');\r\n  }, [userMetadata, addToast, announceToScreenReader]);\r\n\r\n  const processAndAnalyze = useCallback(async () => {\r\n    if (isMultiMode) {\r\n      if (audioFiles.length === 0 || !userMetadata.userId.trim()) {\r\n        setError('Please select audio files. User ID is automatically generated.');\r\n        addToast('error', 'Missing Information', 'Please select audio files. User ID is automatically generated.');\r\n        return;\r\n      }\r\n      await processMultipleFiles();\r\n    } else {\r\n      if (!audioFile || !userMetadata.userId.trim()) {\r\n        setError('Please select an audio file. User ID is automatically generated.');\r\n        addToast('error', 'Missing Information', 'Please select an audio file. User ID is automatically generated.');\r\n        return;\r\n      }\r\n      await processSingleFile();\r\n    }\r\n  }, [audioFile, audioFiles, userMetadata.userId, isMultiMode]);\r\n\r\n  const processSingleFileById = useCallback(async (fileId: string, audioFile: AudioFile) => {\r\n    try {\r\n      // Step 1: Initiate session\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'initiating', progress: 5, message: 'Initiating session...' }\r\n      }));\r\n\r\n      // Use individual file metadata or fall back to shared metadata\r\n      const fileMetadata = audioFile.userMetadata || userMetadata;\r\n      const metadata = audioFile.userMetadata ? buildMetadataFromUserData(audioFile.userMetadata) : buildMetadata();\r\n      \r\n      const sessionRequest: any = {\r\n        userid: fileMetadata.userId.trim(),\r\n        is_initiated: true\r\n      };\r\n\r\n      // Only include metadata if we have any\r\n      if (metadata) {\r\n        sessionRequest.metadata = metadata;\r\n      }\r\n\r\n      const sessionResponse = await apiService.initiateSession(sessionRequest);\r\n\r\n      const sessionData: SessionInfo = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: fileMetadata.userId.trim()\r\n      };\r\n\r\n      // Save initial session data to blob storage so it appears in Analysis Sessions UI\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'initiating', progress: 10, message: 'Saving session data...', sessionId: sessionResponse.sessionId }\r\n      }));\r\n\r\n      const initialSessionData = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: getAuthenticatedUserId(), // Use authenticated user ID for session filtering/access control\r\n        metadata_user_id: fileMetadata.userId.trim(), // Store metadata user ID separately\r\n        ...(metadata && { userMetadata: metadata }), // Only include userMetadata if metadata exists\r\n        audioFileName: audioFile.file.name,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        status: 'initiated'\r\n      };\r\n\r\n      try {\r\n        console.log('Attempting to save session data (multi-file):', initialSessionData);\r\n        const saveResult = await apiService.saveSessionData(initialSessionData);\r\n        console.log('Session data saved successfully (multi-file):', saveResult);\r\n      } catch (error) {\r\n        console.error('Failed to save session data (multi-file):', error);\r\n        console.error('Session data that failed to save:', initialSessionData);\r\n        addToast('warning', 'Session Save Warning', 'Session data could not be saved to storage, but processing will continue.');\r\n        // Continue with the process even if saving fails\r\n        // This is not critical for the main workflow, but user should be informed\r\n      }\r\n\r\n      let audioUrl: string;\r\n      let fileName: string;\r\n\r\n      // Check if this is a pre-filled session with existing audio URL (re-run scenario)\r\n      // Ensure the URL is a valid Azure Storage URL, not a blob URL\r\n      if (audioFile.url && !audioFile.url.startsWith('blob:')) {\r\n        // Skip conversion and upload for re-run - audio is already processed and stored\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'uploading', progress: 40, message: 'Using existing audio file from previous session...' }\r\n        }));\r\n        \r\n        audioUrl = audioFile.url;\r\n        fileName = audioFile.file.name;\r\n        \r\n        // Skip to 65% progress since conversion and upload are not needed\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'submitting', progress: 65, message: 'Submitting for analysis...' }\r\n        }));\r\n      } else {\r\n        // Normal flow: convert and upload new audio file\r\n        // This includes the case where audioFile.url is a blob URL (invalid for backend)\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'converting', progress: 15, message: 'Converting audio to required format...' }\r\n        }));\r\n\r\n        // Step 2: Convert audio using FFmpeg\r\n        const convertedBlob = await convertAudioToWav(audioFile.file, (progressPercent: number) => {\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [fileId]: {\r\n              stage: 'converting',\r\n              progress: 15 + (progressPercent * 0.25), // 15-40% for conversion\r\n              message: `Converting audio... ${Math.round(progressPercent)}%`\r\n            }\r\n          }));\r\n        });\r\n\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'uploading', progress: 40, message: 'Uploading to Azure Blob Storage...' }\r\n        }));\r\n\r\n        // Step 3: Upload to Azure Blob Storage\r\n        fileName = `${userMetadata.userId}_${sessionData.sessionId}_${Date.now()}.wav`;\r\n        audioUrl = await uploadToAzureBlob(convertedBlob, fileName, (progressPercent: number) => {\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [fileId]: {\r\n              stage: 'uploading',\r\n              progress: 40 + (progressPercent * 0.25), // 40-65% for upload\r\n              message: `Uploading... ${Math.round(progressPercent)}%`\r\n            }\r\n          }));\r\n        }, getAuthenticatedUserId()); // Use authenticated user ID for blob storage folder structure\r\n      }\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'submitting', progress: 65, message: 'Submitting for analysis...' }\r\n      }));\r\n\r\n      // Update session data with audio information\r\n      try {\r\n        const updatedSessionData = {\r\n          ...initialSessionData,\r\n          audioUrl: audioUrl,\r\n          audioFileName: fileName,\r\n          status: 'processing',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n        await apiService.updateSessionData(sessionData.sessionId, updatedSessionData);\r\n      } catch (error) {\r\n        console.warn('Failed to update session data with audio info:', error);\r\n        // Continue with the process even if updating fails\r\n      }\r\n\r\n      // Step 4: Submit prediction with URL to /predictions/submit endpoint\r\n      await apiService.submitPrediction({\r\n        userId: userMetadata.userId.trim(),\r\n        sessionid: sessionData.sessionId,\r\n        audioFileUrl: audioUrl,\r\n        audioFileName: fileName\r\n      });\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'analyzing', progress: 70, message: 'Analyzing audio with Kintsugi Health API...' }\r\n      }));\r\n\r\n      // Step 5: Poll for results\r\n      const poller = new PredictionPoller(sessionData.sessionId);\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        poller.start(\r\n          (result: PredictionResult) => {\r\n            // Update progress during polling\r\n            const progressPercent = result.status === 'processing' ? 80 : \r\n                                  result.status === 'success' ? 95 : 70;\r\n            setProcessingProgress(prev => ({\r\n              ...prev,\r\n              [fileId]: { \r\n                stage: 'analyzing', \r\n                progress: progressPercent, \r\n                message: `Analysis ${result.status}...` \r\n              }\r\n            }));\r\n\r\n            // Check for predict_error and show toast\r\n            if (result.predictError) {\r\n              addToast('error', 'Prediction Error', \r\n                `${result.predictError.error}: ${result.predictError.message}`);\r\n            }\r\n          },\r\n          (result: PredictionResult) => {\r\n            // Check for final errors before completing\r\n            if (result.predictError) {\r\n              addToast('error', 'Analysis Failed', \r\n                `The analysis completed with an error: ${result.predictError.error} - ${result.predictError.message}`);\r\n              setProcessingProgress(prev => ({\r\n                ...prev,\r\n                [fileId]: { stage: 'error', progress: 0, message: 'Analysis failed with errors' }\r\n              }));\r\n              reject(new Error(`Prediction error: ${result.predictError.error}`));\r\n              return;\r\n            }\r\n\r\n            // Analysis complete successfully\r\n            const analysisResult: AnalysisResult = {\r\n              sessionId: sessionData.sessionId,\r\n              depressionScore: safeParseFloat(result.predictedScoreDepression, 0),\r\n              riskLevel: (() => {\r\n                const score = safeParseFloat(result.predictedScoreDepression, 0);\r\n                return score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low';\r\n              })(),\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n              insights: [\r\n                'Analysis completed using Kintsugi Health API',\r\n                result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                'Results should be reviewed by a qualified healthcare professional'\r\n              ].filter(insight => insight.trim() !== ''),\r\n              timestamp: result.updatedAt,\r\n              audioUrl: audioUrl,\r\n              rawApiResponse: result // Store the complete API response\r\n            };\r\n            \r\n            // Update session data with final analysis results (fire-and-forget)\r\n            const finalSessionData = {\r\n              ...initialSessionData,\r\n              audioUrl: audioUrl,\r\n              prediction: result, // Store the complete API response\r\n              analysisResults: {\r\n                depressionScore: safeParseFloat(result.predictedScoreDepression),\r\n                anxietyScore: safeParseFloat(result.predictedScoreAnxiety),\r\n                riskLevel: (() => {\r\n                  const score = safeParseFloat(result.predictedScoreDepression, 0);\r\n                  return score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low';\r\n                })(),\r\n                confidence: 0.85, // This would come from the API in a real scenario\r\n                insights: [\r\n                  'Analysis completed using Kintsugi Health API',\r\n                  result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                  result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                  'Results should be reviewed by a qualified healthcare professional'\r\n                ].filter(insight => insight.trim() !== ''),\r\n                completedAt: new Date().toISOString()\r\n              },\r\n              status: 'completed',\r\n              completedAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString()\r\n            };\r\n            \r\n            // Save analysis results to session storage (async, non-blocking)\r\n            apiService.saveSessionData(finalSessionData)\r\n              .then((result) => {\r\n                console.log('Multi-file session data saved with analysis results for session:', sessionData.sessionId);\r\n                console.log('Save result:', result);\r\n                addToast('success', 'Session Saved', 'Analysis results have been saved to session storage.');\r\n              })\r\n              .catch((error) => {\r\n                console.error('Failed to save multi-file analysis results to session storage:', error);\r\n                console.error('Session data that failed to save:', finalSessionData);\r\n                addToast('warning', 'Save Warning', 'Analysis completed but failed to save to session storage. Results are still available.');\r\n              });\r\n              \r\n            setProcessingProgress(prev => ({\r\n              ...prev,\r\n              [fileId]: { stage: 'complete', progress: 100, message: 'Analysis complete!' }\r\n            }));\r\n            setResults(prev => ({\r\n              ...prev,\r\n              [fileId]: analysisResult\r\n            }));\r\n            resolve();\r\n          },\r\n          (error: AppError) => {\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n\r\n    } catch (err) {\r\n      console.error(`Error processing file ${fileId}:`, err);\r\n      \r\n      // Extract error details for enhanced error display\r\n      let errorCode = 'UNKNOWN_ERROR';\r\n      let errorMessage = 'An unexpected error occurred';\r\n      let errorDetails: Record<string, unknown> = {};\r\n\r\n      if (err && typeof err === 'object') {\r\n        // Handle AppError interface\r\n        if ('code' in err && typeof err.code === 'string') {\r\n          errorCode = err.code;\r\n        }\r\n        if ('message' in err && typeof err.message === 'string') {\r\n          errorMessage = err.message;\r\n        }\r\n        if ('details' in err && typeof err.details === 'object') {\r\n          errorDetails = err.details as Record<string, unknown>;\r\n        }\r\n      } else if (err instanceof Error) {\r\n        errorMessage = err.message;\r\n        errorCode = err.name || 'ERROR';\r\n      }\r\n\r\n      // Update session status to failed if session was created\r\n      try {\r\n        // Try to find the session data from the processing progress or session context\r\n        const currentProgress = processingProgress[fileId];\r\n        if (currentProgress && currentProgress.sessionId) {\r\n          // Update session status to failed\r\n          const failedSessionData = {\r\n            sessionId: currentProgress.sessionId,\r\n            userId: getAuthenticatedUserId(),\r\n            metadata_user_id: userMetadata.userId.trim(),\r\n            audioFileName: audioFile.file.name,\r\n            createdAt: new Date().toISOString(), // Set as current time since we don't have original\r\n            status: 'failed',\r\n            updatedAt: new Date().toISOString(),\r\n            error: {\r\n              code: errorCode,\r\n              message: errorMessage,\r\n              details: errorDetails\r\n            }\r\n          };\r\n          \r\n          await apiService.updateSessionData(currentProgress.sessionId, failedSessionData);\r\n          console.log(`Updated session ${currentProgress.sessionId} status to failed`);\r\n        }\r\n      } catch (updateError) {\r\n        console.error('Failed to update session status to failed:', updateError);\r\n      }\r\n\r\n      // Attempt to find and cleanup uploaded file if it exists\r\n      // The file name should follow the pattern we used: `${userMetadata.userId}_${sessionId}_${timestamp}.wav`\r\n      try {\r\n        // Try to extract session ID from error context or generate cleanup pattern\r\n        const currentProgress = processingProgress[fileId];\r\n        if (currentProgress && (currentProgress.stage === 'uploading' || \r\n                              currentProgress.stage === 'submitting' || \r\n                              currentProgress.stage === 'analyzing')) {\r\n          // File was likely uploaded, attempt cleanup with pattern matching\r\n          const fileName = `${userMetadata.userId}_*_*.wav`; // Pattern for potential cleanup\r\n          // Note: In a real implementation, you'd want to track the exact fileName\r\n          // For now, log the cleanup attempt\r\n          console.log(`Attempting cleanup for file pattern: ${fileName}`);\r\n        }\r\n      } catch (cleanupError) {\r\n        console.warn('Error during cleanup attempt:', cleanupError);\r\n      }\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { \r\n          stage: 'error', \r\n          progress: 0, \r\n          message: 'Processing failed',\r\n          error: {\r\n            code: errorCode,\r\n            message: errorMessage,\r\n            details: errorDetails\r\n          }\r\n        }\r\n      }));\r\n      throw err; // Re-throw to be handled by the calling function\r\n    }\r\n  }, [userMetadata.userId, buildMetadata, apiService, uploadToAzureBlob, convertAudioToWav, addToast, safeParseFloat]);\r\n\r\n  const processMultipleFiles = useCallback(async () => {\r\n    setIsProcessing(true);\r\n    setError(null);\r\n    \r\n    // For batch processing modes, validate individual file metadata if needed\r\n    if (processingMode === 'batch-files' || processingMode === 'batch-csv') {\r\n      // Check that all files have userMetadata\r\n      const filesWithoutMetadata = audioFiles.filter(file => !file.userMetadata);\r\n      if (filesWithoutMetadata.length > 0) {\r\n        setError('Some files are missing user metadata');\r\n        addToast('error', 'Validation Error', 'All files must have user metadata in batch mode');\r\n        setIsProcessing(false);\r\n        return;\r\n      }\r\n    } else {\r\n      // Original validation for shared metadata mode\r\n      const validationErrors = validateMetadata();\r\n      if (validationErrors.length > 0) {\r\n        setError(`Validation error: ${validationErrors.join(', ')}`);\r\n        addToast('error', 'Validation Error', validationErrors.join(', '));\r\n        setIsProcessing(false);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Only process files that are in 'ready' state\r\n    const filesToProcess = audioFiles.filter(file => fileStates[file.id] === 'ready');\r\n    \r\n    if (filesToProcess.length === 0) {\r\n      addToast('info', 'No Files Ready', 'No files are ready to process');\r\n      setIsProcessing(false);\r\n      return;\r\n    }\r\n\r\n    const totalFiles = filesToProcess.length;\r\n    let completedFiles = 0;\r\n\r\n    // Initialize batch processing progress\r\n    setBatchProcessingProgress({\r\n      isProcessing: true,\r\n      currentFile: 0,\r\n      totalFiles,\r\n      currentFileName: '',\r\n      message: 'Starting batch file processing...'\r\n    });\r\n\r\n    try {\r\n      for (const audioFile of filesToProcess) {\r\n        completedFiles++;\r\n        const fileName = audioFile.file.name;\r\n        \r\n        // Update progress\r\n        setBatchProcessingProgress(prev => ({\r\n          ...prev,\r\n          currentFile: completedFiles,\r\n          currentFileName: fileName,\r\n          message: `Processing file ${completedFiles} of ${totalFiles}: ${fileName}`\r\n        }));\r\n\r\n        addToast('info', 'Processing File', `Processing ${fileName} (${completedFiles}/${totalFiles})`);\r\n        \r\n        // Set file state to processing\r\n        setFileStates(prev => ({ ...prev, [audioFile.id]: 'processing' }));\r\n        \r\n        try {\r\n          await processSingleFileById(audioFile.id, audioFile);\r\n          setFileStates(prev => ({ ...prev, [audioFile.id]: 'complete' }));\r\n          addToast('success', 'File Complete', `${fileName} processed successfully`);\r\n          \r\n          // Small delay to allow UI updates and make progress visible\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n        } catch (error) {\r\n          // Extract detailed error information\r\n          let errorCode = 'FILE_PROCESSING_ERROR';\r\n          let errorMessage = 'An unexpected error occurred';\r\n          let errorDetails: Record<string, unknown> = {};\r\n\r\n          if (error && typeof error === 'object') {\r\n            if ('code' in error && typeof error.code === 'string') {\r\n              errorCode = error.code;\r\n            }\r\n            if ('message' in error && typeof error.message === 'string') {\r\n              errorMessage = error.message;\r\n            }\r\n            if ('details' in error && typeof error.details === 'object') {\r\n              errorDetails = error.details as Record<string, unknown>;\r\n            }\r\n          } else if (error instanceof Error) {\r\n            errorMessage = error.message;\r\n            errorCode = error.name || 'ERROR';\r\n          }\r\n\r\n          addToast('error', 'File Failed', `Failed to process ${audioFile.file.name}: ${errorMessage}`);\r\n          \r\n          // Set error state for this file with detailed error information\r\n          setFileStates(prev => ({ ...prev, [audioFile.id]: 'error' }));\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [audioFile.id]: { \r\n              stage: 'error', \r\n              progress: 0, \r\n              message: `Failed: ${errorMessage}`,\r\n              error: {\r\n                code: errorCode,\r\n                message: errorMessage,\r\n                details: errorDetails\r\n              }\r\n            }\r\n          }));\r\n        }\r\n      }\r\n      \r\n      addToast('success', 'Batch Complete', `Processed ${completedFiles} file${completedFiles !== 1 ? 's' : ''}`);\r\n      announceToScreenReader(`Batch processing complete. ${completedFiles} files processed.`);\r\n      \r\n      // Update progress with completion message\r\n      setBatchProcessingProgress(prev => ({\r\n        ...prev,\r\n        message: `Successfully processed ${completedFiles} files`\r\n      }));\r\n      \r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';\r\n      setError(errorMessage);\r\n      addToast('error', 'Batch Failed', errorMessage);\r\n      announceToScreenReader(`Error: ${errorMessage}`);\r\n    } finally {\r\n      setIsProcessing(false);\r\n      \r\n      // Reset batch processing progress after a short delay to show completion\r\n      setTimeout(() => {\r\n        setBatchProcessingProgress({\r\n          isProcessing: false,\r\n          currentFile: 0,\r\n          totalFiles: 0,\r\n          currentFileName: '',\r\n          message: ''\r\n        });\r\n      }, 2000);\r\n    }\r\n  }, [audioFiles, fileStates, validateMetadata, addToast, announceToScreenReader, processSingleFileById]);\r\n\r\n  const startSingleFile = useCallback(async (fileId: string) => {\r\n    const audioFile = audioFiles.find(f => f.id === fileId);\r\n    if (!audioFile) return;\r\n\r\n    // Validate metadata\r\n    const validationErrors = validateMetadata();\r\n    if (validationErrors.length > 0) {\r\n      setError(`Validation error: ${validationErrors.join(', ')}`);\r\n      addToast('error', 'Validation Error', validationErrors.join(', '));\r\n      return;\r\n    }\r\n\r\n    setFileStates(prev => ({ ...prev, [fileId]: 'processing' }));\r\n    \r\n    try {\r\n      await processSingleFileById(fileId, audioFile);\r\n      setFileStates(prev => ({ ...prev, [fileId]: 'complete' }));\r\n      addToast('success', 'File Complete', `${audioFile.file.name} processed successfully`);\r\n    } catch (error) {\r\n      console.error(`Error processing ${audioFile.file.name}:`, error);\r\n      const errorMessage = error instanceof Error ? error.message : 'An unexpected error occurred';\r\n      \r\n      addToast('error', 'File Failed', `Failed to process ${audioFile.file.name}: ${errorMessage}`);\r\n      setFileStates(prev => ({ ...prev, [fileId]: 'error' }));\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'error', progress: 0, message: `Failed: ${errorMessage}` }\r\n      }));\r\n    }\r\n  }, [audioFiles, validateMetadata, addToast, processSingleFileById]);\r\n\r\n  const processSingleFile = useCallback(async () => {\r\n    if (!audioFile || !userMetadata.userId.trim()) {\r\n      setError('Please select an audio file. User ID is automatically generated.');\r\n      addToast('error', 'Missing Information', 'Please select an audio file. User ID is automatically generated.');\r\n      return;\r\n    }\r\n\r\n    // Validate metadata\r\n    const validationErrors = validateMetadata();\r\n    if (validationErrors.length > 0) {\r\n      setError(`Validation error: ${validationErrors.join(', ')}`);\r\n      addToast('error', 'Validation Error', validationErrors.join(', '));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setError(null);\r\n      \r\n      // Step 1: Initiate session\r\n      setProgress({ stage: 'initiating', progress: 5, message: 'Initiating session...' });\r\n      announceToScreenReader('Starting analysis process - initiating session');\r\n\r\n      const metadata = buildMetadata();\r\n      const sessionRequest: any = {\r\n        userid: userMetadata.userId.trim(),\r\n        is_initiated: true\r\n      };\r\n\r\n      // Only include metadata if we have any\r\n      if (metadata) {\r\n        sessionRequest.metadata = metadata;\r\n      }\r\n\r\n      const sessionResponse = await apiService.initiateSession(sessionRequest);\r\n\r\n      const sessionData: SessionInfo = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: userMetadata.userId.trim()\r\n      };\r\n\r\n      // Save initial session data to blob storage so it appears in Analysis Sessions UI\r\n      setProgress({ stage: 'initiating', progress: 10, message: 'Saving session data...' });\r\n\r\n      const initialSessionData = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: getAuthenticatedUserId(), // Use authenticated user ID for session filtering/access control\r\n        metadata_user_id: userMetadata.userId.trim(), // Store metadata user ID separately\r\n        ...(metadata && { userMetadata: metadata }), // Only include userMetadata if metadata exists\r\n        audioFileName: audioFile.file.name,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        status: 'initiated'\r\n      };\r\n\r\n      try {\r\n        console.log('Attempting to save session data (single-file):', initialSessionData);\r\n        const saveResult = await apiService.saveSessionData(initialSessionData);\r\n        console.log('Session data saved successfully (single-file):', saveResult);\r\n      } catch (error) {\r\n        console.error('Failed to save session data (single-file):', error);\r\n        console.error('Session data that failed to save:', initialSessionData);\r\n        addToast('warning', 'Session Save Warning', 'Session data could not be saved to storage, but processing will continue.');\r\n        // Continue with the process even if saving fails\r\n        // This is not critical for the main workflow, but user should be informed\r\n      }\r\n\r\n      let audioUrl: string;\r\n      let fileName: string;\r\n\r\n      // Check if this is a pre-filled session with existing audio URL (re-run scenario)\r\n      // Ensure the URL is a valid Azure Storage URL, not a blob URL\r\n      if (audioFile.url && !audioFile.url.startsWith('blob:')) {\r\n        // Skip conversion and upload for re-run - audio is already processed and stored\r\n        setProgress({ stage: 'uploading', progress: 40, message: 'Using existing audio file from previous session...' });\r\n        announceToScreenReader('Session created successfully, reusing previously processed audio file');\r\n        \r\n        audioUrl = audioFile.url;\r\n        fileName = audioFile.file.name;\r\n        \r\n        // Skip to 65% progress since conversion and upload are not needed\r\n        setProgress({ stage: 'submitting', progress: 65, message: 'Submitting for analysis...' });\r\n      } else {\r\n        // Normal flow: convert and upload new audio file\r\n        // This includes the case where audioFile.url is a blob URL (invalid for backend)\r\n        setProgress({ stage: 'converting', progress: 15, message: 'Converting audio to required format...' });\r\n        announceToScreenReader('Session created successfully, now converting audio');\r\n\r\n        // Step 2: Convert audio using FFmpeg\r\n        const convertedBlob = await convertAudioToWav(audioFile.file, (progressPercent: number) => {\r\n          setProgress({\r\n            stage: 'converting',\r\n            progress: 15 + (progressPercent * 0.25), // 15-40% for conversion\r\n            message: `Converting audio... ${Math.round(progressPercent)}%`\r\n          });\r\n        });\r\n\r\n        setProgress({ stage: 'uploading', progress: 40, message: 'Uploading to Azure Blob Storage...' });\r\n        announceToScreenReader('Audio converted successfully, now uploading');\r\n\r\n        // Step 3: Upload to Azure Blob Storage\r\n        fileName = `${userMetadata.userId}_${sessionData.sessionId}_${Date.now()}.wav`;\r\n        audioUrl = await uploadToAzureBlob(convertedBlob, fileName, (progressPercent: number) => {\r\n          setProgress({\r\n            stage: 'uploading',\r\n            progress: 40 + (progressPercent * 0.25), // 40-65% for upload\r\n            message: `Uploading... ${Math.round(progressPercent)}%`\r\n          });\r\n        }, getAuthenticatedUserId()); // Use authenticated user ID for blob storage folder structure\r\n      }\r\n\r\n      setProgress({ stage: 'submitting', progress: 65, message: 'Submitting for analysis...' });\r\n      announceToScreenReader('Upload complete, submitting for behavioral health analysis');\r\n\r\n      // Update session data with audio information\r\n      try {\r\n        const updatedSessionData = {\r\n          ...initialSessionData,\r\n          audioUrl: audioUrl,\r\n          audioFileName: fileName,\r\n          status: 'processing',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n        await apiService.updateSessionData(sessionData.sessionId, updatedSessionData);\r\n      } catch (error) {\r\n        console.warn('Failed to update session data with audio info:', error);\r\n        // Continue with the process even if updating fails\r\n      }\r\n\r\n      // Step 4: Submit prediction with URL to /predictions/submit endpoint\r\n      await apiService.submitPrediction({\r\n        userId: userMetadata.userId.trim(),\r\n        sessionid: sessionData.sessionId,\r\n        audioFileUrl: audioUrl,\r\n        audioFileName: fileName\r\n      });\r\n\r\n      setProgress({ stage: 'analyzing', progress: 70, message: 'Analyzing audio with Kintsugi Health API...' });\r\n      announceToScreenReader('Prediction submitted, analysis in progress');\r\n\r\n      // Step 5: Poll for results\r\n      const poller = new PredictionPoller(sessionData.sessionId);\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        poller.start(\r\n          (result: PredictionResult) => {\r\n            // Update progress during polling\r\n            const progressPercent = result.status === 'processing' ? 80 : \r\n                                  result.status === 'success' ? 95 : 70;\r\n            setProgress({ \r\n              stage: 'analyzing', \r\n              progress: progressPercent, \r\n              message: `Analysis ${result.status}...` \r\n            });\r\n\r\n            // Check for predict_error and show toast\r\n            if (result.predictError) {\r\n              addToast('error', 'Prediction Error', \r\n                `${result.predictError.error}: ${result.predictError.message}`);\r\n            }\r\n          },\r\n          (result: PredictionResult) => {\r\n            // Check for final errors before completing\r\n            if (result.predictError) {\r\n              addToast('error', 'Analysis Failed', \r\n                `The analysis completed with an error: ${result.predictError.error} - ${result.predictError.message}`);\r\n              setProgress({ stage: 'error', progress: 0, message: 'Analysis failed with errors' });\r\n              reject(new Error(`Prediction error: ${result.predictError.error}`));\r\n              return;\r\n            }\r\n\r\n            // Analysis complete successfully\r\n            const analysisResult: AnalysisResult = {\r\n              sessionId: sessionData.sessionId,\r\n              depressionScore: safeParseFloat(result.predictedScoreDepression, 0),\r\n              riskLevel: (() => {\r\n                const score = safeParseFloat(result.predictedScoreDepression, 0);\r\n                return score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low';\r\n              })(),\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n            insights: [\r\n              'Analysis completed using Kintsugi Health API',\r\n              result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n              result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n              'Results should be reviewed by a qualified healthcare professional'\r\n            ].filter(insight => insight.trim() !== ''),\r\n            timestamp: result.updatedAt,\r\n            audioUrl: audioUrl,\r\n            rawApiResponse: result // Store the complete API response\r\n          };\r\n          \r\n          // Update session data with final analysis results (fire-and-forget)\r\n          const finalSessionData = {\r\n            ...initialSessionData,\r\n            audioUrl: audioUrl,\r\n            prediction: result, // Store the complete API response\r\n            analysisResults: {\r\n              depressionScore: safeParseFloat(result.predictedScoreDepression),\r\n              anxietyScore: safeParseFloat(result.predictedScoreAnxiety),\r\n              riskLevel: (() => {\r\n                const score = safeParseFloat(result.predictedScoreDepression, 0);\r\n                return score > 0.7 ? 'high' : score > 0.4 ? 'medium' : 'low';\r\n              })(),\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n              insights: [\r\n                'Analysis completed using Kintsugi Health API',\r\n                result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                'Results should be reviewed by a qualified healthcare professional'\r\n              ].filter(insight => insight.trim() !== ''),\r\n              completedAt: new Date().toISOString()\r\n            },\r\n            status: 'completed',\r\n            completedAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n          };\r\n          \r\n          // Save analysis results to session storage (async, non-blocking)\r\n          apiService.saveSessionData(finalSessionData)\r\n            .then((result) => {\r\n              console.log('Session data saved with analysis results for session:', sessionData.sessionId);\r\n              console.log('Save result:', result);\r\n              addToast('success', 'Session Saved', 'Analysis results have been saved to session storage.');\r\n            })\r\n            .catch((error) => {\r\n              console.error('Failed to save analysis results to session storage:', error);\r\n              console.error('Session data that failed to save:', finalSessionData);\r\n              addToast('warning', 'Save Warning', 'Analysis completed but failed to save to session storage. Results are still available.');\r\n            });\r\n            \r\n          setProgress({ stage: 'complete', progress: 100, message: 'Analysis complete!' });\r\n          setResult(analysisResult);\r\n          addToast('success', 'Analysis Complete', 'Your behavioral health analysis has been completed successfully.');\r\n          announceToScreenReader('Behavioral health analysis completed successfully');\r\n          resolve();\r\n          },\r\n          (error: AppError) => {\r\n            addToast('error', 'Analysis Error', error.message || 'An unexpected error occurred during analysis.');\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n\r\n    } catch (err) {\r\n      console.error('Processing error:', err);\r\n      const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';\r\n      setError(errorMessage);\r\n      setProgress({ stage: 'error', progress: 0, message: 'Processing failed' });\r\n      addToast('error', 'Processing Failed', errorMessage);\r\n      announceToScreenReader(`Error: ${errorMessage}`);\r\n    }\r\n  }, [audioFile, userMetadata.userId, announceToScreenReader, validateMetadata, buildMetadata, safeParseFloat]);\r\n\r\n  const getProgressColor = useCallback((stage: string) => {\r\n    switch (stage) {\r\n      case 'error': return 'processing-progress__fill--error';\r\n      case 'complete': return 'processing-progress__fill--success';\r\n      default: return ''; // Use default blue color from CSS\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6 space-y-8\">\r\n      {/* Header with Dark Mode Toggle and Mode Switcher */}\r\n      <div className=\"text-center\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          {/* Mode Switcher */}\r\n          <div className=\"flex items-center space-x-4\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Processing Mode:</span>\r\n              <div className=\"flex items-center space-x-2\">\r\n                {['single', 'batch-files', 'batch-csv'].map((mode) => (\r\n                  <button\r\n                    key={mode}\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setProcessingMode(mode as ProcessingMode);\r\n                      setStoredProcessingMode(mode); // Save the actual mode string\r\n                      // Clear any existing files when switching modes\r\n                      if (mode === 'single') {\r\n                        setAudioFiles([]);\r\n                        setFileStates({});\r\n                        setProcessingProgress({});\r\n                        setResults({});\r\n                      } else {\r\n                        setAudioFile(null);\r\n                      }\r\n                      // Clear CSV data when not in CSV mode\r\n                      if (mode !== 'batch-csv') {\r\n                        setCsvBatchData(null);\r\n                        setCsvValidationErrors([]);\r\n                      }\r\n                    }}\r\n                    className={`px-3 py-1 text-xs font-medium rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${\r\n                      processingMode === mode\r\n                        ? 'bg-blue-600 text-white hover:bg-blue-700'\r\n                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600'\r\n                    }`}\r\n                  >\r\n                    {mode === 'single' && 'Single File'}\r\n                    {mode === 'batch-files' && 'Batch Files'}\r\n                    {mode === 'batch-csv' && 'CSV Batch'}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Status Badge */}\r\n            <div className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${\r\n              processingMode === 'single'\r\n                ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\r\n                : processingMode === 'batch-files'\r\n                ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' \r\n                : 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\r\n            }`}>\r\n              {processingMode === 'single' ? (\r\n                <>\r\n                  <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm12 2H4v8h12V6z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  Single File Processing\r\n                </>\r\n              ) : processingMode === 'batch-files' ? (\r\n                <>\r\n                  <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  Batch File Processing\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  CSV Batch Processing\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n          Upload & Analyze Audio\r\n        </h1>\r\n        <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\r\n          Upload {processingMode === 'single' ? 'an audio file' : processingMode === 'batch-files' ? 'multiple audio files' : 'audio files via CSV'} for behavioral health analysis using AI-powered speech pattern recognition\r\n        </p>\r\n        \r\n        {/* Mode Description */}\r\n        <div className={`inline-flex items-center px-4 py-2 rounded-lg text-sm ${\r\n          processingMode === 'single'\r\n            ? 'bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300'\r\n            : processingMode === 'batch-files'\r\n            ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300' \r\n            : 'bg-purple-50 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300'\r\n        }`}>\r\n          {processingMode === 'single' ? (\r\n            <>\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Upload and analyze one file at a time with detailed progress tracking\r\n            </>\r\n          ) : processingMode === 'batch-files' ? (\r\n            <>\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path d=\"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z\" />\r\n                <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Process multiple files with individual patient metadata for each file\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Upload CSV file with patient data and blob storage URLs for batch processing\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* User Metadata Form */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          {processingMode === 'batch-files' \r\n            ? 'Patient Information (Optional, Apply to All Files)' \r\n            : processingMode === 'batch-csv'\r\n            ? 'Default Patient Information (Optional, Override with CSV Data)'\r\n            : 'Patient Information (Optional)'\r\n          }\r\n        </h2>\r\n        \r\n        {/* Explanatory text for batch modes */}\r\n        {processingMode === 'batch-files' && (\r\n          <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md\">\r\n            <p className=\"text-sm text-blue-800 dark:text-blue-200\">\r\n              <strong>Note:</strong> Information entered here will be applied to all uploaded files. \r\n              After uploading, you can click \"Edit Info\" on individual files to customize their metadata.\r\n            </p>\r\n          </div>\r\n        )}\r\n        \r\n        {processingMode === 'batch-csv' && (\r\n          <div className=\"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-md\">\r\n            <p className=\"text-sm text-amber-800 dark:text-amber-200\">\r\n              <strong>Note:</strong> This serves as default information. Data from your CSV file will override these values for each row.\r\n            </p>\r\n          </div>\r\n        )}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label htmlFor=\"userId\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              User ID (Auto-generated, editable)\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"userId\"\r\n              value={userMetadata.userId}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, userId: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"Auto-generated user ID\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n              Unique identifier for API calls. Auto-generated but can be customized.\r\n            </p>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"age\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Age\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              id=\"age\"\r\n              value={userMetadata.age}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, age: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('age', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('age', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('age', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.age \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Age in years\"\r\n              min=\"1\"\r\n              max=\"150\"\r\n              aria-describedby={validationErrors.age ? \"age-error\" : undefined}\r\n            />\r\n            {validationErrors.age && (\r\n              <p id=\"age-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.age}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"weight\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Weight\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              id=\"weight\"\r\n              value={userMetadata.weight}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, weight: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('weight', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('weight', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('weight', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.weight \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Weight in lbs\"\r\n              min=\"1\"\r\n              max=\"1000\"\r\n              aria-describedby={validationErrors.weight ? \"weight-error\" : undefined}\r\n            />\r\n            {validationErrors.weight && (\r\n              <p id=\"weight-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.weight}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Gender\r\n            </label>\r\n            <select\r\n              id=\"gender\"\r\n              value={userMetadata.gender}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, gender: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select gender</option>\r\n              <option value=\"female\">Female</option>\r\n              <option value=\"male\">Male</option>\r\n              <option value=\"non-binary\">Non-binary</option>\r\n              <option value=\"other\">Other</option>\r\n              <option value=\"prefer\">Prefer not to specify</option>\r\n              <option value=\"transgender female\">Transgender Female</option>\r\n              <option value=\"transgender male\">Transgender Male</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"race\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Race\r\n            </label>\r\n            <select\r\n              id=\"race\"\r\n              value={userMetadata.race}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, race: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select race</option>\r\n              <option value=\"american indian or alaskan native\">American Indian or Alaskan Native</option>\r\n              <option value=\"asian\">Asian</option>\r\n              <option value=\"black or african-american\">Black or African-American</option>\r\n              <option value=\"native hawaiian or pacific islander\">Native Hawaiian or Pacific Islander</option>\r\n              <option value=\"other\">Other</option>\r\n              <option value=\"prefer not to say\">Prefer not to say</option>\r\n              <option value=\"two or more races\">Two or more races</option>\r\n              <option value=\"white\">White</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"ethnicity\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Ethnicity\r\n            </label>\r\n            <select\r\n              id=\"ethnicity\"\r\n              value={userMetadata.ethnicity}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, ethnicity: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select ethnicity</option>\r\n              <option value=\"Hispanic, Latino, or Spanish Origin\">Hispanic, Latino, or Spanish Origin</option>\r\n              <option value=\"Not Hispanic, Latino, or Spanish Origin\">Not Hispanic, Latino, or Spanish Origin</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"language\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Primary Language\r\n            </label>\r\n            <select\r\n              id=\"language\"\r\n              value={userMetadata.language}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, language: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select language</option>\r\n              <option value=\"true\">English</option>\r\n              <option value=\"false\">Other</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"zipcode\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              ZIP Code\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"zipcode\"\r\n              value={userMetadata.zipcode}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, zipcode: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('zipcode', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('zipcode', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('zipcode', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.zipcode \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Enter ZIP code\"\r\n              pattern=\"[0-9]{5}(-[0-9]{4})?\"\r\n              title=\"Enter a valid ZIP code (e.g., 12345 or 12345-6789)\"\r\n              aria-describedby={validationErrors.zipcode ? \"zipcode-error\" : undefined}\r\n            />\r\n            {validationErrors.zipcode && (\r\n              <p id=\"zipcode-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.zipcode}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"md:col-span-2 lg:col-span-3\">\r\n            <label htmlFor=\"sessionNotes\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Session Notes\r\n            </label>\r\n            <textarea\r\n              id=\"sessionNotes\"\r\n              value={userMetadata.sessionNotes}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, sessionNotes: e.target.value }))}\r\n              onBlur={(e) => handleFieldValidation('sessionNotes', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('sessionNotes', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.sessionNotes \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              rows={3}\r\n              placeholder=\"Additional notes about this session or patient context\"\r\n              aria-describedby={validationErrors.sessionNotes ? \"sessionNotes-error\" : undefined}\r\n            />\r\n            {validationErrors.sessionNotes && (\r\n              <p id=\"sessionNotes-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.sessionNotes}\r\n              </p>\r\n            )}\r\n            <div className=\"mt-1 flex items-center justify-between\">\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {userMetadata.sessionNotes.length}/500 characters\r\n              </p>\r\n              \r\n              {/* Grammar Correction Button - Next to character count */}\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => handleGrammarCorrection()}\r\n                disabled={!userMetadata.sessionNotes.trim() || isCorrectingGrammar}\r\n                className=\"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-blue-700 bg-blue-50 border border-blue-200 hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:text-blue-300 dark:bg-blue-900/20 dark:border-blue-700 dark:hover:bg-blue-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                aria-label=\"Correct grammar and spelling in session notes\"\r\n                title=\"Correct grammar and spelling\"\r\n              >\r\n                {isCorrectingGrammar ? (\r\n                  <Loader2 className=\"w-3.5 h-3.5 mr-1.5 animate-spin\" aria-hidden=\"true\" />\r\n                ) : (\r\n                  <svg \r\n                    className=\"w-3.5 h-3.5 mr-1.5\" \r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                    aria-hidden=\"true\"\r\n                  >\r\n                    <path \r\n                      strokeLinecap=\"round\" \r\n                      strokeLinejoin=\"round\" \r\n                      strokeWidth={2} \r\n                      d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\" \r\n                    />\r\n                  </svg>\r\n                )}\r\n                {isCorrectingGrammar ? 'Correcting...' : 'Correct Grammar'}\r\n              </button>\r\n\r\n              {/* Download CSV Template Button for batch-csv mode */}\r\n              {processingMode === 'batch-csv' && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={downloadCsvTemplate}\r\n                  className=\"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-purple-700 bg-purple-50 border border-purple-200 hover:bg-purple-100 hover:border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1 dark:text-purple-300 dark:bg-purple-900/20 dark:border-purple-700 dark:hover:bg-purple-900/30 transition-colors ml-2\"\r\n                  aria-label=\"Download CSV template file with sample data\"\r\n                  title=\"Download CSV template\"\r\n                >\r\n                  <svg \r\n                    className=\"w-3.5 h-3.5 mr-1.5\" \r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                    aria-hidden=\"true\"\r\n                  >\r\n                    <path \r\n                      strokeLinecap=\"round\" \r\n                      strokeLinejoin=\"round\" \r\n                      strokeWidth={2} \r\n                      d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" \r\n                    />\r\n                  </svg>\r\n                  Download CSV Template\r\n                </button>\r\n              )}\r\n\r\n              {/* Apply to All Files Button for batch-files mode */}\r\n              {processingMode === 'batch-files' && audioFiles.length > 0 && (\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={applyToAllFiles}\r\n                  className=\"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-green-700 bg-green-50 border border-green-200 hover:bg-green-100 hover:border-green-300 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 dark:text-green-300 dark:bg-green-900/20 dark:border-green-700 dark:hover:bg-green-900/30 transition-colors ml-2\"\r\n                  aria-label=\"Apply patient information to all uploaded files\"\r\n                  title=\"Apply to all files\"\r\n                >\r\n                  <svg \r\n                    className=\"w-3.5 h-3.5 mr-1.5\" \r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                    aria-hidden=\"true\"\r\n                  >\r\n                    <path \r\n                      strokeLinecap=\"round\" \r\n                      strokeLinejoin=\"round\" \r\n                      strokeWidth={2} \r\n                      d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" \r\n                    />\r\n                  </svg>\r\n                  Apply to All Files\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* File Upload Area */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          {processingMode === 'batch-csv' ? 'CSV File Upload' : 'Audio File Upload'} \r\n          {processingMode === 'batch-files' && <span className=\"text-sm font-normal text-gray-500 dark:text-gray-400\">(Batch Files Mode)</span>}\r\n        </h2>\r\n\r\n        {/* CSV Upload Section */}\r\n        {processingMode === 'batch-csv' && (\r\n          <div className=\"space-y-4\">\r\n            {!csvBatchData ? (\r\n              <div className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-purple-400 dark:hover:border-purple-500 transition-colors\">\r\n                <Upload className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" aria-hidden=\"true\" />\r\n                <div className=\"mb-4\">\r\n                  <button type=\"button\"\r\n                    onClick={() => {\r\n                      const input = document.createElement('input');\r\n                      input.type = 'file';\r\n                      input.accept = '.csv';\r\n                      input.onchange = (e) => handleCsvFileSelect(e as any);\r\n                      input.click();\r\n                    }}\r\n                    className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 dark:focus:ring-offset-gray-800\"\r\n                  >\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Select CSV File\r\n                  </button>\r\n                  <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                    Upload a CSV file with patient data and file URLs\r\n                  </p>\r\n                </div>\r\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 space-y-2\">\r\n                  <p>Required columns: userId, fileUrl</p>\r\n                  <p>Optional columns: age, gender, race, ethnicity, language, weight, zipcode, sessionNotes, fileName</p>\r\n                  <p>Example: userId,fileUrl,age,gender,zipcode</p>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"border border-green-200 dark:border-green-600 bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\r\n                    <span className=\"font-medium text-green-800 dark:text-green-200\">CSV Loaded Successfully</span>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => {\r\n                      setCsvBatchData(null);\r\n                      setCsvValidationErrors([]);\r\n                    }}\r\n                    className=\"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300\"\r\n                  >\r\n                    <X className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n                <p className=\"text-sm text-green-700 dark:text-green-300 mb-3\">\r\n                  {csvBatchData.rows.length} valid records found in {csvBatchData.fileName}\r\n                </p>\r\n                \r\n                {/* CSV Processing Status Bar */}\r\n                {csvProcessingProgress.isProcessing && (\r\n                  <div className=\"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\r\n                        Processing CSV Files\r\n                      </span>\r\n                      <span className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                        {csvProcessingProgress.currentFile} of {csvProcessingProgress.totalFiles}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2 mb-2\">\r\n                      <div \r\n                        className=\"bg-blue-600 dark:bg-blue-400 h-2 rounded-full transition-all duration-300\"\r\n                        style={{ \r\n                          width: `${csvProcessingProgress.totalFiles > 0 ? (csvProcessingProgress.currentFile / csvProcessingProgress.totalFiles) * 100 : 0}%` \r\n                        }}\r\n                        role=\"progressbar\"\r\n                        aria-valuenow={csvProcessingProgress.currentFile}\r\n                        aria-valuemin={0}\r\n                        aria-valuemax={csvProcessingProgress.totalFiles}\r\n                        aria-label=\"CSV processing progress\"\r\n                      ></div>\r\n                    </div>\r\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                      {csvProcessingProgress.message}\r\n                    </p>\r\n                    {csvProcessingProgress.currentFileName && (\r\n                      <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\r\n                        Current file: {csvProcessingProgress.currentFileName}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n                <button\r\n                  onClick={processCsvBatch}\r\n                  className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800\"\r\n                >\r\n                  Load Audio Files from CSV\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {/* CSV Validation Errors */}\r\n            {csvValidationErrors.length > 0 && (\r\n              <div className=\"border border-red-200 dark:border-red-600 bg-red-50 dark:bg-red-900/20 rounded-lg p-4\">\r\n                <div className=\"flex items-center space-x-2 mb-2\">\r\n                  <AlertCircle className=\"h-5 w-5 text-red-500\" />\r\n                  <span className=\"font-medium text-red-800 dark:text-red-200\">CSV Validation Errors</span>\r\n                </div>\r\n                <ul className=\"text-sm text-red-700 dark:text-red-300 space-y-1\">\r\n                  {csvValidationErrors.map((error, index) => (\r\n                    <li key={index}> {error}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Audio File Upload Section */}\r\n        {processingMode !== 'batch-csv' && (\r\n          <div>\r\n            {(processingMode === 'single' && !audioFile) || (processingMode === 'batch-files' && audioFiles.length === 0) ? (\r\n          <div\r\n            className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors\"\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n          >\r\n            <Upload className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" aria-hidden=\"true\" />\r\n            <div className=\"mb-4\">\r\n              <button type=\"button\"\r\n                onClick={() => fileInputRef.current?.click()}\r\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n              >\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Select Audio File{processingMode !== 'single' ? 's' : ''}\r\n              </button>\r\n              <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                or drag and drop {processingMode !== 'single' ? 'files' : 'file'} here\r\n              </p>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n              Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)\r\n              {processingMode !== 'single' && <br />}\r\n              {processingMode !== 'single' && 'You can select multiple files at once'}\r\n            </p>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              className=\"hidden\"\r\n              accept=\".wav,.mp3,.m4a,.aac,.flac,audio/*\"\r\n              onChange={handleFileSelect}\r\n              multiple={processingMode !== 'single'}\r\n              aria-label={`Select audio file${processingMode !== 'single' ? 's' : ''} for analysis`}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {/* Single File Display */}\r\n            {processingMode === 'single' && audioFile && (\r\n              <div className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <Volume2 className=\"h-5 w-5 text-blue-500\" aria-hidden=\"true\" />\r\n                    <div>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">\r\n                        {audioFile.file.name}\r\n                      </p>\r\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                        {(audioFile.file.size / 1024 / 1024).toFixed(2)} MB\r\n                        {audioFile.duration && `  ${formatTime(audioFile.duration)}`}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <button type=\"button\"\r\n                    onClick={resetState}\r\n                    className=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                    aria-label=\"Remove selected file\"\r\n                  >\r\n                    <X className=\"h-5 w-5\" />\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Audio Player */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <button type=\"button\"\r\n                      onClick={handlePlayPause}\r\n                      className=\"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n                      aria-label={isPlaying ? 'Pause audio' : 'Play audio'}\r\n                    >\r\n                      {isPlaying ? (\r\n                        <Pause className=\"h-5 w-5\" aria-hidden=\"true\" />\r\n                      ) : (\r\n                        <Play className=\"h-5 w-5 ml-0.5\" aria-hidden=\"true\" />\r\n                      )}\r\n                    </button>\r\n                    <div className=\"flex-1\">\r\n                      {audioFile.duration && (\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          {formatTime(currentTime)} / {formatTime(audioFile.duration)}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {audioFile.duration && (\r\n                    <div className=\"audio-progress\">\r\n                      <div\r\n                        className=\"audio-progress__fill progress-animated\"\r\n                        style={{ width: `${(currentTime / audioFile.duration) * 100}%` }}\r\n                        role=\"progressbar\"\r\n                        aria-label=\"Audio playback progress\"\r\n                        aria-valuenow={currentTime}\r\n                        aria-valuemin={0}\r\n                        aria-valuemax={audioFile.duration}\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <audio\r\n                  ref={audioRef}\r\n                  src={audioFile.url}\r\n                  onTimeUpdate={handleTimeUpdate}\r\n                  onEnded={() => setIsPlaying(false)}\r\n                  onPlay={() => setIsPlaying(true)}\r\n                  onPause={() => setIsPlaying(false)}\r\n                  className=\"hidden\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Multi-File Display */}\r\n            {processingMode !== 'single' && audioFiles.length > 0 && (\r\n              <>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\r\n                    Selected Files ({audioFiles.length})\r\n                  </h3>\r\n                  <button type=\"button\"\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                    className=\"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n                  >\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Add More Files\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {audioFiles.map((file) => {\r\n                    const fileState = fileStates[file.id] || 'ready';\r\n                    const progress = processingProgress[file.id];\r\n                    \r\n                    return (\r\n                      <div key={file.id} className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4\">\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\r\n                            <Volume2 className=\"h-4 w-4 text-blue-500 flex-shrink-0\" aria-hidden=\"true\" />\r\n                            <div className=\"min-w-0 flex-1\">\r\n                              <p className=\"font-medium text-gray-900 dark:text-white truncate\">\r\n                                {file.file.name}\r\n                              </p>\r\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                {(file.file.size / 1024 / 1024).toFixed(2)} MB\r\n                                {file.duration && `  ${formatTime(file.duration)}`}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {/* Metadata summary and edit button */}\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            {file.userMetadata?.userId ? (\r\n                              <div className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                                ID: {file.userMetadata.userId.slice(0, 8)}...\r\n                                {file.userMetadata.age && `  Age: ${file.userMetadata.age}`}\r\n                                {file.userMetadata.gender && `  ${file.userMetadata.gender}`}\r\n                              </div>\r\n                            ) : (\r\n                              <div className=\"text-xs text-amber-600 dark:text-amber-400\">\r\n                                No metadata set\r\n                              </div>\r\n                            )}\r\n                            <button\r\n                              onClick={() => openMetadataEditor(file.id, file.userMetadata)}\r\n                              className=\"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n                              aria-label={`Edit metadata for ${file.file.name}`}\r\n                            >\r\n                              <Edit className=\"h-3 w-3 mr-1\" />\r\n                              Edit Info\r\n                            </button>\r\n                          </div>\r\n                          \r\n                          <div className=\"flex items-center space-x-2\">\r\n                            {/* Start button for individual file */}\r\n                            {fileState === 'ready' && (\r\n                              <button type=\"button\"\r\n                                onClick={() => startSingleFile(file.id)}\r\n                                className=\"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800\"\r\n                                aria-label={`Start processing ${file.file.name}`}\r\n                              >\r\n                                <Play className=\"h-3 w-3 mr-1\" />\r\n                                Start\r\n                              </button>\r\n                            )}\r\n                            {fileState === 'processing' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\">\r\n                                Processing...\r\n                              </span>\r\n                            )}\r\n                            {fileState === 'complete' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\r\n                                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                                Complete\r\n                              </span>\r\n                            )}\r\n                            {fileState === 'error' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\r\n                                <X className=\"h-3 w-3 mr-1\" />\r\n                                Error\r\n                              </span>\r\n                            )}\r\n                            <button type=\"button\"\r\n                              onClick={() => removeAudioFile(file.id)}\r\n                              className=\"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400\"\r\n                              aria-label={`Remove ${file.file.name}`}\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/* Processing status for this file */}\r\n                        {progress && (\r\n                          <div className=\"mt-2\">\r\n                            <div className=\"flex items-center justify-between text-xs\">\r\n                              <span className=\"text-gray-600 dark:text-gray-400\">\r\n                                {progress.message}\r\n                              </span>\r\n                              <span className=\"font-medium text-gray-900 dark:text-white\">\r\n                                {Math.round(progress.progress)}%\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"processing-progress mt-1\">\r\n                              <div\r\n                                className={`processing-progress__fill ${getProgressColor(progress.stage)}`}\r\n                                style={{ width: `${progress.progress}%` }}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  className=\"hidden\"\r\n                  accept=\".wav,.mp3,.m4a,.aac,.flac,audio/*\"\r\n                  onChange={handleFileSelect}\r\n                  multiple={processingMode === 'batch-files' || processingMode === 'batch-csv'}\r\n                  aria-label=\"Select additional audio files for analysis\"\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      )}\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\" role=\"alert\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"h-5 w-5 text-red-500 mr-2\" aria-hidden=\"true\" />\r\n            <span className=\"text-red-700 dark:text-red-300\">{error}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Progress Display - Only show in single-file mode */}\r\n      {processingMode === 'single' && progress.stage !== 'idle' && !result && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\r\n            Processing Status\r\n          </h3>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                {progress.message}\r\n              </span>\r\n              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                {Math.round(progress.progress)}%\r\n              </span>\r\n            </div>\r\n            <div className=\"processing-progress\">\r\n              <div\r\n                className={`processing-progress__fill progress-animated ${getProgressColor(progress.stage)}`}\r\n                style={{ width: `${progress.progress}%` }}\r\n                role=\"progressbar\"\r\n                aria-label=\"Processing progress\"\r\n                aria-valuenow={progress.progress}\r\n                aria-valuemin={0}\r\n                aria-valuemax={100}\r\n              />\r\n            </div>\r\n            {progress.stage === 'analyzing' && (\r\n              <div className=\"flex items-center text-sm text-gray-600 dark:text-gray-400\">\r\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" aria-hidden=\"true\" />\r\n                This may take a few minutes...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analysis Results */}\r\n      {result && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <CheckCircle className=\"h-6 w-6 text-green-500 mr-2\" aria-hidden=\"true\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Analysis Results\r\n            </h3>\r\n          </div>\r\n          \r\n          {/* Raw API Response */}\r\n          {result.rawApiResponse && (\r\n            <div className=\"mb-6\">\r\n              <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">API Response Details</h4>\r\n              <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border\">\r\n                <div className=\"space-y-3\">\r\n                  {/* Predicted Scores */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Predicted Scores</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Depression:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.predicted_score_depression || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Anxiety:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.predicted_score_anxiety || 'N/A'}</span>\r\n                      </div>\r\n                      {/* Note: Overall predicted_score is deprecated and no longer displayed */}\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Status:</span>\r\n                        <span className={`font-mono ${result.rawApiResponse.status === 'success' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>\r\n                          {result.rawApiResponse.status || 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Model Information */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Model Information</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Category:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.model_category || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Granularity:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.model_granularity || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Calibrated:</span>\r\n                        <span className={`font-mono ${result.rawApiResponse.is_calibrated ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}`}>\r\n                          {result.rawApiResponse.is_calibrated ? 'Yes' : 'No'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actual Scores (if available) */}\r\n                  {result.rawApiResponse.actual_score && (\r\n                    <div>\r\n                      <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Clinical Assessment Scores</h5>\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                        {result.rawApiResponse.actual_score.depression_binary !== undefined && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Depression Binary:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.actual_score.depression_binary || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.anxiety_binary !== undefined && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Anxiety Binary:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.actual_score.anxiety_binary || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.phq_9 && result.rawApiResponse.actual_score.phq_9.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">PHQ-9:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.phq_9.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.phq_2 && result.rawApiResponse.actual_score.phq_2.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">PHQ-2:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.phq_2.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.gad_7 && result.rawApiResponse.actual_score.gad_7.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">GAD-7:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.gad_7.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Timestamps */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Timeline</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Created:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.rawApiResponse.created_at ? new Date(result.rawApiResponse.created_at).toLocaleString() : 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Updated:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.rawApiResponse.updated_at ? new Date(result.rawApiResponse.updated_at).toLocaleString() : 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Session Information */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Session Information</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Session ID:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.sessionId}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Error Information (if present) */}\r\n                  {result.rawApiResponse.predict_error && (\r\n                    <div className=\"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3\">\r\n                      <h5 className=\"text-sm font-medium text-red-700 dark:text-red-300 mb-1\">Prediction Error</h5>\r\n                      <div className=\"text-sm space-y-1\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-red-600 dark:text-red-400\">Error Type:</span>\r\n                          <span className=\"font-mono text-red-900 dark:text-red-100\">{result.rawApiResponse.predict_error.error}</span>\r\n                        </div>\r\n                        <div className=\"text-red-700 dark:text-red-300\">\r\n                          <span className=\"font-medium\">Message:</span> {result.rawApiResponse.predict_error.message}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Raw JSON Toggle */}\r\n                  <details className=\"mt-4\">\r\n                    <summary className=\"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\">\r\n                      View Raw JSON Response\r\n                    </summary>\r\n                    <div className=\"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto\">\r\n                      <pre className=\"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">\r\n                        {JSON.stringify(result.rawApiResponse, null, 2)}\r\n                      </pre>\r\n                    </div>\r\n                  </details>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {result.insights && result.insights.length > 0 && (\r\n            <div className=\"mt-6\">\r\n              <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">Clinical Insights</h4>\r\n              <ul className=\"space-y-1\">\r\n                {result.insights.map((insight, index) => (\r\n                  <li key={index} className=\"text-gray-600 dark:text-gray-400 text-sm\">\r\n                     {insight}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"mt-6 flex space-x-3\">\r\n            <button type=\"button\"\r\n              onClick={resetState}\r\n              className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n            >\r\n              Analyze Another File\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analyze Button */}\r\n      {(() => {\r\n        const hasFiles = (processingMode !== 'single' && audioFiles.length > 0) || (processingMode === 'single' && audioFile);\r\n        const csvMode = processingMode === 'batch-csv' && csvBatchData && !csvProcessingProgress.isProcessing;\r\n        const shouldShowButton = (hasFiles || csvMode) && \r\n               !result && Object.keys(results).length === 0 && \r\n               progress.stage === 'idle' && !isProcessing;\r\n        \r\n        return shouldShowButton;\r\n      })() && (\r\n        <div className=\"text-center\">\r\n          {processingMode !== 'single' ? (\r\n            // Multi-file mode controls\r\n            <div className=\"space-y-4\">\r\n              {/* Batch Processing Status Bar */}\r\n              {batchProcessingProgress.isProcessing && (\r\n                <div className=\"mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <span className=\"text-sm font-medium text-green-900 dark:text-green-100\">\r\n                      Processing Batch Files\r\n                    </span>\r\n                    <span className=\"text-sm text-green-700 dark:text-green-300\">\r\n                      {batchProcessingProgress.currentFile} of {batchProcessingProgress.totalFiles}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"w-full bg-green-200 dark:bg-green-800 rounded-full h-2 mb-2\">\r\n                    <div \r\n                      className=\"bg-green-600 dark:bg-green-400 h-2 rounded-full transition-all duration-300\"\r\n                      style={{ \r\n                        width: `${batchProcessingProgress.totalFiles > 0 ? (batchProcessingProgress.currentFile / batchProcessingProgress.totalFiles) * 100 : 0}%` \r\n                      }}\r\n                      role=\"progressbar\"\r\n                      aria-valuenow={batchProcessingProgress.currentFile}\r\n                      aria-valuemin={0}\r\n                      aria-valuemax={batchProcessingProgress.totalFiles}\r\n                      aria-label=\"Batch processing progress\"\r\n                    ></div>\r\n                  </div>\r\n                  <p className=\"text-sm text-green-700 dark:text-green-300\">\r\n                    {batchProcessingProgress.message}\r\n                  </p>\r\n                  {batchProcessingProgress.currentFileName && (\r\n                    <p className=\"text-xs text-green-600 dark:text-green-400 mt-1\">\r\n                      Current file: {batchProcessingProgress.currentFileName}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n                <button type=\"button\"\r\n                  onClick={processMultipleFiles}\r\n                  disabled={audioFiles.length === 0 || !userMetadata.userId.trim() || \r\n                           !audioFiles.some(file => fileStates[file.id] === 'ready') ||\r\n                           !!error || Object.values(validationErrors).some(err => err !== undefined)}\r\n                  className=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800\"\r\n                >\r\n                  <Play className=\"h-5 w-5 mr-2\" aria-hidden=\"true\" />\r\n                  Start All Ready Files\r\n                  {audioFiles.filter(file => fileStates[file.id] === 'ready').length > 0 && \r\n                   ` (${audioFiles.filter(file => fileStates[file.id] === 'ready').length})`}\r\n                </button>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                Use individual \"Start\" buttons on each file for selective processing, or \"Start All\" to process all ready files sequentially\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            // Single-file mode controls\r\n            <div>\r\n              <button type=\"button\"\r\n                onClick={processAndAnalyze}\r\n                disabled={!audioFile || !userMetadata.userId.trim() || \r\n                         !!error || Object.values(validationErrors).some(err => err !== undefined)}\r\n                className=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800\"\r\n              >\r\n                <Play className=\"h-5 w-5 mr-2\" aria-hidden=\"true\" />\r\n                Start Analysis\r\n              </button>\r\n              <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\r\n                This will convert, upload, and analyze your audio file\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Multi-File Results */}\r\n      {processingMode !== 'single' && Object.keys(results).length > 0 && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <CheckCircle className=\"h-6 w-6 text-green-500 mr-2\" aria-hidden=\"true\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Batch Analysis Results ({Object.keys(results).length} files)\r\n            </h3>\r\n          </div>\r\n\r\n          <div className=\"space-y-6\">\r\n            {Object.entries(results).map(([fileId, result]) => {\r\n              const audioFile = audioFiles.find(f => f.id === fileId);\r\n              const progress = processingProgress[fileId];\r\n              \r\n              return (\r\n                <div key={fileId} className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <h4 className=\"font-medium text-gray-900 dark:text-white\">\r\n                      {audioFile?.file.name || `File ${fileId}`}\r\n                    </h4>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      {progress?.stage === 'complete' && (\r\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\r\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                          Complete\r\n                        </span>\r\n                      )}\r\n                      {progress?.stage === 'error' && (\r\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\r\n                          <X className=\"h-3 w-3 mr-1\" />\r\n                          Error\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Error Details Section */}\r\n                  {progress?.stage === 'error' && progress?.error && (\r\n                    <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3\">\r\n                      <div className=\"flex items-start\">\r\n                        <AlertCircle className=\"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" aria-hidden=\"true\" />\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"text-sm font-medium text-red-800 dark:text-red-200 mb-2\">\r\n                            Error Details\r\n                          </h4>\r\n                          <div className=\"space-y-2\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                              <div className=\"flex justify-between\">\r\n                                <span className=\"text-red-600 dark:text-red-400 font-medium\">Error Code:</span>\r\n                                <span className=\"font-mono text-red-900 dark:text-red-100\">{progress.error.code}</span>\r\n                              </div>\r\n                              <div className=\"flex justify-between\">\r\n                                <span className=\"text-red-600 dark:text-red-400 font-medium\">Error Message:</span>\r\n                                <span className=\"font-mono text-red-900 dark:text-red-100 text-right\">{progress.error.message}</span>\r\n                              </div>\r\n                            </div>\r\n                            {progress.error.details && Object.keys(progress.error.details).length > 0 && (\r\n                              <details className=\"mt-3\">\r\n                                <summary className=\"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100\">\r\n                                  View Additional Error Details\r\n                                </summary>\r\n                                <div className=\"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32\">\r\n                                  <pre className=\"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap\">\r\n                                    {JSON.stringify(progress.error.details, null, 2)}\r\n                                  </pre>\r\n                                </div>\r\n                              </details>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* API Response Summary for this file */}\r\n                  {result.rawApiResponse && (\r\n                    <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border\">\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                        {/* Note: Overall predicted_score is deprecated */}\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-600 dark:text-gray-400\">Depression:</span>\r\n                          <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                            {result.rawApiResponse.predicted_score_depression || 'N/A'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-600 dark:text-gray-400\">Anxiety:</span>\r\n                          <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                            {result.rawApiResponse.predicted_score_anxiety || 'N/A'}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* Session Info */}\r\n                      <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Session ID:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">{result.sessionId}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Status:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.status || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Raw JSON Toggle for this file */}\r\n                      <details className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                        <summary className=\"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\">\r\n                          View Raw JSON Response\r\n                        </summary>\r\n                        <div className=\"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64\">\r\n                          <pre className=\"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">\r\n                            {JSON.stringify(result.rawApiResponse, null, 2)}\r\n                          </pre>\r\n                        </div>\r\n                      </details>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Audio Player for this file */}\r\n                  {audioFile && (\r\n                    <div className=\"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <button type=\"button\"\r\n                          onClick={() => {\r\n                            const audio = document.getElementById(`audio-${fileId}`) as HTMLAudioElement;\r\n                            if (audio.paused) {\r\n                              // Pause all other audio elements first\r\n                              document.querySelectorAll('audio').forEach(a => a.pause());\r\n                              setPlayingFileId(fileId);\r\n                              audio.play();\r\n                            } else {\r\n                              audio.pause();\r\n                              setPlayingFileId(null);\r\n                            }\r\n                          }}\r\n                          className=\"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900\"\r\n                          aria-label={playingFileId === fileId ? 'Pause audio' : 'Play audio'}\r\n                        >\r\n                          {playingFileId === fileId ? (\r\n                            <Pause className=\"h-4 w-4\" />\r\n                          ) : (\r\n                            <Play className=\"h-4 w-4\" />\r\n                          )}\r\n                        </button>\r\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                          {audioFile.file.name}  {audioFile.duration ? `${Math.round(audioFile.duration)}s` : 'Duration unknown'}\r\n                        </span>\r\n                      </div>\r\n                      <audio\r\n                        id={`audio-${fileId}`}\r\n                        src={audioFile.url}\r\n                        onEnded={() => setPlayingFileId(null)}\r\n                        className=\"hidden\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toast Notifications */}\r\n      {toasts.length > 0 && (\r\n        <div className=\"fixed top-4 right-4 z-50 space-y-2\">\r\n          {toasts.map((toast) => (\r\n            <div\r\n              key={toast.id}\r\n              className={`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${\r\n                toast.type === 'error' ? 'border-red-500' :\r\n                toast.type === 'warning' ? 'border-yellow-500' :\r\n                toast.type === 'success' ? 'border-green-500' : 'border-blue-500'\r\n              }`}\r\n              role=\"alert\"\r\n            >\r\n              <div className=\"flex items-start\">\r\n                <div className=\"flex-shrink-0\">\r\n                  {toast.type === 'error' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-red-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'warning' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-yellow-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'success' && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'info' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-blue-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                </div>\r\n                <div className=\"ml-3 flex-1\">\r\n                  <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {toast.title}\r\n                  </p>\r\n                  <p className=\"mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                    {toast.message}\r\n                  </p>\r\n                </div>\r\n                <div className=\"ml-4 flex-shrink-0\">\r\n                  <button type=\"button\"\r\n                    onClick={() => removeToast(toast.id)}\r\n                    className=\"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    aria-label=\"Close notification\"\r\n                  >\r\n                    <X className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Metadata Editing Modal */}\r\n      {editingFileMetadata && (\r\n        <div className=\"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-600\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\r\n                  Edit Patient Metadata\r\n                </h3>\r\n                <button\r\n                  onClick={cancelMetadataEdit}\r\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                  aria-label=\"Close metadata editor\"\r\n                >\r\n                  <X className=\"h-5 w-5\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"px-6 py-4 space-y-4\">\r\n              <div>\r\n                <label htmlFor=\"temp-userId\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  User ID\r\n                </label>\r\n                <input\r\n                  id=\"temp-userId\"\r\n                  type=\"text\"\r\n                  value={tempMetadata.userId}\r\n                  onChange={(e) => setTempMetadata(prev => ({ ...prev, userId: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n                  placeholder=\"Enter user ID\"\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-age\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Age\r\n                </label>\r\n                <input\r\n                  id=\"temp-age\"\r\n                  type=\"number\"\r\n                  value={tempMetadata.age}\r\n                  onChange={(e) => {\r\n                    setTempMetadata(prev => ({ ...prev, age: e.target.value }));\r\n                    handleTempFieldValidation('age', e.target.value);\r\n                  }}\r\n                  className={`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                    tempValidationErrors.age \r\n                      ? 'border-red-500 dark:border-red-400' \r\n                      : 'border-gray-300 dark:border-gray-600'\r\n                  }`}\r\n                  placeholder=\"Enter age\"\r\n                  min=\"18\"\r\n                  max=\"130\"\r\n                />\r\n                {tempValidationErrors.age && (\r\n                  <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                    {tempValidationErrors.age}\r\n                  </p>\r\n                )}\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-gender\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Gender\r\n                </label>\r\n                <select\r\n                  id=\"temp-gender\"\r\n                  value={tempMetadata.gender}\r\n                  onChange={(e) => setTempMetadata(prev => ({ ...prev, gender: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Select gender</option>\r\n                  <option value=\"female\">Female</option>\r\n                  <option value=\"male\">Male</option>\r\n                  <option value=\"non-binary\">Non-binary</option>\r\n                  <option value=\"other\">Other</option>\r\n                  <option value=\"prefer\">Prefer not to specify</option>\r\n                  <option value=\"transgender female\">Transgender Female</option>\r\n                  <option value=\"transgender male\">Transgender Male</option>\r\n                </select>\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-race\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Race\r\n                </label>\r\n                <select\r\n                  id=\"temp-race\"\r\n                  value={tempMetadata.race}\r\n                  onChange={(e) => setTempMetadata(prev => ({ ...prev, race: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Select race</option>\r\n                  <option value=\"american indian or alaskan native\">American Indian or Alaskan Native</option>\r\n                  <option value=\"asian\">Asian</option>\r\n                  <option value=\"black or african-american\">Black or African-American</option>\r\n                  <option value=\"native hawaiian or pacific islander\">Native Hawaiian or Pacific Islander</option>\r\n                  <option value=\"other\">Other</option>\r\n                  <option value=\"prefer not to say\">Prefer not to say</option>\r\n                  <option value=\"two or more races\">Two or more races</option>\r\n                  <option value=\"white\">White</option>\r\n                </select>\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-ethnicity\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Ethnicity\r\n                </label>\r\n                <select\r\n                  id=\"temp-ethnicity\"\r\n                  value={tempMetadata.ethnicity}\r\n                  onChange={(e) => setTempMetadata(prev => ({ ...prev, ethnicity: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Select ethnicity</option>\r\n                  <option value=\"Hispanic, Latino, or Spanish Origin\">Hispanic, Latino, or Spanish Origin</option>\r\n                  <option value=\"Not Hispanic, Latino, or Spanish Origin\">Not Hispanic, Latino, or Spanish Origin</option>\r\n                </select>\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-language\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Primary Language\r\n                </label>\r\n                <select\r\n                  id=\"temp-language\"\r\n                  value={tempMetadata.language}\r\n                  onChange={(e) => setTempMetadata(prev => ({ ...prev, language: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Select language</option>\r\n                  <option value=\"true\">English</option>\r\n                  <option value=\"false\">Other</option>\r\n                </select>\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-weight\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Weight (lbs)\r\n                </label>\r\n                <input\r\n                  id=\"temp-weight\"\r\n                  type=\"number\"\r\n                  value={tempMetadata.weight}\r\n                  onChange={(e) => {\r\n                    setTempMetadata(prev => ({ ...prev, weight: e.target.value }));\r\n                    handleTempFieldValidation('weight', e.target.value);\r\n                  }}\r\n                  className={`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                    tempValidationErrors.weight \r\n                      ? 'border-red-500 dark:border-red-400' \r\n                      : 'border-gray-300 dark:border-gray-600'\r\n                  }`}\r\n                  placeholder=\"Weight in pounds\"\r\n                  min=\"10\"\r\n                  max=\"1000\"\r\n                />\r\n                {tempValidationErrors.weight && (\r\n                  <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                    {tempValidationErrors.weight}\r\n                  </p>\r\n                )}\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-zipcode\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  ZIP Code\r\n                </label>\r\n                <input\r\n                  id=\"temp-zipcode\"\r\n                  type=\"text\"\r\n                  value={tempMetadata.zipcode}\r\n                  onChange={(e) => {\r\n                    setTempMetadata(prev => ({ ...prev, zipcode: e.target.value }));\r\n                    handleTempFieldValidation('zipcode', e.target.value);\r\n                  }}\r\n                  className={`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                    tempValidationErrors.zipcode \r\n                      ? 'border-red-500 dark:border-red-400' \r\n                      : 'border-gray-300 dark:border-gray-600'\r\n                  }`}\r\n                  placeholder=\"ZIP code\"\r\n                  maxLength={10}\r\n                />\r\n                {tempValidationErrors.zipcode && (\r\n                  <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                    {tempValidationErrors.zipcode}\r\n                  </p>\r\n                )}\r\n              </div>\r\n              \r\n              <div>\r\n                <label htmlFor=\"temp-sessionNotes\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Session Notes\r\n                </label>\r\n                <textarea\r\n                  id=\"temp-sessionNotes\"\r\n                  value={tempMetadata.sessionNotes}\r\n                  onChange={(e) => {\r\n                    setTempMetadata(prev => ({ ...prev, sessionNotes: e.target.value }));\r\n                    handleTempFieldValidation('sessionNotes', e.target.value);\r\n                  }}\r\n                  className={`w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                    tempValidationErrors.sessionNotes \r\n                      ? 'border-red-500 dark:border-red-400' \r\n                      : 'border-gray-300 dark:border-gray-600'\r\n                  }`}\r\n                  placeholder=\"Session notes or comments\"\r\n                  rows={3}\r\n                  maxLength={500}\r\n                />\r\n                {tempValidationErrors.sessionNotes && (\r\n                  <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                    {tempValidationErrors.sessionNotes}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"px-6 py-4 border-t border-gray-200 dark:border-gray-600 flex justify-end space-x-3\">\r\n              <button\r\n                onClick={cancelMetadataEdit}\r\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={saveMetadataChanges}\r\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              >\r\n                Save Changes\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UploadAnalyze;\r\n","import React, { useState, useCallback, useMemo, useEffect } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { Search, Filter, ChevronDown, ChevronUp, Eye, Download, Trash2, RefreshCw, AlertCircle, CheckCircle, Clock, XCircle } from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { apiService } from '../services/api';\r\nimport { getUserId, formatRelativeTime, formatDateTime } from '../utils';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Session interface for UI with additional computed fields\r\ninterface SessionWithUI extends SessionData {\r\n  fileName?: string;\r\n  fileSize?: number;\r\n  uploadedAt: string;\r\n  riskLevel?: string;\r\n  depressionScore?: string;\r\n  anxietyScore?: string;\r\n}\r\n\r\n// Filter and sort types\r\ninterface SessionFilters {\r\n  search: string;\r\n  status: string | 'all';\r\n  dateRange: 'all' | 'today' | 'week' | 'month' | 'year';\r\n  sortBy: 'date' | 'status' | 'depressionScore' | 'anxietyScore';\r\n  sortOrder: 'asc' | 'desc';\r\n}\r\n\r\n// Status color mapping for accessibility\r\nconst statusConfig = {\r\n  queued: { color: 'yellow', icon: Clock, label: 'Queued' },\r\n  running: { color: 'blue', icon: RefreshCw, label: 'Processing' },\r\n  processing: { color: 'blue', icon: RefreshCw, label: 'Processing' },\r\n  succeeded: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  success: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  completed: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  failed: { color: 'red', icon: XCircle, label: 'Failed' },\r\n  error: { color: 'red', icon: XCircle, label: 'Error' },\r\n} as const;\r\n\r\n// Utility function to format score categories\r\nconst formatScoreCategory = (category?: string): string => {\r\n  if (!category) return '';\r\n  return category\r\n    .replace(/_/g, ' ')\r\n    .replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n};\r\n\r\n// Utility function to get severity level for sorting\r\nconst getSeverityLevel = (category?: string): number => {\r\n  if (!category) return 0;\r\n  switch (category.toLowerCase()) {\r\n    // Depression categories: no_to_mild, mild_to_moderate, moderate_to_severe\r\n    case 'no_to_mild':\r\n      return 1;\r\n    case 'mild_to_moderate':\r\n      return 2;\r\n    case 'moderate_to_severe':\r\n      return 3;\r\n    // Anxiety categories: no_or_minimal, moderate, moderately_severe, severe\r\n    case 'no_or_minimal':\r\n      return 1;\r\n    case 'moderate':\r\n      return 2;\r\n    case 'moderately_severe':\r\n      return 3;\r\n    case 'severe':\r\n      return 4;\r\n    default:\r\n      return 0;\r\n  }\r\n};\r\n\r\nconst Sessions: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [sessions, setSessions] = useState<SessionWithUI[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [selectedSessions, setSelectedSessions] = useState<Set<string>>(new Set());\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [filters, setFilters] = useState<SessionFilters>({\r\n    search: '',\r\n    status: 'all',\r\n    dateRange: 'all',\r\n    sortBy: 'date',\r\n    sortOrder: 'desc',\r\n  });\r\n\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  // Load sessions from API\r\n  const loadSessions = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const userId = getAuthenticatedUserId(); // Use authenticated user ID to match blob storage folder structure\r\n      const response = await apiService.getUserSessions(userId);\r\n      \r\n      // Transform session data to include computed UI fields\r\n      const transformedSessions: SessionWithUI[] = response.sessions.map(session => {\r\n        // Handle both camelCase and snake_case property names from API\r\n        const prediction = session.prediction as any;\r\n        const analysisResults = session.analysisResults;\r\n        \r\n        return {\r\n          ...session,\r\n          uploadedAt: session.createdAt,\r\n          fileName: session.audioFileName || `Audio_${session.sessionId.slice(-8)}.wav`,\r\n          fileSize: Math.floor(Math.random() * 5000000) + 1000000, // Mock file size for now\r\n          riskLevel: analysisResults?.riskLevel || 'unknown',\r\n          // Prioritize analysisResults, then fall back to prediction data\r\n          depressionScore: analysisResults?.depressionScore?.toString() ||\r\n                          prediction?.predicted_score_depression || \r\n                          prediction?.predictedScoreDepression ||\r\n                          undefined,\r\n          anxietyScore: analysisResults?.anxietyScore?.toString() ||\r\n                       prediction?.predicted_score_anxiety || \r\n                       prediction?.predictedScoreAnxiety ||\r\n                       undefined,\r\n        };\r\n      });\r\n\r\n      setSessions(transformedSessions);\r\n      announceToScreenReader(`${transformedSessions.length} sessions loaded successfully`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading sessions: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Load sessions on component mount\r\n  useEffect(() => {\r\n    loadSessions();\r\n  }, [loadSessions]);\r\n\r\n  // Filter and sort sessions\r\n  const filteredAndSortedSessions = useMemo(() => {\r\n    let filtered = sessions;\r\n\r\n    // Search filter\r\n    if (filters.search) {\r\n      const searchLower = filters.search.toLowerCase();\r\n      filtered = filtered.filter(session => \r\n        session.sessionId.toLowerCase().includes(searchLower) ||\r\n        session.fileName?.toLowerCase().includes(searchLower) ||\r\n        statusConfig[session.status as keyof typeof statusConfig]?.label.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    // Status filter\r\n    if (filters.status !== 'all') {\r\n      filtered = filtered.filter(session => session.status === filters.status);\r\n    }\r\n\r\n    // Date range filter\r\n    if (filters.dateRange !== 'all') {\r\n      const now = new Date();\r\n      const startDate = new Date();\r\n      \r\n      switch (filters.dateRange) {\r\n        case 'today':\r\n          startDate.setHours(0, 0, 0, 0);\r\n          break;\r\n        case 'week':\r\n          startDate.setDate(now.getDate() - 7);\r\n          break;\r\n        case 'month':\r\n          startDate.setMonth(now.getMonth() - 1);\r\n          break;\r\n        case 'year':\r\n          startDate.setFullYear(now.getFullYear() - 1);\r\n          break;\r\n      }\r\n      \r\n      filtered = filtered.filter(session => \r\n        new Date(session.uploadedAt) >= startDate\r\n      );\r\n    }\r\n\r\n    // Sort\r\n    filtered.sort((a, b) => {\r\n      let comparison = 0;\r\n      \r\n      switch (filters.sortBy) {\r\n        case 'date':\r\n          comparison = new Date(a.uploadedAt).getTime() - new Date(b.uploadedAt).getTime();\r\n          break;\r\n        case 'status':\r\n          comparison = a.status.localeCompare(b.status);\r\n          break;\r\n        case 'depressionScore':\r\n          const depressionA = getSeverityLevel(a.depressionScore);\r\n          const depressionB = getSeverityLevel(b.depressionScore);\r\n          comparison = depressionA - depressionB;\r\n          break;\r\n        case 'anxietyScore':\r\n          const anxietyA = getSeverityLevel(a.anxietyScore);\r\n          const anxietyB = getSeverityLevel(b.anxietyScore);\r\n          comparison = anxietyA - anxietyB;\r\n          break;\r\n      }\r\n      \r\n      return filters.sortOrder === 'desc' ? -comparison : comparison;\r\n    });\r\n\r\n    return filtered;\r\n  }, [sessions, filters]);\r\n\r\n  // Handle filter changes\r\n  const updateFilter = useCallback((key: keyof SessionFilters, value: any) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n    announceToScreenReader(`Filter ${key} changed to ${value}`);\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle session selection\r\n  const toggleSessionSelection = useCallback((sessionId: string) => {\r\n    setSelectedSessions(prev => {\r\n      const newSelection = new Set(prev);\r\n      if (newSelection.has(sessionId)) {\r\n        newSelection.delete(sessionId);\r\n        announceToScreenReader('Session deselected');\r\n      } else {\r\n        newSelection.add(sessionId);\r\n        announceToScreenReader('Session selected');\r\n      }\r\n      return newSelection;\r\n    });\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle select all\r\n  const toggleSelectAll = useCallback(() => {\r\n    const allSelected = selectedSessions.size === filteredAndSortedSessions.length;\r\n    if (allSelected) {\r\n      setSelectedSessions(new Set());\r\n      announceToScreenReader('All sessions deselected');\r\n    } else {\r\n      setSelectedSessions(new Set(filteredAndSortedSessions.map(s => s.sessionId)));\r\n      announceToScreenReader(`All ${filteredAndSortedSessions.length} sessions selected`);\r\n    }\r\n  }, [selectedSessions.size, filteredAndSortedSessions, announceToScreenReader]);\r\n\r\n  // Handle individual session deletion\r\n  const handleDeleteSession = useCallback(async (sessionId: string) => {\r\n    const confirmed = window.confirm('Are you sure you want to delete this session? This action cannot be undone.');\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      await apiService.deleteSessionData(sessionId);\r\n      \r\n      // Remove from local state after successful API call\r\n      setSessions(prev => prev.filter(session => session.sessionId !== sessionId));\r\n      \r\n      // Remove from selection if it was selected\r\n      setSelectedSessions(prev => {\r\n        const newSelection = new Set(prev);\r\n        newSelection.delete(sessionId);\r\n        return newSelection;\r\n      });\r\n      \r\n      announceToScreenReader('Session deleted successfully');\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      announceToScreenReader(`Error deleting session: ${appError.message}`);\r\n      // Optionally show a toast or alert for the error\r\n      alert(`Failed to delete session: ${appError.message}`);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle individual session re-run - navigate to upload page with session data pre-filled\r\n  const handleRerunSession = useCallback(async (sessionId: string) => {\r\n    const confirmed = window.confirm('Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.');\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      // Find the session data to pass to upload page\r\n      const session = sessions.find(s => s.sessionId === sessionId);\r\n      if (!session) {\r\n        announceToScreenReader('Cannot re-run analysis: Session not found');\r\n        alert('Cannot re-run analysis: Session not found');\r\n        return;\r\n      }\r\n\r\n      announceToScreenReader('Redirecting to upload page for re-run...');\r\n      \r\n      // Navigate to upload page with session data\r\n      navigate('/upload', {\r\n        state: {\r\n          originalSessionId: session.sessionId,\r\n          audioFileName: session.audioFileName,\r\n          audioUrl: session.audioUrl,\r\n          userMetadata: session.userMetadata\r\n        }\r\n      });\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      announceToScreenReader(`Error preparing re-run: ${appError.message}`);\r\n      alert(`Failed to prepare re-run: ${appError.message}`);\r\n    }\r\n  }, [announceToScreenReader, sessions, navigate]);\r\n\r\n  // Handle bulk actions\r\n  const handleBulkDelete = useCallback(async () => {\r\n    if (selectedSessions.size === 0) return;\r\n    \r\n    const confirmed = window.confirm(`Are you sure you want to delete ${selectedSessions.size} session(s)? This action cannot be undone.`);\r\n    if (!confirmed) return;\r\n\r\n    const sessionIds = Array.from(selectedSessions);\r\n    let successCount = 0;\r\n    let failedSessions: string[] = [];\r\n\r\n    // Process deletions sequentially to avoid overwhelming the server\r\n    for (const sessionId of sessionIds) {\r\n      try {\r\n        await apiService.deleteSessionData(sessionId);\r\n        successCount++;\r\n      } catch (err) {\r\n        const appError = err as AppError;\r\n        failedSessions.push(sessionId);\r\n        console.error(`Failed to delete session ${sessionId}:`, appError.message);\r\n      }\r\n    }\r\n\r\n    // Remove successfully deleted sessions from local state\r\n    if (successCount > 0) {\r\n      setSessions(prev => prev.filter(session => {\r\n        const wasDeleted = selectedSessions.has(session.sessionId) && !failedSessions.includes(session.sessionId);\r\n        return !wasDeleted;\r\n      }));\r\n    }\r\n\r\n    // Clear selection\r\n    setSelectedSessions(new Set());\r\n\r\n    // Announce results\r\n    if (failedSessions.length === 0) {\r\n      announceToScreenReader(`${successCount} sessions deleted successfully`);\r\n    } else {\r\n      const message = `${successCount} sessions deleted successfully, ${failedSessions.length} failed`;\r\n      announceToScreenReader(message);\r\n      alert(`${message}. Failed sessions: ${failedSessions.join(', ')}`);\r\n    }\r\n  }, [selectedSessions, announceToScreenReader]);\r\n\r\n  // Format file size\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes === 0) return '0 B';\r\n    const k = 1024;\r\n    const sizes = ['B', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n  };\r\n\r\n  // Get status badge component\r\n  const StatusBadge: React.FC<{ status: string }> = ({ status }) => {\r\n    // For any unknown status that contains \"error\" or \"fail\", treat as error\r\n    const normalizedStatus = status.toLowerCase();\r\n    let config = statusConfig[status as keyof typeof statusConfig];\r\n    \r\n    if (!config) {\r\n      if (normalizedStatus.includes('error') || normalizedStatus.includes('fail')) {\r\n        config = statusConfig.error;\r\n      } else {\r\n        // Default to queued for unknown statuses instead of failed\r\n        config = statusConfig.queued;\r\n      }\r\n    }\r\n    \r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <span\r\n        className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n          config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n          config.color === 'blue' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\r\n          config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n          'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n        }`}\r\n        role=\"status\"\r\n        aria-label={`Status: ${config.label}`}\r\n      >\r\n        <Icon className=\"w-3 h-3 mr-1\" aria-hidden=\"true\" />\r\n        {config.label}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading sessions...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Sessions\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <button type=\"button\"\r\n                onClick={loadSessions}\r\n                className=\"mt-4 btn btn--primary\"\r\n                aria-label=\"Retry loading sessions\"\r\n              >\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            Analysis Sessions\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            View and manage your audio analysis sessions\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button type=\"button\"\r\n            onClick={loadSessions}\r\n            disabled={loading}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh sessions list\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <Link\r\n            to=\"/upload\"\r\n            className=\"btn btn--primary\"\r\n            aria-label=\"Start new analysis session\"\r\n          >\r\n            New Analysis\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters and Search */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <div className=\"flex flex-col lg:flex-row lg:items-center gap-4\">\r\n          {/* Search */}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <label htmlFor=\"search-sessions\" className=\"sr-only\">\r\n              Search sessions\r\n            </label>\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" aria-hidden=\"true\" />\r\n              <input\r\n                id=\"search-sessions\"\r\n                type=\"text\"\r\n                placeholder=\"Search by session ID, filename, or status...\"\r\n                value={filters.search}\r\n                onChange={(e) => updateFilter('search', e.target.value)}\r\n                className=\"form__input w-full pl-10 pr-4 py-2\"\r\n                aria-describedby=\"search-help\"\r\n              />\r\n            </div>\r\n            <p id=\"search-help\" className=\"sr-only\">\r\n              Search through your analysis sessions by ID, filename, or status\r\n            </p>\r\n          </div>\r\n\r\n          {/* Filter Toggle */}\r\n          <button type=\"button\"\r\n            onClick={() => setShowFilters(!showFilters)}\r\n            className=\"btn btn--secondary flex items-center\"\r\n            aria-expanded={showFilters}\r\n            aria-controls=\"filter-panel\"\r\n            aria-label={`${showFilters ? 'Hide' : 'Show'} filter options`}\r\n          >\r\n            <Filter className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Filters\r\n            {showFilters ? <ChevronUp className=\"w-4 h-4 ml-2\" aria-hidden=\"true\" /> : <ChevronDown className=\"w-4 h-4 ml-2\" aria-hidden=\"true\" />}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Expanded Filters */}\r\n        {showFilters && (\r\n          <div id=\"filter-panel\" className=\"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            {/* Status Filter */}\r\n            <div>\r\n              <label htmlFor=\"status-filter\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Status\r\n              </label>\r\n              <select\r\n                id=\"status-filter\"\r\n                value={filters.status}\r\n                onChange={(e) => updateFilter('status', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Statuses</option>\r\n                <option value=\"queued\">Queued</option>\r\n                <option value=\"processing\">Processing</option>\r\n                <option value=\"running\">Running</option>\r\n                <option value=\"succeeded\">Completed</option>\r\n                <option value=\"success\">Success</option>\r\n                <option value=\"completed\">Completed</option>\r\n                <option value=\"failed\">Failed</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Date Range Filter */}\r\n            <div>\r\n              <label htmlFor=\"date-filter\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Date Range\r\n              </label>\r\n              <select\r\n                id=\"date-filter\"\r\n                value={filters.dateRange}\r\n                onChange={(e) => updateFilter('dateRange', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Time</option>\r\n                <option value=\"today\">Today</option>\r\n                <option value=\"week\">Past Week</option>\r\n                <option value=\"month\">Past Month</option>\r\n                <option value=\"year\">Past Year</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Sort By */}\r\n            <div>\r\n              <label htmlFor=\"sort-by\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Sort By\r\n              </label>\r\n              <select\r\n                id=\"sort-by\"\r\n                value={filters.sortBy}\r\n                onChange={(e) => updateFilter('sortBy', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"date\">Date</option>\r\n                <option value=\"status\">Status</option>\r\n                <option value=\"depressionScore\">Depression Score</option>\r\n                <option value=\"anxietyScore\">Anxiety Score</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Sort Order */}\r\n            <div>\r\n              <label htmlFor=\"sort-order\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Sort Order\r\n              </label>\r\n              <select\r\n                id=\"sort-order\"\r\n                value={filters.sortOrder}\r\n                onChange={(e) => updateFilter('sortOrder', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"desc\">Newest First</option>\r\n                <option value=\"asc\">Oldest First</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Results Summary and Bulk Actions */}\r\n      {filteredAndSortedSessions.length > 0 && (\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n              {filteredAndSortedSessions.length} of {sessions.length} sessions\r\n              {selectedSessions.size > 0 && `  ${selectedSessions.size} selected`}\r\n            </p>\r\n          </div>\r\n          \r\n          {selectedSessions.size > 0 && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <button type=\"button\"\r\n                onClick={handleBulkDelete}\r\n                className=\"btn btn--danger\"\r\n                aria-label={`Delete ${selectedSessions.size} selected sessions`}\r\n              >\r\n                <Trash2 className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n                Delete Selected\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Sessions Table */}\r\n      {filteredAndSortedSessions.length > 0 ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          {/* Desktop Table */}\r\n          <div className=\"hidden md:block overflow-x-auto\">\r\n            <table className=\"w-full\" role=\"table\" aria-label=\"Analysis sessions\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-700\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedSessions.size === filteredAndSortedSessions.length}\r\n                      onChange={toggleSelectAll}\r\n                      className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                      aria-label=\"Select all sessions\"\r\n                    />\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Session\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Status\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Depression Score\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Anxiety Score\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Actions\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200 dark:divide-gray-600\">\r\n                {filteredAndSortedSessions.map((session) => (\r\n                  <tr\r\n                    key={session.sessionId}\r\n                    className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\"\r\n                  >\r\n                    <td className=\"px-6 py-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedSessions.has(session.sessionId)}\r\n                        onChange={() => toggleSessionSelection(session.sessionId)}\r\n                        className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                        aria-label={`Select session ${session.sessionId}`}\r\n                      />\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div>\r\n                        <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {session.fileName}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          ID: {session.sessionId.slice(-12)}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                          {formatFileSize(session.fileSize || 0)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <StatusBadge status={session.status} />\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm\">\r\n                        {session.depressionScore ? (\r\n                          <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                            {formatScoreCategory(session.depressionScore)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400 dark:text-gray-500\"></span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm\">\r\n                        {session.anxietyScore ? (\r\n                          <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                            {formatScoreCategory(session.anxietyScore)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400 dark:text-gray-500\"></span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                        {formatRelativeTime(session.uploadedAt)}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        {formatDateTime(session.uploadedAt)}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 text-right\">\r\n                      <div className=\"flex items-center justify-end gap-2\">\r\n                        <Link\r\n                          to={`/sessions/${session.sessionId}`}\r\n                          className=\"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300\"\r\n                          aria-label={`View details for session ${session.sessionId}`}\r\n                        >\r\n                          <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </Link>\r\n                        {session.status === 'succeeded' && (\r\n                          <button type=\"button\"\r\n                            className=\"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300\"\r\n                            aria-label={`Download results for session ${session.sessionId}`}\r\n                          >\r\n                            <Download className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                          </button>\r\n                        )}\r\n                        <button type=\"button\"\r\n                          onClick={() => handleRerunSession(session.sessionId)}\r\n                          className=\"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300\"\r\n                          aria-label={`Re-run analysis for session ${session.sessionId}`}\r\n                        >\r\n                          <RefreshCw className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </button>\r\n                        <button type=\"button\"\r\n                          onClick={() => handleDeleteSession(session.sessionId)}\r\n                          className=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300\"\r\n                          aria-label={`Delete session ${session.sessionId}`}\r\n                        >\r\n                          <Trash2 className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          {/* Mobile Cards */}\r\n          <div className=\"md:hidden space-y-4 p-4\">\r\n            {filteredAndSortedSessions.map((session) => (\r\n              <div\r\n                key={session.sessionId}\r\n                className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-start space-x-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedSessions.has(session.sessionId)}\r\n                      onChange={() => toggleSessionSelection(session.sessionId)}\r\n                      className=\"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                      aria-label={`Select session ${session.sessionId}`}\r\n                    />\r\n                    <div>\r\n                      <h3 className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                        {session.fileName}\r\n                      </h3>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        ID: {session.sessionId.slice(-12)}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <StatusBadge status={session.status} />\r\n                </div>\r\n\r\n                {(session.depressionScore || session.anxietyScore) && (\r\n                  <div className=\"text-sm\">\r\n                    {session.depressionScore && (\r\n                      <div>Depression: {formatScoreCategory(session.depressionScore)}</div>\r\n                    )}\r\n                    {session.anxietyScore && (\r\n                      <div>Anxiety: {formatScoreCategory(session.anxietyScore)}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400\">\r\n                  <span>{formatRelativeTime(session.uploadedAt)}</span>\r\n                  <span>{formatFileSize(session.fileSize || 0)}</span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600\">\r\n                  <Link\r\n                    to={`/sessions/${session.sessionId}`}\r\n                    className=\"btn btn--secondary text-xs\"\r\n                    aria-label={`View details for session ${session.sessionId}`}\r\n                  >\r\n                    <Eye className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    View\r\n                  </Link>\r\n                  {session.status === 'succeeded' && (\r\n                    <button type=\"button\"\r\n                      className=\"btn btn--secondary text-xs\"\r\n                      aria-label={`Download results for session ${session.sessionId}`}\r\n                    >\r\n                      <Download className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                      Download\r\n                    </button>\r\n                  )}\r\n                  <button type=\"button\"\r\n                    onClick={() => handleRerunSession(session.sessionId)}\r\n                    className=\"btn btn--secondary text-xs\"\r\n                    aria-label={`Re-run analysis for session ${session.sessionId}`}\r\n                  >\r\n                    <RefreshCw className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    Re-run\r\n                  </button>\r\n                  <button type=\"button\"\r\n                    onClick={() => handleDeleteSession(session.sessionId)}\r\n                    className=\"btn btn--danger text-xs\"\r\n                    aria-label={`Delete session ${session.sessionId}`}\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n          <AlertCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No sessions found\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            {sessions.length === 0 \r\n              ? \"You haven't created any analysis sessions yet.\"\r\n              : \"No sessions match your current filters.\"\r\n            }\r\n          </p>\r\n          {sessions.length === 0 ? (\r\n            <Link to=\"/upload\" className=\"btn btn--primary\">\r\n              Start Your First Analysis\r\n            </Link>\r\n          ) : (\r\n            <button type=\"button\"\r\n              onClick={() => setFilters({\r\n                search: '',\r\n                status: 'all',\r\n                dateRange: 'all',\r\n                sortBy: 'date',\r\n                sortOrder: 'desc',\r\n              })}\r\n              className=\"btn btn--secondary\"\r\n            >\r\n              Clear Filters\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Sessions;\r\n","import React, { useState, useCallback } from 'react';\r\nimport { \r\n  Brain, \r\n  AlertTriangle, \r\n  CheckCircle, \r\n  RefreshCw, \r\n  Clock, \r\n  TrendingUp,\r\n  Lightbulb,\r\n  ShieldAlert,\r\n  FileText,\r\n  Target,\r\n  Calendar\r\n} from 'lucide-react';\r\nimport { apiService } from '../services/api';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { formatDateTime } from '../utils';\r\nimport type { RiskAssessment, AppError } from '../types';\r\n\r\ninterface RiskAssessmentProps {\r\n  sessionId: string;\r\n  existingAssessment?: RiskAssessment | null;\r\n  onAssessmentUpdated?: (assessment: RiskAssessment) => void;\r\n}\r\n\r\n// Risk level configuration\r\nconst riskLevelConfig = {\r\n  low: { \r\n    color: 'green', \r\n    label: 'Low Risk',\r\n    icon: CheckCircle,\r\n    description: 'Low likelihood of immediate concerns'\r\n  },\r\n  moderate: { \r\n    color: 'yellow', \r\n    label: 'Moderate Risk',\r\n    icon: AlertTriangle,\r\n    description: 'Some concerns that warrant attention'\r\n  },\r\n  high: { \r\n    color: 'red', \r\n    label: 'High Risk',\r\n    icon: ShieldAlert,\r\n    description: 'Significant concerns requiring immediate attention'\r\n  },\r\n  critical: { \r\n    color: 'red', \r\n    label: 'Critical Risk',\r\n    icon: ShieldAlert,\r\n    description: 'Urgent intervention required'\r\n  },\r\n} as const;\r\n\r\nconst RiskAssessmentComponent: React.FC<RiskAssessmentProps> = ({\r\n  sessionId,\r\n  existingAssessment,\r\n  onAssessmentUpdated\r\n}) => {\r\n  const { announceToScreenReader } = useAccessibility();\r\n  const [assessment, setAssessment] = useState<RiskAssessment | null>(existingAssessment || null);\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n\r\n  // Generate new risk assessment\r\n  const generateAssessment = useCallback(async () => {\r\n    try {\r\n      setIsGenerating(true);\r\n      setError(null);\r\n      announceToScreenReader('Generating AI risk assessment...');\r\n\r\n      const response = await apiService.generateRiskAssessment(sessionId);\r\n      \r\n      if (response.success && response.riskAssessment) {\r\n        setAssessment(response.riskAssessment);\r\n        onAssessmentUpdated?.(response.riskAssessment);\r\n        announceToScreenReader('Risk assessment generated successfully');\r\n      } else {\r\n        throw new Error(response.message || 'Failed to generate risk assessment');\r\n      }\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error generating assessment: ${appError.message}`);\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  }, [sessionId, onAssessmentUpdated, announceToScreenReader]);\r\n\r\n  // Load existing assessment\r\n  const loadAssessment = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      const response = await apiService.getRiskAssessment(sessionId);\r\n      \r\n      if (response.success && response.riskAssessment) {\r\n        setAssessment(response.riskAssessment);\r\n        onAssessmentUpdated?.(response.riskAssessment);\r\n      }\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [sessionId, onAssessmentUpdated]);\r\n\r\n  // Risk level badge component\r\n  const RiskLevelBadge: React.FC<{ riskLevel: string; riskScore?: number }> = ({ riskLevel, riskScore }) => {\r\n    const config = riskLevelConfig[riskLevel.toLowerCase() as keyof typeof riskLevelConfig];\r\n    if (!config) return null;\r\n\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <span\r\n          className={`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${\r\n            config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n            config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n            'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n          }`}\r\n          role=\"status\"\r\n          aria-label={`Risk level: ${config.label}`}\r\n        >\r\n          <Icon className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n          {config.label}\r\n          {riskScore && (\r\n            <span className=\"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold\">\r\n              {riskScore}/10\r\n            </span>\r\n          )}\r\n        </span>\r\n        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          {config.description}\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // If no assessment exists and not generating, show generate button\r\n  if (!assessment && !isGenerating && !isLoading) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"text-center py-8\">\r\n          <Brain className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No Risk Assessment Available\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            Generate an AI-powered risk assessment based on session data and clinical insights.\r\n          </p>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <button type=\"button\"\r\n              onClick={generateAssessment}\r\n              className=\"btn btn--primary\"\r\n              aria-label=\"Generate AI risk assessment\"\r\n            >\r\n              <Brain className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n              Generate AI Risk Assessment\r\n            </button>\r\n            \r\n            <button type=\"button\"\r\n              onClick={loadAssessment}\r\n              className=\"btn btn--secondary\"\r\n              aria-label=\"Check for existing assessment\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n              Check for Existing Assessment\r\n            </button>\r\n          </div>\r\n          \r\n          {error && (\r\n            <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n              <p className=\"text-red-700 dark:text-red-300 text-sm\">\r\n                {error.message}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Loading state\r\n  if (isGenerating || isLoading) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">\r\n            {isGenerating ? 'Generating AI risk assessment...' : 'Loading assessment...'}\r\n          </span>\r\n        </div>\r\n        \r\n        {isGenerating && (\r\n          <div className=\"mt-4 text-center\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              This may take a few moments as AI analyzes the session data...\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Display assessment\r\n  if (!assessment) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"flex items-center space-x-3 mt-4 sm:mt-0\">\r\n          <button type=\"button\"\r\n            onClick={generateAssessment}\r\n            disabled={isGenerating}\r\n            className=\"btn btn--secondary text-xs\"\r\n            aria-label=\"Regenerate risk assessment\"\r\n          >\r\n            <RefreshCw className={`w-3 h-3 mr-1 ${isGenerating ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Regenerate\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-6\">\r\n        {/* Risk Level and Score */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n          <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n            <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\r\n              Overall Risk Level\r\n            </h3>\r\n            <RiskLevelBadge riskLevel={assessment.overallRiskLevel} riskScore={assessment.riskScore} />\r\n          </div>\r\n          \r\n          {assessment.generatedAt && (\r\n            <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n              <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center\">\r\n                <Calendar className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                Generated\r\n              </h3>\r\n              <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                {formatDateTime(assessment.generatedAt)}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Summary */}\r\n        {assessment.summary && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <FileText className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Summary\r\n            </h3>\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n              <p className=\"text-blue-900 dark:text-blue-100 text-sm leading-relaxed\">\r\n                {assessment.summary}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Key Risk Factors */}\r\n        {assessment.keyFactors && assessment.keyFactors.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <AlertTriangle className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Key Risk Factors\r\n            </h3>\r\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.keyFactors.map((factor: string, index: number) => (\r\n                  <li key={index} className=\"text-yellow-900 dark:text-yellow-100 text-sm flex items-start\">\r\n                    <span className=\"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0\" aria-hidden=\"true\"></span>\r\n                    {factor}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Recommendations */}\r\n        {assessment.recommendations && assessment.recommendations.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <Lightbulb className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Recommendations\r\n            </h3>\r\n            <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.recommendations.map((recommendation: string, index: number) => (\r\n                  <li key={index} className=\"text-green-900 dark:text-green-100 text-sm flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {recommendation}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Immediate Actions */}\r\n        {assessment.immediateActions && assessment.immediateActions.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <Target className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Immediate Actions Required\r\n            </h3>\r\n            <div className=\"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.immediateActions.map((action: string, index: number) => (\r\n                  <li key={index} className=\"text-red-900 dark:text-red-100 text-sm flex items-start\">\r\n                    <ShieldAlert className=\"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {action}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Follow-up Recommendations */}\r\n        {assessment.followUpRecommendations && assessment.followUpRecommendations.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <TrendingUp className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Follow-up Recommendations\r\n            </h3>\r\n            <div className=\"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.followUpRecommendations.map((followUp: string, index: number) => (\r\n                  <li key={index} className=\"text-purple-900 dark:text-purple-100 text-sm flex items-start\">\r\n                    <Clock className=\"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {followUp}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Last Updated */}\r\n        <div className=\"pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400\">\r\n            <Clock className=\"w-3 h-3 mr-1\" aria-hidden=\"true\" />\r\n            Generated: {formatDateTime(assessment.generatedAt)}\r\n            {assessment.modelVersion && (\r\n              <span className=\"ml-4\">Model: {assessment.modelVersion}</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {error && (\r\n        <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n          <p className=\"text-red-700 dark:text-red-300 text-sm\">\r\n            {error.message}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RiskAssessmentComponent;\r\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useParams, Link, useNavigate } from 'react-router-dom';\r\nimport { \r\n  ArrowLeft, \r\n  RefreshCw, \r\n  Download, \r\n  AlertCircle, \r\n  CheckCircle, \r\n  Clock, \r\n  XCircle,\r\n  Eye,\r\n  EyeOff,\r\n  Play,\r\n  Pause,\r\n  Calendar,\r\n  User,\r\n  FileAudio,\r\n  Activity,\r\n  TrendingUp,\r\n  Brain,\r\n  Heart,\r\n  Info\r\n} from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { apiService } from '../services/api';\r\nimport { formatDateTime, formatRelativeTime } from '../utils';\r\nimport RiskAssessmentComponent from '../components/RiskAssessment';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Status configuration for consistent styling\r\nconst statusConfig = {\r\n  queued: { color: 'yellow', icon: Clock, label: 'Queued', description: 'Waiting to be processed' },\r\n  initiated: { color: 'blue', icon: Clock, label: 'Initiated', description: 'Session has been created' },\r\n  running: { color: 'blue', icon: RefreshCw, label: 'Processing', description: 'Audio is being analyzed' },\r\n  processing: { color: 'blue', icon: RefreshCw, label: 'Processing', description: 'Analysis in progress' },\r\n  succeeded: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  success: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  completed: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  failed: { color: 'red', icon: XCircle, label: 'Failed', description: 'Analysis encountered an error' },\r\n  error: { color: 'red', icon: XCircle, label: 'Error', description: 'An error occurred during processing' },\r\n} as const;\r\n\r\nconst SessionDetail: React.FC = () => {\r\n  const { sessionId } = useParams<{ sessionId: string }>();\r\n  const navigate = useNavigate();\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  const [session, setSession] = useState<SessionData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [showRawJson, setShowRawJson] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [audioPlaying, setAudioPlaying] = useState(false);\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n\r\n  // Load session data\r\n  const loadSession = useCallback(async () => {\r\n    if (!sessionId) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const sessionData = await apiService.getSessionData(sessionId);\r\n      setSession(sessionData);\r\n      announceToScreenReader(`Session ${sessionId} loaded successfully`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading session: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [sessionId, announceToScreenReader]);\r\n\r\n  // Refresh session data\r\n  const refreshSession = useCallback(async () => {\r\n    setIsRefreshing(true);\r\n    await loadSession();\r\n    setIsRefreshing(false);\r\n    announceToScreenReader('Session data refreshed');\r\n  }, [loadSession, announceToScreenReader]);\r\n\r\n  // Load session on component mount\r\n  useEffect(() => {\r\n    loadSession();\r\n  }, [loadSession]);\r\n\r\n  // Handle JSON view toggle\r\n  const toggleRawJson = useCallback(() => {\r\n    setShowRawJson(prev => {\r\n      const newState = !prev;\r\n      announceToScreenReader(`Raw JSON view ${newState ? 'enabled' : 'disabled'}`);\r\n      return newState;\r\n    });\r\n  }, [announceToScreenReader]);\r\n\r\n  // Audio controls\r\n  const toggleAudioPlayback = useCallback(() => {\r\n    if (!audioRef.current) return;\r\n    \r\n    if (audioPlaying) {\r\n      audioRef.current.pause();\r\n      setAudioPlaying(false);\r\n      announceToScreenReader('Audio paused');\r\n    } else {\r\n      audioRef.current.play().catch(() => {\r\n        announceToScreenReader('Failed to play audio');\r\n      });\r\n      setAudioPlaying(true);\r\n      announceToScreenReader('Audio playing');\r\n    }\r\n  }, [audioPlaying, announceToScreenReader]);\r\n\r\n  // Download session data\r\n  const downloadSessionData = useCallback(() => {\r\n    if (!session) return;\r\n\r\n    const dataStr = JSON.stringify(session, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    const url = URL.createObjectURL(dataBlob);\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `session-${session.sessionId}-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    announceToScreenReader('Session data download started');\r\n  }, [session, announceToScreenReader]);\r\n\r\n  // Download audio file using audioUrl from session data\r\n  const downloadAudioFile = useCallback(async () => {\r\n    if (!session?.audioUrl || !session?.audioFileName) return;\r\n    if (!session?.audioUrl) return;\r\n\r\n    try {\r\n      // Use the audioUrl directly from session data\r\n      const downloadUrl = session.audioUrl;\r\n      \r\n      // Open the download URL in a new tab\r\n      window.open(downloadUrl, '_blank');\r\n      // Use the audioUrl directly from session data\r\n      window.open(session.audioUrl, '_blank');\r\n      \r\n      announceToScreenReader(`Downloading audio file: ${session.audioFileName || 'audio file'}`);\r\n    } catch (error) {\r\n      console.error('Failed to download audio file:', error);\r\n      announceToScreenReader('Failed to download audio file');\r\n    }\r\n  }, [session, announceToScreenReader]);\r\n\r\n  // Re-run session analysis\r\n  const handleRerunSession = useCallback(() => {\r\n    if (!session) return;\r\n    \r\n    const confirmed = window.confirm('Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.');\r\n    if (!confirmed) return;\r\n\r\n    announceToScreenReader('Redirecting to upload page for re-run...');\r\n    \r\n    // Navigate to upload page with session data\r\n    navigate('/upload', {\r\n      state: {\r\n        originalSessionId: session.sessionId,\r\n        audioFileName: session.audioFileName,\r\n        audioUrl: session.audioUrl,\r\n        userMetadata: session.userMetadata\r\n      }\r\n    });\r\n  }, [session, navigate, announceToScreenReader]);\r\n\r\n  // Status badge component\r\n  const StatusBadge: React.FC<{ status: string }> = ({ status }) => {\r\n    // For any unknown status that contains \"error\" or \"fail\", treat as error\r\n    const normalizedStatus = status.toLowerCase();\r\n    let config = statusConfig[status as keyof typeof statusConfig];\r\n    \r\n    if (!config) {\r\n      if (normalizedStatus.includes('error') || normalizedStatus.includes('fail')) {\r\n        config = statusConfig.error;\r\n      } else {\r\n        // Default to initiated for unknown statuses instead of failed\r\n        config = statusConfig.initiated;\r\n      }\r\n    }\r\n    \r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <span\r\n          className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\r\n            config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n            config.color === 'blue' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\r\n            config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n            'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n          }`}\r\n          role=\"status\"\r\n          aria-label={`Status: ${config.label}`}\r\n        >\r\n          <Icon className={`w-4 h-4 mr-2 ${config.color === 'blue' && status === 'processing' ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n          {config.label}\r\n        </span>\r\n        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          {config.description}\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading session details...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Session\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <div className=\"mt-4 space-x-3\">\r\n                <button type=\"button\"\r\n                  onClick={loadSession}\r\n                  className=\"btn btn--primary\"\r\n                  aria-label=\"Retry loading session\"\r\n                >\r\n                  Try Again\r\n                </button>\r\n                <Link to=\"/sessions\" className=\"btn btn--secondary\">\r\n                  Back to Sessions\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!session) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"text-center py-16\">\r\n          <AlertCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            Session Not Found\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            The requested session could not be found.\r\n          </p>\r\n          <Link to=\"/sessions\" className=\"btn btn--primary\">\r\n            Back to Sessions\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div className=\"flex items-center space-x-4\">\r\n          <button type=\"button\"\r\n            onClick={() => navigate('/sessions')}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Back to sessions list\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Back to Sessions\r\n          </button>\r\n          \r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n              Session Details\r\n            </h1>\r\n            <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n              ID: {session.sessionId}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button type=\"button\"\r\n            onClick={toggleRawJson}\r\n            className=\"btn btn--secondary\"\r\n            aria-label={`${showRawJson ? 'Hide' : 'Show'} raw JSON data`}\r\n          >\r\n            {showRawJson ? <EyeOff className=\"w-4 h-4 mr-2\" /> : <Eye className=\"w-4 h-4 mr-2\" />}\r\n            {showRawJson ? 'Hide JSON' : 'Show JSON'}\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={refreshSession}\r\n            disabled={isRefreshing}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh session data\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${isRefreshing ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={handleRerunSession}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Re-run analysis for this session\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Re-run\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={downloadSessionData}\r\n            className=\"btn btn--primary\"\r\n            aria-label=\"Download session data as JSON\"\r\n          >\r\n            <Download className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Download\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Raw JSON View */}\r\n      {showRawJson && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Info className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Raw Session Data\r\n          </h2>\r\n          <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto\">\r\n            <pre className=\"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all\">\r\n              {JSON.stringify(session, null, 2)}\r\n            </pre>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Session Overview */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Basic Information */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Info className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Basic Information\r\n          </h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Status\r\n              </label>\r\n              <StatusBadge status={session.status} />\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <Calendar className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Created\r\n                </label>\r\n                <div className=\"text-sm\">\r\n                  <div className=\"text-gray-900 dark:text-white\">\r\n                    {formatRelativeTime(session.createdAt)}\r\n                  </div>\r\n                  <div className=\"text-gray-500 dark:text-gray-400\">\r\n                    {formatDateTime(session.createdAt)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <Clock className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Last Updated\r\n                </label>\r\n                <div className=\"text-sm\">\r\n                  <div className=\"text-gray-900 dark:text-white\">\r\n                    {formatRelativeTime(session.updatedAt)}\r\n                  </div>\r\n                  <div className=\"text-gray-500 dark:text-gray-400\">\r\n                    {formatDateTime(session.updatedAt)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                <User className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                User ID\r\n              </label>\r\n              <div className=\"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all\">\r\n                {session.userId}\r\n              </div>\r\n            </div>\r\n            \r\n            {session.metadata_user_id && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <User className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Metadata User ID\r\n                </label>\r\n                <div className=\"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all\">\r\n                  {session.metadata_user_id}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Audio Information */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <FileAudio className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Audio Information\r\n          </h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            {session.audioFileName && session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  File Name\r\n                </label>\r\n                <button\r\n                  onClick={downloadAudioFile}\r\n                  className=\"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors\"\r\n                  title=\"Click to download audio file\"\r\n                >\r\n                  {session.audioFileName}\r\n                </button>\r\n              </div>\r\n            )}\r\n            \r\n            {session.audioFileName && !session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  File Name\r\n                </label>\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  {session.audioFileName} (download not available)\r\n                </span>\r\n              </div>\r\n            )}\r\n            \r\n            {session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Audio File\r\n                </label>\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <button type=\"button\"\r\n                    onClick={toggleAudioPlayback}\r\n                    className=\"btn btn--secondary\"\r\n                    aria-label={`${audioPlaying ? 'Pause' : 'Play'} audio`}\r\n                  >\r\n                    {audioPlaying ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\r\n                  </button>\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                    {audioPlaying ? 'Playing audio...' : 'Audio playback available'}\r\n                  </span>\r\n                </div>\r\n                <audio\r\n                  ref={audioRef}\r\n                  src={session.audioUrl}\r\n                  onPlay={() => setAudioPlaying(true)}\r\n                  onPause={() => setAudioPlaying(false)}\r\n                  onEnded={() => setAudioPlaying(false)}\r\n                  onError={() => {\r\n                    setAudioPlaying(false);\r\n                    announceToScreenReader('Audio playback failed - file may not be accessible');\r\n                  }}\r\n                  className=\"hidden\"\r\n                  preload=\"metadata\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* User Metadata */}\r\n      {session.userMetadata && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <User className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Patient Information\r\n          </h2>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {session.userMetadata.age && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Age\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.age} years\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.gender && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Gender\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white capitalize\">\r\n                  {session.userMetadata.gender.replace(/[_-]/g, ' ')}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.weight && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Weight\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.weight} lbs\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.race && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Race\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white capitalize\">\r\n                  {session.userMetadata.race}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.ethnicity && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Ethnicity\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.ethnicity}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.zipcode && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  ZIP Code\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white font-mono\">\r\n                  {session.userMetadata.zipcode}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.language !== undefined && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Primary Language English\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.language ? 'Yes' : 'No'}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.sessionNotes && (\r\n              <div className=\"md:col-span-2 lg:col-span-3\">\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Session Notes\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border\">\r\n                  {session.userMetadata.sessionNotes}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analysis Results */}\r\n      {(session.analysisResults || session.prediction) && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Activity className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Analysis Results\r\n          </h2>\r\n          \r\n          <div className=\"space-y-6\">\r\n            {/* Mental Health Scores */}\r\n            {(session.analysisResults || session.prediction) && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n                  <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Mental Health Scores\r\n                </h3>\r\n                \r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  {/* Depression Score */}\r\n                  {(session.analysisResults?.depressionScore || (session.prediction as any)?.predicted_score_depression) && (\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\r\n                          Depression Score\r\n                        </span>\r\n                        <TrendingUp className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" aria-hidden=\"true\" />\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-blue-900 dark:text-blue-100\">\r\n                        {session.analysisResults?.depressionScore?.toFixed(2) || \r\n                         ((session.prediction as any)?.predicted_score_depression ? \r\n                           (session.prediction as any).predicted_score_depression.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase()) : \r\n                           'N/A')}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Anxiety Score */}\r\n                  {(session.analysisResults?.anxietyScore || (session.prediction as any)?.predicted_score_anxiety) && (\r\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">\r\n                          Anxiety Score\r\n                        </span>\r\n                        <Heart className=\"w-4 h-4 text-purple-600 dark:text-purple-400\" aria-hidden=\"true\" />\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-purple-900 dark:text-purple-100\">\r\n                        {session.analysisResults?.anxietyScore?.toFixed(2) || \r\n                         ((session.prediction as any)?.predicted_score_anxiety ? \r\n                           (session.prediction as any).predicted_score_anxiety.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase()) : \r\n                           'N/A')}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Note: Risk Level and Confidence scores have been removed per user request */}\r\n                  {/* Note: Overall Score (predicted_score) is deprecated and no longer displayed */}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Clinical Insights */}\r\n            {session.analysisResults?.insights && session.analysisResults.insights.length > 0 && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3\">\r\n                  Clinical Insights\r\n                </h3>\r\n                <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800\">\r\n                  <ul className=\"space-y-2\">\r\n                    {session.analysisResults.insights.map((insight, index) => (\r\n                      <li key={index} className=\"text-sm text-yellow-800 dark:text-yellow-200 flex items-start\">\r\n                        <span className=\"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0\" aria-hidden=\"true\"></span>\r\n                        {insight}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Completion Information */}\r\n            {session.analysisResults?.completedAt && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3\">\r\n                  Analysis Completion\r\n                </h3>\r\n                <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n                  <div className=\"flex items-center text-sm\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 dark:text-green-400 mr-2\" aria-hidden=\"true\" />\r\n                    <span className=\"text-gray-700 dark:text-gray-300 mr-2\">\r\n                      Completed:\r\n                    </span>\r\n                    <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {formatDateTime(session.analysisResults.completedAt)}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* AI Risk Assessment */}\r\n      <RiskAssessmentComponent \r\n        sessionId={session.sessionId}\r\n        existingAssessment={session.riskAssessment || null}\r\n        onAssessmentUpdated={(assessment) => {\r\n          setSession(prev => prev ? { ...prev, riskAssessment: assessment } : null);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SessionDetail;\r\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { \r\n  TrendingUp, \r\n  TrendingDown, \r\n  Activity, \r\n  Brain, \r\n  Heart, \r\n  BarChart3, \r\n  PieChart, \r\n  Clock,\r\n  AlertCircle,\r\n  RefreshCw,\r\n  Filter,\r\n  ChevronDown,\r\n  ChevronUp,\r\n  Download,\r\n  Eye\r\n} from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { apiService } from '../services/api';\r\nimport { getUserId, formatRelativeTime } from '../utils';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Chart data interfaces\r\ninterface ChartDataPoint {\r\n  date: string;\r\n  depression: number | null;\r\n  anxiety: number | null;\r\n  overall: number | null;\r\n  sessionId: string;\r\n}\r\n\r\ninterface ScoreDistribution {\r\n  category: string;\r\n  count: number;\r\n  percentage: number;\r\n  color: string;\r\n}\r\n\r\ninterface TrendAnalysis {\r\n  direction: 'improving' | 'worsening' | 'stable';\r\n  change: number;\r\n  period: string;\r\n}\r\n\r\n// Filter interface\r\ninterface PredictionFilters {\r\n  dateRange: 'all' | 'week' | 'month' | 'quarter' | 'year';\r\n  scoreType: 'all' | 'depression' | 'anxiety' | 'overall';\r\n  showTrends: boolean;\r\n}\r\n\r\nconst Predictions: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [sessions, setSessions] = useState<SessionData[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [filters, setFilters] = useState<PredictionFilters>({\r\n    dateRange: 'all',\r\n    scoreType: 'all',\r\n    showTrends: true\r\n  });\r\n  const [showFilters, setShowFilters] = useState(false);\r\n\r\n  const { announceToScreenReader } = useAccessibility();\r\n  const navigate = useNavigate();\r\n\r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  // Handle bar click to navigate to session details\r\n  const handleBarClick = useCallback((sessionId: string) => {\r\n    navigate(`/sessions/${sessionId}`);\r\n    announceToScreenReader(`Navigating to session ${sessionId} details`);\r\n  }, [navigate, announceToScreenReader]);\r\n\r\n  // Load user sessions with prediction data\r\n  const loadPredictions = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const userId = getAuthenticatedUserId(); // Use authenticated user ID to match blob storage folder structure\r\n      const response = await apiService.getUserSessions(userId);\r\n      \r\n      // Filter sessions that have analysis results or predictions\r\n      const sessionsWithPredictions = response.sessions.filter(session => {\r\n        return session.analysisResults || session.prediction;\r\n      });\r\n      \r\n      setSessions(sessionsWithPredictions);\r\n      announceToScreenReader(`${sessionsWithPredictions.length} prediction sessions loaded`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading predictions: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  useEffect(() => {\r\n    loadPredictions();\r\n  }, [loadPredictions]);\r\n\r\n  // Filter sessions based on date range\r\n  const filteredSessions = useMemo(() => {\r\n    if (filters.dateRange === 'all') return sessions;\r\n\r\n    const now = new Date();\r\n    const startDate = new Date();\r\n    \r\n    switch (filters.dateRange) {\r\n      case 'week':\r\n        startDate.setDate(now.getDate() - 7);\r\n        break;\r\n      case 'month':\r\n        startDate.setMonth(now.getMonth() - 1);\r\n        break;\r\n      case 'quarter':\r\n        startDate.setMonth(now.getMonth() - 3);\r\n        break;\r\n      case 'year':\r\n        startDate.setFullYear(now.getFullYear() - 1);\r\n        break;\r\n    }\r\n    \r\n    return sessions.filter(session => \r\n      new Date(session.createdAt) >= startDate\r\n    );\r\n  }, [sessions, filters.dateRange]);\r\n\r\n  // Prepare chart data\r\n  const chartData = useMemo((): ChartDataPoint[] => {\r\n    return filteredSessions\r\n      .map(session => {\r\n        // Since we now have categorical data, we'll map categories to numbers for visualization\r\n        const mapCategoryToNumber = (category?: string): number | null => {\r\n          if (!category) return null;\r\n          switch (category.toLowerCase()) {\r\n            // Depression categories\r\n            case 'no_to_mild':\r\n              return 1;\r\n            case 'mild_to_moderate':\r\n              return 2;\r\n            case 'moderate_to_severe':\r\n              return 3;\r\n            // Anxiety categories\r\n            case 'no_or_minimal':\r\n              return 1;\r\n            case 'moderate':\r\n              return 2;\r\n            case 'moderately_severe':\r\n              return 3;\r\n            case 'severe':\r\n              return 4;\r\n            default:\r\n              return null;\r\n          }\r\n        };\r\n\r\n        const depression = mapCategoryToNumber((session.prediction as any)?.predicted_score_depression);\r\n        const anxiety = mapCategoryToNumber((session.prediction as any)?.predicted_score_anxiety);\r\n        // Note: predicted_score is deprecated, no longer using overall score\r\n\r\n        return {\r\n          date: session.createdAt,\r\n          depression,\r\n          anxiety,\r\n          overall: null, // No longer using deprecated predicted_score\r\n          sessionId: session.sessionId\r\n        };\r\n      })\r\n      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate score distributions based on categorical data\r\n  const scoreDistribution = useMemo((): Record<string, ScoreDistribution[]> => {\r\n    const distributions: Record<string, ScoreDistribution[]> = {\r\n      depression: [],\r\n      anxiety: []\r\n    };\r\n\r\n    // Define possible categories and their colors\r\n    const categories = [\r\n      // Depression categories\r\n      { category: 'no_to_mild', label: 'No to Mild', color: 'bg-green-400' },\r\n      { category: 'mild_to_moderate', label: 'Mild to Moderate', color: 'bg-yellow-500' },\r\n      { category: 'moderate_to_severe', label: 'Moderate to Severe', color: 'bg-red-600' },\r\n      // Anxiety categories  \r\n      { category: 'no_or_minimal', label: 'No or Minimal', color: 'bg-green-400' },\r\n      { category: 'moderate', label: 'Moderate', color: 'bg-orange-500' },\r\n      { category: 'moderately_severe', label: 'Moderately Severe', color: 'bg-red-500' },\r\n      { category: 'severe', label: 'Severe', color: 'bg-red-700' }\r\n    ];\r\n\r\n    // Process depression scores\r\n    const depressionScores = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_depression)\r\n      .filter(score => score !== undefined);\r\n\r\n    categories.forEach(cat => {\r\n      const count = depressionScores.filter(score => score === cat.category).length;\r\n      const percentage = depressionScores.length > 0 ? (count / depressionScores.length) * 100 : 0;\r\n      \r\n      if (count > 0) { // Only show categories that have data\r\n        distributions.depression.push({\r\n          category: cat.label,\r\n          count,\r\n          percentage,\r\n          color: cat.color\r\n        });\r\n      }\r\n    });\r\n\r\n    // Process anxiety scores\r\n    const anxietyScores = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_anxiety)\r\n      .filter(score => score !== undefined);\r\n\r\n    categories.forEach(cat => {\r\n      const count = anxietyScores.filter(score => score === cat.category).length;\r\n      const percentage = anxietyScores.length > 0 ? (count / anxietyScores.length) * 100 : 0;\r\n      \r\n      if (count > 0) { // Only show categories that have data\r\n        distributions.anxiety.push({\r\n          category: cat.label,\r\n          count,\r\n          percentage,\r\n          color: cat.color\r\n        });\r\n      }\r\n    });\r\n\r\n    // Note: Overall scores (predicted_score) are deprecated and no longer processed\r\n\r\n    return distributions;\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate trend analysis for categorical data\r\n  const trendAnalysis = useMemo((): Record<string, TrendAnalysis> => {\r\n    const trends: Record<string, TrendAnalysis> = {};\r\n    \r\n    // For categorical data, we'll analyze if the trend is toward more severe or less severe categories\r\n    const getCategorySeverity = (category?: string): number => {\r\n      if (!category) return 0;\r\n      switch (category.toLowerCase()) {\r\n        // Depression categories: no_to_mild, mild_to_moderate, moderate_to_severe\r\n        case 'no_to_mild':\r\n          return 1;\r\n        case 'mild_to_moderate':\r\n          return 2;\r\n        case 'moderate_to_severe':\r\n          return 3;\r\n        // Anxiety categories: no_or_minimal, moderate, moderately_severe, severe\r\n        case 'no_or_minimal':\r\n          return 1;\r\n        case 'moderate':\r\n          return 2;\r\n        case 'moderately_severe':\r\n          return 3;\r\n        case 'severe':\r\n          return 4;\r\n        default:\r\n          return 0;\r\n      }\r\n    };\r\n\r\n    // Analyze depression trend\r\n    const depressionCategories = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_depression)\r\n      .filter(cat => cat !== undefined);\r\n\r\n    if (depressionCategories.length < 2) {\r\n      trends.depression = { direction: 'stable', change: 0, period: 'insufficient data' };\r\n    } else {\r\n      const severityScores = depressionCategories.map(getCategorySeverity);\r\n      const firstHalf = severityScores.slice(0, Math.floor(severityScores.length / 2));\r\n      const secondHalf = severityScores.slice(Math.floor(severityScores.length / 2));\r\n\r\n      const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\r\n      const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\r\n      const change = secondAvg - firstAvg;\r\n      \r\n      trends.depression = {\r\n        direction: Math.abs(change) < 0.5 ? 'stable' : change < 0 ? 'improving' : 'worsening',\r\n        change: Math.abs(change),\r\n        period: `${filteredSessions.length} sessions`\r\n      };\r\n    }\r\n\r\n    // Analyze anxiety trend\r\n    const anxietyCategories = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_anxiety)\r\n      .filter(cat => cat !== undefined);\r\n\r\n    if (anxietyCategories.length < 2) {\r\n      trends.anxiety = { direction: 'stable', change: 0, period: 'insufficient data' };\r\n    } else {\r\n      const severityScores = anxietyCategories.map(getCategorySeverity);\r\n      const firstHalf = severityScores.slice(0, Math.floor(severityScores.length / 2));\r\n      const secondHalf = severityScores.slice(Math.floor(severityScores.length / 2));\r\n\r\n      const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\r\n      const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\r\n      const change = secondAvg - firstAvg;\r\n      \r\n      trends.anxiety = {\r\n        direction: Math.abs(change) < 0.5 ? 'stable' : change < 0 ? 'improving' : 'worsening',\r\n        change: Math.abs(change),\r\n        period: `${filteredSessions.length} sessions`\r\n      };\r\n    }\r\n\r\n    // Overall trend (placeholder)\r\n    trends.overall = { direction: 'stable', change: 0, period: 'coming soon' };\r\n\r\n    return trends;\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate statistics\r\n  const statistics = useMemo(() => {\r\n    const stats = {\r\n      totalSessions: filteredSessions.length,\r\n      avgDepression: 0,\r\n      avgAnxiety: 0,\r\n      avgOverall: 0,\r\n      latestSession: null as SessionData | null,\r\n      improvementSessions: 0\r\n    };\r\n\r\n    if (filteredSessions.length === 0) return stats;\r\n\r\n    // For categorical data, we'll show the most common category instead of averages\r\n    const depressionCategories = filteredSessions\r\n      .map(s => s.prediction?.predictedScoreDepression)\r\n      .filter(s => s !== undefined);\r\n    \r\n    const anxietyCategories = filteredSessions\r\n      .map(s => s.prediction?.predictedScoreAnxiety)\r\n      .filter(s => s !== undefined);\r\n\r\n    // Calculate mode (most frequent category) for depression\r\n    if (depressionCategories.length > 0) {\r\n      const depressionCounts: Record<string, number> = {};\r\n      depressionCategories.forEach(cat => {\r\n        depressionCounts[cat!] = (depressionCounts[cat!] || 0) + 1;\r\n      });\r\n      const mostCommonDepression = Object.entries(depressionCounts)\r\n        .sort(([,a], [,b]) => b - a)[0][0];\r\n      stats.avgDepression = depressionCounts[mostCommonDepression];\r\n    }\r\n\r\n    // Calculate mode (most frequent category) for anxiety\r\n    if (anxietyCategories.length > 0) {\r\n      const anxietyCounts: Record<string, number> = {};\r\n      anxietyCategories.forEach(cat => {\r\n        anxietyCounts[cat!] = (anxietyCounts[cat!] || 0) + 1;\r\n      });\r\n      const mostCommonAnxiety = Object.entries(anxietyCounts)\r\n        .sort(([,a], [,b]) => b - a)[0][0];\r\n      stats.avgAnxiety = anxietyCounts[mostCommonAnxiety];\r\n    }\r\n    \r\n    stats.latestSession = filteredSessions.sort((a, b) => \r\n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\r\n    )[0];\r\n\r\n    // Improvement rate will be calculated later - for now set to 0\r\n    stats.improvementSessions = 0;\r\n\r\n    return stats;\r\n  }, [filteredSessions]);\r\n\r\n  // Handle filter changes\r\n  const updateFilter = useCallback((key: keyof PredictionFilters, value: any) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n    announceToScreenReader(`Filter ${key} changed to ${value}`);\r\n  }, [announceToScreenReader]);\r\n\r\n  // Download predictions data\r\n  const downloadPredictions = useCallback(() => {\r\n    const dataStr = JSON.stringify(filteredSessions, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    const url = URL.createObjectURL(dataBlob);\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `predictions-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    announceToScreenReader('Predictions data download started');\r\n  }, [filteredSessions, announceToScreenReader]);\r\n\r\n  // Trend indicator component\r\n  const TrendIndicator: React.FC<{ trend: TrendAnalysis; label: string }> = ({ trend, label }) => {\r\n    const Icon = trend.direction === 'improving' ? TrendingDown : \r\n                 trend.direction === 'worsening' ? TrendingUp : Activity;\r\n    const colorClass = trend.direction === 'improving' ? 'text-green-600 dark:text-green-400' :\r\n                       trend.direction === 'worsening' ? 'text-red-600 dark:text-red-400' :\r\n                       'text-gray-600 dark:text-gray-400';\r\n\r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <Icon className={`w-4 h-4 ${colorClass}`} aria-hidden=\"true\" />\r\n        <span className=\"text-sm text-gray-700 dark:text-gray-300\">{label}</span>\r\n        <span className={`text-sm font-medium ${colorClass} capitalize`}>\r\n          {trend.direction}\r\n          {trend.period === 'insufficient data' \r\n            ? ' (need more sessions)'\r\n            : trend.period === 'coming soon' \r\n              ? ' (analysis coming soon)'\r\n              : ` (${trend.period})`\r\n          }\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Simple line chart component\r\n  const SimpleLineChart: React.FC<{ \r\n    data: ChartDataPoint[]; \r\n    type: 'depression' | 'anxiety' | 'overall';\r\n    onBarClick: (sessionId: string) => void;\r\n  }> = ({ data, type, onBarClick }) => {\r\n    const scores = data.map(d => d[type]).filter(s => s !== null) as number[];\r\n    if (scores.length === 0) return <div className=\"text-center text-gray-500 py-8\">No data available</div>;\r\n\r\n    const maxScore = Math.max(...scores);\r\n    const minScore = Math.min(...scores);\r\n    const range = maxScore - minScore || 1;\r\n\r\n    // Function to convert numeric score back to category name\r\n    const getScoreCategoryName = (score: number): string => {\r\n      switch (score) {\r\n        case 1: return 'No to Mild / No or Minimal';\r\n        case 2: return 'Mild to Moderate / Moderate';\r\n        case 3: return 'Moderate to Severe / Moderately Severe';\r\n        case 4: return 'Severe';\r\n        default: return 'Unknown';\r\n      }\r\n    };\r\n\r\n    // Function to get category color based on score and chart type\r\n    const getCategoryColor = (score: number, type: 'depression' | 'anxiety' | 'overall'): string => {\r\n      if (type === 'depression') {\r\n        switch (score) {\r\n          case 1: return 'bg-blue-400';  // no_to_mild\r\n          case 2: return 'bg-blue-600';  // mild_to_moderate\r\n          case 3: return 'bg-blue-800';  // moderate_to_severe\r\n          default: return 'bg-blue-500';\r\n        }\r\n      } else if (type === 'anxiety') {\r\n        switch (score) {\r\n          case 1: return 'bg-purple-400'; // no_or_minimal\r\n          case 2: return 'bg-purple-600'; // moderate\r\n          case 3: return 'bg-purple-700'; // moderately_severe\r\n          case 4: return 'bg-purple-900'; // severe\r\n          default: return 'bg-purple-500';\r\n        }\r\n      } else {\r\n        switch (score) {\r\n          case 1: return 'bg-green-400';\r\n          case 2: return 'bg-green-600';\r\n          case 3: return 'bg-green-700';\r\n          case 4: return 'bg-green-800';\r\n          default: return 'bg-green-500';\r\n        }\r\n      }\r\n    };\r\n\r\n    // Legend data - updated to match the chart colors\r\n    const getLegendItems = (chartType: 'depression' | 'anxiety' | 'overall') => {\r\n      const baseItems = [\r\n        { score: 1, label: 'No/Minimal' },\r\n        { score: 2, label: 'Mild' },\r\n        { score: 3, label: 'Moderate' },\r\n        { score: 4, label: 'Mod-Severe' },\r\n        { score: 5, label: 'Severe' }\r\n      ];\r\n      \r\n      return baseItems.map(item => ({\r\n        ...item,\r\n        color: getCategoryColor(item.score, chartType)\r\n      }));\r\n    };\r\n\r\n    // Filter legend to only show categories that exist in the data\r\n    const usedScores = new Set(scores);\r\n    const legendItems = getLegendItems(type);\r\n    const activeLegendItems = legendItems.filter(item => usedScores.has(item.score));\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"h-32 flex items-end space-x-1 px-4 py-2 mb-4\">\r\n          {data.map((dataPoint, index) => {\r\n            const score = dataPoint[type];\r\n            if (score === null) return null;\r\n            \r\n            const height = ((score - minScore) / range) * 100;\r\n            const categoryColor = getCategoryColor(score, type);\r\n            const categoryName = getScoreCategoryName(score);\r\n            const dateStr = new Date(dataPoint.date).toLocaleDateString();\r\n            \r\n            return (\r\n              <div\r\n                key={index}\r\n                className={`flex-1 ${categoryColor} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`}\r\n                style={{ '--chart-height': `${Math.max(height, 8)}%` } as React.CSSProperties}\r\n                onClick={() => onBarClick(dataPoint.sessionId)}\r\n                role=\"button\"\r\n                tabIndex={0}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter' || e.key === ' ') {\r\n                    e.preventDefault();\r\n                    onBarClick(dataPoint.sessionId);\r\n                  }\r\n                }}\r\n                aria-label={`View session details for ${categoryName} score on ${dateStr}`}\r\n              >\r\n                {/* Tooltip */}\r\n                <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10\">\r\n                  <div className=\"font-medium\">{categoryName}</div>\r\n                  <div className=\"text-gray-300\">{dateStr}</div>\r\n                  <div className=\"text-gray-300\">Session: {dataPoint.sessionId.slice(-8)}</div>\r\n                  <div className=\"text-gray-400 text-xs mt-1\">Click to view details</div>\r\n                  {/* Tooltip arrow */}\r\n                  <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900\"></div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Legend */}\r\n        {activeLegendItems.length > 0 && (\r\n          <div className=\"px-4\">\r\n            <div className=\"flex flex-wrap items-center gap-3 text-xs\">\r\n              <span className=\"text-gray-600 dark:text-gray-400 font-medium\">Legend:</span>\r\n              {activeLegendItems.map((item) => (\r\n                <div key={item.score} className=\"flex items-center gap-1\">\r\n                  <div className={`w-3 h-3 ${item.color} rounded`}></div>\r\n                  <span className=\"text-gray-700 dark:text-gray-300\">{item.label}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading predictions...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Predictions\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <button\r\n                type=\"button\"\r\n                onClick={loadPredictions}\r\n                className=\"mt-4 btn btn--primary\"\r\n                aria-label=\"Retry loading predictions\"\r\n              >\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            My Predictions\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            Analyze your mental health trends and insights over time\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setShowFilters(!showFilters)}\r\n            className=\"btn btn--secondary\"\r\n            aria-expanded={showFilters ? 'true' : 'false'}\r\n            aria-label={`${showFilters ? 'Hide' : 'Show'} filter options`}\r\n          >\r\n            <Filter className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Filters\r\n            {showFilters ? <ChevronUp className=\"w-4 h-4 ml-2\" /> : <ChevronDown className=\"w-4 h-4 ml-2\" />}\r\n          </button>\r\n          \r\n          <button\r\n            type=\"button\"\r\n            onClick={loadPredictions}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh predictions data\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <button\r\n            type=\"button\"\r\n            onClick={downloadPredictions}\r\n            className=\"btn btn--primary\"\r\n            disabled={filteredSessions.length === 0}\r\n            aria-label=\"Download predictions data\"\r\n          >\r\n            <Download className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Download\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      {showFilters && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label htmlFor=\"date-range\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Date Range\r\n              </label>\r\n              <select\r\n                id=\"date-range\"\r\n                value={filters.dateRange}\r\n                onChange={(e) => updateFilter('dateRange', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Time</option>\r\n                <option value=\"week\">Past Week</option>\r\n                <option value=\"month\">Past Month</option>\r\n                <option value=\"quarter\">Past Quarter</option>\r\n                <option value=\"year\">Past Year</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label htmlFor=\"score-type\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Focus Score\r\n              </label>\r\n              <select\r\n                id=\"score-type\"\r\n                value={filters.scoreType}\r\n                onChange={(e) => updateFilter('scoreType', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Scores</option>\r\n                <option value=\"depression\">Depression</option>\r\n                <option value=\"anxiety\">Anxiety</option>\r\n                <option value=\"overall\">Overall</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div className=\"flex items-end\">\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={filters.showTrends}\r\n                  onChange={(e) => updateFilter('showTrends', e.target.checked)}\r\n                  className=\"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2\"\r\n                />\r\n                <span className=\"text-sm text-gray-700 dark:text-gray-300\">Show trend analysis</span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {filteredSessions.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n          <Brain className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No Prediction Data Available\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            {sessions.length === 0 \r\n              ? \"You haven't completed any analysis sessions yet.\"\r\n              : \"No sessions found for the selected date range.\"\r\n            }\r\n          </p>\r\n          <Link to=\"/upload\" className=\"btn btn--primary\">\r\n            Start Your First Analysis\r\n          </Link>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Statistics Overview */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Activity className=\"w-8 h-8 text-blue-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Total Sessions</p>\r\n                  <p className=\"text-2xl font-semibold text-gray-900 dark:text-white\">{statistics.totalSessions}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Brain className=\"w-8 h-8 text-purple-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Depression (Most Common)</p>\r\n                  <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                    {(() => {\r\n                      const depressionCategories = filteredSessions\r\n                        .map(s => (s.prediction as any)?.predicted_score_depression)\r\n                        .filter(s => s !== undefined);\r\n                      \r\n                      if (depressionCategories.length === 0) return '';\r\n                      \r\n                      const counts: Record<string, number> = {};\r\n                      depressionCategories.forEach(cat => {\r\n                        counts[cat!] = (counts[cat!] || 0) + 1;\r\n                      });\r\n                      \r\n                      const mostCommon = Object.entries(counts)\r\n                        .sort(([,a], [,b]) => b - a)[0][0];\r\n                      \r\n                      return mostCommon.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n                    })()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Heart className=\"w-8 h-8 text-red-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Anxiety (Most Common)</p>\r\n                  <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                    {(() => {\r\n                      const anxietyCategories = filteredSessions\r\n                        .map(s => (s.prediction as any)?.predicted_score_anxiety)\r\n                        .filter(s => s !== undefined);\r\n                      \r\n                      if (anxietyCategories.length === 0) return '';\r\n                      \r\n                      const counts: Record<string, number> = {};\r\n                      anxietyCategories.forEach(cat => {\r\n                        counts[cat!] = (counts[cat!] || 0) + 1;\r\n                      });\r\n                      \r\n                      const mostCommon = Object.entries(counts)\r\n                        .sort(([,a], [,b]) => b - a)[0][0];\r\n                      \r\n                      return mostCommon.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n                    })()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Improvement Rate section hidden - feature not implemented yet\r\n            <div className=\"bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 p-6 opacity-60\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Activity className=\"w-8 h-8 text-gray-500\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Improvement Rate</p>\r\n                  <p className=\"text-lg font-semibold text-gray-500 dark:text-gray-400\">\r\n                    Coming Soon\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                    Feature in development\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            */}\r\n          </div>\r\n\r\n          {/* Charts Section */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Score Trends Chart */}\r\n            {(filters.scoreType === 'all' || filters.scoreType === 'depression') && (\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                  <BarChart3 className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Depression Score Trend\r\n                </h3>\r\n                <SimpleLineChart data={chartData} type=\"depression\" onBarClick={handleBarClick} />\r\n                {filters.showTrends && (\r\n                  <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600\">\r\n                    <TrendIndicator trend={trendAnalysis.depression} label=\"Trend:\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {(filters.scoreType === 'all' || filters.scoreType === 'anxiety') && (\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                  <PieChart className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Anxiety Score Trend\r\n                </h3>\r\n                <SimpleLineChart data={chartData} type=\"anxiety\" onBarClick={handleBarClick} />\r\n                {filters.showTrends && (\r\n                  <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600\">\r\n                    <TrendIndicator trend={trendAnalysis.anxiety} label=\"Trend:\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Score Distribution */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n              <BarChart3 className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Score Distribution\r\n            </h3>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {Object.entries(scoreDistribution).map(([scoreType, distribution]) => (\r\n                <div key={scoreType}>\r\n                  <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize\">\r\n                    {scoreType} Scores\r\n                  </h4>\r\n                  <div className=\"space-y-2\">\r\n                    {distribution.map((item) => (\r\n                      <div key={item.category} className=\"flex items-center\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex justify-between text-xs mb-1\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">{item.category}</span>\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">{item.count} ({item.percentage.toFixed(1)}%)</span>\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                            <div\r\n                              className={`h-2 rounded-full ${item.color} progress-dynamic progress-animated`}\r\n                              style={{ '--progress-width': `${item.percentage}%` } as React.CSSProperties}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Recent Sessions */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\">\r\n                <Clock className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                Recent Analysis Sessions\r\n              </h3>\r\n              <Link to=\"/sessions\" className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm\">\r\n                View All Sessions \r\n              </Link>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n              {filteredSessions.slice(0, 5).map((session) => (\r\n                <div key={session.sessionId} className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className={`w-2 h-2 rounded-full ${\r\n                        session.status === 'succeeded' ? 'bg-green-500' :\r\n                        session.status === 'processing' ? 'bg-blue-500' :\r\n                        session.status === 'failed' ? 'bg-red-500' : 'bg-gray-500'\r\n                      }`} />\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {session.audioFileName || `Session ${session.sessionId.slice(-8)}`}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                          {formatRelativeTime(session.createdAt)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center space-x-4\">\r\n                    {(session.prediction as any)?.predicted_score_depression && (\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Depression</p>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {(session.prediction as any).predicted_score_depression.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                    {(session.prediction as any)?.predicted_score_anxiety && (\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Anxiety</p>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {(session.prediction as any).predicted_score_anxiety.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                    <Link\r\n                      to={`/sessions/${session.sessionId}`}\r\n                      className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400\"\r\n                      aria-label={`View session ${session.sessionId}`}\r\n                    >\r\n                      <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Predictions;\r\n","import React, { useState, useCallback, useEffect } from 'react';\r\nimport { RefreshCw, AlertCircle, TrendingUp, TrendingDown, Users, Activity, Info, X } from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { apiService } from '../services/api';\r\nimport type { SessionData as ImportedSessionData, AppError } from '../types';\r\n\r\n// Types for analytics data\r\ninterface AnalyticsData {\r\n  overview: {\r\n    totalSessions: number;\r\n    uniqueUsers: number;\r\n    successRate: number;\r\n    avgSessionsPerUser: number;\r\n    recentActivity: number;\r\n  };\r\n  sessionStatus: {\r\n    succeeded: number;\r\n    failed: number;\r\n    processing: number;\r\n    total: number;\r\n  };\r\n  riskLevels: {\r\n    low: number;\r\n    medium: number;\r\n    high: number;\r\n    unknown: number;\r\n    total: number;\r\n  };\r\n  predictions: {\r\n    depression: {\r\n      no_to_mild: number;\r\n      mild_to_moderate: number;\r\n      moderate_to_severe: number;\r\n      severe: number;\r\n      total: number;\r\n    };\r\n    anxiety: {\r\n      no_or_minimal: number;\r\n      mild: number;\r\n      moderate: number;\r\n      moderately_severe: number;\r\n      severe: number;\r\n      total: number;\r\n    };\r\n  };\r\n  timeData: Array<{\r\n    date: string;\r\n    count: number;\r\n  }>;\r\n  riskDistribution: {\r\n    low: number;\r\n    medium: number;\r\n    high: number;\r\n    unknown: number;\r\n  };\r\n  userStats: Array<{\r\n    userId: string;\r\n    totalSessions: number;\r\n    successfulSessions: number;\r\n    successRate: number;\r\n    avgConfidence: number;\r\n    riskDistribution: {\r\n      low: number;\r\n      medium: number;\r\n      high: number;\r\n      unknown: number;\r\n    };\r\n    lastActivity: string;\r\n    depressionScores: {\r\n      no_to_mild: number;\r\n      mild_to_moderate: number;\r\n      moderate_to_severe: number;\r\n      severe: number;\r\n    };\r\n    anxietyScores: {\r\n      no_or_minimal: number;\r\n      mild: number;\r\n      moderate: number;\r\n      moderately_severe: number;\r\n      severe: number;\r\n    };\r\n  }>;\r\n  correlations: {\r\n    ageDistribution: {\r\n      [ageGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    genderDistribution: {\r\n      [gender: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    raceDistribution: {\r\n      [race: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    ethnicityDistribution: {\r\n      [ethnicity: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    languageDistribution: {\r\n      [language: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    weightDistribution: {\r\n      [weightGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    zipCodeDistribution: {\r\n      [zipGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n  };\r\n}\r\n\r\n// Utility function to calculate percentage\r\nconst getPercentage = (value: number, total: number): number => {\r\n  return total > 0 ? Math.round((value / total) * 100) : 0;\r\n};\r\n\r\n// Function to aggregate session data into analytics\r\nconst aggregateSessionData = (allSessions: ImportedSessionData[]): AnalyticsData => {\r\n  const totalSessions = allSessions.length;\r\n  const uniqueUsers = new Set(allSessions.map(s => s.userId)).size;\r\n  \r\n  const completedSessions = allSessions.filter(s => \r\n    s.status === 'succeeded' || s.status === 'completed'\r\n  );\r\n  \r\n  const failedSessions = allSessions.filter(s => \r\n    s.status === 'failed'\r\n  );\r\n  \r\n  const processingSessions = allSessions.filter(s => \r\n    s.status === 'processing'\r\n  );\r\n\r\n  // Calculate success rate and average sessions per user\r\n  const successRate = getPercentage(completedSessions.length, totalSessions);\r\n  const avgSessionsPerUser = uniqueUsers > 0 ? Math.round((totalSessions / uniqueUsers) * 10) / 10 : 0;\r\n  \r\n  // Calculate recent activity (sessions in last 24 hours)\r\n  const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\r\n  const recentActivity = allSessions.filter(s => \r\n    new Date(s.createdAt) > twentyFourHoursAgo\r\n  ).length;\r\n\r\n  // Risk level distribution\r\n  const riskCounts = {\r\n    low: 0,\r\n    medium: 0,\r\n    high: 0,\r\n    unknown: 0,\r\n  };\r\n\r\n  allSessions.forEach(session => {\r\n    const riskLevel = session.analysisResults?.riskLevel || 'unknown';\r\n    if (riskLevel in riskCounts) {\r\n      riskCounts[riskLevel as keyof typeof riskCounts]++;\r\n    }\r\n  });\r\n\r\n  // Depression score distribution\r\n  const depressionCounts = {\r\n    no_to_mild: 0,\r\n    mild_to_moderate: 0,\r\n    moderate_to_severe: 0,\r\n    severe: 0,\r\n  };\r\n\r\n  // Anxiety score distribution\r\n  const anxietyCounts = {\r\n    no_or_minimal: 0,\r\n    mild: 0,\r\n    moderate: 0,\r\n    moderately_severe: 0,\r\n    severe: 0,\r\n  };\r\n\r\n  completedSessions.forEach(session => {\r\n    // Handle depression scores - try multiple sources\r\n    let depressionCategory: string | null = null;\r\n    let anxietyCategory: string | null = null;\r\n\r\n    // First try prediction object for classification strings\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n      anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n    }\r\n\r\n    // If no classification from prediction, try to categorize from numeric scores in analysisResults\r\n    if (!depressionCategory && session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n      const score = session.analysisResults.depressionScore;\r\n      // Convert numeric PHQ-9 score to categories (0-27 scale)\r\n      if (score >= 0 && score <= 4) depressionCategory = 'no_to_mild';\r\n      else if (score >= 5 && score <= 9) depressionCategory = 'mild_to_moderate';\r\n      else if (score >= 10 && score <= 14) depressionCategory = 'mild_to_moderate';\r\n      else if (score >= 15 && score <= 19) depressionCategory = 'moderate_to_severe';\r\n      else if (score >= 20) depressionCategory = 'severe';\r\n    }\r\n\r\n    if (!anxietyCategory && session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n      const score = session.analysisResults.anxietyScore;\r\n      // Convert numeric GAD-7 score to categories (0-21 scale)\r\n      if (score >= 0 && score <= 4) anxietyCategory = 'no_or_minimal';\r\n      else if (score >= 5 && score <= 9) anxietyCategory = 'mild';\r\n      else if (score >= 10 && score <= 14) anxietyCategory = 'moderate';\r\n      else if (score >= 15 && score <= 19) anxietyCategory = 'moderately_severe';\r\n      else if (score >= 20) anxietyCategory = 'severe';\r\n    }\r\n\r\n    // Count the categories\r\n    if (depressionCategory && depressionCategory in depressionCounts) {\r\n      depressionCounts[depressionCategory as keyof typeof depressionCounts]++;\r\n    }\r\n\r\n    if (anxietyCategory && anxietyCategory in anxietyCounts) {\r\n      anxietyCounts[anxietyCategory as keyof typeof anxietyCounts]++;\r\n    }\r\n  });\r\n\r\n  // Time series data (last 7 days)\r\n  const timeData = [];\r\n  for (let i = 6; i >= 0; i--) {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - i);\r\n    const dateStr = date.toISOString().split('T')[0];\r\n    \r\n    const sessionsOnDate = allSessions.filter(s => \r\n      s.createdAt.split('T')[0] === dateStr\r\n    ).length;\r\n    \r\n    timeData.push({\r\n      date: dateStr,\r\n      count: sessionsOnDate,\r\n    });\r\n  }\r\n\r\n  // Calculate per-user statistics\r\n  const userStatsMap = new Map<string, {\r\n    totalSessions: number;\r\n    successfulSessions: number;\r\n    sessions: ImportedSessionData[];\r\n  }>();\r\n\r\n  // Group sessions by metadata user ID (patient) when available, otherwise by authenticated user ID\r\n  allSessions.forEach(session => {\r\n    // Use metadata_user_id (patient ID) for grouping if available, otherwise use userId (authenticated user)\r\n    const groupingUserId = session.metadata_user_id || session.userId;\r\n    \r\n    if (!userStatsMap.has(groupingUserId)) {\r\n      userStatsMap.set(groupingUserId, {\r\n        totalSessions: 0,\r\n        successfulSessions: 0,\r\n        sessions: [],\r\n      });\r\n    }\r\n    const userStats = userStatsMap.get(groupingUserId)!;\r\n    userStats.totalSessions++;\r\n    userStats.sessions.push(session);\r\n    if (session.status === 'succeeded' || session.status === 'completed') {\r\n      userStats.successfulSessions++;\r\n    }\r\n  });\r\n\r\n  // Calculate detailed user statistics\r\n  const userStats = Array.from(userStatsMap.entries()).map(([userId, stats]) => {\r\n    const successRate = getPercentage(stats.successfulSessions, stats.totalSessions);\r\n    \r\n    // Calculate average confidence for this user\r\n    const successfulSessions = stats.sessions.filter(s => \r\n      s.status === 'succeeded' || s.status === 'completed'\r\n    );\r\n    \r\n    const confidenceValues = successfulSessions\r\n      .map(s => s.analysisResults?.confidence)\r\n      .filter(c => c !== null && c !== undefined && typeof c === 'number');\r\n    \r\n    const avgConfidence = confidenceValues.length > 0 \r\n      ? confidenceValues.reduce((sum, c) => sum + c!, 0) / confidenceValues.length\r\n      : 0;\r\n\r\n    // Risk distribution for this user\r\n    const userRiskDistribution = {\r\n      low: 0,\r\n      medium: 0,\r\n      high: 0,\r\n      unknown: 0,\r\n    };\r\n\r\n    stats.sessions.forEach(session => {\r\n      const riskLevel = session.analysisResults?.riskLevel || 'unknown';\r\n      if (riskLevel in userRiskDistribution) {\r\n        userRiskDistribution[riskLevel as keyof typeof userRiskDistribution]++;\r\n      }\r\n    });\r\n\r\n    // Depression and anxiety score distributions for this user\r\n    const userDepressionScores = {\r\n      no_to_mild: 0,\r\n      mild_to_moderate: 0,\r\n      moderate_to_severe: 0,\r\n      severe: 0,\r\n    };\r\n\r\n    const userAnxietyScores = {\r\n      no_or_minimal: 0,\r\n      mild: 0,\r\n      moderate: 0,\r\n      moderately_severe: 0,\r\n      severe: 0,\r\n    };\r\n\r\n    successfulSessions.forEach(session => {\r\n      // Handle depression scores - try multiple sources\r\n      let depressionCategory: string | null = null;\r\n      let anxietyCategory: string | null = null;\r\n\r\n      // First try prediction object for classification strings\r\n      if (session.prediction) {\r\n        const prediction = session.prediction as any;\r\n        depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n        anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n      }\r\n\r\n      // If no classification from prediction, try to categorize from numeric scores in analysisResults\r\n      if (!depressionCategory && session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n        const score = session.analysisResults.depressionScore;\r\n        // Convert numeric PHQ-9 score to categories (0-27 scale)\r\n        if (score >= 0 && score <= 4) depressionCategory = 'no_to_mild';\r\n        else if (score >= 5 && score <= 9) depressionCategory = 'mild_to_moderate';\r\n        else if (score >= 10 && score <= 14) depressionCategory = 'mild_to_moderate';\r\n        else if (score >= 15 && score <= 19) depressionCategory = 'moderate_to_severe';\r\n        else if (score >= 20) depressionCategory = 'severe';\r\n      }\r\n\r\n      if (!anxietyCategory && session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n        const score = session.analysisResults.anxietyScore;\r\n        // Convert numeric GAD-7 score to categories (0-21 scale)\r\n        if (score >= 0 && score <= 4) anxietyCategory = 'no_or_minimal';\r\n        else if (score >= 5 && score <= 9) anxietyCategory = 'mild';\r\n        else if (score >= 10 && score <= 14) anxietyCategory = 'moderate';\r\n        else if (score >= 15 && score <= 19) anxietyCategory = 'moderately_severe';\r\n        else if (score >= 20) anxietyCategory = 'severe';\r\n      }\r\n\r\n      // Count the categories for this user\r\n      if (depressionCategory && depressionCategory in userDepressionScores) {\r\n        userDepressionScores[depressionCategory as keyof typeof userDepressionScores]++;\r\n      }\r\n\r\n      if (anxietyCategory && anxietyCategory in userAnxietyScores) {\r\n        userAnxietyScores[anxietyCategory as keyof typeof userAnxietyScores]++;\r\n      }\r\n    });\r\n\r\n    // Find last activity\r\n    const lastActivity = stats.sessions.reduce((latest, session) => {\r\n      return new Date(session.updatedAt) > new Date(latest) ? session.updatedAt : latest;\r\n    }, stats.sessions[0]?.updatedAt || new Date().toISOString());\r\n\r\n    return {\r\n      userId,\r\n      totalSessions: stats.totalSessions,\r\n      successfulSessions: stats.successfulSessions,\r\n      successRate,\r\n      avgConfidence: Math.round(avgConfidence * 100) / 100,\r\n      riskDistribution: userRiskDistribution,\r\n      lastActivity,\r\n      depressionScores: userDepressionScores,\r\n      anxietyScores: userAnxietyScores,\r\n    };\r\n  }).sort((a, b) => b.totalSessions - a.totalSessions); // Sort by total sessions desc\r\n\r\n  // Calculate correlations between metadata and mental health outcomes\r\n  const correlations = {\r\n    ageDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    genderDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    raceDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    ethnicityDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    languageDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    weightDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    zipCodeDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n  };\r\n\r\n  // Helper function to determine if a session indicates depression/anxiety\r\n  const hasDepressionCase = (session: ImportedSessionData): boolean => {\r\n    // Check for moderate_to_severe or severe depression\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      const depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n      return depressionCategory === 'moderate_to_severe' || depressionCategory === 'severe';\r\n    }\r\n    // Fallback to numeric score (PHQ-9 >= 10 indicates moderate or higher depression)\r\n    if (session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n      return session.analysisResults.depressionScore >= 10;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const hasAnxietyCase = (session: ImportedSessionData): boolean => {\r\n    // Check for moderate, moderately_severe, or severe anxiety\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      const anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n      return anxietyCategory === 'moderate' || anxietyCategory === 'moderately_severe' || anxietyCategory === 'severe';\r\n    }\r\n    // Fallback to numeric score (GAD-7 >= 10 indicates moderate or higher anxiety)\r\n    if (session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n      return session.analysisResults.anxietyScore >= 10;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Process sessions with metadata\r\n  const sessionsWithMetadata = allSessions.filter(session => session.userMetadata);\r\n  \r\n  sessionsWithMetadata.forEach(session => {\r\n    const metadata = session.userMetadata!;\r\n    const hasDepression = hasDepressionCase(session);\r\n    const hasAnxiety = hasAnxietyCase(session);\r\n\r\n    // Age correlation (group by age ranges)\r\n    if (metadata.age) {\r\n      let ageGroup: string;\r\n      if (metadata.age < 25) ageGroup = '18-24';\r\n      else if (metadata.age < 35) ageGroup = '25-34';\r\n      else if (metadata.age < 45) ageGroup = '35-44';\r\n      else if (metadata.age < 55) ageGroup = '45-54';\r\n      else if (metadata.age < 65) ageGroup = '55-64';\r\n      else ageGroup = '65+';\r\n\r\n      if (!correlations.ageDistribution[ageGroup]) {\r\n        correlations.ageDistribution[ageGroup] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.ageDistribution[ageGroup].totalSessions++;\r\n      if (hasDepression) correlations.ageDistribution[ageGroup].depressionCases++;\r\n      if (hasAnxiety) correlations.ageDistribution[ageGroup].anxietyCases++;\r\n    }\r\n\r\n    // Gender correlation\r\n    if (metadata.gender) {\r\n      const gender = metadata.gender;\r\n      if (!correlations.genderDistribution[gender]) {\r\n        correlations.genderDistribution[gender] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.genderDistribution[gender].totalSessions++;\r\n      if (hasDepression) correlations.genderDistribution[gender].depressionCases++;\r\n      if (hasAnxiety) correlations.genderDistribution[gender].anxietyCases++;\r\n    }\r\n\r\n    // Race correlation\r\n    if (metadata.race) {\r\n      const race = metadata.race;\r\n      if (!correlations.raceDistribution[race]) {\r\n        correlations.raceDistribution[race] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.raceDistribution[race].totalSessions++;\r\n      if (hasDepression) correlations.raceDistribution[race].depressionCases++;\r\n      if (hasAnxiety) correlations.raceDistribution[race].anxietyCases++;\r\n    }\r\n\r\n    // Ethnicity correlation\r\n    if (metadata.ethnicity) {\r\n      const ethnicity = metadata.ethnicity;\r\n      if (!correlations.ethnicityDistribution[ethnicity]) {\r\n        correlations.ethnicityDistribution[ethnicity] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.ethnicityDistribution[ethnicity].totalSessions++;\r\n      if (hasDepression) correlations.ethnicityDistribution[ethnicity].depressionCases++;\r\n      if (hasAnxiety) correlations.ethnicityDistribution[ethnicity].anxietyCases++;\r\n    }\r\n\r\n    // Language correlation\r\n    if (metadata.language !== undefined) {\r\n      const language = metadata.language ? 'English' : 'Other';\r\n      if (!correlations.languageDistribution[language]) {\r\n        correlations.languageDistribution[language] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.languageDistribution[language].totalSessions++;\r\n      if (hasDepression) correlations.languageDistribution[language].depressionCases++;\r\n      if (hasAnxiety) correlations.languageDistribution[language].anxietyCases++;\r\n    }\r\n\r\n    // Weight correlation (group by BMI-like ranges)\r\n    if (metadata.weight) {\r\n      let weightGroup: string;\r\n      if (metadata.weight < 120) weightGroup = 'Under 120 lbs';\r\n      else if (metadata.weight < 150) weightGroup = '120-149 lbs';\r\n      else if (metadata.weight < 180) weightGroup = '150-179 lbs';\r\n      else if (metadata.weight < 220) weightGroup = '180-219 lbs';\r\n      else weightGroup = '220+ lbs';\r\n\r\n      if (!correlations.weightDistribution[weightGroup]) {\r\n        correlations.weightDistribution[weightGroup] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.weightDistribution[weightGroup].totalSessions++;\r\n      if (hasDepression) correlations.weightDistribution[weightGroup].depressionCases++;\r\n      if (hasAnxiety) correlations.weightDistribution[weightGroup].anxietyCases++;\r\n    }\r\n\r\n    // ZIP code correlation (group by region - first 2 digits for demonstration)\r\n    if (metadata.zipcode) {\r\n      const zipPrefix = metadata.zipcode.substring(0, 2);\r\n      let region: string;\r\n      // Simple US region mapping based on ZIP code prefixes\r\n      if (['0', '1', '2'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Northeast';\r\n      else if (['3', '4'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Southeast';\r\n      else if (['5', '6'].some(prefix => zipPrefix.startsWith(prefix))) region = 'South Central';\r\n      else if (['7', '8'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Mountain/West';\r\n      else if (['9'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Pacific';\r\n      else region = 'Other/International';\r\n\r\n      if (!correlations.zipCodeDistribution[region]) {\r\n        correlations.zipCodeDistribution[region] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.zipCodeDistribution[region].totalSessions++;\r\n      if (hasDepression) correlations.zipCodeDistribution[region].depressionCases++;\r\n      if (hasAnxiety) correlations.zipCodeDistribution[region].anxietyCases++;\r\n    }\r\n  });\r\n\r\n  return {\r\n    overview: {\r\n      totalSessions,\r\n      uniqueUsers,\r\n      successRate,\r\n      avgSessionsPerUser,\r\n      recentActivity,\r\n    },\r\n    sessionStatus: {\r\n      succeeded: completedSessions.length,\r\n      failed: failedSessions.length,\r\n      processing: processingSessions.length,\r\n      total: totalSessions,\r\n    },\r\n    riskLevels: {\r\n      ...riskCounts,\r\n      total: totalSessions,\r\n    },\r\n    predictions: {\r\n      depression: {\r\n        ...depressionCounts,\r\n        total: completedSessions.length,\r\n      },\r\n      anxiety: {\r\n        ...anxietyCounts,\r\n        total: completedSessions.length,\r\n      },\r\n    },\r\n    timeData,\r\n    riskDistribution: riskCounts,\r\n    userStats,\r\n    correlations,\r\n  };\r\n};\r\n\r\n// Types for chart components\r\n\r\n// Metric card component\r\nconst MetricCard: React.FC<{\r\n  title: string;\r\n  value: string | number;\r\n  subtitle?: string;\r\n  icon: React.ReactNode;\r\n  trend?: 'up' | 'down' | 'neutral';\r\n  color?: string;\r\n}> = ({ title, value, subtitle, icon, trend, color = 'text-blue-600' }) => (\r\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n    <div className=\"flex items-center justify-between\">\r\n      <div className=\"flex-1\">\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 font-medium\">{title}</p>\r\n        <p className={`text-2xl font-bold ${color} dark:text-white mt-1`}>{value}</p>\r\n        {subtitle && (\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">{subtitle}</p>\r\n        )}\r\n      </div>\r\n      <div className={`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${color}`}>\r\n        {icon}\r\n      </div>\r\n    </div>\r\n    {trend && (\r\n      <div className=\"flex items-center mt-4\">\r\n        {trend === 'up' && <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />}\r\n        {trend === 'down' && <TrendingDown className=\"h-4 w-4 text-red-500 mr-1\" />}\r\n        <span className={`text-sm ${\r\n          trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-600' : 'text-gray-500'\r\n        }`}>\r\n          {trend === 'up' ? 'Trending up' : trend === 'down' ? 'Trending down' : 'Stable'}\r\n        </span>\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n\r\n// Distribution chart component\r\nconst DistributionChart: React.FC<{\r\n  title: string;\r\n  data: Array<{ label: string; value: number; color: string }>;\r\n  total: number;\r\n}> = ({ title, data, total }) => (\r\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n    <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n    <div className=\"space-y-3\">\r\n      {data.map((item, index) => {\r\n        const percentage = getPercentage(item.value, total);\r\n        return (\r\n          <div key={index}>\r\n            <div className=\"flex justify-between text-sm mb-1\">\r\n              <span className=\"text-gray-600 dark:text-gray-400\">{item.label}</span>\r\n              <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                {item.value} ({percentage}%)\r\n              </span>\r\n            </div>\r\n            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n              <div\r\n                className={`h-2 rounded-full transition-all duration-500 ${item.color}`}\r\n                style={{ width: `${percentage}%` }}\r\n                role=\"progressbar\"\r\n                aria-label={`${item.label}: ${item.value} (${percentage}%)`}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// Time series chart component (elegant line chart)\r\nconst TimeSeriesChart: React.FC<{\r\n  title: string;\r\n  data: Array<{ date: string; count: number }>;\r\n}> = ({ title, data }) => {\r\n  const maxCount = Math.max(...data.map(d => d.count), 1);\r\n  const minCount = 0; // Start bars from zero for better visual comparison\r\n  const range = maxCount - minCount || 1;\r\n  \r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      {/* Chart Container */}\r\n      <div className=\"relative h-48\">\r\n        {/* SVG Chart */}\r\n        <svg\r\n          className=\"absolute inset-0 w-full h-full\"\r\n          viewBox=\"0 0 100 100\"\r\n          preserveAspectRatio=\"none\"\r\n        >\r\n          {/* Grid lines */}\r\n          <defs>\r\n            <pattern id=\"grid\" width=\"20\" height=\"20\" patternUnits=\"userSpaceOnUse\">\r\n              <path\r\n                d=\"M 20 0 L 0 0 0 20\"\r\n                fill=\"none\"\r\n                stroke=\"rgb(229 231 235)\"\r\n                strokeWidth=\"0.5\"\r\n                className=\"dark:stroke-gray-600\"\r\n              />\r\n            </pattern>\r\n            <linearGradient id=\"barGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n              <stop offset=\"0%\" stopColor=\"rgb(59 130 246)\" stopOpacity=\"0.8\"/>\r\n              <stop offset=\"100%\" stopColor=\"rgb(59 130 246)\" stopOpacity=\"0.6\"/>\r\n            </linearGradient>\r\n          </defs>\r\n          \r\n          {/* Grid */}\r\n          <rect width=\"100\" height=\"100\" fill=\"url(#grid)\" />\r\n          \r\n          {/* Thin Vertical Bars */}\r\n          {data.map((point, index) => {\r\n            const barWidth = 80 / data.length; // Thin bars with spacing\r\n            const x = (index / (data.length - 1)) * (100 - barWidth) + barWidth / 2;\r\n            const barHeight = ((point.count - minCount) / range) * 95; // 95% of container height\r\n            const y = 100 - barHeight;\r\n            \r\n            return (\r\n              <rect\r\n                key={index}\r\n                x={x - barWidth / 2}\r\n                y={y}\r\n                width={barWidth * 0.6} // Make bars a little thicker\r\n                height={barHeight}\r\n                fill=\"url(#barGradient)\"\r\n                stroke=\"rgb(59 130 246)\"\r\n                strokeWidth=\"0.2\"\r\n                className=\"transition-all duration-300 hover:opacity-80\"\r\n                rx=\"0.5\" // Slightly rounded corners\r\n              />\r\n            );\r\n          })}\r\n        </svg>\r\n      </div>\r\n      \r\n      {/* X-axis labels */}\r\n      <div className=\"flex items-center justify-between mt-4 px-2\">\r\n        {data.map((item, index) => {\r\n          const date = new Date(item.date);\r\n          const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });\r\n          const monthDay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n          \r\n          return (\r\n            <div key={index} className=\"text-center flex-1\">\r\n              <div className=\"text-xs font-medium text-gray-900 dark:text-white\">\r\n                {dayName}\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {monthDay}\r\n              </div>\r\n              <div className=\"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1\">\r\n                {item.count}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Metadata Correlation Chart Component\r\nconst MetadataCorrelationChart: React.FC<{\r\n  title: string;\r\n  data: Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>;\r\n  subtitle?: string;\r\n}> = ({ title, data, subtitle }) => {\r\n  const categories = Object.keys(data);\r\n  \r\n  if (categories.length === 0) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n        {subtitle && (\r\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">{subtitle}</p>\r\n        )}\r\n        <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\r\n          No metadata available for this correlation\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n      {subtitle && (\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">{subtitle}</p>\r\n      )}\r\n      \r\n      <div className=\"space-y-4\">\r\n        {categories.map((category, index) => {\r\n          const categoryData = data[category];\r\n          const depressionRate = categoryData.totalSessions > 0 \r\n            ? (categoryData.depressionCases / categoryData.totalSessions) * 100 \r\n            : 0;\r\n          const anxietyRate = categoryData.totalSessions > 0 \r\n            ? (categoryData.anxietyCases / categoryData.totalSessions) * 100 \r\n            : 0;\r\n          \r\n          return (\r\n            <div key={index} className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\r\n              <div className=\"flex justify-between items-center mb-3\">\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white\">{category}</h4>\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  {categoryData.totalSessions} sessions\r\n                </span>\r\n              </div>\r\n              \r\n              {/* Depression Bar */}\r\n              <div className=\"mb-3\">\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Depression Cases</span>\r\n                  <span className=\"text-sm font-medium text-red-600 dark:text-red-400\">\r\n                    {categoryData.depressionCases} ({depressionRate.toFixed(1)}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2\">\r\n                  <div\r\n                    className=\"h-2 bg-red-500 rounded-full transition-all duration-500\"\r\n                    style={{ width: `${depressionRate}%` }}\r\n                    role=\"progressbar\"\r\n                    aria-label={`Depression rate: ${depressionRate.toFixed(1)}%`}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Anxiety Bar */}\r\n              <div>\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Anxiety Cases</span>\r\n                  <span className=\"text-sm font-medium text-orange-600 dark:text-orange-400\">\r\n                    {categoryData.anxietyCases} ({anxietyRate.toFixed(1)}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2\">\r\n                  <div\r\n                    className=\"h-2 bg-orange-500 rounded-full transition-all duration-500\"\r\n                    style={{ width: `${anxietyRate}%` }}\r\n                    role=\"progressbar\"\r\n                    aria-label={`Anxiety rate: ${anxietyRate.toFixed(1)}%`}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Summary */}\r\n      <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n        <div className=\"grid grid-cols-2 gap-4 text-center\">\r\n          <div>\r\n            <div className=\"text-lg font-bold text-red-600 dark:text-red-400\">\r\n              {categories.reduce((sum, cat) => sum + data[cat].depressionCases, 0)}\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Total Depression Cases</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-lg font-bold text-orange-600 dark:text-orange-400\">\r\n              {categories.reduce((sum, cat) => sum + data[cat].anxietyCases, 0)}\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Total Anxiety Cases</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Depression vs Anxiety Correlation Chart\r\nconst CorrelationChart: React.FC<{\r\n  title: string;\r\n  depressionData: AnalyticsData['predictions']['depression'];\r\n  anxietyData: AnalyticsData['predictions']['anxiety'];\r\n}> = ({ title, depressionData, anxietyData }) => {\r\n  // Create correlation data points\r\n  const correlationPoints = [\r\n    { depression: depressionData.no_to_mild, anxiety: anxietyData.no_or_minimal, severity: 'Low', label: 'Minimal/None' },\r\n    { depression: depressionData.mild_to_moderate, anxiety: anxietyData.mild, severity: 'Mild', label: 'Mild' },\r\n    { depression: depressionData.moderate_to_severe, anxiety: anxietyData.moderate, severity: 'Moderate', label: 'Moderate' },\r\n    { depression: depressionData.severe, anxiety: anxietyData.moderately_severe + anxietyData.severe, severity: 'High', label: 'Severe' },\r\n  ];\r\n\r\n  const maxValue = Math.max(\r\n    ...correlationPoints.map(p => Math.max(p.depression, p.anxiety)),\r\n    10\r\n  );\r\n\r\n  const getColor = (severity: string) => {\r\n    switch (severity) {\r\n      case 'Low': return 'fill-green-500 stroke-green-600';\r\n      case 'Mild': return 'fill-yellow-500 stroke-yellow-600';\r\n      case 'Moderate': return 'fill-orange-500 stroke-orange-600';\r\n      case 'High': return 'fill-red-500 stroke-red-600';\r\n      default: return 'fill-gray-500 stroke-gray-600';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      <div className=\"relative h-[28rem]\">\r\n        <svg className=\"w-full h-full\" viewBox=\"0 0 600 350\">\r\n          {/* Grid lines */}\r\n          <defs>\r\n            <pattern id=\"correlationGrid\" width=\"50\" height=\"35\" patternUnits=\"userSpaceOnUse\">\r\n              <path\r\n                d=\"M 50 0 L 0 0 0 35\"\r\n                fill=\"none\"\r\n                stroke=\"rgb(229 231 235)\"\r\n                strokeWidth=\"0.5\"\r\n                className=\"dark:stroke-gray-600\"\r\n              />\r\n            </pattern>\r\n          </defs>\r\n          \r\n          <rect width=\"600\" height=\"350\" fill=\"url(#correlationGrid)\" />\r\n          \r\n          {/* Axes */}\r\n          <line x1=\"70\" y1=\"310\" x2=\"550\" y2=\"310\" stroke=\"rgb(107 114 128)\" strokeWidth=\"2\" />\r\n          <line x1=\"70\" y1=\"310\" x2=\"70\" y2=\"40\" stroke=\"rgb(107 114 128)\" strokeWidth=\"2\" />\r\n          \r\n          {/* Data points */}\r\n          {correlationPoints.map((point, index) => {\r\n            const x = 70 + (point.depression / maxValue) * 480;\r\n            const y = 310 - (point.anxiety / maxValue) * 270;\r\n            const radius = Math.max(Math.sqrt(point.depression + point.anxiety) * 3, 10);\r\n            \r\n            return (\r\n              <g key={index}>\r\n                <circle\r\n                  cx={x}\r\n                  cy={y}\r\n                  r={radius}\r\n                  className={`${getColor(point.severity)} opacity-70 hover:opacity-90 transition-opacity`}\r\n                  strokeWidth=\"2\"\r\n                />\r\n                <text\r\n                  x={x}\r\n                  y={y + 5}\r\n                  textAnchor=\"middle\"\r\n                  className=\"text-sm fill-white font-bold\"\r\n                >\r\n                  {point.depression + point.anxiety}\r\n                </text>\r\n              </g>\r\n            );\r\n          })}\r\n          \r\n          {/* Axis labels */}\r\n          <text x=\"310\" y=\"335\" textAnchor=\"middle\" className=\"text-sm font-medium fill-gray-700 dark:fill-gray-300\">\r\n            Depression Cases \r\n          </text>\r\n          <text x=\"40\" y=\"175\" textAnchor=\"middle\" transform=\"rotate(-90 40 175)\" className=\"text-sm font-medium fill-gray-700 dark:fill-gray-300\">\r\n             Anxiety Cases\r\n          </text>\r\n        </svg>\r\n      </div>\r\n      \r\n      {/* Legend */}\r\n      <div className=\"mt-4 flex justify-center space-x-4\">\r\n        {correlationPoints.map((point, index) => (\r\n          <div key={index} className=\"flex items-center space-x-2\">\r\n            <div className={`w-3 h-3 rounded-full ${getColor(point.severity).replace('fill-', 'bg-').replace('stroke-', 'border-').replace(' stroke-gray-600', '').replace(' stroke-green-600', '').replace(' stroke-yellow-600', '').replace(' stroke-orange-600', '').replace(' stroke-red-600', '')}`} />\r\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">{point.label}</span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Session Completion Funnel Chart\r\nconst FunnelChart: React.FC<{\r\n  title: string;\r\n  sessionStatus: AnalyticsData['sessionStatus'];\r\n}> = ({ title, sessionStatus }) => {\r\n  const stages = [\r\n    { label: 'Total Sessions', value: sessionStatus.total, color: 'bg-blue-500' },\r\n    { label: 'In Processing', value: sessionStatus.processing, color: 'bg-yellow-500' },\r\n    { label: 'Completed', value: sessionStatus.succeeded, color: 'bg-green-500' },\r\n    { label: 'Failed', value: sessionStatus.failed, color: 'bg-red-500' },\r\n  ];\r\n\r\n  const maxValue = sessionStatus.total || 1;\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      <div className=\"space-y-4\">\r\n        {stages.map((stage, index) => {\r\n          const width = (stage.value / maxValue) * 100;\r\n          const conversionRate = index > 0 ? ((stage.value / stages[0].value) * 100).toFixed(1) : '100.0';\r\n          \r\n          return (\r\n            <div key={index} className=\"relative\">\r\n              <div className=\"flex justify-between items-center mb-2\">\r\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                  {stage.label}\r\n                </span>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <span className=\"text-sm font-bold text-gray-900 dark:text-white\">\r\n                    {stage.value}\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                    ({conversionRate}%)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden\">\r\n                <div\r\n                  className={`h-full ${stage.color} transition-all duration-700 ease-out flex items-center justify-center relative`}\r\n                  style={{ width: `${width}%` }}\r\n                >\r\n                  {width > 20 && (\r\n                    <span className=\"text-xs font-medium text-white\">\r\n                      {stage.value}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Conversion arrow */}\r\n                {index < stages.length - 1 && (\r\n                  <div className=\"absolute right-2 top-1/2 transform -translate-y-1/2\">\r\n                    <svg className=\"w-4 h-4 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Summary */}\r\n      <div className=\"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n        <div className=\"grid grid-cols-2 gap-4 text-center\">\r\n          <div>\r\n            <div className=\"text-lg font-bold text-green-600 dark:text-green-400\">\r\n              {((sessionStatus.succeeded / sessionStatus.total) * 100).toFixed(1)}%\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Success Rate</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-lg font-bold text-red-600 dark:text-red-400\">\r\n              {((sessionStatus.failed / sessionStatus.total) * 100).toFixed(1)}%\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Failure Rate</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// User statistics table component\r\nconst UserStatsTable: React.FC<{\r\n  userStats: AnalyticsData['userStats'];\r\n}> = ({ userStats }) => {\r\n  const [showConfidenceModal, setShowConfidenceModal] = useState(false);\r\n  const [showRiskModal, setShowRiskModal] = useState(false);\r\n  \r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  const getRiskColor = (riskLevel: string, count: number) => {\r\n    if (count === 0) return 'text-gray-400';\r\n    switch (riskLevel) {\r\n      case 'low': return 'text-green-600';\r\n      case 'medium': return 'text-yellow-600';\r\n      case 'high': return 'text-red-600';\r\n      default: return 'text-gray-600';\r\n    }\r\n  };\r\n\r\n  // Calculate summary stats\r\n  const totalUsers = userStats.length;\r\n  const avgSessionsPerUser = totalUsers > 0 \r\n    ? Math.round(userStats.reduce((sum, u) => sum + u.totalSessions, 0) / totalUsers * 10) / 10\r\n    : 0;\r\n  const topPerformer = userStats.length > 0 \r\n    ? userStats.reduce((best, current) => \r\n        current.avgConfidence > best.avgConfidence ? current : best, userStats[0])\r\n    : null;\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 overflow-visible\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white flex items-center\">\r\n          <Users className=\"h-5 w-5 mr-2 text-blue-500\" />\r\n          Per-User Analytics\r\n        </h3>\r\n        \r\n        {/* Summary stats */}\r\n        <div className=\"flex space-x-6 text-sm\">\r\n          <div className=\"text-center\">\r\n            <div className=\"font-semibold text-gray-900 dark:text-white\">{totalUsers}</div>\r\n            <div className=\"text-gray-600 dark:text-gray-400\">Total Users</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"font-semibold text-gray-900 dark:text-white\">{avgSessionsPerUser}</div>\r\n            <div className=\"text-gray-600 dark:text-gray-400\">Avg Sessions</div>\r\n          </div>\r\n          {topPerformer && (\r\n            <div className=\"text-center\">\r\n              <div className=\"font-semibold text-blue-600\">{(topPerformer.avgConfidence * 100).toFixed(1)}%</div>\r\n              <div className=\"text-gray-600 dark:text-gray-400\">Highest Avg Confidence</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {userStats.length === 0 ? (\r\n        <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\r\n          No user data available\r\n        </p>\r\n      ) : (\r\n        <div>\r\n          {/* Risk Distribution Legend */}\r\n          <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\r\n                Risk Distribution Legend:\r\n              </span>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium\">\r\n                    L\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">Low Risk</span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium\">\r\n                    M\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">Medium Risk</span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium\">\r\n                    H\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">High Risk</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"overflow-x-auto overflow-y-visible relative\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"border-b border-gray-200 dark:border-gray-700\">\r\n                <th className=\"text-left py-3 px-2 font-medium text-gray-900 dark:text-white w-48\">\r\n                  User ID\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  Sessions\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  <div className=\"flex flex-col items-center\">\r\n                    <div className=\"flex items-center space-x-1\">\r\n                      <span>Risk Distribution</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowRiskModal(true)}\r\n                        className=\"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                        aria-label=\"Show Risk Distribution information\"\r\n                      >\r\n                        <Info className=\"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white relative\">\r\n                  <div className=\"flex flex-col items-center\">\r\n                    <div className=\"flex items-center space-x-1\">\r\n                      <span>Avg Confidence</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowConfidenceModal(true)}\r\n                        className=\"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                        aria-label=\"Show Average Confidence information\"\r\n                      >\r\n                        <Info className=\"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer\" />\r\n                      </button>\r\n                    </div>\r\n                    <span className=\"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1\">\r\n                      (Analysis accuracy 0-100%)\r\n                    </span>\r\n                  </div>\r\n                </th>\r\n                <th className=\"text-right py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  Last Activity\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {userStats.map((user, index) => (\r\n                <tr \r\n                  key={user.userId}\r\n                  className={`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${\r\n                    index % 2 === 0 ? 'bg-gray-50 dark:bg-gray-800' : 'bg-white dark:bg-gray-900'\r\n                  }`}\r\n                >\r\n                  <td className=\"py-3 px-2\">\r\n                    <div className=\"font-mono text-sm text-gray-900 dark:text-white\">\r\n                      <div className=\"truncate max-w-[200px]\" title={user.userId}>\r\n                        {user.userId}\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {user.totalSessions}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                      {user.successfulSessions} successful\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"flex justify-center space-x-2 text-xs\">\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('low', user.riskDistribution.low)}`}>\r\n                        L:{user.riskDistribution.low}\r\n                      </span>\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('medium', user.riskDistribution.medium)}`}>\r\n                        M:{user.riskDistribution.medium}\r\n                      </span>\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('high', user.riskDistribution.high)}`}>\r\n                        H:{user.riskDistribution.high}\r\n                      </span>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {(user.avgConfidence * 100).toFixed(1)}%\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-right\">\r\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                      {formatDate(user.lastActivity)}\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Average Confidence Modal */}\r\n      {showConfidenceModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowConfidenceModal(false)}>\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Average Confidence Information</h3>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowConfidenceModal(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                aria-label=\"Close modal\"\r\n              >\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-3 text-sm text-gray-700 dark:text-gray-300\">\r\n              <div className=\"font-medium text-center text-gray-900 dark:text-white mb-3\">Average Confidence Calculation:</div>\r\n              <div className=\"space-y-2\">\r\n                <div> Calculated from AI model confidence scores</div>\r\n                <div> Averaged across all successful sessions per user</div>\r\n                <div> Related to risk distribution/evaluation accuracy</div>\r\n                <div> Higher values indicate more reliable assessments</div>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600\">\r\n                Analysis accuracy range: 0-100%\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Risk Distribution Modal */}\r\n      {showRiskModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowRiskModal(false)}>\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Risk Distribution Information</h3>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowRiskModal(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                aria-label=\"Close modal\"\r\n              >\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-3 text-sm text-gray-700 dark:text-gray-300\">\r\n              <div className=\"font-medium text-center text-gray-900 dark:text-white mb-3\">Risk Distribution Explanation:</div>\r\n              <div className=\"space-y-2\">\r\n                <div> Shows the distribution of risk levels across all user sessions</div>\r\n                <div> Visualized as colored dots representing risk categories</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-green-500 rounded-full mr-1\"></span>Low Risk: Minimal behavioral health concerns</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>Medium Risk: Moderate concerns requiring attention</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-red-500 rounded-full mr-1\"></span>High Risk: Significant concerns requiring intervention</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-gray-400 rounded-full mr-1\"></span>Unknown: Risk level could not be determined</div>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600\">\r\n                Analysis accuracy: 0-100% (higher confidence = more reliable risk assessment)\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const ControlPanel: React.FC = () => {\r\n  const [analytics, setAnalytics] = useState<AnalyticsData | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [lastRefresh, setLastRefresh] = useState<Date>(new Date());\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Get refresh interval from environment variable (default to 69 seconds)\r\n  const refreshInterval = parseInt(import.meta.env.VITE_CONTROL_PANEL_REFRESH_INTERVAL || '69') * 1000;\r\n\r\n  // Load all sessions data for analytics\r\n  const loadAnalytics = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Get all sessions from all users for system-wide analytics\r\n      let allSessions: ImportedSessionData[] = [];\r\n      \r\n      try {\r\n        // Add cache-busting timestamp to ensure fresh data\r\n        const timestamp = Date.now();\r\n        console.log(' ControlPanel: Fetching data with cache-buster:', timestamp);\r\n        \r\n        const allSessionsResponse = await apiService.getAllSessions();\r\n        allSessions = allSessionsResponse.sessions;\r\n        console.log(' ControlPanel: Fetched sessions data:', {\r\n          timestamp,\r\n          totalCount: allSessions.length,\r\n          responseCount: allSessionsResponse.count,\r\n          firstFewSessions: allSessions.slice(0, 3).map(s => ({\r\n            sessionId: s.sessionId,\r\n            userId: s.userId,\r\n            status: s.status,\r\n            createdAt: s.createdAt\r\n          }))\r\n        });\r\n      } catch (apiError) {\r\n        console.warn('getAllSessions endpoint not available:', apiError);\r\n        \r\n        // No fallback data - show empty state when API is unavailable\r\n        allSessions = [];\r\n      }\r\n      \r\n      const aggregatedData = aggregateSessionData(allSessions);\r\n      console.log(' ControlPanel: Aggregated analytics:', {\r\n        totalSessions: aggregatedData.overview.totalSessions,\r\n        uniqueUsers: aggregatedData.overview.uniqueUsers,\r\n        successRate: aggregatedData.overview.successRate,\r\n        sessionStatusBreakdown: aggregatedData.sessionStatus\r\n      });\r\n      setAnalytics(aggregatedData);\r\n      setLastRefresh(new Date());\r\n      \r\n      announceToScreenReader('Control panel data loaded successfully');\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading control panel data: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Load data on component mount\r\n  useEffect(() => {\r\n    loadAnalytics();\r\n  }, [loadAnalytics]);\r\n\r\n  // Auto-refresh data at specified interval\r\n  useEffect(() => {\r\n    console.log(' ControlPanel: Setting up auto-refresh with interval:', refreshInterval / 1000, 'seconds');\r\n    \r\n    const interval = setInterval(() => {\r\n      console.log(' ControlPanel: Auto-refresh triggered, loading state:', loading);\r\n      // Remove loading check to ensure refresh happens\r\n      loadAnalytics();\r\n    }, refreshInterval);\r\n\r\n    return () => {\r\n      console.log(' ControlPanel: Cleaning up auto-refresh interval');\r\n      clearInterval(interval);\r\n    }; // Cleanup on unmount\r\n  }, [loadAnalytics, refreshInterval]); // Keep loadAnalytics in dependencies but remove loading\r\n\r\n  // Retry error handler\r\n  const handleRetry = useCallback(() => {\r\n    setError(null);\r\n    loadAnalytics();\r\n  }, [loadAnalytics]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <RefreshCw className=\"h-6 w-6 animate-spin text-blue-500\" />\r\n              <span className=\"text-lg text-gray-600 dark:text-gray-300\">\r\n                Loading control panel data...\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n              <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\r\n                Error Loading Control Panel\r\n              </h2>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\r\n                {error.message}\r\n              </p>\r\n              <button\r\n                onClick={handleRetry}\r\n                className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n              >\r\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                Retry\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!analytics) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <span className=\"text-lg text-gray-600 dark:text-gray-300\">\r\n              No data available\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n                Summary\r\n              </h1>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mt-2\">\r\n                System-wide analytics and insights from all users and sessions\r\n              </p>\r\n            </div>\r\n            \r\n            {/* Auto-refresh status and controls */}\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"text-right\">\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  Last updated: {lastRefresh.toLocaleTimeString()}\r\n                </div>\r\n                <div className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                  Auto-refresh: {refreshInterval / 1000}s intervals\r\n                </div>\r\n              </div>\r\n              <div className=\"flex space-x-2\">\r\n                <button\r\n                  onClick={loadAnalytics}\r\n                  disabled={loading}\r\n                  className=\"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm\"\r\n                  aria-label=\"Refresh control panel data\"\r\n                >\r\n                  <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                  Refresh\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Overview Metrics */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\r\n          <MetricCard\r\n            title=\"Total Sessions\"\r\n            value={analytics.overview.totalSessions}\r\n            subtitle=\"All time\"\r\n            icon={<Activity className=\"h-6 w-6\" />}\r\n            color=\"text-blue-600\"\r\n          />\r\n          <MetricCard\r\n            title=\"Unique Users\"\r\n            value={analytics.overview.uniqueUsers}\r\n            subtitle=\"Active users\"\r\n            icon={<Users className=\"h-6 w-6\" />}\r\n            color=\"text-green-600\"\r\n          />\r\n        </div>\r\n\r\n        {/* Charts Grid */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Risk Level Distribution */}\r\n          <div className=\"lg:col-span-2\">\r\n            <DistributionChart\r\n              title=\"Risk Level Distribution\"\r\n              data={[\r\n                { label: 'Low Risk', value: analytics.riskLevels.low, color: 'bg-green-500' },\r\n                { label: 'Medium Risk', value: analytics.riskLevels.medium, color: 'bg-yellow-500' },\r\n                { label: 'High Risk', value: analytics.riskLevels.high, color: 'bg-red-500' },\r\n                { label: 'Unknown', value: analytics.riskLevels.unknown, color: 'bg-gray-500' },\r\n              ]}\r\n              total={analytics.riskLevels.total}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Prediction Distribution */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Depression Score Distribution */}\r\n          <DistributionChart\r\n            title=\"Depression Score Distribution\"\r\n            data={[\r\n              { label: 'No to Mild', value: analytics.predictions.depression.no_to_mild, color: 'bg-green-500' },\r\n              { label: 'Mild to Moderate', value: analytics.predictions.depression.mild_to_moderate, color: 'bg-yellow-500' },\r\n              { label: 'Moderate to Severe', value: analytics.predictions.depression.moderate_to_severe, color: 'bg-orange-500' },\r\n              { label: 'Severe', value: analytics.predictions.depression.severe, color: 'bg-red-500' },\r\n            ]}\r\n            total={analytics.predictions.depression.total}\r\n          />\r\n\r\n          {/* Anxiety Score Distribution */}\r\n          <DistributionChart\r\n            title=\"Anxiety Score Distribution\"\r\n            data={[\r\n              { label: 'No or Minimal', value: analytics.predictions.anxiety.no_or_minimal, color: 'bg-green-500' },\r\n              { label: 'Mild', value: analytics.predictions.anxiety.mild, color: 'bg-yellow-500' },\r\n              { label: 'Moderate', value: analytics.predictions.anxiety.moderate, color: 'bg-orange-500' },\r\n              { label: 'Moderately Severe', value: analytics.predictions.anxiety.moderately_severe, color: 'bg-red-500' },\r\n              { label: 'Severe', value: analytics.predictions.anxiety.severe, color: 'bg-red-700' },\r\n            ]}\r\n            total={analytics.predictions.anxiety.total}\r\n          />\r\n        </div>\r\n\r\n        {/* Per-User Statistics */}\r\n        <div className=\"mb-8\">\r\n          <UserStatsTable userStats={analytics.userStats} />\r\n        </div>\r\n\r\n        {/* Metadata Correlation Analysis */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"mb-6\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\r\n              Demographic Correlation Analysis\r\n            </h2>\r\n            <p className=\"text-gray-600 dark:text-gray-400\">\r\n              Correlation between patient demographics and mental health outcomes (Depression & Anxiety cases)\r\n            </p>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Depression vs Anxiety Correlation - Featured First */}\r\n            <div className=\"lg:col-span-2\">\r\n              <CorrelationChart\r\n                title=\"Depression vs Anxiety Correlation\"\r\n                depressionData={analytics.predictions.depression}\r\n                anxietyData={analytics.predictions.anxiety}\r\n              />\r\n            </div>\r\n            \r\n            {/* Age Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Age Groups vs Mental Health Cases\"\r\n              subtitle=\"Distribution by age ranges showing depression and anxiety case rates\"\r\n              data={analytics.correlations.ageDistribution}\r\n            />\r\n            \r\n            {/* Gender Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Gender vs Mental Health Cases\"\r\n              subtitle=\"Distribution by gender identity showing case rates\"\r\n              data={analytics.correlations.genderDistribution}\r\n            />\r\n            \r\n            {/* Weight Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Weight Groups vs Mental Health Cases\"\r\n              subtitle=\"Distribution by weight ranges showing case rates\"\r\n              data={analytics.correlations.weightDistribution}\r\n            />\r\n            \r\n            {/* Race Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Race vs Mental Health Cases\"\r\n              subtitle=\"Distribution by racial identity showing case rates\"\r\n              data={analytics.correlations.raceDistribution}\r\n            />\r\n            \r\n            {/* Ethnicity Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Ethnicity vs Mental Health Cases\"\r\n              subtitle=\"Distribution by ethnic background showing case rates\"\r\n              data={analytics.correlations.ethnicityDistribution}\r\n            />\r\n            \r\n            {/* Language Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Primary Language vs Mental Health Cases\"\r\n              subtitle=\"Distribution by language preference showing case rates\"\r\n              data={analytics.correlations.languageDistribution}\r\n            />\r\n            \r\n            {/* Geographic Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Geographic Region vs Mental Health Cases\"\r\n              subtitle=\"Distribution by ZIP code regions showing case rates\"\r\n              data={analytics.correlations.zipCodeDistribution}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Session Analytics */}\r\n        <div className=\"mb-8\">\r\n          <FunnelChart\r\n            title=\"Session Completion Funnel\"\r\n            sessionStatus={analytics.sessionStatus}\r\n          />\r\n        </div>\r\n\r\n        {/* Sessions Over Time - Full Width */}\r\n        <div className=\"mb-8\">\r\n          <TimeSeriesChart\r\n            title=\"Sessions Over Time (7 Days)\"\r\n            data={analytics.timeData}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ControlPanel;","import { EventEmitter } from 'events';\r\n\r\nexport interface SpeechConfig {\r\n  language: string;\r\n  continuous: boolean;\r\n  interimResults: boolean;\r\n  maxAlternatives: number;\r\n  audioTracks: boolean;\r\n  noiseReduction: boolean;\r\n  echoCancellation: boolean;\r\n}\r\n\r\nexport interface SpeechResult {\r\n  transcript: string;\r\n  confidence: number;\r\n  isFinal: boolean;\r\n  alternatives?: string[];\r\n}\r\n\r\nexport interface VoiceActivityEvent {\r\n  isActive: boolean;\r\n  volume: number;\r\n  timestamp: number;\r\n}\r\n\r\nexport class AdvancedSpeechService extends EventEmitter {\r\n  private recognition: any = null;\r\n  private synthesis: SpeechSynthesis | null = null;\r\n  private audioContext: AudioContext | null = null;\r\n  private microphone: MediaStreamAudioSourceNode | null = null;\r\n  private analyzer: AnalyserNode | null = null;\r\n  private vadProcessor: ScriptProcessorNode | null = null;\r\n  private stream: MediaStream | null = null;\r\n  \r\n  private isListening = false;\r\n  private isVADActive = false;\r\n  private silenceTimeout: NodeJS.Timeout | null = null;\r\n  private speechTimeout: NodeJS.Timeout | null = null;\r\n  \r\n  private config: SpeechConfig = {\r\n    language: 'en-US',\r\n    continuous: true,\r\n    interimResults: true,\r\n    maxAlternatives: 3,\r\n    audioTracks: true,\r\n    noiseReduction: true,\r\n    echoCancellation: true\r\n  };\r\n\r\n  constructor(config?: Partial<SpeechConfig>) {\r\n    super();\r\n    this.config = { ...this.config, ...config };\r\n    this.initializeServices();\r\n  }\r\n\r\n  private async initializeServices(): Promise<void> {\r\n    try {\r\n      // Initialize Speech Recognition\r\n      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\r\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n        this.recognition = new SpeechRecognition();\r\n        this.setupSpeechRecognition();\r\n      }\r\n\r\n      // Initialize Speech Synthesis\r\n      if ('speechSynthesis' in window) {\r\n        this.synthesis = window.speechSynthesis;\r\n      }\r\n\r\n      // Initialize Audio Context for VAD\r\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      \r\n      this.emit('initialized', {\r\n        speechRecognition: !!this.recognition,\r\n        speechSynthesis: !!this.synthesis,\r\n        voiceActivityDetection: !!this.audioContext\r\n      });\r\n    } catch (error) {\r\n      console.error('Error initializing speech services:', error);\r\n      this.emit('error', { type: 'initialization', error });\r\n    }\r\n  }\r\n\r\n  private setupSpeechRecognition(): void {\r\n    if (!this.recognition) return;\r\n\r\n    this.recognition.continuous = this.config.continuous;\r\n    this.recognition.interimResults = this.config.interimResults;\r\n    this.recognition.lang = this.config.language;\r\n    this.recognition.maxAlternatives = this.config.maxAlternatives;\r\n\r\n    this.recognition.onstart = () => {\r\n      this.isListening = true;\r\n      this.emit('listening', { started: true });\r\n    };\r\n\r\n    this.recognition.onresult = (event: any) => {\r\n      const results: SpeechResult[] = [];\r\n      \r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        const transcript = result[0].transcript;\r\n        const confidence = result[0].confidence;\r\n        const isFinal = result.isFinal;\r\n        \r\n        const alternatives = [];\r\n        for (let j = 1; j < result.length && j < this.config.maxAlternatives; j++) {\r\n          alternatives.push(result[j].transcript);\r\n        }\r\n\r\n        results.push({\r\n          transcript,\r\n          confidence,\r\n          isFinal,\r\n          alternatives\r\n        });\r\n      }\r\n\r\n      this.emit('result', { results });\r\n      \r\n      // Handle final results\r\n      const finalResults = results.filter(r => r.isFinal);\r\n      if (finalResults.length > 0) {\r\n        this.emit('finalResult', { results: finalResults });\r\n      }\r\n    };\r\n\r\n    this.recognition.onerror = (event: any) => {\r\n      console.error('Speech recognition error:', event.error);\r\n      this.emit('error', { type: 'recognition', error: event.error });\r\n      \r\n      // Auto-restart on certain errors\r\n      if (event.error === 'no-speech' || event.error === 'audio-capture') {\r\n        setTimeout(() => this.restartRecognition(), 1000);\r\n      }\r\n    };\r\n\r\n    this.recognition.onend = () => {\r\n      this.isListening = false;\r\n      this.emit('listening', { started: false });\r\n      \r\n      // Auto-restart if continuous mode is enabled\r\n      if (this.config.continuous && this.isVADActive) {\r\n        setTimeout(() => this.startListening(), 100);\r\n      }\r\n    };\r\n  }\r\n\r\n  private async setupVoiceActivityDetection(): Promise<void> {\r\n    try {\r\n      if (!this.audioContext) {\r\n        throw new Error('AudioContext not available');\r\n      }\r\n\r\n      // Request microphone access with enhanced constraints\r\n      this.stream = await navigator.mediaDevices.getUserMedia({\r\n        audio: {\r\n          echoCancellation: this.config.echoCancellation,\r\n          noiseSuppression: this.config.noiseReduction,\r\n          autoGainControl: true,\r\n          sampleRate: 16000,\r\n          channelCount: 1\r\n        }\r\n      });\r\n\r\n      // Create audio nodes\r\n      this.microphone = this.audioContext.createMediaStreamSource(this.stream);\r\n      this.analyzer = this.audioContext.createAnalyser();\r\n      this.vadProcessor = this.audioContext.createScriptProcessor(2048, 1, 1);\r\n\r\n      // Configure analyzer\r\n      this.analyzer.fftSize = 256;\r\n      this.analyzer.smoothingTimeConstant = 0.8;\r\n\r\n      // Connect audio nodes\r\n      this.microphone.connect(this.analyzer);\r\n      this.analyzer.connect(this.vadProcessor);\r\n      this.vadProcessor.connect(this.audioContext.destination);\r\n\r\n      // Set up VAD processing\r\n      this.vadProcessor.onaudioprocess = (event) => {\r\n        this.processVAD(event);\r\n      };\r\n\r\n      this.emit('vadReady');\r\n    } catch (error) {\r\n      console.error('Error setting up VAD:', error);\r\n      this.emit('error', { type: 'vad', error });\r\n    }\r\n  }\r\n\r\n  private processVAD(_event: AudioProcessingEvent): void {\r\n    if (!this.analyzer) return;\r\n\r\n    const bufferLength = this.analyzer.frequencyBinCount;\r\n    const dataArray = new Uint8Array(bufferLength);\r\n    this.analyzer.getByteFrequencyData(dataArray);\r\n\r\n    // Calculate volume and voice activity\r\n    let sum = 0;\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      sum += dataArray[i];\r\n    }\r\n    const volume = sum / bufferLength;\r\n    \r\n    // Voice activity threshold (adjustable)\r\n    const threshold = 30;\r\n    const isVoiceActive = volume > threshold;\r\n\r\n    this.emit('voiceActivity', {\r\n      isActive: isVoiceActive,\r\n      volume,\r\n      timestamp: Date.now()\r\n    } as VoiceActivityEvent);\r\n\r\n    // Handle speech/silence timeouts\r\n    if (isVoiceActive) {\r\n      if (this.silenceTimeout) {\r\n        clearTimeout(this.silenceTimeout);\r\n        this.silenceTimeout = null;\r\n      }\r\n      \r\n      if (!this.speechTimeout) {\r\n        this.speechTimeout = setTimeout(() => {\r\n          this.emit('speechStart');\r\n        }, 200); // 200ms of continuous speech\r\n      }\r\n    } else {\r\n      if (this.speechTimeout) {\r\n        clearTimeout(this.speechTimeout);\r\n        this.speechTimeout = null;\r\n      }\r\n      \r\n      if (!this.silenceTimeout) {\r\n        this.silenceTimeout = setTimeout(() => {\r\n          this.emit('speechEnd');\r\n        }, 1500); // 1.5s of silence\r\n      }\r\n    }\r\n  }\r\n\r\n  public async startListening(): Promise<void> {\r\n    try {\r\n      if (!this.recognition) {\r\n        throw new Error('Speech recognition not available');\r\n      }\r\n\r\n      if (!this.isVADActive) {\r\n        await this.setupVoiceActivityDetection();\r\n        this.isVADActive = true;\r\n      }\r\n\r\n      if (!this.isListening) {\r\n        this.recognition.start();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error starting speech recognition:', error);\r\n      this.emit('error', { type: 'start', error });\r\n    }\r\n  }\r\n\r\n  public stopListening(): void {\r\n    try {\r\n      if (this.recognition && this.isListening) {\r\n        this.recognition.stop();\r\n      }\r\n\r\n      this.isVADActive = false;\r\n      \r\n      // Clean up VAD resources\r\n      if (this.vadProcessor) {\r\n        this.vadProcessor.disconnect();\r\n      }\r\n      if (this.analyzer) {\r\n        this.analyzer.disconnect();\r\n      }\r\n      if (this.microphone) {\r\n        this.microphone.disconnect();\r\n      }\r\n      if (this.stream) {\r\n        this.stream.getTracks().forEach(track => track.stop());\r\n        this.stream = null;\r\n      }\r\n\r\n      // Clear timeouts\r\n      if (this.silenceTimeout) {\r\n        clearTimeout(this.silenceTimeout);\r\n        this.silenceTimeout = null;\r\n      }\r\n      if (this.speechTimeout) {\r\n        clearTimeout(this.speechTimeout);\r\n        this.speechTimeout = null;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error stopping speech recognition:', error);\r\n      this.emit('error', { type: 'stop', error });\r\n    }\r\n  }\r\n\r\n  private restartRecognition(): void {\r\n    if (this.isVADActive) {\r\n      this.stopListening();\r\n      setTimeout(() => this.startListening(), 500);\r\n    }\r\n  }\r\n\r\n  public async speak(text: string, options?: {\r\n    rate?: number;\r\n    pitch?: number;\r\n    volume?: number;\r\n    voice?: SpeechSynthesisVoice;\r\n    interrupt?: boolean;\r\n  }): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this.synthesis) {\r\n        reject(new Error('Speech synthesis not available'));\r\n        return;\r\n      }\r\n\r\n      if (options?.interrupt) {\r\n        this.synthesis.cancel();\r\n      }\r\n\r\n      const utterance = new SpeechSynthesisUtterance(text);\r\n      utterance.rate = options?.rate || 0.9;\r\n      utterance.pitch = options?.pitch || 1.0;\r\n      utterance.volume = options?.volume || 0.8;\r\n      \r\n      if (options?.voice) {\r\n        utterance.voice = options.voice;\r\n      }\r\n\r\n      utterance.onend = () => {\r\n        this.emit('speechEnd', { text });\r\n        resolve();\r\n      };\r\n\r\n      utterance.onerror = (event) => {\r\n        this.emit('error', { type: 'synthesis', error: event.error });\r\n        reject(new Error(`Speech synthesis error: ${event.error}`));\r\n      };\r\n\r\n      utterance.onstart = () => {\r\n        this.emit('speechStart', { text });\r\n      };\r\n\r\n      this.synthesis.speak(utterance);\r\n    });\r\n  }\r\n\r\n  public getAvailableVoices(): SpeechSynthesisVoice[] {\r\n    if (!this.synthesis) return [];\r\n    return this.synthesis.getVoices();\r\n  }\r\n\r\n  public updateConfig(newConfig: Partial<SpeechConfig>): void {\r\n    this.config = { ...this.config, ...newConfig };\r\n    \r\n    if (this.recognition) {\r\n      this.recognition.continuous = this.config.continuous;\r\n      this.recognition.interimResults = this.config.interimResults;\r\n      this.recognition.lang = this.config.language;\r\n      this.recognition.maxAlternatives = this.config.maxAlternatives;\r\n    }\r\n  }\r\n\r\n  public isAvailable(): boolean {\r\n    return !!(this.recognition && this.synthesis);\r\n  }\r\n\r\n  public isCurrentlyListening(): boolean {\r\n    return this.isListening;\r\n  }\r\n\r\n  public destroy(): void {\r\n    this.stopListening();\r\n    \r\n    if (this.audioContext && this.audioContext.state !== 'closed') {\r\n      this.audioContext.close();\r\n    }\r\n    \r\n    this.removeAllListeners();\r\n  }\r\n}","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { AdvancedSpeechService, SpeechResult, VoiceActivityEvent, SpeechConfig } from '@/services/speechService';\r\n\r\nexport interface UseSpeechOptions {\r\n  config?: Partial<SpeechConfig>;\r\n  autoStart?: boolean;\r\n  onResult?: (results: SpeechResult[]) => void;\r\n  onFinalResult?: (results: SpeechResult[]) => void;\r\n  onVoiceActivity?: (event: VoiceActivityEvent) => void;\r\n  onSpeechStart?: () => void;\r\n  onSpeechEnd?: () => void;\r\n  onError?: (error: any) => void;\r\n}\r\n\r\nexport interface UseSpeechReturn {\r\n  // State\r\n  isListening: boolean;\r\n  isAvailable: boolean;\r\n  isVoiceActive: boolean;\r\n  volume: number;\r\n  \r\n  // Controls\r\n  startListening: () => Promise<void>;\r\n  stopListening: () => void;\r\n  speak: (text: string, options?: any) => Promise<void>;\r\n  \r\n  // Configuration\r\n  updateConfig: (config: Partial<SpeechConfig>) => void;\r\n  availableVoices: SpeechSynthesisVoice[];\r\n  \r\n  // Status\r\n  error: string | null;\r\n  isInitialized: boolean;\r\n}\r\n\r\nexport const useSpeech = (options: UseSpeechOptions = {}): UseSpeechReturn => {\r\n  const serviceRef = useRef<AdvancedSpeechService | null>(null);\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [isAvailable, setIsAvailable] = useState(false);\r\n  const [isVoiceActive, setIsVoiceActive] = useState(false);\r\n  const [volume, setVolume] = useState(0);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [availableVoices, setAvailableVoices] = useState<SpeechSynthesisVoice[]>([]);\r\n\r\n  // Initialize speech service\r\n  useEffect(() => {\r\n    serviceRef.current = new AdvancedSpeechService(options.config);\r\n    \r\n    const service = serviceRef.current;\r\n\r\n    // Set up event listeners\r\n    service.on('initialized', (capabilities) => {\r\n      setIsAvailable(capabilities.speechRecognition && capabilities.speechSynthesis);\r\n      setIsInitialized(true);\r\n      setAvailableVoices(service.getAvailableVoices());\r\n    });\r\n\r\n    service.on('listening', ({ started }) => {\r\n      setIsListening(started);\r\n    });\r\n\r\n    service.on('result', ({ results }) => {\r\n      options.onResult?.(results);\r\n    });\r\n\r\n    service.on('finalResult', ({ results }) => {\r\n      options.onFinalResult?.(results);\r\n    });\r\n\r\n    service.on('voiceActivity', (event: VoiceActivityEvent) => {\r\n      setIsVoiceActive(event.isActive);\r\n      setVolume(event.volume);\r\n      options.onVoiceActivity?.(event);\r\n    });\r\n\r\n    service.on('speechStart', () => {\r\n      options.onSpeechStart?.();\r\n    });\r\n\r\n    service.on('speechEnd', () => {\r\n      options.onSpeechEnd?.();\r\n    });\r\n\r\n    service.on('error', ({ type, error: serviceError }) => {\r\n      const errorMessage = `Speech ${type} error: ${serviceError}`;\r\n      setError(errorMessage);\r\n      options.onError?.({ type, error: serviceError });\r\n      console.error(errorMessage);\r\n    });\r\n\r\n    // Auto-start if requested\r\n    if (options.autoStart) {\r\n      service.startListening().catch(console.error);\r\n    }\r\n\r\n    // Cleanup\r\n    return () => {\r\n      service.destroy();\r\n    };\r\n  }, []); // Only run once on mount\r\n\r\n  const startListening = useCallback(async () => {\r\n    try {\r\n      setError(null);\r\n      if (serviceRef.current) {\r\n        await serviceRef.current.startListening();\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to start listening';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const stopListening = useCallback(() => {\r\n    try {\r\n      setError(null);\r\n      if (serviceRef.current) {\r\n        serviceRef.current.stopListening();\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to stop listening';\r\n      setError(errorMessage);\r\n    }\r\n  }, []);\r\n\r\n  const speak = useCallback(async (text: string, speakOptions?: any) => {\r\n    try {\r\n      setError(null);\r\n      if (serviceRef.current) {\r\n        await serviceRef.current.speak(text, speakOptions);\r\n      }\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to speak';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const updateConfig = useCallback((config: Partial<SpeechConfig>) => {\r\n    if (serviceRef.current) {\r\n      serviceRef.current.updateConfig(config);\r\n    }\r\n  }, []);\r\n\r\n  // Update available voices when they change\r\n  useEffect(() => {\r\n    if (isInitialized && serviceRef.current) {\r\n      const updateVoices = () => {\r\n        setAvailableVoices(serviceRef.current!.getAvailableVoices());\r\n      };\r\n\r\n      // Update voices initially and when they change\r\n      updateVoices();\r\n      \r\n      if ('speechSynthesis' in window) {\r\n        window.speechSynthesis.addEventListener('voiceschanged', updateVoices);\r\n        return () => {\r\n          window.speechSynthesis.removeEventListener('voiceschanged', updateVoices);\r\n        };\r\n      }\r\n    }\r\n  }, [isInitialized]);\r\n\r\n  return {\r\n    // State\r\n    isListening,\r\n    isAvailable,\r\n    isVoiceActive,\r\n    volume,\r\n    \r\n    // Controls\r\n    startListening,\r\n    stopListening,\r\n    speak,\r\n    \r\n    // Configuration\r\n    updateConfig,\r\n    availableVoices,\r\n    \r\n    // Status\r\n    error,\r\n    isInitialized\r\n  };\r\n};","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Error thrown when an HTTP request fails. */\r\nexport class HttpError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.HttpError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     * @param {number} statusCode The HTTP status code represented by this error.\r\n     */\r\n    constructor(errorMessage, statusCode) {\r\n        const trueProto = new.target.prototype;\r\n        super(`${errorMessage}: Status code '${statusCode}'`);\r\n        this.statusCode = statusCode;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when a timeout elapses. */\r\nexport class TimeoutError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.TimeoutError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage = \"A timeout occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when an action is aborted. */\r\nexport class AbortError extends Error {\r\n    /** Constructs a new instance of {@link AbortError}.\r\n     *\r\n     * @param {string} errorMessage A descriptive error message.\r\n     */\r\n    constructor(errorMessage = \"An abort occurred.\") {\r\n        const trueProto = new.target.prototype;\r\n        super(errorMessage);\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport is unsupported by the browser. */\r\n/** @private */\r\nexport class UnsupportedTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.UnsupportedTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'UnsupportedTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport is disabled by the browser. */\r\n/** @private */\r\nexport class DisabledTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.DisabledTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'DisabledTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the selected transport cannot be started. */\r\n/** @private */\r\nexport class FailedToStartTransportError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToStartTransportError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {HttpTransportType} transport The {@link @microsoft/signalr.HttpTransportType} this error occurred on.\r\n     */\r\n    constructor(message, transport) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.transport = transport;\r\n        this.errorType = 'FailedToStartTransportError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when the negotiation with the server failed to complete. */\r\n/** @private */\r\nexport class FailedToNegotiateWithServerError extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.FailedToNegotiateWithServerError}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     */\r\n    constructor(message) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.errorType = 'FailedToNegotiateWithServerError';\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n/** Error thrown when multiple errors have occurred. */\r\n/** @private */\r\nexport class AggregateErrors extends Error {\r\n    /** Constructs a new instance of {@link @microsoft/signalr.AggregateErrors}.\r\n     *\r\n     * @param {string} message A descriptive error message.\r\n     * @param {Error[]} innerErrors The collection of errors this error is aggregating.\r\n     */\r\n    constructor(message, innerErrors) {\r\n        const trueProto = new.target.prototype;\r\n        super(message);\r\n        this.innerErrors = innerErrors;\r\n        // Workaround issue in Typescript compiler\r\n        // https://github.com/Microsoft/TypeScript/issues/13965#issuecomment-278570200\r\n        this.__proto__ = trueProto;\r\n    }\r\n}\r\n//# sourceMappingURL=Errors.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Represents an HTTP response. */\r\nexport class HttpResponse {\r\n    constructor(statusCode, statusText, content) {\r\n        this.statusCode = statusCode;\r\n        this.statusText = statusText;\r\n        this.content = content;\r\n    }\r\n}\r\n/** Abstraction over an HTTP client.\r\n *\r\n * This class provides an abstraction over an HTTP client so that a different implementation can be provided on different platforms.\r\n */\r\nexport class HttpClient {\r\n    get(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"GET\",\r\n            url,\r\n        });\r\n    }\r\n    post(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"POST\",\r\n            url,\r\n        });\r\n    }\r\n    delete(url, options) {\r\n        return this.send({\r\n            ...options,\r\n            method: \"DELETE\",\r\n            url,\r\n        });\r\n    }\r\n    /** Gets all cookies that apply to the specified URL.\r\n     *\r\n     * @param url The URL that the cookies are valid for.\r\n     * @returns {string} A string containing all the key-value cookie pairs for the specified URL.\r\n     */\r\n    // @ts-ignore\r\n    getCookieString(url) {\r\n        return \"\";\r\n    }\r\n}\r\n//# sourceMappingURL=HttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// These values are designed to match the ASP.NET Log Levels since that's the pattern we're emulating here.\r\n/** Indicates the severity of a log message.\r\n *\r\n * Log Levels are ordered in increasing severity. So `Debug` is more severe than `Trace`, etc.\r\n */\r\nexport var LogLevel;\r\n(function (LogLevel) {\r\n    /** Log level for very low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Trace\"] = 0] = \"Trace\";\r\n    /** Log level for low severity diagnostic messages. */\r\n    LogLevel[LogLevel[\"Debug\"] = 1] = \"Debug\";\r\n    /** Log level for informational diagnostic messages. */\r\n    LogLevel[LogLevel[\"Information\"] = 2] = \"Information\";\r\n    /** Log level for diagnostic messages that indicate a non-fatal problem. */\r\n    LogLevel[LogLevel[\"Warning\"] = 3] = \"Warning\";\r\n    /** Log level for diagnostic messages that indicate a failure in the current operation. */\r\n    LogLevel[LogLevel[\"Error\"] = 4] = \"Error\";\r\n    /** Log level for diagnostic messages that indicate a failure that will terminate the entire application. */\r\n    LogLevel[LogLevel[\"Critical\"] = 5] = \"Critical\";\r\n    /** The highest possible log level. Used when configuring logging to indicate that no log messages should be emitted. */\r\n    LogLevel[LogLevel[\"None\"] = 6] = \"None\";\r\n})(LogLevel || (LogLevel = {}));\r\n//# sourceMappingURL=ILogger.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** A logger that does nothing when log messages are sent to it. */\r\nexport class NullLogger {\r\n    constructor() { }\r\n    /** @inheritDoc */\r\n    // eslint-disable-next-line\r\n    log(_logLevel, _message) {\r\n    }\r\n}\r\n/** The singleton instance of the {@link @microsoft/signalr.NullLogger}. */\r\nNullLogger.instance = new NullLogger();\r\n//# sourceMappingURL=Loggers.js.map","export const VERSION = '9.0.6';\r\n//# sourceMappingURL=pkg-version.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { VERSION } from \"./pkg-version\";\r\n// Version token that will be replaced by the prepack command\r\n/** The version of the SignalR client. */\r\nexport { VERSION };\r\n/** @private */\r\nexport class Arg {\r\n    static isRequired(val, name) {\r\n        if (val === null || val === undefined) {\r\n            throw new Error(`The '${name}' argument is required.`);\r\n        }\r\n    }\r\n    static isNotEmpty(val, name) {\r\n        if (!val || val.match(/^\\s*$/)) {\r\n            throw new Error(`The '${name}' argument should not be empty.`);\r\n        }\r\n    }\r\n    static isIn(val, values, name) {\r\n        // TypeScript enums have keys for **both** the name and the value of each enum member on the type itself.\r\n        if (!(val in values)) {\r\n            throw new Error(`Unknown ${name} value: ${val}.`);\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport class Platform {\r\n    // react-native has a window but no document so we should check both\r\n    static get isBrowser() {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"object\";\r\n    }\r\n    // WebWorkers don't have a window object so the isBrowser check would fail\r\n    static get isWebWorker() {\r\n        return !Platform.isNode && typeof self === \"object\" && \"importScripts\" in self;\r\n    }\r\n    // react-native has a window but no document\r\n    static get isReactNative() {\r\n        return !Platform.isNode && typeof window === \"object\" && typeof window.document === \"undefined\";\r\n    }\r\n    // Node apps shouldn't have a window object, but WebWorkers don't either\r\n    // so we need to check for both WebWorker and window\r\n    static get isNode() {\r\n        return typeof process !== \"undefined\" && process.release && process.release.name === \"node\";\r\n    }\r\n}\r\n/** @private */\r\nexport function getDataDetail(data, includeContent) {\r\n    let detail = \"\";\r\n    if (isArrayBuffer(data)) {\r\n        detail = `Binary data of length ${data.byteLength}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${formatArrayBuffer(data)}'`;\r\n        }\r\n    }\r\n    else if (typeof data === \"string\") {\r\n        detail = `String data of length ${data.length}`;\r\n        if (includeContent) {\r\n            detail += `. Content: '${data}'`;\r\n        }\r\n    }\r\n    return detail;\r\n}\r\n/** @private */\r\nexport function formatArrayBuffer(data) {\r\n    const view = new Uint8Array(data);\r\n    // Uint8Array.map only supports returning another Uint8Array?\r\n    let str = \"\";\r\n    view.forEach((num) => {\r\n        const pad = num < 16 ? \"0\" : \"\";\r\n        str += `0x${pad}${num.toString(16)} `;\r\n    });\r\n    // Trim of trailing space.\r\n    return str.substr(0, str.length - 1);\r\n}\r\n// Also in signalr-protocol-msgpack/Utils.ts\r\n/** @private */\r\nexport function isArrayBuffer(val) {\r\n    return val && typeof ArrayBuffer !== \"undefined\" &&\r\n        (val instanceof ArrayBuffer ||\r\n            // Sometimes we get an ArrayBuffer that doesn't satisfy instanceof\r\n            (val.constructor && val.constructor.name === \"ArrayBuffer\"));\r\n}\r\n/** @private */\r\nexport async function sendMessage(logger, transportName, httpClient, url, content, options) {\r\n    const headers = {};\r\n    const [name, value] = getUserAgentHeader();\r\n    headers[name] = value;\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) sending data. ${getDataDetail(content, options.logMessageContent)}.`);\r\n    const responseType = isArrayBuffer(content) ? \"arraybuffer\" : \"text\";\r\n    const response = await httpClient.post(url, {\r\n        content,\r\n        headers: { ...headers, ...options.headers },\r\n        responseType,\r\n        timeout: options.timeout,\r\n        withCredentials: options.withCredentials,\r\n    });\r\n    logger.log(LogLevel.Trace, `(${transportName} transport) request complete. Response status: ${response.statusCode}.`);\r\n}\r\n/** @private */\r\nexport function createLogger(logger) {\r\n    if (logger === undefined) {\r\n        return new ConsoleLogger(LogLevel.Information);\r\n    }\r\n    if (logger === null) {\r\n        return NullLogger.instance;\r\n    }\r\n    if (logger.log !== undefined) {\r\n        return logger;\r\n    }\r\n    return new ConsoleLogger(logger);\r\n}\r\n/** @private */\r\nexport class SubjectSubscription {\r\n    constructor(subject, observer) {\r\n        this._subject = subject;\r\n        this._observer = observer;\r\n    }\r\n    dispose() {\r\n        const index = this._subject.observers.indexOf(this._observer);\r\n        if (index > -1) {\r\n            this._subject.observers.splice(index, 1);\r\n        }\r\n        if (this._subject.observers.length === 0 && this._subject.cancelCallback) {\r\n            this._subject.cancelCallback().catch((_) => { });\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport class ConsoleLogger {\r\n    constructor(minimumLogLevel) {\r\n        this._minLevel = minimumLogLevel;\r\n        this.out = console;\r\n    }\r\n    log(logLevel, message) {\r\n        if (logLevel >= this._minLevel) {\r\n            const msg = `[${new Date().toISOString()}] ${LogLevel[logLevel]}: ${message}`;\r\n            switch (logLevel) {\r\n                case LogLevel.Critical:\r\n                case LogLevel.Error:\r\n                    this.out.error(msg);\r\n                    break;\r\n                case LogLevel.Warning:\r\n                    this.out.warn(msg);\r\n                    break;\r\n                case LogLevel.Information:\r\n                    this.out.info(msg);\r\n                    break;\r\n                default:\r\n                    // console.debug only goes to attached debuggers in Node, so we use console.log for Trace and Debug\r\n                    this.out.log(msg);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n/** @private */\r\nexport function getUserAgentHeader() {\r\n    let userAgentHeaderName = \"X-SignalR-User-Agent\";\r\n    if (Platform.isNode) {\r\n        userAgentHeaderName = \"User-Agent\";\r\n    }\r\n    return [userAgentHeaderName, constructUserAgent(VERSION, getOsName(), getRuntime(), getRuntimeVersion())];\r\n}\r\n/** @private */\r\nexport function constructUserAgent(version, os, runtime, runtimeVersion) {\r\n    // Microsoft SignalR/[Version] ([Detailed Version]; [Operating System]; [Runtime]; [Runtime Version])\r\n    let userAgent = \"Microsoft SignalR/\";\r\n    const majorAndMinor = version.split(\".\");\r\n    userAgent += `${majorAndMinor[0]}.${majorAndMinor[1]}`;\r\n    userAgent += ` (${version}; `;\r\n    if (os && os !== \"\") {\r\n        userAgent += `${os}; `;\r\n    }\r\n    else {\r\n        userAgent += \"Unknown OS; \";\r\n    }\r\n    userAgent += `${runtime}`;\r\n    if (runtimeVersion) {\r\n        userAgent += `; ${runtimeVersion}`;\r\n    }\r\n    else {\r\n        userAgent += \"; Unknown Runtime Version\";\r\n    }\r\n    userAgent += \")\";\r\n    return userAgent;\r\n}\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getOsName() {\r\n    if (Platform.isNode) {\r\n        switch (process.platform) {\r\n            case \"win32\":\r\n                return \"Windows NT\";\r\n            case \"darwin\":\r\n                return \"macOS\";\r\n            case \"linux\":\r\n                return \"Linux\";\r\n            default:\r\n                return process.platform;\r\n        }\r\n    }\r\n    else {\r\n        return \"\";\r\n    }\r\n}\r\n// eslint-disable-next-line spaced-comment\r\n/*#__PURE__*/ function getRuntimeVersion() {\r\n    if (Platform.isNode) {\r\n        return process.versions.node;\r\n    }\r\n    return undefined;\r\n}\r\nfunction getRuntime() {\r\n    if (Platform.isNode) {\r\n        return \"NodeJS\";\r\n    }\r\n    else {\r\n        return \"Browser\";\r\n    }\r\n}\r\n/** @private */\r\nexport function getErrorString(e) {\r\n    if (e.stack) {\r\n        return e.stack;\r\n    }\r\n    else if (e.message) {\r\n        return e.message;\r\n    }\r\n    return `${e}`;\r\n}\r\n/** @private */\r\nexport function getGlobalThis() {\r\n    // globalThis is semi-new and not available in Node until v12\r\n    if (typeof globalThis !== \"undefined\") {\r\n        return globalThis;\r\n    }\r\n    if (typeof self !== \"undefined\") {\r\n        return self;\r\n    }\r\n    if (typeof window !== \"undefined\") {\r\n        return window;\r\n    }\r\n    if (typeof global !== \"undefined\") {\r\n        return global;\r\n    }\r\n    throw new Error(\"could not find global\");\r\n}\r\n//# sourceMappingURL=Utils.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Platform, getGlobalThis, isArrayBuffer } from \"./Utils\";\r\nexport class FetchHttpClient extends HttpClient {\r\n    constructor(logger) {\r\n        super();\r\n        this._logger = logger;\r\n        // Node added a fetch implementation to the global scope starting in v18.\r\n        // We need to add a cookie jar in node to be able to share cookies with WebSocket\r\n        if (typeof fetch === \"undefined\" || Platform.isNode) {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Cookies aren't automatically handled in Node so we need to add a CookieJar to preserve cookies across requests\r\n            this._jar = new (requireFunc(\"tough-cookie\")).CookieJar();\r\n            if (typeof fetch === \"undefined\") {\r\n                this._fetchType = requireFunc(\"node-fetch\");\r\n            }\r\n            else {\r\n                // Use fetch from Node if available\r\n                this._fetchType = fetch;\r\n            }\r\n            // node-fetch doesn't have a nice API for getting and setting cookies\r\n            // fetch-cookie will wrap a fetch implementation with a default CookieJar or a provided one\r\n            this._fetchType = requireFunc(\"fetch-cookie\")(this._fetchType, this._jar);\r\n        }\r\n        else {\r\n            this._fetchType = fetch.bind(getGlobalThis());\r\n        }\r\n        if (typeof AbortController === \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            // Node needs EventListener methods on AbortController which our custom polyfill doesn't provide\r\n            this._abortControllerType = requireFunc(\"abort-controller\");\r\n        }\r\n        else {\r\n            this._abortControllerType = AbortController;\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    async send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            throw new AbortError();\r\n        }\r\n        if (!request.method) {\r\n            throw new Error(\"No method defined.\");\r\n        }\r\n        if (!request.url) {\r\n            throw new Error(\"No url defined.\");\r\n        }\r\n        const abortController = new this._abortControllerType();\r\n        let error;\r\n        // Hook our abortSignal into the abort controller\r\n        if (request.abortSignal) {\r\n            request.abortSignal.onabort = () => {\r\n                abortController.abort();\r\n                error = new AbortError();\r\n            };\r\n        }\r\n        // If a timeout has been passed in, setup a timeout to call abort\r\n        // Type needs to be any to fit window.setTimeout and NodeJS.setTimeout\r\n        let timeoutId = null;\r\n        if (request.timeout) {\r\n            const msTimeout = request.timeout;\r\n            timeoutId = setTimeout(() => {\r\n                abortController.abort();\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                error = new TimeoutError();\r\n            }, msTimeout);\r\n        }\r\n        if (request.content === \"\") {\r\n            request.content = undefined;\r\n        }\r\n        if (request.content) {\r\n            // Explicitly setting the Content-Type header for React Native on Android platform.\r\n            request.headers = request.headers || {};\r\n            if (isArrayBuffer(request.content)) {\r\n                request.headers[\"Content-Type\"] = \"application/octet-stream\";\r\n            }\r\n            else {\r\n                request.headers[\"Content-Type\"] = \"text/plain;charset=UTF-8\";\r\n            }\r\n        }\r\n        let response;\r\n        try {\r\n            response = await this._fetchType(request.url, {\r\n                body: request.content,\r\n                cache: \"no-cache\",\r\n                credentials: request.withCredentials === true ? \"include\" : \"same-origin\",\r\n                headers: {\r\n                    \"X-Requested-With\": \"XMLHttpRequest\",\r\n                    ...request.headers,\r\n                },\r\n                method: request.method,\r\n                mode: \"cors\",\r\n                redirect: \"follow\",\r\n                signal: abortController.signal,\r\n            });\r\n        }\r\n        catch (e) {\r\n            if (error) {\r\n                throw error;\r\n            }\r\n            this._logger.log(LogLevel.Warning, `Error from HTTP request. ${e}.`);\r\n            throw e;\r\n        }\r\n        finally {\r\n            if (timeoutId) {\r\n                clearTimeout(timeoutId);\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = null;\r\n            }\r\n        }\r\n        if (!response.ok) {\r\n            const errorMessage = await deserializeContent(response, \"text\");\r\n            throw new HttpError(errorMessage || response.statusText, response.status);\r\n        }\r\n        const content = deserializeContent(response, request.responseType);\r\n        const payload = await content;\r\n        return new HttpResponse(response.status, response.statusText, payload);\r\n    }\r\n    getCookieString(url) {\r\n        let cookies = \"\";\r\n        if (Platform.isNode && this._jar) {\r\n            // @ts-ignore: unused variable\r\n            this._jar.getCookies(url, (e, c) => cookies = c.join(\"; \"));\r\n        }\r\n        return cookies;\r\n    }\r\n}\r\nfunction deserializeContent(response, responseType) {\r\n    let content;\r\n    switch (responseType) {\r\n        case \"arraybuffer\":\r\n            content = response.arrayBuffer();\r\n            break;\r\n        case \"text\":\r\n            content = response.text();\r\n            break;\r\n        case \"blob\":\r\n        case \"document\":\r\n        case \"json\":\r\n            throw new Error(`${responseType} is not supported.`);\r\n        default:\r\n            content = response.text();\r\n            break;\r\n    }\r\n    return content;\r\n}\r\n//# sourceMappingURL=FetchHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError, HttpError, TimeoutError } from \"./Errors\";\r\nimport { HttpClient, HttpResponse } from \"./HttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\nexport class XhrHttpClient extends HttpClient {\r\n    constructor(logger) {\r\n        super();\r\n        this._logger = logger;\r\n    }\r\n    /** @inheritDoc */\r\n    send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.open(request.method, request.url, true);\r\n            xhr.withCredentials = request.withCredentials === undefined ? true : request.withCredentials;\r\n            xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n            if (request.content === \"\") {\r\n                request.content = undefined;\r\n            }\r\n            if (request.content) {\r\n                // Explicitly setting the Content-Type header for React Native on Android platform.\r\n                if (isArrayBuffer(request.content)) {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\r\n                }\r\n                else {\r\n                    xhr.setRequestHeader(\"Content-Type\", \"text/plain;charset=UTF-8\");\r\n                }\r\n            }\r\n            const headers = request.headers;\r\n            if (headers) {\r\n                Object.keys(headers)\r\n                    .forEach((header) => {\r\n                    xhr.setRequestHeader(header, headers[header]);\r\n                });\r\n            }\r\n            if (request.responseType) {\r\n                xhr.responseType = request.responseType;\r\n            }\r\n            if (request.abortSignal) {\r\n                request.abortSignal.onabort = () => {\r\n                    xhr.abort();\r\n                    reject(new AbortError());\r\n                };\r\n            }\r\n            if (request.timeout) {\r\n                xhr.timeout = request.timeout;\r\n            }\r\n            xhr.onload = () => {\r\n                if (request.abortSignal) {\r\n                    request.abortSignal.onabort = null;\r\n                }\r\n                if (xhr.status >= 200 && xhr.status < 300) {\r\n                    resolve(new HttpResponse(xhr.status, xhr.statusText, xhr.response || xhr.responseText));\r\n                }\r\n                else {\r\n                    reject(new HttpError(xhr.response || xhr.responseText || xhr.statusText, xhr.status));\r\n                }\r\n            };\r\n            xhr.onerror = () => {\r\n                this._logger.log(LogLevel.Warning, `Error from HTTP request. ${xhr.status}: ${xhr.statusText}.`);\r\n                reject(new HttpError(xhr.statusText, xhr.status));\r\n            };\r\n            xhr.ontimeout = () => {\r\n                this._logger.log(LogLevel.Warning, `Timeout from HTTP request.`);\r\n                reject(new TimeoutError());\r\n            };\r\n            xhr.send(request.content);\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=XhrHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortError } from \"./Errors\";\r\nimport { FetchHttpClient } from \"./FetchHttpClient\";\r\nimport { HttpClient } from \"./HttpClient\";\r\nimport { Platform } from \"./Utils\";\r\nimport { XhrHttpClient } from \"./XhrHttpClient\";\r\n/** Default implementation of {@link @microsoft/signalr.HttpClient}. */\r\nexport class DefaultHttpClient extends HttpClient {\r\n    /** Creates a new instance of the {@link @microsoft/signalr.DefaultHttpClient}, using the provided {@link @microsoft/signalr.ILogger} to log messages. */\r\n    constructor(logger) {\r\n        super();\r\n        if (typeof fetch !== \"undefined\" || Platform.isNode) {\r\n            this._httpClient = new FetchHttpClient(logger);\r\n        }\r\n        else if (typeof XMLHttpRequest !== \"undefined\") {\r\n            this._httpClient = new XhrHttpClient(logger);\r\n        }\r\n        else {\r\n            throw new Error(\"No usable HttpClient found.\");\r\n        }\r\n    }\r\n    /** @inheritDoc */\r\n    send(request) {\r\n        // Check that abort was not signaled before calling send\r\n        if (request.abortSignal && request.abortSignal.aborted) {\r\n            return Promise.reject(new AbortError());\r\n        }\r\n        if (!request.method) {\r\n            return Promise.reject(new Error(\"No method defined.\"));\r\n        }\r\n        if (!request.url) {\r\n            return Promise.reject(new Error(\"No url defined.\"));\r\n        }\r\n        return this._httpClient.send(request);\r\n    }\r\n    getCookieString(url) {\r\n        return this._httpClient.getCookieString(url);\r\n    }\r\n}\r\n//# sourceMappingURL=DefaultHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// Not exported from index\r\n/** @private */\r\nexport class TextMessageFormat {\r\n    static write(output) {\r\n        return `${output}${TextMessageFormat.RecordSeparator}`;\r\n    }\r\n    static parse(input) {\r\n        if (input[input.length - 1] !== TextMessageFormat.RecordSeparator) {\r\n            throw new Error(\"Message is incomplete.\");\r\n        }\r\n        const messages = input.split(TextMessageFormat.RecordSeparator);\r\n        messages.pop();\r\n        return messages;\r\n    }\r\n}\r\nTextMessageFormat.RecordSeparatorCode = 0x1e;\r\nTextMessageFormat.RecordSeparator = String.fromCharCode(TextMessageFormat.RecordSeparatorCode);\r\n//# sourceMappingURL=TextMessageFormat.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nexport class HandshakeProtocol {\r\n    // Handshake request is always JSON\r\n    writeHandshakeRequest(handshakeRequest) {\r\n        return TextMessageFormat.write(JSON.stringify(handshakeRequest));\r\n    }\r\n    parseHandshakeResponse(data) {\r\n        let messageData;\r\n        let remainingData;\r\n        if (isArrayBuffer(data)) {\r\n            // Format is binary but still need to read JSON text from handshake response\r\n            const binaryData = new Uint8Array(data);\r\n            const separatorIndex = binaryData.indexOf(TextMessageFormat.RecordSeparatorCode);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = String.fromCharCode.apply(null, Array.prototype.slice.call(binaryData.slice(0, responseLength)));\r\n            remainingData = (binaryData.byteLength > responseLength) ? binaryData.slice(responseLength).buffer : null;\r\n        }\r\n        else {\r\n            const textData = data;\r\n            const separatorIndex = textData.indexOf(TextMessageFormat.RecordSeparator);\r\n            if (separatorIndex === -1) {\r\n                throw new Error(\"Message is incomplete.\");\r\n            }\r\n            // content before separator is handshake response\r\n            // optional content after is additional messages\r\n            const responseLength = separatorIndex + 1;\r\n            messageData = textData.substring(0, responseLength);\r\n            remainingData = (textData.length > responseLength) ? textData.substring(responseLength) : null;\r\n        }\r\n        // At this point we should have just the single handshake message\r\n        const messages = TextMessageFormat.parse(messageData);\r\n        const response = JSON.parse(messages[0]);\r\n        if (response.type) {\r\n            throw new Error(\"Expected a handshake response from the server.\");\r\n        }\r\n        const responseMessage = response;\r\n        // multiple messages could have arrived with handshake\r\n        // return additional data to be parsed as usual, or null if all parsed\r\n        return [remainingData, responseMessage];\r\n    }\r\n}\r\n//# sourceMappingURL=HandshakeProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n/** Defines the type of a Hub Message. */\r\nexport var MessageType;\r\n(function (MessageType) {\r\n    /** Indicates the message is an Invocation message and implements the {@link @microsoft/signalr.InvocationMessage} interface. */\r\n    MessageType[MessageType[\"Invocation\"] = 1] = \"Invocation\";\r\n    /** Indicates the message is a StreamItem message and implements the {@link @microsoft/signalr.StreamItemMessage} interface. */\r\n    MessageType[MessageType[\"StreamItem\"] = 2] = \"StreamItem\";\r\n    /** Indicates the message is a Completion message and implements the {@link @microsoft/signalr.CompletionMessage} interface. */\r\n    MessageType[MessageType[\"Completion\"] = 3] = \"Completion\";\r\n    /** Indicates the message is a Stream Invocation message and implements the {@link @microsoft/signalr.StreamInvocationMessage} interface. */\r\n    MessageType[MessageType[\"StreamInvocation\"] = 4] = \"StreamInvocation\";\r\n    /** Indicates the message is a Cancel Invocation message and implements the {@link @microsoft/signalr.CancelInvocationMessage} interface. */\r\n    MessageType[MessageType[\"CancelInvocation\"] = 5] = \"CancelInvocation\";\r\n    /** Indicates the message is a Ping message and implements the {@link @microsoft/signalr.PingMessage} interface. */\r\n    MessageType[MessageType[\"Ping\"] = 6] = \"Ping\";\r\n    /** Indicates the message is a Close message and implements the {@link @microsoft/signalr.CloseMessage} interface. */\r\n    MessageType[MessageType[\"Close\"] = 7] = \"Close\";\r\n    MessageType[MessageType[\"Ack\"] = 8] = \"Ack\";\r\n    MessageType[MessageType[\"Sequence\"] = 9] = \"Sequence\";\r\n})(MessageType || (MessageType = {}));\r\n//# sourceMappingURL=IHubProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { SubjectSubscription } from \"./Utils\";\r\n/** Stream implementation to stream items to the server. */\r\nexport class Subject {\r\n    constructor() {\r\n        this.observers = [];\r\n    }\r\n    next(item) {\r\n        for (const observer of this.observers) {\r\n            observer.next(item);\r\n        }\r\n    }\r\n    error(err) {\r\n        for (const observer of this.observers) {\r\n            if (observer.error) {\r\n                observer.error(err);\r\n            }\r\n        }\r\n    }\r\n    complete() {\r\n        for (const observer of this.observers) {\r\n            if (observer.complete) {\r\n                observer.complete();\r\n            }\r\n        }\r\n    }\r\n    subscribe(observer) {\r\n        this.observers.push(observer);\r\n        return new SubjectSubscription(this, observer);\r\n    }\r\n}\r\n//# sourceMappingURL=Subject.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { isArrayBuffer } from \"./Utils\";\r\n/** @private */\r\nexport class MessageBuffer {\r\n    constructor(protocol, connection, bufferSize) {\r\n        this._bufferSize = 100000;\r\n        this._messages = [];\r\n        this._totalMessageCount = 0;\r\n        this._waitForSequenceMessage = false;\r\n        // Message IDs start at 1 and always increment by 1\r\n        this._nextReceivingSequenceId = 1;\r\n        this._latestReceivedSequenceId = 0;\r\n        this._bufferedByteCount = 0;\r\n        this._reconnectInProgress = false;\r\n        this._protocol = protocol;\r\n        this._connection = connection;\r\n        this._bufferSize = bufferSize;\r\n    }\r\n    async _send(message) {\r\n        const serializedMessage = this._protocol.writeMessage(message);\r\n        let backpressurePromise = Promise.resolve();\r\n        // Only count invocation messages. Acks, pings, etc. don't need to be resent on reconnect\r\n        if (this._isInvocationMessage(message)) {\r\n            this._totalMessageCount++;\r\n            let backpressurePromiseResolver = () => { };\r\n            let backpressurePromiseRejector = () => { };\r\n            if (isArrayBuffer(serializedMessage)) {\r\n                this._bufferedByteCount += serializedMessage.byteLength;\r\n            }\r\n            else {\r\n                this._bufferedByteCount += serializedMessage.length;\r\n            }\r\n            if (this._bufferedByteCount >= this._bufferSize) {\r\n                backpressurePromise = new Promise((resolve, reject) => {\r\n                    backpressurePromiseResolver = resolve;\r\n                    backpressurePromiseRejector = reject;\r\n                });\r\n            }\r\n            this._messages.push(new BufferedItem(serializedMessage, this._totalMessageCount, backpressurePromiseResolver, backpressurePromiseRejector));\r\n        }\r\n        try {\r\n            // If this is set it means we are reconnecting or resending\r\n            // We don't want to send on a disconnected connection\r\n            // And we don't want to send if resend is running since that would mean sending\r\n            // this message twice\r\n            if (!this._reconnectInProgress) {\r\n                await this._connection.send(serializedMessage);\r\n            }\r\n        }\r\n        catch {\r\n            this._disconnected();\r\n        }\r\n        await backpressurePromise;\r\n    }\r\n    _ack(ackMessage) {\r\n        let newestAckedMessage = -1;\r\n        // Find index of newest message being acked\r\n        for (let index = 0; index < this._messages.length; index++) {\r\n            const element = this._messages[index];\r\n            if (element._id <= ackMessage.sequenceId) {\r\n                newestAckedMessage = index;\r\n                if (isArrayBuffer(element._message)) {\r\n                    this._bufferedByteCount -= element._message.byteLength;\r\n                }\r\n                else {\r\n                    this._bufferedByteCount -= element._message.length;\r\n                }\r\n                // resolve items that have already been sent and acked\r\n                element._resolver();\r\n            }\r\n            else if (this._bufferedByteCount < this._bufferSize) {\r\n                // resolve items that now fall under the buffer limit but haven't been acked\r\n                element._resolver();\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        if (newestAckedMessage !== -1) {\r\n            // We're removing everything including the message pointed to, so add 1\r\n            this._messages = this._messages.slice(newestAckedMessage + 1);\r\n        }\r\n    }\r\n    _shouldProcessMessage(message) {\r\n        if (this._waitForSequenceMessage) {\r\n            if (message.type !== MessageType.Sequence) {\r\n                return false;\r\n            }\r\n            else {\r\n                this._waitForSequenceMessage = false;\r\n                return true;\r\n            }\r\n        }\r\n        // No special processing for acks, pings, etc.\r\n        if (!this._isInvocationMessage(message)) {\r\n            return true;\r\n        }\r\n        const currentId = this._nextReceivingSequenceId;\r\n        this._nextReceivingSequenceId++;\r\n        if (currentId <= this._latestReceivedSequenceId) {\r\n            if (currentId === this._latestReceivedSequenceId) {\r\n                // Should only hit this if we just reconnected and the server is sending\r\n                // Messages it has buffered, which would mean it hasn't seen an Ack for these messages\r\n                this._ackTimer();\r\n            }\r\n            // Ignore, this is a duplicate message\r\n            return false;\r\n        }\r\n        this._latestReceivedSequenceId = currentId;\r\n        // Only start the timer for sending an Ack message when we have a message to ack. This also conveniently solves\r\n        // timer throttling by not having a recursive timer, and by starting the timer via a network call (recv)\r\n        this._ackTimer();\r\n        return true;\r\n    }\r\n    _resetSequence(message) {\r\n        if (message.sequenceId > this._nextReceivingSequenceId) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._connection.stop(new Error(\"Sequence ID greater than amount of messages we've received.\"));\r\n            return;\r\n        }\r\n        this._nextReceivingSequenceId = message.sequenceId;\r\n    }\r\n    _disconnected() {\r\n        this._reconnectInProgress = true;\r\n        this._waitForSequenceMessage = true;\r\n    }\r\n    async _resend() {\r\n        const sequenceId = this._messages.length !== 0\r\n            ? this._messages[0]._id\r\n            : this._totalMessageCount + 1;\r\n        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Sequence, sequenceId }));\r\n        // Get a local variable to the _messages, just in case messages are acked while resending\r\n        // Which would slice the _messages array (which creates a new copy)\r\n        const messages = this._messages;\r\n        for (const element of messages) {\r\n            await this._connection.send(element._message);\r\n        }\r\n        this._reconnectInProgress = false;\r\n    }\r\n    _dispose(error) {\r\n        error !== null && error !== void 0 ? error : (error = new Error(\"Unable to reconnect to server.\"));\r\n        // Unblock backpressure if any\r\n        for (const element of this._messages) {\r\n            element._rejector(error);\r\n        }\r\n    }\r\n    _isInvocationMessage(message) {\r\n        // There is no way to check if something implements an interface.\r\n        // So we individually check the messages in a switch statement.\r\n        // To make sure we don't miss any message types we rely on the compiler\r\n        // seeing the function returns a value and it will do the\r\n        // exhaustive check for us on the switch statement, since we don't use 'case default'\r\n        switch (message.type) {\r\n            case MessageType.Invocation:\r\n            case MessageType.StreamItem:\r\n            case MessageType.Completion:\r\n            case MessageType.StreamInvocation:\r\n            case MessageType.CancelInvocation:\r\n                return true;\r\n            case MessageType.Close:\r\n            case MessageType.Sequence:\r\n            case MessageType.Ping:\r\n            case MessageType.Ack:\r\n                return false;\r\n        }\r\n    }\r\n    _ackTimer() {\r\n        if (this._ackTimerHandle === undefined) {\r\n            this._ackTimerHandle = setTimeout(async () => {\r\n                try {\r\n                    if (!this._reconnectInProgress) {\r\n                        await this._connection.send(this._protocol.writeMessage({ type: MessageType.Ack, sequenceId: this._latestReceivedSequenceId }));\r\n                    }\r\n                    // Ignore errors, that means the connection is closed and we don't care about the Ack message anymore.\r\n                }\r\n                catch { }\r\n                clearTimeout(this._ackTimerHandle);\r\n                this._ackTimerHandle = undefined;\r\n                // 1 second delay so we don't spam Ack messages if there are many messages being received at once.\r\n            }, 1000);\r\n        }\r\n    }\r\n}\r\nclass BufferedItem {\r\n    constructor(message, id, resolver, rejector) {\r\n        this._message = message;\r\n        this._id = id;\r\n        this._resolver = resolver;\r\n        this._rejector = rejector;\r\n    }\r\n}\r\n//# sourceMappingURL=MessageBuffer.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HandshakeProtocol } from \"./HandshakeProtocol\";\r\nimport { AbortError } from \"./Errors\";\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { Subject } from \"./Subject\";\r\nimport { Arg, getErrorString, Platform } from \"./Utils\";\r\nimport { MessageBuffer } from \"./MessageBuffer\";\r\nconst DEFAULT_TIMEOUT_IN_MS = 30 * 1000;\r\nconst DEFAULT_PING_INTERVAL_IN_MS = 15 * 1000;\r\nconst DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE = 100000;\r\n/** Describes the current state of the {@link HubConnection} to the server. */\r\nexport var HubConnectionState;\r\n(function (HubConnectionState) {\r\n    /** The hub connection is disconnected. */\r\n    HubConnectionState[\"Disconnected\"] = \"Disconnected\";\r\n    /** The hub connection is connecting. */\r\n    HubConnectionState[\"Connecting\"] = \"Connecting\";\r\n    /** The hub connection is connected. */\r\n    HubConnectionState[\"Connected\"] = \"Connected\";\r\n    /** The hub connection is disconnecting. */\r\n    HubConnectionState[\"Disconnecting\"] = \"Disconnecting\";\r\n    /** The hub connection is reconnecting. */\r\n    HubConnectionState[\"Reconnecting\"] = \"Reconnecting\";\r\n})(HubConnectionState || (HubConnectionState = {}));\r\n/** Represents a connection to a SignalR Hub. */\r\nexport class HubConnection {\r\n    /** @internal */\r\n    // Using a public static factory method means we can have a private constructor and an _internal_\r\n    // create method that can be used by HubConnectionBuilder. An \"internal\" constructor would just\r\n    // be stripped away and the '.d.ts' file would have no constructor, which is interpreted as a\r\n    // public parameter-less constructor.\r\n    static create(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize) {\r\n        return new HubConnection(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize);\r\n    }\r\n    constructor(connection, logger, protocol, reconnectPolicy, serverTimeoutInMilliseconds, keepAliveIntervalInMilliseconds, statefulReconnectBufferSize) {\r\n        this._nextKeepAlive = 0;\r\n        this._freezeEventListener = () => {\r\n            this._logger.log(LogLevel.Warning, \"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep\");\r\n        };\r\n        Arg.isRequired(connection, \"connection\");\r\n        Arg.isRequired(logger, \"logger\");\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.serverTimeoutInMilliseconds = serverTimeoutInMilliseconds !== null && serverTimeoutInMilliseconds !== void 0 ? serverTimeoutInMilliseconds : DEFAULT_TIMEOUT_IN_MS;\r\n        this.keepAliveIntervalInMilliseconds = keepAliveIntervalInMilliseconds !== null && keepAliveIntervalInMilliseconds !== void 0 ? keepAliveIntervalInMilliseconds : DEFAULT_PING_INTERVAL_IN_MS;\r\n        this._statefulReconnectBufferSize = statefulReconnectBufferSize !== null && statefulReconnectBufferSize !== void 0 ? statefulReconnectBufferSize : DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE;\r\n        this._logger = logger;\r\n        this._protocol = protocol;\r\n        this.connection = connection;\r\n        this._reconnectPolicy = reconnectPolicy;\r\n        this._handshakeProtocol = new HandshakeProtocol();\r\n        this.connection.onreceive = (data) => this._processIncomingData(data);\r\n        this.connection.onclose = (error) => this._connectionClosed(error);\r\n        this._callbacks = {};\r\n        this._methods = {};\r\n        this._closedCallbacks = [];\r\n        this._reconnectingCallbacks = [];\r\n        this._reconnectedCallbacks = [];\r\n        this._invocationId = 0;\r\n        this._receivedHandshakeResponse = false;\r\n        this._connectionState = HubConnectionState.Disconnected;\r\n        this._connectionStarted = false;\r\n        this._cachedPingMessage = this._protocol.writeMessage({ type: MessageType.Ping });\r\n    }\r\n    /** Indicates the state of the {@link HubConnection} to the server. */\r\n    get state() {\r\n        return this._connectionState;\r\n    }\r\n    /** Represents the connection id of the {@link HubConnection} on the server. The connection id will be null when the connection is either\r\n     *  in the disconnected state or if the negotiation step was skipped.\r\n     */\r\n    get connectionId() {\r\n        return this.connection ? (this.connection.connectionId || null) : null;\r\n    }\r\n    /** Indicates the url of the {@link HubConnection} to the server. */\r\n    get baseUrl() {\r\n        return this.connection.baseUrl || \"\";\r\n    }\r\n    /**\r\n     * Sets a new url for the HubConnection. Note that the url can only be changed when the connection is in either the Disconnected or\r\n     * Reconnecting states.\r\n     * @param {string} url The url to connect to.\r\n     */\r\n    set baseUrl(url) {\r\n        if (this._connectionState !== HubConnectionState.Disconnected && this._connectionState !== HubConnectionState.Reconnecting) {\r\n            throw new Error(\"The HubConnection must be in the Disconnected or Reconnecting state to change the url.\");\r\n        }\r\n        if (!url) {\r\n            throw new Error(\"The HubConnection url must be a valid url.\");\r\n        }\r\n        this.connection.baseUrl = url;\r\n    }\r\n    /** Starts the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully established, or rejects with an error.\r\n     */\r\n    start() {\r\n        this._startPromise = this._startWithStateTransitions();\r\n        return this._startPromise;\r\n    }\r\n    async _startWithStateTransitions() {\r\n        if (this._connectionState !== HubConnectionState.Disconnected) {\r\n            return Promise.reject(new Error(\"Cannot start a HubConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this._connectionState = HubConnectionState.Connecting;\r\n        this._logger.log(LogLevel.Debug, \"Starting HubConnection.\");\r\n        try {\r\n            await this._startInternal();\r\n            if (Platform.isBrowser) {\r\n                // Log when the browser freezes the tab so users know why their connection unexpectedly stopped working\r\n                window.document.addEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n            this._connectionState = HubConnectionState.Connected;\r\n            this._connectionStarted = true;\r\n            this._logger.log(LogLevel.Debug, \"HubConnection connected successfully.\");\r\n        }\r\n        catch (e) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._logger.log(LogLevel.Debug, `HubConnection failed to start successfully because of error '${e}'.`);\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    async _startInternal() {\r\n        this._stopDuringStartError = undefined;\r\n        this._receivedHandshakeResponse = false;\r\n        // Set up the promise before any connection is (re)started otherwise it could race with received messages\r\n        const handshakePromise = new Promise((resolve, reject) => {\r\n            this._handshakeResolver = resolve;\r\n            this._handshakeRejecter = reject;\r\n        });\r\n        await this.connection.start(this._protocol.transferFormat);\r\n        try {\r\n            let version = this._protocol.version;\r\n            if (!this.connection.features.reconnect) {\r\n                // Stateful Reconnect starts with HubProtocol version 2, newer clients connecting to older servers will fail to connect due to\r\n                // the handshake only supporting version 1, so we will try to send version 1 during the handshake to keep old servers working.\r\n                version = 1;\r\n            }\r\n            const handshakeRequest = {\r\n                protocol: this._protocol.name,\r\n                version,\r\n            };\r\n            this._logger.log(LogLevel.Debug, \"Sending handshake request.\");\r\n            await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(handshakeRequest));\r\n            this._logger.log(LogLevel.Information, `Using HubProtocol '${this._protocol.name}'.`);\r\n            // defensively cleanup timeout in case we receive a message from the server before we finish start\r\n            this._cleanupTimeout();\r\n            this._resetTimeoutPeriod();\r\n            this._resetKeepAliveInterval();\r\n            await handshakePromise;\r\n            // It's important to check the stopDuringStartError instead of just relying on the handshakePromise\r\n            // being rejected on close, because this continuation can run after both the handshake completed successfully\r\n            // and the connection was closed.\r\n            if (this._stopDuringStartError) {\r\n                // It's important to throw instead of returning a rejected promise, because we don't want to allow any state\r\n                // transitions to occur between now and the calling code observing the exceptions. Returning a rejected promise\r\n                // will cause the calling continuation to get scheduled to run later.\r\n                // eslint-disable-next-line @typescript-eslint/no-throw-literal\r\n                throw this._stopDuringStartError;\r\n            }\r\n            const useStatefulReconnect = this.connection.features.reconnect || false;\r\n            if (useStatefulReconnect) {\r\n                this._messageBuffer = new MessageBuffer(this._protocol, this.connection, this._statefulReconnectBufferSize);\r\n                this.connection.features.disconnected = this._messageBuffer._disconnected.bind(this._messageBuffer);\r\n                this.connection.features.resend = () => {\r\n                    if (this._messageBuffer) {\r\n                        return this._messageBuffer._resend();\r\n                    }\r\n                };\r\n            }\r\n            if (!this.connection.features.inherentKeepAlive) {\r\n                await this._sendMessage(this._cachedPingMessage);\r\n            }\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Debug, `Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`);\r\n            this._cleanupTimeout();\r\n            this._cleanupPingTimer();\r\n            // HttpConnection.stop() should not complete until after the onclose callback is invoked.\r\n            // This will transition the HubConnection to the disconnected state before HttpConnection.stop() completes.\r\n            await this.connection.stop(e);\r\n            throw e;\r\n        }\r\n    }\r\n    /** Stops the connection.\r\n     *\r\n     * @returns {Promise<void>} A Promise that resolves when the connection has been successfully terminated, or rejects with an error.\r\n     */\r\n    async stop() {\r\n        // Capture the start promise before the connection might be restarted in an onclose callback.\r\n        const startPromise = this._startPromise;\r\n        this.connection.features.reconnect = false;\r\n        this._stopPromise = this._stopInternal();\r\n        await this._stopPromise;\r\n        try {\r\n            // Awaiting undefined continues immediately\r\n            await startPromise;\r\n        }\r\n        catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n    }\r\n    _stopInternal(error) {\r\n        if (this._connectionState === HubConnectionState.Disconnected) {\r\n            this._logger.log(LogLevel.Debug, `Call to HubConnection.stop(${error}) ignored because it is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise;\r\n        }\r\n        const state = this._connectionState;\r\n        this._connectionState = HubConnectionState.Disconnecting;\r\n        this._logger.log(LogLevel.Debug, \"Stopping HubConnection.\");\r\n        if (this._reconnectDelayHandle) {\r\n            // We're in a reconnect delay which means the underlying connection is currently already stopped.\r\n            // Just clear the handle to stop the reconnect loop (which no one is waiting on thankfully) and\r\n            // fire the onclose callbacks.\r\n            this._logger.log(LogLevel.Debug, \"Connection stopped during reconnect delay. Done reconnecting.\");\r\n            clearTimeout(this._reconnectDelayHandle);\r\n            this._reconnectDelayHandle = undefined;\r\n            this._completeClose();\r\n            return Promise.resolve();\r\n        }\r\n        if (state === HubConnectionState.Connected) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._sendCloseMessage();\r\n        }\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n        this._stopDuringStartError = error || new AbortError(\"The connection was stopped before the hub handshake could complete.\");\r\n        // HttpConnection.stop() should not complete until after either HttpConnection.start() fails\r\n        // or the onclose callback is invoked. The onclose callback will transition the HubConnection\r\n        // to the disconnected state if need be before HttpConnection.stop() completes.\r\n        return this.connection.stop(error);\r\n    }\r\n    async _sendCloseMessage() {\r\n        try {\r\n            await this._sendWithProtocol(this._createCloseMessage());\r\n        }\r\n        catch {\r\n            // Ignore, this is a best effort attempt to let the server know the client closed gracefully.\r\n        }\r\n    }\r\n    /** Invokes a streaming hub method on the server using the specified name and arguments.\r\n     *\r\n     * @typeparam T The type of the items returned by the server.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {IStreamResult<T>} An object that yields results from the server as they are received.\r\n     */\r\n    stream(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createStreamInvocation(methodName, args, streamIds);\r\n        // eslint-disable-next-line prefer-const\r\n        let promiseQueue;\r\n        const subject = new Subject();\r\n        subject.cancelCallback = () => {\r\n            const cancelInvocation = this._createCancelInvocation(invocationDescriptor.invocationId);\r\n            delete this._callbacks[invocationDescriptor.invocationId];\r\n            return promiseQueue.then(() => {\r\n                return this._sendWithProtocol(cancelInvocation);\r\n            });\r\n        };\r\n        this._callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n            if (error) {\r\n                subject.error(error);\r\n                return;\r\n            }\r\n            else if (invocationEvent) {\r\n                // invocationEvent will not be null when an error is not passed to the callback\r\n                if (invocationEvent.type === MessageType.Completion) {\r\n                    if (invocationEvent.error) {\r\n                        subject.error(new Error(invocationEvent.error));\r\n                    }\r\n                    else {\r\n                        subject.complete();\r\n                    }\r\n                }\r\n                else {\r\n                    subject.next((invocationEvent.item));\r\n                }\r\n            }\r\n        };\r\n        promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n            .catch((e) => {\r\n            subject.error(e);\r\n            delete this._callbacks[invocationDescriptor.invocationId];\r\n        });\r\n        this._launchStreams(streams, promiseQueue);\r\n        return subject;\r\n    }\r\n    _sendMessage(message) {\r\n        this._resetKeepAliveInterval();\r\n        return this.connection.send(message);\r\n    }\r\n    /**\r\n     * Sends a js object to the server.\r\n     * @param message The js object to serialize and send.\r\n     */\r\n    _sendWithProtocol(message) {\r\n        if (this._messageBuffer) {\r\n            return this._messageBuffer._send(message);\r\n        }\r\n        else {\r\n            return this._sendMessage(this._protocol.writeMessage(message));\r\n        }\r\n    }\r\n    /** Invokes a hub method on the server using the specified name and arguments. Does not wait for a response from the receiver.\r\n     *\r\n     * The Promise returned by this method resolves when the client has sent the invocation to the server. The server may still\r\n     * be processing the invocation.\r\n     *\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<void>} A Promise that resolves when the invocation has been successfully sent, or rejects with an error.\r\n     */\r\n    send(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const sendPromise = this._sendWithProtocol(this._createInvocation(methodName, args, true, streamIds));\r\n        this._launchStreams(streams, sendPromise);\r\n        return sendPromise;\r\n    }\r\n    /** Invokes a hub method on the server using the specified name and arguments.\r\n     *\r\n     * The Promise returned by this method resolves when the server indicates it has finished invoking the method. When the promise\r\n     * resolves, the server has finished invoking the method. If the server method returns a result, it is produced as the result of\r\n     * resolving the Promise.\r\n     *\r\n     * @typeparam T The expected return type.\r\n     * @param {string} methodName The name of the server method to invoke.\r\n     * @param {any[]} args The arguments used to invoke the server method.\r\n     * @returns {Promise<T>} A Promise that resolves with the result of the server method (if any), or rejects with an error.\r\n     */\r\n    invoke(methodName, ...args) {\r\n        const [streams, streamIds] = this._replaceStreamingParams(args);\r\n        const invocationDescriptor = this._createInvocation(methodName, args, false, streamIds);\r\n        const p = new Promise((resolve, reject) => {\r\n            // invocationId will always have a value for a non-blocking invocation\r\n            this._callbacks[invocationDescriptor.invocationId] = (invocationEvent, error) => {\r\n                if (error) {\r\n                    reject(error);\r\n                    return;\r\n                }\r\n                else if (invocationEvent) {\r\n                    // invocationEvent will not be null when an error is not passed to the callback\r\n                    if (invocationEvent.type === MessageType.Completion) {\r\n                        if (invocationEvent.error) {\r\n                            reject(new Error(invocationEvent.error));\r\n                        }\r\n                        else {\r\n                            resolve(invocationEvent.result);\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(new Error(`Unexpected message type: ${invocationEvent.type}`));\r\n                    }\r\n                }\r\n            };\r\n            const promiseQueue = this._sendWithProtocol(invocationDescriptor)\r\n                .catch((e) => {\r\n                reject(e);\r\n                // invocationId will always have a value for a non-blocking invocation\r\n                delete this._callbacks[invocationDescriptor.invocationId];\r\n            });\r\n            this._launchStreams(streams, promiseQueue);\r\n        });\r\n        return p;\r\n    }\r\n    on(methodName, newMethod) {\r\n        if (!methodName || !newMethod) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        if (!this._methods[methodName]) {\r\n            this._methods[methodName] = [];\r\n        }\r\n        // Preventing adding the same handler multiple times.\r\n        if (this._methods[methodName].indexOf(newMethod) !== -1) {\r\n            return;\r\n        }\r\n        this._methods[methodName].push(newMethod);\r\n    }\r\n    off(methodName, method) {\r\n        if (!methodName) {\r\n            return;\r\n        }\r\n        methodName = methodName.toLowerCase();\r\n        const handlers = this._methods[methodName];\r\n        if (!handlers) {\r\n            return;\r\n        }\r\n        if (method) {\r\n            const removeIdx = handlers.indexOf(method);\r\n            if (removeIdx !== -1) {\r\n                handlers.splice(removeIdx, 1);\r\n                if (handlers.length === 0) {\r\n                    delete this._methods[methodName];\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            delete this._methods[methodName];\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection is closed.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection is closed. Optionally receives a single argument containing the error that caused the connection to close (if any).\r\n     */\r\n    onclose(callback) {\r\n        if (callback) {\r\n            this._closedCallbacks.push(callback);\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection starts reconnecting.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection starts reconnecting. Optionally receives a single argument containing the error that caused the connection to start reconnecting (if any).\r\n     */\r\n    onreconnecting(callback) {\r\n        if (callback) {\r\n            this._reconnectingCallbacks.push(callback);\r\n        }\r\n    }\r\n    /** Registers a handler that will be invoked when the connection successfully reconnects.\r\n     *\r\n     * @param {Function} callback The handler that will be invoked when the connection successfully reconnects.\r\n     */\r\n    onreconnected(callback) {\r\n        if (callback) {\r\n            this._reconnectedCallbacks.push(callback);\r\n        }\r\n    }\r\n    _processIncomingData(data) {\r\n        this._cleanupTimeout();\r\n        if (!this._receivedHandshakeResponse) {\r\n            data = this._processHandshakeResponse(data);\r\n            this._receivedHandshakeResponse = true;\r\n        }\r\n        // Data may have all been read when processing handshake response\r\n        if (data) {\r\n            // Parse the messages\r\n            const messages = this._protocol.parseMessages(data, this._logger);\r\n            for (const message of messages) {\r\n                if (this._messageBuffer && !this._messageBuffer._shouldProcessMessage(message)) {\r\n                    // Don't process the message, we are either waiting for a SequenceMessage or received a duplicate message\r\n                    continue;\r\n                }\r\n                switch (message.type) {\r\n                    case MessageType.Invocation:\r\n                        this._invokeClientMethod(message)\r\n                            .catch((e) => {\r\n                            this._logger.log(LogLevel.Error, `Invoke client method threw error: ${getErrorString(e)}`);\r\n                        });\r\n                        break;\r\n                    case MessageType.StreamItem:\r\n                    case MessageType.Completion: {\r\n                        const callback = this._callbacks[message.invocationId];\r\n                        if (callback) {\r\n                            if (message.type === MessageType.Completion) {\r\n                                delete this._callbacks[message.invocationId];\r\n                            }\r\n                            try {\r\n                                callback(message);\r\n                            }\r\n                            catch (e) {\r\n                                this._logger.log(LogLevel.Error, `Stream callback threw error: ${getErrorString(e)}`);\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    case MessageType.Ping:\r\n                        // Don't care about pings\r\n                        break;\r\n                    case MessageType.Close: {\r\n                        this._logger.log(LogLevel.Information, \"Close message received from server.\");\r\n                        const error = message.error ? new Error(\"Server returned an error on close: \" + message.error) : undefined;\r\n                        if (message.allowReconnect === true) {\r\n                            // It feels wrong not to await connection.stop() here, but processIncomingData is called as part of an onreceive callback which is not async,\r\n                            // this is already the behavior for serverTimeout(), and HttpConnection.Stop() should catch and log all possible exceptions.\r\n                            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                            this.connection.stop(error);\r\n                        }\r\n                        else {\r\n                            // We cannot await stopInternal() here, but subsequent calls to stop() will await this if stopInternal() is still ongoing.\r\n                            this._stopPromise = this._stopInternal(error);\r\n                        }\r\n                        break;\r\n                    }\r\n                    case MessageType.Ack:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._ack(message);\r\n                        }\r\n                        break;\r\n                    case MessageType.Sequence:\r\n                        if (this._messageBuffer) {\r\n                            this._messageBuffer._resetSequence(message);\r\n                        }\r\n                        break;\r\n                    default:\r\n                        this._logger.log(LogLevel.Warning, `Invalid message type: ${message.type}.`);\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this._resetTimeoutPeriod();\r\n    }\r\n    _processHandshakeResponse(data) {\r\n        let responseMessage;\r\n        let remainingData;\r\n        try {\r\n            [remainingData, responseMessage] = this._handshakeProtocol.parseHandshakeResponse(data);\r\n        }\r\n        catch (e) {\r\n            const message = \"Error parsing handshake response: \" + e;\r\n            this._logger.log(LogLevel.Error, message);\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        if (responseMessage.error) {\r\n            const message = \"Server returned handshake error: \" + responseMessage.error;\r\n            this._logger.log(LogLevel.Error, message);\r\n            const error = new Error(message);\r\n            this._handshakeRejecter(error);\r\n            throw error;\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Debug, \"Server handshake complete.\");\r\n        }\r\n        this._handshakeResolver();\r\n        return remainingData;\r\n    }\r\n    _resetKeepAliveInterval() {\r\n        if (this.connection.features.inherentKeepAlive) {\r\n            return;\r\n        }\r\n        // Set the time we want the next keep alive to be sent\r\n        // Timer will be setup on next message receive\r\n        this._nextKeepAlive = new Date().getTime() + this.keepAliveIntervalInMilliseconds;\r\n        this._cleanupPingTimer();\r\n    }\r\n    _resetTimeoutPeriod() {\r\n        if (!this.connection.features || !this.connection.features.inherentKeepAlive) {\r\n            // Set the timeout timer\r\n            this._timeoutHandle = setTimeout(() => this.serverTimeout(), this.serverTimeoutInMilliseconds);\r\n            // Set keepAlive timer if there isn't one\r\n            if (this._pingServerHandle === undefined) {\r\n                let nextPing = this._nextKeepAlive - new Date().getTime();\r\n                if (nextPing < 0) {\r\n                    nextPing = 0;\r\n                }\r\n                // The timer needs to be set from a networking callback to avoid Chrome timer throttling from causing timers to run once a minute\r\n                this._pingServerHandle = setTimeout(async () => {\r\n                    if (this._connectionState === HubConnectionState.Connected) {\r\n                        try {\r\n                            await this._sendMessage(this._cachedPingMessage);\r\n                        }\r\n                        catch {\r\n                            // We don't care about the error. It should be seen elsewhere in the client.\r\n                            // The connection is probably in a bad or closed state now, cleanup the timer so it stops triggering\r\n                            this._cleanupPingTimer();\r\n                        }\r\n                    }\r\n                }, nextPing);\r\n            }\r\n        }\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    serverTimeout() {\r\n        // The server hasn't talked to us in a while. It doesn't like us anymore ... :(\r\n        // Terminate the connection, but we don't need to wait on the promise. This could trigger reconnecting.\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.connection.stop(new Error(\"Server timeout elapsed without receiving a message from the server.\"));\r\n    }\r\n    async _invokeClientMethod(invocationMessage) {\r\n        const methodName = invocationMessage.target.toLowerCase();\r\n        const methods = this._methods[methodName];\r\n        if (!methods) {\r\n            this._logger.log(LogLevel.Warning, `No client method with the name '${methodName}' found.`);\r\n            // No handlers provided by client but the server is expecting a response still, so we send an error\r\n            if (invocationMessage.invocationId) {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                await this._sendWithProtocol(this._createCompletionMessage(invocationMessage.invocationId, \"Client didn't provide a result.\", null));\r\n            }\r\n            return;\r\n        }\r\n        // Avoid issues with handlers removing themselves thus modifying the list while iterating through it\r\n        const methodsCopy = methods.slice();\r\n        // Server expects a response\r\n        const expectsResponse = invocationMessage.invocationId ? true : false;\r\n        // We preserve the last result or exception but still call all handlers\r\n        let res;\r\n        let exception;\r\n        let completionMessage;\r\n        for (const m of methodsCopy) {\r\n            try {\r\n                const prevRes = res;\r\n                res = await m.apply(this, invocationMessage.arguments);\r\n                if (expectsResponse && res && prevRes) {\r\n                    this._logger.log(LogLevel.Error, `Multiple results provided for '${methodName}'. Sending error to server.`);\r\n                    completionMessage = this._createCompletionMessage(invocationMessage.invocationId, `Client provided multiple results.`, null);\r\n                }\r\n                // Ignore exception if we got a result after, the exception will be logged\r\n                exception = undefined;\r\n            }\r\n            catch (e) {\r\n                exception = e;\r\n                this._logger.log(LogLevel.Error, `A callback for the method '${methodName}' threw error '${e}'.`);\r\n            }\r\n        }\r\n        if (completionMessage) {\r\n            await this._sendWithProtocol(completionMessage);\r\n        }\r\n        else if (expectsResponse) {\r\n            // If there is an exception that means either no result was given or a handler after a result threw\r\n            if (exception) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, `${exception}`, null);\r\n            }\r\n            else if (res !== undefined) {\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, null, res);\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Warning, `No result given for '${methodName}' method and invocation ID '${invocationMessage.invocationId}'.`);\r\n                // Client didn't provide a result or throw from a handler, server expects a response so we send an error\r\n                completionMessage = this._createCompletionMessage(invocationMessage.invocationId, \"Client didn't provide a result.\", null);\r\n            }\r\n            await this._sendWithProtocol(completionMessage);\r\n        }\r\n        else {\r\n            if (res) {\r\n                this._logger.log(LogLevel.Error, `Result given for '${methodName}' method but server is not expecting a result.`);\r\n            }\r\n        }\r\n    }\r\n    _connectionClosed(error) {\r\n        this._logger.log(LogLevel.Debug, `HubConnection.connectionClosed(${error}) called while in state ${this._connectionState}.`);\r\n        // Triggering this.handshakeRejecter is insufficient because it could already be resolved without the continuation having run yet.\r\n        this._stopDuringStartError = this._stopDuringStartError || error || new AbortError(\"The underlying connection was closed before the hub handshake could complete.\");\r\n        // If the handshake is in progress, start will be waiting for the handshake promise, so we complete it.\r\n        // If it has already completed, this should just noop.\r\n        if (this._handshakeResolver) {\r\n            this._handshakeResolver();\r\n        }\r\n        this._cancelCallbacksWithError(error || new Error(\"Invocation canceled due to the underlying connection being closed.\"));\r\n        this._cleanupTimeout();\r\n        this._cleanupPingTimer();\r\n        if (this._connectionState === HubConnectionState.Disconnecting) {\r\n            this._completeClose(error);\r\n        }\r\n        else if (this._connectionState === HubConnectionState.Connected && this._reconnectPolicy) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this._reconnect(error);\r\n        }\r\n        else if (this._connectionState === HubConnectionState.Connected) {\r\n            this._completeClose(error);\r\n        }\r\n        // If none of the above if conditions were true were called the HubConnection must be in either:\r\n        // 1. The Connecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail it.\r\n        // 2. The Reconnecting state in which case the handshakeResolver will complete it and stopDuringStartError will fail the current reconnect attempt\r\n        //    and potentially continue the reconnect() loop.\r\n        // 3. The Disconnected state in which case we're already done.\r\n    }\r\n    _completeClose(error) {\r\n        if (this._connectionStarted) {\r\n            this._connectionState = HubConnectionState.Disconnected;\r\n            this._connectionStarted = false;\r\n            if (this._messageBuffer) {\r\n                this._messageBuffer._dispose(error !== null && error !== void 0 ? error : new Error(\"Connection closed.\"));\r\n                this._messageBuffer = undefined;\r\n            }\r\n            if (Platform.isBrowser) {\r\n                window.document.removeEventListener(\"freeze\", this._freezeEventListener);\r\n            }\r\n            try {\r\n                this._closedCallbacks.forEach((c) => c.apply(this, [error]));\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onclose callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n    async _reconnect(error) {\r\n        const reconnectStartTime = Date.now();\r\n        let previousReconnectAttempts = 0;\r\n        let retryError = error !== undefined ? error : new Error(\"Attempting to reconnect due to a unknown error.\");\r\n        let nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, 0, retryError);\r\n        if (nextRetryDelay === null) {\r\n            this._logger.log(LogLevel.Debug, \"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt.\");\r\n            this._completeClose(error);\r\n            return;\r\n        }\r\n        this._connectionState = HubConnectionState.Reconnecting;\r\n        if (error) {\r\n            this._logger.log(LogLevel.Information, `Connection reconnecting because of error '${error}'.`);\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Information, \"Connection reconnecting.\");\r\n        }\r\n        if (this._reconnectingCallbacks.length !== 0) {\r\n            try {\r\n                this._reconnectingCallbacks.forEach((c) => c.apply(this, [error]));\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `An onreconnecting callback called with error '${error}' threw error '${e}'.`);\r\n            }\r\n            // Exit early if an onreconnecting callback called connection.stop().\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.\");\r\n                return;\r\n            }\r\n        }\r\n        while (nextRetryDelay !== null) {\r\n            this._logger.log(LogLevel.Information, `Reconnect attempt number ${previousReconnectAttempts} will start in ${nextRetryDelay} ms.`);\r\n            await new Promise((resolve) => {\r\n                this._reconnectDelayHandle = setTimeout(resolve, nextRetryDelay);\r\n            });\r\n            this._reconnectDelayHandle = undefined;\r\n            if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                this._logger.log(LogLevel.Debug, \"Connection left the reconnecting state during reconnect delay. Done reconnecting.\");\r\n                return;\r\n            }\r\n            try {\r\n                await this._startInternal();\r\n                this._connectionState = HubConnectionState.Connected;\r\n                this._logger.log(LogLevel.Information, \"HubConnection reconnected successfully.\");\r\n                if (this._reconnectedCallbacks.length !== 0) {\r\n                    try {\r\n                        this._reconnectedCallbacks.forEach((c) => c.apply(this, [this.connection.connectionId]));\r\n                    }\r\n                    catch (e) {\r\n                        this._logger.log(LogLevel.Error, `An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`);\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Information, `Reconnect attempt failed because of error '${e}'.`);\r\n                if (this._connectionState !== HubConnectionState.Reconnecting) {\r\n                    this._logger.log(LogLevel.Debug, `Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`);\r\n                    // The TypeScript compiler thinks that connectionState must be Connected here. The TypeScript compiler is wrong.\r\n                    if (this._connectionState === HubConnectionState.Disconnecting) {\r\n                        this._completeClose();\r\n                    }\r\n                    return;\r\n                }\r\n                retryError = e instanceof Error ? e : new Error(e.toString());\r\n                nextRetryDelay = this._getNextRetryDelay(previousReconnectAttempts++, Date.now() - reconnectStartTime, retryError);\r\n            }\r\n        }\r\n        this._logger.log(LogLevel.Information, `Reconnect retries have been exhausted after ${Date.now() - reconnectStartTime} ms and ${previousReconnectAttempts} failed attempts. Connection disconnecting.`);\r\n        this._completeClose();\r\n    }\r\n    _getNextRetryDelay(previousRetryCount, elapsedMilliseconds, retryReason) {\r\n        try {\r\n            return this._reconnectPolicy.nextRetryDelayInMilliseconds({\r\n                elapsedMilliseconds,\r\n                previousRetryCount,\r\n                retryReason,\r\n            });\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Error, `IRetryPolicy.nextRetryDelayInMilliseconds(${previousRetryCount}, ${elapsedMilliseconds}) threw error '${e}'.`);\r\n            return null;\r\n        }\r\n    }\r\n    _cancelCallbacksWithError(error) {\r\n        const callbacks = this._callbacks;\r\n        this._callbacks = {};\r\n        Object.keys(callbacks)\r\n            .forEach((key) => {\r\n            const callback = callbacks[key];\r\n            try {\r\n                callback(null, error);\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `Stream 'error' callback called with '${error}' threw error: ${getErrorString(e)}`);\r\n            }\r\n        });\r\n    }\r\n    _cleanupPingTimer() {\r\n        if (this._pingServerHandle) {\r\n            clearTimeout(this._pingServerHandle);\r\n            this._pingServerHandle = undefined;\r\n        }\r\n    }\r\n    _cleanupTimeout() {\r\n        if (this._timeoutHandle) {\r\n            clearTimeout(this._timeoutHandle);\r\n        }\r\n    }\r\n    _createInvocation(methodName, args, nonblocking, streamIds) {\r\n        if (nonblocking) {\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    target: methodName,\r\n                    arguments: args,\r\n                    streamIds,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    target: methodName,\r\n                    arguments: args,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n        else {\r\n            const invocationId = this._invocationId;\r\n            this._invocationId++;\r\n            if (streamIds.length !== 0) {\r\n                return {\r\n                    target: methodName,\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    streamIds,\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    target: methodName,\r\n                    arguments: args,\r\n                    invocationId: invocationId.toString(),\r\n                    type: MessageType.Invocation,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    _launchStreams(streams, promiseQueue) {\r\n        if (streams.length === 0) {\r\n            return;\r\n        }\r\n        // Synchronize stream data so they arrive in-order on the server\r\n        if (!promiseQueue) {\r\n            promiseQueue = Promise.resolve();\r\n        }\r\n        // We want to iterate over the keys, since the keys are the stream ids\r\n        // eslint-disable-next-line guard-for-in\r\n        for (const streamId in streams) {\r\n            streams[streamId].subscribe({\r\n                complete: () => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId)));\r\n                },\r\n                error: (err) => {\r\n                    let message;\r\n                    if (err instanceof Error) {\r\n                        message = err.message;\r\n                    }\r\n                    else if (err && err.toString) {\r\n                        message = err.toString();\r\n                    }\r\n                    else {\r\n                        message = \"Unknown error\";\r\n                    }\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createCompletionMessage(streamId, message)));\r\n                },\r\n                next: (item) => {\r\n                    promiseQueue = promiseQueue.then(() => this._sendWithProtocol(this._createStreamItemMessage(streamId, item)));\r\n                },\r\n            });\r\n        }\r\n    }\r\n    _replaceStreamingParams(args) {\r\n        const streams = [];\r\n        const streamIds = [];\r\n        for (let i = 0; i < args.length; i++) {\r\n            const argument = args[i];\r\n            if (this._isObservable(argument)) {\r\n                const streamId = this._invocationId;\r\n                this._invocationId++;\r\n                // Store the stream for later use\r\n                streams[streamId] = argument;\r\n                streamIds.push(streamId.toString());\r\n                // remove stream from args\r\n                args.splice(i, 1);\r\n            }\r\n        }\r\n        return [streams, streamIds];\r\n    }\r\n    _isObservable(arg) {\r\n        // This allows other stream implementations to just work (like rxjs)\r\n        return arg && arg.subscribe && typeof arg.subscribe === \"function\";\r\n    }\r\n    _createStreamInvocation(methodName, args, streamIds) {\r\n        const invocationId = this._invocationId;\r\n        this._invocationId++;\r\n        if (streamIds.length !== 0) {\r\n            return {\r\n                target: methodName,\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                streamIds,\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                target: methodName,\r\n                arguments: args,\r\n                invocationId: invocationId.toString(),\r\n                type: MessageType.StreamInvocation,\r\n            };\r\n        }\r\n    }\r\n    _createCancelInvocation(id) {\r\n        return {\r\n            invocationId: id,\r\n            type: MessageType.CancelInvocation,\r\n        };\r\n    }\r\n    _createStreamItemMessage(id, item) {\r\n        return {\r\n            invocationId: id,\r\n            item,\r\n            type: MessageType.StreamItem,\r\n        };\r\n    }\r\n    _createCompletionMessage(id, error, result) {\r\n        if (error) {\r\n            return {\r\n                error,\r\n                invocationId: id,\r\n                type: MessageType.Completion,\r\n            };\r\n        }\r\n        return {\r\n            invocationId: id,\r\n            result,\r\n            type: MessageType.Completion,\r\n        };\r\n    }\r\n    _createCloseMessage() {\r\n        return { type: MessageType.Close };\r\n    }\r\n}\r\n//# sourceMappingURL=HubConnection.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// 0, 2, 10, 30 second delays before reconnect attempts.\r\nconst DEFAULT_RETRY_DELAYS_IN_MILLISECONDS = [0, 2000, 10000, 30000, null];\r\n/** @private */\r\nexport class DefaultReconnectPolicy {\r\n    constructor(retryDelays) {\r\n        this._retryDelays = retryDelays !== undefined ? [...retryDelays, null] : DEFAULT_RETRY_DELAYS_IN_MILLISECONDS;\r\n    }\r\n    nextRetryDelayInMilliseconds(retryContext) {\r\n        return this._retryDelays[retryContext.previousRetryCount];\r\n    }\r\n}\r\n//# sourceMappingURL=DefaultReconnectPolicy.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nexport class HeaderNames {\r\n}\r\nHeaderNames.Authorization = \"Authorization\";\r\nHeaderNames.Cookie = \"Cookie\";\r\n//# sourceMappingURL=HeaderNames.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { HttpClient } from \"./HttpClient\";\r\n/** @private */\r\nexport class AccessTokenHttpClient extends HttpClient {\r\n    constructor(innerClient, accessTokenFactory) {\r\n        super();\r\n        this._innerClient = innerClient;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n    }\r\n    async send(request) {\r\n        let allowRetry = true;\r\n        if (this._accessTokenFactory && (!this._accessToken || (request.url && request.url.indexOf(\"/negotiate?\") > 0))) {\r\n            // don't retry if the request is a negotiate or if we just got a potentially new token from the access token factory\r\n            allowRetry = false;\r\n            this._accessToken = await this._accessTokenFactory();\r\n        }\r\n        this._setAuthorizationHeader(request);\r\n        const response = await this._innerClient.send(request);\r\n        if (allowRetry && response.statusCode === 401 && this._accessTokenFactory) {\r\n            this._accessToken = await this._accessTokenFactory();\r\n            this._setAuthorizationHeader(request);\r\n            return await this._innerClient.send(request);\r\n        }\r\n        return response;\r\n    }\r\n    _setAuthorizationHeader(request) {\r\n        if (!request.headers) {\r\n            request.headers = {};\r\n        }\r\n        if (this._accessToken) {\r\n            request.headers[HeaderNames.Authorization] = `Bearer ${this._accessToken}`;\r\n        }\r\n        // don't remove the header if there isn't an access token factory, the user manually added the header in this case\r\n        else if (this._accessTokenFactory) {\r\n            if (request.headers[HeaderNames.Authorization]) {\r\n                delete request.headers[HeaderNames.Authorization];\r\n            }\r\n        }\r\n    }\r\n    getCookieString(url) {\r\n        return this._innerClient.getCookieString(url);\r\n    }\r\n}\r\n//# sourceMappingURL=AccessTokenHttpClient.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// This will be treated as a bit flag in the future, so we keep it using power-of-two values.\r\n/** Specifies a specific HTTP transport type. */\r\nexport var HttpTransportType;\r\n(function (HttpTransportType) {\r\n    /** Specifies no transport preference. */\r\n    HttpTransportType[HttpTransportType[\"None\"] = 0] = \"None\";\r\n    /** Specifies the WebSockets transport. */\r\n    HttpTransportType[HttpTransportType[\"WebSockets\"] = 1] = \"WebSockets\";\r\n    /** Specifies the Server-Sent Events transport. */\r\n    HttpTransportType[HttpTransportType[\"ServerSentEvents\"] = 2] = \"ServerSentEvents\";\r\n    /** Specifies the Long Polling transport. */\r\n    HttpTransportType[HttpTransportType[\"LongPolling\"] = 4] = \"LongPolling\";\r\n})(HttpTransportType || (HttpTransportType = {}));\r\n/** Specifies the transfer format for a connection. */\r\nexport var TransferFormat;\r\n(function (TransferFormat) {\r\n    /** Specifies that only text data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Text\"] = 1] = \"Text\";\r\n    /** Specifies that binary data will be transmitted over the connection. */\r\n    TransferFormat[TransferFormat[\"Binary\"] = 2] = \"Binary\";\r\n})(TransferFormat || (TransferFormat = {}));\r\n//# sourceMappingURL=ITransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\n// Rough polyfill of https://developer.mozilla.org/en-US/docs/Web/API/AbortController\r\n// We don't actually ever use the API being polyfilled, we always use the polyfill because\r\n// it's a very new API right now.\r\n// Not exported from index.\r\n/** @private */\r\nexport class AbortController {\r\n    constructor() {\r\n        this._isAborted = false;\r\n        this.onabort = null;\r\n    }\r\n    abort() {\r\n        if (!this._isAborted) {\r\n            this._isAborted = true;\r\n            if (this.onabort) {\r\n                this.onabort();\r\n            }\r\n        }\r\n    }\r\n    get signal() {\r\n        return this;\r\n    }\r\n    get aborted() {\r\n        return this._isAborted;\r\n    }\r\n}\r\n//# sourceMappingURL=AbortController.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AbortController } from \"./AbortController\";\r\nimport { HttpError, TimeoutError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, sendMessage } from \"./Utils\";\r\n// Not exported from 'index', this type is internal.\r\n/** @private */\r\nexport class LongPollingTransport {\r\n    // This is an internal type, not exported from 'index' so this is really just internal.\r\n    get pollAborted() {\r\n        return this._pollAbort.aborted;\r\n    }\r\n    constructor(httpClient, logger, options) {\r\n        this._httpClient = httpClient;\r\n        this._logger = logger;\r\n        this._pollAbort = new AbortController();\r\n        this._options = options;\r\n        this._running = false;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._url = url;\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Connecting.\");\r\n        // Allow binary format on Node and Browsers that support binary content (indicated by the presence of responseType property)\r\n        if (transferFormat === TransferFormat.Binary &&\r\n            (typeof XMLHttpRequest !== \"undefined\" && typeof new XMLHttpRequest().responseType !== \"string\")) {\r\n            throw new Error(\"Binary protocols over XmlHttpRequest not implementing advanced features are not supported.\");\r\n        }\r\n        const [name, value] = getUserAgentHeader();\r\n        const headers = { [name]: value, ...this._options.headers };\r\n        const pollOptions = {\r\n            abortSignal: this._pollAbort.signal,\r\n            headers,\r\n            timeout: 100000,\r\n            withCredentials: this._options.withCredentials,\r\n        };\r\n        if (transferFormat === TransferFormat.Binary) {\r\n            pollOptions.responseType = \"arraybuffer\";\r\n        }\r\n        // Make initial long polling request\r\n        // Server uses first long polling request to finish initializing connection and it returns without data\r\n        const pollUrl = `${url}&_=${Date.now()}`;\r\n        this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n        const response = await this._httpClient.get(pollUrl, pollOptions);\r\n        if (response.statusCode !== 200) {\r\n            this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n            // Mark running as false so that the poll immediately ends and runs the close logic\r\n            this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n            this._running = false;\r\n        }\r\n        else {\r\n            this._running = true;\r\n        }\r\n        this._receiving = this._poll(this._url, pollOptions);\r\n    }\r\n    async _poll(url, pollOptions) {\r\n        try {\r\n            while (this._running) {\r\n                try {\r\n                    const pollUrl = `${url}&_=${Date.now()}`;\r\n                    this._logger.log(LogLevel.Trace, `(LongPolling transport) polling: ${pollUrl}.`);\r\n                    const response = await this._httpClient.get(pollUrl, pollOptions);\r\n                    if (response.statusCode === 204) {\r\n                        this._logger.log(LogLevel.Information, \"(LongPolling transport) Poll terminated by server.\");\r\n                        this._running = false;\r\n                    }\r\n                    else if (response.statusCode !== 200) {\r\n                        this._logger.log(LogLevel.Error, `(LongPolling transport) Unexpected response code: ${response.statusCode}.`);\r\n                        // Unexpected status code\r\n                        this._closeError = new HttpError(response.statusText || \"\", response.statusCode);\r\n                        this._running = false;\r\n                    }\r\n                    else {\r\n                        // Process the response\r\n                        if (response.content) {\r\n                            this._logger.log(LogLevel.Trace, `(LongPolling transport) data received. ${getDataDetail(response.content, this._options.logMessageContent)}.`);\r\n                            if (this.onreceive) {\r\n                                this.onreceive(response.content);\r\n                            }\r\n                        }\r\n                        else {\r\n                            // This is another way timeout manifest.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        }\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    if (!this._running) {\r\n                        // Log but disregard errors that occur after stopping\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Poll errored after shutdown: ${e.message}`);\r\n                    }\r\n                    else {\r\n                        if (e instanceof TimeoutError) {\r\n                            // Ignore timeouts and reissue the poll.\r\n                            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Poll timed out, reissuing.\");\r\n                        }\r\n                        else {\r\n                            // Close the connection with the error as the result.\r\n                            this._closeError = e;\r\n                            this._running = false;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Polling complete.\");\r\n            // We will reach here with pollAborted==false when the server returned a response causing the transport to stop.\r\n            // If pollAborted==true then client initiated the stop and the stop method will raise the close event after DELETE is sent.\r\n            if (!this.pollAborted) {\r\n                this._raiseOnClose();\r\n            }\r\n        }\r\n    }\r\n    async send(data) {\r\n        if (!this._running) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"LongPolling\", this._httpClient, this._url, data, this._options);\r\n    }\r\n    async stop() {\r\n        this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stopping polling.\");\r\n        // Tell receiving loop to stop, abort any current request, and then wait for it to finish\r\n        this._running = false;\r\n        this._pollAbort.abort();\r\n        try {\r\n            await this._receiving;\r\n            // Send DELETE to clean up long polling on the server\r\n            this._logger.log(LogLevel.Trace, `(LongPolling transport) sending DELETE request to ${this._url}.`);\r\n            const headers = {};\r\n            const [name, value] = getUserAgentHeader();\r\n            headers[name] = value;\r\n            const deleteOptions = {\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            };\r\n            let error;\r\n            try {\r\n                await this._httpClient.delete(this._url, deleteOptions);\r\n            }\r\n            catch (err) {\r\n                error = err;\r\n            }\r\n            if (error) {\r\n                if (error instanceof HttpError) {\r\n                    if (error.statusCode === 404) {\r\n                        this._logger.log(LogLevel.Trace, \"(LongPolling transport) A 404 response was returned from sending a DELETE request.\");\r\n                    }\r\n                    else {\r\n                        this._logger.log(LogLevel.Trace, `(LongPolling transport) Error sending a DELETE request: ${error}`);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Trace, \"(LongPolling transport) DELETE request accepted.\");\r\n            }\r\n        }\r\n        finally {\r\n            this._logger.log(LogLevel.Trace, \"(LongPolling transport) Stop finished.\");\r\n            // Raise close event here instead of in polling\r\n            // It needs to happen after the DELETE request is sent\r\n            this._raiseOnClose();\r\n        }\r\n    }\r\n    _raiseOnClose() {\r\n        if (this.onclose) {\r\n            let logMessage = \"(LongPolling transport) Firing onclose event.\";\r\n            if (this._closeError) {\r\n                logMessage += \" Error: \" + this._closeError;\r\n            }\r\n            this._logger.log(LogLevel.Trace, logMessage);\r\n            this.onclose(this._closeError);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=LongPollingTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform, sendMessage } from \"./Utils\";\r\n/** @private */\r\nexport class ServerSentEventsTransport {\r\n    constructor(httpClient, accessToken, logger, options) {\r\n        this._httpClient = httpClient;\r\n        this._accessToken = accessToken;\r\n        this._logger = logger;\r\n        this._options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Trace, \"(SSE transport) Connecting.\");\r\n        // set url before accessTokenFactory because this._url is only for send and we set the auth header instead of the query string for send\r\n        this._url = url;\r\n        if (this._accessToken) {\r\n            url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(this._accessToken)}`;\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            let opened = false;\r\n            if (transferFormat !== TransferFormat.Text) {\r\n                reject(new Error(\"The Server-Sent Events transport only supports the 'Text' transfer format\"));\r\n                return;\r\n            }\r\n            let eventSource;\r\n            if (Platform.isBrowser || Platform.isWebWorker) {\r\n                eventSource = new this._options.EventSource(url, { withCredentials: this._options.withCredentials });\r\n            }\r\n            else {\r\n                // Non-browser passes cookies via the dictionary\r\n                const cookies = this._httpClient.getCookieString(url);\r\n                const headers = {};\r\n                headers.Cookie = cookies;\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n                eventSource = new this._options.EventSource(url, { withCredentials: this._options.withCredentials, headers: { ...headers, ...this._options.headers } });\r\n            }\r\n            try {\r\n                eventSource.onmessage = (e) => {\r\n                    if (this.onreceive) {\r\n                        try {\r\n                            this._logger.log(LogLevel.Trace, `(SSE transport) data received. ${getDataDetail(e.data, this._options.logMessageContent)}.`);\r\n                            this.onreceive(e.data);\r\n                        }\r\n                        catch (error) {\r\n                            this._close(error);\r\n                            return;\r\n                        }\r\n                    }\r\n                };\r\n                // @ts-ignore: not using event on purpose\r\n                eventSource.onerror = (e) => {\r\n                    // EventSource doesn't give any useful information about server side closes.\r\n                    if (opened) {\r\n                        this._close();\r\n                    }\r\n                    else {\r\n                        reject(new Error(\"EventSource failed to connect. The connection could not be found on the server,\"\r\n                            + \" either the connection ID is not present on the server, or a proxy is refusing/buffering the connection.\"\r\n                            + \" If you have multiple servers check that sticky sessions are enabled.\"));\r\n                    }\r\n                };\r\n                eventSource.onopen = () => {\r\n                    this._logger.log(LogLevel.Information, `SSE connected to ${this._url}`);\r\n                    this._eventSource = eventSource;\r\n                    opened = true;\r\n                    resolve();\r\n                };\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n                return;\r\n            }\r\n        });\r\n    }\r\n    async send(data) {\r\n        if (!this._eventSource) {\r\n            return Promise.reject(new Error(\"Cannot send until the transport is connected\"));\r\n        }\r\n        return sendMessage(this._logger, \"SSE\", this._httpClient, this._url, data, this._options);\r\n    }\r\n    stop() {\r\n        this._close();\r\n        return Promise.resolve();\r\n    }\r\n    _close(e) {\r\n        if (this._eventSource) {\r\n            this._eventSource.close();\r\n            this._eventSource = undefined;\r\n            if (this.onclose) {\r\n                this.onclose(e);\r\n            }\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=ServerSentEventsTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { HeaderNames } from \"./HeaderNames\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { Arg, getDataDetail, getUserAgentHeader, Platform } from \"./Utils\";\r\n/** @private */\r\nexport class WebSocketTransport {\r\n    constructor(httpClient, accessTokenFactory, logger, logMessageContent, webSocketConstructor, headers) {\r\n        this._logger = logger;\r\n        this._accessTokenFactory = accessTokenFactory;\r\n        this._logMessageContent = logMessageContent;\r\n        this._webSocketConstructor = webSocketConstructor;\r\n        this._httpClient = httpClient;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n        this._headers = headers;\r\n    }\r\n    async connect(url, transferFormat) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isRequired(transferFormat, \"transferFormat\");\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) Connecting.\");\r\n        let token;\r\n        if (this._accessTokenFactory) {\r\n            token = await this._accessTokenFactory();\r\n        }\r\n        return new Promise((resolve, reject) => {\r\n            url = url.replace(/^http/, \"ws\");\r\n            let webSocket;\r\n            const cookies = this._httpClient.getCookieString(url);\r\n            let opened = false;\r\n            if (Platform.isNode || Platform.isReactNative) {\r\n                const headers = {};\r\n                const [name, value] = getUserAgentHeader();\r\n                headers[name] = value;\r\n                if (token) {\r\n                    headers[HeaderNames.Authorization] = `Bearer ${token}`;\r\n                }\r\n                if (cookies) {\r\n                    headers[HeaderNames.Cookie] = cookies;\r\n                }\r\n                // Only pass headers when in non-browser environments\r\n                webSocket = new this._webSocketConstructor(url, undefined, {\r\n                    headers: { ...headers, ...this._headers },\r\n                });\r\n            }\r\n            else {\r\n                if (token) {\r\n                    url += (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") + `access_token=${encodeURIComponent(token)}`;\r\n                }\r\n            }\r\n            if (!webSocket) {\r\n                // Chrome is not happy with passing 'undefined' as protocol\r\n                webSocket = new this._webSocketConstructor(url);\r\n            }\r\n            if (transferFormat === TransferFormat.Binary) {\r\n                webSocket.binaryType = \"arraybuffer\";\r\n            }\r\n            webSocket.onopen = (_event) => {\r\n                this._logger.log(LogLevel.Information, `WebSocket connected to ${url}.`);\r\n                this._webSocket = webSocket;\r\n                opened = true;\r\n                resolve();\r\n            };\r\n            webSocket.onerror = (event) => {\r\n                let error = null;\r\n                // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                    error = event.error;\r\n                }\r\n                else {\r\n                    error = \"There was an error with the transport\";\r\n                }\r\n                this._logger.log(LogLevel.Information, `(WebSockets transport) ${error}.`);\r\n            };\r\n            webSocket.onmessage = (message) => {\r\n                this._logger.log(LogLevel.Trace, `(WebSockets transport) data received. ${getDataDetail(message.data, this._logMessageContent)}.`);\r\n                if (this.onreceive) {\r\n                    try {\r\n                        this.onreceive(message.data);\r\n                    }\r\n                    catch (error) {\r\n                        this._close(error);\r\n                        return;\r\n                    }\r\n                }\r\n            };\r\n            webSocket.onclose = (event) => {\r\n                // Don't call close handler if connection was never established\r\n                // We'll reject the connect call instead\r\n                if (opened) {\r\n                    this._close(event);\r\n                }\r\n                else {\r\n                    let error = null;\r\n                    // ErrorEvent is a browser only type we need to check if the type exists before using it\r\n                    if (typeof ErrorEvent !== \"undefined\" && event instanceof ErrorEvent) {\r\n                        error = event.error;\r\n                    }\r\n                    else {\r\n                        error = \"WebSocket failed to connect. The connection could not be found on the server,\"\r\n                            + \" either the endpoint may not be a SignalR endpoint,\"\r\n                            + \" the connection ID is not present on the server, or there is a proxy blocking WebSockets.\"\r\n                            + \" If you have multiple servers check that sticky sessions are enabled.\";\r\n                    }\r\n                    reject(new Error(error));\r\n                }\r\n            };\r\n        });\r\n    }\r\n    send(data) {\r\n        if (this._webSocket && this._webSocket.readyState === this._webSocketConstructor.OPEN) {\r\n            this._logger.log(LogLevel.Trace, `(WebSockets transport) sending data. ${getDataDetail(data, this._logMessageContent)}.`);\r\n            this._webSocket.send(data);\r\n            return Promise.resolve();\r\n        }\r\n        return Promise.reject(\"WebSocket is not in the OPEN state\");\r\n    }\r\n    stop() {\r\n        if (this._webSocket) {\r\n            // Manually invoke onclose callback inline so we know the HttpConnection was closed properly before returning\r\n            // This also solves an issue where websocket.onclose could take 18+ seconds to trigger during network disconnects\r\n            this._close(undefined);\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    _close(event) {\r\n        // webSocket will be null if the transport did not start successfully\r\n        if (this._webSocket) {\r\n            // Clear websocket handlers because we are considering the socket closed now\r\n            this._webSocket.onclose = () => { };\r\n            this._webSocket.onmessage = () => { };\r\n            this._webSocket.onerror = () => { };\r\n            this._webSocket.close();\r\n            this._webSocket = undefined;\r\n        }\r\n        this._logger.log(LogLevel.Trace, \"(WebSockets transport) socket closed.\");\r\n        if (this.onclose) {\r\n            if (this._isCloseEvent(event) && (event.wasClean === false || event.code !== 1000)) {\r\n                this.onclose(new Error(`WebSocket closed with status code: ${event.code} (${event.reason || \"no reason given\"}).`));\r\n            }\r\n            else if (event instanceof Error) {\r\n                this.onclose(event);\r\n            }\r\n            else {\r\n                this.onclose();\r\n            }\r\n        }\r\n    }\r\n    _isCloseEvent(event) {\r\n        return event && typeof event.wasClean === \"boolean\" && typeof event.code === \"number\";\r\n    }\r\n}\r\n//# sourceMappingURL=WebSocketTransport.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { AccessTokenHttpClient } from \"./AccessTokenHttpClient\";\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { AggregateErrors, DisabledTransportError, FailedToNegotiateWithServerError, FailedToStartTransportError, HttpError, UnsupportedTransportError, AbortError } from \"./Errors\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger, getUserAgentHeader, Platform } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nconst MAX_REDIRECTS = 100;\r\n/** @private */\r\nexport class HttpConnection {\r\n    constructor(url, options = {}) {\r\n        this._stopPromiseResolver = () => { };\r\n        this.features = {};\r\n        this._negotiateVersion = 1;\r\n        Arg.isRequired(url, \"url\");\r\n        this._logger = createLogger(options.logger);\r\n        this.baseUrl = this._resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent === undefined ? false : options.logMessageContent;\r\n        if (typeof options.withCredentials === \"boolean\" || options.withCredentials === undefined) {\r\n            options.withCredentials = options.withCredentials === undefined ? true : options.withCredentials;\r\n        }\r\n        else {\r\n            throw new Error(\"withCredentials option was not a 'boolean' or 'undefined' value\");\r\n        }\r\n        options.timeout = options.timeout === undefined ? 100 * 1000 : options.timeout;\r\n        let webSocketModule = null;\r\n        let eventSourceModule = null;\r\n        if (Platform.isNode && typeof require !== \"undefined\") {\r\n            // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n            // @ts-ignore: TS doesn't know about these names\r\n            const requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n            webSocketModule = requireFunc(\"ws\");\r\n            eventSourceModule = requireFunc(\"eventsource\");\r\n        }\r\n        if (!Platform.isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (Platform.isNode && !options.WebSocket) {\r\n            if (webSocketModule) {\r\n                options.WebSocket = webSocketModule;\r\n            }\r\n        }\r\n        if (!Platform.isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (Platform.isNode && !options.EventSource) {\r\n            if (typeof eventSourceModule !== \"undefined\") {\r\n                options.EventSource = eventSourceModule;\r\n            }\r\n        }\r\n        this._httpClient = new AccessTokenHttpClient(options.httpClient || new DefaultHttpClient(this._logger), options.accessTokenFactory);\r\n        this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n        this._connectionStarted = false;\r\n        this._options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    async start(transferFormat) {\r\n        transferFormat = transferFormat || TransferFormat.Binary;\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this._logger.log(LogLevel.Debug, `Starting connection with transfer format '${TransferFormat[transferFormat]}'.`);\r\n        if (this._connectionState !== \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            return Promise.reject(new Error(\"Cannot start an HttpConnection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this._connectionState = \"Connecting\" /* ConnectionState.Connecting */;\r\n        this._startInternalPromise = this._startInternal(transferFormat);\r\n        await this._startInternalPromise;\r\n        // The TypeScript compiler thinks that connectionState must be Connecting here. The TypeScript compiler is wrong.\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"Failed to start the HttpConnection before stop() was called.\";\r\n            this._logger.log(LogLevel.Error, message);\r\n            // We cannot await stopPromise inside startInternal since stopInternal awaits the startInternalPromise.\r\n            await this._stopPromise;\r\n            return Promise.reject(new AbortError(message));\r\n        }\r\n        else if (this._connectionState !== \"Connected\" /* ConnectionState.Connected */) {\r\n            // stop() was called and transitioned the client into the Disconnecting state.\r\n            const message = \"HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!\";\r\n            this._logger.log(LogLevel.Error, message);\r\n            return Promise.reject(new AbortError(message));\r\n        }\r\n        this._connectionStarted = true;\r\n    }\r\n    send(data) {\r\n        if (this._connectionState !== \"Connected\" /* ConnectionState.Connected */) {\r\n            return Promise.reject(new Error(\"Cannot send data if the connection is not in the 'Connected' State.\"));\r\n        }\r\n        if (!this._sendQueue) {\r\n            this._sendQueue = new TransportSendQueue(this.transport);\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this._sendQueue.send(data);\r\n    }\r\n    async stop(error) {\r\n        if (this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnected state.`);\r\n            return Promise.resolve();\r\n        }\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stop(${error}) ignored because the connection is already in the disconnecting state.`);\r\n            return this._stopPromise;\r\n        }\r\n        this._connectionState = \"Disconnecting\" /* ConnectionState.Disconnecting */;\r\n        this._stopPromise = new Promise((resolve) => {\r\n            // Don't complete stop() until stopConnection() completes.\r\n            this._stopPromiseResolver = resolve;\r\n        });\r\n        // stopInternal should never throw so just observe it.\r\n        await this._stopInternal(error);\r\n        await this._stopPromise;\r\n    }\r\n    async _stopInternal(error) {\r\n        // Set error as soon as possible otherwise there is a race between\r\n        // the transport closing and providing an error and the error from a close message\r\n        // We would prefer the close message error.\r\n        this._stopError = error;\r\n        try {\r\n            await this._startInternalPromise;\r\n        }\r\n        catch (e) {\r\n            // This exception is returned to the user as a rejected Promise from the start method.\r\n        }\r\n        // The transport's onclose will trigger stopConnection which will run our onclose event.\r\n        // The transport should always be set if currently connected. If it wasn't set, it's likely because\r\n        // stop was called during start() and start() failed.\r\n        if (this.transport) {\r\n            try {\r\n                await this.transport.stop();\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.transport.stop() threw error '${e}'.`);\r\n                this._stopConnection();\r\n            }\r\n            this.transport = undefined;\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Debug, \"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.\");\r\n        }\r\n    }\r\n    async _startInternal(transferFormat) {\r\n        // Store the original base url and the access token factory since they may change\r\n        // as part of negotiating\r\n        let url = this.baseUrl;\r\n        this._accessTokenFactory = this._options.accessTokenFactory;\r\n        this._httpClient._accessTokenFactory = this._accessTokenFactory;\r\n        try {\r\n            if (this._options.skipNegotiation) {\r\n                if (this._options.transport === HttpTransportType.WebSockets) {\r\n                    // No need to add a connection ID in this case\r\n                    this.transport = this._constructTransport(HttpTransportType.WebSockets);\r\n                    // We should just call connect directly in this case.\r\n                    // No fallback or negotiate in this case.\r\n                    await this._startTransport(url, transferFormat);\r\n                }\r\n                else {\r\n                    throw new Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                }\r\n            }\r\n            else {\r\n                let negotiateResponse = null;\r\n                let redirects = 0;\r\n                do {\r\n                    negotiateResponse = await this._getNegotiationResponse(url);\r\n                    // the user tries to stop the connection when it is being started\r\n                    if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */ || this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n                        throw new AbortError(\"The connection was stopped during negotiation.\");\r\n                    }\r\n                    if (negotiateResponse.error) {\r\n                        throw new Error(negotiateResponse.error);\r\n                    }\r\n                    if (negotiateResponse.ProtocolVersion) {\r\n                        throw new Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                    }\r\n                    if (negotiateResponse.url) {\r\n                        url = negotiateResponse.url;\r\n                    }\r\n                    if (negotiateResponse.accessToken) {\r\n                        // Replace the current access token factory with one that uses\r\n                        // the returned access token\r\n                        const accessToken = negotiateResponse.accessToken;\r\n                        this._accessTokenFactory = () => accessToken;\r\n                        // set the factory to undefined so the AccessTokenHttpClient won't retry with the same token, since we know it won't change until a connection restart\r\n                        this._httpClient._accessToken = accessToken;\r\n                        this._httpClient._accessTokenFactory = undefined;\r\n                    }\r\n                    redirects++;\r\n                } while (negotiateResponse.url && redirects < MAX_REDIRECTS);\r\n                if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                    throw new Error(\"Negotiate redirection limit exceeded.\");\r\n                }\r\n                await this._createTransport(url, this._options.transport, negotiateResponse, transferFormat);\r\n            }\r\n            if (this.transport instanceof LongPollingTransport) {\r\n                this.features.inherentKeepAlive = true;\r\n            }\r\n            if (this._connectionState === \"Connecting\" /* ConnectionState.Connecting */) {\r\n                // Ensure the connection transitions to the connected state prior to completing this.startInternalPromise.\r\n                // start() will handle the case when stop was called and startInternal exits still in the disconnecting state.\r\n                this._logger.log(LogLevel.Debug, \"The HttpConnection connected successfully.\");\r\n                this._connectionState = \"Connected\" /* ConnectionState.Connected */;\r\n            }\r\n            // stop() is waiting on us via this.startInternalPromise so keep this.transport around so it can clean up.\r\n            // This is the only case startInternal can exit in neither the connected nor disconnected state because stopConnection()\r\n            // will transition to the disconnected state. start() will wait for the transition using the stopPromise.\r\n        }\r\n        catch (e) {\r\n            this._logger.log(LogLevel.Error, \"Failed to start the connection: \" + e);\r\n            this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n            this.transport = undefined;\r\n            // if start fails, any active calls to stop assume that start will complete the stop promise\r\n            this._stopPromiseResolver();\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    async _getNegotiationResponse(url) {\r\n        const headers = {};\r\n        const [name, value] = getUserAgentHeader();\r\n        headers[name] = value;\r\n        const negotiateUrl = this._resolveNegotiateUrl(url);\r\n        this._logger.log(LogLevel.Debug, `Sending negotiation request: ${negotiateUrl}.`);\r\n        try {\r\n            const response = await this._httpClient.post(negotiateUrl, {\r\n                content: \"\",\r\n                headers: { ...headers, ...this._options.headers },\r\n                timeout: this._options.timeout,\r\n                withCredentials: this._options.withCredentials,\r\n            });\r\n            if (response.statusCode !== 200) {\r\n                return Promise.reject(new Error(`Unexpected status code returned from negotiate '${response.statusCode}'`));\r\n            }\r\n            const negotiateResponse = JSON.parse(response.content);\r\n            if (!negotiateResponse.negotiateVersion || negotiateResponse.negotiateVersion < 1) {\r\n                // Negotiate version 0 doesn't use connectionToken\r\n                // So we set it equal to connectionId so all our logic can use connectionToken without being aware of the negotiate version\r\n                negotiateResponse.connectionToken = negotiateResponse.connectionId;\r\n            }\r\n            if (negotiateResponse.useStatefulReconnect && this._options._useStatefulReconnect !== true) {\r\n                return Promise.reject(new FailedToNegotiateWithServerError(\"Client didn't negotiate Stateful Reconnect but the server did.\"));\r\n            }\r\n            return negotiateResponse;\r\n        }\r\n        catch (e) {\r\n            let errorMessage = \"Failed to complete negotiation with the server: \" + e;\r\n            if (e instanceof HttpError) {\r\n                if (e.statusCode === 404) {\r\n                    errorMessage = errorMessage + \" Either this is not a SignalR endpoint or there is a proxy blocking the connection.\";\r\n                }\r\n            }\r\n            this._logger.log(LogLevel.Error, errorMessage);\r\n            return Promise.reject(new FailedToNegotiateWithServerError(errorMessage));\r\n        }\r\n    }\r\n    _createConnectUrl(url, connectionToken) {\r\n        if (!connectionToken) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + `id=${connectionToken}`;\r\n    }\r\n    async _createTransport(url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        let connectUrl = this._createConnectUrl(url, negotiateResponse.connectionToken);\r\n        if (this._isITransport(requestedTransport)) {\r\n            this._logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n            this.transport = requestedTransport;\r\n            await this._startTransport(connectUrl, requestedTransferFormat);\r\n            this.connectionId = negotiateResponse.connectionId;\r\n            return;\r\n        }\r\n        const transportExceptions = [];\r\n        const transports = negotiateResponse.availableTransports || [];\r\n        let negotiate = negotiateResponse;\r\n        for (const endpoint of transports) {\r\n            const transportOrError = this._resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat, (negotiate === null || negotiate === void 0 ? void 0 : negotiate.useStatefulReconnect) === true);\r\n            if (transportOrError instanceof Error) {\r\n                // Store the error and continue, we don't want to cause a re-negotiate in these cases\r\n                transportExceptions.push(`${endpoint.transport} failed:`);\r\n                transportExceptions.push(transportOrError);\r\n            }\r\n            else if (this._isITransport(transportOrError)) {\r\n                this.transport = transportOrError;\r\n                if (!negotiate) {\r\n                    try {\r\n                        negotiate = await this._getNegotiationResponse(url);\r\n                    }\r\n                    catch (ex) {\r\n                        return Promise.reject(ex);\r\n                    }\r\n                    connectUrl = this._createConnectUrl(url, negotiate.connectionToken);\r\n                }\r\n                try {\r\n                    await this._startTransport(connectUrl, requestedTransferFormat);\r\n                    this.connectionId = negotiate.connectionId;\r\n                    return;\r\n                }\r\n                catch (ex) {\r\n                    this._logger.log(LogLevel.Error, `Failed to start the transport '${endpoint.transport}': ${ex}`);\r\n                    negotiate = undefined;\r\n                    transportExceptions.push(new FailedToStartTransportError(`${endpoint.transport} failed: ${ex}`, HttpTransportType[endpoint.transport]));\r\n                    if (this._connectionState !== \"Connecting\" /* ConnectionState.Connecting */) {\r\n                        const message = \"Failed to select transport before stop() was called.\";\r\n                        this._logger.log(LogLevel.Debug, message);\r\n                        return Promise.reject(new AbortError(message));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (transportExceptions.length > 0) {\r\n            return Promise.reject(new AggregateErrors(`Unable to connect to the server with any of the available transports. ${transportExceptions.join(\" \")}`, transportExceptions));\r\n        }\r\n        return Promise.reject(new Error(\"None of the transports supported by the client are supported by the server.\"));\r\n    }\r\n    _constructTransport(transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this._options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this._httpClient, this._accessTokenFactory, this._logger, this._options.logMessageContent, this._options.WebSocket, this._options.headers || {});\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this._options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this._httpClient, this._httpClient._accessToken, this._logger, this._options);\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this._httpClient, this._logger, this._options);\r\n            default:\r\n                throw new Error(`Unknown transport: ${transport}.`);\r\n        }\r\n    }\r\n    _startTransport(url, transferFormat) {\r\n        this.transport.onreceive = this.onreceive;\r\n        if (this.features.reconnect) {\r\n            this.transport.onclose = async (e) => {\r\n                let callStop = false;\r\n                if (this.features.reconnect) {\r\n                    try {\r\n                        this.features.disconnected();\r\n                        await this.transport.connect(url, transferFormat);\r\n                        await this.features.resend();\r\n                    }\r\n                    catch {\r\n                        callStop = true;\r\n                    }\r\n                }\r\n                else {\r\n                    this._stopConnection(e);\r\n                    return;\r\n                }\r\n                if (callStop) {\r\n                    this._stopConnection(e);\r\n                }\r\n            };\r\n        }\r\n        else {\r\n            this.transport.onclose = (e) => this._stopConnection(e);\r\n        }\r\n        return this.transport.connect(url, transferFormat);\r\n    }\r\n    _resolveTransportOrError(endpoint, requestedTransport, requestedTransferFormat, useStatefulReconnect) {\r\n        const transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this._logger.log(LogLevel.Debug, `Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n            return new Error(`Skipping transport '${endpoint.transport}' because it is not supported by this client.`);\r\n        }\r\n        else {\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                const transferFormats = endpoint.transferFormats.map((s) => TransferFormat[s]);\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this._options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this._options.EventSource)) {\r\n                        this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it is not supported in your environment.'`);\r\n                        return new UnsupportedTransportError(`'${HttpTransportType[transport]}' is not supported in your environment.`, transport);\r\n                    }\r\n                    else {\r\n                        this._logger.log(LogLevel.Debug, `Selecting transport '${HttpTransportType[transport]}'.`);\r\n                        try {\r\n                            this.features.reconnect = transport === HttpTransportType.WebSockets ? useStatefulReconnect : undefined;\r\n                            return this._constructTransport(transport);\r\n                        }\r\n                        catch (ex) {\r\n                            return ex;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it does not support the requested transfer format '${TransferFormat[requestedTransferFormat]}'.`);\r\n                    return new Error(`'${HttpTransportType[transport]}' does not support ${TransferFormat[requestedTransferFormat]}.`);\r\n                }\r\n            }\r\n            else {\r\n                this._logger.log(LogLevel.Debug, `Skipping transport '${HttpTransportType[transport]}' because it was disabled by the client.`);\r\n                return new DisabledTransportError(`'${HttpTransportType[transport]}' is disabled by the client.`, transport);\r\n            }\r\n        }\r\n    }\r\n    _isITransport(transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    }\r\n    _stopConnection(error) {\r\n        this._logger.log(LogLevel.Debug, `HttpConnection.stopConnection(${error}) called while in state ${this._connectionState}.`);\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this._stopError || error;\r\n        this._stopError = undefined;\r\n        if (this._connectionState === \"Disconnected\" /* ConnectionState.Disconnected */) {\r\n            this._logger.log(LogLevel.Debug, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is already in the disconnected state.`);\r\n            return;\r\n        }\r\n        if (this._connectionState === \"Connecting\" /* ConnectionState.Connecting */) {\r\n            this._logger.log(LogLevel.Warning, `Call to HttpConnection.stopConnection(${error}) was ignored because the connection is still in the connecting state.`);\r\n            throw new Error(`HttpConnection.stopConnection(${error}) was called while the connection is still in the connecting state.`);\r\n        }\r\n        if (this._connectionState === \"Disconnecting\" /* ConnectionState.Disconnecting */) {\r\n            // A call to stop() induced this call to stopConnection and needs to be completed.\r\n            // Any stop() awaiters will be scheduled to continue after the onclose callback fires.\r\n            this._stopPromiseResolver();\r\n        }\r\n        if (error) {\r\n            this._logger.log(LogLevel.Error, `Connection disconnected with error '${error}'.`);\r\n        }\r\n        else {\r\n            this._logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        if (this._sendQueue) {\r\n            this._sendQueue.stop().catch((e) => {\r\n                this._logger.log(LogLevel.Error, `TransportSendQueue.stop() threw error '${e}'.`);\r\n            });\r\n            this._sendQueue = undefined;\r\n        }\r\n        this.connectionId = undefined;\r\n        this._connectionState = \"Disconnected\" /* ConnectionState.Disconnected */;\r\n        if (this._connectionStarted) {\r\n            this._connectionStarted = false;\r\n            try {\r\n                if (this.onclose) {\r\n                    this.onclose(error);\r\n                }\r\n            }\r\n            catch (e) {\r\n                this._logger.log(LogLevel.Error, `HttpConnection.onclose(${error}) threw error '${e}'.`);\r\n            }\r\n        }\r\n    }\r\n    _resolveUrl(url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (!Platform.isBrowser) {\r\n            throw new Error(`Cannot resolve '${url}'.`);\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        const aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this._logger.log(LogLevel.Information, `Normalizing '${url}' to '${aTag.href}'.`);\r\n        return aTag.href;\r\n    }\r\n    _resolveNegotiateUrl(url) {\r\n        const negotiateUrl = new URL(url);\r\n        if (negotiateUrl.pathname.endsWith('/')) {\r\n            negotiateUrl.pathname += \"negotiate\";\r\n        }\r\n        else {\r\n            negotiateUrl.pathname += \"/negotiate\";\r\n        }\r\n        const searchParams = new URLSearchParams(negotiateUrl.searchParams);\r\n        if (!searchParams.has(\"negotiateVersion\")) {\r\n            searchParams.append(\"negotiateVersion\", this._negotiateVersion.toString());\r\n        }\r\n        if (searchParams.has(\"useStatefulReconnect\")) {\r\n            if (searchParams.get(\"useStatefulReconnect\") === \"true\") {\r\n                this._options._useStatefulReconnect = true;\r\n            }\r\n        }\r\n        else if (this._options._useStatefulReconnect === true) {\r\n            searchParams.append(\"useStatefulReconnect\", \"true\");\r\n        }\r\n        negotiateUrl.search = searchParams.toString();\r\n        return negotiateUrl.toString();\r\n    }\r\n}\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n/** @private */\r\nexport class TransportSendQueue {\r\n    constructor(_transport) {\r\n        this._transport = _transport;\r\n        this._buffer = [];\r\n        this._executing = true;\r\n        this._sendBufferedData = new PromiseSource();\r\n        this._transportResult = new PromiseSource();\r\n        this._sendLoopPromise = this._sendLoop();\r\n    }\r\n    send(data) {\r\n        this._bufferData(data);\r\n        if (!this._transportResult) {\r\n            this._transportResult = new PromiseSource();\r\n        }\r\n        return this._transportResult.promise;\r\n    }\r\n    stop() {\r\n        this._executing = false;\r\n        this._sendBufferedData.resolve();\r\n        return this._sendLoopPromise;\r\n    }\r\n    _bufferData(data) {\r\n        if (this._buffer.length && typeof (this._buffer[0]) !== typeof (data)) {\r\n            throw new Error(`Expected data to be of type ${typeof (this._buffer)} but was of type ${typeof (data)}`);\r\n        }\r\n        this._buffer.push(data);\r\n        this._sendBufferedData.resolve();\r\n    }\r\n    async _sendLoop() {\r\n        while (true) {\r\n            await this._sendBufferedData.promise;\r\n            if (!this._executing) {\r\n                if (this._transportResult) {\r\n                    this._transportResult.reject(\"Connection stopped.\");\r\n                }\r\n                break;\r\n            }\r\n            this._sendBufferedData = new PromiseSource();\r\n            const transportResult = this._transportResult;\r\n            this._transportResult = undefined;\r\n            const data = typeof (this._buffer[0]) === \"string\" ?\r\n                this._buffer.join(\"\") :\r\n                TransportSendQueue._concatBuffers(this._buffer);\r\n            this._buffer.length = 0;\r\n            try {\r\n                await this._transport.send(data);\r\n                transportResult.resolve();\r\n            }\r\n            catch (error) {\r\n                transportResult.reject(error);\r\n            }\r\n        }\r\n    }\r\n    static _concatBuffers(arrayBuffers) {\r\n        const totalLength = arrayBuffers.map((b) => b.byteLength).reduce((a, b) => a + b);\r\n        const result = new Uint8Array(totalLength);\r\n        let offset = 0;\r\n        for (const item of arrayBuffers) {\r\n            result.set(new Uint8Array(item), offset);\r\n            offset += item.byteLength;\r\n        }\r\n        return result.buffer;\r\n    }\r\n}\r\nclass PromiseSource {\r\n    constructor() {\r\n        this.promise = new Promise((resolve, reject) => [this._resolver, this._rejecter] = [resolve, reject]);\r\n    }\r\n    resolve() {\r\n        this._resolver();\r\n    }\r\n    reject(reason) {\r\n        this._rejecter(reason);\r\n    }\r\n}\r\n//# sourceMappingURL=HttpConnection.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { MessageType } from \"./IHubProtocol\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { TransferFormat } from \"./ITransport\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { TextMessageFormat } from \"./TextMessageFormat\";\r\nconst JSON_HUB_PROTOCOL_NAME = \"json\";\r\n/** Implements the JSON Hub Protocol. */\r\nexport class JsonHubProtocol {\r\n    constructor() {\r\n        /** @inheritDoc */\r\n        this.name = JSON_HUB_PROTOCOL_NAME;\r\n        /** @inheritDoc */\r\n        this.version = 2;\r\n        /** @inheritDoc */\r\n        this.transferFormat = TransferFormat.Text;\r\n    }\r\n    /** Creates an array of {@link @microsoft/signalr.HubMessage} objects from the specified serialized representation.\r\n     *\r\n     * @param {string} input A string containing the serialized representation.\r\n     * @param {ILogger} logger A logger that will be used to log messages that occur during parsing.\r\n     */\r\n    parseMessages(input, logger) {\r\n        // The interface does allow \"ArrayBuffer\" to be passed in, but this implementation does not. So let's throw a useful error.\r\n        if (typeof input !== \"string\") {\r\n            throw new Error(\"Invalid input for JSON hub protocol. Expected a string.\");\r\n        }\r\n        if (!input) {\r\n            return [];\r\n        }\r\n        if (logger === null) {\r\n            logger = NullLogger.instance;\r\n        }\r\n        // Parse the messages\r\n        const messages = TextMessageFormat.parse(input);\r\n        const hubMessages = [];\r\n        for (const message of messages) {\r\n            const parsedMessage = JSON.parse(message);\r\n            if (typeof parsedMessage.type !== \"number\") {\r\n                throw new Error(\"Invalid payload.\");\r\n            }\r\n            switch (parsedMessage.type) {\r\n                case MessageType.Invocation:\r\n                    this._isInvocationMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.StreamItem:\r\n                    this._isStreamItemMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Completion:\r\n                    this._isCompletionMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Ping:\r\n                    // Single value, no need to validate\r\n                    break;\r\n                case MessageType.Close:\r\n                    // All optional values, no need to validate\r\n                    break;\r\n                case MessageType.Ack:\r\n                    this._isAckMessage(parsedMessage);\r\n                    break;\r\n                case MessageType.Sequence:\r\n                    this._isSequenceMessage(parsedMessage);\r\n                    break;\r\n                default:\r\n                    // Future protocol changes can add message types, old clients can ignore them\r\n                    logger.log(LogLevel.Information, \"Unknown message type '\" + parsedMessage.type + \"' ignored.\");\r\n                    continue;\r\n            }\r\n            hubMessages.push(parsedMessage);\r\n        }\r\n        return hubMessages;\r\n    }\r\n    /** Writes the specified {@link @microsoft/signalr.HubMessage} to a string and returns it.\r\n     *\r\n     * @param {HubMessage} message The message to write.\r\n     * @returns {string} A string containing the serialized representation of the message.\r\n     */\r\n    writeMessage(message) {\r\n        return TextMessageFormat.write(JSON.stringify(message));\r\n    }\r\n    _isInvocationMessage(message) {\r\n        this._assertNotEmptyString(message.target, \"Invalid payload for Invocation message.\");\r\n        if (message.invocationId !== undefined) {\r\n            this._assertNotEmptyString(message.invocationId, \"Invalid payload for Invocation message.\");\r\n        }\r\n    }\r\n    _isStreamItemMessage(message) {\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for StreamItem message.\");\r\n        if (message.item === undefined) {\r\n            throw new Error(\"Invalid payload for StreamItem message.\");\r\n        }\r\n    }\r\n    _isCompletionMessage(message) {\r\n        if (message.result && message.error) {\r\n            throw new Error(\"Invalid payload for Completion message.\");\r\n        }\r\n        if (!message.result && message.error) {\r\n            this._assertNotEmptyString(message.error, \"Invalid payload for Completion message.\");\r\n        }\r\n        this._assertNotEmptyString(message.invocationId, \"Invalid payload for Completion message.\");\r\n    }\r\n    _isAckMessage(message) {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Ack message.\");\r\n        }\r\n    }\r\n    _isSequenceMessage(message) {\r\n        if (typeof message.sequenceId !== 'number') {\r\n            throw new Error(\"Invalid SequenceId for Sequence message.\");\r\n        }\r\n    }\r\n    _assertNotEmptyString(value, errorMessage) {\r\n        if (typeof value !== \"string\" || value === \"\") {\r\n            throw new Error(errorMessage);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=JsonHubProtocol.js.map","// Licensed to the .NET Foundation under one or more agreements.\r\n// The .NET Foundation licenses this file to you under the MIT license.\r\nimport { DefaultReconnectPolicy } from \"./DefaultReconnectPolicy\";\r\nimport { HttpConnection } from \"./HttpConnection\";\r\nimport { HubConnection } from \"./HubConnection\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { JsonHubProtocol } from \"./JsonHubProtocol\";\r\nimport { NullLogger } from \"./Loggers\";\r\nimport { Arg, ConsoleLogger } from \"./Utils\";\r\nconst LogLevelNameMapping = {\r\n    trace: LogLevel.Trace,\r\n    debug: LogLevel.Debug,\r\n    info: LogLevel.Information,\r\n    information: LogLevel.Information,\r\n    warn: LogLevel.Warning,\r\n    warning: LogLevel.Warning,\r\n    error: LogLevel.Error,\r\n    critical: LogLevel.Critical,\r\n    none: LogLevel.None,\r\n};\r\nfunction parseLogLevel(name) {\r\n    // Case-insensitive matching via lower-casing\r\n    // Yes, I know case-folding is a complicated problem in Unicode, but we only support\r\n    // the ASCII strings defined in LogLevelNameMapping anyway, so it's fine -anurse.\r\n    const mapping = LogLevelNameMapping[name.toLowerCase()];\r\n    if (typeof mapping !== \"undefined\") {\r\n        return mapping;\r\n    }\r\n    else {\r\n        throw new Error(`Unknown log level: ${name}`);\r\n    }\r\n}\r\n/** A builder for configuring {@link @microsoft/signalr.HubConnection} instances. */\r\nexport class HubConnectionBuilder {\r\n    configureLogging(logging) {\r\n        Arg.isRequired(logging, \"logging\");\r\n        if (isLogger(logging)) {\r\n            this.logger = logging;\r\n        }\r\n        else if (typeof logging === \"string\") {\r\n            const logLevel = parseLogLevel(logging);\r\n            this.logger = new ConsoleLogger(logLevel);\r\n        }\r\n        else {\r\n            this.logger = new ConsoleLogger(logging);\r\n        }\r\n        return this;\r\n    }\r\n    withUrl(url, transportTypeOrOptions) {\r\n        Arg.isRequired(url, \"url\");\r\n        Arg.isNotEmpty(url, \"url\");\r\n        this.url = url;\r\n        // Flow-typing knows where it's at. Since HttpTransportType is a number and IHttpConnectionOptions is guaranteed\r\n        // to be an object, we know (as does TypeScript) this comparison is all we need to figure out which overload was called.\r\n        if (typeof transportTypeOrOptions === \"object\") {\r\n            this.httpConnectionOptions = { ...this.httpConnectionOptions, ...transportTypeOrOptions };\r\n        }\r\n        else {\r\n            this.httpConnectionOptions = {\r\n                ...this.httpConnectionOptions,\r\n                transport: transportTypeOrOptions,\r\n            };\r\n        }\r\n        return this;\r\n    }\r\n    /** Configures the {@link @microsoft/signalr.HubConnection} to use the specified Hub Protocol.\r\n     *\r\n     * @param {IHubProtocol} protocol The {@link @microsoft/signalr.IHubProtocol} implementation to use.\r\n     */\r\n    withHubProtocol(protocol) {\r\n        Arg.isRequired(protocol, \"protocol\");\r\n        this.protocol = protocol;\r\n        return this;\r\n    }\r\n    withAutomaticReconnect(retryDelaysOrReconnectPolicy) {\r\n        if (this.reconnectPolicy) {\r\n            throw new Error(\"A reconnectPolicy has already been set.\");\r\n        }\r\n        if (!retryDelaysOrReconnectPolicy) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy();\r\n        }\r\n        else if (Array.isArray(retryDelaysOrReconnectPolicy)) {\r\n            this.reconnectPolicy = new DefaultReconnectPolicy(retryDelaysOrReconnectPolicy);\r\n        }\r\n        else {\r\n            this.reconnectPolicy = retryDelaysOrReconnectPolicy;\r\n        }\r\n        return this;\r\n    }\r\n    /** Configures {@link @microsoft/signalr.HubConnection.serverTimeoutInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withServerTimeout(milliseconds) {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n        this._serverTimeoutInMilliseconds = milliseconds;\r\n        return this;\r\n    }\r\n    /** Configures {@link @microsoft/signalr.HubConnection.keepAliveIntervalInMilliseconds} for the {@link @microsoft/signalr.HubConnection}.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withKeepAliveInterval(milliseconds) {\r\n        Arg.isRequired(milliseconds, \"milliseconds\");\r\n        this._keepAliveIntervalInMilliseconds = milliseconds;\r\n        return this;\r\n    }\r\n    /** Enables and configures options for the Stateful Reconnect feature.\r\n     *\r\n     * @returns The {@link @microsoft/signalr.HubConnectionBuilder} instance, for chaining.\r\n     */\r\n    withStatefulReconnect(options) {\r\n        if (this.httpConnectionOptions === undefined) {\r\n            this.httpConnectionOptions = {};\r\n        }\r\n        this.httpConnectionOptions._useStatefulReconnect = true;\r\n        this._statefulReconnectBufferSize = options === null || options === void 0 ? void 0 : options.bufferSize;\r\n        return this;\r\n    }\r\n    /** Creates a {@link @microsoft/signalr.HubConnection} from the configuration options specified in this builder.\r\n     *\r\n     * @returns {HubConnection} The configured {@link @microsoft/signalr.HubConnection}.\r\n     */\r\n    build() {\r\n        // If httpConnectionOptions has a logger, use it. Otherwise, override it with the one\r\n        // provided to configureLogger\r\n        const httpConnectionOptions = this.httpConnectionOptions || {};\r\n        // If it's 'null', the user **explicitly** asked for null, don't mess with it.\r\n        if (httpConnectionOptions.logger === undefined) {\r\n            // If our logger is undefined or null, that's OK, the HttpConnection constructor will handle it.\r\n            httpConnectionOptions.logger = this.logger;\r\n        }\r\n        // Now create the connection\r\n        if (!this.url) {\r\n            throw new Error(\"The 'HubConnectionBuilder.withUrl' method must be called before building the connection.\");\r\n        }\r\n        const connection = new HttpConnection(this.url, httpConnectionOptions);\r\n        return HubConnection.create(connection, this.logger || NullLogger.instance, this.protocol || new JsonHubProtocol(), this.reconnectPolicy, this._serverTimeoutInMilliseconds, this._keepAliveIntervalInMilliseconds, this._statefulReconnectBufferSize);\r\n    }\r\n}\r\nfunction isLogger(logger) {\r\n    return logger.log !== undefined;\r\n}\r\n//# sourceMappingURL=HubConnectionBuilder.js.map","import { HubConnection, HubConnectionBuilder, HubConnectionState, LogLevel } from '@microsoft/signalr';\r\n\r\nexport interface AgentMessage {\r\n  agentName: string;\r\n  content: string;\r\n  timestamp: string;\r\n  confidence?: number;\r\n  suggestedActions?: string[];\r\n}\r\n\r\nexport interface AgentHandoffNotification {\r\n  fromAgent: string;\r\n  toAgent: string;\r\n  reason: string;\r\n  timestamp: string;\r\n  userContext?: any;\r\n}\r\n\r\nexport interface AgentTypingNotification {\r\n  agentName: string;\r\n  isTyping: boolean;\r\n  timestamp: string;\r\n}\r\n\r\nexport interface UserMessage {\r\n  content: string;\r\n  timestamp: string;\r\n  audioData?: string;\r\n  metadata?: {\r\n    speechConfidence?: number;\r\n    voiceActivityLevel?: number;\r\n    processingTime?: number;\r\n  };\r\n}\r\n\r\nexport interface SessionStatus {\r\n  sessionId: string;\r\n  currentAgent: string;\r\n  status: 'active' | 'handoff' | 'crisis' | 'complete';\r\n  timestamp: string;\r\n  participants: string[];\r\n}\r\n\r\nexport class SignalRService {\r\n  private connection: HubConnection | null = null;\r\n  private sessionId: string | null = null;\r\n  \r\n  // Event handlers\r\n  private onAgentMessageHandler?: (message: AgentMessage) => void;\r\n  private onHandoffHandler?: (notification: AgentHandoffNotification) => void;\r\n  private onAgentTypingHandler?: (notification: AgentTypingNotification) => void;\r\n  private onSessionStatusHandler?: (status: SessionStatus) => void;\r\n  private onErrorHandler?: (error: string) => void;\r\n\r\n  constructor(private baseUrl: string = 'http://localhost:7071') {\r\n    this.setupConnection();\r\n  }\r\n\r\n  private setupConnection(): void {\r\n    this.connection = new HubConnectionBuilder()\r\n      .withUrl(`${this.baseUrl}/api`)\r\n      .withAutomaticReconnect()\r\n      .configureLogging(LogLevel.Information)\r\n      .build();\r\n\r\n    // Set up event listeners\r\n    this.connection.on('AgentMessage', (message: AgentMessage) => {\r\n      console.log('Received agent message:', message);\r\n      this.onAgentMessageHandler?.(message);\r\n    });\r\n\r\n    this.connection.on('AgentHandoff', (notification: AgentHandoffNotification) => {\r\n      console.log('Received handoff notification:', notification);\r\n      this.onHandoffHandler?.(notification);\r\n    });\r\n\r\n    this.connection.on('AgentTyping', (notification: AgentTypingNotification) => {\r\n      console.log('Received typing notification:', notification);\r\n      this.onAgentTypingHandler?.(notification);\r\n    });\r\n\r\n    this.connection.on('SessionStatus', (status: SessionStatus) => {\r\n      console.log('Received session status:', status);\r\n      this.onSessionStatusHandler?.(status);\r\n    });\r\n\r\n    // Handle connection events\r\n    this.connection.onreconnecting(() => {\r\n      console.log('SignalR reconnecting...');\r\n    });\r\n\r\n    this.connection.onreconnected(() => {\r\n      console.log('SignalR reconnected');\r\n      // Rejoin session if we have one\r\n      if (this.sessionId) {\r\n        this.joinSession(this.sessionId);\r\n      }\r\n    });\r\n\r\n    this.connection.onclose((error?: Error) => {\r\n      console.error('SignalR connection closed:', error);\r\n      this.onErrorHandler?.(`Connection closed: ${error?.message || 'Unknown error'}`);\r\n    });\r\n  }\r\n\r\n  async start(): Promise<void> {\r\n    if (!this.connection) {\r\n      throw new Error('SignalR connection not initialized');\r\n    }\r\n\r\n    try {\r\n      await this.connection.start();\r\n      console.log('SignalR connection started');\r\n    } catch (error) {\r\n      console.error('Error starting SignalR connection:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async stop(): Promise<void> {\r\n    if (this.connection && this.connection.state === HubConnectionState.Connected) {\r\n      await this.connection.stop();\r\n      console.log('SignalR connection stopped');\r\n    }\r\n  }\r\n\r\n  async joinSession(sessionId: string): Promise<void> {\r\n    if (!this.connection || this.connection.state !== HubConnectionState.Connected) {\r\n      throw new Error('SignalR connection is not active');\r\n    }\r\n\r\n    try {\r\n      this.sessionId = sessionId;\r\n      await this.connection.invoke('JoinSession', sessionId);\r\n      console.log(`Joined session: ${sessionId}`);\r\n    } catch (error) {\r\n      console.error('Error joining session:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async sendUserMessage(message: UserMessage): Promise<void> {\r\n    if (!this.connection || this.connection.state !== HubConnectionState.Connected) {\r\n      throw new Error('SignalR connection is not active');\r\n    }\r\n\r\n    if (!this.sessionId) {\r\n      throw new Error('No active session');\r\n    }\r\n\r\n    try {\r\n      await this.connection.invoke('SendUserMessage', this.sessionId, message);\r\n      console.log('User message sent:', message);\r\n    } catch (error) {\r\n      console.error('Error sending user message:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getSessionStatus(): Promise<SessionStatus | null> {\r\n    if (!this.connection || this.connection.state !== HubConnectionState.Connected) {\r\n      throw new Error('SignalR connection is not active');\r\n    }\r\n\r\n    if (!this.sessionId) {\r\n      return null;\r\n    }\r\n\r\n    try {\r\n      const status = await this.connection.invoke('GetSessionStatus', this.sessionId);\r\n      return status;\r\n    } catch (error) {\r\n      console.error('Error getting session status:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Event handler setters\r\n  onAgentMessage(handler: (message: AgentMessage) => void): void {\r\n    this.onAgentMessageHandler = handler;\r\n  }\r\n\r\n  onAgentHandoff(handler: (notification: AgentHandoffNotification) => void): void {\r\n    this.onHandoffHandler = handler;\r\n  }\r\n\r\n  onAgentTyping(handler: (notification: AgentTypingNotification) => void): void {\r\n    this.onAgentTypingHandler = handler;\r\n  }\r\n\r\n  onSessionStatus(handler: (status: SessionStatus) => void): void {\r\n    this.onSessionStatusHandler = handler;\r\n  }\r\n\r\n  onError(handler: (error: string) => void): void {\r\n    this.onErrorHandler = handler;\r\n  }\r\n\r\n  // Utility methods\r\n  get connectionState(): HubConnectionState {\r\n    return this.connection?.state || HubConnectionState.Disconnected;\r\n  }\r\n\r\n  get isConnected(): boolean {\r\n    return this.connection?.state === HubConnectionState.Connected;\r\n  }\r\n\r\n  get currentSessionId(): string | null {\r\n    return this.sessionId;\r\n  }\r\n\r\n  // Clean up\r\n  dispose(): void {\r\n    this.stop();\r\n    this.connection = null;\r\n    this.sessionId = null;\r\n    this.onAgentMessageHandler = undefined;\r\n    this.onHandoffHandler = undefined;\r\n    this.onAgentTypingHandler = undefined;\r\n    this.onSessionStatusHandler = undefined;\r\n    this.onErrorHandler = undefined;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const signalRService = new SignalRService();","import { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { HubConnectionState } from '@microsoft/signalr';\r\nimport { \r\n  signalRService, \r\n  AgentMessage, \r\n  AgentHandoffNotification, \r\n  AgentTypingNotification, \r\n  UserMessage, \r\n  SessionStatus \r\n} from '../services/signalRService';\r\n\r\nexport interface UseSignalRReturn {\r\n  // Connection state\r\n  connectionState: HubConnectionState;\r\n  isConnected: boolean;\r\n  error: string | null;\r\n  \r\n  // Session management\r\n  sessionId: string | null;\r\n  sessionStatus: SessionStatus | null;\r\n  \r\n  // Real-time data\r\n  agentMessages: AgentMessage[];\r\n  handoffNotifications: AgentHandoffNotification[];\r\n  agentTyping: Record<string, boolean>;\r\n  \r\n  // Actions\r\n  connect: () => Promise<void>;\r\n  disconnect: () => Promise<void>;\r\n  joinSession: (sessionId: string) => Promise<void>;\r\n  sendMessage: (message: UserMessage) => Promise<void>;\r\n  clearMessages: () => void;\r\n  refreshSessionStatus: () => Promise<void>;\r\n}\r\n\r\nexport const useSignalR = (): UseSignalRReturn => {\r\n  // Connection state\r\n  const [connectionState, setConnectionState] = useState<HubConnectionState>(HubConnectionState.Disconnected);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Session state\r\n  const [sessionId, setSessionId] = useState<string | null>(null);\r\n  const [sessionStatus, setSessionStatus] = useState<SessionStatus | null>(null);\r\n  \r\n  // Real-time data\r\n  const [agentMessages, setAgentMessages] = useState<AgentMessage[]>([]);\r\n  const [handoffNotifications, setHandoffNotifications] = useState<AgentHandoffNotification[]>([]);\r\n  const [agentTyping, setAgentTyping] = useState<Record<string, boolean>>({});\r\n  \r\n  // Refs for cleanup\r\n  const isInitialized = useRef(false);\r\n\r\n  // Initialize SignalR service and event handlers\r\n  useEffect(() => {\r\n    if (isInitialized.current) return;\r\n    isInitialized.current = true;\r\n\r\n    // Set up event handlers\r\n    signalRService.onAgentMessage((message: AgentMessage) => {\r\n      setAgentMessages(prev => [...prev, message]);\r\n    });\r\n\r\n    signalRService.onAgentHandoff((notification: AgentHandoffNotification) => {\r\n      setHandoffNotifications(prev => [...prev, notification]);\r\n    });\r\n\r\n    signalRService.onAgentTyping((notification: AgentTypingNotification) => {\r\n      setAgentTyping(prev => ({\r\n        ...prev,\r\n        [notification.agentName]: notification.isTyping\r\n      }));\r\n    });\r\n\r\n    signalRService.onSessionStatus((status: SessionStatus) => {\r\n      setSessionStatus(status);\r\n    });\r\n\r\n    signalRService.onError((errorMessage: string) => {\r\n      setError(errorMessage);\r\n    });\r\n\r\n    // Update connection state periodically\r\n    const interval = setInterval(() => {\r\n      const state = signalRService.connectionState;\r\n      setConnectionState(state);\r\n      setIsConnected(state === HubConnectionState.Connected);\r\n    }, 1000);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n      signalRService.dispose();\r\n    };\r\n  }, []);\r\n\r\n  // Actions\r\n  const connect = useCallback(async () => {\r\n    try {\r\n      setError(null);\r\n      await signalRService.start();\r\n      setIsConnected(true);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to connect';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const disconnect = useCallback(async () => {\r\n    try {\r\n      await signalRService.stop();\r\n      setIsConnected(false);\r\n      setSessionId(null);\r\n      setSessionStatus(null);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to disconnect';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const joinSession = useCallback(async (newSessionId: string) => {\r\n    try {\r\n      setError(null);\r\n      await signalRService.joinSession(newSessionId);\r\n      setSessionId(newSessionId);\r\n      \r\n      // Get initial session status\r\n      const status = await signalRService.getSessionStatus();\r\n      setSessionStatus(status);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to join session';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const sendMessage = useCallback(async (message: UserMessage) => {\r\n    try {\r\n      setError(null);\r\n      await signalRService.sendUserMessage(message);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to send message';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const clearMessages = useCallback(() => {\r\n    setAgentMessages([]);\r\n    setHandoffNotifications([]);\r\n    setAgentTyping({});\r\n  }, []);\r\n\r\n  const refreshSessionStatus = useCallback(async () => {\r\n    try {\r\n      const status = await signalRService.getSessionStatus();\r\n      setSessionStatus(status);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'Failed to refresh session status';\r\n      setError(errorMessage);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    // Connection state\r\n    connectionState,\r\n    isConnected,\r\n    error,\r\n    \r\n    // Session management\r\n    sessionId,\r\n    sessionStatus,\r\n    \r\n    // Real-time data\r\n    agentMessages,\r\n    handoffNotifications,\r\n    agentTyping,\r\n    \r\n    // Actions\r\n    connect,\r\n    disconnect,\r\n    joinSession,\r\n    sendMessage,\r\n    clearMessages,\r\n    refreshSessionStatus\r\n  };\r\n};","import React from 'react';\r\n\r\nexport interface VoiceActivityVisualizerProps {\r\n  volume: number;\r\n  isVoiceActive: boolean;\r\n  isListening: boolean;\r\n  size?: 'sm' | 'md' | 'lg';\r\n  className?: string;\r\n}\r\n\r\nexport const VoiceActivityVisualizer: React.FC<VoiceActivityVisualizerProps> = ({\r\n  volume,\r\n  isVoiceActive,\r\n  isListening,\r\n  size = 'md',\r\n  className = ''\r\n}) => {\r\n  const sizeClasses = {\r\n    sm: 'w-8 h-8',\r\n    md: 'w-12 h-12',\r\n    lg: 'w-16 h-16'\r\n  };\r\n\r\n  const barCount = size === 'sm' ? 3 : size === 'md' ? 5 : 7;\r\n  const maxHeight = size === 'sm' ? 16 : size === 'md' ? 24 : 32;\r\n\r\n  // Normalize volume (0-100 to 0-1)\r\n  const normalizedVolume = Math.min(volume / 100, 1);\r\n  \r\n  return (\r\n    <div className={`flex items-center justify-center ${sizeClasses[size]} ${className}`}>\r\n      <div className=\"flex items-end space-x-1 h-full\">\r\n        {Array.from({ length: barCount }).map((_, index) => {\r\n          // Calculate bar height based on volume and index\r\n          const barThreshold = index / barCount;\r\n          const shouldAnimate = isListening && (isVoiceActive || index === 0);\r\n          const isActive = normalizedVolume > barThreshold;\r\n          \r\n          const barHeight = shouldAnimate && isActive \r\n            ? Math.max(4, normalizedVolume * maxHeight)\r\n            : 4;\r\n          const barDelay = index * 100;\r\n          \r\n          return (\r\n            <div\r\n              key={index}\r\n              className={`w-1 transition-all duration-150 rounded-sm voice-bar ${\r\n                shouldAnimate\r\n                  ? isActive\r\n                    ? 'bg-green-500 animate-pulse'\r\n                    : 'bg-gray-300 dark:bg-gray-600'\r\n                  : 'bg-gray-200 dark:bg-gray-700'\r\n              }`}\r\n              data-height={barHeight}\r\n              data-delay={barDelay}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VoiceActivityVisualizer;","import React, { useState } from 'react';\r\nimport { Settings, Volume2, Mic, Languages, RefreshCw } from 'lucide-react';\r\nimport { SpeechConfig } from '@/services/speechService';\r\n\r\nexport interface SpeechSettingsProps {\r\n  config: SpeechConfig;\r\n  availableVoices: SpeechSynthesisVoice[];\r\n  selectedVoice?: SpeechSynthesisVoice;\r\n  onConfigUpdate: (config: Partial<SpeechConfig>) => void;\r\n  onVoiceSelect: (voice: SpeechSynthesisVoice) => void;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const SpeechSettings: React.FC<SpeechSettingsProps> = ({\r\n  config,\r\n  availableVoices,\r\n  selectedVoice,\r\n  onConfigUpdate,\r\n  onVoiceSelect,\r\n  isOpen,\r\n  onClose\r\n}) => {\r\n  const [localConfig, setLocalConfig] = useState<SpeechConfig>(config);\r\n\r\n  const handleConfigChange = (key: keyof SpeechConfig, value: any) => {\r\n    const newConfig = { ...localConfig, [key]: value };\r\n    setLocalConfig(newConfig);\r\n    onConfigUpdate({ [key]: value });\r\n  };\r\n\r\n  const languages = [\r\n    { code: 'en-US', name: 'English (US)' },\r\n    { code: 'en-GB', name: 'English (UK)' },\r\n    { code: 'es-ES', name: 'Spanish (Spain)' },\r\n    { code: 'es-MX', name: 'Spanish (Mexico)' },\r\n    { code: 'fr-FR', name: 'French (France)' },\r\n    { code: 'de-DE', name: 'German (Germany)' },\r\n    { code: 'it-IT', name: 'Italian (Italy)' },\r\n    { code: 'pt-BR', name: 'Portuguese (Brazil)' },\r\n    { code: 'zh-CN', name: 'Chinese (Simplified)' },\r\n    { code: 'ja-JP', name: 'Japanese' },\r\n    { code: 'ko-KR', name: 'Korean' }\r\n  ];\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\" aria-labelledby=\"speech-settings-title\" role=\"dialog\" aria-modal=\"true\">\r\n      <div className=\"flex items-center justify-center min-h-full p-4\">\r\n        <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" onClick={onClose}></div>\r\n        \r\n        <div className=\"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <Settings className=\"h-6 w-6 text-primary-600 dark:text-primary-400\" />\r\n              <h2 id=\"speech-settings-title\" className=\"text-xl font-semibold text-gray-900 dark:text-white\">\r\n                Speech Settings\r\n              </h2>\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\r\n              aria-label=\"Close settings\"\r\n            >\r\n              <span className=\"sr-only\">Close</span>\r\n              <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-6 space-y-6\">\r\n            {/* Speech Recognition Settings */}\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <Mic className=\"h-5 w-5 text-gray-500\" />\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">Speech Recognition</h3>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {/* Language Selection */}\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    <Languages className=\"inline h-4 w-4 mr-1\" />\r\n                    Language\r\n                  </label>\r\n                  <select\r\n                    value={localConfig.language}\r\n                    onChange={(e) => handleConfigChange('language', e.target.value)}\r\n                    title=\"Select language for speech recognition\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                  >\r\n                    {languages.map((lang) => (\r\n                      <option key={lang.code} value={lang.code}>\r\n                        {lang.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n\r\n                {/* Max Alternatives */}\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Recognition Alternatives\r\n                  </label>\r\n                  <select\r\n                    value={localConfig.maxAlternatives}\r\n                    onChange={(e) => handleConfigChange('maxAlternatives', parseInt(e.target.value))}\r\n                    title=\"Select number of recognition alternatives\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                  >\r\n                    <option value={1}>1 (fastest)</option>\r\n                    <option value={2}>2 (balanced)</option>\r\n                    <option value={3}>3 (best accuracy)</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Checkboxes */}\r\n              <div className=\"space-y-3\">\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={localConfig.continuous}\r\n                    onChange={(e) => handleConfigChange('continuous', e.target.checked)}\r\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\r\n                  />\r\n                  <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                    Continuous listening (auto-restart)\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={localConfig.interimResults}\r\n                    onChange={(e) => handleConfigChange('interimResults', e.target.checked)}\r\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\r\n                  />\r\n                  <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                    Show interim results (real-time transcription)\r\n                  </span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Audio Processing Settings */}\r\n            <div className=\"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">Audio Processing</h3>\r\n\r\n              <div className=\"space-y-3\">\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={localConfig.noiseReduction}\r\n                    onChange={(e) => handleConfigChange('noiseReduction', e.target.checked)}\r\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\r\n                  />\r\n                  <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                    Noise reduction\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={localConfig.echoCancellation}\r\n                    onChange={(e) => handleConfigChange('echoCancellation', e.target.checked)}\r\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\r\n                  />\r\n                  <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                    Echo cancellation\r\n                  </span>\r\n                </label>\r\n\r\n                <label className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={localConfig.audioTracks}\r\n                    onChange={(e) => handleConfigChange('audioTracks', e.target.checked)}\r\n                    className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\r\n                  />\r\n                  <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\r\n                    Enhanced audio processing\r\n                  </span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Voice Selection */}\r\n            <div className=\"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-6\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Volume2 className=\"h-5 w-5 text-gray-500\" />\r\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">Speech Synthesis</h3>\r\n                </div>\r\n                <button\r\n                  onClick={() => window.speechSynthesis.getVoices()}\r\n                  className=\"flex items-center space-x-1 px-3 py-1 text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors\"\r\n                  title=\"Refresh available voices\"\r\n                >\r\n                  <RefreshCw className=\"h-4 w-4\" />\r\n                  <span>Refresh</span>\r\n                </button>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Voice Selection\r\n                </label>\r\n                <select\r\n                  value={selectedVoice?.name || ''}\r\n                  onChange={(e) => {\r\n                    const voice = availableVoices.find(v => v.name === e.target.value);\r\n                    if (voice) onVoiceSelect(voice);\r\n                  }}\r\n                  title=\"Select voice for speech synthesis\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Default system voice</option>\r\n                  {availableVoices.map((voice, index) => (\r\n                    <option key={index} value={voice.name}>\r\n                      {voice.name} ({voice.lang}) {voice.default ? '(Default)' : ''}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\r\n                  {availableVoices.length} voices available\r\n                </p>\r\n              </div>\r\n\r\n              {/* Voice Test */}\r\n              {selectedVoice && (\r\n                <div>\r\n                  <button\r\n                    onClick={() => {\r\n                      const utterance = new SpeechSynthesisUtterance('Hello! This is a test of the selected voice.');\r\n                      utterance.voice = selectedVoice;\r\n                      window.speechSynthesis.speak(utterance);\r\n                    }}\r\n                    className=\"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-700 bg-primary-100 hover:bg-primary-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-800 dark:text-primary-200 dark:hover:bg-primary-700\"\r\n                  >\r\n                    <Volume2 className=\"h-4 w-4 mr-1\" />\r\n                    Test Voice\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"flex items-center justify-end space-x-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SpeechSettings;","import React, { useState, useEffect, useRef } from 'react';\r\nimport { Mic, MicOff, Send, Trash2, Volume2, VolumeX, Settings } from 'lucide-react';\r\nimport { useKeyboardNavigation } from '@/hooks/accessibility';\r\nimport { announceToScreenReader } from '@/utils';\r\nimport { useSpeech } from '@/hooks/useSpeech';\r\nimport { useSignalR } from '@/hooks/useSignalR';\r\nimport { SpeechResult, VoiceActivityEvent } from '@/services/speechService';\r\nimport { UserMessage } from '@/services/signalRService';\r\nimport VoiceActivityVisualizer from '@/components/VoiceActivityVisualizer';\r\nimport SpeechSettings from '@/components/SpeechSettings';\r\n\r\ninterface Message {\r\n  id: string;\r\n  content: string;\r\n  role: 'user' | 'assistant';\r\n  timestamp: Date;\r\n  isTyping?: boolean;\r\n}\r\n\r\ninterface AgentState {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n  isTyping: boolean;\r\n}\r\n\r\nexport const AgentExperience: React.FC = () => {\r\n  const { handleEnterSpace } = useKeyboardNavigation();\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [inputText, setInputText] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [currentAgent, setCurrentAgent] = useState<AgentState>({\r\n    id: 'coordinator',\r\n    name: 'Coordinator Agent',\r\n    isActive: true,\r\n    isTyping: false\r\n  });\r\n  const [isAudioOutputEnabled, setIsAudioOutputEnabled] = useState(false);\r\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\r\n  const [selectedVoice, setSelectedVoice] = useState<SpeechSynthesisVoice | undefined>();\r\n  \r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  // SignalR integration for real-time communication\r\n  const signalR = useSignalR();\r\n\r\n  // Use the advanced speech service\r\n  const speech = useSpeech({\r\n    config: {\r\n      continuous: true,\r\n      interimResults: true,\r\n      language: 'en-US',\r\n      maxAlternatives: 2\r\n    },\r\n    onFinalResult: (results: SpeechResult[]) => {\r\n      if (results.length > 0 && results[0].transcript.trim()) {\r\n        setInputText(results[0].transcript.trim());\r\n        announceToScreenReader(`Voice input captured: ${results[0].transcript}`);\r\n      }\r\n    },\r\n    onVoiceActivity: (_event: VoiceActivityEvent) => {\r\n      // Voice activity is handled by the visualizer\r\n    },\r\n    onError: (error) => {\r\n      console.error('Advanced speech error:', error);\r\n      announceToScreenReader('Voice input error occurred');\r\n    }\r\n  });\r\n\r\n  // Auto-scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Initialize SignalR connection and session\r\n  useEffect(() => {\r\n    const initializeSignalR = async () => {\r\n      try {\r\n        if (!signalR.isConnected) {\r\n          await signalR.connect();\r\n          announceToScreenReader('Connected to real-time communication');\r\n        }\r\n        \r\n        // Generate a session ID and join\r\n        const sessionId = `session-${Date.now()}`;\r\n        await signalR.joinSession(sessionId);\r\n        announceToScreenReader('Joined communication session');\r\n      } catch (error) {\r\n        console.error('Failed to initialize SignalR:', error);\r\n        announceToScreenReader('Failed to connect to real-time communication');\r\n      }\r\n    };\r\n\r\n    initializeSignalR();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      signalR.disconnect();\r\n    };\r\n  }, [signalR]);\r\n\r\n  // Handle real-time agent messages\r\n  useEffect(() => {\r\n    if (signalR.agentMessages.length > 0) {\r\n      const latestMessage = signalR.agentMessages[signalR.agentMessages.length - 1];\r\n      \r\n      // Convert SignalR message to local message format\r\n      const message: Message = {\r\n        id: `signalr-${Date.now()}`,\r\n        content: latestMessage.content,\r\n        role: 'assistant',\r\n        timestamp: new Date(latestMessage.timestamp)\r\n      };\r\n\r\n      setMessages(prev => {\r\n        // Avoid duplicates by checking if message already exists\r\n        const exists = prev.some(m => \r\n          m.content === message.content && \r\n          Math.abs(m.timestamp.getTime() - message.timestamp.getTime()) < 1000\r\n        );\r\n        \r\n        if (!exists) {\r\n          return [...prev, message];\r\n        }\r\n        return prev;\r\n      });\r\n\r\n      // Update current agent based on message\r\n      setCurrentAgent(prev => ({\r\n        ...prev,\r\n        name: latestMessage.agentName,\r\n        id: latestMessage.agentName.toLowerCase().replace(/\\s+/g, '-'),\r\n        isTyping: false\r\n      }));\r\n\r\n      // Speak the response if audio output is enabled\r\n      speakMessage(latestMessage.content);\r\n      \r\n      announceToScreenReader(`Message from ${latestMessage.agentName}: ${latestMessage.content}`);\r\n    }\r\n  }, [signalR.agentMessages]);\r\n\r\n  // Handle agent handoff notifications\r\n  useEffect(() => {\r\n    if (signalR.handoffNotifications.length > 0) {\r\n      const latestHandoff = signalR.handoffNotifications[signalR.handoffNotifications.length - 1];\r\n      \r\n      // Update current agent\r\n      setCurrentAgent(prev => ({\r\n        ...prev,\r\n        name: latestHandoff.toAgent,\r\n        id: latestHandoff.toAgent.toLowerCase().replace(/\\s+/g, '-'),\r\n        isTyping: false\r\n      }));\r\n\r\n      // Add system message about handoff\r\n      const handoffMessage: Message = {\r\n        id: `handoff-${Date.now()}`,\r\n        content: `Agent handoff: ${latestHandoff.reason}. You are now speaking with ${latestHandoff.toAgent}.`,\r\n        role: 'assistant',\r\n        timestamp: new Date(latestHandoff.timestamp)\r\n      };\r\n\r\n      setMessages(prev => [...prev, handoffMessage]);\r\n      announceToScreenReader(`Agent handoff: You are now speaking with ${latestHandoff.toAgent}`);\r\n    }\r\n  }, [signalR.handoffNotifications]);\r\n\r\n  // Handle agent typing indicators\r\n  useEffect(() => {\r\n    const typingAgents = Object.keys(signalR.agentTyping).filter(agent => signalR.agentTyping[agent]);\r\n    \r\n    if (typingAgents.length > 0) {\r\n      setCurrentAgent(prev => ({ ...prev, isTyping: true }));\r\n    } else {\r\n      setCurrentAgent(prev => ({ ...prev, isTyping: false }));\r\n    }\r\n  }, [signalR.agentTyping]);\r\n\r\n  // Initialize with welcome message\r\n  useEffect(() => {\r\n    const welcomeMessage: Message = {\r\n      id: '1',\r\n      content: \"Hello! I'm your behavioral health assistant. I can help you with depression screenings, provide support, or just have a friendly conversation. What would you like to explore today?\",\r\n      role: 'assistant',\r\n      timestamp: new Date()\r\n    };\r\n    setMessages([welcomeMessage]);\r\n  }, []);\r\n\r\n  const toggleListening = async () => {\r\n    try {\r\n      if (speech.isListening) {\r\n        speech.stopListening();\r\n        announceToScreenReader('Voice input stopped');\r\n      } else {\r\n        await speech.startListening();\r\n        announceToScreenReader('Voice input started');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error toggling speech:', error);\r\n      announceToScreenReader('Error with voice input');\r\n    }\r\n  };\r\n\r\n  const speakMessage = async (text: string) => {\r\n    if (isAudioOutputEnabled && speech.isAvailable) {\r\n      try {\r\n        await speech.speak(text, {\r\n          rate: 0.9,\r\n          pitch: 1.0,\r\n          volume: 0.8,\r\n          voice: selectedVoice,\r\n          interrupt: true\r\n        });\r\n      } catch (error) {\r\n        console.error('Error speaking message:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const toggleAudioOutput = () => {\r\n    setIsAudioOutputEnabled(!isAudioOutputEnabled);\r\n    if (!isAudioOutputEnabled) {\r\n      announceToScreenReader('Audio output enabled');\r\n    } else {\r\n      announceToScreenReader('Audio output disabled');\r\n      // Cancel any ongoing speech using the advanced speech service\r\n      if (speech.isAvailable && window.speechSynthesis) {\r\n        window.speechSynthesis.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!inputText.trim() || isProcessing) return;\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      content: inputText.trim(),\r\n      role: 'user',\r\n      timestamp: new Date()\r\n    };\r\n\r\n    setMessages(prev => [...prev, userMessage]);\r\n    const messageText = inputText.trim();\r\n    setInputText('');\r\n    setIsProcessing(true);\r\n    setCurrentAgent(prev => ({ ...prev, isTyping: true }));\r\n\r\n    try {\r\n      // Send message through SignalR for real-time processing\r\n      if (signalR.isConnected) {\r\n        const signalRMessage: UserMessage = {\r\n          content: messageText,\r\n          timestamp: new Date().toISOString(),\r\n          metadata: {\r\n            speechConfidence: 1.0, // Default confidence\r\n            voiceActivityLevel: speech.volume,\r\n            processingTime: 0\r\n          }\r\n        };\r\n\r\n        await signalR.sendMessage(signalRMessage);\r\n        announceToScreenReader('Message sent to agent');\r\n      } else {\r\n        // Fallback to mock behavior if SignalR is not connected\r\n        await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));\r\n\r\n        let responseContent = \"I understand what you're saying. Let me help you with that.\";\r\n        let newAgentId = currentAgent.id;\r\n        let newAgentName = currentAgent.name;\r\n\r\n        const lowerInput = messageText.toLowerCase();\r\n        \r\n        if (lowerInput.includes('phq') || lowerInput.includes('depression') || lowerInput.includes('screening')) {\r\n          responseContent = \"I can help you with a depression screening. I'll start with the PHQ-2, which is a quick 2-question assessment. This will help determine if a more comprehensive evaluation might be helpful. Shall we begin?\";\r\n          newAgentId = 'phq2';\r\n          newAgentName = 'PHQ-2 Agent';\r\n        } else if (lowerInput.includes('joke') || lowerInput.includes('funny') || lowerInput.includes('humor')) {\r\n          responseContent = \"Hey there!  I'm here to brighten your day with some wholesome humor! I can share clean jokes, funny stories, or just have some playful banter. What sounds good to you?\";\r\n          newAgentId = 'comedian';\r\n          newAgentName = 'Comedy Agent';\r\n        } else if (lowerInput.includes('crisis') || lowerInput.includes('emergency') || lowerInput.includes('help')) {\r\n          responseContent = \"I'm here to help. If you're experiencing a mental health crisis, please reach out for immediate support: Call 988 (Suicide & Crisis Lifeline) or contact your local emergency services. I'm also here to provide support and connect you with appropriate resources.\";\r\n        }\r\n\r\n        const assistantMessage: Message = {\r\n          id: (Date.now() + 1).toString(),\r\n          content: responseContent,\r\n          role: 'assistant',\r\n          timestamp: new Date()\r\n        };\r\n\r\n        setMessages(prev => [...prev, assistantMessage]);\r\n        \r\n        // Update current agent if it changed\r\n        if (newAgentId !== currentAgent.id) {\r\n          setCurrentAgent({\r\n            id: newAgentId,\r\n            name: newAgentName,\r\n            isActive: true,\r\n            isTyping: false\r\n          });\r\n          announceToScreenReader(`Agent changed to ${newAgentName}`);\r\n        }\r\n\r\n        // Speak the response if audio output is enabled\r\n        speakMessage(responseContent);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n      const errorMessage: Message = {\r\n        id: (Date.now() + 1).toString(),\r\n        content: \"I'm sorry, I encountered an error processing your message. Please try again.\",\r\n        role: 'assistant',\r\n        timestamp: new Date()\r\n      };\r\n      setMessages(prev => [...prev, errorMessage]);\r\n      announceToScreenReader('Error sending message');\r\n    } finally {\r\n      setIsProcessing(false);\r\n      if (!signalR.isConnected) {\r\n        // Only set typing to false for fallback mode; SignalR handles this via events\r\n        setCurrentAgent(prev => ({ ...prev, isTyping: false }));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      sendMessage();\r\n    }\r\n  };\r\n\r\n  const clearConversation = () => {\r\n    setMessages([]);\r\n    setCurrentAgent({\r\n      id: 'coordinator',\r\n      name: 'Coordinator Agent',\r\n      isActive: true,\r\n      isTyping: false\r\n    });\r\n    announceToScreenReader('Conversation cleared');\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-[calc(100vh-8rem)] flex flex-col bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\r\n        <div className=\"flex items-center space-x-3\">\r\n          {/* Animated Bot Visualization with Voice Activity */}\r\n          <div className=\"relative\">\r\n            <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 ${\r\n              currentAgent.isTyping \r\n                ? 'bg-primary-500 animate-pulse' \r\n                : currentAgent.isActive \r\n                  ? 'bg-green-500' \r\n                  : 'bg-gray-400'\r\n            }`}>\r\n              <span className=\"text-white text-lg\"></span>\r\n            </div>\r\n            {/* Pulsing indicator when agent is active */}\r\n            {currentAgent.isActive && (\r\n              <div className=\"absolute -inset-1 rounded-full bg-green-400 opacity-30 animate-ping\"></div>\r\n            )}\r\n            {/* Voice activity indicator */}\r\n            {speech.isListening && (\r\n              <div className=\"absolute -bottom-1 -right-1\">\r\n                <VoiceActivityVisualizer \r\n                  volume={speech.volume}\r\n                  isVoiceActive={speech.isVoiceActive}\r\n                  isListening={speech.isListening}\r\n                  size=\"sm\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n          \r\n          <div>\r\n            <h1 className=\"text-xl font-semibold text-gray-900 dark:text-gray-100\">\r\n              Agent Experience\r\n            </h1>\r\n            <div className=\"flex items-center space-x-2\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                Current Agent: {currentAgent.name}\r\n                {currentAgent.isTyping && (\r\n                  <span className=\"ml-2 text-primary-600 dark:text-primary-400\">\r\n                    <span className=\"animate-pulse\">Typing...</span>\r\n                  </span>\r\n                )}\r\n              </p>\r\n              \r\n              {/* Connection Status */}\r\n              <div className=\"flex items-center space-x-1\">\r\n                <div className={`w-2 h-2 rounded-full ${\r\n                  signalR.isConnected ? 'bg-green-500' : 'bg-red-500'\r\n                }`}></div>\r\n                <span className={`text-xs ${\r\n                  signalR.isConnected \r\n                    ? 'text-green-600 dark:text-green-400' \r\n                    : 'text-red-600 dark:text-red-400'\r\n                }`}>\r\n                  {signalR.isConnected ? 'Connected' : 'Offline'}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center space-x-2\">\r\n          {/* Speech Settings */}\r\n          <button\r\n            onClick={() => setIsSettingsOpen(true)}\r\n            onKeyDown={handleEnterSpace(() => setIsSettingsOpen(true))}\r\n            className=\"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            aria-label=\"Open speech settings\"\r\n            title=\"Speech settings\"\r\n          >\r\n            <Settings size={20} />\r\n          </button>\r\n\r\n          {/* Audio Output Toggle */}\r\n          <button\r\n            onClick={toggleAudioOutput}\r\n            onKeyDown={handleEnterSpace(toggleAudioOutput)}\r\n            className={`p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${\r\n              isAudioOutputEnabled\r\n                ? 'bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300'\r\n                : 'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400'\r\n            }`}\r\n            aria-label={`${isAudioOutputEnabled ? 'Disable' : 'Enable'} audio output`}\r\n            title={`${isAudioOutputEnabled ? 'Disable' : 'Enable'} audio output`}\r\n          >\r\n            {isAudioOutputEnabled ? <Volume2 size={20} /> : <VolumeX size={20} />}\r\n          </button>\r\n\r\n          {/* Clear Conversation */}\r\n          <button\r\n            onClick={clearConversation}\r\n            onKeyDown={handleEnterSpace(clearConversation)}\r\n            className=\"p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            aria-label=\"Clear conversation\"\r\n            title=\"Clear conversation\"\r\n          >\r\n            <Trash2 size={20} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.map((message) => (\r\n          <div\r\n            key={message.id}\r\n            className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\r\n          >\r\n            <div\r\n              className={`max-w-[80%] p-3 rounded-lg ${\r\n                message.role === 'user'\r\n                  ? 'bg-primary-600 text-white'\r\n                  : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100'\r\n              }`}\r\n            >\r\n              <p className=\"text-sm\">{message.content}</p>\r\n              <p className={`text-xs mt-1 opacity-70 ${\r\n                message.role === 'user' ? 'text-primary-200' : 'text-gray-500 dark:text-gray-400'\r\n              }`}>\r\n                {message.timestamp.toLocaleTimeString()}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        \r\n        {/* Typing indicator */}\r\n        {currentAgent.isTyping && (\r\n          <div className=\"flex justify-start\">\r\n            <div className=\"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg\">\r\n              <div className=\"flex space-x-1\">\r\n                <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce\"></div>\r\n                <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100\"></div>\r\n                <div className=\"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200\"></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"p-4 border-t border-gray-200 dark:border-gray-700\">\r\n        <div className=\"flex items-end space-x-2\">\r\n          {/* Voice Input Button */}\r\n          {speech.isAvailable && (\r\n            <button\r\n              onClick={toggleListening}\r\n              onKeyDown={handleEnterSpace(toggleListening)}\r\n              disabled={isProcessing}\r\n              className={`p-3 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ${\r\n                speech.isListening\r\n                  ? 'bg-red-600 text-white hover:bg-red-700'\r\n                  : 'bg-primary-600 text-white hover:bg-primary-700 disabled:bg-gray-400'\r\n              }`}\r\n              aria-label={speech.isListening ? 'Stop voice input' : 'Start voice input'}\r\n              title={speech.isListening ? 'Stop voice input' : 'Start voice input'}\r\n            >\r\n              {speech.isListening ? <MicOff size={20} /> : <Mic size={20} />}\r\n            </button>\r\n          )}\r\n\r\n          {/* Text Input */}\r\n          <div className=\"flex-1\">\r\n            <textarea\r\n              ref={textareaRef}\r\n              value={inputText}\r\n              onChange={(e) => setInputText(e.target.value)}\r\n              onKeyPress={handleKeyPress}\r\n              placeholder=\"Type your message here or use voice input...\"\r\n              disabled={isProcessing}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:text-gray-100 disabled:bg-gray-100 dark:disabled:bg-gray-700 min-h-[44px] max-h-[120px]\"\r\n              rows={1}\r\n              aria-label=\"Message input\"\r\n            />\r\n          </div>\r\n\r\n          {/* Send Button */}\r\n          <button\r\n            onClick={sendMessage}\r\n            onKeyDown={handleEnterSpace(sendMessage)}\r\n            disabled={!inputText.trim() || isProcessing}\r\n            className=\"p-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n            aria-label=\"Send message\"\r\n            title=\"Send message\"\r\n          >\r\n            <Send size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Status indicators */}\r\n        <div className=\"flex items-center justify-between mt-2 text-xs text-gray-500 dark:text-gray-400\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            {speech.isListening && (\r\n              <span className=\"flex items-center space-x-1 text-red-600 dark:text-red-400\">\r\n                <div className=\"w-2 h-2 bg-red-600 rounded-full animate-pulse\"></div>\r\n                <span>Listening...</span>\r\n              </span>\r\n            )}\r\n            \r\n            {speech.isVoiceActive && (\r\n              <span className=\"flex items-center space-x-1 text-green-600 dark:text-green-400\">\r\n                <div className=\"w-2 h-2 bg-green-600 rounded-full animate-pulse\"></div>\r\n                <span>Voice detected</span>\r\n              </span>\r\n            )}\r\n            \r\n            {speech.isAvailable && (\r\n              <span className=\"text-green-600 dark:text-green-400\">Voice input available</span>\r\n            )}\r\n            \r\n            {speech.error && (\r\n              <span className=\"text-red-600 dark:text-red-400\">Speech error: {speech.error}</span>\r\n            )}\r\n            \r\n            {signalR.error && (\r\n              <span className=\"text-red-600 dark:text-red-400\">Connection error: {signalR.error}</span>\r\n            )}\r\n            \r\n            {isAudioOutputEnabled && (\r\n              <span className=\"text-blue-600 dark:text-blue-400\">Audio output enabled</span>\r\n            )}\r\n            \r\n            {signalR.sessionId && (\r\n              <span className=\"text-gray-600 dark:text-gray-400\">\r\n                Session: {signalR.sessionId.slice(-8)}\r\n              </span>\r\n            )}\r\n          </div>\r\n          \r\n          <span>Press Enter to send, Shift+Enter for new line</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Speech Settings Modal */}\r\n      <SpeechSettings\r\n        config={{\r\n          language: 'en-US',\r\n          continuous: true,\r\n          interimResults: true,\r\n          maxAlternatives: 2,\r\n          audioTracks: true,\r\n          noiseReduction: true,\r\n          echoCancellation: true\r\n        }}\r\n        availableVoices={speech.availableVoices}\r\n        selectedVoice={selectedVoice}\r\n        onConfigUpdate={(config) => speech.updateConfig(config)}\r\n        onVoiceSelect={(voice) => setSelectedVoice(voice)}\r\n        isOpen={isSettingsOpen}\r\n        onClose={() => setIsSettingsOpen(false)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AgentExperience;","import React from 'react';\r\nimport { RefreshCw, AlertCircle, Activity, Info } from 'lucide-react';\r\nimport { useHealthCheck } from '@/hooks/api';\r\nimport { useAnnouncements } from '@/hooks/accessibility';\r\n\r\n// Re-export the full UploadAnalyze component\r\nexport { default as UploadAnalyze } from './UploadAnalyze';\r\n\r\n// Re-export the full Sessions component\r\nexport { default as Sessions } from './Sessions';\r\n\r\nexport { default as SessionDetail } from './SessionDetail';\r\n\r\nexport { default as Predictions } from './Predictions';\r\n\r\nexport { default as ControlPanel } from './ControlPanel';\r\n\r\nexport { default as AgentExperience } from './AgentExperience';\r\n\r\nexport const SystemHealth: React.FC = () => {\r\n  const { data: healthStatus, isLoading, error, refetch } = useHealthCheck();\r\n  const { announce } = useAnnouncements();\r\n\r\n  React.useEffect(() => {\r\n    announce('System Health page loaded', 'polite');\r\n  }, [announce]);\r\n\r\n  const formatTimestamp = (timestamp?: string) => {\r\n    if (!timestamp) return 'Just now';\r\n    \r\n    try {\r\n      const date = new Date(timestamp);\r\n      if (isNaN(date.getTime())) {\r\n        return 'Just now';\r\n      }\r\n      \r\n      return date.toLocaleString(undefined, {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n      });\r\n    } catch (error) {\r\n      return 'Just now';\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return 'text-green-600 dark:text-green-400';\r\n      case 'degraded':\r\n        return 'text-yellow-600 dark:text-yellow-400';\r\n      case 'unhealthy':\r\n        return 'text-red-600 dark:text-red-400';\r\n      default:\r\n        return 'text-gray-600 dark:text-gray-400';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return '';\r\n      case 'degraded':\r\n        return '';\r\n      case 'unhealthy':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const baseClasses = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium';\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return `${baseClasses} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;\r\n      case 'degraded':\r\n        return `${baseClasses} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;\r\n      case 'unhealthy':\r\n        return `${baseClasses} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;\r\n      default:\r\n        return `${baseClasses} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Page Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            System Health\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            Monitor API status and system connectivity\r\n          </p>\r\n        </div>\r\n        <button type=\"button\"\r\n          onClick={() => refetch()}\r\n          disabled={isLoading}\r\n          className=\"btn btn--secondary flex items-center space-x-2\"\r\n          aria-label=\"Refresh system health status\"\r\n        >\r\n          <RefreshCw className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`} />\r\n          <span>Refresh</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Loading State */}\r\n      {isLoading && (\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <RefreshCw className=\"w-6 h-6 text-blue-600 animate-spin\" />\r\n            <span className=\"text-lg text-gray-900 dark:text-white\">\r\n              Checking system health...\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error State */}\r\n      {error && (\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-6 h-6 text-red-500 mr-3\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Health Check Failed\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">\r\n                {error.message || 'Unable to retrieve system health status'}\r\n              </p>\r\n              <button type=\"button\"\r\n                onClick={() => refetch()}\r\n                className=\"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline\"\r\n              >\r\n                Try again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Health Status Display */}\r\n      {healthStatus && !isLoading && (\r\n        <>\r\n          {/* Overall Status Card */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\r\n                Overall System Status\r\n              </h2>\r\n              <div className={getStatusBadge(healthStatus.status)}>\r\n                <span className=\"mr-1\">{getStatusIcon(healthStatus.status)}</span>\r\n                {healthStatus.status}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\">{getStatusIcon(healthStatus.status)}</div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Status</div>\r\n                <div className={`font-medium ${getStatusColor(healthStatus.status)}`}>\r\n                  {healthStatus.status}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\"></div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Response Time</div>\r\n                <div className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {healthStatus.totalDuration ? `${healthStatus.totalDuration}ms` : 'N/A'}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\"></div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Last Checked</div>\r\n                <div className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {formatTimestamp(healthStatus.timestamp)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Individual Service Checks */}\r\n          {healthStatus.checks && Object.keys(healthStatus.checks).length > 0 && (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                <Activity className=\"w-5 h-5 mr-2\" />\r\n                Service Details\r\n              </h3>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {Object.entries(healthStatus.checks).map(([serviceName, serviceStatus]) => (\r\n                  <div key={serviceName} className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <span className=\"text-lg\">{getStatusIcon(serviceStatus.status)}</span>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white capitalize\">\r\n                          {serviceName.replace(/-/g, ' ')}\r\n                        </div>\r\n                        {serviceStatus.description && (\r\n                          <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            {serviceStatus.description}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center space-x-4\">\r\n                      {serviceStatus.duration && (\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          {serviceStatus.duration}ms\r\n                        </div>\r\n                      )}\r\n                      <div className={getStatusBadge(serviceStatus.status)}>\r\n                        {serviceStatus.status}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* System Information */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n              <Info className=\"w-5 h-5 mr-2\" />\r\n              System Information\r\n            </h3>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              <div>\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white mb-3\">API Endpoints</h4>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Health Check:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/health</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Sessions:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/sessions</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Predictions:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/predictions</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white mb-3\">Connection Status</h4>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">API Connected</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">Real-time Updates</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-purple-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">Auto-refresh Enabled</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const NotFound: React.FC = () => {\r\n  return (\r\n    <div className=\"text-center py-16\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Page Not Found</h1>\r\n      <p className=\"text-gray-600 dark:text-gray-400 mb-8\">\r\n        The page you're looking for doesn't exist.\r\n      </p>\r\n      <a\r\n        href=\"/\"\r\n        className=\"btn btn--primary\"\r\n      >\r\n        Go to Dashboard\r\n      </a>\r\n    </div>\r\n  );\r\n};\r\n","import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { ReactQueryDevtools } from '@tanstack/react-query-devtools';\r\nimport { ThemeProvider } from '@/contexts/ThemeContext';\r\nimport { ConditionalAuthProvider } from '@/components/auth/ConditionalAuthProvider';\r\nimport { ProtectedRoute } from '@/components/auth/AuthGuards';\r\nimport { RoleBasedRedirect } from '@/components/auth/RoleBasedRedirect';\r\nimport { ApiAuthInitializer } from '@/components/auth/ApiAuthInitializer';\r\nimport { Layout } from '@/components/layout/Layout';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\n// Page components\r\nimport { Dashboard } from '@/pages/Dashboard';\r\nimport { UploadAnalyze, Sessions, SessionDetail, Predictions, ControlPanel, AgentExperience, SystemHealth, NotFound } from '@/pages';\r\n\r\n// Create React Query client\r\nconst queryClient = new QueryClient({\r\n  defaultOptions: {\r\n    queries: {\r\n      retry: (failureCount, error) => {\r\n        // Don't retry on 4xx errors except 408 (timeout)\r\n        if (error && typeof error === 'object' && 'code' in error) {\r\n          const errorCode = (error as any).code;\r\n          if (errorCode?.startsWith('HTTP_4') && errorCode !== 'HTTP_408') {\r\n            return false;\r\n          }\r\n        }\r\n        return failureCount < 3;\r\n      },\r\n      staleTime: 5 * 60 * 1000, // 5 minutes\r\n      refetchOnWindowFocus: false,\r\n    },\r\n    mutations: {\r\n      retry: 1,\r\n    },\r\n  },\r\n});\r\n\r\nfunction App() {\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <ThemeProvider>\r\n        <ConditionalAuthProvider>\r\n          <ApiAuthInitializer>\r\n            <Router>\r\n              <Layout>\r\n                <Routes>\r\n                    {/* Control Panel route - accessible to both Admin and Control Panel roles */}\r\n                    <Route \r\n                      path=\"/\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <RoleBasedRedirect />\r\n                          <Dashboard />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    \r\n                    {/* Admin-only routes */}\r\n                    <Route \r\n                      path=\"/upload\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <UploadAnalyze />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/sessions\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <Sessions />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/sessions/:sessionId\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <SessionDetail />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/predictions\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <Predictions />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/summary\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <ControlPanel />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/agent-experience\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <AgentExperience />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/health\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <SystemHealth />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    \r\n                    {/* 404 page */}\r\n                    <Route path=\"*\" element={<NotFound />} />\r\n                  </Routes>\r\n                </Layout>\r\n              </Router>\r\n            </ApiAuthInitializer>\r\n          </ConditionalAuthProvider>\r\n        </ThemeProvider>\r\n        \r\n        {/* React Query DevTools (only in development) */}\r\n        {import.meta.env.DEV && <ReactQueryDevtools initialIsOpen={false} />}\r\n      </QueryClientProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App.tsx';\r\nimport './index.css';\r\nimport './styles/dynamic-progress.css';\r\nimport './styles/components.css';\r\nimport './styles/layouts.css';\r\n\r\n// Apply initial theme before React renders\r\nconst storedTheme = localStorage.getItem('bh_theme');\r\nconst prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\nconst initialTheme = storedTheme === 'dark' || (!storedTheme && prefersDark);\r\n\r\nif (initialTheme) {\r\n  document.documentElement.classList.add('dark');\r\n} else {\r\n  document.documentElement.classList.remove('dark');\r\n}\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n);\r\n"],"names":["m","require$$0","client","getRandomValues","rnds8","rng","byteToHex","i","unsafeStringify","arr","offset","randomUUID","native","v4","options","buf","rnds","config","STORAGE_KEYS","API_ENDPOINTS","A11Y","getUserId","userId","uuidv4","getStoredTheme","stored","setStoredTheme","theme","getStoredProcessingMode","setStoredProcessingMode","mode","getStoredProcessingModeBoolean","formatRelativeTime","date","now","target","diffMs","diffMinutes","diffHours","diffDays","formatDateTime","createAppError","code","message","details","isNetworkError","error","announceToScreenReader","priority","announcement","focusElement","elementId","delay","element","ThemeContext","createContext","useTheme","context","useContext","ThemeProvider","children","setThemeState","useState","setTheme","newTheme","toggleTheme","useEffect","mediaQuery","handleChange","e","value","jsx","Constants","AuthError","errorCode","errorMessage","suberror","errorString","correlationId","LogLevel","Logger","loggerOptions","packageName","packageVersion","defaultLoggerCallback","setLoggerOptions","logMessage","log","level","containsPii","InteractionType","InteractionStatus","storageNotSupported","stubbedPublicClientApplicationCalled","inMemRedirectUnavailable","BrowserConfigurationAuthErrorMessages","BrowserConfigurationAuthError","createBrowserConfigurationAuthError","stubbedPublicClientApplication","defaultMsalContext","MsalContext","React.createContext","useMsal","silentRequest","APP_ROLES","AuthContext","useAuth","AuthenticatedTemplate","UnauthenticatedTemplate","mockUser","MockAuthProvider","mockAuthValue","ConditionalAuthProvider","LoginPrompt","login","isLoading","handleLogin","jsxs","RequireAuth","fallback","redirectTo","location","useLocation","Fragment","Navigate","RequireRole","roles","requireAll","hasRole","hasAnyRole","user","role","ProtectedRoute","requireAuth","requireRoles","RoleBasedRedirect","navigate","useNavigate","isAuthenticated","defaultPath","AuthProvider","msalInstance","accounts","__publicField","account","useAuthProvider","instance","ApiClient","baseUrl","authProvider","response","errorData","endpoint","cleanEndpoint","url","defaultHeaders","authHeaders","authError","data","apiClient","setApiAuthProvider","apiService","request","sessionId","sessionData","text","PredictionPoller","onUpdate","onComplete","onError","poll","result","nextInterval","ApiAuthInitializer","useAnnouncements","announce","useCallback","announceError","announceSuccess","useKeyboardNavigation","handleEscape","callback","handleKeyDown","event","handleEnterSpace","useSkipToContent","Header","className","logout","isAdmin","isMobileMenuOpen","setIsMobileMenuOpen","showUserMenu","setShowUserMenu","isAuthEnabled","getNavigationItems","navItems","isActivePath","path","toggleMobileMenu","closeMobileMenu","handleClickOutside","Link","label","icon","MicrosoftLogo","size","props","Layout","skipToMain","toKebabCase","string","toCamelCase","match","p1","p2","toPascalCase","camelCase","mergeClasses","classes","index","array","hasA11yProp","prop","defaultAttributes","Icon","forwardRef","color","strokeWidth","absoluteStrokeWidth","iconNode","rest","ref","createElement","tag","attrs","createLucideIcon","iconName","Component","__iconNode","Activity","ArrowLeft","Brain","Calendar","ChartColumn","ChartPie","ChevronDown","ChevronUp","CircleAlert","CircleCheckBig","CircleX","Clock","Download","EyeOff","Eye","FileAudio","FileText","Funnel","Heart","Info","Languages","Lightbulb","LoaderCircle","MicOff","Mic","Pause","Play","Plus","RefreshCw","Search","Send","Settings","ShieldAlert","SquarePen","Target","Trash2","TrendingDown","TrendingUp","TriangleAlert","Upload","User","Users","Volume2","VolumeX","X","QUERY_KEYS","useHealthCheck","useQuery","useUserSessions","effectiveUserId","Dashboard","canAccessControlPanel","getAuthenticatedUserId","healthStatus","isHealthLoading","healthError","sessionsResponse","isSessionsLoading","quickActions","getActionClasses","disabled","baseClasses","action","a","b","session","_a","_b","AudioProcessor","FFmpeg","baseURL","toBlobURL","file","onProgress","progress","inputName","fetchFile","outputName","command","outputData","outputBlob","convertedFile","filename","lastDot","supportedFormats","extension","audioProcessorInstance","getAudioProcessor","convertAudioToWav","AzureBlobService","sasUrl","blobServiceClient","BlobServiceClient","fileName","containerClient","blobName","timestamp","randomId","blockBlobClient","uploadProgress","progressPercent","blobUrl","originalFileName","userPrefix","blobs","blob","userFiles","deletedCount","fileCount","totalSizeBytes","blobServiceInstance","getBlobService","uploadToAzureBlob","blobService","fileToUpload","useAccessibility","announcementRef","useRef","liveRegion","focusManagement","container","firstElement","focusableElements","lastElement","handleTabKey","keyboardNavigation","items","currentIndex","onIndexChange","newIndex","onEscape","generateId","prefix","prefersReducedMotion","getValidationAttributes","isValid","describedById","attributes","defaultUserMetadata","UploadAnalyze","audioFiles","setAudioFiles","processingMode","setProcessingMode","isMultiMode","setIsMultiMode","processingProgress","setProcessingProgress","results","setResults","fileStates","setFileStates","isProcessing","setIsProcessing","csvBatchData","setCsvBatchData","csvValidationErrors","setCsvValidationErrors","csvProcessingProgress","setCsvProcessingProgress","batchProcessingProgress","setBatchProcessingProgress","audioFile","setAudioFile","setProgress","setResult","isPlaying","setIsPlaying","currentTime","setCurrentTime","playingFileId","setPlayingFileId","prefilledData","userMetadata","setUserMetadata","_c","_d","_e","_g","_f","_i","_h","_j","_k","setError","toasts","setToasts","validationErrors","setValidationErrors","isCorrectingGrammar","setIsCorrectingGrammar","editingFileMetadata","setEditingFileMetadata","tempMetadata","setTempMetadata","tempValidationErrors","setTempValidationErrors","newUserId","prev","audioRef","fileInputRef","addToast","type","title","id","newToast","toast","removeToast","mockFile","virtualAudioFile","resetState","generateFileId","addAudioFile","metadata","fileUserMetadata","audio","af","removeAudioFile","fileId","fileToRemove","f","removed","updateFileMetadata","newMetadata","validateTempMetadata","errors","age","weight","validateAge","validateWeight","validateZipcode","validateSessionNotes","validateGender","validateRace","validateEthnicity","handleTempFieldValidation","field","openMetadataEditor","currentMetadata","saveMetadataChanges","cancelMetadataEdit","handleCsvFileSelect","reader","rows","row","headers","h","requiredHeaders","optionalHeaders","missingHeaders","parsedRows","values","v","header","processCsvBatch","totalFiles","resolve","handleFileSelect","files","supportedMimeTypes","hasValidExtension","ext","maxSize","handleDragOver","handleDrop","newMode","handlePlayPause","handleTimeUpdate","formatTime","seconds","mins","secs","safeParseFloat","defaultValue","parsed","validateMetadata","handleFieldValidation","newErrors","err","prevError","handleGrammarCorrection","buildMetadata","hasMetadata","ageNum","weightNum","buildMetadataFromUserData","userData","applyToAllFiles","prevFiles","downloadCsvTemplate","sampleRows","csvContent","link","processAndAnalyze","processMultipleFiles","processSingleFile","processSingleFileById","fileMetadata","sessionRequest","sessionResponse","initialSessionData","saveResult","audioUrl","convertedBlob","updatedSessionData","poller","reject","analysisResult","score","insight","finalSessionData","errorDetails","currentProgress","failedSessionData","updateError","cleanupError","filesToProcess","completedFiles","startSingleFile","getProgressColor","stage","newValue","Loader2","CheckCircle","input","AlertCircle","fileState","Edit","hasFiles","csvMode","statusConfig","XCircle","formatScoreCategory","category","l","getSeverityLevel","Sessions","sessions","setSessions","loading","setLoading","selectedSessions","setSelectedSessions","showFilters","setShowFilters","filters","setFilters","loadSessions","transformedSessions","prediction","analysisResults","appError","filteredAndSortedSessions","useMemo","filtered","searchLower","startDate","comparison","depressionA","depressionB","anxietyA","anxietyB","updateFilter","key","toggleSessionSelection","newSelection","toggleSelectAll","s","handleDeleteSession","handleRerunSession","handleBulkDelete","sessionIds","successCount","failedSessions","formatFileSize","bytes","k","sizes","StatusBadge","status","normalizedStatus","Filter","riskLevelConfig","AlertTriangle","RiskAssessmentComponent","existingAssessment","onAssessmentUpdated","assessment","setAssessment","isGenerating","setIsGenerating","setIsLoading","generateAssessment","loadAssessment","RiskLevelBadge","riskLevel","riskScore","factor","recommendation","followUp","SessionDetail","useParams","setSession","showRawJson","setShowRawJson","isRefreshing","setIsRefreshing","audioPlaying","setAudioPlaying","loadSession","refreshSession","toggleRawJson","newState","toggleAudioPlayback","downloadSessionData","dataStr","dataBlob","downloadAudioFile","downloadUrl","_l","Predictions","handleBarClick","loadPredictions","sessionsWithPredictions","filteredSessions","chartData","mapCategoryToNumber","depression","anxiety","scoreDistribution","distributions","categories","depressionScores","cat","count","percentage","anxietyScores","trendAnalysis","trends","getCategorySeverity","depressionCategories","severityScores","firstHalf","secondHalf","firstAvg","change","anxietyCategories","statistics","stats","depressionCounts","mostCommonDepression","anxietyCounts","mostCommonAnxiety","downloadPredictions","TrendIndicator","trend","colorClass","SimpleLineChart","onBarClick","scores","d","maxScore","minScore","range","getScoreCategoryName","getCategoryColor","getLegendItems","chartType","item","usedScores","activeLegendItems","dataPoint","height","categoryColor","categoryName","dateStr","counts","BarChart3","PieChart","scoreType","distribution","getPercentage","total","aggregateSessionData","allSessions","totalSessions","uniqueUsers","completedSessions","processingSessions","successRate","avgSessionsPerUser","twentyFourHoursAgo","recentActivity","riskCounts","depressionCategory","anxietyCategory","timeData","sessionsOnDate","userStatsMap","groupingUserId","userStats","successfulSessions","confidenceValues","c","avgConfidence","sum","userRiskDistribution","userDepressionScores","userAnxietyScores","lastActivity","latest","correlations","hasDepressionCase","hasAnxietyCase","hasDepression","hasAnxiety","ageGroup","gender","race","ethnicity","language","weightGroup","zipPrefix","region","MetricCard","subtitle","DistributionChart","TimeSeriesChart","maxCount","minCount","point","barWidth","x","barHeight","y","dayName","monthDay","MetadataCorrelationChart","categoryData","depressionRate","anxietyRate","CorrelationChart","depressionData","anxietyData","correlationPoints","maxValue","p","getColor","severity","radius","FunnelChart","sessionStatus","stages","width","conversionRate","UserStatsTable","showConfidenceModal","setShowConfidenceModal","showRiskModal","setShowRiskModal","formatDate","dateString","getRiskColor","totalUsers","u","topPerformer","best","current","ControlPanel","analytics","setAnalytics","lastRefresh","setLastRefresh","refreshInterval","loadAnalytics","allSessionsResponse","apiError","aggregatedData","interval","handleRetry","AdvancedSpeechService","EventEmitter","SpeechRecognition","transcript","confidence","isFinal","alternatives","j","finalResults","r","_event","bufferLength","dataArray","volume","isVoiceActive","track","utterance","newConfig","useSpeech","serviceRef","isListening","setIsListening","isAvailable","setIsAvailable","setIsVoiceActive","setVolume","isInitialized","setIsInitialized","availableVoices","setAvailableVoices","service","capabilities","started","serviceError","startListening","stopListening","speak","speakOptions","updateConfig","updateVoices","HttpError","statusCode","trueProto","TimeoutError","AbortError","UnsupportedTransportError","transport","DisabledTransportError","FailedToStartTransportError","FailedToNegotiateWithServerError","AggregateErrors","innerErrors","HttpResponse","statusText","content","HttpClient","NullLogger","_logLevel","_message","VERSION","Arg","val","name","Platform","getDataDetail","includeContent","detail","isArrayBuffer","formatArrayBuffer","view","str","num","pad","sendMessage","logger","transportName","httpClient","getUserAgentHeader","responseType","createLogger","ConsoleLogger","SubjectSubscription","subject","observer","_","minimumLogLevel","logLevel","msg","userAgentHeaderName","constructUserAgent","getOsName","getRuntime","getRuntimeVersion","version","os","runtime","runtimeVersion","userAgent","majorAndMinor","getErrorString","getGlobalThis","FetchHttpClient","requireFunc","abortController","timeoutId","msTimeout","deserializeContent","payload","cookies","XhrHttpClient","xhr","DefaultHttpClient","TextMessageFormat","output","messages","HandshakeProtocol","handshakeRequest","messageData","remainingData","binaryData","separatorIndex","responseLength","textData","MessageType","Subject","MessageBuffer","protocol","connection","bufferSize","serializedMessage","backpressurePromise","backpressurePromiseResolver","backpressurePromiseRejector","BufferedItem","ackMessage","newestAckedMessage","currentId","sequenceId","resolver","rejector","DEFAULT_TIMEOUT_IN_MS","DEFAULT_PING_INTERVAL_IN_MS","DEFAULT_STATEFUL_RECONNECT_BUFFER_SIZE","HubConnectionState","HubConnection","reconnectPolicy","serverTimeoutInMilliseconds","keepAliveIntervalInMilliseconds","statefulReconnectBufferSize","handshakePromise","startPromise","state","methodName","args","streams","streamIds","invocationDescriptor","promiseQueue","cancelInvocation","invocationEvent","sendPromise","newMethod","method","handlers","removeIdx","responseMessage","nextPing","invocationMessage","methods","methodsCopy","expectsResponse","res","exception","completionMessage","prevRes","reconnectStartTime","previousReconnectAttempts","retryError","nextRetryDelay","previousRetryCount","elapsedMilliseconds","retryReason","callbacks","nonblocking","invocationId","streamId","argument","arg","DEFAULT_RETRY_DELAYS_IN_MILLISECONDS","DefaultReconnectPolicy","retryDelays","retryContext","HeaderNames","AccessTokenHttpClient","innerClient","accessTokenFactory","allowRetry","HttpTransportType","TransferFormat","AbortController$1","LongPollingTransport","AbortController","transferFormat","pollOptions","pollUrl","deleteOptions","ServerSentEventsTransport","accessToken","opened","eventSource","WebSocketTransport","logMessageContent","webSocketConstructor","token","webSocket","MAX_REDIRECTS","HttpConnection","webSocketModule","eventSourceModule","TransportSendQueue","negotiateResponse","redirects","negotiateUrl","connectionToken","requestedTransport","requestedTransferFormat","connectUrl","transportExceptions","transports","negotiate","transportOrError","ex","callStop","useStatefulReconnect","transportMatches","aTag","searchParams","actualTransport","_transport","PromiseSource","transportResult","arrayBuffers","totalLength","reason","JSON_HUB_PROTOCOL_NAME","JsonHubProtocol","hubMessages","parsedMessage","LogLevelNameMapping","parseLogLevel","mapping","HubConnectionBuilder","logging","isLogger","transportTypeOrOptions","retryDelaysOrReconnectPolicy","milliseconds","httpConnectionOptions","SignalRService","notification","handler","signalRService","useSignalR","connectionState","setConnectionState","isConnected","setIsConnected","setSessionId","setSessionStatus","agentMessages","setAgentMessages","handoffNotifications","setHandoffNotifications","agentTyping","setAgentTyping","connect","disconnect","joinSession","newSessionId","clearMessages","refreshSessionStatus","VoiceActivityVisualizer","sizeClasses","barCount","maxHeight","normalizedVolume","barThreshold","shouldAnimate","isActive","barDelay","SpeechSettings","selectedVoice","onConfigUpdate","onVoiceSelect","isOpen","onClose","localConfig","setLocalConfig","handleConfigChange","languages","lang","voice","AgentExperience","setMessages","inputText","setInputText","currentAgent","setCurrentAgent","isAudioOutputEnabled","setIsAudioOutputEnabled","isSettingsOpen","setIsSettingsOpen","setSelectedVoice","messagesEndRef","textareaRef","signalR","speech","latestMessage","speakMessage","latestHandoff","handoffMessage","agent","toggleListening","toggleAudioOutput","userMessage","messageText","signalRMessage","responseContent","newAgentId","newAgentName","lowerInput","assistantMessage","handleKeyPress","clearConversation","SystemHealth","refetch","React","formatTimestamp","getStatusColor","getStatusIcon","getStatusBadge","serviceName","serviceStatus","NotFound","queryClient","QueryClient","failureCount","App","QueryClientProvider","Router","Routes","Route","storedTheme","prefersDark","initialTheme","ReactDOM"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,8,9,10,11,12,13,14,15,16,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117]}