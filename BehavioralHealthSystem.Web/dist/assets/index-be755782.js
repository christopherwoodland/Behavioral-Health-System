var ul=Object.defineProperty;var gl=(s,e,t)=>e in s?ul(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var we=(s,e,t)=>(gl(s,typeof e!="symbol"?e+"":e,t),t);import{j as n,u as Ti,Q as ml,a as pl}from"./query-926bdbd2.js";import{a as fl,r as y,R as St,u as ls,N as Ii,L as Se,b as yl,c as Si,B as xl,d as bl,e as vt}from"./vendor-5e236cef.js";import{F as wl,t as Aa,f as kl}from"./ffmpeg-c0c62554.js";import{B as Cl}from"./azure-a3a2de5a.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var $n={},Ta=fl;$n.createRoot=Ta.createRoot,$n.hydrateRoot=Ta.hydrateRoot;/*! @azure/msal-common v15.12.0 2025-08-19 */const w={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},pt={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Tt={GET:"GET",POST:"POST"},Vt=[w.OPENID_SCOPE,w.PROFILE_SCOPE,w.OFFLINE_ACCESS_SCOPE],Ia=[...Vt,w.EMAIL_SCOPE],Ee={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},Sa={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},ft={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Nr={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Re={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},ds={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},pn={QUERY:"query",FRAGMENT:"fragment"},vl={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},Ni={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Er={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},ur={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},ve={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},hs="appmetadata",Al="client_info",zr="1",Gr={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Le={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},ke={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},J={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},ar={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},Na={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Mt={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Pn={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},At={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Tl={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},Ei=300;/*! @azure/msal-common v15.12.0 2025-08-19 */const qr="unexpected_error",Il="post_request_failed";/*! @azure/msal-common v15.12.0 2025-08-19 */const Ea={[qr]:"Unexpected error in authentication.",[Il]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class ee extends Error{constructor(e,t,r){const a=t?`${e}: ${t}`:e;super(a),Object.setPrototypeOf(this,ee.prototype),this.errorCode=e||w.EMPTY_STRING,this.errorMessage=t||w.EMPTY_STRING,this.subError=r||w.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Kn(s,e){return new ee(s,e?`${Ea[s]} ${e}`:Ea[s])}/*! @azure/msal-common v15.12.0 2025-08-19 */const us="client_info_decoding_error",_i="client_info_empty_error",gs="token_parsing_error",Ri="null_or_empty_token",ot="endpoints_resolution_error",Pi="network_error",Oi="openid_config_error",ji="hash_not_deserialized",Gt="invalid_state",Mi="state_mismatch",zn="state_not_found",Di="nonce_mismatch",ms="auth_time_not_found",Ui="max_age_transpired",Sl="multiple_matching_tokens",Nl="multiple_matching_accounts",Li="multiple_matching_appMetadata",Fi="request_cannot_be_made",Hi="cannot_remove_empty_scope",Bi="cannot_append_scopeset",Gn="empty_input_scopeset",El="device_code_polling_cancelled",_l="device_code_expired",Rl="device_code_unknown_error",ps="no_account_in_silent_request",$i="invalid_cache_record",fs="invalid_cache_environment",qn="no_account_found",Vn="no_crypto_object",Pl="unexpected_credential_type",Ol="invalid_assertion",jl="invalid_client_credential",yt="token_refresh_required",Ml="user_timeout_reached",Ki="token_claims_cnf_required_for_signedjwt",zi="authorization_code_missing_from_server_response",Gi="binding_key_not_removed",qi="end_session_endpoint_not_supported",ys="key_id_missing",Dl="no_network_connectivity",Ul="user_canceled",Ll="missing_tenant_id_error",$="method_not_implemented",Fl="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.12.0 2025-08-19 */const _a={[us]:"The client info could not be parsed/decoded correctly",[_i]:"The client info was empty",[gs]:"Token cannot be parsed",[Ri]:"The token is null or empty",[ot]:"Endpoints cannot be resolved",[Pi]:"Network request failed",[Oi]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[ji]:"The hash parameters could not be deserialized",[Gt]:"State was not the expected format",[Mi]:"State mismatch error",[zn]:"State not found",[Di]:"Nonce mismatch error",[ms]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Ui]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Sl]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[Nl]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Li]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[Fi]:"Token request cannot be made without authorization code or refresh token.",[Hi]:"Cannot remove null or empty scope from ScopeSet",[Bi]:"Cannot append ScopeSet",[Gn]:"Empty input ScopeSet cannot be processed",[El]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[_l]:"Device code is expired.",[Rl]:"Device code stopped polling for unknown reasons.",[ps]:"Please pass an account object, silent flow is not supported without account information",[$i]:"Cache record object was null or undefined.",[fs]:"Invalid environment when attempting to create cache entry",[qn]:"No account found in cache for given key.",[Vn]:"No crypto object detected.",[Pl]:"Unexpected credential type.",[Ol]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[jl]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[yt]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Ml]:"User defined timeout for device code polling reached",[Ki]:"Cannot generate a POP jwt if the token_claims are not populated",[zi]:"Server response does not contain an authorization code to proceed",[Gi]:"Could not remove the credential's binding key from storage.",[qi]:"The provided authority does not support logout",[ys]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Dl]:"No network connectivity. Check your internet connection.",[Ul]:"User cancelled the flow.",[Ll]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[$]:"This method has not been implemented",[Fl]:"The nested app auth bridge is disabled"};class xs extends ee{constructor(e,t){super(e,t?`${_a[e]}: ${t}`:_a[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,xs.prototype)}}function I(s,e){return new xs(s,e)}/*! @azure/msal-common v15.12.0 2025-08-19 */const Vr={createNewGuid:()=>{throw I($)},base64Decode:()=>{throw I($)},base64Encode:()=>{throw I($)},base64UrlEncode:()=>{throw I($)},encodeKid:()=>{throw I($)},async getPublicKeyThumbprint(){throw I($)},async removeTokenBindingKey(){throw I($)},async clearKeystore(){throw I($)},async signJwt(){throw I($)},async hashString(){throw I($)}};/*! @azure/msal-common v15.12.0 2025-08-19 */var ce;(function(s){s[s.Error=0]="Error",s[s.Warning=1]="Warning",s[s.Info=2]="Info",s[s.Verbose=3]="Verbose",s[s.Trace=4]="Trace"})(ce||(ce={}));class dt{constructor(e,t,r){this.level=ce.Info;const a=()=>{},i=e||dt.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||a,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:ce.Info,this.correlationId=i.correlationId||w.EMPTY_STRING,this.packageName=t||w.EMPTY_STRING,this.packageVersion=r||w.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ce.Info}}clone(e,t,r){return new dt({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${ce[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:ce.Error,containsPii:!1,correlationId:t||w.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:ce.Error,containsPii:!0,correlationId:t||w.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:ce.Warning,containsPii:!1,correlationId:t||w.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:ce.Warning,containsPii:!0,correlationId:t||w.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:ce.Info,containsPii:!1,correlationId:t||w.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:ce.Info,containsPii:!0,correlationId:t||w.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:ce.Verbose,containsPii:!1,correlationId:t||w.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:ce.Verbose,containsPii:!0,correlationId:t||w.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:ce.Trace,containsPii:!1,correlationId:t||w.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:ce.Trace,containsPii:!0,correlationId:t||w.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Vi="@azure/msal-common",bs="15.12.0";/*! @azure/msal-common v15.12.0 2025-08-19 */const ws={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.12.0 2025-08-19 */const Wi="redirect_uri_empty",Hl="claims_request_parsing_error",Qi="authority_uri_insecure",nr="url_parse_error",Yi="empty_url_error",Ji="empty_input_scopes_error",ks="invalid_claims",Xi="token_request_empty",Zi="logout_request_empty",Bl="invalid_code_challenge_method",Cs="pkce_params_missing",vs="invalid_cloud_discovery_metadata",eo="invalid_authority_metadata",to="untrusted_authority",fn="missing_ssh_jwk",ro="missing_ssh_kid",$l="missing_nonce_authentication_header",Kl="invalid_authentication_header",no="cannot_set_OIDCOptions",so="cannot_allow_platform_broker",ao="authority_mismatch",io="invalid_request_method_for_EAR",oo="invalid_authorize_post_body_parameters";/*! @azure/msal-common v15.12.0 2025-08-19 */const zl={[Wi]:"A redirect URI is required for all calls, and none has been set.",[Hl]:"Could not parse the given claims request object.",[Qi]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[nr]:"URL could not be parsed into appropriate segments.",[Yi]:"URL was empty or null.",[Ji]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[ks]:"Given claims parameter must be a stringified JSON object.",[Xi]:"Token request was empty and not found in cache.",[Zi]:"The logout request was null or undefined.",[Bl]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Cs]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[vs]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[eo]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[to]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[fn]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[ro]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[$l]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[Kl]:"Invalid authentication header provided",[no]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[so]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[ao]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[oo]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[io]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."};class As extends ee{constructor(e){super(e,zl[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,As.prototype)}}function ie(s){return new As(s)}/*! @azure/msal-common v15.12.0 2025-08-19 */class Fe{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),a=i=>decodeURIComponent(i.replace(/\+/g," "));return r.forEach(i=>{if(i.trim()){const[o,c]=i.split(/=(.+)/g,2);o&&c&&(t[a(o)]=a(c))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class me{constructor(e){const t=e?Fe.trimArrayEntries([...e]):[],r=t?Fe.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw ie(Ji);this.scopes=new Set,r.forEach(a=>this.scopes.add(a))}static fromString(e){const r=(e||w.EMPTY_STRING).split(" ");return new me(r)}static createSearchScopes(e){const t=e&&e.length>0?e:[...Vt],r=new me(t);return r.containsOnlyOIDCScopes()?r.removeScope(w.OFFLINE_ACCESS_SCOPE):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new me(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return Ia.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw I(Bi)}}removeScope(e){if(!e)throw I(Hi);this.scopes.delete(e.trim())}removeOIDCScopes(){Ia.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw I(Gn);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw I(Gn);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),a=this.getScopeCount();return t.size<a+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):w.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.12.0 2025-08-19 */function Ra(s,e){return!!s&&!!e&&s===e.split(".")[1]}function Ts(s,e,t,r){if(r){const{oid:a,sub:i,tid:o,name:c,tfp:l,acr:d,preferred_username:h,upn:g,login_hint:m}=r,k=o||l||d||"";return{tenantId:k,localAccountId:a||i||"",name:c,username:h||g||"",loginHint:m,isHomeTenant:Ra(k,s)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:Ra(t,s)}}function Is(s,e,t,r){let a=s;if(e){const{isHomeTenant:i,...o}=e;a={...s,...o}}if(t){const{isHomeTenant:i,...o}=Ts(s.homeAccountId,s.localAccountId,s.tenantId,t);return a={...a,...o,idTokenClaims:t,idToken:r},a}return a}/*! @azure/msal-common v15.12.0 2025-08-19 */function Wt(s,e){const t=Gl(s);try{const r=e(t);return JSON.parse(r)}catch{throw I(gs)}}function Gl(s){if(!s)throw I(Ri);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(s);if(!t||t.length<4)throw I(gs);return t[2]}function co(s,e){if(e===0||Date.now()-3e5>s+e)throw I(Ui)}/*! @azure/msal-common v15.12.0 2025-08-19 */function Pa(s){if(!s)return s;let e=s.toLowerCase();return Fe.endsWith(e,"?")?e=e.slice(0,-1):Fe.endsWith(e,"?/")&&(e=e.slice(0,-2)),Fe.endsWith(e,"/")||(e+="/"),e}function lo(s){return s.startsWith("#/")?s.substring(2):s.startsWith("#")||s.startsWith("?")?s.substring(1):s}function Wr(s){if(!s||s.indexOf("=")<0)return null;try{const e=lo(s),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw I(ji)}return null}function gr(s,e=!0,t){const r=new Array;return s.forEach((a,i)=>{!e&&t&&i in t?r.push(`${i}=${a}`):r.push(`${i}=${encodeURIComponent(a)}`)}),r.join("&")}function Oa(s){if(!s)return s;const e=s.split("#")[0];try{const t=new URL(e),r=t.origin+t.pathname+t.search;return Pa(r)}catch{return Pa(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class W{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw ie(Yi);e.includes("#")||(this._urlString=W.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Fe.endsWith(t,"?")?t=t.slice(0,-1):Fe.endsWith(t,"?/")&&(t=t.slice(0,-2)),Fe.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw ie(nr)}if(!e.HostNameAndPort||!e.PathSegments)throw ie(nr);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw ie(Qi)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return W.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===ft.COMMON||r[0]===ft.ORGANIZATIONS)&&(r[0]=e),W.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw ie(nr);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let a=r.AbsolutePath.split("/");return a=a.filter(i=>i&&i.length>0),r.PathSegments=a,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw ie(nr);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===w.FORWARD_SLASH){const a=new W(t).getUrlComponents();return a.Protocol+"//"+a.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new W(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Wr(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const ho={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},ja=ho.endpointMetadata,Ss=ho.instanceDiscoveryMetadata,uo=new Set;Ss.metadata.forEach(s=>{s.aliases.forEach(e=>{uo.add(e)})});function ql(s,e){var a;let t;const r=s.canonicalAuthority;if(r){const i=new W(r).getUrlComponents().HostNameAndPort;t=Ma(i,(a=s.cloudDiscoveryMetadata)==null?void 0:a.metadata,Le.CONFIG,e)||Ma(i,Ss.metadata,Le.HARDCODED_VALUES,e)||s.knownAuthorities}return t||[]}function Ma(s,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),s&&e){const a=Qr(e,s);if(a)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),a.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function Vl(s){return Qr(Ss.metadata,s)}function Qr(s,e){for(let t=0;t<s.length;t++){const r=s[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v15.12.0 2025-08-19 */const Yr="cache_quota_exceeded",Ns="cache_error_unknown";/*! @azure/msal-common v15.12.0 2025-08-19 */const On={[Yr]:"Exceeded cache storage capacity.",[Ns]:"Unexpected error occurred when using cache storage."};class Ht extends ee{constructor(e,t){const r=t||(On[e]?On[e]:On[Ns]);super(`${e}: ${r}`),Object.setPrototypeOf(this,Ht.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function Wn(s){return s instanceof Error?s.name==="QuotaExceededError"||s.name==="NS_ERROR_DOM_QUOTA_REACHED"||s.message.includes("exceeded the quota")?new Ht(Yr):new Ht(s.name,s.message):new Ht(Ns)}/*! @azure/msal-common v15.12.0 2025-08-19 */class Qn{constructor(e,t,r,a,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Vi,bs),this.staticAuthorityOptions=i,this.performanceClient=a}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(Object.keys(e).length===0||Object.values(e).every(a=>!a))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const r=this.getAllAccounts(e,t);return r.length>1?r.sort(i=>i.idTokenClaims?-1:1)[0]:r.length===1?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?r[0].getAccountInfo():null}buildTenantProfiles(e,t,r){return e.flatMap(a=>this.getTenantProfilesFromAccountEntity(a,t,r==null?void 0:r.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,a,i){let o=null,c;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;const l=this.getIdToken(e,a,t,r.tenantId);return l&&(c=Wt(l.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(c,i))?null:(o=Is(e,r,c,l==null?void 0:l.secret),o)}getTenantProfilesFromAccountEntity(e,t,r,a){const i=e.getAccountInfo();let o=i.tenantProfiles||new Map;const c=this.getTokenKeys();if(r){const d=o.get(r);if(d)o=new Map([[r,d]]);else return[]}const l=[];return o.forEach(d=>{const h=this.getTenantedAccountInfoByFilter(i,c,d,t,a);h&&l.push(h)}),l}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,r){var a;if(!e)throw I($i);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(r==null?void 0:r.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(r==null?void 0:r.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(r==null?void 0:r.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(i){throw(a=this.commonLogger)==null||a.error("CacheManager.saveCacheRecord: failed"),i instanceof ee?i:Wn(i)}}async saveAccessToken(e,t){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},a=this.getTokenKeys(),i=me.fromString(e.target);a.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,r,!1))return;const c=this.getAccessTokenCredential(o,t);c&&this.credentialMatchesFilter(c,r)&&me.fromString(c.target).intersectingScopeSets(i)&&this.removeAccessToken(o,t)}),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),a=[];return r.forEach(i=>{var d;const o=this.getAccount(i,t);if(!o||e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId)||e.username&&!this.matchUsername(o.username,e.username)||e.environment&&!this.matchEnvironment(o,e.environment)||e.realm&&!this.matchRealm(o,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;const c={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},l=(d=o.tenantProfiles)==null?void 0:d.filter(h=>this.tenantProfileMatchesFilter(h,c));l&&l.length===0||a.push(o)}),a}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===ve.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===J.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(a=>{if(!this.isAppMetadata(a))return;const i=this.getAppMetadata(a);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(r[a]=i))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(a=>{if(!this.isAuthorityMetadata(a)||a.indexOf(this.clientId)===-1)return;const i=this.getAuthorityMetadata(a);i&&i.aliases.indexOf(e)!==-1&&(r=i)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(r=>{this.removeAccount(r,e)})}removeAccount(e,t){this.removeAccountContext(e,t);const r=this.getAccountKeys(),a=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);r.filter(a).forEach(i=>{this.removeItem(i,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const r=this.getTokenKeys(),a=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);r.idToken.filter(a).forEach(i=>{this.removeIdToken(i,t)}),r.accessToken.filter(a).forEach(i=>{this.removeAccessToken(i,t)}),r.refreshToken.filter(a).forEach(i=>{this.removeRefreshToken(i,t)})}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!r||r.credentialType.toLowerCase()!==ve.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||r.tokenType!==J.POP)return;const a=r.keyId;a&&this.cryptoImpl.removeTokenBindingKey(a).catch(()=>{var i;this.commonLogger.error(`Failed to remove token binding key ${a}`,t),(i=this.performanceClient)==null||i.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(r=>{this.isAppMetadata(r)&&this.removeItem(r,e)}),!0}getIdToken(e,t,r,a,i){this.commonLogger.trace("CacheManager - getIdToken called");const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ve.ID_TOKEN,clientId:this.clientId,realm:a},c=this.getIdTokensByFilter(o,t,r),l=c.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let d=c;if(!a){const h=new Map;c.forEach((m,k)=>{m.realm===e.tenantId&&h.set(k,m)});const g=h.size;if(g<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),c.values().next().value;if(g===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;d=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),d.forEach((h,g)=>{this.removeIdToken(g,t)}),i&&t&&i.addFields({multiMatchedID:c.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),c.values().next().value}getIdTokensByFilter(e,t,r){const a=r&&r.idToken||this.getTokenKeys().idToken,i=new Map;return a.forEach(o=>{if(!this.idTokenKeyMatchesFilter(o,{clientId:this.clientId,...e}))return;const c=this.getIdTokenCredential(o,t);c&&this.credentialMatchesFilter(c,e)&&i.set(o,c)}),i}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,a){const i=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",i);const o=me.createSearchScopes(t.scopes),c=t.authenticationScheme||J.BEARER,l=c&&c.toLowerCase()!==J.BEARER.toLowerCase()?ve.ACCESS_TOKEN_WITH_AUTH_SCHEME:ve.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:a||e.tenantId,target:o,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,g=[];h.forEach(k=>{if(this.accessTokenKeyMatchesFilter(k,d,!0)){const S=this.getAccessTokenCredential(k,i);S&&this.credentialMatchesFilter(S,d)&&g.push(S)}});const m=g.length;return m<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",i),null):m>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",i),g.forEach(k=>{this.removeAccessToken(this.generateCredentialKey(k),i)}),this.performanceClient.addFields({multiMatchedAT:g.length},i),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",i),g[0])}accessTokenKeyMatchesFilter(e,t,r){const a=e.toLowerCase();if(t.clientId&&a.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&a.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&a.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&a.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const i=t.target.asArray();for(let o=0;o<i.length;o++){if(r&&!a.includes(i[o].toLowerCase()))return!1;if(!r&&a.includes(i[o].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),a=[];return r.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const o=this.getAccessTokenCredential(i,t);o&&this.credentialMatchesFilter(o,e)&&a.push(o)}),a}getRefreshToken(e,t,r,a,i){this.commonLogger.trace("CacheManager - getRefreshToken called");const o=t?zr:void 0,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ve.REFRESH_TOKEN,clientId:this.clientId,familyId:o},l=a&&a.refreshToken||this.getTokenKeys().refreshToken,d=[];l.forEach(g=>{if(this.refreshTokenKeyMatchesFilter(g,c)){const m=this.getRefreshTokenCredential(g,r);m&&this.credentialMatchesFilter(m,c)&&d.push(m)}});const h=d.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&i&&r&&i.addFields({multiMatchedRT:h},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),d[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),a=Object.keys(r).map(o=>r[o]),i=a.length;if(i<1)return null;if(i>1)throw I(Li);return a[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===zr)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const a=ql(this.staticAuthorityOptions,this.commonLogger);if(a.includes(t)&&a.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==ve.ACCESS_TOKEN&&e.credentialType!==ve.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:me.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(hs)!==-1}isAuthorityMetadata(e){return e.indexOf(Gr.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${Gr.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Wl extends Qn{async setAccount(){throw I($)}getAccount(){throw I($)}async setIdTokenCredential(){throw I($)}getIdTokenCredential(){throw I($)}async setAccessTokenCredential(){throw I($)}getAccessTokenCredential(){throw I($)}async setRefreshTokenCredential(){throw I($)}getRefreshTokenCredential(){throw I($)}setAppMetadata(){throw I($)}getAppMetadata(){throw I($)}setServerTelemetry(){throw I($)}getServerTelemetry(){throw I($)}setAuthorityMetadata(){throw I($)}getAuthorityMetadata(){throw I($)}getAuthorityMetadataKeys(){throw I($)}setThrottlingCache(){throw I($)}getThrottlingCache(){throw I($)}removeItem(){throw I($)}getKeys(){throw I($)}getAccountKeys(){throw I($)}getTokenKeys(){throw I($)}generateCredentialKey(){throw I($)}generateAccountKey(){throw I($)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Me={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};/*! @azure/msal-common v15.12.0 2025-08-19 */const u={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},Ql={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.12.0 2025-08-19 */class Da{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class go{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:Ql.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Da}}startPerformanceMeasurement(){return new Da}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-common v15.12.0 2025-08-19 */const mo={tokenRenewalOffsetSeconds:Ei,preventCorsPreflight:!1},Yl={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:ce.Info,correlationId:w.EMPTY_STRING},Jl={claimsBasedCachingEnabled:!1},Xl={async sendGetRequestAsync(){throw I($)},async sendPostRequestAsync(){throw I($)}},Zl={sku:w.SKU,version:bs,cpu:w.EMPTY_STRING,os:w.EMPTY_STRING},ed={clientSecret:w.EMPTY_STRING,clientAssertion:void 0},td={azureCloudInstance:ws.None,tenant:`${w.DEFAULT_COMMON_TENANT}`},rd={application:{appName:"",appVersion:""}};function nd({authOptions:s,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:a,networkInterface:i,cryptoInterface:o,clientCredentials:c,libraryInfo:l,telemetry:d,serverTelemetryManager:h,persistencePlugin:g,serializableCache:m}){const k={...Yl,...t};return{authOptions:sd(s),systemOptions:{...mo,...e},loggerOptions:k,cacheOptions:{...Jl,...r},storageInterface:a||new Wl(s.clientId,Vr,new dt(k),new go),networkInterface:i||Xl,cryptoInterface:o||Vr,clientCredentials:c||ed,libraryInfo:{...Zl,...l},telemetry:{...rd,...d},serverTelemetryManager:h||null,persistencePlugin:g||null,serializableCache:m||null}}function sd(s){return{clientCapabilities:[],azureCloudOptions:td,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...s}}function po(s){return s.authOptions.authority.options.protocolMode===Me.OIDC}/*! @azure/msal-common v15.12.0 2025-08-19 */const Qe={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.12.0 2025-08-19 */function Jr(s,e){if(!s)throw I(_i);try{const t=e(s);return JSON.parse(t)}catch{throw I(us)}}function Bt(s){if(!s)throw I(us);const e=s.split(ur.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?w.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Nt="client_id",fo="redirect_uri",ad="response_type",id="response_mode",od="grant_type",cd="claims",ld="scope",dd="refresh_token",hd="state",ud="nonce",gd="prompt",md="code",pd="code_challenge",fd="code_challenge_method",yd="code_verifier",xd="client-request-id",bd="x-client-SKU",wd="x-client-VER",kd="x-client-OS",Cd="x-client-CPU",vd="x-client-current-telemetry",Ad="x-client-last-telemetry",Td="x-ms-lib-capability",Id="x-app-name",Sd="x-app-ver",Nd="post_logout_redirect_uri",Ed="id_token_hint",_d="client_secret",Rd="client_assertion",Pd="client_assertion_type",yo="token_type",xo="req_cnf",Ua="return_spa_code",Od="nativebroker",jd="logout_hint",Md="sid",Dd="login_hint",Ud="domain_hint",Ld="x-client-xtra-sku",Xr="brk_client_id",Zr="brk_redirect_uri",Yn="instance_aware",Fd="ear_jwk",Hd="ear_jwe_crypto";/*! @azure/msal-common v15.12.0 2025-08-19 */function yn(s,e,t){if(!e)return;const r=s.get(Nt);r&&s.has(Xr)&&(t==null||t.addFields({embeddedClientId:r,embeddedRedirectUri:s.get(fo)},e))}function Es(s,e){s.set(ad,e)}function Bd(s,e){s.set(id,e||vl.QUERY)}function $d(s){s.set(Od,"1")}function _s(s,e,t=!0,r=Vt){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const a=t?[...e||[],...r]:e||[],i=new me(a);s.set(ld,i.printScopes())}function Rs(s,e){s.set(Nt,e)}function Ps(s,e){s.set(fo,e)}function Kd(s,e){s.set(Nd,e)}function zd(s,e){s.set(Ed,e)}function Gd(s,e){s.set(Ud,e)}function _r(s,e){s.set(Dd,e)}function en(s,e){s.set(Ee.CCS_HEADER,`UPN:${e}`)}function ir(s,e){s.set(Ee.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function La(s,e){s.set(Md,e)}function Os(s,e,t){const r=Jd(e,t);try{JSON.parse(r)}catch{throw ie(ks)}s.set(cd,r)}function js(s,e){s.set(xd,e)}function Ms(s,e){s.set(bd,e.sku),s.set(wd,e.version),e.os&&s.set(kd,e.os),e.cpu&&s.set(Cd,e.cpu)}function Ds(s,e){e!=null&&e.appName&&s.set(Id,e.appName),e!=null&&e.appVersion&&s.set(Sd,e.appVersion)}function qd(s,e){s.set(gd,e)}function bo(s,e){e&&s.set(hd,e)}function Vd(s,e){s.set(ud,e)}function wo(s,e,t){if(e&&t)s.set(pd,e),s.set(fd,t);else throw ie(Cs)}function Wd(s,e){s.set(md,e)}function Qd(s,e){s.set(dd,e)}function Yd(s,e){s.set(yd,e)}function ko(s,e){s.set(_d,e)}function Co(s,e){e&&s.set(Rd,e)}function vo(s,e){e&&s.set(Pd,e)}function Ao(s,e){s.set(od,e)}function Us(s){s.set(Al,"1")}function To(s){s.has(Yn)||s.set(Yn,"true")}function xt(s,e){Object.entries(e).forEach(([t,r])=>{!s.has(t)&&r&&s.set(t,r)})}function Jd(s,e){let t;if(!s)t={};else try{t=JSON.parse(s)}catch{throw ie(ks)}return e&&e.length>0&&(t.hasOwnProperty(Nr.ACCESS_TOKEN)||(t[Nr.ACCESS_TOKEN]={}),t[Nr.ACCESS_TOKEN][Nr.XMS_CC]={values:e}),JSON.stringify(t)}function Ls(s,e){e&&(s.set(yo,J.POP),s.set(xo,e))}function Io(s,e){e&&(s.set(yo,J.SSH),s.set(xo,e))}function So(s,e){s.set(vd,e.generateCurrentRequestHeaderValue()),s.set(Ad,e.generateLastRequestHeaderValue())}function No(s){s.set(Td,ar.X_MS_LIB_CAPABILITY_VALUE)}function Xd(s,e){s.set(jd,e)}function xn(s,e,t){s.has(Xr)||s.set(Xr,e),s.has(Zr)||s.set(Zr,t)}function Zd(s,e){s.set(Fd,encodeURIComponent(e));const t="eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0";s.set(Hd,t)}function eh(s,e){Object.entries(e).forEach(([t,r])=>{r&&s.set(t,r)})}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ve={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.12.0 2025-08-19 */function th(s){return s.hasOwnProperty("authorization_endpoint")&&s.hasOwnProperty("token_endpoint")&&s.hasOwnProperty("issuer")&&s.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.12.0 2025-08-19 */function rh(s){return s.hasOwnProperty("tenant_discovery_endpoint")&&s.hasOwnProperty("metadata")}/*! @azure/msal-common v15.12.0 2025-08-19 */function nh(s){return s.hasOwnProperty("error")&&s.hasOwnProperty("error_description")}/*! @azure/msal-common v15.12.0 2025-08-19 */const He=(s,e,t,r,a)=>(...i)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,a);if(a){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},a)}try{const c=s(...i);return o==null||o.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(c){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},c),c}},b=(s,e,t,r,a)=>(...i)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,a);if(a){const c=e+"CallCount";r==null||r.incrementFields({[c]:1},a)}return r==null||r.setPreQueueTime(e,a),s(...i).then(c=>(t.trace(`Returning result from ${e}`),o==null||o.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},c),c})};/*! @azure/msal-common v15.12.0 2025-08-19 */class bn{constructor(e,t,r,a){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=a}async detectRegion(e,t){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(u.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=Mt.ENVIRONMENT_VARIABLE;else{const i=bn.IMDS_OPTIONS;try{const o=await b(this.getRegionFromIMDS.bind(this),u.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(w.IMDS_VERSION,i);if(o.status===pt.SUCCESS&&(r=o.body,t.region_source=Mt.IMDS),o.status===pt.BAD_REQUEST){const c=await b(this.getCurrentVersion.bind(this),u.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!c)return t.region_source=Mt.FAILED_AUTO_DETECTION,null;const l=await b(this.getRegionFromIMDS.bind(this),u.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(c,i);l.status===pt.SUCCESS&&(r=l.body,t.region_source=Mt.IMDS)}}catch{return t.region_source=Mt.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=Mt.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(u.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${w.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,w.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(u.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${w.IMDS_ENDPOINT}?format=json`,e);return r.status===pt.BAD_REQUEST&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}bn.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.12.0 2025-08-19 */function De(){return Math.round(new Date().getTime()/1e3)}function Fa(s){return s.getTime()/1e3}function $t(s){return s?new Date(Number(s)*1e3):new Date}function tn(s,e){const t=Number(s)||0;return De()+e>t}function sh(s,e){const t=Number(s)+e*24*60*60*1e3;return Date.now()>t}function ah(s){return Number(s)>De()}/*! @azure/msal-common v15.12.0 2025-08-19 */function wn(s,e,t,r,a){return{credentialType:ve.ID_TOKEN,homeAccountId:s,environment:e,clientId:r,secret:t,realm:a,lastUpdatedAt:Date.now().toString()}}function kn(s,e,t,r,a,i,o,c,l,d,h,g,m,k,S){var N,z;const T={homeAccountId:s,credentialType:ve.ACCESS_TOKEN,secret:t,cachedAt:De().toString(),expiresOn:o.toString(),extendedExpiresOn:c.toString(),environment:e,clientId:r,realm:a,target:i,tokenType:h||J.BEARER,lastUpdatedAt:Date.now().toString()};if(g&&(T.userAssertionHash=g),d&&(T.refreshOn=d.toString()),k&&(T.requestedClaims=k,T.requestedClaimsHash=S),((N=T.tokenType)==null?void 0:N.toLowerCase())!==J.BEARER.toLowerCase())switch(T.credentialType=ve.ACCESS_TOKEN_WITH_AUTH_SCHEME,T.tokenType){case J.POP:const G=Wt(t,l);if(!((z=G==null?void 0:G.cnf)!=null&&z.kid))throw I(Ki);T.keyId=G.cnf.kid;break;case J.SSH:T.keyId=m}return T}function Eo(s,e,t,r,a,i,o){const c={credentialType:ve.REFRESH_TOKEN,homeAccountId:s,environment:e,clientId:r,secret:t,lastUpdatedAt:Date.now().toString()};return i&&(c.userAssertionHash=i),a&&(c.familyId=a),o&&(c.expiresOn=o.toString()),c}function Fs(s){return s.hasOwnProperty("homeAccountId")&&s.hasOwnProperty("environment")&&s.hasOwnProperty("credentialType")&&s.hasOwnProperty("clientId")&&s.hasOwnProperty("secret")}function Ha(s){return s?Fs(s)&&s.hasOwnProperty("realm")&&s.hasOwnProperty("target")&&(s.credentialType===ve.ACCESS_TOKEN||s.credentialType===ve.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function ih(s){return s?Fs(s)&&s.hasOwnProperty("realm")&&s.credentialType===ve.ID_TOKEN:!1}function Ba(s){return s?Fs(s)&&s.credentialType===ve.REFRESH_TOKEN:!1}function oh(s,e){const t=s.indexOf(ke.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function ch(s,e){let t=!1;s&&(t=s.indexOf(ar.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function lh({environment:s,clientId:e}){return[hs,s,e].join(ur.CACHE_KEY_SEPARATOR).toLowerCase()}function dh(s,e){return e?s.indexOf(hs)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function hh(s,e){return e?s.indexOf(Gr.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function $a(){return De()+Gr.REFRESH_TIME_SECONDS}function Rr(s,e,t){s.authorization_endpoint=e.authorization_endpoint,s.token_endpoint=e.token_endpoint,s.end_session_endpoint=e.end_session_endpoint,s.issuer=e.issuer,s.endpointsFromNetwork=t,s.jwks_uri=e.jwks_uri}function jn(s,e,t){s.aliases=e.aliases,s.preferred_cache=e.preferred_cache,s.preferred_network=e.preferred_network,s.aliasesFromNetwork=t}function Ka(s){return s.expiresAt<=De()}/*! @azure/msal-common v15.12.0 2025-08-19 */class Ie{constructor(e,t,r,a,i,o,c,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=a,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=c,this.correlationId=o,this.managedIdentity=l||!1,this.regionDiscovery=new bn(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(w.CIAM_AUTH_URL))return Ve.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case w.ADFS:return Ve.Adfs;case w.DSTS:return Ve.Dsts}return Ve.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new W(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw I(ot)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw I(ot)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw I(ot)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw I(qi);return this.replacePath(this.metadata.end_session_endpoint)}else throw I(ot)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw I(ot)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw I(ot)}canReplaceTenant(e){return e.PathSegments.length===1&&!Ie.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===Ve.Default&&this.protocolMode!==Me.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const a=new W(this.metadata.canonical_authority).getUrlComponents(),i=a.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((c,l)=>{let d=i[l];if(l===0&&this.canReplaceTenant(a)){const h=new W(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];d!==h&&(this.logger.verbose(`Replacing tenant domain name ${d} with id ${h}`),d=h)}c!==d&&(t=t.replace(`/${d}/`,`/${c}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===Ve.Adfs||this.protocolMode===Me.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var a,i;(a=this.performanceClient)==null||a.addQueueMeasurement(u.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await b(this.updateCloudDiscoveryMetadata.bind(this),u.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await b(this.updateEndpointMetadata.bind(this),u.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(i=this.performanceClient)==null||i.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:$a(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==Le.CACHE&&(r==null?void 0:r.source)!==Le.CACHE&&(e.expiresAt=$a(),e.canonical_authority=this.canonicalAuthority);const a=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(a,e),this.metadata=e}async updateEndpointMetadata(e){var a,i,o;(a=this.performanceClient)==null||a.addQueueMeasurement(u.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Le.HARDCODED_VALUES&&(i=this.authorityOptions.azureRegionConfiguration)!=null&&i.azureRegion&&t.metadata){const c=await b(this.updateMetadataWithRegionalInformation.bind(this),u.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Rr(e,c,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await b(this.getEndpointMetadataFromNetwork.bind(this),u.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&(r=await b(this.updateMetadataWithRegionalInformation.bind(this),u.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),Rr(e,r,!0),Le.NETWORK;throw I(Oi,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Rr(e,t,!1),{source:Le.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const a=this.getEndpointMetadataFromHardcodedValues();if(a)return Rr(e,a,!1),{source:Le.HARDCODED_VALUES,metadata:a};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=Ka(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Le.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new W(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw ie(eo)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(u.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const a=await this.networkInterface.sendGetRequestAsync(t,e);return th(a.body)?a.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(a){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${a}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in ja?ja[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,a,i;(r=this.performanceClient)==null||r.addQueueMeasurement(u.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(a=this.authorityOptions.azureRegionConfiguration)==null?void 0:a.azureRegion;if(t){if(t!==w.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=Pn.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Ie.replaceWithRegionalInformation(e,t);const o=await b(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),u.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.environmentRegion,this.regionDiscoveryMetadata);if(o)return this.regionDiscoveryMetadata.region_outcome=Pn.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=o,Ie.replaceWithRegionalInformation(e,o);this.regionDiscoveryMetadata.region_outcome=Pn.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(u.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await b(this.getCloudDiscoveryMetadataFromNetwork.bind(this),u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return jn(e,r,!0),Le.NETWORK;throw ie(to)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||w.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||w.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||w.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),jn(e,t,!1),Le.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const a=Vl(this.hostnameAndPort);if(a)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),jn(e,a,!1),Le.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=Ka(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),Le.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===Ve.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Ie.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=Qr(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),ie(vs)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Ie.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${w.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const i=await this.networkInterface.sendGetRequestAsync(e,t);let o,c;if(rh(i.body))o=i.body,c=o.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${o.tenant_discovery_endpoint}`);else if(nh(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),o=i.body,o.error===w.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${o.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${o.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),c=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=Qr(c,this.hostnameAndPort)}catch(i){if(i instanceof ee)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{const o=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${o.name}
Error Description: ${o.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=Ie.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&W.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==ws.None){const a=t.tenant?t.tenant:w.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${a}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return w.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw I(ot)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return uo.has(e)}static isPublicCloudAuthority(e){return w.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const a=new W(e);a.validateAsUri();const i=a.getUrlComponents();let o=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(o=`${t}.${w.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const c=W.constructAuthorityUriFromObject({...a.getUrlComponents(),HostNameAndPort:o}).urlString;return r?`${c}?${r}`:c}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Ie.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Ie.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Ie.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const a=new W(e).getUrlComponents();if(a.PathSegments.length===0&&a.HostNameAndPort.endsWith(w.CIAM_AUTH_URL)){const i=a.HostNameAndPort.split(".")[0];t=`${t}${i}${w.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Ie.reservedTenantDomains=new Set(["{tenant}","{tenantid}",ft.COMMON,ft.CONSUMERS,ft.ORGANIZATIONS]);function uh(s){var a;const r=(a=new W(s).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:a.toLowerCase();switch(r){case ft.COMMON:case ft.ORGANIZATIONS:case ft.CONSUMERS:return;default:return r}}function _o(s){return s.endsWith(w.FORWARD_SLASH)?s:`${s}${w.FORWARD_SLASH}`}function gh(s){const e=s.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw ie(vs)}return{canonicalAuthority:s.authority?_o(s.authority):void 0,knownAuthorities:s.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.12.0 2025-08-19 */async function Ro(s,e,t,r,a,i,o){o==null||o.addQueueMeasurement(u.AuthorityFactoryCreateDiscoveredInstance,i);const c=Ie.transformCIAMAuthority(_o(s)),l=new Ie(c,e,t,r,a,i,o);try{return await b(l.resolveEndpointsAsync.bind(l),u.AuthorityResolveEndpointsAsync,a,o,i)(),l}catch{throw I(ot)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Ot extends ee{constructor(e,t,r,a,i){super(e,t,r),this.name="ServerError",this.errorNo=a,this.status=i,Object.setPrototypeOf(this,Ot.prototype)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function Cn(s,e,t){var r;return{clientId:s,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||((r=e.tokenBodyParameters)==null?void 0:r.clientId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class tt{static generateThrottlingStorageKey(e){return`${ar.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,r){var o;const a=tt.generateThrottlingStorageKey(t),i=e.getThrottlingCache(a);if(i){if(i.throttleTime<Date.now()){e.removeItem(a,r);return}throw new Ot(((o=i.errorCodes)==null?void 0:o.join(" "))||w.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r,a){if(tt.checkResponseStatus(r)||tt.checkResponseForRetryAfter(r)){const i={throttleTime:tt.calculateThrottleTime(parseInt(r.headers[Ee.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(tt.generateThrottlingStorageKey(t),i,a)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Ee.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||ar.DEFAULT_THROTTLE_TIME_SECONDS),r+ar.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,a){const i=Cn(t,r,a),o=this.generateThrottlingStorageKey(i);e.removeItem(o,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class vn extends ee{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,vn.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function sr(s,e,t,r){return s.errorMessage=`${s.errorMessage}, additionalErrorInfo: error.name:${r==null?void 0:r.name}, error.message:${r==null?void 0:r.message}`,new vn(s,e,t)}/*! @azure/msal-common v15.12.0 2025-08-19 */class Hs{constructor(e,t){this.config=nd(e),this.logger=new dt(this.config.loggerOptions,Vi,bs),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Ee.CONTENT_TYPE]=w.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Qe.HOME_ACCOUNT_ID:try{const r=Bt(e.credential);t[Ee.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case Qe.UPN:t[Ee.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,a,i,o){var l;o&&((l=this.performanceClient)==null||l.addQueueMeasurement(o,i));const c=await this.sendPostRequest(a,e,{body:t,headers:r},i);return this.config.serverTelemetryManager&&c.status<500&&c.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),c}async sendPostRequest(e,t,r,a){var o,c,l;tt.preProcess(this.cacheManager,e,a);let i;try{i=await b(this.networkClient.sendPostRequestAsync.bind(this.networkClient),u.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,a)(t,r);const d=i.headers||{};(c=this.performanceClient)==null||c.addFields({refreshTokenSize:((o=i.body.refresh_token)==null?void 0:o.length)||0,httpVerToken:d[Ee.X_MS_HTTP_VERSION]||"",requestId:d[Ee.X_MS_REQUEST_ID]||""},a)}catch(d){if(d instanceof vn){const h=d.responseHeaders;throw h&&((l=this.performanceClient)==null||l.addFields({httpVerToken:h[Ee.X_MS_HTTP_VERSION]||"",requestId:h[Ee.X_MS_REQUEST_ID]||"",contentTypeHeader:h[Ee.CONTENT_TYPE]||void 0,contentLengthHeader:h[Ee.CONTENT_LENGTH]||void 0,httpStatus:d.httpStatus},a)),d.error}throw d instanceof ee?d:I(Pi)}return tt.postProcess(this.cacheManager,e,i,a),i}async updateAuthority(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(u.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,a=await Ro(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=a}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&xn(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&xt(t,e.tokenQueryParameters),js(t,e.correlationId),yn(t,e.correlationId,this.performanceClient),gr(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */function Po(s){return s&&(s.tid||s.tfp||s.acr)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */class Ge{getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,loginHint:this.loginHint,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,r){var d,h,g,m,k,S,T;const a=new Ge;t.authorityType===Ve.Adfs?a.authorityType=Er.ADFS_ACCOUNT_TYPE:t.protocolMode===Me.OIDC?a.authorityType=Er.GENERIC_ACCOUNT_TYPE:a.authorityType=Er.MSSTS_ACCOUNT_TYPE;let i;e.clientInfo&&r&&(i=Jr(e.clientInfo,r)),a.clientInfo=e.clientInfo,a.homeAccountId=e.homeAccountId,a.nativeAccountId=e.nativeAccountId;const o=e.environment||t&&t.getPreferredCache();if(!o)throw I(fs);a.environment=o,a.realm=(i==null?void 0:i.utid)||Po(e.idTokenClaims)||"",a.localAccountId=(i==null?void 0:i.uid)||((d=e.idTokenClaims)==null?void 0:d.oid)||((h=e.idTokenClaims)==null?void 0:h.sub)||"";const c=((g=e.idTokenClaims)==null?void 0:g.preferred_username)||((m=e.idTokenClaims)==null?void 0:m.upn),l=(k=e.idTokenClaims)!=null&&k.emails?e.idTokenClaims.emails[0]:null;if(a.username=c||l||"",a.loginHint=(S=e.idTokenClaims)==null?void 0:S.login_hint,a.name=((T=e.idTokenClaims)==null?void 0:T.name)||"",a.cloudGraphHostName=e.cloudGraphHostName,a.msGraphHost=e.msGraphHost,e.tenantProfiles)a.tenantProfiles=e.tenantProfiles;else{const N=Ts(e.homeAccountId,a.localAccountId,a.realm,e.idTokenClaims);a.tenantProfiles=[N]}return a}static createFromAccountInfo(e,t,r){var i;const a=new Ge;return a.authorityType=e.authorityType||Er.GENERIC_ACCOUNT_TYPE,a.homeAccountId=e.homeAccountId,a.localAccountId=e.localAccountId,a.nativeAccountId=e.nativeAccountId,a.realm=e.tenantId,a.environment=e.environment,a.username=e.username,a.name=e.name,a.loginHint=e.loginHint,a.cloudGraphHostName=t,a.msGraphHost=r,a.tenantProfiles=Array.from(((i=e.tenantProfiles)==null?void 0:i.values())||[]),a}static generateHomeAccountId(e,t,r,a,i){if(!(t===Ve.Adfs||t===Ve.Dsts)){if(e)try{const o=Jr(e,a.base64Decode);if(o.uid&&o.utid)return`${o.uid}.${o.utid}`}catch{}r.warning("No client info in response")}return(i==null?void 0:i.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let a=!0;if(r){const i=e.idTokenClaims||{},o=t.idTokenClaims||{};a=i.iat===o.iat&&i.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&a}}/*! @azure/msal-common v15.12.0 2025-08-19 */const rn="no_tokens_found",Oo="native_account_unavailable",Bs="refresh_token_expired",$s="ux_not_allowed",mh="interaction_required",ph="consent_required",fh="login_required",An="bad_token";/*! @azure/msal-common v15.12.0 2025-08-19 */const za=[mh,ph,fh,An,$s],yh=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],xh={[rn]:"No refresh token found in the cache. Please sign-in.",[Oo]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Bs]:"Refresh token has expired.",[An]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[$s]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."};class Je extends ee{constructor(e,t,r,a,i,o,c,l){super(e,t,r),Object.setPrototypeOf(this,Je.prototype),this.timestamp=a||w.EMPTY_STRING,this.traceId=i||w.EMPTY_STRING,this.correlationId=o||w.EMPTY_STRING,this.claims=c||w.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function jo(s,e,t){const r=!!s&&za.indexOf(s)>-1,a=!!t&&yh.indexOf(t)>-1,i=!!e&&za.some(o=>e.indexOf(o)>-1);return r||i||a}function nn(s){return new Je(s,xh[s])}/*! @azure/msal-common v15.12.0 2025-08-19 */class Qt{static setRequestState(e,t,r){const a=Qt.generateLibraryState(e,r);return t?`${a}${w.RESOURCE_DELIM}${t}`:a}static generateLibraryState(e,t){if(!e)throw I(Vn);const r={id:e.createNewGuid()};t&&(r.meta=t);const a=JSON.stringify(r);return e.base64Encode(a)}static parseRequestState(e,t){if(!e)throw I(Vn);if(!t)throw I(Gt);try{const r=t.split(w.RESOURCE_DELIM),a=r[0],i=r.length>1?r.slice(1).join(w.RESOURCE_DELIM):w.EMPTY_STRING,o=e.base64Decode(a),c=JSON.parse(o);return{userRequestState:i||w.EMPTY_STRING,libraryState:c}}catch{throw I(Gt)}}}/*! @azure/msal-common v15.12.0 2025-08-19 */const bh={SW:"sw"};class qt{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(u.PopTokenGenerateCnf,e.correlationId);const r=await b(this.generateKid.bind(this),u.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),a=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:a}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(u.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:bh.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,a){const{resourceRequestMethod:i,resourceRequestUri:o,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=o?new W(o):void 0,g=h==null?void 0:h.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:De(),m:i==null?void 0:i.toUpperCase(),u:g==null?void 0:g.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:g==null?void 0:g.AbsolutePath,q:g!=null&&g.QueryString?[[],g.QueryString]:void 0,client_claims:c||void 0,...a},t,d,r.correlationId)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class wh{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.12.0 2025-08-19 */class Et{constructor(e,t,r,a,i,o,c){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=a,this.serializableCache=i,this.persistencePlugin=o,this.performanceClient=c}validateTokenResponse(e,t){var r;if(e.error||e.error_description||e.suberror){const a=`Error(s): ${e.error_codes||w.NOT_AVAILABLE} - Timestamp: ${e.timestamp||w.NOT_AVAILABLE} - Description: ${e.error_description||w.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||w.NOT_AVAILABLE} - Trace ID: ${e.trace_id||w.NOT_AVAILABLE}`,i=(r=e.error_codes)!=null&&r.length?e.error_codes[0]:void 0,o=new Ot(e.error,a,e.suberror,i,e.status);if(t&&e.status&&e.status>=pt.SERVER_ERROR_RANGE_START&&e.status<=pt.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${o}`);return}else if(t&&e.status&&e.status>=pt.CLIENT_ERROR_RANGE_START&&e.status<=pt.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${o}`);return}throw jo(e.error,e.error_description,e.suberror)?new Je(e.error,e.error_description,e.suberror,e.timestamp||w.EMPTY_STRING,e.trace_id||w.EMPTY_STRING,e.correlation_id||w.EMPTY_STRING,e.claims||w.EMPTY_STRING,i):o}}async handleServerTokenResponse(e,t,r,a,i,o,c,l,d){var S;(S=this.performanceClient)==null||S.addQueueMeasurement(u.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=Wt(e.id_token||w.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&h.nonce!==i.nonce)throw I(Di);if(a.maxAge||a.maxAge===0){const T=h.auth_time;if(!T)throw I(ms);co(T,a.maxAge)}}this.homeAccountIdentifier=Ge.generateHomeAccountId(e.client_info||w.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let g;i&&i.state&&(g=Qt.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||a.sshKid||void 0;const m=this.generateCacheRecord(e,t,r,a,h,o,i);let k;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),k=new wh(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(k)),c&&!l&&m.account){const T=this.cacheStorage.generateAccountKey(m.account.getAccountInfo());if(!this.cacheStorage.getAccount(T,a.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Et.generateAuthenticationResult(this.cryptoObj,t,m,!1,a,h,g,void 0,d)}await this.cacheStorage.saveCacheRecord(m,a.correlationId,a.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&k&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(k))}return Et.generateAuthenticationResult(this.cryptoObj,t,m,!1,a,h,g,e,d)}generateCacheRecord(e,t,r,a,i,o,c){const l=t.getPreferredCache();if(!l)throw I(fs);const d=Po(i);let h,g;e.id_token&&i&&(h=wn(this.homeAccountIdentifier,l,e.id_token,this.clientId,d||""),g=Ks(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,a.correlationId,i,e.client_info,l,d,c,void 0,this.logger));let m=null;if(e.access_token){const T=e.scope?me.fromString(e.scope):new me(a.scopes||[]),N=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,z=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,G=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,te=r+N,F=te+z,B=G&&G>0?r+G:void 0;m=kn(this.homeAccountIdentifier,l,e.access_token,this.clientId,d||t.tenant||"",T.printScopes(),te,F,this.cryptoObj.base64Decode,B,e.token_type,o,e.key_id,a.claims,a.requestedClaimsHash)}let k=null;if(e.refresh_token){let T;if(e.refresh_token_expires_in){const N=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;T=r+N}k=Eo(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,o,T)}let S=null;return e.foci&&(S={clientId:this.clientId,environment:l,familyId:e.foci}),{account:g,idToken:h,accessToken:m,refreshToken:k,appMetadata:S}}static async generateAuthenticationResult(e,t,r,a,i,o,c,l,d){var te,F,B,v,x;let h=w.EMPTY_STRING,g=[],m=null,k,S,T=w.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===J.POP&&!i.popKid){const f=new qt(e),{secret:_,keyId:C}=r.accessToken;if(!C)throw I(ys);h=await f.signPopToken(_,C,i)}else h=r.accessToken.secret;g=me.fromString(r.accessToken.target).asArray(),m=$t(r.accessToken.expiresOn),k=$t(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(S=$t(r.accessToken.refreshOn))}r.appMetadata&&(T=r.appMetadata.familyId===zr?zr:"");const N=(o==null?void 0:o.oid)||(o==null?void 0:o.sub)||"",z=(o==null?void 0:o.tid)||"";l!=null&&l.spa_accountid&&r.account&&(r.account.nativeAccountId=l==null?void 0:l.spa_accountid);const G=r.account?Is(r.account.getAccountInfo(),void 0,o,(te=r.idToken)==null?void 0:te.secret):null;return{authority:t.canonicalAuthority,uniqueId:N,tenantId:z,scopes:g,account:G,idToken:((F=r==null?void 0:r.idToken)==null?void 0:F.secret)||"",idTokenClaims:o||{},accessToken:h,fromCache:a,expiresOn:m,extExpiresOn:k,refreshOn:S,correlationId:i.correlationId,requestId:d||w.EMPTY_STRING,familyId:T,tokenType:((B=r.accessToken)==null?void 0:B.tokenType)||w.EMPTY_STRING,state:c?c.userRequestState:w.EMPTY_STRING,cloudGraphHostName:((v=r.account)==null?void 0:v.cloudGraphHostName)||w.EMPTY_STRING,msGraphHost:((x=r.account)==null?void 0:x.msGraphHost)||w.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function Ks(s,e,t,r,a,i,o,c,l,d,h,g){g==null||g.verbose("setCachedAccount called");const k=s.getAccountKeys().find(G=>G.startsWith(t));let S=null;k&&(S=s.getAccount(k,a));const T=S||Ge.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:o,environment:c,cloudGraphHostName:d==null?void 0:d.cloud_graph_host_name,msGraphHost:d==null?void 0:d.msgraph_host,nativeAccountId:h},e,r),N=T.tenantProfiles||[],z=l||T.realm;if(z&&!N.find(G=>G.tenantId===z)){const G=Ts(t,T.localAccountId,z,i);N.push(G)}return T.tenantProfiles=N,T}/*! @azure/msal-common v15.12.0 2025-08-19 */async function Mo(s,e,t){return typeof s=="string"?s:s({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.12.0 2025-08-19 */class Do extends Hs{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async acquireToken(e,t){var c,l;if((c=this.performanceClient)==null||c.addQueueMeasurement(u.AuthClientAcquireToken,e.correlationId),!e.code)throw I(Fi);const r=De(),a=await b(this.executeTokenRequest.bind(this),u.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=(l=a.headers)==null?void 0:l[Ee.X_MS_REQUEST_ID],o=new Et(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return o.validateTokenResponse(a.body),b(o.handleServerTokenResponse.bind(o),u.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(a.body,this.authority,r,e,t,void 0,void 0,void 0,i)}getLogoutUri(e){if(!e)throw ie(Zi);const t=this.createLogoutUrlQueryString(e);return W.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var d;(d=this.performanceClient)==null||d.addQueueMeasurement(u.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),a=W.appendQueryString(e.tokenEndpoint,r),i=await b(this.createTokenRequestBody.bind(this),u.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let o;if(t.clientInfo)try{const h=Jr(t.clientInfo,this.cryptoUtils.base64Decode);o={credential:`${h.uid}${ur.CLIENT_INFO_SEPARATOR}${h.utid}`,type:Qe.HOME_ACCOUNT_ID}}catch(h){this.logger.verbose("Could not parse client info for CCS Header: "+h)}const c=this.createTokenRequestHeaders(o||t.ccsCredential),l=Cn(this.config.authOptions.clientId,t);return b(this.executePostToTokenEndpoint.bind(this),u.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(a,i,c,l,t.correlationId,u.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var a,i;(a=this.performanceClient)==null||a.addQueueMeasurement(u.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(Rs(t,e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[Nt])||this.config.authOptions.clientId),this.includeRedirectUri)Ps(t,e.redirectUri);else if(!e.redirectUri)throw ie(Wi);if(_s(t,e.scopes,!0,this.oidcDefaultScopes),Wd(t,e.code),Ms(t,this.config.libraryInfo),Ds(t,this.config.telemetry.application),No(t),this.serverTelemetryManager&&!po(this.config)&&So(t,this.serverTelemetryManager),e.codeVerifier&&Yd(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&ko(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const o=this.config.clientCredentials.clientAssertion;Co(t,await Mo(o.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),vo(t,o.assertionType)}if(Ao(t,Ni.AUTHORIZATION_CODE_GRANT),Us(t),e.authenticationScheme===J.POP){const o=new qt(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await b(o.generateCnf.bind(o),u.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Ls(t,c)}else if(e.authenticationScheme===J.SSH)if(e.sshJwk)Io(t,e.sshJwk);else throw ie(fn);(!Fe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Os(t,e.claims,this.config.authOptions.clientCapabilities);let r;if(e.clientInfo)try{const o=Jr(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${o.uid}${ur.CLIENT_INFO_SEPARATOR}${o.utid}`,type:Qe.HOME_ACCOUNT_ID}}catch(o){this.logger.verbose("Could not parse client info for CCS Header: "+o)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case Qe.HOME_ACCOUNT_ID:try{const o=Bt(r.credential);ir(t,o)}catch(o){this.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case Qe.UPN:en(t,r.credential);break}return e.embeddedClientId&&xn(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&xt(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Ua])&&xt(t,{[Ua]:"1"}),yn(t,e.correlationId,this.performanceClient),gr(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&Kd(t,e.postLogoutRedirectUri),e.correlationId&&js(t,e.correlationId),e.idTokenHint&&zd(t,e.idTokenHint),e.state&&bo(t,e.state),e.logoutHint&&Xd(t,e.logoutHint),e.extraQueryParameters&&xt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&To(t),gr(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const kh=300;class Ch extends Hs{constructor(e,t){super(e,t)}async acquireToken(e){var o,c;(o=this.performanceClient)==null||o.addQueueMeasurement(u.RefreshTokenClientAcquireToken,e.correlationId);const t=De(),r=await b(this.executeTokenRequest.bind(this),u.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),a=(c=r.headers)==null?void 0:c[Ee.X_MS_REQUEST_ID],i=new Et(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(r.body),b(i.handleServerTokenResponse.bind(i),u.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,a)}async acquireTokenByRefreshToken(e){var r;if(!e)throw ie(Xi);if((r=this.performanceClient)==null||r.addQueueMeasurement(u.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw I(ps);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await b(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(a){const i=a instanceof Je&&a.errorCode===rn,o=a instanceof Ot&&a.errorCode===Na.INVALID_GRANT_ERROR&&a.subError===Na.CLIENT_MISMATCH_ERROR;if(i||o)return b(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw a}return b(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var i,o,c;(i=this.performanceClient)==null||i.addQueueMeasurement(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=He(this.cacheManager.getRefreshToken.bind(this.cacheManager),u.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!r)throw nn(rn);if(r.expiresOn&&tn(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||kh))throw(o=this.performanceClient)==null||o.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),nn(Bs);const a={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||J.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Qe.HOME_ACCOUNT_ID}};try{return await b(this.acquireToken.bind(this),u.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(a)}catch(l){if(l instanceof Je&&((c=this.performanceClient)==null||c.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),l.subError===An)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const d=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(d,e.correlationId)}throw l}}async executeTokenRequest(e,t){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(u.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),a=W.appendQueryString(t.tokenEndpoint,r),i=await b(this.createTokenRequestBody.bind(this),u.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),o=this.createTokenRequestHeaders(e.ccsCredential),c=Cn(this.config.authOptions.clientId,e);return b(this.executePostToTokenEndpoint.bind(this),u.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(a,i,o,c,e.correlationId,u.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,a,i;(r=this.performanceClient)==null||r.addQueueMeasurement(u.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(Rs(t,e.embeddedClientId||((a=e.tokenBodyParameters)==null?void 0:a[Nt])||this.config.authOptions.clientId),e.redirectUri&&Ps(t,e.redirectUri),_s(t,e.scopes,!0,(i=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:i.defaultScopes),Ao(t,Ni.REFRESH_TOKEN_GRANT),Us(t),Ms(t,this.config.libraryInfo),Ds(t,this.config.telemetry.application),No(t),this.serverTelemetryManager&&!po(this.config)&&So(t,this.serverTelemetryManager),Qd(t,e.refreshToken),this.config.clientCredentials.clientSecret&&ko(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const o=this.config.clientCredentials.clientAssertion;Co(t,await Mo(o.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),vo(t,o.assertionType)}if(e.authenticationScheme===J.POP){const o=new qt(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await b(o.generateCnf.bind(o),u.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Ls(t,c)}else if(e.authenticationScheme===J.SSH)if(e.sshJwk)Io(t,e.sshJwk);else throw ie(fn);if((!Fe.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Os(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Qe.HOME_ACCOUNT_ID:try{const o=Bt(e.ccsCredential.credential);ir(t,o)}catch(o){this.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case Qe.UPN:en(t,e.ccsCredential.credential);break}return e.embeddedClientId&&xn(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&xt(t,e.tokenBodyParameters),yn(t,e.correlationId,this.performanceClient),gr(t)}}/*! @azure/msal-common v15.12.0 2025-08-19 */class vh extends Hs{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(u.SilentFlowClientAcquireCachedToken,e.correlationId);let t=At.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Fe.isEmptyObj(e.claims))throw this.setCacheOutcome(At.FORCE_REFRESH_OR_CLAIMS,e.correlationId),I(yt);if(!e.account)throw I(ps);const r=e.account.tenantId||uh(e.authority),a=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,a,r);if(i){if(ah(i.cachedAt)||tn(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(At.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),I(yt);i.refreshOn&&tn(i.refreshOn,0)&&(t=At.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(At.NO_CACHED_ACCESS_TOKEN,e.correlationId),I(yt);const o=e.authority||this.authority.getPreferredCache(),c={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,a,r,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(o)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await b(this.generateResultFromCacheRecord.bind(this),u.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(c,e),t]}setCacheOutcome(e,t){var r,a;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(a=this.performanceClient)==null||a.addFields({cacheOutcome:e},t),e!==At.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var a;(a=this.performanceClient)==null||a.addQueueMeasurement(u.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=Wt(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const i=r==null?void 0:r.auth_time;if(!i)throw I(ms);co(i,t.maxAge)}return Et.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ah={sendGetRequestAsync:()=>Promise.reject(I($)),sendPostRequestAsync:()=>Promise.reject(I($))};/*! @azure/msal-common v15.12.0 2025-08-19 */function Th(s,e,t,r){var c,l;const a=e.correlationId,i=new Map;Rs(i,e.embeddedClientId||((c=e.extraQueryParameters)==null?void 0:c[Nt])||s.clientId);const o=[...e.scopes||[],...e.extraScopesToConsent||[]];if(_s(i,o,!0,(l=s.authority.options.OIDCOptions)==null?void 0:l.defaultScopes),Ps(i,e.redirectUri),js(i,a),Bd(i,e.responseMode),Us(i),e.prompt&&(qd(i,e.prompt),r==null||r.addFields({prompt:e.prompt},a)),e.domainHint&&(Gd(i,e.domainHint),r==null||r.addFields({domainHintFromRequest:!0},a)),e.prompt!==Re.SELECT_ACCOUNT)if(e.sid&&e.prompt===Re.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),La(i,e.sid),r==null||r.addFields({sidFromRequest:!0},a);else if(e.account){const d=Nh(e.account);let h=Eh(e.account);if(h&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),h=null),h){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),_r(i,h),r==null||r.addFields({loginHintFromClaim:!0},a);try{const g=Bt(e.account.homeAccountId);ir(i,g)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(d&&e.prompt===Re.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),La(i,d),r==null||r.addFields({sidFromClaim:!0},a);try{const g=Bt(e.account.homeAccountId);ir(i,g)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),_r(i,e.loginHint),en(i,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},a);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),_r(i,e.account.username),r==null||r.addFields({loginHintFromUpn:!0},a);try{const g=Bt(e.account.homeAccountId);ir(i,g)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),_r(i,e.loginHint),en(i,e.loginHint),r==null||r.addFields({loginHintFromRequest:!0},a));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&Vd(i,e.nonce),e.state&&bo(i,e.state),(e.claims||s.clientCapabilities&&s.clientCapabilities.length>0)&&Os(i,e.claims,s.clientCapabilities),e.embeddedClientId&&xn(i,s.clientId,s.redirectUri),s.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(Yn))&&To(i),i}function zs(s,e,t,r){const a=gr(e,t,r);return W.appendQueryString(s.authorizationEndpoint,a)}function Ih(s,e){if(Uo(s,e),!s.code)throw I(zi);return s}function Uo(s,e){if(!s.state||!e)throw s.state?I(zn,"Cached State"):I(zn,"Server State");let t,r;try{t=decodeURIComponent(s.state)}catch{throw I(Gt,s.state)}try{r=decodeURIComponent(e)}catch{throw I(Gt,s.state)}if(t!==r)throw I(Mi);if(s.error||s.error_description||s.suberror){const a=Sh(s);throw jo(s.error,s.error_description,s.suberror)?new Je(s.error||"",s.error_description,s.suberror,s.timestamp||"",s.trace_id||"",s.correlation_id||"",s.claims||"",a):new Ot(s.error||"",s.error_description,s.suberror,a)}}function Sh(s){var r,a;const e="code=",t=(r=s.error_uri)==null?void 0:r.lastIndexOf(e);return t&&t>=0?(a=s.error_uri)==null?void 0:a.substring(t+e.length):void 0}function Nh(s){var e;return((e=s.idTokenClaims)==null?void 0:e.sid)||null}function Eh(s){var e;return s.loginHint||((e=s.idTokenClaims)==null?void 0:e.login_hint)||null}/*! @azure/msal-common v15.12.0 2025-08-19 */const Ga=",",Lo="|";function _h(s){const{skus:e,libraryName:t,libraryVersion:r,extensionName:a,extensionVersion:i}=s,o=new Map([[0,[t,r]],[2,[a,i]]]);let c=[];if(e!=null&&e.length){if(c=e.split(Ga),c.length<4)return e}else c=Array.from({length:4},()=>Lo);return o.forEach((l,d)=>{var h,g;l.length===2&&((h=l[0])!=null&&h.length)&&((g=l[1])!=null&&g.length)&&Rh({skuArr:c,index:d,skuName:l[0],skuVersion:l[1]})}),c.join(Ga)}function Rh(s){const{skuArr:e,index:t,skuName:r,skuVersion:a}=s;t>=e.length||(e[t]=[r,a].join(Lo))}class mr{constructor(e,t){this.cacheOutcome=At.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||w.EMPTY_STRING,this.wrapperVer=e.wrapperVer||w.EMPTY_STRING,this.telemetryCacheKey=ke.CACHE_KEY+ur.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${ke.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r!=null&&r.length&&t.push(`broker_error=${r}`);const a=t.join(ke.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),o=[e,i].join(ke.VALUE_SEPARATOR);return[ke.SCHEMA_VERSION,o,a].join(ke.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=mr.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(ke.VALUE_SEPARATOR),a=e.errors.slice(0,t).join(ke.VALUE_SEPARATOR),i=e.errors.length,o=t<i?ke.OVERFLOW_TRUE:ke.OVERFLOW_FALSE,c=[i,o].join(ke.VALUE_SEPARATOR);return[ke.SCHEMA_VERSION,e.cacheHits,r,a,c].join(ke.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=ke.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof ee?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(ke.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=mr.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const a={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,a,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,a=0;const i=e.errors.length;for(t=0;t<i;t++){const o=e.failedRequests[2*t]||w.EMPTY_STRING,c=e.failedRequests[2*t+1]||w.EMPTY_STRING,l=e.errors[t]||w.EMPTY_STRING;if(a+=o.toString().length+c.toString().length+l.length+3,a<ke.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||w.EMPTY_STRING),e.push(this.regionSource||w.EMPTY_STRING),e.push(this.regionOutcome||w.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return _h(e)}}/*! @azure/msal-common v15.12.0 2025-08-19 */const Fo="missing_kid_error",Ho="missing_alg_error";/*! @azure/msal-common v15.12.0 2025-08-19 */const Ph={[Fo]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Ho]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Gs extends ee{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Gs.prototype)}}function qa(s){return new Gs(s,Ph[s])}/*! @azure/msal-common v15.12.0 2025-08-19 */class qs{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw qa(Fo);if(!e.alg)throw qa(Ho);const t=new qs({typ:e.typ||Tl.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const Vs="pkce_not_created",Ws="ear_jwk_empty",Bo="ear_jwe_empty",Jn="crypto_nonexistent",Tn="empty_navigate_uri",$o="hash_empty_error",Qs="no_state_in_hash",Ko="hash_does_not_contain_known_properties",zo="unable_to_parse_state",Go="state_interaction_type_mismatch",qo="interaction_in_progress",Vo="popup_window_error",Wo="empty_window_error",pr="user_cancelled",Oh="monitor_popup_timeout",Qo="monitor_window_timeout",Yo="redirect_in_iframe",Jo="block_iframe_reload",Xo="block_nested_popups",jh="iframe_closed_prematurely",In="silent_logout_unsupported",Zo="no_account_error",Mh="silent_prompt_value_error",ec="no_token_request_cache_error",tc="unable_to_parse_token_request_cache_error",Dh="auth_request_not_set_error",Uh="invalid_cache_type",Sn="non_browser_environment",Ut="database_not_open",sn="no_network_connectivity",rc="post_request_failed",nc="get_request_failed",Xn="failed_to_parse_response",sc="unable_to_load_token",Ys="crypto_key_not_found",ac="auth_code_required",ic="auth_code_or_nativeAccountId_required",oc="spa_code_and_nativeAccountId_present",Js="database_unavailable",cc="unable_to_acquire_token_from_native_platform",lc="native_handshake_timeout",dc="native_extension_not_installed",Xs="native_connection_not_established",or="uninitialized_public_client_application",hc="native_prompt_not_supported",uc="invalid_base64_string",gc="invalid_pop_token_request",mc="failed_to_build_headers",pc="failed_to_parse_headers",Br="failed_to_decrypt_ear_response",an="timed_out";/*! @azure/msal-browser v4.22.1 2025-09-09 */const at="For more visit: aka.ms/msaljs/browser-errors",Lh={[Vs]:"The PKCE code challenge and verifier could not be generated.",[Ws]:"No EAR encryption key provided. This is unexpected.",[Bo]:"Server response does not contain ear_jwe property. This is unexpected.",[Jn]:"The crypto object or function is not available.",[Tn]:"Navigation URI is empty. Please check stack trace for more info.",[$o]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${at}`,[Qs]:"Hash does not contain state. Please verify that the request originated from msal.",[Ko]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${at}`,[zo]:"Unable to parse state. Please verify that the request originated from msal.",[Go]:"Hash contains state but the interaction type does not match the caller.",[qo]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${at}`,[Vo]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Wo]:"window.open returned null or undefined window object.",[pr]:"User cancelled the flow.",[Oh]:`Token acquisition in popup failed due to timeout.  ${at}`,[Qo]:`Token acquisition in iframe failed due to timeout.  ${at}`,[Yo]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Jo]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${at}`,[Xo]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[jh]:"The iframe being monitored was closed prematurely.",[In]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[Zo]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Mh]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[ec]:"No token request found in cache.",[tc]:"The cached token request could not be parsed.",[Dh]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Uh]:"Invalid cache type",[Sn]:"Login and token requests are not supported in non-browser environments.",[Ut]:"Database is not open!",[sn]:"No network connectivity. Check your internet connection.",[rc]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[nc]:"Network request failed. Please check the network trace to determine root cause.",[Xn]:"Failed to parse network response. Check network trace.",[sc]:"Error loading token to cache.",[Ys]:"Cryptographic Key or Keypair not found in browser storage.",[ac]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[ic]:"An authorization code or nativeAccountId must be provided to this flow.",[oc]:"Request cannot contain both spa code and native account id.",[Js]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[cc]:`Unable to acquire token from native platform.  ${at}`,[lc]:"Timed out while attempting to establish connection to browser extension",[dc]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Xs]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${at}`,[or]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${at}`,[hc]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[uc]:"Invalid base64 encoded string.",[gc]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[mc]:"Failed to build request headers object.",[pc]:"Failed to parse response headers",[Br]:"Failed to decrypt ear response",[an]:"The request timed out."};class wr extends ee{constructor(e,t){super(e,Lh[e],t),Object.setPrototypeOf(this,wr.prototype),this.name="BrowserAuthError"}}function O(s,e){return new wr(s,e)}/*! @azure/msal-browser v4.22.1 2025-09-09 */const je={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Ke={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},tr={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},pe={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Va={GET:"GET",POST:"POST"},gt={SIGNIN:"signin",SIGNOUT:"signout"},ue={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},Pr={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},Z={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var D;(function(s){s.Redirect="redirect",s.Popup="popup",s.Silent="silent",s.None="none"})(D||(D={}));const oe={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Wa={scopes:Vt},fc="jwk",Fh={React:"@azure/msal-react",Angular:"@azure/msal-angular"},Zn="msal.db",Hh=1,Bh=`${Zn}.keys`,Ne={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},$h=[Ne.Default,Ne.Skip,Ne.RefreshTokenAndNetwork];/*! @azure/msal-browser v4.22.1 2025-09-09 */function Or(s){return encodeURIComponent(fr(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function wt(s){return yc(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function fr(s){return yc(new TextEncoder().encode(s))}function yc(s){const e=Array.from(s,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.22.1 2025-09-09 */function Ye(s){return new TextDecoder().decode(bt(s))}function bt(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw O(uc)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v4.22.1 2025-09-09 */const Kh="RSASSA-PKCS1-v1_5",Yt="AES-GCM",xc="HKDF",Zs="SHA-256",zh=2048,Gh=new Uint8Array([1,0,1]),Qa="0123456789abcdef",Ya=new Uint32Array(1),ea="raw",bc="encrypt",ta="decrypt",qh="deriveKey",Vh="crypto_subtle_undefined",ra={name:Kh,hash:Zs,modulusLength:zh,publicExponent:Gh};function Wh(s){if(!window)throw O(Sn);if(!window.crypto)throw O(Jn);if(!s&&!window.crypto.subtle)throw O(Jn,Vh)}async function wc(s,e,t){e==null||e.addQueueMeasurement(u.Sha256Digest,t);const a=new TextEncoder().encode(s);return window.crypto.subtle.digest(Zs,a)}function Qh(s){return window.crypto.getRandomValues(s)}function Mn(){return window.crypto.getRandomValues(Ya),Ya[0]}function Xe(){const s=Date.now(),e=Mn()*1024+(Mn()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),a=e&2**30-1,i=Mn();t[0]=s/2**40,t[1]=s/2**32,t[2]=s/2**24,t[3]=s/2**16,t[4]=s/2**8,t[5]=s,t[6]=112|r>>>8,t[7]=r,t[8]=128|a>>>24,t[9]=a>>>16,t[10]=a>>>8,t[11]=a,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let o="";for(let c=0;c<t.length;c++)o+=Qa.charAt(t[c]>>>4),o+=Qa.charAt(t[c]&15),(c===3||c===5||c===7||c===9)&&(o+="-");return o}async function Yh(s,e){return window.crypto.subtle.generateKey(ra,s,e)}async function Dn(s){return window.crypto.subtle.exportKey(fc,s)}async function Jh(s,e,t){return window.crypto.subtle.importKey(fc,s,ra,e,t)}async function Xh(s,e){return window.crypto.subtle.sign(ra,s,e)}async function na(){const s=await kc(),t={alg:"dir",kty:"oct",k:wt(new Uint8Array(s))};return fr(JSON.stringify(t))}async function Zh(s){const e=Ye(s),r=JSON.parse(e).k,a=bt(r);return window.crypto.subtle.importKey(ea,a,Yt,!1,[ta])}async function eu(s,e){const t=e.split(".");if(t.length!==5)throw O(Br,"jwe_length");const r=await Zh(s).catch(()=>{throw O(Br,"import_key")});try{const a=new TextEncoder().encode(t[0]),i=bt(t[2]),o=bt(t[3]),c=bt(t[4]),l=c.byteLength*8,d=new Uint8Array(o.length+c.length);d.set(o),d.set(c,o.length);const h=await window.crypto.subtle.decrypt({name:Yt,iv:i,tagLength:l,additionalData:a},r,d);return new TextDecoder().decode(h)}catch{throw O(Br,"decrypt")}}async function kc(){const s=await window.crypto.subtle.generateKey({name:Yt,length:256},!0,[bc,ta]);return window.crypto.subtle.exportKey(ea,s)}async function Ja(s){return window.crypto.subtle.importKey(ea,s,xc,!1,[qh])}async function Cc(s,e,t){return window.crypto.subtle.deriveKey({name:xc,salt:e,hash:Zs,info:new TextEncoder().encode(t)},s,{name:Yt,length:256},!1,[bc,ta])}async function tu(s,e,t){const r=new TextEncoder().encode(e),a=window.crypto.getRandomValues(new Uint8Array(16)),i=await Cc(s,a,t),o=await window.crypto.subtle.encrypt({name:Yt,iv:new Uint8Array(12)},i,r);return{data:wt(new Uint8Array(o)),nonce:wt(a)}}async function Xa(s,e,t,r){const a=bt(r),i=await Cc(s,bt(e),t),o=await window.crypto.subtle.decrypt({name:Yt,iv:new Uint8Array(12)},i,a);return new TextDecoder().decode(o)}async function vc(s){const e=await wc(s),t=new Uint8Array(e);return wt(t)}/*! @azure/msal-browser v4.22.1 2025-09-09 */const sa="storage_not_supported",fe="stubbed_public_client_application_called",Ac="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.22.1 2025-09-09 */const ru={[sa]:"Given storage configuration option was not supported.",[fe]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[Ac]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class aa extends ee{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,aa.prototype)}}function he(s){return new aa(s,ru[s])}/*! @azure/msal-browser v4.22.1 2025-09-09 */function Tc(s){s.location.hash="",typeof s.history.replaceState=="function"&&s.history.replaceState(null,"",`${s.location.origin}${s.location.pathname}${s.location.search}`)}function nu(s){const e=s.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function ia(){return window.parent!==window}function su(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${je.POPUP_NAME_PREFIX}.`)===0}function ct(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function au(){const e=new W(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function iu(){if(W.hashContainsKnownProperties(window.location.hash)&&ia())throw O(Jo)}function ou(s){if(ia()&&!s)throw O(Yo)}function cu(){if(su())throw O(Xo)}function Ic(){if(typeof window>"u")throw O(Sn)}function Sc(s){if(!s)throw O(or)}function oa(s){Ic(),iu(),cu(),Sc(s)}function Za(s,e){if(oa(s),ou(e.system.allowRedirectInIframe),e.cache.cacheLocation===pe.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw he(Ac)}function Nc(s){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(s).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function lu(){return Xe()}/*! @azure/msal-browser v4.22.1 2025-09-09 */class on{navigateInternal(e,t){return on.defaultNavigateWindow(e,t)}navigateExternal(e,t){return on.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((r,a)=>{setTimeout(()=>{a(O(an,"failed_to_redirect"))},t.timeout)})}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class du{async sendGetRequestAsync(e,t){let r,a={},i=0;const o=ei(t);try{r=await fetch(e,{method:Va.GET,headers:o})}catch(c){throw sr(O(window.navigator.onLine?nc:sn),void 0,void 0,c)}a=ti(r.headers);try{return i=r.status,{headers:a,body:await r.json(),status:i}}catch(c){throw sr(O(Xn),i,a,c)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",a=ei(t);let i,o=0,c={};try{i=await fetch(e,{method:Va.POST,headers:a,body:r})}catch(l){throw sr(O(window.navigator.onLine?rc:sn),void 0,void 0,l)}c=ti(i.headers);try{return o=i.status,{headers:c,body:await i.json(),status:o}}catch(l){throw sr(O(Xn),o,c,l)}}}function ei(s){try{const e=new Headers;if(!(s&&s.headers))return e;const t=s.headers;return Object.entries(t).forEach(([r,a])=>{e.append(r,a)}),e}catch(e){throw sr(O(mc),void 0,void 0,e)}}function ti(s){try{const e={};return s.forEach((t,r)=>{e[r]=t}),e}catch{throw O(pc)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const hu=6e4,es=1e4,uu=3e4,Ec=2e3;function gu({auth:s,cache:e,system:t,telemetry:r},a){const i={clientId:w.EMPTY_STRING,authority:`${w.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:w.EMPTY_STRING,authorityMetadata:w.EMPTY_STRING,redirectUri:typeof window<"u"?ct():"",postLogoutRedirectUri:w.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Me.AAD,OIDCOptions:{serverResponseType:pn.FRAGMENT,defaultScopes:[w.OPENID_SCOPE,w.PROFILE_SCOPE,w.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:ws.None,tenant:w.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},o={cacheLocation:pe.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:pe.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===pe.LocalStorage),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:ce.Info,piiLoggingEnabled:!1},d={...{...mo,loggerOptions:c,networkClient:a?new du:Ah,navigationClient:new on,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||hu,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||es,navigateFrameWait:0,redirectNavigationTimeout:uu,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||Ec,pollIntervalMilliseconds:je.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||c},h={application:{appName:w.EMPTY_STRING,appVersion:w.EMPTY_STRING},client:new go};if((s==null?void 0:s.protocolMode)!==Me.OIDC&&(s!=null&&s.OIDCOptions)&&new dt(d.loggerOptions).warning(JSON.stringify(ie(no))),s!=null&&s.protocolMode&&s.protocolMode===Me.OIDC&&(d!=null&&d.allowPlatformBroker))throw ie(so);return{auth:{...i,...s,OIDCOptions:{...i.OIDCOptions,...s==null?void 0:s.OIDCOptions}},cache:{...o,...e},system:d,telemetry:{...h,...r}}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const mu="@azure/msal-browser",_t="4.22.1";/*! @azure/msal-browser v4.22.1 2025-09-09 */const ye="msal",ca="browser",Un="-",ut=1,ts=1,pu=`${ye}.${ca}.log.level`,fu=`${ye}.${ca}.log.pii`,yu=`${ye}.${ca}.platform.auth.dom`,ri=`${ye}.version`,ni="account.keys",si="token.keys";function et(s=ts){return s<1?`${ye}.${ni}`:`${ye}.${s}.${ni}`}function It(s,e=ut){return e<1?`${ye}.${si}.${s}`:`${ye}.${e}.${si}.${s}`}/*! @azure/msal-browser v4.22.1 2025-09-09 */class la{static loggerCallback(e,t){switch(e){case ce.Error:console.error(t);return;case ce.Info:console.info(t);return;case ce.Verbose:console.debug(t);return;case ce.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=gu(e,this.browserEnvironment);let t;try{t=window[pe.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(pu),a=(l=t==null?void 0:t.getItem(fu))==null?void 0:l.toLowerCase(),i=a==="true"?!0:a==="false"?!1:void 0,o={...this.config.system.loggerOptions},c=r&&Object.keys(ce).includes(r)?ce[r]:void 0;c&&(o.loggerCallback=la.loggerCallback,o.logLevel=c),i!==void 0&&(o.piiLoggingEnabled=i),this.logger=new dt(o,mu,_t),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Rt extends la{getModuleName(){return Rt.MODULE_NAME}getId(){return Rt.ID}async initialize(){return this.available=typeof window<"u",this.available}}Rt.MODULE_NAME="";Rt.ID="StandardOperatingContext";/*! @azure/msal-browser v4.22.1 2025-09-09 */class xu{constructor(){this.dbName=Zn,this.version=Hh,this.tableName=Bh,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",a=>{a.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",a=>{const i=a;this.db=i.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(O(Js)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(O(Ut));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result)}),o.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,a)=>{if(!this.db)return a(O(Ut));const c=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);c.addEventListener("success",()=>{this.closeConnection(),r()}),c.addEventListener("error",l=>{this.closeConnection(),a(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(O(Ut));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(O(Ut));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",o=>{const c=o;this.closeConnection(),e(c.target.result)}),i.addEventListener("error",o=>{this.closeConnection(),t(o)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(O(Ut));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",c=>{const l=c;this.closeConnection(),t(l.target.result===1)}),o.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(Zn),a=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(a),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(a),e(!0))),r.addEventListener("error",()=>(clearTimeout(a),t(!1)))})}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Nn{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class bu{constructor(e){this.inMemoryCache=new Nn,this.indexedDBCache=new xu,this.logger=e}handleDatabaseAccessError(e){if(e instanceof wr&&e.errorCode===Js)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class ht{constructor(e,t,r){this.logger=e,Wh(r??!1),this.cache=new bu(this.logger),this.performanceClient=t}createNewGuid(){return Xe()}base64Encode(e){return fr(e)}base64Decode(e){return Ye(e)}base64UrlEncode(e){return Or(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var h;const t=(h=this.performanceClient)==null?void 0:h.startMeasurement(u.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await Yh(ht.EXTRACTABLE,ht.POP_KEY_USAGES),a=await Dn(r.publicKey),i={e:a.e,kty:a.kty,n:a.n},o=ai(i),c=await this.hashString(o),l=await Dn(r.privateKey),d=await Jh(l,!1,["sign"]);return await this.cache.setItem(c,{privateKey:d,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),c}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw I(Gi)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,a){var te;const i=(te=this.performanceClient)==null?void 0:te.startMeasurement(u.CryptoOptsSignJwt,a),o=await this.cache.getItem(t);if(!o)throw O(Ys);const c=await Dn(o.publicKey),l=ai(c),d=Or(JSON.stringify({kid:t})),h=qs.getShrHeaderString({...r==null?void 0:r.header,alg:c.alg,kid:d}),g=Or(h);e.cnf={jwk:JSON.parse(l)};const m=Or(JSON.stringify(e)),k=`${g}.${m}`,T=new TextEncoder().encode(k),N=await Xh(o.privateKey,T),z=wt(new Uint8Array(N)),G=`${k}.${z}`;return i&&i.end({success:!0}),G}async hashString(e){return vc(e)}}ht.POP_KEY_USAGES=["sign","verify"];ht.EXTRACTABLE=!0;function ai(s){return JSON.stringify(s,Object.keys(s).sort())}/*! @azure/msal-browser v4.22.1 2025-09-09 */const wu=24*60*60*1e3,rs={Lax:"Lax",None:"None"};class _c{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let a=0;a<r.length;a++){const i=r[a],[o,...c]=decodeURIComponent(i).trim().split("="),l=c.join("=");if(o===t)return l}return""}getUserData(){throw I($)}setItem(e,t,r,a=!0,i=rs.Lax){let o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(r){const c=ku(r);o+=`expires=${c};`}(a||i===rs.None)&&(o+="Secure;"),document.cookie=o}async setUserData(){return Promise.reject(I($))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(r=>{const a=decodeURIComponent(r).trim().split("=");t.push(a[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function ku(s){const e=new Date;return new Date(e.getTime()+s*wu).toUTCString()}/*! @azure/msal-browser v4.22.1 2025-09-09 */function cr(s,e){const t=s.getItem(et(e));return t?JSON.parse(t):[]}function lr(s,e,t){const r=e.getItem(It(s,t));if(r){const a=JSON.parse(r);if(a&&a.hasOwnProperty("idToken")&&a.hasOwnProperty("accessToken")&&a.hasOwnProperty("refreshToken"))return a}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.22.1 2025-09-09 */function ns(s){return s.hasOwnProperty("id")&&s.hasOwnProperty("nonce")&&s.hasOwnProperty("data")}/*! @azure/msal-browser v4.22.1 2025-09-09 */const ii="msal.cache.encryption",Cu="msal.broadcast.cache";class vu{constructor(e,t,r){if(!window.localStorage)throw he(sa);this.memoryStorage=new Nn,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel(Cu)}async initialize(e){const t=new _c,r=t.getItem(ii);let a={key:"",id:""};if(r)try{a=JSON.parse(r)}catch{}if(a.key&&a.id){const i=He(bt,u.Base64Decode,this.logger,this.performanceClient,e)(a.key);this.encryptionCookie={id:a.id,key:await b(Ja,u.GenerateHKDF,this.logger,this.performanceClient,e)(i)}}else{const i=Xe(),o=await b(kc,u.GenerateBaseKey,this.logger,this.performanceClient,e)(),c=He(wt,u.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(o));this.encryptionCookie={id:i,key:await b(Ja,u.GenerateHKDF,this.logger,this.performanceClient,e)(o)};const l={id:i,key:c};t.setItem(ii,JSON.stringify(l),0,!0,rs.None)}await b(this.importExistingCache.bind(this),u.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw O(or);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw O(or);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const a=await b(Xa,u.Decrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!a)return null;try{return JSON.parse(a)}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,a){if(!this.initialized||!this.encryptionCookie)throw O(or);const{data:i,nonce:o}=await b(tu,u.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:o,data:i,lastUpdatedAt:a};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(c)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),cr(this).forEach(r=>this.removeItem(r));const t=lr(this.clientId,this);t.idToken.forEach(r=>this.removeItem(r)),t.accessToken.forEach(r=>this.removeItem(r)),t.refreshToken.forEach(r=>this.removeItem(r)),this.getKeys().forEach(r=>{(r.startsWith(ye)||r.indexOf(this.clientId)!==-1)&&this.removeItem(r)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=cr(this);t=await this.importArray(t,e),t.length?this.setItem(et(),JSON.stringify(t)):this.removeItem(et());const r=lr(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(It(this.clientId),JSON.stringify(r)):this.removeItem(It(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let a;try{a=JSON.parse(r)}catch{return null}return ns(a)?a.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):b(Xa,u.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,a.nonce,this.getContext(e),a.data):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),a)}async importArray(e,t){const r=[],a=[];return e.forEach(i=>{const o=this.getItemFromEncryptedCache(i,t).then(c=>{c?(this.memoryStorage.setItem(i,c),r.push(i)):this.removeItem(i)});a.push(o)}),await Promise.all(a),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(u.LocalStorageUpdated);t.add({isBackground:!0});const{key:r,value:a,context:i}=e.data;if(!r){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}a?(this.memoryStorage.setItem(r,a),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Au{constructor(){if(!window.sessionStorage)throw he(sa)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const P={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};/*! @azure/msal-browser v4.22.1 2025-09-09 */function oi(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}/*! @azure/msal-browser v4.22.1 2025-09-09 */class ss extends Qn{constructor(e,t,r,a,i,o,c){super(e,r,a,i,c),this.cacheConfig=t,this.logger=a,this.internalStorage=new Nn,this.browserStorage=ci(e,t.cacheLocation,a,i),this.temporaryCacheStorage=ci(e,t.temporaryCacheLocation,a,i),this.cookieStorage=new _c,this.eventHandler=o}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){const t=cr(this.browserStorage,0),r=lr(this.clientId,this.browserStorage,0);this.performanceClient.addFields({oldAccountCount:t.length,oldAccessCount:r.accessToken.length,oldIdCount:r.idToken.length,oldRefreshCount:r.refreshToken.length},e);const a=cr(this.browserStorage,1),i=lr(this.clientId,this.browserStorage,1);this.performanceClient.addFields({currAccountCount:a.length,currAccessCount:i.accessToken.length,currIdCount:i.idToken.length,currRefreshCount:i.refreshToken.length},e),await Promise.all([this.updateV0ToCurrent(ts,t,a,e),this.updateV0ToCurrent(ut,r.idToken,i.idToken,e),this.updateV0ToCurrent(ut,r.accessToken,i.accessToken,e),this.updateV0ToCurrent(ut,r.refreshToken,i.refreshToken,e)]),t.length>0?this.browserStorage.setItem(et(0),JSON.stringify(t)):this.browserStorage.removeItem(et(0)),a.length>0?this.browserStorage.setItem(et(1),JSON.stringify(a)):this.browserStorage.removeItem(et(1)),this.setTokenKeys(r,e,0),this.setTokenKeys(i,e,1)}async updateV0ToCurrent(e,t,r,a){const i=[];for(const o of[...t]){const c=this.browserStorage.getItem(o),l=this.validateAndParseJson(c||"");if(!l){oi(t,o);continue}l.lastUpdatedAt||(l.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(l),a));const d=ns(l)?await this.browserStorage.decryptData(o,l,a):l;let h;if(d&&(Ha(d)||Ba(d))&&(h=d.expiresOn),!d||sh(l.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)||h&&tn(h,Ei)){this.browserStorage.removeItem(o),oi(t,o),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},a);continue}if(this.cacheConfig.cacheLocation!==pe.LocalStorage||ns(l)){const g=`${ye}.${e}${Un}${o}`,m=this.browserStorage.getItem(g);if(m){const k=this.validateAndParseJson(m);if(Number(l.lastUpdatedAt)>Number(k.lastUpdatedAt)){i.push(this.setUserData(g,JSON.stringify(d),a,l.lastUpdatedAt).then(()=>{this.performanceClient.incrementFields({updatedCacheFromV0Count:1},a)}));continue}}else{i.push(this.setUserData(g,JSON.stringify(d),a,l.lastUpdatedAt).then(()=>{r.push(g),this.performanceClient.incrementFields({upgradedCacheCount:1},a)}));continue}}}return Promise.all(i)}trackVersionChanges(e){const t=this.browserStorage.getItem(ri);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==_t&&this.setItem(ri,_t,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,r){let a=0,i=[];const o=20;for(let c=0;c<=o;c++)try{this.browserStorage.setItem(e,t),c>0&&(c<=a?this.removeAccessTokenKeys(i.slice(0,c),r,0):(this.removeAccessTokenKeys(i.slice(0,a),r,0),this.removeAccessTokenKeys(i.slice(a,c),r)));break}catch(l){const d=Wn(l);if(d.errorCode===Yr&&c<o){if(!i.length){const h=e===It(this.clientId,0)?JSON.parse(t).accessToken:this.getTokenKeys(0).accessToken,g=e===It(this.clientId)?JSON.parse(t).accessToken:this.getTokenKeys().accessToken;i=[...h,...g],a=h.length}if(i.length<=c)throw d;this.removeAccessToken(i[c],r,!1)}else throw d}}async setUserData(e,t,r,a){let i=0,o=[];const c=20;for(let l=0;l<=c;l++)try{await b(this.browserStorage.setUserData.bind(this.browserStorage),u.SetUserData,this.logger,this.performanceClient)(e,t,r,a),l>0&&(l<=i?this.removeAccessTokenKeys(o.slice(0,l),r,0):(this.removeAccessTokenKeys(o.slice(0,i),r,0),this.removeAccessTokenKeys(o.slice(i,l),r)));break}catch(d){const h=Wn(d);if(h.errorCode===Yr&&l<c){if(!o.length){const g=this.getTokenKeys(0).accessToken,m=this.getTokenKeys().accessToken;o=[...g,...m],i=g.length}if(o.length<=l)throw h;this.removeAccessToken(o[l],r,!1)}else throw h}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const a=this.validateAndParseJson(r);return!a||!Ge.isAccountEntity(a)?null:Qn.toObject(new Ge,a)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const r=this.generateAccountKey(e.getAccountInfo()),a=Date.now().toString();e.lastUpdatedAt=a,await this.setUserData(r,JSON.stringify(e),t,a);const i=this.addAccountKeyToMap(r,t);this.cacheConfig.cacheLocation===pe.LocalStorage&&i&&this.eventHandler.emitEvent(P.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return cr(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const r=this.getAccountKeys();return r.indexOf(e)===-1?(r.push(e),this.setItem(et(),JSON.stringify(r),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const r=this.getAccountKeys(),a=r.indexOf(e);if(a>-1){if(r.splice(a,1),r.length===0){this.removeItem(et());return}else this.setItem(et(),JSON.stringify(r),t);this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const r=this.getActiveAccount(t);(r==null?void 0:r.homeAccountId)===e.homeAccountId&&(r==null?void 0:r.environment)===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(a=>{a.includes(e.homeAccountId)&&a.includes(e.environment)&&this.browserStorage.removeItem(a)}),this.cacheConfig.cacheLocation===pe.LocalStorage&&this.eventHandler.emitEvent(P.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),a=r.idToken.indexOf(e);a>-1&&(this.logger.info("idToken removed from tokenKeys map"),r.idToken.splice(a,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=ut){this.logger.trace("removeAccessTokenKey called");const a=this.getTokenKeys(r);let i=0;if(e.forEach(o=>{const c=a.accessToken.indexOf(o);c>-1&&(a.accessToken.splice(c,1),i++)}),i>0){this.logger.info(`removed ${i} accessToken keys from tokenKeys map`),this.setTokenKeys(a,t,r);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),a=r.refreshToken.indexOf(e);a>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),r.refreshToken.splice(a,1),this.setTokenKeys(r,t))}getTokenKeys(e=ut){return lr(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=ut){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(It(this.clientId,r));return}else this.setItem(It(this.clientId,r),JSON.stringify(e),t)}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const a=this.validateAndParseJson(r);return!a||!ih(a)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),a)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=this.generateCredentialKey(e),a=Date.now().toString();e.lastUpdatedAt=a,await this.setUserData(r,JSON.stringify(e),t,a);const i=this.getTokenKeys();i.idToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(r),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const a=this.validateAndParseJson(r);return!a||!Ha(a)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),a)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=this.generateCredentialKey(e),a=Date.now().toString();e.lastUpdatedAt=a,await this.setUserData(r,JSON.stringify(e),t,a);const i=this.getTokenKeys(),o=i.accessToken.indexOf(r);o!==-1&&i.accessToken.splice(o,1),this.logger.trace(`access token ${o===-1?"added to":"updated in"} map`),i.accessToken.push(r),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const a=this.validateAndParseJson(r);return!a||!Ba(a)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),a)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=this.generateCredentialKey(e),a=Date.now().toString();e.lastUpdatedAt=a,await this.setUserData(r,JSON.stringify(e),t,a);const i=this.getTokenKeys();i.refreshToken.indexOf(r)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(r),this.setTokenKeys(i,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!dh(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const r=lh(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!oh(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t,r){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&hh(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Pr.WRAPPER_SKU,e),this.internalStorage.setItem(Pr.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Pr.WRAPPER_SKU)||w.EMPTY_STRING,t=this.internalStorage.getItem(Pr.WRAPPER_VER)||w.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(Sa.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const a=this.validateAndParseJson(r);return a?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:a.homeAccountId,localAccountId:a.localAccountId,tenantId:a.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const r=this.generateCacheKey(Sa.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const a={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:De().toString()};this.setItem(r,JSON.stringify(a),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(P.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!ch(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t,r){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const i=this.cookieStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}const a=this.temporaryCacheStorage.getItem(r);if(!a){if(this.cacheConfig.cacheLocation===pe.LocalStorage){const i=this.browserStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),a}setTemporaryCache(e,t,r){const a=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(a,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(a,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(ye)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(ye)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(u.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let r=0;t.accessToken.forEach(a=>{const i=this.getAccessTokenCredential(a,e);i!=null&&i.requestedClaimsHash&&a.includes(i.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(a,e),r++)}),r>0&&this.logger.warning(`${r} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return Fe.startsWith(e,ye)?e:`${ye}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===ve.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==J.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${ye}.${ut}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",r].join(Un).toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${ye}.${ts}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(Un).toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(ue.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(ue.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(ue.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(ue.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(ue.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const r=fr(JSON.stringify(e));if(this.setTemporaryCache(ue.REQUEST_PARAMS,r,!0),t){const a=fr(t);this.setTemporaryCache(ue.VERIFIER,a,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(ue.REQUEST_PARAMS,!0);if(!e)throw O(ec);const t=this.getTemporaryCache(ue.VERIFIER,!0);let r,a="";try{r=JSON.parse(Ye(e)),t&&(a=Ye(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),O(tc)}return[r,a]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(ue.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){var r;const t=(r=this.getInteractionInProgress())==null?void 0:r.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${ye}.${ue.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),Tc(window),null}}setInteractionInProgress(e,t=gt.SIGNIN){var a;const r=`${ye}.${ue.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw O(qo);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&((a=this.getInteractionInProgress())==null?void 0:a.clientId)===this.clientId&&this.removeTemporaryItem(r)}async hydrateCache(e,t){var c,l,d;const r=wn((c=e.account)==null?void 0:c.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let a;t.claims&&(a=await this.cryptoImpl.hashString(t.claims));const i=kn((d=e.account)==null?void 0:d.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?Fa(e.expiresOn):0,e.extExpiresOn?Fa(e.extExpiresOn):0,Ye,void 0,e.tokenType,void 0,t.sshKid,t.claims,a),o={idToken:r,accessToken:i};return this.saveCacheRecord(o,e.correlationId)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(a){if(a instanceof Ht&&this.performanceClient&&t)try{const i=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch{}throw a}}}function ci(s,e,t,r){try{switch(e){case pe.LocalStorage:return new vu(s,t,r);case pe.SessionStorage:return new Au;case pe.MemoryStorage:default:break}}catch(a){t.error(a)}return new Nn}const Tu=(s,e,t,r)=>{const a={cacheLocation:pe.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:pe.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new ss(s,a,Vr,e,t,r)};/*! @azure/msal-browser v4.22.1 2025-09-09 */function Iu(s,e,t,r,a){return s.verbose("getAllAccounts called"),t?e.getAllAccounts(a||{},r):[]}function Su(s,e,t,r){const a=t.getAccountInfoFilteredBy(s,r);return a?(e.verbose("getAccount: Account matching provided filter found, returning"),a):(e.verbose("getAccount: No matching account found, returning null"),null)}function Nu(s,e,t,r){if(e.trace("getAccountByUsername called"),!s)return e.warning("getAccountByUsername: No username provided"),null;const a=t.getAccountInfoFilteredBy({username:s},r);return a?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${s}`),a):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function Eu(s,e,t,r){if(e.trace("getAccountByHomeId called"),!s)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const a=t.getAccountInfoFilteredBy({homeAccountId:s},r);return a?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${s}`),a):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function _u(s,e,t,r){if(e.trace("getAccountByLocalId called"),!s)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const a=t.getAccountInfoFilteredBy({localAccountId:s},r);return a?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${s}`),a):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Ru(s,e,t){e.setActiveAccount(s,t)}function Pu(s,e){return s.getActiveAccount(e)}/*! @azure/msal-browser v4.22.1 2025-09-09 */const Ou="msal.broadcast.event";class ju{constructor(e){this.eventCallbacks=new Map,this.logger=e||new dt({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(Ou)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if(typeof window<"u"){const a=r||lu();return this.eventCallbacks.has(a)?(this.logger.error(`Event callback with id: ${a} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(a,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${a}`),a)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,a){var o;const i={eventType:e,interactionType:t||null,payload:r||null,error:a||null,timestamp:Date.now()};switch(e){case P.ACCOUNT_ADDED:case P.ACCOUNT_REMOVED:case P.ACTIVE_ACCOUNT_CHANGED:(o=this.broadcastChannel)==null||o.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],a)=>{(r.length===0||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${a}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){var e;(e=this.broadcastChannel)==null||e.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Rc{constructor(e,t,r,a,i,o,c,l,d){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=o,this.platformAuthProvider=l,this.correlationId=d||Xe(),this.logger=a.clone(je.MSAL_SKU,_t,this.correlationId),this.performanceClient=c}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return W.getAbsoluteUrl(t,ct())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new mr(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const a={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,o=r!=null&&r.length?r==="true":this.config.auth.instanceAware,c=t&&o?this.config.auth.authority.replace(W.getDomainFromUrl(i),t.environment):i,l=Ie.generateAuthority(c,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),d=await b(Ro,u.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,a,this.logger,this.correlationId,this.performanceClient);if(t&&!d.isAlias(t.environment))throw ie(ao);return d}}/*! @azure/msal-browser v4.22.1 2025-09-09 */async function da(s,e,t,r){t.addQueueMeasurement(u.InitializeBaseRequest,s.correlationId);const a=s.authority||e.auth.authority,i=[...s&&s.scopes||[]],o={...s,correlationId:s.correlationId,authority:a,scopes:i};if(!o.authenticationScheme)o.authenticationScheme=J.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(o.authenticationScheme===J.SSH){if(!s.sshJwk)throw ie(fn);if(!s.sshKid)throw ie(ro)}r.verbose(`Authentication Scheme set to "${o.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&s.claims&&!Fe.isEmptyObj(s.claims)&&(o.requestedClaimsHash=await vc(s.claims)),o}async function Mu(s,e,t,r,a){r.addQueueMeasurement(u.InitializeSilentRequest,s.correlationId);const i=await b(da,u.InitializeBaseRequest,a,r,s.correlationId)(s,t,r,a);return{...s,...i,account:e,forceRefresh:s.forceRefresh||!1}}function Pc(s,e){let t;const r=s.httpMethod;if(e===Me.EAR){if(t=r||Tt.POST,t!==Tt.POST)throw ie(io)}else t=r||Tt.GET;if(s.authorizePostBodyParameters&&t!==Tt.POST)throw ie(oo);return t}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Jt extends Rc{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||Xe(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=W.getAbsoluteUrl(e.postLogoutRedirectUri,ct())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=W.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,ct())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=W.getAbsoluteUrl(ct(),ct())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await b(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new Do(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:a,requestExtraQueryParameters:i,account:o}=e;this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetClientConfiguration,this.correlationId);const c=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:a,requestExtraQueryParameters:i,account:o}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:c,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:je.MSAL_SKU,version:_t,cpu:w.EMPTY_STRING,os:w.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),a={interactionType:t},i=Qt.setRequestState(this.browserCrypto,e&&e.state||w.EMPTY_STRING,a),c={...await b(da,u.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:i,nonce:e.nonce||Xe(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l={...c,httpMethod:Pc(c,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return l;const d=e.account||this.browserStorage.getActiveAccount(this.correlationId);return d&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${d.homeAccountId}`,this.correlationId),l.account=d),l}}/*! @azure/msal-browser v4.22.1 2025-09-09 */function Du(s,e){if(!e)return null;try{return Qt.parseRequestState(s,e).libraryState.meta}catch{throw I(Gt)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */function dr(s,e,t){const r=Wr(s);if(!r)throw lo(s)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${s}`),O(Ko)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),O($o));return r}function Uu(s,e,t){if(!s.state)throw O(Qs);const r=Du(e,s.state);if(!r)throw O(zo);if(r.interactionType!==t)throw O(Go)}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Oc{constructor(e,t,r,a,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=a,this.performanceClient=i}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(u.HandleCodeResponse,t.correlationId);let r;try{r=Ih(e,t.state)}catch(a){throw a instanceof Ot&&a.subError===pr?O(pr):a}return b(this.handleCodeResponseFromServer.bind(this),u.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(u.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await b(this.authModule.updateAuthority.bind(this.authModule),u.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return await b(this.authModule.acquireToken.bind(this.authModule),u.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Qe.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Qe.UPN}:null}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const Lu="ContentError",jc="user_switch";/*! @azure/msal-browser v4.22.1 2025-09-09 */const Fu="USER_INTERACTION_REQUIRED",Hu="USER_CANCEL",Bu="NO_NETWORK",$u="DISABLED",Ku="ACCOUNT_UNAVAILABLE",zu="UX_NOT_ALLOWED";/*! @azure/msal-browser v4.22.1 2025-09-09 */const Gu=-2147186943,qu={[jc]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class rt extends ee{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,rt.prototype),this.name="NativeAuthError",this.ext=r}}function Lt(s){if(s.ext&&s.ext.status&&s.ext.status===$u||s.ext&&s.ext.error&&s.ext.error===Gu)return!0;switch(s.errorCode){case Lu:return!0;default:return!1}}function cn(s,e,t){if(t&&t.status)switch(t.status){case Ku:return nn(Oo);case Fu:return new Je(s,e);case Hu:return O(pr);case Bu:return O(sn);case zu:return nn($s)}return new rt(s,qu[s]||e,t)}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Mc extends Jt{async acquireToken(e){this.performanceClient.addQueueMeasurement(u.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Z.acquireTokenSilent_silentFlow),r=await b(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),a=new vh(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const o=(await b(a.acquireCachedToken.bind(a),u.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),o}catch(i){throw i instanceof wr&&i.errorCode===Ys&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t==null?void 0:t.account)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class $r extends Rc{constructor(e,t,r,a,i,o,c,l,d,h,g,m){super(e,t,r,a,i,o,l,d,m),this.apiId=c,this.accountId=h,this.platformAuthProvider=d,this.nativeStorageManager=g,this.silentCacheClient=new Mc(e,this.nativeStorageManager,r,a,i,o,l,d,m);const k=this.platformAuthProvider.getExtensionName();this.skus=mr.makeExtraSkuString({libraryName:je.MSAL_SKU,libraryVersion:_t,extensionName:k,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Ld]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(u.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const r=this.performanceClient.startMeasurement(u.NativeInteractionClientAcquireToken,this.correlationId),a=De(),i=this.initializeServerTelemetryManager(this.apiId);try{const o=await this.initializeNativeRequest(e);try{const l=await this.acquireTokensFromCache(this.accountId,o);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),l}catch(l){if(t===Ne.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),r.end({success:!1,brokerErrorCode:"cache_request_failed"}),l;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const c=await this.platformAuthProvider.sendMessage(o);return await this.handleNativeResponse(c,o,a).then(l=>(r.end({success:!0,isNativeBroker:!0,requestId:l.requestId}),i.clearNativeBrokerErrorCode(),l)).catch(l=>{throw r.end({success:!1,errorCode:l.errorCode,subErrorCode:l.subError}),l})}catch(o){throw o instanceof rt&&i.setNativeBrokerErrorCode(o.errorCode),r.end({success:!1}),o}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:me.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),I(qn);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!r)throw I(qn);try{const a=this.createSilentCacheRequest(t,r),i=await this.silentCacheClient.acquireToken(a),o={...r,idTokenClaims:i==null?void 0:i.idTokenClaims,idToken:i==null?void 0:i.idToken};return{...i,account:o}}catch(a){throw a}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const a=await this.initializeNativeRequest(r);try{await this.platformAuthProvider.sendMessage(a)}catch(c){if(c instanceof rt&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(c.errorCode),Lt(c)))throw c}this.browserStorage.setTemporaryCache(ue.NATIVE_REQUEST,JSON.stringify(a),!0);const i={apiId:Z.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(o,i)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:a,...i}=r;a&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(ue.NATIVE_REQUEST));const o=De();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const c=await this.platformAuthProvider.sendMessage(i),l=await this.handleNativeResponse(c,i,o);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),l}catch(c){throw c}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var h,g;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const a=Wt(e.id_token,Ye),i=this.createHomeAccountIdentifier(e,a),o=(h=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId))==null?void 0:h.homeAccountId;if((g=t.extraParameters)!=null&&g.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(i!==o&&e.account.id!==t.accountId)throw cn(jc);const c=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=Ks(this.browserStorage,c,i,Ye,this.correlationId,a,e.client_info,void 0,a.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const d=await this.generateAuthenticationResult(e,t,a,l,c.canonicalAuthority,r);return await this.cacheAccount(l,this.correlationId),await this.cacheNativeTokens(e,t,i,a,e.access_token,d.tenantId,r),d}createHomeAccountIdentifier(e,t){return Ge.generateHomeAccountId(e.client_info||w.EMPTY_STRING,Ve.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?me.fromString(t):me.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===J.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new qt(this.browserCrypto),a={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw I(ys);return r.signPopToken(e.access_token,t.keyId,a)}else return e.access_token}async generateAuthenticationResult(e,t,r,a,i,o){const c=this.addTelemetryFromNativeResponse(e.properties.MATS),l=this.generateScopes(t.scope,e.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||w.EMPTY_STRING,g=d.TenantId||r.tid||w.EMPTY_STRING,m=Is(a.getAccountInfo(),void 0,r,e.id_token);m.nativeAccountId!==e.account.id&&(m.nativeAccountId=e.account.id);const k=await this.generatePopAccessToken(e,t),S=t.tokenType===J.POP?J.POP:J.BEARER;return{authority:i,uniqueId:h,tenantId:g,scopes:l.asArray(),account:m,idToken:e.id_token,idTokenClaims:r,accessToken:k,fromCache:c?this.isResponseFromCache(c):!1,expiresOn:$t(o+e.expires_in),tokenType:S,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e.getAccountInfo(),t)}cacheNativeTokens(e,t,r,a,i,o,c){const l=wn(r,t.authority,e.id_token||"",t.clientId,a.tid||""),d=t.tokenType===J.POP?w.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=c+d,g=this.generateScopes(e.scope,t.scope),m=kn(r,t.authority,i,t.clientId,a.tid||o,g.printScopes(),h,0,Ye,void 0,t.tokenType,void 0,t.keyId),k={idToken:l,accessToken:m};return this.nativeStorageManager.saveCacheRecord(k,this.correlationId,t.storeInCache)}getExpiresInValue(e,t){return e===J.POP?w.SHR_NONCE_VALIDITY:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:r,...a}=e,i=new me(r||[]);i.appendScopes(Vt);const o={...a,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(o.signPopToken&&e.popKid)throw O(gc);if(this.handleExtraBrokerParams(o),o.extraParameters=o.extraParameters||{},o.extraParameters.telemetry=Ke.MATS_TELEMETRY,e.authenticationScheme===J.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},l=new qt(this.browserCrypto);let d;if(o.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:o.keyId})),o.signPopToken=!1;else{const h=await b(l.generateCnf.bind(l),u.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(c,this.logger);d=h.reqCnfString,o.keyId=h.kid,o.signPopToken=!0}o.reqCnf=d}return this.addRequestSKUs(o),o}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new W(t);return r.validateAsUri(),r}getPrompt(e){switch(this.apiId){case Z.ssoSilent:case Z.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Re.NONE}if(!e){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e){case Re.NONE:case Re.CONSENT:case Re.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),O(hc)}}handleExtraBrokerParams(e){var i;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(Xr)&&e.extraParameters.hasOwnProperty(Zr)&&e.extraParameters.hasOwnProperty(Nt);if(!e.embeddedClientId&&!t)return;let r="";const a=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Zr],r=e.extraParameters[Nt]),e.extraParameters={child_client_id:r,child_redirect_uri:a},(i=this.performanceClient)==null||i.addFields({embeddedClientId:r,embeddedRedirectUri:a},this.correlationId)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */async function ha(s,e,t,r,a){const i=Th({...s.auth,authority:e},t,r,a);if(Ms(i,{sku:je.MSAL_SKU,version:_t,os:"",cpu:""}),s.auth.protocolMode!==Me.OIDC&&Ds(i,s.telemetry.application),t.platformBroker&&($d(i),a.addFields({isPlatformAuthorizeRequest:!0},t.correlationId),t.authenticationScheme===J.POP)){const o=new ht(r,a),c=new qt(o);let l;t.popKid?l=o.encodeKid(t.popKid):l=(await b(c.generateCnf.bind(c),u.PopTokenGenerateCnf,r,a,t.correlationId)(t,r)).reqCnfString,Ls(i,l)}return yn(i,t.correlationId,a),i}async function ua(s,e,t,r,a){if(!t.codeChallenge)throw ie(Cs);const i=await b(ha,u.GetStandardParams,r,a,t.correlationId)(s,e,t,r,a);return Es(i,ds.CODE),wo(i,t.codeChallenge,w.S256_CODE_CHALLENGE_METHOD),xt(i,t.extraQueryParameters||{}),zs(e,i,s.auth.encodeExtraQueryParams,t.extraQueryParameters)}async function ga(s,e,t,r,a,i){if(!r.earJwk)throw O(Ws);const o=await ha(e,t,r,a,i);Es(o,ds.IDTOKEN_TOKEN_REFRESHTOKEN),Zd(o,r.earJwk);const c=new Map;xt(c,r.extraQueryParameters||{});const l=zs(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return Dc(s,l,o)}async function ma(s,e,t,r,a,i){const o=await ha(e,t,r,a,i);Es(o,ds.CODE),wo(o,r.codeChallenge,r.codeChallengeMethod||w.S256_CODE_CHALLENGE_METHOD),eh(o,r.authorizePostBodyParameters||{});const c=new Map;xt(c,r.extraQueryParameters||{});const l=zs(t,c,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return Dc(s,l,o)}function Dc(s,e,t){const r=s.createElement("form");return r.method="post",r.action=e,t.forEach((a,i)=>{const o=s.createElement("input");o.hidden=!0,o.name=i,o.value=a,r.appendChild(o)}),s.body.appendChild(r),r}async function Uc(s,e,t,r,a,i,o,c,l,d){if(c.verbose("Account id found, calling WAM for token"),!d)throw O(Xs);const h=new ht(c,l),g=new $r(r,a,h,c,o,r.system.navigationClient,t,l,d,e,i,s.correlationId),{userRequestState:m}=Qt.parseRequestState(h,s.state);return b(g.acquireToken.bind(g),u.NativeInteractionClientAcquireToken,c,l,s.correlationId)({...s,state:m,prompt:void 0})}async function ln(s,e,t,r,a,i,o,c,l,d,h,g){if(tt.removeThrottle(o,a.auth.clientId,s),e.accountId)return b(Uc,u.HandleResponsePlatformBroker,d,h,s.correlationId)(s,e.accountId,r,a,o,c,l,d,h,g);const m={...s,code:e.code||"",codeVerifier:t},k=new Oc(i,o,m,d,h);return await b(k.handleCodeResponse.bind(k),u.HandleCodeResponse,d,h,s.correlationId)(e,s)}async function pa(s,e,t,r,a,i,o,c,l,d,h){if(tt.removeThrottle(i,r.auth.clientId,s),Uo(e,s.state),!e.ear_jwe)throw O(Bo);if(!s.earJwk)throw O(Ws);const g=JSON.parse(await b(eu,u.DecryptEarResponse,l,d,s.correlationId)(s.earJwk,e.ear_jwe));if(g.accountId)return b(Uc,u.HandleResponsePlatformBroker,l,d,s.correlationId)(s,g.accountId,t,r,i,o,c,l,d,h);const m=new Et(r.auth.clientId,i,new ht(l,d),l,null,null,d);m.validateTokenResponse(g);const k={code:"",state:s.state,nonce:s.nonce,client_info:g.client_info,cloud_graph_host_name:g.cloud_graph_host_name,cloud_instance_host_name:g.cloud_instance_host_name,cloud_instance_name:g.cloud_instance_name,msgraph_host:g.msgraph_host};return await b(m.handleServerTokenResponse.bind(m),u.HandleServerTokenResponse,l,d,s.correlationId)(g,a,De(),s,k,void 0,void 0,void 0,void 0)}/*! @azure/msal-browser v4.22.1 2025-09-09 */const Vu=32;async function En(s,e,t){s.addQueueMeasurement(u.GeneratePkceCodes,t);const r=He(Wu,u.GenerateCodeVerifier,e,s,t)(s,e,t),a=await b(Qu,u.GenerateCodeChallengeFromVerifier,e,s,t)(r,s,e,t);return{verifier:r,challenge:a}}function Wu(s,e,t){try{const r=new Uint8Array(Vu);return He(Qh,u.GetRandomValues,e,s,t)(r),wt(r)}catch{throw O(Vs)}}async function Qu(s,e,t,r){e.addQueueMeasurement(u.GenerateCodeChallengeFromVerifier,r);try{const a=await b(wc,u.Sha256Digest,t,e,r)(s,e,r);return wt(new Uint8Array(a))}catch{throw O(Vs)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class dn{constructor(e,t,r,a){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=a,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(u.NativeMessageHandlerHandshake),this.platformAuthType=Ke.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:tr.GetToken,request:e},r={channel:Ke.CHANNEL_ID,extensionId:this.extensionId,responseId:Xe(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(r)}`),this.messageChannel.port1.postMessage(r);const a=await new Promise((o,c)=>{this.resolvers.set(r.responseId,{resolve:o,reject:c})});return this.validatePlatformBrokerResponse(a)}static async createProvider(e,t,r){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const a=new dn(e,t,r,Ke.PREFERRED_EXTENSION_ID);return await a.sendHandshakeRequest(),a}catch{const i=new dn(e,t,r);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Ke.CHANNEL_ID,extensionId:this.extensionId,responseId:Xe(),body:{method:tr.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(O(lc)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Ke.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===tr.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(O(dc))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),a=this.handshakeResolvers.get(t.responseId);try{const i=t.body.method;if(i===tr.Response){if(!r)return;const o=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(o)}`),o.status!=="Success")r.reject(cn(o.code,o.description,o.ext));else if(o.result)o.result.code&&o.result.description?r.reject(cn(o.result.code,o.result.description,o.result.ext)):r.resolve(o.result);else throw Kn(qr,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===tr.HandshakeResponse){if(!a){this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),a.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(i):a&&a.reject(i)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Kn(qr,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){var e;return this.getExtensionId()===Ke.PREFERRED_EXTENSION_ID?"chrome":(e=this.getExtensionId())!=null&&e.length?"unknown":void 0}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class fa{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=Ke.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,r){var a;if(e.trace("PlatformAuthDOMHandler: createProvider called"),(a=window.navigator)!=null&&a.platformAuthentication){const i=await window.navigator.platformAuthentication.getSupportedContracts(Ke.MICROSOFT_ENTRA_BROKERID);if(i!=null&&i.includes(Ke.PLATFORM_DOM_APIS))return e.trace("Platform auth api available in DOM"),new fa(e,t,r)}}getExtensionId(){return Ke.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return Ke.DOM_API_NAME}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r)}catch(t){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),t}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:r,authority:a,scope:i,redirectUri:o,correlationId:c,state:l,storeInCache:d,embeddedClientId:h,extraParameters:g,...m}=e,k=this.getDOMExtraParams(m);return{accountId:t,brokerId:this.getExtensionId(),authority:a,clientId:r,correlationId:c||this.correlationId,extraParameters:{...g,...k},isSecurityTokenService:!1,redirectUri:o,scope:i,state:l,storeInCache:d,embeddedClientId:h}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(t.isSuccess===!1&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),cn(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw Kn(qr,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((a,[i,o])=>(a[i]=String(o),a),{})}}}/*! @azure/msal-browser v4.22.1 2025-09-09 */async function Yu(s,e,t,r){s.trace("getPlatformAuthProvider called",t);const a=Ju();s.trace("Has client allowed platform auth via DOM API: "+a);let i;try{a&&(i=await fa.createProvider(s,e,t)),i||(s.trace("Platform auth via DOM API not available, checking for extension"),i=await dn.createProvider(s,r||Ec,e))}catch(o){s.trace("Platform auth not available",o)}return i}function Ju(){let s;try{return s=window[pe.SessionStorage],(s==null?void 0:s.getItem(yu))==="true"}catch{return!1}}function yr(s,e,t,r){if(e.trace("isPlatformAuthAllowed called"),!s.system.allowPlatformBroker)return e.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!t)return e.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(r)switch(r){case J.BEARER:case J.POP:return e.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return e.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}/*! @azure/msal-browser v4.22.1 2025-09-09 */class Xu extends Jt{constructor(e,t,r,a,i,o,c,l,d,h){super(e,t,r,a,i,o,c,d,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l,this.eventHandler=i}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||Vt,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t);{const i={...e,httpMethod:Pc(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(i,r,t)}}catch(a){return Promise.reject(a)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},a=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,a,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,a,i))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("acquireTokenPopupAsync called");const a=await b(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,D.Popup);t.popup&&Nc(a.authority);const i=yr(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return a.platformBroker=i,this.config.auth.protocolMode===Me.EAR?this.executeEarFlow(a,t):this.executeCodeFlow(a,t,r)}async executeCodeFlow(e,t,r){var l;const a=e.correlationId,i=this.initializeServerTelemetryManager(Z.acquireTokenPopup),o=r||await b(En,u.GeneratePkceCodes,this.logger,this.performanceClient,a)(this.performanceClient,this.logger,a),c={...e,codeChallenge:o.challenge};try{const d=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,a)({serverTelemetryManager:i,requestAuthority:c.authority,requestAzureCloudOptions:c.azureCloudOptions,requestExtraQueryParameters:c.extraQueryParameters,account:c.account});if(c.httpMethod===Tt.POST)return await this.executeCodeFlowWithPost(c,t,d,o.verifier);{const h=await b(ua,u.GetAuthCodeUrl,this.logger,this.performanceClient,a)(this.config,d.authority,c,this.logger,this.performanceClient),g=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(P.POPUP_OPENED,D.Popup,{popupWindow:g},null);const m=await this.monitorPopupForHash(g,t.popupWindowParent),k=He(dr,u.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(m,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await b(ln,u.HandleResponseCode,this.logger,this.performanceClient,a)(e,k,o.verifier,Z.acquireTokenPopup,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(d){throw(l=t.popup)==null||l.close(),d instanceof ee&&(d.setCorrelationId(this.correlationId),i.cacheFailedRequest(d)),d}}async executeEarFlow(e,t){const r=e.correlationId,a=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=await b(na,u.GenerateEarKey,this.logger,this.performanceClient,r)(),o={...e,earJwk:i},c=t.popup||this.openPopup("about:blank",t);(await ga(c.document,this.config,a,o,this.logger,this.performanceClient)).submit();const d=await b(this.monitorPopupForHash.bind(this),u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(c,t.popupWindowParent),h=He(dr,u.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return b(pa,u.HandleResponseEar,this.logger,this.performanceClient,r)(o,h,Z.acquireTokenPopup,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,a){const i=e.correlationId,o=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,i)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),c=t.popup||this.openPopup("about:blank",t);(await ma(c.document,this.config,o,e,this.logger,this.performanceClient)).submit();const d=await b(this.monitorPopupForHash.bind(this),u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,i)(c,t.popupWindowParent),h=He(dr,u.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.serverResponseType,this.logger);return b(ln,u.HandleResponseCode,this.logger,this.performanceClient,i)(e,h,a,Z.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,a){var o,c,l;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(P.LOGOUT_START,D.Popup,e);const i=this.initializeServerTelemetryManager(Z.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const d=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{d.authority.endSessionEndpoint}catch{if((o=e.account)!=null&&o.homeAccountId&&e.postLogoutRedirectUri&&d.authority.protocolMode===Me.OIDC){if(this.eventHandler.emitEvent(P.LOGOUT_SUCCESS,D.Popup,e),a){const m={apiId:Z.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},k=W.getAbsoluteUrl(a,ct());await this.navigationClient.navigateInternal(k,m)}(c=t.popup)==null||c.close();return}}const h=d.getLogoutUri(e);this.eventHandler.emitEvent(P.LOGOUT_SUCCESS,D.Popup,e);const g=this.openPopup(h,t);if(this.eventHandler.emitEvent(P.POPUP_OPENED,D.Popup,{popupWindow:g},null),await this.monitorPopupForHash(g,t.popupWindowParent).catch(()=>{}),a){const m={apiId:Z.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},k=W.getAbsoluteUrl(a,ct());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${k}`),await this.navigationClient.navigateInternal(k,m)}else this.logger.verbose("No main window navigation requested")}catch(d){throw(l=t.popup)==null||l.close(),d instanceof ee&&(d.setCorrelationId(this.correlationId),i.cacheFailedRequest(d)),this.eventHandler.emitEvent(P.LOGOUT_FAILURE,D.Popup,null,d),this.eventHandler.emitEvent(P.LOGOUT_END,D.Popup),d}this.eventHandler.emitEvent(P.LOGOUT_END,D.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),O(Tn)}monitorPopupForHash(e,t){return new Promise((r,a)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),a(O(pr));return}let o="";try{o=e.location.href}catch{}if(!o||o==="about:blank")return;clearInterval(i);let c="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===pn.QUERY?c=e.location.search:c=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(c)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw O(Wo);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),O(Vo)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:a}){var k,S,T,N;const i=a.screenLeft?a.screenLeft:a.screenX,o=a.screenTop?a.screenTop:a.screenY,c=a.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=a.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let d=(k=r.popupSize)==null?void 0:k.width,h=(S=r.popupSize)==null?void 0:S.height,g=(T=r.popupPosition)==null?void 0:T.top,m=(N=r.popupPosition)==null?void 0:N.left;return(!d||d<0||d>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),d=je.POPUP_WIDTH),(!h||h<0||h>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=je.POPUP_HEIGHT),(!g||g<0||g>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),g=Math.max(0,l/2-je.POPUP_HEIGHT/2+o)),(!m||m<0||m>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),m=Math.max(0,c/2-je.POPUP_WIDTH/2+i)),a.open(e,t,`width=${d}, height=${h}, top=${g}, left=${m}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${je.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${je.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.22.1 2025-09-09 */function Zu(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const s=window.performance.getEntriesByType("navigation"),e=s.length?s[0]:void 0;return e==null?void 0:e.type}class eg extends Jt{constructor(e,t,r,a,i,o,c,l,d,h){super(e,t,r,a,i,o,c,d,h),this.nativeStorage=l}async acquireToken(e){const t=await b(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,D.Redirect);t.platformBroker=yr(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const r=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(P.RESTORE_FROM_BFCACHE,D.Redirect))},a=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${a}`),this.browserStorage.setTemporaryCache(ue.ORIGIN_URI,a,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===Me.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t,e.onRedirectNavigate)}catch(i){throw i instanceof ee&&i.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),i}}async executeCodeFlow(e,t){const r=e.correlationId,a=this.initializeServerTelemetryManager(Z.acquireTokenRedirect),i=await b(En,u.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),o={...e,codeChallenge:i.challenge};this.browserStorage.cacheAuthorizeRequest(o,i.verifier);try{if(o.httpMethod===Tt.POST)return await this.executeCodeFlowWithPost(o);{const c=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:a,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),l=await b(ua,u.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,c.authority,o,this.logger,this.performanceClient);return await this.initiateAuthRequest(l,t)}}catch(c){throw c instanceof ee&&(c.setCorrelationId(this.correlationId),a.cacheFailedRequest(c)),c}}async executeEarFlow(e){const t=e.correlationId,r=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),a=await b(na,u.GenerateEarKey,this.logger,this.performanceClient,t)(),i={...e,earJwk:a};return this.browserStorage.cacheAuthorizeRequest(i),(await ga(document,this.config,r,i,this.logger,this.performanceClient)).submit(),new Promise((c,l)=>{setTimeout(()=>{l(O(an,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await ma(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((i,o)=>{setTimeout(()=>{o(O(an,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,r,a){const i=this.initializeServerTelemetryManager(Z.handleRedirectPromise);try{const[o,c]=this.getRedirectResponse(e||"");if(!o)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),Zu()!=="back_forward"?a.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const l=this.browserStorage.getTemporaryCache(ue.ORIGIN_URI,!0)||w.EMPTY_STRING,d=Oa(l),h=Oa(window.location.href);if(d===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),l.indexOf("#")>-1&&nu(l),await this.handleResponse(o,t,r,i);if(this.config.auth.navigateToLoginRequestUrl){if(!ia()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(ue.URL_HASH,c,!0);const g={apiId:Z.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let m=!0;if(!l||l==="null"){const k=au();this.browserStorage.setTemporaryCache(ue.ORIGIN_URI,k,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),m=await this.navigationClient.navigateInternal(k,g)}else this.logger.verbose(`Navigating to loginRequestUrl: ${l}`),m=await this.navigationClient.navigateInternal(l,g);if(!m)return await this.handleResponse(o,t,r,i)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(o,t,r,i);return null}catch(o){throw o instanceof ee&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),o}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===pn.QUERY?t=window.location.search:t=window.location.hash);let r=Wr(t);if(r){try{Uu(r,this.browserCrypto,D.Redirect)}catch(i){return i instanceof ee&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return Tc(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const a=this.browserStorage.getTemporaryCache(ue.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(ue.URL_HASH)),a&&(r=Wr(a),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,a]):[null,""]}async handleResponse(e,t,r,a){if(!e.state)throw O(Qs);if(e.ear_jwe){const c=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return b(pa,u.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,Z.acquireTokenRedirect,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const o=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:a,requestAuthority:t.authority});return b(ln,u.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,Z.acquireTokenRedirect,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:Z.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=t||this.config.auth.onRedirectNavigate;if(typeof a=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),a(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await this.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await this.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),O(Tn)}async logout(e){var a;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(Z.logout);try{this.eventHandler.emitEvent(P.LOGOUT_START,D.Redirect,e),await this.clearCacheOnLogout(this.correlationId,t.account);const i={apiId:Z.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===Me.OIDC)try{o.authority.endSessionEndpoint}catch{if((a=t.account)!=null&&a.homeAccountId){this.eventHandler.emitEvent(P.LOGOUT_SUCCESS,D.Redirect,t);return}}const c=o.getLogoutUri(t);if(this.eventHandler.emitEvent(P.LOGOUT_SUCCESS,D.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(c)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,gt.SIGNOUT),await this.navigationClient.navigateExternal(c,i);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,gt.SIGNOUT),await this.navigationClient.navigateExternal(c,i);return}}catch(i){throw i instanceof ee&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),this.eventHandler.emitEvent(P.LOGOUT_FAILURE,D.Redirect,null,i),this.eventHandler.emitEvent(P.LOGOUT_END,D.Redirect),i}this.eventHandler.emitEvent(P.LOGOUT_END,D.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return W.getAbsoluteUrl(t,ct())}}/*! @azure/msal-browser v4.22.1 2025-09-09 */async function tg(s,e,t,r,a){if(e.addQueueMeasurement(u.SilentHandlerInitiateAuthRequest,r),!s)throw t.info("Navigate url is empty"),O(Tn);return a?b(sg,u.SilentHandlerLoadFrame,t,e,r)(s,a,e,r):He(ag,u.SilentHandlerLoadFrameSync,t,e,r)(s)}async function rg(s,e,t,r,a){const i=_n();if(!i.contentDocument)throw"No document associated with iframe!";return(await ma(i.contentDocument,s,e,t,r,a)).submit(),i}async function ng(s,e,t,r,a){const i=_n();if(!i.contentDocument)throw"No document associated with iframe!";return(await ga(i.contentDocument,s,e,t,r,a)).submit(),i}async function li(s,e,t,r,a,i,o){return r.addQueueMeasurement(u.SilentHandlerMonitorIframeForHash,i),new Promise((c,l)=>{e<es&&a.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${es}ms). This may result in timeouts.`);const d=window.setTimeout(()=>{window.clearInterval(h),l(O(Qo))},e),h=window.setInterval(()=>{let g="";const m=s.contentWindow;try{g=m?m.location.href:""}catch{}if(!g||g==="about:blank")return;let k="";m&&(o===pn.QUERY?k=m.location.search:k=m.location.hash),window.clearTimeout(d),window.clearInterval(h),c(k)},t)}).finally(()=>{He(ig,u.RemoveHiddenIframe,a,r,i)(s)})}function sg(s,e,t,r){return t.addQueueMeasurement(u.SilentHandlerLoadFrame,r),new Promise((a,i)=>{const o=_n();window.setTimeout(()=>{if(!o){i("Unable to load iframe");return}o.src=s,a(o)},e)})}function ag(s){const e=_n();return e.src=s,e}function _n(){const s=document.createElement("iframe");return s.className="msalSilentIframe",s.style.visibility="hidden",s.style.position="absolute",s.style.width=s.style.height="0",s.style.border="0",s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(s),s}function ig(s){document.body===s.parentNode&&document.body.removeChild(s)}/*! @azure/msal-browser v4.22.1 2025-09-09 */class og extends Jt{constructor(e,t,r,a,i,o,c,l,d,h,g){super(e,t,r,a,i,o,l,h,g),this.apiId=c,this.nativeStorage=d}async acquireToken(e){this.performanceClient.addQueueMeasurement(u.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Re.NONE&&t.prompt!==Re.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Re.NONE}`),t.prompt=Re.NONE):t.prompt=Re.NONE;const r=await b(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,D.Silent);return r.platformBroker=yr(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),Nc(r.authority),this.config.auth.protocolMode===Me.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const r=this.initializeServerTelemetryManager(this.apiId);try{return t=await b(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await b(this.silentTokenHelper.bind(this),u.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(a){if(a instanceof ee&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),!t||!(a instanceof ee)||a.errorCode!==je.INVALID_GRANT_ERROR)throw a;return this.performanceClient.addFields({retryError:a.errorCode},this.correlationId),await b(this.silentTokenHelper.bind(this),u.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,r=await b(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),a=await b(na,u.GenerateEarKey,this.logger,this.performanceClient,t)(),i={...e,earJwk:a},o=await b(ng,u.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,i,this.logger,this.performanceClient),c=this.config.auth.OIDCOptions.serverResponseType,l=await b(li,u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(o,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,c),d=He(dr,u.DeserializeResponse,this.logger,this.performanceClient,t)(l,c,this.logger);return b(pa,u.HandleResponseEar,this.logger,this.performanceClient,t)(i,d,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(O(In))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(u.SilentIframeClientTokenHelper,r);const a=await b(En,u.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i={...t,codeChallenge:a.challenge};let o;if(t.httpMethod===Tt.POST)o=await b(rg,u.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(this.config,e.authority,i,this.logger,this.performanceClient);else{const h=await b(ua,u.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,i,this.logger,this.performanceClient);o=await b(tg,u.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(h,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait)}const c=this.config.auth.OIDCOptions.serverResponseType,l=await b(li,u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(o,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),d=He(dr,u.DeserializeResponse,this.logger,this.performanceClient,r)(l,c,this.logger);return b(ln,u.HandleResponseCode,this.logger,this.performanceClient,r)(t,d,a.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class cg extends Jt{async acquireToken(e){this.performanceClient.addQueueMeasurement(u.SilentRefreshClientAcquireToken,e.correlationId);const t=await b(da,u.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const a=this.initializeServerTelemetryManager(Z.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient({serverTelemetryManager:a,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return b(i.acquireTokenByRefreshToken.bind(i),u.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(o=>{throw o.setCorrelationId(this.correlationId),a.cacheFailedRequest(o),o})}logout(){return Promise.reject(O(In))}async createRefreshTokenClient(e){const t=await b(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Ch(t,this.performanceClient)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class lg{constructor(e,t,r,a){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=a}async loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw O(Sn);const a=e.correlationId||Xe(),i=t.id_token?Wt(t.id_token,Ye):void 0,o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new Ie(Ie.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,o,this.logger,e.correlationId||Xe()):void 0,l=await this.loadAccount(e,r.clientInfo||t.client_info||"",a,i,c),d=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,a),h=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,r,a),g=await this.loadRefreshToken(t,l.homeAccountId,l.environment,a);return this.generateAuthenticationResult(e,{account:l,idToken:d,accessToken:h,refreshToken:g},i,c)}async loadAccount(e,t,r,a,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const d=Ge.createFromAccountInfo(e.account);return await this.storage.setAccount(d,r),d}else if(!i||!t&&!a)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),O(sc);const o=Ge.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,a),c=a==null?void 0:a.tid,l=Ks(this.storage,i,o,Ye,r,a,t,i.hostnameAndPort,c,void 0,void 0,this.logger);return await this.storage.setAccount(l,r),l}async loadIdToken(e,t,r,a,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const o=wn(t,r,e.id_token,this.config.auth.clientId,a);return await this.storage.setIdTokenCredential(o,i),o}async loadAccessToken(e,t,r,a,i,o,c){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?me.fromString(t.scope):new me(e.scopes),d=o.expiresOn||t.expires_in+De(),h=o.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+De(),g=kn(r,a,t.access_token,this.config.auth.clientId,i,l.printScopes(),d,h,Ye);return await this.storage.setAccessTokenCredential(g,c),g}async loadRefreshToken(e,t,r,a){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=Eo(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,a),i}generateAuthenticationResult(e,t,r,a){var h,g,m;let i="",o=[],c=null,l;t!=null&&t.accessToken&&(i=t.accessToken.secret,o=me.fromString(t.accessToken.target).asArray(),c=$t(t.accessToken.expiresOn),l=$t(t.accessToken.extendedExpiresOn));const d=t.account;return{authority:a?a.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:o,account:d.getAccountInfo(),idToken:((h=t.idToken)==null?void 0:h.secret)||"",idTokenClaims:r||{},accessToken:i,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((g=t.refreshToken)==null?void 0:g.familyId)||"",tokenType:((m=t==null?void 0:t.accessToken)==null?void 0:m.tokenType)||"",state:e.state||"",cloudGraphHostName:d.cloudGraphHostName||"",msGraphHost:d.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class dg extends Do{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.22.1 2025-09-09 */class hg extends Jt{constructor(e,t,r,a,i,o,c,l,d,h){super(e,t,r,a,i,o,l,d,h),this.apiId=c}async acquireToken(e){if(!e.code)throw O(ac);const t=await b(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,D.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const a={...t,code:e.code},i=await b(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),o=new dg(i);this.logger.verbose("Auth code client created");const c=new Oc(o,this.browserStorage,a,this.logger,this.performanceClient);return await b(c.handleCodeResponseFromServer.bind(c),u.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(a){throw a instanceof ee&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),a}}logout(){return Promise.reject(O(In))}}/*! @azure/msal-browser v4.22.1 2025-09-09 */function ug(s,e,t){var o;const r=((o=window.msal)==null?void 0:o.clientIds)||[],a=r.length,i=r.filter(c=>c===s).length;i>1&&t.warning("There is already an instance of MSAL.js in the window with the same client id."),e.add({msalInstanceCount:a,sameClientIdInstanceCount:i})}/*! @azure/msal-browser v4.22.1 2025-09-09 */function Ze(s){const e=s==null?void 0:s.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function jr(s,e){try{oa(s)}catch(t){throw e.end({success:!1},t),t}}class Rn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new ht(this.logger,this.performanceClient):Vr,this.eventHandler=new ju(this.logger),this.browserStorage=this.isBrowserEnvironment?new ss(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,gh(this.config.auth)):Tu(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:pe.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:pe.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new ss(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new lg(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new Rn(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(P.INITIALIZE_END);return}const r=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),a=this.config.system.allowPlatformBroker,i=this.performanceClient.startMeasurement(u.InitializeClientApplication,r);if(this.eventHandler.emitEvent(P.INITIALIZE_START),!t)try{this.logMultipleInstances(i)}catch{}if(await b(this.browserStorage.initialize.bind(this.browserStorage),u.InitializeCache,this.logger,this.performanceClient,r)(r),a)try{this.platformAuthProvider=await Yu(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(o){this.logger.verbose(o)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),He(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),u.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(r)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(P.INITIALIZE_END),i.end({allowPlatformBroker:a,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Sc(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){var l;if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(((l=this.browserStorage.getInteractionInProgress())==null?void 0:l.type)===gt.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),a=this.browserStorage.getCachedNativeRequest(),i=a&&this.platformAuthProvider&&!e;let o;this.eventHandler.emitEvent(P.HANDLE_REDIRECT_START,D.Redirect);let c;try{if(i&&this.platformAuthProvider){o=this.performanceClient.startMeasurement(u.AcquireTokenRedirect,(a==null?void 0:a.correlationId)||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),o.add({isPlatformBrokerRequest:!0});const d=new $r(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Z.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,a.accountId,this.nativeInternalStorage,a.correlationId);c=b(d.handleRedirectPromise.bind(d),u.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(this.performanceClient,o.event.correlationId)}else{const[d,h]=this.browserStorage.getCachedRequest(),g=d.correlationId;o=this.performanceClient.startMeasurement(u.AcquireTokenRedirect,g),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const m=this.createRedirectClient(g);c=b(m.handleRedirectPromise.bind(m),u.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(e,d,h,o)}}catch(d){throw this.browserStorage.resetRequestCache(),d}return c.then(d=>(d?(this.browserStorage.resetRequestCache(),r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(P.LOGIN_SUCCESS,D.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_SUCCESS,D.Redirect,d),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),o.end({success:!0,accountType:Ze(d.account)})):o.event.errorCode?o.end({success:!1}):o.discard(),this.eventHandler.emitEvent(P.HANDLE_REDIRECT_END,D.Redirect),d)).catch(d=>{this.browserStorage.resetRequestCache();const h=d;throw r.length>0?this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_FAILURE,D.Redirect,null,h):this.eventHandler.emitEvent(P.LOGIN_FAILURE,D.Redirect,null,h),this.eventHandler.emitEvent(P.HANDLE_REDIRECT_END,D.Redirect),o.end({success:!1},h),d})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(u.AcquireTokenPreRedirect,t);r.add({accountType:Ze(e.account),scenarioId:e.scenarioId});const a=e.onRedirectNavigate;if(a)e.onRedirectNavigate=o=>{const c=typeof a=="function"?a(o):void 0;return r.add({navigateCallbackResult:c!==!1}),r.event=r.end({success:!0})||r.event,c};else{const o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=c=>{const l=typeof o=="function"?o(c):void 0;return r.add({navigateCallbackResult:l!==!1}),r.event=r.end({success:!0})||r.event,l}}const i=this.getAllAccounts().length>0;try{Za(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,gt.SIGNIN),i?this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_START,D.Redirect,e):this.eventHandler.emitEvent(P.LOGIN_START,D.Redirect,e);let o;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?o=new $r(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Z.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(l=>{if(r.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof rt&&Lt(l))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof Je)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw l}):o=this.createRedirectClient(t).acquireToken(e),await o}catch(o){throw this.browserStorage.resetRequestCache(),r.event.status===2?this.performanceClient.startMeasurement(u.AcquireTokenRedirect,t).end({success:!1},o):r.end({success:!1},o),i?this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_FAILURE,D.Redirect,null,o):this.eventHandler.emitEvent(P.LOGIN_FAILURE,D.Redirect,null,o),o}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:Ze(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),jr(this.initialized,r),this.browserStorage.setInteractionInProgress(!0,gt.SIGNIN)}catch(c){return Promise.reject(c)}const a=this.getAllAccounts();a.length>0?this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_START,D.Popup,e):this.eventHandler.emitEvent(P.LOGIN_START,D.Popup,e);let i;const o=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?(r.add({isPlatformBrokerRequest:!0}),i=this.acquireTokenNative({...e,correlationId:t},Z.acquireTokenPopup).then(c=>(r.end({success:!0,accountType:Ze(c.account)}),c)).catch(c=>{if(r.add({brokerErrorName:c.name,brokerErrorCode:c.errorCode}),c instanceof rt&&Lt(c))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,o);if(c instanceof Je)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,o);throw c})):i=this.createPopupClient(t).acquireToken(e,o),i.then(c=>(a.length<this.getAllAccounts().length?this.eventHandler.emitEvent(P.LOGIN_SUCCESS,D.Popup,c):this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_SUCCESS,D.Popup,c),r.end({success:!0,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:Ze(c.account)}),c)).catch(c=>(a.length>0?this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_FAILURE,D.Popup,null,c):this.eventHandler.emitEvent(P.LOGIN_FAILURE,D.Popup,null,c),r.end({success:!1},c),Promise.reject(c))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var i,o,c;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(u.SsoSilent,t),(i=this.ssoSilentMeasurement)==null||i.add({scenarioId:e.scenarioId,accountType:Ze(e.account)}),jr(this.initialized,this.ssoSilentMeasurement),(o=this.ssoSilentMeasurement)==null||o.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(P.SSO_SILENT_START,D.Silent,r);let a;return this.canUsePlatformBroker(r)?((c=this.ssoSilentMeasurement)==null||c.add({isPlatformBrokerRequest:!0}),a=this.acquireTokenNative(r,Z.ssoSilent).catch(l=>{var d;if((d=this.ssoSilentMeasurement)==null||d.add({brokerErrorName:l.name,brokerErrorCode:l.errorCode}),l instanceof rt&&Lt(l))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw l})):a=this.createSilentIframeClient(r.correlationId).acquireToken(r),a.then(l=>{var d;return this.eventHandler.emitEvent(P.SSO_SILENT_SUCCESS,D.Silent,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!0,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length,accountType:Ze(l.account)}),l}).catch(l=>{var d;throw this.eventHandler.emitEvent(P.SSO_SILENT_FAILURE,D.Silent,null,l),(d=this.ssoSilentMeasurement)==null||d.end({success:!1},l),l}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(u.AcquireTokenByCode,t);jr(this.initialized,r),this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_BY_CODE_START,D.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw O(oc);if(e.code){const a=e.code;let i=this.hybridAuthCodeResponses.get(a);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(o=>(this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_BY_CODE_SUCCESS,D.Silent,o),this.hybridAuthCodeResponses.delete(a),r.end({success:!0,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length,accountType:Ze(o.account)}),o)).catch(o=>{throw this.hybridAuthCodeResponses.delete(a),this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_BY_CODE_FAILURE,D.Silent,null,o),r.end({success:!1},o),o}),this.hybridAuthCodeResponses.set(a,i)),await i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){r.add({isPlatformBrokerRequest:!0});const a=await this.acquireTokenNative({...e,correlationId:t},Z.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof rt&&Lt(i)&&(this.platformAuthProvider=void 0),r.add({brokerErrorName:i.name,brokerErrorCode:i.errorCode}),i});return r.end({accountType:Ze(a.account),success:!0}),a}else throw O(cc);else throw O(ic)}catch(a){throw this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_BY_CODE_FAILURE,D.Silent,null,a),r.end({success:!1},a),a}}async acquireTokenByCodeAsync(e){var a;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(u.AcquireTokenByCodeAsync,e.correlationId),(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(i=>{var o;return(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!0,fromCache:i.fromCache}),i}).catch(i=>{var o;throw(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenFromCache,e.correlationId),t){case Ne.Default:case Ne.AccessToken:case Ne.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return b(r.acquireToken.bind(r),u.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw I(yt)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenByRefreshToken,e.correlationId),t){case Ne.Default:case Ne.AccessTokenAndRefreshToken:case Ne.RefreshToken:case Ne.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return b(r.acquireToken.bind(r),u.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw I(yt)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(u.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return b(t.acquireToken.bind(t),u.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Za(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,gt.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return oa(this.initialized),this.browserStorage.setInteractionInProgress(!0,gt.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return Iu(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return Su(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return Nu(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return Eu(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return _u(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();Ru(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return Pu(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=Ge.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,a){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw O(Xs);return new $r(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,a)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!yr(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Re.NONE:case Re.CONSENT:case Re.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Xu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new eg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new og(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Z.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new Mc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new cg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new hg(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Z.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Ic(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==pe.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==pe.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?Xe():w.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Wa})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Wa})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),jr(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const a=e.account||this.getActiveAccount();if(!a)throw O(Zo);return r.add({accountType:Ze(a)}),this.acquireTokenSilentDeduped(e,a,t).then(i=>(r.end({success:!0,fromCache:i.fromCache,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length}),{...i,state:e.state,correlationId:t})).catch(i=>{throw i instanceof ee&&i.setCorrelationId(t),r.end({success:!1},i),i})}async acquireTokenSilentDeduped(e,t,r){const a=Cn(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),i=JSON.stringify(a),o=this.activeSilentTokenRequests.get(i);if(typeof o>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);const c=b(this.acquireTokenSilentAsync.bind(this),u.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(i,c),c.finally(()=>{this.activeSilentTokenRequests.delete(i)})}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),o}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(u.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_START,D.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const a=await b(Mu,u.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||Ne.Default;return this.acquireTokenSilentNoIframe(a,i).catch(async c=>{if(gg(c,i))if(this.activeIframeRequest)if(i!==Ne.Skip){const[d,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,a.correlationId);const g=this.performanceClient.startMeasurement(u.AwaitConcurrentIframe,a.correlationId);g.add({awaitIframeCorrelationId:h});const m=await d;if(g.end({success:m}),m)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,a.correlationId),this.acquireTokenSilentNoIframe(a,i);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),c}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",a.correlationId),b(this.acquireTokenBySilentIframe.bind(this),u.AcquireTokenBySilentIframe,this.logger,this.performanceClient,a.correlationId)(a);else{let d;return this.activeIframeRequest=[new Promise(h=>{d=h}),a.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",a.correlationId),b(this.acquireTokenBySilentIframe.bind(this),u.AcquireTokenBySilentIframe,this.logger,this.performanceClient,a.correlationId)(a).then(h=>(d(!0),h)).catch(h=>{throw d(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw c}).then(c=>(this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_SUCCESS,D.Silent,c),e.correlationId&&this.performanceClient.addFields({fromCache:c.fromCache},e.correlationId),c)).catch(c=>{throw this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_FAILURE,D.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return yr(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,Z.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async r=>{throw this.performanceClient.addFields({brokerErrorName:r.name,brokerErrorCode:r.errorCode},e.correlationId),r instanceof rt&&Lt(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,I(yt)):r})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===Ne.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),b(this.acquireTokenFromCache.bind(this),u.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===Ne.AccessToken)throw r;return this.eventHandler.emitEvent(P.ACQUIRE_TOKEN_NETWORK_START,D.Silent,e),b(this.acquireTokenByRefreshToken.bind(this),u.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await b(En,u.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),ug(t,e,this.logger)}}function gg(s,e){const t=!(s instanceof Je&&s.subError!==An),r=s.errorCode===je.INVALID_GRANT_ERROR||s.errorCode===yt,a=t&&r||s.errorCode===rn||s.errorCode===Bs,i=$h.includes(e);return a&&i}/*! @azure/msal-browser v4.22.1 2025-09-09 */async function mg(s,e){const t=new Rt(s);return await t.initialize(),Rn.createController(t,e)}/*! @azure/msal-browser v4.22.1 2025-09-09 */class ya{static async createPublicClientApplication(e){const t=await mg(e);return new ya(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new Rn(new Rt(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}/*! @azure/msal-browser v4.22.1 2025-09-09 */const pg={initialize:()=>Promise.reject(he(fe)),acquireTokenPopup:()=>Promise.reject(he(fe)),acquireTokenRedirect:()=>Promise.reject(he(fe)),acquireTokenSilent:()=>Promise.reject(he(fe)),acquireTokenByCode:()=>Promise.reject(he(fe)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(he(fe)),loginPopup:()=>Promise.reject(he(fe)),loginRedirect:()=>Promise.reject(he(fe)),logout:()=>Promise.reject(he(fe)),logoutRedirect:()=>Promise.reject(he(fe)),logoutPopup:()=>Promise.reject(he(fe)),ssoSilent:()=>Promise.reject(he(fe)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw he(fe)},getLogger:()=>{throw he(fe)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw he(fe)},hydrateCache:()=>Promise.reject(he(fe)),clearCache:()=>Promise.reject(he(fe))};/*! @azure/msal-browser v4.22.1 2025-09-09 */class fg{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case P.LOGIN_START:return oe.Login;case P.SSO_SILENT_START:return oe.SsoSilent;case P.ACQUIRE_TOKEN_START:if(e.interactionType===D.Redirect||e.interactionType===D.Popup)return oe.AcquireToken;break;case P.HANDLE_REDIRECT_START:return oe.HandleRedirect;case P.LOGOUT_START:return oe.Logout;case P.SSO_SILENT_SUCCESS:case P.SSO_SILENT_FAILURE:if(t&&t!==oe.SsoSilent)break;return oe.None;case P.LOGOUT_END:if(t&&t!==oe.Logout)break;return oe.None;case P.HANDLE_REDIRECT_END:if(t&&t!==oe.HandleRedirect)break;return oe.None;case P.LOGIN_SUCCESS:case P.LOGIN_FAILURE:case P.ACQUIRE_TOKEN_SUCCESS:case P.ACQUIRE_TOKEN_FAILURE:case P.RESTORE_FROM_BFCACHE:if(e.interactionType===D.Redirect||e.interactionType===D.Popup){if(t&&t!==oe.Login&&t!==oe.AcquireToken)break;return oe.None}break}return null}}/*! @azure/msal-react v3.0.19 2025-08-19 */const yg={instance:pg,inProgress:oe.None,accounts:[],logger:new dt({})},xa=y.createContext(yg);xa.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */function Lc(s,e){return typeof s=="function"?s(e):s}function di(s,e){if(s.length!==e.length)return!1;const t=[...e];return s.every(r=>{const a=t.shift();return!r||!a?!1:r.homeAccountId===a.homeAccountId&&r.localAccountId===a.localAccountId&&r.username===a.username})}function Fc(s,e){return s.length>0&&(e.homeAccountId||e.localAccountId||e.username)&&s.filter(r=>!(e.username&&e.username.toLowerCase()!==r.username.toLowerCase()||e.homeAccountId&&e.homeAccountId.toLowerCase()!==r.homeAccountId.toLowerCase()||e.localAccountId&&e.localAccountId.toLowerCase()!==r.localAccountId.toLowerCase()))[0]||null}/*! @azure/msal-react v3.0.19 2025-08-19 */const xg="@azure/msal-react",hi="3.0.19";/*! @azure/msal-react v3.0.19 2025-08-19 */const hn={UNBLOCK_INPROGRESS:"UNBLOCK_INPROGRESS",EVENT:"EVENT"},bg=(s,e)=>{const{type:t,payload:r}=e;let a=s.inProgress;switch(t){case hn.UNBLOCK_INPROGRESS:s.inProgress===oe.Startup&&(a=oe.None,r.logger.info("MsalProvider - handleRedirectPromise resolved, setting inProgress to 'none'"));break;case hn.EVENT:const o=r.message,c=fg.getInteractionStatusFromEvent(o,s.inProgress);c&&(r.logger.info(`MsalProvider - ${o.eventType} results in setting inProgress from ${s.inProgress} to ${c}`),a=c);break;default:throw new Error(`Unknown action type: ${t}`)}if(a===oe.Startup)return s;const i=r.instance.getAllAccounts();return a!==s.inProgress&&!di(i,s.accounts)?{...s,inProgress:a,accounts:i}:a!==s.inProgress?{...s,inProgress:a}:di(i,s.accounts)?s:{...s,accounts:i}};function wg({instance:s,children:e}){y.useEffect(()=>{s.initializeWrapperLibrary(Fh.React,hi)},[s]);const t=y.useMemo(()=>s.getLogger().clone(xg,hi),[s]),[r,a]=y.useReducer(bg,void 0,()=>({inProgress:oe.Startup,accounts:[]}));y.useEffect(()=>{const o=s.addEventCallback(c=>{a({payload:{instance:s,logger:t,message:c},type:hn.EVENT})});return t.verbose(`MsalProvider - Registered event callback with id: ${o}`),s.initialize().then(()=>{s.handleRedirectPromise().catch(()=>{}).finally(()=>{a({payload:{instance:s,logger:t},type:hn.UNBLOCK_INPROGRESS})})}).catch(()=>{}),()=>{o&&(t.verbose(`MsalProvider - Removing event callback ${o}`),s.removeEventCallback(o))}},[s,t]);const i={instance:s,inProgress:r.inProgress,accounts:r.accounts,logger:t};return St.createElement(xa.Provider,{value:i},e)}/*! @azure/msal-react v3.0.19 2025-08-19 */const Xt=()=>y.useContext(xa);/*! @azure/msal-react v3.0.19 2025-08-19 */function kg(s,e){return e&&(e.username||e.homeAccountId||e.localAccountId)?!!Fc(s,e):s.length>0}function ba(s){const{accounts:e,inProgress:t}=Xt();return y.useMemo(()=>t===oe.Startup?!1:kg(e,s),[e,t,s])}/*! @azure/msal-react v3.0.19 2025-08-19 */function Cg({username:s,homeAccountId:e,localAccountId:t,children:r}){const a=Xt(),i=y.useMemo(()=>({username:s,homeAccountId:e,localAccountId:t}),[s,e,t]);return ba(i)&&a.inProgress!==oe.Startup?St.createElement(St.Fragment,null,Lc(r,a)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function vg({username:s,homeAccountId:e,localAccountId:t,children:r}){const a=Xt(),i=y.useMemo(()=>({username:s,homeAccountId:e,localAccountId:t}),[s,e,t]);return!ba(i)&&a.inProgress!==oe.Startup&&a.inProgress!==oe.HandleRedirect?St.createElement(St.Fragment,null,Lc(r,a)):null}/*! @azure/msal-react v3.0.19 2025-08-19 */function ui(s,e){return!e||!e.homeAccountId&&!e.localAccountId&&!e.username?s.getActiveAccount():Fc(s.getAllAccounts(),e)}function Ag(s){const{instance:e,inProgress:t,logger:r}=Xt(),[a,i]=y.useState(()=>t===oe.Startup?null:ui(e,s));return y.useEffect(()=>{t!==oe.Startup&&i(o=>{const c=ui(e,s);return Ge.accountInfoIsEqual(o,c,!0)?o:(r.info("useAccount - Updating account"),c)})},[t,s,e,r]),a}let Mr;const Tg=new Uint8Array(16);function Ig(){if(!Mr&&(Mr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Mr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mr(Tg)}const Ce=[];for(let s=0;s<256;++s)Ce.push((s+256).toString(16).slice(1));function Sg(s,e=0){return Ce[s[e+0]]+Ce[s[e+1]]+Ce[s[e+2]]+Ce[s[e+3]]+"-"+Ce[s[e+4]]+Ce[s[e+5]]+"-"+Ce[s[e+6]]+Ce[s[e+7]]+"-"+Ce[s[e+8]]+Ce[s[e+9]]+"-"+Ce[s[e+10]]+Ce[s[e+11]]+Ce[s[e+12]]+Ce[s[e+13]]+Ce[s[e+14]]+Ce[s[e+15]]}const Ng=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gi={randomUUID:Ng};function Hc(s,e,t){if(gi.randomUUID&&!e&&!s)return gi.randomUUID();s=s||{};const r=s.random||(s.rng||Ig)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return Sg(r)}const Kt={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!0},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},kt={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},rr={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},hr={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300};let as=null;const mi=s=>{as=s},lt=()=>{if(as)return as;let s=localStorage.getItem(kt.USER_ID);return(!s||s.trim().length===0)&&(s=Hc(),localStorage.setItem(kt.USER_ID,s)),s},Eg=s=>{if(!s||s.trim().length===0)throw new Error("User ID cannot be empty");localStorage.setItem(kt.USER_ID,s.trim())},pi=()=>{const s=Hc();return localStorage.setItem(kt.USER_ID,s),s},_g=()=>localStorage.getItem("bh_user_id_custom")==="true",Rg=s=>{localStorage.setItem("bh_user_id_custom",s.toString())},Pg=()=>{const s=localStorage.getItem(kt.THEME);return s==="light"||s==="dark"?s:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},fi=s=>{localStorage.setItem(kt.THEME,s),s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},Og=()=>{const s=localStorage.getItem(kt.PROCESSING_MODE);return s==="true"||s==="false"?s==="true":!1},jg=s=>{localStorage.setItem(kt.PROCESSING_MODE,s.toString())},xr=s=>{const e=new Date,t=new Date(s),r=e.getTime()-t.getTime(),a=Math.floor(r/(1e3*60)),i=Math.floor(r/(1e3*60*60)),o=Math.floor(r/(1e3*60*60*24));return a<1?"Just now":a<60?`${a}m ago`:i<24?`${i}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()},zt=s=>new Date(s).toLocaleString(),_e=(s,e,t)=>({code:s,message:e,details:t,timestamp:new Date().toISOString()}),Mg=s=>s instanceof TypeError&&s.message.includes("fetch")?!0:s instanceof Error?s.message.includes("Network")||s.message.includes("connection")||s.message.includes("timeout"):!1,Dg=(s,e="polite")=>{const t=document.createElement("div");t.setAttribute("aria-live",e),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=s,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)},Ug=(s,e=100)=>{setTimeout(()=>{const t=document.getElementById(s);t&&t.focus()},e)},Bc=y.createContext(void 0),Lg=()=>{const s=y.useContext(Bc);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s},Fg=({children:s})=>{const[e,t]=y.useState(Pg),r=o=>{t(o),fi(o)},a=()=>{r(e==="light"?"dark":"light")};y.useEffect(()=>{fi(e)},[e]),y.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),c=l=>{localStorage.getItem("bh_theme")||t(l.matches?"dark":"light")};return o.addEventListener("change",c),()=>o.removeEventListener("change",c)},[]);const i={theme:e,toggleTheme:a,setTheme:r};return n.jsx(Bc.Provider,{value:i,children:s})},Hg={auth:{clientId:{}.VITE_AZURE_CLIENT_ID||"your-client-id-here",authority:{}.VITE_AZURE_AUTHORITY||"https://login.microsoftonline.com/your-tenant-id",redirectUri:{}.VITE_AZURE_REDIRECT_URI||window.location.origin,postLogoutRedirectUri:{}.VITE_AZURE_POST_LOGOUT_REDIRECT_URI||window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(s,e,t)=>{if(!t)switch(s){case 0:console.error("[MSAL Error]:",e);break;case 1:console.warn("[MSAL Warning]:",e);break;case 2:console.info("[MSAL Info]:",e);break;case 3:console.debug("[MSAL Verbose]:",e);break}}}}},Bg={scopes:["openid","profile","email","User.Read"]},$g={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},le={ADMIN:"Admin",CONTROL_PANEL:"Control Panel"},it={APP_ROLES:"roles",GROUPS:"groups"},Kg="User",$c=y.createContext(void 0),kr=()=>{const s=y.useContext($c);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},zg=s=>{const e=s.idTokenClaims,t=[];if(e!=null&&e[it.APP_ROLES]){const r=Array.isArray(e[it.APP_ROLES])?e[it.APP_ROLES]:[e[it.APP_ROLES]];t.push(...r)}return e!=null&&e[it.GROUPS]&&(Array.isArray(e[it.GROUPS])?e[it.GROUPS]:[e[it.GROUPS]]).forEach(a=>{a==={}.VITE_AZURE_AD_ADMIN_GROUP_ID?t.push(le.ADMIN):a==={}.VITE_AZURE_AD_CONTROL_PANEL_GROUP_ID&&t.push(le.CONTROL_PANEL)}),[...new Set(t)]},Gg=s=>s.includes(le.ADMIN)?le.ADMIN:s.includes(le.CONTROL_PANEL)?le.CONTROL_PANEL:Kg,qg=s=>{if(!s)return null;const e=zg(s),t=Gg(e),r=s.idTokenClaims;return{id:s.localAccountId||s.homeAccountId,email:s.username,name:s.name||s.username,roles:e,primaryRole:t,groups:(r==null?void 0:r[it.GROUPS])||[],preferredUsername:r==null?void 0:r.preferred_username,tenantId:s.tenantId}},Vg=({children:s})=>{const{instance:e,accounts:t,inProgress:r}=Xt(),a=Ag(t[0]||{}),i=ba(),[o,c]=y.useState(null),[l,d]=y.useState(!0),[h,g]=y.useState(null);y.useEffect(()=>{const F=qg(a);c(F),mi(F?F.id:null)},[a]),y.useEffect(()=>{d(r!==oe.None)},[r]),y.useEffect(()=>{const F=e.addEventCallback(B=>{var v,x;switch(B.eventType){case P.LOGIN_SUCCESS:console.log("[Auth] Login successful"),g(null);break;case P.LOGIN_FAILURE:console.error("[Auth] Login failed:",B.error),g(((v=B.error)==null?void 0:v.message)||"Login failed");break;case P.LOGOUT_SUCCESS:console.log("[Auth] Logout successful"),c(null),g(null);break;case P.ACQUIRE_TOKEN_SUCCESS:console.log("[Auth] Token acquired successfully"),g(null);break;case P.ACQUIRE_TOKEN_FAILURE:console.error("[Auth] Token acquisition failed:",B.error),g(((x=B.error)==null?void 0:x.message)||"Token acquisition failed");break}});return()=>{F&&e.removeEventCallback(F)}},[e]);const m=async F=>{try{g(null),d(!0);const B={...Bg,...F};await e.loginPopup(B)}catch(B){throw console.error("[Auth] Login error:",B),g(B.message||"Login failed"),B}finally{d(!1)}},k=async F=>{try{g(null),d(!0);const B={account:a||void 0,...F};await e.logoutPopup(B)}catch(B){throw console.error("[Auth] Logout error:",B),g(B.message||"Logout failed"),B}finally{d(!1)}},S=()=>{g(null)},T=F=>(o==null?void 0:o.roles.includes(F))??!1,N=F=>F.some(B=>T(B)),te={user:o,isAuthenticated:i,isLoading:l,error:h,login:m,logout:k,clearError:S,hasRole:T,hasAnyRole:N,isAdmin:()=>T(le.ADMIN),canAccessControlPanel:()=>N([le.ADMIN,le.CONTROL_PANEL])};return n.jsx($c.Provider,{value:te,children:s})},Wg=()=>{const{login:s,isLoading:e,error:t}=kr(),r=()=>{s().catch(console.error)};return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"max-w-md w-full space-y-8",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-6xl mb-4",children:""}),n.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),n.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),n.jsxs("div",{className:"space-y-4",children:[t&&n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:n.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t})}),n.jsx("button",{onClick:r,disabled:e,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e?n.jsxs("div",{className:"flex items-center",children:[n.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[n.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),n.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign in with Microsoft"}),n.jsx("div",{className:"text-center",children:n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},yi=({children:s,fallback:e,redirectTo:t})=>{const r=ls();return n.jsxs(n.Fragment,{children:[n.jsx(Cg,{children:s}),n.jsx(vg,{children:e||(t?n.jsx(Ii,{to:t,state:{from:r},replace:!0}):n.jsx(Wg,{}))})]})},Qg=({children:s,roles:e,requireAll:t=!1,fallback:r,redirectTo:a})=>{const{hasRole:i,hasAnyRole:o,user:c}=kr(),l=ls();return(t?e.every(h=>i(h)):o(e))?n.jsx(n.Fragment,{children:s}):r?n.jsx(n.Fragment,{children:r}):a?n.jsx(Ii,{to:a,state:{from:l},replace:!0}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[n.jsx("div",{className:"text-6xl mb-4",children:""}),n.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",e.length>1?"s":"",": ",e.join(", ")]}),n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",c!=null&&c.roles.length&&c.roles.length>1?"s":"",": ",(c==null?void 0:c.roles.join(", "))||"None"]})]})]})})},Yg=()=>{const{hasRole:s,hasAnyRole:e,isAdmin:t,canAccessControlPanel:r}=kr();return{hasRole:s,hasAnyRole:e,isAdmin:t,canAccessControlPanel:r,canAccessAdminOnly:()=>t(),hasControlPanelAccess:()=>r()}},Dt=({children:s,requireAuth:e=!0,requireRoles:t=[],requireAll:r=!1,fallback:a,redirectTo:i})=>!e&&t.length===0?n.jsx(n.Fragment,{children:s}):e&&t.length===0?n.jsx(yi,{fallback:a,redirectTo:i,children:s}):n.jsx(yi,{fallback:a,redirectTo:i,children:n.jsx(Qg,{roles:t,requireAll:r,fallback:a,redirectTo:i,children:s})});class Jg{constructor(e,t){we(this,"msalInstance");we(this,"accounts");this.msalInstance=e,this.accounts=t}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...$g,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(e){return console.warn("Failed to acquire access token silently:",e),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const e=this.accounts[0];return{userId:e.homeAccountId,username:e.username,name:e.name}}}const Xg=()=>{const{instance:s,accounts:e}=Xt();return new Jg(s,e)};class Zg{constructor(e,t){we(this,"baseUrl");we(this,"authProvider");this.baseUrl=e,this.authProvider=t}setAuthProvider(e){this.authProvider=e}async handleResponse(e){if(!e.ok){const t=await e.json().catch(()=>({}));throw _e(`HTTP_${e.status}`,t.message||`HTTP ${e.status}: ${e.statusText}`,{status:e.status,statusText:e.statusText,data:t})}return e.json()}async request(e,t={}){try{const r=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,a=e.startsWith("/")?e:`/${e}`,i=`${r}${a}`,o={"Content-Type":"application/json",...t.headers};if(this.authProvider)try{const l=await this.authProvider.getAuthHeaders();Object.assign(o,l)}catch(l){console.warn("Failed to get authentication headers:",l)}const c=await fetch(i,{...t,headers:o});return this.handleResponse(c)}catch(r){throw Mg(r)?_e("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:r}):r instanceof Error&&"code"in r?r:_e("UNKNOWN_ERROR","An unexpected error occurred",{originalError:r})}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}}const Ue=new Zg(Kt.api.baseUrl),em=s=>{Ue.setAuthProvider(s)},ge={async checkHealth(){return Ue.get(rr.HEALTH)},async initiateSession(s){return Ue.post(rr.SESSIONS_INITIATE,s)},async submitPrediction(s){return Ue.post(rr.PREDICTIONS_SUBMIT,s)},async getPredictionBySessionId(s){return Ue.get(`${rr.PREDICTIONS_BY_SESSION}/${s}`)},async getUserPredictions(s){return Ue.get(`${rr.PREDICTIONS_BY_USER}/${s}`)},async saveSessionData(s){return Ue.post("sessions",s)},async getSessionData(s){return Ue.get(`sessions/${s}`)},async getUserSessions(s){return Ue.get(`sessions/users/${s}`)},async updateSessionData(s,e){return Ue.put(`sessions/${s}`,e)},async deleteSessionData(s){return Ue.delete(`sessions/${s}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(s){return{success:!1,message:s.message||"Connection test failed"}}},async generateRiskAssessment(s){return Ue.post(`sessions/${s}/risk-assessment`)},async getRiskAssessment(s){return Ue.get(`sessions/${s}/risk-assessment`)}};class xi{constructor(e,t={}){we(this,"sessionId");we(this,"intervalMs");we(this,"maxAttempts");we(this,"backoffFactor");we(this,"currentAttempt",0);we(this,"timeoutId",null);we(this,"isPolling",!1);this.sessionId=e,this.intervalMs=t.intervalMs||Kt.polling.intervalMs,this.maxAttempts=t.maxAttempts||Kt.polling.maxAttempts,this.backoffFactor=t.backoffFactor||Kt.polling.backoffFactor}async start(e,t,r){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const a=async()=>{try{const i=await ge.getPredictionBySessionId(this.sessionId);if(e(i),i.status==="succeeded"||i.status==="success"||i.status==="failed"){this.stop(),t(i);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),r(_e("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const o=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(a,o)}catch(i){this.stop(),r(i)}};await a()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const tm=({children:s})=>{const e=Xg();return y.useEffect(()=>{em(e)},[e]),n.jsx(n.Fragment,{children:s})},Kc=()=>{const s=y.useCallback((r,a="polite")=>{Dg(r,a)},[]),e=y.useCallback(r=>{s(r,"assertive")},[s]),t=y.useCallback(r=>{s(r,"polite")},[s]);return{announce:s,announceError:e,announceSuccess:t}},rm=()=>{const s=y.useCallback(t=>{const r=a=>{a.key==="Escape"&&(a.preventDefault(),t())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[]),e=y.useCallback(t=>r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),t())},[]);return{handleEscape:s,handleEnterSpace:e}},nm=()=>({skipToMain:y.useCallback(()=>{Ug(hr.SKIP_TO_CONTENT_ID,hr.FOCUS_TIMEOUT)},[])}),sm=({className:s=""})=>{const{theme:e,toggleTheme:t}=Lg(),{user:r,logout:a,login:i,isAuthenticated:o}=kr(),{canAccessControlPanel:c,isAdmin:l}=Yg(),d=ls(),{handleEnterSpace:h}=rm(),[g,m]=y.useState(!1),[k,S]=y.useState(!1),N=(()=>{const F=[{path:"/",label:"Dashboard",icon:"",roles:[le.ADMIN,le.CONTROL_PANEL]},{path:"/upload",label:"Upload & Analyze",icon:"",roles:[le.ADMIN]},{path:"/sessions",label:"Sessions",icon:"",roles:[le.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"",roles:[le.ADMIN]},{path:"/health",label:"System Health",icon:"",roles:[le.ADMIN]}];return o?F.filter(B=>!!(l()||B.path==="/"&&c())):[]})(),z=F=>F==="/"?d.pathname==="/":d.pathname.startsWith(F),G=()=>{m(!g)},te=()=>{m(!1)};return y.useEffect(()=>{m(!1),S(!1)},[d.pathname]),y.useEffect(()=>{const F=B=>{const v=B.target;k&&!v.closest("[data-user-menu]")&&S(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[k]),n.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${s}`,children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[n.jsxs("div",{className:"flex justify-between items-center h-16",children:[n.jsx("div",{className:"flex items-center",children:n.jsxs(Se,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1","aria-label":"Behavioral Health System - Go to Dashboard",children:[n.jsx("span",{className:"text-2xl",role:"img","aria-label":"Brain icon",children:""}),n.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),n.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),n.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:N.map(({path:F,label:B,icon:v})=>n.jsxs(Se,{to:F,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${z(F)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":z(F)?"page":void 0,children:[n.jsx("span",{role:"img","aria-hidden":"true",children:v}),n.jsx("span",{children:B})]},F))}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("button",{onClick:t,onKeyDown:h(t),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${e==="light"?"dark":"light"} mode`,type:"button",children:n.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:e==="light"?"":""})}),o&&r&&n.jsxs("div",{className:"relative","data-user-menu":!0,children:[n.jsxs("button",{onClick:()=>S(!k),onKeyDown:h(()=>S(!k)),className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                    transition-colors touch-target\r
                  `,"aria-label":"User menu",type:"button",children:[n.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:r.name.charAt(0).toUpperCase()}),n.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-900 dark:text-white",children:r.name}),n.jsx("svg",{className:`w-4 h-4 transition-transform ${k?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&n.jsxs("div",{className:"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50",children:[n.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:r.name.charAt(0).toUpperCase()}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.email})]})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:r.primaryRole}),r.roles.length>1&&n.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["+",r.roles.length-1," more"]})]})]}),n.jsx("div",{className:"py-1",children:n.jsx("button",{onClick:()=>{a(),S(!1)},className:`\r
                          w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r
                          hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r
                        `,children:"Sign out"})})]})]}),!o&&n.jsx("button",{onClick:()=>i(),className:`\r
                  px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md\r
                  hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\r
                  transition-colors\r
                `,children:"Sign In"}),n.jsx("button",{onClick:G,onKeyDown:h(G),className:`\r
                md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":g?"Close mobile menu":"Open mobile menu",type:"button",...g?{"aria-expanded":!0}:{"aria-expanded":!1},children:n.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:g?"":""})})]})]}),g&&o&&n.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:n.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:N.map(({path:F,label:B,icon:v})=>n.jsxs(Se,{to:F,onClick:te,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${z(F)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":z(F)?"page":void 0,children:[n.jsx("span",{role:"img","aria-hidden":"true",children:v}),n.jsx("span",{children:B})]},F))})})]})})},am=({size:s=20,className:e="",...t})=>n.jsxs("svg",{width:s,height:s,viewBox:"0 0 23 23",className:e,"aria-label":"Microsoft",...t,children:[n.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),n.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),n.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),n.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),im=({children:s,className:e=""})=>{const{skipToMain:t}=nm();return n.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[n.jsx("a",{href:`#${hr.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:r=>{r.preventDefault(),t()},children:"Skip to main content"}),n.jsx(sm,{}),n.jsx("main",{id:hr.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${e}`,tabIndex:-1,children:s}),n.jsx("div",{id:hr.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),n.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(am,{size:24,className:"opacity-80"}),n.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),n.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[n.jsxs("p",{children:["Behavioral Health System  ",new Date().getFullYear()]}),n.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant  Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const om=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cm=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),bi=s=>{const e=cm(s);return e.charAt(0).toUpperCase()+e.slice(1)},zc=(...s)=>s.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),lm=s=>{for(const e in s)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var dm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hm=y.forwardRef(({color:s="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:a="",children:i,iconNode:o,...c},l)=>y.createElement("svg",{ref:l,...dm,width:e,height:e,stroke:s,strokeWidth:r?Number(t)*24/Number(e):t,className:zc("lucide",a),...!i&&!lm(c)&&{"aria-hidden":"true"},...c},[...o.map(([d,h])=>y.createElement(d,h)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=(s,e)=>{const t=y.forwardRef(({className:r,...a},i)=>y.createElement(hm,{ref:i,iconNode:e,className:zc(`lucide-${om(bi(s))}`,`lucide-${s}`,r),...a}));return t.displayName=bi(s),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],un=K("activity",um);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gm=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],mm=K("arrow-left",gm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pm=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],mt=K("brain",pm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fm=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Gc=K("calendar",fm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ym=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],wi=K("chart-column",ym);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xm=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],bm=K("chart-pie",xm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wm=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],qc=K("chevron-down",wm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Vc=K("chevron-up",km);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cm=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],We=K("circle-alert",Cm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vm=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ze=K("circle-check-big",vm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Am=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],gn=K("circle-x",Am);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tm=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Pt=K("clock",Tm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Im=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],mn=K("download",Im);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sm=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Nm=K("eye-off",Sm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Em=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],br=K("eye",Em);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _m=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Rm=K("file-audio",_m);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pm=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Om=K("file-text",Pm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jm=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Mm=K("file",jm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dm=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],Um=K("files",Dm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lm=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Wc=K("funnel",Lm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fm=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Qc=K("heart",Fm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hm=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],is=K("info",Hm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bm=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],$m=K("lightbulb",Bm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Km=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],zm=K("loader-circle",Km);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gm=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],os=K("pause",Gm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qm=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ft=K("play",qm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vm=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ki=K("plus",Vm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wm=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Pe=K("refresh-cw",Wm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qm=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ym=K("search",Qm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jm=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],cs=K("shield-alert",Jm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xm=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Zm=K("target",Xm);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Kr=K("trash-2",ep);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tp=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],rp=K("trending-down",tp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],wa=K("trending-up",np);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Yc=K("triangle-alert",sp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ap=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ip=K("upload",ap);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Ci=K("user",op);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cp=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],vi=K("volume-2",cp);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Dr=K("x",lp),Jc={health:["health"],userPredictions:s=>["predictions","user",s],sessionPrediction:s=>["predictions","session",s],userSessions:s=>["sessions","user",s]},Xc=()=>Ti({queryKey:Jc.health,queryFn:()=>ge.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),dp=s=>{const e=s||lt();return Ti({queryKey:Jc.userSessions(e),queryFn:()=>ge.getUserSessions(e),enabled:!!e,staleTime:3e4,refetchOnWindowFocus:!1})},hp=()=>{const s=lt(),{announce:e}=Kc(),{canAccessControlPanel:t}=kr(),[r,a]=y.useState(!1),{data:i,isLoading:o,error:c}=Xc(),{data:l,isLoading:d}=dp(s);y.useEffect(()=>{e("Dashboard page loaded","polite")},[e]);const h=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"",color:"primary"},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"",color:"secondary"},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"",color:"accent"},{title:"System Health",description:"Check API status and system connectivity",href:"/health",icon:"",color:"warning"}],g=m=>{const k="block p-6 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(m){case"primary":return`${k} border-primary-200 bg-primary-50 hover:border-primary-300 hover:bg-primary-100 dark:border-primary-800 dark:bg-primary-900 dark:hover:border-primary-700 dark:hover:bg-primary-800 focus:ring-primary-500`;case"secondary":return`${k} border-secondary-200 bg-secondary-50 hover:border-secondary-300 hover:bg-secondary-100 dark:border-secondary-800 dark:bg-secondary-900 dark:hover:border-secondary-700 dark:hover:bg-secondary-800 focus:ring-secondary-500`;case"accent":return`${k} border-accent-200 bg-accent-50 hover:border-accent-300 hover:bg-accent-100 dark:border-accent-800 dark:bg-accent-900 dark:hover:border-accent-700 dark:hover:bg-accent-800 focus:ring-accent-500`;case"warning":return`${k} border-warning-200 bg-warning-50 hover:border-warning-300 hover:bg-warning-100 dark:border-teal-600 dark:bg-teal-800 dark:hover:border-teal-500 dark:hover:bg-teal-700 focus:ring-warning-500`;default:return`${k} border-gray-200 bg-gray-50 hover:border-gray-300 hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-800 dark:hover:border-gray-600 dark:hover:bg-gray-700 focus:ring-gray-500`}};return n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),n.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),t()&&n.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:" Control Panel"}),n.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Access advanced administrative features and system controls"})]}),n.jsx("button",{onClick:()=>a(!r),className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:r?"Hide Control Panel":"Show Control Panel"})]}),r&&n.jsx("div",{className:"mt-6 border-t border-primary-200 dark:border-primary-800 pt-6",children:n.jsxs("div",{className:"card bg-gray-50 dark:bg-gray-800",children:[n.jsx("h3",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:" Control Panel"}),n.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark mb-4",children:"Advanced administrative features and system controls will be displayed here."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[n.jsx("h4",{className:"font-medium text-text-primary-light dark:text-text-primary-dark",children:"User Management"}),n.jsx("p",{className:"text-sm text-text-secondary-light dark:text-text-secondary-dark mt-1",children:"Manage user accounts and permissions"})]}),n.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[n.jsx("h4",{className:"font-medium text-text-primary-light dark:text-text-primary-dark",children:"System Configuration"}),n.jsx("p",{className:"text-sm text-text-secondary-light dark:text-text-secondary-dark mt-1",children:"Configure system settings and parameters"})]}),n.jsxs("div",{className:"p-4 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[n.jsx("h4",{className:"font-medium text-text-primary-light dark:text-text-primary-dark",children:"Data Analytics"}),n.jsx("p",{className:"text-sm text-text-secondary-light dark:text-text-secondary-dark mt-1",children:"View system analytics and reports"})]})]})]})})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"Your User ID"}),n.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-md",children:n.jsx("code",{className:"text-sm font-mono text-text-primary-light dark:text-text-primary-dark break-all",children:s})}),n.jsx("p",{className:"mt-2 text-sm text-text-muted-light dark:text-text-muted-dark",children:"This ID is automatically generated and stored locally to track your sessions."})]}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:h.map(m=>n.jsx(Se,{to:m.href,className:g(m.color),"aria-label":`${m.title}: ${m.description}`,children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl mb-3",role:"img","aria-hidden":"true",children:m.icon}),n.jsx("h3",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:m.title}),n.jsx("p",{className:"text-sm text-text-secondary-light dark:text-text-secondary-dark",children:m.description})]})},m.href))})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),d?n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"spinner w-4 h-4"}),n.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(l!=null&&l.sessions)||l.sessions.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:""}),n.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",n.jsx(Se,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):n.jsxs("div",{className:"space-y-3",children:[l.sessions.slice(0,3).map(m=>{var k,S;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:`status-${m.status||"completed"}`,children:m.status||"completed"}),n.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:m.audioFileName||((k=m.sessionId)==null?void 0:k.slice(0,8))||"Unknown"}),n.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:m.createdAt,children:m.createdAt?new Date(m.createdAt).toLocaleString():""})]}),n.jsx(Se,{to:`/sessions/${m.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${m.audioFileName||((S=m.sessionId)==null?void 0:S.slice(0,8))||"Unknown"}`,children:n.jsx(br,{className:"w-4 h-4","aria-hidden":"true"})})]},m.sessionId)}),l.sessions.length>3&&n.jsx("div",{className:"text-center pt-3",children:n.jsxs(Se,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",l.sessions.length," sessions "]})})]})]}),n.jsxs("div",{className:"card",children:[n.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"System Status"}),o?n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"spinner w-4 h-4"}),n.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):c?n.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[n.jsx("span",{role:"img","aria-label":"Error",children:""}),n.jsx("span",{children:"System health check failed"})]}):n.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[n.jsx("span",{role:"img","aria-label":"Healthy",children:""}),n.jsx("span",{children:"All systems operational"}),(i==null?void 0:i.checks)&&n.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(i.checks).length," services checked)"]})]})]})]})};class up{constructor(){we(this,"ffmpeg",null);we(this,"isLoaded",!1);we(this,"loadingPromise",null);this.ffmpeg=new wl}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw _e("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await Aa(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Aa(`${e}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(e){throw this.loadingPromise=null,_e("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:e})}}async convertAudio(e,t={outputFormat:"wav",sampleRate:44100,channels:1},r){try{if(r==null||r({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw _e("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:h})=>{r==null||r({stage:"converting",progress:Math.round(h*100),message:`Converting audio... ${Math.round(h*100)}%`})}),r==null||r({stage:"converting",progress:0,message:"Preparing audio file..."});const a="input."+this.getFileExtension(e.name);await this.ffmpeg.writeFile(a,await kl(e));const i=`output.${t.outputFormat}`,o=["-i",a,"-ac",t.channels.toString(),"-ar",t.sampleRate.toString(),"-f",t.outputFormat,i];await this.ffmpeg.exec(o);const c=await this.ffmpeg.readFile(i),l=new Blob([c],{type:`audio/${t.outputFormat}`}),d=new File([l],`${this.getFileNameWithoutExtension(e.name)}.${t.outputFormat}`,{type:`audio/${t.outputFormat}`});return await this.ffmpeg.deleteFile(a),await this.ffmpeg.deleteFile(i),r==null||r({stage:"completed",progress:100,message:"Audio conversion completed"}),d}catch(a){throw _e("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:a,fileName:e.name,fileSize:e.size,fileType:e.type})}}getFileExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(t+1).toLowerCase():""}getFileNameWithoutExtension(e){const t=e.lastIndexOf(".");return t!==-1?e.slice(0,t):e}async isFormatSupported(e){try{await this.loadFFmpeg();const t=["wav","mp3","mp4","m4a","aac","flac","ogg"],r=this.getFileExtension(e.name);return t.includes(r)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let Ln=null;const gp=()=>(Ln||(Ln=new up),Ln),Fn=async(s,e)=>{const r=await gp().convertAudio(s,{outputFormat:"wav",sampleRate:44100,channels:1},e?a=>e(a.progress):void 0);return new Blob([r],{type:"audio/wav"})};class mp{constructor(e){we(this,"containerClient",null);we(this,"sasUrl");if(this.sasUrl=e||Kt.azure.blobSasUrl,!this.sasUrl)throw _e("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const e=new Cl(this.sasUrl);this.containerClient=e.getContainerClient(Kt.azure.containerName)}catch(e){throw _e("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:e})}return this.containerClient}async uploadFile(e,t,r,a){try{r==null||r({progress:0,stage:"preparing",message:"Preparing upload..."});const i=this.getContainerClient(),o=t||this.generateBlobName(e.name,a),c=i.getBlockBlobClient(o);r==null||r({progress:10,stage:"uploading",message:"Starting upload..."}),await c.uploadData(e,{blobHTTPHeaders:{blobContentType:e.type},onProgress:d=>{const h=d.loadedBytes&&e.size?Math.round(d.loadedBytes/e.size*90)+10:50;r==null||r({progress:h,stage:"uploading",message:`Uploading... ${h}%`})}});const l=c.url;return r==null||r({progress:100,stage:"completed",message:"Upload completed"}),{url:l,fileName:o,size:e.size}}catch(i){throw _e("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:i,fileName:e.name,fileSize:e.size})}}generateBlobName(e,t){const r=t||lt(),a=new Date().toISOString().replace(/[:.]/g,"-"),i=Math.random().toString(36).substring(2,8),o=e.split(".").pop()||"wav";return`users/${r}/audio/${a}-${i}.${o}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(e){try{await this.getContainerClient().getBlockBlobClient(e).deleteIfExists()}catch(t){throw _e("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:t,fileName:e})}}async listUserFiles(e){try{const t=e||lt(),r=this.getContainerClient(),a=`users/${t}/`,i=[];for await(const o of r.listBlobsFlat({prefix:a}))i.push(o.name);return i}catch(t){throw _e("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:t,userId:e})}}async deleteUserData(e){try{const t=e||lt(),r=await this.listUserFiles(t);let a=0;for(const i of r)await this.deleteFile(i),a++;return a}catch(t){throw _e("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:t,userId:e})}}async getUserStorageUsage(e){try{const t=e||lt(),r=this.getContainerClient(),a=`users/${t}/`;let i=0,o=0;for await(const c of r.listBlobsFlat({prefix:a}))i++,o+=c.properties.contentLength||0;return{fileCount:i,totalSizeBytes:o}}catch(t){throw _e("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:t,userId:e})}}}let Ur=null;const pp=s=>((!Ur||s&&s!==Ur.sasUrl)&&(Ur=new mp(s)),Ur),Hn=async(s,e,t,r)=>{const a=pp(),i=s instanceof File?s:new File([s],e,{type:s.type});return(await a.uploadFile(i,e,t?c=>t(c.progress):void 0,r)).url},Cr=()=>{const s=y.useRef(null),e=y.useCallback(c=>{if(!s.current){const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),l.style.position="absolute",l.style.left="-10000px",l.style.width="1px",l.style.height="1px",l.style.overflow="hidden",document.body.appendChild(l),s.current=l}s.current.textContent="",setTimeout(()=>{s.current&&(s.current.textContent=c)},100)},[]),t={focusById:c=>{const l=document.getElementById(c);l&&l.focus()},focusFirstInContainer:c=>{const d=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];d&&d.focus()},trapFocus:c=>{const l=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),d=l[0],h=l[l.length-1],g=m=>{m.key==="Tab"&&(m.shiftKey?document.activeElement===d&&(h.focus(),m.preventDefault()):document.activeElement===h&&(d.focus(),m.preventDefault()))};return c.addEventListener("keydown",g),()=>{c.removeEventListener("keydown",g)}}},r={handleArrowNavigation:(c,l,d,h)=>{var m;let g=d;switch(c.key){case"ArrowDown":c.preventDefault(),g=d<l.length-1?d+1:0;break;case"ArrowUp":c.preventDefault(),g=d>0?d-1:l.length-1;break;case"Home":c.preventDefault(),g=0;break;case"End":c.preventDefault(),g=l.length-1;break;default:return}h(g),(m=l[g])==null||m.focus()},handleEscape:(c,l)=>{c.key==="Escape"&&(c.preventDefault(),l())}},a=y.useCallback((c="element")=>`${c}-${Math.random().toString(36).substr(2,9)}`,[]),i=y.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),o=y.useCallback((c,l,d)=>{const h={};return c||(h["aria-invalid"]="true",l&&d&&(h["aria-describedby"]=d)),h},[]);return{announceToScreenReader:e,focusManagement:t,keyboardNavigation:r,generateId:a,prefersReducedMotion:i,getValidationAttributes:o}},fp=()=>{const[s,e]=y.useState([]),[t,r]=y.useState(()=>Og()),[a,i]=y.useState({}),[o,c]=y.useState({}),[l,d]=y.useState({}),[h,g]=y.useState(!1),[m,k]=y.useState(null),[S,T]=y.useState({stage:"idle",progress:0,message:""}),[N,z]=y.useState(null),[G,te]=y.useState(!1),[F,B]=y.useState(0),[v,x]=y.useState(null),[f,_]=y.useState({age:"",gender:"",race:"",ethnicity:"",language:"",weight:"",zipcode:"",sessionNotes:""}),[C,E]=y.useState(null),[L,re]=y.useState([]),[xe,nt]=y.useState(()=>_g()),[be,Ae]=y.useState(""),[V,ne]=y.useState(null),M=lt(),de=y.useRef(null),Be=y.useRef(null),{announceToScreenReader:X}=Cr(),Q=y.useCallback((p,A,R)=>{const j=Date.now().toString()+Math.random().toString(36).substr(2,9),H={id:j,type:p,title:A,message:R,timestamp:Date.now()};re(se=>[...se,H]),setTimeout(()=>{re(se=>se.filter(Te=>Te.id!==j))},p==="error"?8e3:5e3)},[]),vr=y.useCallback(p=>{re(A=>A.filter(R=>R.id!==p))},[]),Ct=y.useCallback(()=>{e([]),k(null),T({stage:"idle",progress:0,message:""}),z(null),c({}),i({}),E(null),te(!1),B(0),x(null),g(!1)},[]),Zt=y.useCallback(()=>{nt(p=>{const A=!p;if(Rg(A),ne(null),A)Ae(M),X("Switched to custom User ID mode");else{Ae("");const R=pi();X(`Switched to auto-generated mode. New User ID: ${R}`)}return A})},[M,X]),Zc=y.useCallback(p=>{Ae(p),ne(null)},[]),el=y.useCallback(()=>{const p=be.trim();if(!p){ne("User ID cannot be empty");return}if(p.length<3){ne("User ID must be at least 3 characters long");return}if(p.length>100){ne("User ID must be less than 100 characters");return}if(/[<>"/\\|?*\x00-\x1f]/.test(p)){ne('User ID contains invalid characters. Please avoid special characters like < > " / \\ | ? *');return}try{Eg(p),ne(null),X(`Custom User ID applied: ${p}`),window.location.reload()}catch(R){const j=R instanceof Error?R.message:"Failed to set User ID";ne(j)}},[be,X]),tl=y.useCallback(()=>{const p=pi();X(`New User ID generated: ${p}`),window.location.reload()},[X]),rl=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),ka=y.useCallback(p=>{const A=rl(),R=URL.createObjectURL(p),j={id:A,file:p,url:R};t?(e(U=>[...U,j]),d(U=>({...U,[A]:"ready"})),i(U=>({...U,[A]:{stage:"idle",progress:0,message:"Ready to process"}}))):k(j),X(`Audio file selected: ${p.name}`);const H=new Audio(R);H.addEventListener("loadedmetadata",()=>{t?e(U=>U.map(se=>se.id===A?{...se,duration:H.duration}:se)):k(U=>U?{...U,duration:H.duration}:null)})},[t,X]),nl=y.useCallback(p=>{t&&(e(A=>{const R=A.find(j=>j.id===p);return R&&URL.revokeObjectURL(R.url),A.filter(j=>j.id!==p)}),i(A=>{const{[p]:R,...j}=A;return j}),c(A=>{const{[p]:R,...j}=A;return j}),d(A=>{const{[p]:R,...j}=A;return j}))},[t]),Ar=y.useCallback(p=>{const A=p.target.files;!A||A.length===0||Array.from(A).forEach(R=>{const j=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],H=R.name.toLowerCase(),se=[".wav",".mp3",".m4a",".aac",".flac"].some(qe=>H.endsWith(qe));if(!j.includes(R.type)&&!se){E(`Unsupported file type for ${R.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),Q("error","Unsupported File",`${R.name} is not a supported audio file format`),X(`Error: Unsupported file format selected for ${R.name}`);return}const $e=50*1024*1024;if(R.size>$e){E(`File ${R.name} is too large. File size must be less than 50MB`),Q("error","File Too Large",`${R.name} size must be less than 50MB`),X(`Error: File ${R.name} is too large`);return}ka(R),E(null)})},[X,ka,Q]),sl=y.useCallback(p=>{p.preventDefault()},[]),al=y.useCallback(p=>{p.preventDefault();const A=p.dataTransfer.files;A.length>0&&Ar({target:{files:A}})},[Ar]),il=y.useCallback(()=>{r(p=>{const A=!p;return jg(A),Ct(),A})},[Ct]),ol=y.useCallback(()=>{de.current&&(G?(de.current.pause(),te(!1),X("Audio paused")):(de.current.play(),te(!0),X("Audio playing")))},[G,X]),cl=y.useCallback(()=>{de.current&&B(de.current.currentTime)},[]),Tr=y.useCallback(p=>{const A=Math.floor(p/60),R=Math.floor(p%60);return`${A}:${R.toString().padStart(2,"0")}`},[]),jt=y.useCallback(()=>{const p=[];if(f.age){const A=parseInt(f.age);(isNaN(A)||A<18||A>130)&&p.push("Age must be between 18 and 130")}if(f.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(f.gender)||p.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),f.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(f.race)||p.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),f.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(f.ethnicity)||p.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),f.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(f.zipcode)||p.push("Zipcode must be alphanumeric and contain no more than 10 characters")),f.weight){const A=parseInt(f.weight);(isNaN(A)||A<10||A>1e3)&&p.push("Weight must be between 10 and 1000 pounds (lbs)")}return p},[f]),Ir=y.useCallback(()=>{const p={};let A=!1;return f.age&&(p.age=parseInt(f.age),A=!0),f.gender&&(p.gender=f.gender,A=!0),f.race&&(p.race=f.race,A=!0),f.ethnicity&&(p.ethnicity=f.ethnicity,A=!0),(f.language==="true"||f.language==="false")&&(p.language=f.language==="true",A=!0),f.weight&&(p.weight=parseInt(f.weight),A=!0),f.zipcode&&(p.zipcode=f.zipcode,A=!0),A?p:void 0},[f]),ll=y.useCallback(async()=>{if(t){if(s.length===0||!M.trim()){E("Please select audio files. User ID is automatically generated."),Q("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await Ca()}else{if(!m||!M.trim()){E("Please select an audio file. User ID is automatically generated."),Q("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await hl()}},[m,s,M,t]),Sr=y.useCallback(async(p,A)=>{try{i(ae=>({...ae,[p]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const R=Ir(),j={userid:M.trim(),is_initiated:!0};R&&(j.metadata=R);const H=await ge.initiateSession(j),U={sessionId:H.sessionId,userId:M.trim()};i(ae=>({...ae,[p]:{stage:"initiating",progress:10,message:"Saving session data..."}}));const se={sessionId:H.sessionId,userId:M.trim(),userMetadata:R,audioFileName:A.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await ge.saveSessionData(se)}catch{}i(ae=>({...ae,[p]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const Te=await Fn(A.file,ae=>{i(q=>({...q,[p]:{stage:"converting",progress:15+ae*.25,message:`Converting audio... ${Math.round(ae)}%`}}))});i(ae=>({...ae,[p]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}}));const $e=`${M}_${U.sessionId}_${Date.now()}.wav`,qe=await Hn(Te,$e,ae=>{i(q=>({...q,[p]:{stage:"uploading",progress:40+ae*.25,message:`Uploading... ${Math.round(ae)}%`}}))});i(ae=>({...ae,[p]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const ae={...se,audioUrl:qe,audioFileName:$e,status:"processing",updatedAt:new Date().toISOString()};await ge.updateSessionData(U.sessionId,ae)}catch(ae){console.warn("Failed to update session data with audio info:",ae)}await ge.submitPrediction({userId:M.trim(),sessionid:U.sessionId,audioFileUrl:qe,audioFileName:$e}),i(ae=>({...ae,[p]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const Oe=new xi(U.sessionId);await new Promise((ae,q)=>{Oe.start(Y=>{const er=Y.status==="processing"?80:Y.status==="success"?95:70;i(st=>({...st,[p]:{stage:"analyzing",progress:er,message:`Analysis ${Y.status}...`}})),Y.predictError&&Q("error","Prediction Error",`${Y.predictError.error}: ${Y.predictError.message}`)},Y=>{if(Y.predictError){Q("error","Analysis Failed",`The analysis completed with an error: ${Y.predictError.error} - ${Y.predictError.message}`),i(st=>({...st,[p]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),q(new Error(`Prediction error: ${Y.predictError.error}`));return}const er={sessionId:U.sessionId,depressionScore:Y.predictedScoreDepression?parseFloat(Y.predictedScoreDepression):0,riskLevel:Y.predictedScoreDepression&&parseFloat(Y.predictedScoreDepression)>.7?"high":Y.predictedScoreDepression&&parseFloat(Y.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",Y.predictedScoreDepression?`Depression score: ${Y.predictedScoreDepression}`:"",Y.predictedScoreAnxiety?`Anxiety score: ${Y.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(st=>st.trim()!==""),timestamp:Y.updatedAt,audioUrl:qe,rawApiResponse:Y};i(st=>({...st,[p]:{stage:"complete",progress:100,message:"Analysis complete!"}})),c(st=>({...st,[p]:er})),ae()},Y=>{q(Y)})})}catch(R){console.error(`Error processing file ${p}:`,R);let j="UNKNOWN_ERROR",H="An unexpected error occurred",U={};R&&typeof R=="object"?("code"in R&&typeof R.code=="string"&&(j=R.code),"message"in R&&typeof R.message=="string"&&(H=R.message),"details"in R&&typeof R.details=="object"&&(U=R.details)):R instanceof Error&&(H=R.message,j=R.name||"ERROR");try{const se=a[p];if(se&&(se.stage==="uploading"||se.stage==="submitting"||se.stage==="analyzing")){const Te=`${M}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${Te}`)}}catch(se){console.warn("Error during cleanup attempt:",se)}throw i(se=>({...se,[p]:{stage:"error",progress:0,message:"Processing failed",error:{code:j,message:H,details:U}}})),R}},[M,Ir,ge,Hn,Fn,Q]),Ca=y.useCallback(async()=>{g(!0),E(null);const p=jt();if(p.length>0){E(`Validation error: ${p.join(", ")}`),Q("error","Validation Error",p.join(", ")),g(!1);return}const A=s.filter(H=>l[H.id]==="ready");if(A.length===0){Q("info","No Files Ready","No files are ready to process"),g(!1);return}const R=A.length;let j=0;try{for(const H of A){j++,Q("info","Processing File",`Processing ${H.file.name} (${j}/${R})`),d(U=>({...U,[H.id]:"processing"}));try{await Sr(H.id,H),d(U=>({...U,[H.id]:"complete"})),Q("success","File Complete",`${H.file.name} processed successfully`)}catch(U){let se="FILE_PROCESSING_ERROR",Te="An unexpected error occurred",$e={};U&&typeof U=="object"?("code"in U&&typeof U.code=="string"&&(se=U.code),"message"in U&&typeof U.message=="string"&&(Te=U.message),"details"in U&&typeof U.details=="object"&&($e=U.details)):U instanceof Error&&(Te=U.message,se=U.name||"ERROR"),Q("error","File Failed",`Failed to process ${H.file.name}: ${Te}`),d(qe=>({...qe,[H.id]:"error"})),i(qe=>({...qe,[H.id]:{stage:"error",progress:0,message:`Failed: ${Te}`,error:{code:se,message:Te,details:$e}}}))}}Q("success","Batch Complete",`Processed ${j} file${j!==1?"s":""}`),X(`Batch processing complete. ${j} files processed.`)}catch(H){const U=H instanceof Error?H.message:"An unexpected error occurred";E(U),Q("error","Batch Failed",U),X(`Error: ${U}`)}finally{g(!1)}},[s,l,jt,Q,X,Sr]),dl=y.useCallback(async p=>{const A=s.find(j=>j.id===p);if(!A)return;const R=jt();if(R.length>0){E(`Validation error: ${R.join(", ")}`),Q("error","Validation Error",R.join(", "));return}d(j=>({...j,[p]:"processing"}));try{await Sr(p,A),d(j=>({...j,[p]:"complete"})),Q("success","File Complete",`${A.file.name} processed successfully`)}catch(j){console.error(`Error processing ${A.file.name}:`,j);const H=j instanceof Error?j.message:"An unexpected error occurred";Q("error","File Failed",`Failed to process ${A.file.name}: ${H}`),d(U=>({...U,[p]:"error"})),i(U=>({...U,[p]:{stage:"error",progress:0,message:`Failed: ${H}`}}))}},[s,jt,Q,Sr]),hl=y.useCallback(async()=>{if(!m||!M.trim()){E("Please select an audio file. User ID is automatically generated."),Q("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const p=jt();if(p.length>0){E(`Validation error: ${p.join(", ")}`),Q("error","Validation Error",p.join(", "));return}try{E(null),T({stage:"initiating",progress:5,message:"Initiating session..."}),X("Starting analysis process - initiating session");const A=Ir(),R={userid:M.trim(),is_initiated:!0};A&&(R.metadata=A);const j=await ge.initiateSession(R),H={sessionId:j.sessionId,userId:M.trim()};T({stage:"initiating",progress:10,message:"Saving session data..."});const U={sessionId:j.sessionId,userId:M.trim(),userMetadata:A,audioFileName:m.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{await ge.saveSessionData(U)}catch{}T({stage:"converting",progress:15,message:"Converting audio to required format..."}),X("Session created successfully, now converting audio");const se=await Fn(m.file,Oe=>{T({stage:"converting",progress:15+Oe*.25,message:`Converting audio... ${Math.round(Oe)}%`})});T({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),X("Audio converted successfully, now uploading");const Te=`${M}_${H.sessionId}_${Date.now()}.wav`,$e=await Hn(se,Te,Oe=>{T({stage:"uploading",progress:40+Oe*.25,message:`Uploading... ${Math.round(Oe)}%`})});T({stage:"submitting",progress:65,message:"Submitting for analysis..."}),X("Upload complete, submitting for behavioral health analysis");try{const Oe={...U,audioUrl:$e,audioFileName:Te,status:"processing",updatedAt:new Date().toISOString()};await ge.updateSessionData(H.sessionId,Oe)}catch(Oe){console.warn("Failed to update session data with audio info:",Oe)}await ge.submitPrediction({userId:M.trim(),sessionid:H.sessionId,audioFileUrl:$e,audioFileName:Te}),T({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),X("Prediction submitted, analysis in progress");const qe=new xi(H.sessionId);await new Promise((Oe,ae)=>{qe.start(q=>{const Y=q.status==="processing"?80:q.status==="success"?95:70;T({stage:"analyzing",progress:Y,message:`Analysis ${q.status}...`}),q.predictError&&Q("error","Prediction Error",`${q.predictError.error}: ${q.predictError.message}`)},q=>{if(q.predictError){Q("error","Analysis Failed",`The analysis completed with an error: ${q.predictError.error} - ${q.predictError.message}`),T({stage:"error",progress:0,message:"Analysis failed with errors"}),ae(new Error(`Prediction error: ${q.predictError.error}`));return}const Y={sessionId:H.sessionId,depressionScore:q.predictedScoreDepression?parseFloat(q.predictedScoreDepression):0,riskLevel:q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.7?"high":q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",q.predictedScoreDepression?`Depression score: ${q.predictedScoreDepression}`:"",q.predictedScoreAnxiety?`Anxiety score: ${q.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(er=>er.trim()!==""),timestamp:q.updatedAt,audioUrl:$e,rawApiResponse:q};T({stage:"complete",progress:100,message:"Analysis complete!"}),z(Y),Q("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),X("Behavioral health analysis completed successfully"),Oe()},q=>{Q("error","Analysis Error",q.message||"An unexpected error occurred during analysis."),ae(q)})})}catch(A){console.error("Processing error:",A);const R=A instanceof Error?A.message:"An unexpected error occurred";E(R),T({stage:"error",progress:0,message:"Processing failed"}),Q("error","Processing Failed",R),X(`Error: ${R}`)}},[m,M,X,jt,Ir]),va=y.useCallback(p=>{switch(p){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return n.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"flex justify-between items-center mb-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),n.jsxs("div",{className:"relative inline-flex items-center",children:[n.jsx("button",{type:"button",onClick:il,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${t?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${t?"single file":"multi-file"} mode`,children:n.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${t?"translate-x-9":"translate-x-1"}`,children:t?n.jsx(Um,{className:"h-3 w-3 text-blue-600"}):n.jsx(Mm,{className:"h-3 w-3 text-gray-600"})})}),n.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[n.jsx("span",{className:`text-sm font-medium ${t?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),n.jsx("span",{className:`text-sm font-medium ${t?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),n.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${t?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:t?n.jsxs(n.Fragment,{children:[n.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),n.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),n.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",t?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),n.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${t?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:t?n.jsxs(n.Fragment,{children:[n.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[n.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),n.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):n.jsxs(n.Fragment,{children:[n.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:n.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"md:col-span-2 lg:col-span-3 mb-4",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"User ID Management"}),n.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md border space-y-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current User ID:"}),n.jsx("code",{className:"text-sm font-mono text-gray-900 dark:text-gray-100 break-all block bg-white dark:bg-gray-800 p-2 rounded border",children:M})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Zt,className:"px-3 py-1 text-xs bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors","aria-describedby":"user-id-mode-help",children:xe?"Switch to Auto-Generated":"Use Custom User ID"}),!xe&&n.jsx("button",{type:"button",onClick:tl,className:"px-3 py-1 text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-800 transition-colors",title:"Generate a new random User ID",children:"Generate New ID"})]}),xe&&n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:be,onChange:p=>Zc(p.target.value),placeholder:"Enter custom User ID (any unique string)",className:"flex-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-describedby":"custom-user-id-help","aria-invalid":V?"true":"false"}),n.jsx("button",{type:"button",onClick:el,disabled:!be.trim(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Apply"})]}),V&&n.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",role:"alert",children:V}),n.jsx("p",{id:"custom-user-id-help",className:"text-xs text-gray-500 dark:text-gray-400",children:'Any unique string (3-100 characters). Examples: "patient-001", "john.doe@clinic", "study-participant-42"'})]}),n.jsx("p",{id:"user-id-mode-help",className:"text-xs text-gray-500 dark:text-gray-400",children:xe?"Custom mode: Use any unique identifier for tracking (e.g., patient ID, username, study code)":"Auto mode: System generates unique UUIDs automatically"})]})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age (Optional)"}),n.jsx("input",{type:"number",id:"age",value:f.age,onChange:p=>_(A=>({...A,age:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Age in years",min:"1",max:"150"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight (Optional)"}),n.jsx("input",{type:"number",id:"weight",value:f.weight,onChange:p=>_(A=>({...A,weight:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Weight in lbs",min:"1",max:"1000"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender (Optional)"}),n.jsxs("select",{id:"gender",value:f.gender,onChange:p=>_(A=>({...A,gender:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[n.jsx("option",{value:"",children:"Select gender"}),n.jsx("option",{value:"male",children:"Male"}),n.jsx("option",{value:"female",children:"Female"}),n.jsx("option",{value:"non-binary",children:"Non-binary"}),n.jsx("option",{value:"transgender female",children:"Transgender female"}),n.jsx("option",{value:"transgender male",children:"Transgender male"}),n.jsx("option",{value:"other",children:"Other"}),n.jsx("option",{value:"prefer",children:"Prefer"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race (Optional)"}),n.jsxs("select",{id:"race",value:f.race,onChange:p=>_(A=>({...A,race:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[n.jsx("option",{value:"",children:"Select race"}),n.jsx("option",{value:"white",children:"White"}),n.jsx("option",{value:"black or african-american",children:"Black or African-American"}),n.jsx("option",{value:"asian",children:"Asian"}),n.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),n.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),n.jsx("option",{value:"two or more races",children:"Two or more races"}),n.jsx("option",{value:"other",children:"Other"}),n.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity (Optional)"}),n.jsxs("select",{id:"ethnicity",value:f.ethnicity,onChange:p=>_(A=>({...A,ethnicity:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[n.jsx("option",{value:"",children:"Select ethnicity"}),n.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),n.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language (Optional)"}),n.jsxs("select",{id:"language",value:f.language,onChange:p=>_(A=>({...A,language:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[n.jsx("option",{value:"",children:"Select language"}),n.jsx("option",{value:"true",children:"English"}),n.jsx("option",{value:"false",children:"Other"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code (Optional)"}),n.jsx("input",{type:"text",id:"zipcode",value:f.zipcode,onChange:p=>_(A=>({...A,zipcode:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)"})]}),n.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[n.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes (Optional)"}),n.jsx("textarea",{id:"sessionNotes",value:f.sessionNotes,onChange:p=>_(A=>({...A,sessionNotes:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",rows:3,placeholder:"Additional notes about this session or patient context"})]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",t&&n.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!t&&!m||t&&s.length===0?n.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:sl,onDrop:al,children:[n.jsx(ip,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("button",{type:"button",onClick:()=>{var p;return(p=Be.current)==null?void 0:p.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[n.jsx(ki,{className:"h-4 w-4 mr-2"}),"Select Audio File",t?"s":""]}),n.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",t?"files":"file"," here"]})]}),n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",t&&n.jsx("br",{}),t&&"You can select multiple files at once"]}),n.jsx("input",{ref:Be,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ar,multiple:t,"aria-label":`Select audio file${t?"s":""} for analysis`})]}):n.jsxs("div",{className:"space-y-4",children:[!t&&m&&n.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(vi,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m.file.name}),n.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(m.file.size/1024/1024).toFixed(2)," MB",m.duration&&`  ${Tr(m.duration)}`]})]})]}),n.jsx("button",{type:"button",onClick:Ct,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:n.jsx(Dr,{className:"h-5 w-5"})})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("button",{type:"button",onClick:ol,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":G?"Pause audio":"Play audio",children:G?n.jsx(os,{className:"h-5 w-5","aria-hidden":"true"}):n.jsx(Ft,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),n.jsx("div",{className:"flex-1",children:m.duration&&n.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Tr(F)," / ",Tr(m.duration)]})})]}),m.duration&&n.jsx("div",{className:"audio-progress",children:n.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${F/m.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":F,"aria-valuemin":0,"aria-valuemax":m.duration})})]}),n.jsx("audio",{ref:de,src:m.url,onTimeUpdate:cl,onEnded:()=>te(!1),onPlay:()=>te(!0),onPause:()=>te(!1),className:"hidden"})]}),t&&s.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",s.length,")"]}),n.jsxs("button",{type:"button",onClick:()=>{var p;return(p=Be.current)==null?void 0:p.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[n.jsx(ki,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(p=>{const A=l[p.id]||"ready",R=a[p.id];return n.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[n.jsx(vi,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:p.file.name}),n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(p.file.size/1024/1024).toFixed(2)," MB",p.duration&&`  ${Tr(p.duration)}`]})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[A==="ready"&&n.jsxs("button",{type:"button",onClick:()=>dl(p.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${p.file.name}`,children:[n.jsx(Ft,{className:"h-3 w-3 mr-1"}),"Start"]}),A==="processing"&&n.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),A==="complete"&&n.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[n.jsx(ze,{className:"h-3 w-3 mr-1"}),"Complete"]}),A==="error"&&n.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[n.jsx(Dr,{className:"h-3 w-3 mr-1"}),"Error"]}),n.jsx("button",{type:"button",onClick:()=>nl(p.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${p.file.name}`,children:n.jsx(Kr,{className:"h-4 w-4"})})]})]}),R&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:R.message}),n.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(R.progress),"%"]})]}),n.jsx("div",{className:"processing-progress mt-1",children:n.jsx("div",{className:`processing-progress__fill progress-animated ${va(R.stage)}`,style:{width:`${R.progress}%`}})})]})]},p.id)})}),n.jsx("input",{ref:Be,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Ar,multiple:t,"aria-label":"Select additional audio files for analysis"})]})]})]}),C&&n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(We,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),n.jsx("span",{className:"text-red-700 dark:text-red-300",children:C})]})}),!t&&S.stage!=="idle"&&!N&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:S.message}),n.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(S.progress),"%"]})]}),n.jsx("div",{className:"processing-progress",children:n.jsx("div",{className:`processing-progress__fill progress-animated ${va(S.stage)}`,style:{width:`${S.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":S.progress,"aria-valuemin":0,"aria-valuemax":100})}),S.stage==="analyzing"&&n.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[n.jsx(zm,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),N&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[n.jsxs("div",{className:"flex items-center mb-4",children:[n.jsx(ze,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),N.rawApiResponse&&n.jsxs("div",{className:"mb-6",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.predicted_score_depression||"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.predicted_score_anxiety||"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),n.jsx("span",{className:`font-mono ${N.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:N.rawApiResponse.status||"N/A"})]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.model_category||"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.model_granularity||"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),n.jsx("span",{className:`font-mono ${N.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:N.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),N.rawApiResponse.actual_score&&n.jsxs("div",{children:[n.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[N.rawApiResponse.actual_score.depression_binary!==void 0&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.actual_score.depression_binary||"N/A"})]}),N.rawApiResponse.actual_score.anxiety_binary!==void 0&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:N.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),N.rawApiResponse.actual_score.phq_9&&N.rawApiResponse.actual_score.phq_9.length>0&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),n.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",N.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),N.rawApiResponse.actual_score.phq_2&&N.rawApiResponse.actual_score.phq_2.length>0&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),n.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",N.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),N.rawApiResponse.actual_score.gad_7&&N.rawApiResponse.actual_score.gad_7.length>0&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),n.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",N.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:N.rawApiResponse.created_at?new Date(N.rawApiResponse.created_at).toLocaleString():"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:N.rawApiResponse.updated_at?new Date(N.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:N.sessionId})]})})]}),N.rawApiResponse.predict_error&&n.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[n.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),n.jsxs("div",{className:"text-sm space-y-1",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),n.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:N.rawApiResponse.predict_error.error})]}),n.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[n.jsx("span",{className:"font-medium",children:"Message:"})," ",N.rawApiResponse.predict_error.message]})]})]}),n.jsxs("details",{className:"mt-4",children:[n.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),n.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:n.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(N.rawApiResponse,null,2)})})]})]})})]}),N.insights&&N.insights.length>0&&n.jsxs("div",{className:"mt-6",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),n.jsx("ul",{className:"space-y-1",children:N.insights.map((p,A)=>n.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[" ",p]},A))})]}),n.jsx("div",{className:"mt-6 flex space-x-3",children:n.jsx("button",{type:"button",onClick:Ct,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(t&&s.length>0||!t&&m)&&!N&&Object.keys(o).length===0&&S.stage==="idle"&&!h&&n.jsx("div",{className:"text-center",children:t?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:n.jsxs("button",{type:"button",onClick:Ca,disabled:s.length===0||!M.trim()||!s.some(p=>l[p.id]==="ready"),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[n.jsx(Ft,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",s.filter(p=>l[p.id]==="ready").length>0&&` (${s.filter(p=>l[p.id]==="ready").length})`]})}),n.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):n.jsxs("div",{children:[n.jsxs("button",{type:"button",onClick:ll,disabled:!m||!M.trim(),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[n.jsx(Ft,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),n.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),t&&Object.keys(o).length>0&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[n.jsxs("div",{className:"flex items-center mb-4",children:[n.jsx(ze,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(o).length," files)"]})]}),n.jsx("div",{className:"space-y-6",children:Object.entries(o).map(([p,A])=>{const R=s.find(H=>H.id===p),j=a[p];return n.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(R==null?void 0:R.file.name)||`File ${p}`}),n.jsxs("div",{className:"flex items-center space-x-2",children:[(j==null?void 0:j.stage)==="complete"&&n.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[n.jsx(ze,{className:"h-3 w-3 mr-1"}),"Complete"]}),(j==null?void 0:j.stage)==="error"&&n.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[n.jsx(Dr,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(j==null?void 0:j.stage)==="error"&&(j==null?void 0:j.error)&&n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(We,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),n.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:j.error.code})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),n.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:j.error.message})]})]}),j.error.details&&Object.keys(j.error.details).length>0&&n.jsxs("details",{className:"mt-3",children:[n.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),n.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:n.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(j.error.details,null,2)})})]})]})]})]})}),A.rawApiResponse&&n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:A.rawApiResponse.predicted_score_depression||"N/A"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:A.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),n.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:A.sessionId})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:A.rawApiResponse.status||"N/A"})]})]})}),n.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[n.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),n.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:n.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(A.rawApiResponse,null,2)})})]})]}),R&&n.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("button",{type:"button",onClick:()=>{const H=document.getElementById(`audio-${p}`);H.paused?(document.querySelectorAll("audio").forEach(U=>U.pause()),x(p),H.play()):(H.pause(),x(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":v===p?"Pause audio":"Play audio",children:v===p?n.jsx(os,{className:"h-4 w-4"}):n.jsx(Ft,{className:"h-4 w-4"})}),n.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[R.file.name,"  ",R.duration?`${Math.round(R.duration)}s`:"Duration unknown"]})]}),n.jsx("audio",{id:`audio-${p}`,src:R.url,onEnded:()=>x(null),className:"hidden"})]})]},p)})})]}),L.length>0&&n.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:L.map(p=>n.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${p.type==="error"?"border-red-500":p.type==="warning"?"border-yellow-500":p.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:n.jsxs("div",{className:"flex items-start",children:[n.jsxs("div",{className:"flex-shrink-0",children:[p.type==="error"&&n.jsx(We,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),p.type==="warning"&&n.jsx(We,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),p.type==="success"&&n.jsx(ze,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),p.type==="info"&&n.jsx(We,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),n.jsxs("div",{className:"ml-3 flex-1",children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:p.title}),n.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:p.message})]}),n.jsx("div",{className:"ml-4 flex-shrink-0",children:n.jsx("button",{type:"button",onClick:()=>vr(p.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:n.jsx(Dr,{className:"h-4 w-4"})})})]})},p.id))})]})},Lr={queued:{color:"yellow",icon:Pt,label:"Queued"},running:{color:"blue",icon:Pe,label:"Processing"},processing:{color:"blue",icon:Pe,label:"Processing"},succeeded:{color:"green",icon:ze,label:"Completed"},success:{color:"green",icon:ze,label:"Completed"},failed:{color:"red",icon:gn,label:"Failed"},error:{color:"red",icon:gn,label:"Error"}},Fr=s=>s?s.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"",Hr=s=>{if(!s)return 0;switch(s.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},yp=()=>{const[s,e]=y.useState([]),[t,r]=y.useState(!0),[a,i]=y.useState(null),[o,c]=y.useState(new Set),[l,d]=y.useState(!1),[h,g]=y.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:m}=Cr(),k=y.useCallback(async()=>{try{r(!0),i(null);const v=lt(),f=(await ge.getUserSessions(v)).sessions.map(_=>{var E;const C=_.prediction;return{..._,uploadedAt:_.createdAt,fileName:_.audioFileName||`Audio_${_.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:((E=_.analysisResults)==null?void 0:E.riskLevel)||"unknown",depressionScore:(C==null?void 0:C.predicted_score_depression)||(C==null?void 0:C.predictedScoreDepression)||void 0,anxietyScore:(C==null?void 0:C.predicted_score_anxiety)||(C==null?void 0:C.predictedScoreAnxiety)||void 0}});e(f),m(`${f.length} sessions loaded successfully`)}catch(v){const x=v;i(x),m(`Error loading sessions: ${x.message}`)}finally{r(!1)}},[m]);y.useEffect(()=>{k()},[k]);const S=y.useMemo(()=>{let v=s;if(h.search){const x=h.search.toLowerCase();v=v.filter(f=>{var _,C;return f.sessionId.toLowerCase().includes(x)||((_=f.fileName)==null?void 0:_.toLowerCase().includes(x))||((C=Lr[f.status])==null?void 0:C.label.toLowerCase().includes(x))})}if(h.status!=="all"&&(v=v.filter(x=>x.status===h.status)),h.dateRange!=="all"){const x=new Date,f=new Date;switch(h.dateRange){case"today":f.setHours(0,0,0,0);break;case"week":f.setDate(x.getDate()-7);break;case"month":f.setMonth(x.getMonth()-1);break;case"year":f.setFullYear(x.getFullYear()-1);break}v=v.filter(_=>new Date(_.uploadedAt)>=f)}return v.sort((x,f)=>{let _=0;switch(h.sortBy){case"date":_=new Date(x.uploadedAt).getTime()-new Date(f.uploadedAt).getTime();break;case"status":_=x.status.localeCompare(f.status);break;case"depressionScore":const C=Hr(x.depressionScore),E=Hr(f.depressionScore);_=C-E;break;case"anxietyScore":const L=Hr(x.anxietyScore),re=Hr(f.anxietyScore);_=L-re;break}return h.sortOrder==="desc"?-_:_}),v},[s,h]),T=y.useCallback((v,x)=>{g(f=>({...f,[v]:x})),m(`Filter ${v} changed to ${x}`)},[m]),N=y.useCallback(v=>{c(x=>{const f=new Set(x);return f.has(v)?(f.delete(v),m("Session deselected")):(f.add(v),m("Session selected")),f})},[m]),z=y.useCallback(()=>{o.size===S.length?(c(new Set),m("All sessions deselected")):(c(new Set(S.map(x=>x.sessionId))),m(`All ${S.length} sessions selected`))},[o.size,S,m]),G=y.useCallback(async v=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await ge.deleteSessionData(v),e(f=>f.filter(_=>_.sessionId!==v)),c(f=>{const _=new Set(f);return _.delete(v),_}),m("Session deleted successfully")}catch(f){const _=f;m(`Error deleting session: ${_.message}`),alert(`Failed to delete session: ${_.message}`)}},[m]),te=y.useCallback(async()=>{if(o.size===0||!window.confirm(`Are you sure you want to delete ${o.size} session(s)? This action cannot be undone.`))return;const x=Array.from(o);let f=0,_=[];for(const C of x)try{await ge.deleteSessionData(C),f++}catch(E){const L=E;_.push(C),console.error(`Failed to delete session ${C}:`,L.message)}if(f>0&&e(C=>C.filter(E=>!(o.has(E.sessionId)&&!_.includes(E.sessionId)))),c(new Set),_.length===0)m(`${f} sessions deleted successfully`);else{const C=`${f} sessions deleted successfully, ${_.length} failed`;m(C),alert(`${C}. Failed sessions: ${_.join(", ")}`)}},[o,m]),F=v=>{if(v===0)return"0 B";const x=1024,f=["B","KB","MB","GB"],_=Math.floor(Math.log(v)/Math.log(x));return`${parseFloat((v/Math.pow(x,_)).toFixed(1))} ${f[_]}`},B=({status:v})=>{const x=v.toLowerCase();let f=Lr[v];f||(x.includes("error")||x.includes("fail")?f=Lr.error:f=Lr.failed);const _=f.icon;return n.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":f.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":f.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${f.label}`,children:[n.jsx(_,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),f.label]})};return t?n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"flex items-center justify-center py-16",children:[n.jsx(Pe,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),n.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):a?n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(We,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),n.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:a.message}),n.jsx("button",{type:"button",onClick:k,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):n.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{type:"button",onClick:k,disabled:t,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[n.jsx(Pe,{className:`w-4 h-4 mr-2 ${t?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),n.jsx(Se,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ym,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),n.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:h.search,onChange:v=>T("search",v.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),n.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),n.jsxs("button",{type:"button",onClick:()=>d(!l),className:"btn btn--secondary flex items-center","aria-expanded":l?"true":"false","aria-controls":"filter-panel","aria-label":`${l?"Hide":"Show"} filter options`,children:[n.jsx(Wc,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",l?n.jsx(Vc,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):n.jsx(qc,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),l&&n.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),n.jsxs("select",{id:"status-filter",value:h.status,onChange:v=>T("status",v.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"all",children:"All Statuses"}),n.jsx("option",{value:"queued",children:"Queued"}),n.jsx("option",{value:"processing",children:"Processing"}),n.jsx("option",{value:"running",children:"Running"}),n.jsx("option",{value:"succeeded",children:"Completed"}),n.jsx("option",{value:"success",children:"Success"}),n.jsx("option",{value:"failed",children:"Failed"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),n.jsxs("select",{id:"date-filter",value:h.dateRange,onChange:v=>T("dateRange",v.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"all",children:"All Time"}),n.jsx("option",{value:"today",children:"Today"}),n.jsx("option",{value:"week",children:"Past Week"}),n.jsx("option",{value:"month",children:"Past Month"}),n.jsx("option",{value:"year",children:"Past Year"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),n.jsxs("select",{id:"sort-by",value:h.sortBy,onChange:v=>T("sortBy",v.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"date",children:"Date"}),n.jsx("option",{value:"status",children:"Status"}),n.jsx("option",{value:"depressionScore",children:"Depression Score"}),n.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),n.jsxs("select",{id:"sort-order",value:h.sortOrder,onChange:v=>T("sortOrder",v.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"desc",children:"Newest First"}),n.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),S.length>0&&n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[n.jsx("div",{className:"flex items-center gap-4",children:n.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[S.length," of ",s.length," sessions",o.size>0&&`  ${o.size} selected`]})}),o.size>0&&n.jsx("div",{className:"flex items-center gap-2",children:n.jsxs("button",{type:"button",onClick:te,className:"btn btn--danger","aria-label":`Delete ${o.size} selected sessions`,children:[n.jsx(Kr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),S.length>0?n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[n.jsx("div",{className:"hidden md:block overflow-x-auto",children:n.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[n.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left",children:n.jsx("input",{type:"checkbox",checked:o.size===S.length,onChange:z,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:S.map(v=>n.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4",children:n.jsx("input",{type:"checkbox",checked:o.has(v.sessionId),onChange:()=>N(v.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${v.sessionId}`})}),n.jsx("td",{className:"px-6 py-4",children:n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:v.fileName}),n.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",v.sessionId.slice(-12)]}),n.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:F(v.fileSize||0)})]})}),n.jsx("td",{className:"px-6 py-4",children:n.jsx(B,{status:v.status})}),n.jsx("td",{className:"px-6 py-4",children:n.jsx("div",{className:"text-sm",children:v.depressionScore?n.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Fr(v.depressionScore)}):n.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),n.jsx("td",{className:"px-6 py-4",children:n.jsx("div",{className:"text-sm",children:v.anxietyScore?n.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Fr(v.anxietyScore)}):n.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:""})})}),n.jsxs("td",{className:"px-6 py-4",children:[n.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:xr(v.uploadedAt)}),n.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:zt(v.uploadedAt)})]}),n.jsx("td",{className:"px-6 py-4 text-right",children:n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx(Se,{to:`/sessions/${v.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${v.sessionId}`,children:n.jsx(br,{className:"w-4 h-4","aria-hidden":"true"})}),v.status==="succeeded"&&n.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${v.sessionId}`,children:n.jsx(mn,{className:"w-4 h-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:()=>G(v.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${v.sessionId}`,children:n.jsx(Kr,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},v.sessionId))})]})}),n.jsx("div",{className:"md:hidden space-y-4 p-4",children:S.map(v=>n.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("input",{type:"checkbox",checked:o.has(v.sessionId),onChange:()=>N(v.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${v.sessionId}`}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:v.fileName}),n.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",v.sessionId.slice(-12)]})]})]}),n.jsx(B,{status:v.status})]}),(v.depressionScore||v.anxietyScore)&&n.jsxs("div",{className:"text-sm",children:[v.depressionScore&&n.jsxs("div",{children:["Depression: ",Fr(v.depressionScore)]}),v.anxietyScore&&n.jsxs("div",{children:["Anxiety: ",Fr(v.anxietyScore)]})]}),n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[n.jsx("span",{children:xr(v.uploadedAt)}),n.jsx("span",{children:F(v.fileSize||0)})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[n.jsxs(Se,{to:`/sessions/${v.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${v.sessionId}`,children:[n.jsx(br,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),v.status==="succeeded"&&n.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${v.sessionId}`,children:[n.jsx(mn,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),n.jsxs("button",{type:"button",onClick:()=>G(v.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${v.sessionId}`,children:[n.jsx(Kr,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},v.sessionId))})]}):n.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[n.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),s.length===0?n.jsx(Se,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):n.jsx("button",{type:"button",onClick:()=>g({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},xp={low:{color:"green",label:"Low Risk",icon:ze,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:Yc,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:cs,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:cs,description:"Urgent intervention required"}},bp=({sessionId:s,existingAssessment:e,onAssessmentUpdated:t})=>{const{announceToScreenReader:r}=Cr(),[a,i]=y.useState(e||null),[o,c]=y.useState(!1),[l,d]=y.useState(!1),[h,g]=y.useState(null),m=y.useCallback(async()=>{try{c(!0),g(null),r("Generating AI risk assessment...");const T=await ge.generateRiskAssessment(s);if(T.success&&T.riskAssessment)i(T.riskAssessment),t==null||t(T.riskAssessment),r("Risk assessment generated successfully");else throw new Error(T.message||"Failed to generate risk assessment")}catch(T){const N=T;g(N),r(`Error generating assessment: ${N.message}`)}finally{c(!1)}},[s,t,r]),k=y.useCallback(async()=>{try{d(!0),g(null);const T=await ge.getRiskAssessment(s);T.success&&T.riskAssessment&&(i(T.riskAssessment),t==null||t(T.riskAssessment))}catch(T){g(T)}finally{d(!1)}},[s,t]),S=({riskLevel:T,riskScore:N})=>{const z=xp[T.toLowerCase()];if(!z)return null;const G=z.icon;return n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${z.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":z.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${z.label}`,children:[n.jsx(G,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),z.label,N&&n.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[N,"/10"]})]}),n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:z.description})]})};return!a&&!o&&!l?n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(mt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),n.jsxs("div",{className:"text-center py-8",children:[n.jsx(mt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{type:"button",onClick:m,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[n.jsx(mt,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),n.jsxs("button",{type:"button",onClick:k,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[n.jsx(Pe,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),h&&n.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:n.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]})]}):o||l?n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(mt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),n.jsxs("div",{className:"flex items-center justify-center py-16",children:[n.jsx(Pe,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),n.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:o?"Generating AI risk assessment...":"Loading assessment..."})]}),o&&n.jsx("div",{className:"mt-4 text-center",children:n.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):a?n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[n.jsx(mt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),n.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:n.jsxs("button",{type:"button",onClick:m,disabled:o,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[n.jsx(Pe,{className:`w-3 h-3 mr-1 ${o?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),n.jsx(S,{riskLevel:a.overallRiskLevel,riskScore:a.riskScore})]}),a.generatedAt&&n.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[n.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[n.jsx(Gc,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:zt(a.generatedAt)})]})]}),a.summary&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx(Om,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),n.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:n.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:a.summary})})]}),a.keyFactors&&a.keyFactors.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx(Yc,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),n.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:n.jsx("ul",{className:"space-y-2",children:a.keyFactors.map((T,N)=>n.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[n.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},N))})})]}),a.recommendations&&a.recommendations.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx($m,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),n.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:n.jsx("ul",{className:"space-y-2",children:a.recommendations.map((T,N)=>n.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[n.jsx(ze,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},N))})})]}),a.immediateActions&&a.immediateActions.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx(Zm,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:n.jsx("ul",{className:"space-y-2",children:a.immediateActions.map((T,N)=>n.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[n.jsx(cs,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},N))})})]}),a.followUpRecommendations&&a.followUpRecommendations.length>0&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx(wa,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),n.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:n.jsx("ul",{className:"space-y-2",children:a.followUpRecommendations.map((T,N)=>n.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[n.jsx(Pt,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),T]},N))})})]}),n.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:n.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[n.jsx(Pt,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",zt(a.generatedAt),a.modelVersion&&n.jsxs("span",{className:"ml-4",children:["Model: ",a.modelVersion]})]})})]}),h&&n.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:n.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h.message})})]}):null},Bn={queued:{color:"yellow",icon:Pt,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Pt,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:Pe,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:Pe,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:ze,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:ze,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:gn,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:gn,label:"Error",description:"An error occurred during processing"}},wp=()=>{var v,x,f,_,C,E,L,re,xe,nt,be,Ae;const{sessionId:s}=yl(),e=Si(),{announceToScreenReader:t}=Cr(),[r,a]=y.useState(null),[i,o]=y.useState(!0),[c,l]=y.useState(null),[d,h]=y.useState(!1),[g,m]=y.useState(!1),[k,S]=y.useState(!1),T=y.useRef(null),N=y.useCallback(async()=>{if(s)try{o(!0),l(null);const V=await ge.getSessionData(s);a(V),t(`Session ${s} loaded successfully`)}catch(V){const ne=V;l(ne),t(`Error loading session: ${ne.message}`)}finally{o(!1)}},[s,t]),z=y.useCallback(async()=>{m(!0),await N(),m(!1),t("Session data refreshed")},[N,t]);y.useEffect(()=>{N()},[N]);const G=y.useCallback(()=>{h(V=>{const ne=!V;return t(`Raw JSON view ${ne?"enabled":"disabled"}`),ne})},[t]),te=y.useCallback(()=>{T.current&&(k?(T.current.pause(),S(!1),t("Audio paused")):(T.current.play().catch(()=>{t("Failed to play audio")}),S(!0),t("Audio playing")))},[k,t]),F=y.useCallback(()=>{if(!r)return;const V=JSON.stringify(r,null,2),ne=new Blob([V],{type:"application/json"}),M=URL.createObjectURL(ne),de=document.createElement("a");de.href=M,de.download=`session-${r.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(M),t("Session data download started")},[r,t]),B=({status:V})=>{const ne=V.toLowerCase();let M=Bn[V];M||(ne.includes("error")||ne.includes("fail")?M=Bn.error:M=Bn.failed);const de=M.icon;return n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${M.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":M.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":M.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${M.label}`,children:[n.jsx(de,{className:`w-4 h-4 mr-2 ${M.color==="blue"&&V==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),M.label]}),n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:M.description})]})};return i?n.jsx("div",{className:"max-w-6xl mx-auto p-6",children:n.jsxs("div",{className:"flex items-center justify-center py-16",children:[n.jsx(Pe,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),n.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):c?n.jsx("div",{className:"max-w-6xl mx-auto p-6",children:n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(We,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),n.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:c.message}),n.jsxs("div",{className:"mt-4 space-x-3",children:[n.jsx("button",{type:"button",onClick:N,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),n.jsx(Se,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):r?n.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("button",{type:"button",onClick:()=>e("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[n.jsx(mm,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),n.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",r.sessionId]})]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{type:"button",onClick:G,className:"btn btn--secondary","aria-label":`${d?"Hide":"Show"} raw JSON data`,children:[d?n.jsx(Nm,{className:"w-4 h-4 mr-2"}):n.jsx(br,{className:"w-4 h-4 mr-2"}),d?"Hide JSON":"Show JSON"]}),n.jsxs("button",{type:"button",onClick:z,disabled:g,className:"btn btn--secondary","aria-label":"Refresh session data",children:[n.jsx(Pe,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),n.jsxs("button",{type:"button",onClick:F,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[n.jsx(mn,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),d&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(is,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:n.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(r,null,2)})})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(is,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),n.jsx(B,{status:r.status})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n.jsx(Gc,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"text-gray-900 dark:text-white",children:xr(r.createdAt)}),n.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:zt(r.createdAt)})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n.jsx(Pt,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"text-gray-900 dark:text-white",children:xr(r.updatedAt)}),n.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:zt(r.updatedAt)})]})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n.jsx(Ci,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),n.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:r.userId})]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(Rm,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),n.jsxs("div",{className:"space-y-4",children:[r.audioFileName&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-medium",children:r.audioFileName})]}),r.audioUrl&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("button",{type:"button",onClick:te,className:"btn btn--secondary","aria-label":`${k?"Pause":"Play"} audio`,children:k?n.jsx(os,{className:"w-4 h-4"}):n.jsx(Ft,{className:"w-4 h-4"})}),n.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:k?"Playing audio...":"Audio playback available"})]}),n.jsx("audio",{ref:T,src:r.audioUrl,onPlay:()=>S(!0),onPause:()=>S(!1),onEnded:()=>S(!1),onError:()=>{S(!1),t("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),r.userMetadata&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(Ci,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.userMetadata.age&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),n.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.age," years"]})]}),r.userMetadata.gender&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.gender.replace(/[_-]/g," ")})]}),r.userMetadata.weight&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),n.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[r.userMetadata.weight," lbs"]})]}),r.userMetadata.race&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:r.userMetadata.race})]}),r.userMetadata.ethnicity&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.ethnicity})]}),r.userMetadata.zipcode&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:r.userMetadata.zipcode})]}),r.userMetadata.language!==void 0&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:r.userMetadata.language?"Yes":"No"})]}),r.userMetadata.sessionNotes&&n.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),n.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:r.userMetadata.sessionNotes})]})]})]}),(r.analysisResults||r.prediction)&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(un,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),n.jsxs("div",{className:"space-y-6",children:[(r.analysisResults||r.prediction)&&n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[n.jsx(mt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((v=r.analysisResults)==null?void 0:v.depressionScore)||((x=r.prediction)==null?void 0:x.predicted_score_depression))&&n.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),n.jsx(wa,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),n.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((_=(f=r.analysisResults)==null?void 0:f.depressionScore)==null?void 0:_.toFixed(2))||((C=r.prediction)!=null&&C.predicted_score_depression?r.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase()):"N/A")})]}),(((E=r.analysisResults)==null?void 0:E.anxietyScore)||((L=r.prediction)==null?void 0:L.predicted_score_anxiety))&&n.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),n.jsx(Qc,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),n.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((xe=(re=r.analysisResults)==null?void 0:re.anxietyScore)==null?void 0:xe.toFixed(2))||((nt=r.prediction)!=null&&nt.predicted_score_anxiety?r.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase()):"N/A")})]})]})]}),((be=r.analysisResults)==null?void 0:be.insights)&&r.analysisResults.insights.length>0&&n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),n.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:n.jsx("ul",{className:"space-y-2",children:r.analysisResults.insights.map((V,ne)=>n.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[n.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),V]},ne))})})]}),((Ae=r.analysisResults)==null?void 0:Ae.completedAt)&&n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center text-sm",children:[n.jsx(ze,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),n.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),n.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:zt(r.analysisResults.completedAt)})]})})]})]})]}),n.jsx(bp,{sessionId:r.sessionId,existingAssessment:r.riskAssessment||null,onAssessmentUpdated:V=>{a(ne=>ne?{...ne,riskAssessment:V}:null)}})]}):n.jsx("div",{className:"max-w-6xl mx-auto p-6",children:n.jsxs("div",{className:"text-center py-16",children:[n.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),n.jsx(Se,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},kp=()=>{const[s,e]=y.useState([]),[t,r]=y.useState(!0),[a,i]=y.useState(null),[o,c]=y.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[l,d]=y.useState(!1),{announceToScreenReader:h}=Cr(),g=Si(),m=y.useCallback(x=>{g(`/sessions/${x}`),h(`Navigating to session ${x} details`)},[g,h]),k=y.useCallback(async()=>{try{r(!0),i(null);const x=lt(),_=(await ge.getUserSessions(x)).sessions.filter(C=>C.analysisResults||C.prediction);e(_),h(`${_.length} prediction sessions loaded`)}catch(x){const f=x;i(f),h(`Error loading predictions: ${f.message}`)}finally{r(!1)}},[h]);y.useEffect(()=>{k()},[k]);const S=y.useMemo(()=>{if(o.dateRange==="all")return s;const x=new Date,f=new Date;switch(o.dateRange){case"week":f.setDate(x.getDate()-7);break;case"month":f.setMonth(x.getMonth()-1);break;case"quarter":f.setMonth(x.getMonth()-3);break;case"year":f.setFullYear(x.getFullYear()-1);break}return s.filter(_=>new Date(_.createdAt)>=f)},[s,o.dateRange]),T=y.useMemo(()=>S.map(x=>{var E,L;const f=re=>{if(!re)return null;switch(re.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},_=f((E=x.prediction)==null?void 0:E.predicted_score_depression),C=f((L=x.prediction)==null?void 0:L.predicted_score_anxiety);return{date:x.createdAt,depression:_,anxiety:C,overall:null,sessionId:x.sessionId}}).sort((x,f)=>new Date(x.date).getTime()-new Date(f.date).getTime()),[S]),N=y.useMemo(()=>{const x={depression:[],anxiety:[]},f=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],_=S.map(E=>{var L;return(L=E.prediction)==null?void 0:L.predicted_score_depression}).filter(E=>E!==void 0);f.forEach(E=>{const L=_.filter(xe=>xe===E.category).length,re=_.length>0?L/_.length*100:0;L>0&&x.depression.push({category:E.label,count:L,percentage:re,color:E.color})});const C=S.map(E=>{var L;return(L=E.prediction)==null?void 0:L.predicted_score_anxiety}).filter(E=>E!==void 0);return f.forEach(E=>{const L=C.filter(xe=>xe===E.category).length,re=C.length>0?L/C.length*100:0;L>0&&x.anxiety.push({category:E.label,count:L,percentage:re,color:E.color})}),x},[S]),z=y.useMemo(()=>{const x={},f=E=>{if(!E)return 0;switch(E.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},_=S.map(E=>{var L;return(L=E.prediction)==null?void 0:L.predicted_score_depression}).filter(E=>E!==void 0);if(_.length<2)x.depression={direction:"stable",change:0,period:"insufficient data"};else{const E=_.map(f),L=E.slice(0,Math.floor(E.length/2)),re=E.slice(Math.floor(E.length/2)),xe=L.reduce((Ae,V)=>Ae+V,0)/L.length,be=re.reduce((Ae,V)=>Ae+V,0)/re.length-xe;x.depression={direction:Math.abs(be)<.5?"stable":be<0?"improving":"worsening",change:Math.abs(be),period:`${S.length} sessions`}}const C=S.map(E=>{var L;return(L=E.prediction)==null?void 0:L.predicted_score_anxiety}).filter(E=>E!==void 0);if(C.length<2)x.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const E=C.map(f),L=E.slice(0,Math.floor(E.length/2)),re=E.slice(Math.floor(E.length/2)),xe=L.reduce((Ae,V)=>Ae+V,0)/L.length,be=re.reduce((Ae,V)=>Ae+V,0)/re.length-xe;x.anxiety={direction:Math.abs(be)<.5?"stable":be<0?"improving":"worsening",change:Math.abs(be),period:`${S.length} sessions`}}return x.overall={direction:"stable",change:0,period:"coming soon"},x},[S]),G=y.useMemo(()=>{const x={totalSessions:S.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(S.length===0)return x;const f=S.map(C=>{var E;return(E=C.prediction)==null?void 0:E.predictedScoreDepression}).filter(C=>C!==void 0),_=S.map(C=>{var E;return(E=C.prediction)==null?void 0:E.predictedScoreAnxiety}).filter(C=>C!==void 0);if(f.length>0){const C={};f.forEach(L=>{C[L]=(C[L]||0)+1});const E=Object.entries(C).sort(([,L],[,re])=>re-L)[0][0];x.avgDepression=C[E]}if(_.length>0){const C={};_.forEach(L=>{C[L]=(C[L]||0)+1});const E=Object.entries(C).sort(([,L],[,re])=>re-L)[0][0];x.avgAnxiety=C[E]}return x.latestSession=S.sort((C,E)=>new Date(E.createdAt).getTime()-new Date(C.createdAt).getTime())[0],x.improvementSessions=0,x},[S]),te=y.useCallback((x,f)=>{c(_=>({..._,[x]:f})),h(`Filter ${x} changed to ${f}`)},[h]),F=y.useCallback(()=>{const x=JSON.stringify(S,null,2),f=new Blob([x],{type:"application/json"}),_=URL.createObjectURL(f),C=document.createElement("a");C.href=_,C.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(_),h("Predictions data download started")},[S,h]),B=({trend:x,label:f})=>{const _=x.direction==="improving"?rp:x.direction==="worsening"?wa:un,C=x.direction==="improving"?"text-green-600 dark:text-green-400":x.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(_,{className:`w-4 h-4 ${C}`,"aria-hidden":"true"}),n.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:f}),n.jsxs("span",{className:`text-sm font-medium ${C} capitalize`,children:[x.direction,x.period==="insufficient data"?" (need more sessions)":x.period==="coming soon"?" (analysis coming soon)":` (${x.period})`]})]})},v=({data:x,type:f,onBarClick:_})=>{const C=x.map(M=>M[f]).filter(M=>M!==null);if(C.length===0)return n.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const E=Math.max(...C),L=Math.min(...C),re=E-L||1,xe=M=>{switch(M){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},nt=(M,de)=>{if(de==="depression")switch(M){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(de==="anxiety")switch(M){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(M){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},be=M=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(Be=>({...Be,color:nt(Be.score,M)})),Ae=new Set(C),ne=be(f).filter(M=>Ae.has(M.score));return n.jsxs("div",{children:[n.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:x.map((M,de)=>{const Be=M[f];if(Be===null)return null;const X=(Be-L)/re*100,Q=nt(Be,f),vr=xe(Be),Ct=new Date(M.date).toLocaleDateString();return n.jsx("div",{className:`flex-1 ${Q} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(X,8)}%`},onClick:()=>_(M.sessionId),role:"button",tabIndex:0,onKeyDown:Zt=>{(Zt.key==="Enter"||Zt.key===" ")&&(Zt.preventDefault(),_(M.sessionId))},"aria-label":`View session details for ${vr} score on ${Ct}`,children:n.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[n.jsx("div",{className:"font-medium",children:vr}),n.jsx("div",{className:"text-gray-300",children:Ct}),n.jsxs("div",{className:"text-gray-300",children:["Session: ",M.sessionId.slice(-8)]}),n.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),n.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},de)})}),ne.length>0&&n.jsx("div",{className:"px-4",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),ne.map(M=>n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("div",{className:`w-3 h-3 ${M.color} rounded`}),n.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:M.label})]},M.score))]})})]})};return t?n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"flex items-center justify-center py-16",children:[n.jsx(Pe,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),n.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):a?n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(We,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),n.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:a.message}),n.jsx("button",{type:"button",onClick:k,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):n.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("button",{type:"button",onClick:()=>d(!l),className:"btn btn--secondary","aria-expanded":l?"true":"false","aria-label":`${l?"Hide":"Show"} filter options`,children:[n.jsx(Wc,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",l?n.jsx(Vc,{className:"w-4 h-4 ml-2"}):n.jsx(qc,{className:"w-4 h-4 ml-2"})]}),n.jsxs("button",{type:"button",onClick:k,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[n.jsx(Pe,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),n.jsxs("button",{type:"button",onClick:F,className:"btn btn--primary",disabled:S.length===0,"aria-label":"Download predictions data",children:[n.jsx(mn,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),l&&n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),n.jsxs("select",{id:"date-range",value:o.dateRange,onChange:x=>te("dateRange",x.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"all",children:"All Time"}),n.jsx("option",{value:"week",children:"Past Week"}),n.jsx("option",{value:"month",children:"Past Month"}),n.jsx("option",{value:"quarter",children:"Past Quarter"}),n.jsx("option",{value:"year",children:"Past Year"})]})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),n.jsxs("select",{id:"score-type",value:o.scoreType,onChange:x=>te("scoreType",x.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[n.jsx("option",{value:"all",children:"All Scores"}),n.jsx("option",{value:"depression",children:"Depression"}),n.jsx("option",{value:"anxiety",children:"Anxiety"}),n.jsx("option",{value:"overall",children:"Overall"})]})]}),n.jsx("div",{className:"flex items-end",children:n.jsxs("label",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",checked:o.showTrends,onChange:x=>te("showTrends",x.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),n.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),S.length===0?n.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[n.jsx(mt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),n.jsx(Se,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(un,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),n.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:G.totalSessions})]})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(mt,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),n.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const x=S.map(C=>{var E;return(E=C.prediction)==null?void 0:E.predicted_score_depression}).filter(C=>C!==void 0);if(x.length===0)return"";const f={};return x.forEach(C=>{f[C]=(f[C]||0)+1}),Object.entries(f).sort(([,C],[,E])=>E-C)[0][0].replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())})()})]})]})}),n.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(Qc,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),n.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const x=S.map(C=>{var E;return(E=C.prediction)==null?void 0:E.predicted_score_anxiety}).filter(C=>C!==void 0);if(x.length===0)return"";const f={};return x.forEach(C=>{f[C]=(f[C]||0)+1}),Object.entries(f).sort(([,C],[,E])=>E-C)[0][0].replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())})()})]})]})})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(o.scoreType==="all"||o.scoreType==="depression")&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(wi,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),n.jsx(v,{data:T,type:"depression",onBarClick:m}),o.showTrends&&n.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:n.jsx(B,{trend:z.depression,label:"Trend:"})})]}),(o.scoreType==="all"||o.scoreType==="anxiety")&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(bm,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),n.jsx(v,{data:T,type:"anxiety",onBarClick:m}),o.showTrends&&n.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:n.jsx(B,{trend:z.anxiety,label:"Trend:"})})]})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(wi,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(N).map(([x,f])=>n.jsxs("div",{children:[n.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[x," Scores"]}),n.jsx("div",{className:"space-y-2",children:f.map(_=>n.jsx("div",{className:"flex items-center",children:n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:_.category}),n.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[_.count," (",_.percentage.toFixed(1),"%)"]})]}),n.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:n.jsx("div",{className:`h-2 rounded-full ${_.color} progress-dynamic progress-animated`,style:{"--progress-width":`${_.percentage}%`}})})]})},_.category))})]},x))})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[n.jsx(Pt,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),n.jsx(Se,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions "})]}),n.jsx("div",{className:"space-y-4",children:S.slice(0,5).map(x=>{var f,_;return n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:`w-2 h-2 rounded-full ${x.status==="succeeded"?"bg-green-500":x.status==="processing"?"bg-blue-500":x.status==="failed"?"bg-red-500":"bg-gray-500"}`}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:x.audioFileName||`Session ${x.sessionId.slice(-8)}`}),n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:xr(x.createdAt)})]})]})}),n.jsxs("div",{className:"flex items-center space-x-4",children:[((f=x.prediction)==null?void 0:f.predicted_score_depression)&&n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),n.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:x.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())})]}),((_=x.prediction)==null?void 0:_.predicted_score_anxiety)&&n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),n.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:x.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase())})]}),n.jsx(Se,{to:`/sessions/${x.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${x.sessionId}`,children:n.jsx(br,{className:"w-4 h-4","aria-hidden":"true"})})]})]},x.sessionId)})})]})]})]})},Cp=()=>{const{data:s,isLoading:e,error:t,refetch:r}=Xc(),{announce:a}=Kc();St.useEffect(()=>{a("System Health page loaded","polite")},[a]);const i=d=>{if(!d)return"Just now";try{const h=new Date(d);return isNaN(h.getTime())?"Just now":h.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},o=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},c=d=>{switch(d==null?void 0:d.toLowerCase()){case"healthy":return"";case"degraded":return"";case"unhealthy":return"";default:return""}},l=d=>{const h="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(d==null?void 0:d.toLowerCase()){case"healthy":return`${h} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${h} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${h} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${h} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return n.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),n.jsxs("button",{type:"button",onClick:()=>r(),disabled:e,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[n.jsx(Pe,{className:`w-4 h-4 ${e?"animate-spin":""}`}),n.jsx("span",{children:"Refresh"})]})]}),e&&n.jsx("div",{className:"flex items-center justify-center py-16",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(Pe,{className:"w-6 h-6 text-blue-600 animate-spin"}),n.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),t&&n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(We,{className:"w-6 h-6 text-red-500 mr-3"}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),n.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:t.message||"Unable to retrieve system health status"}),n.jsx("button",{type:"button",onClick:()=>r(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),s&&!e&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),n.jsxs("div",{className:l(s.status),children:[n.jsx("span",{className:"mr-1",children:c(s.status)}),s.status]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl mb-2",children:c(s.status)}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),n.jsx("div",{className:`font-medium ${o(s.status)}`,children:s.status})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl mb-2",children:""}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:s.totalDuration?`${s.totalDuration}ms`:"N/A"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl mb-2",children:""}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),n.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:i(s.timestamp)})]})]})]}),s.checks&&Object.keys(s.checks).length>0&&n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(un,{className:"w-5 h-5 mr-2"}),"Service Details"]}),n.jsx("div",{className:"space-y-4",children:Object.entries(s.checks).map(([d,h])=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("span",{className:"text-lg",children:c(h.status)}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.replace(/-/g," ")}),h.description&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.description})]})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[h.duration&&n.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[h.duration,"ms"]}),n.jsx("div",{className:l(h.status),children:h.status})]})]},d))})]}),n.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[n.jsx(is,{className:"w-5 h-5 mr-2"}),"System Information"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),n.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),n.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),n.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),n.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},vp=()=>n.jsxs("div",{className:"text-center py-16",children:[n.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),n.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),n.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),Ap=new ml({defaultOptions:{queries:{retry:(s,e)=>{if(e&&typeof e=="object"&&"code"in e){const t=e.code;if(t!=null&&t.startsWith("HTTP_4")&&t!=="HTTP_408")return!1}return s<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}}),Tp=new ya(Hg);function Ip(){return n.jsx(wg,{instance:Tp,children:n.jsxs(pl,{client:Ap,children:[n.jsx(Fg,{children:n.jsx(Vg,{children:n.jsx(tm,{children:n.jsx(xl,{children:n.jsx(im,{children:n.jsxs(bl,{children:[n.jsx(vt,{path:"/",element:n.jsx(Dt,{requireRoles:[le.ADMIN,le.CONTROL_PANEL],children:n.jsx(hp,{})})}),n.jsx(vt,{path:"/upload",element:n.jsx(Dt,{requireRoles:[le.ADMIN],children:n.jsx(fp,{})})}),n.jsx(vt,{path:"/sessions",element:n.jsx(Dt,{requireRoles:[le.ADMIN],children:n.jsx(yp,{})})}),n.jsx(vt,{path:"/sessions/:sessionId",element:n.jsx(Dt,{requireRoles:[le.ADMIN],children:n.jsx(wp,{})})}),n.jsx(vt,{path:"/predictions",element:n.jsx(Dt,{requireRoles:[le.ADMIN],children:n.jsx(kp,{})})}),n.jsx(vt,{path:"/health",element:n.jsx(Dt,{requireRoles:[le.ADMIN],children:n.jsx(Cp,{})})}),n.jsx(vt,{path:"*",element:n.jsx(vp,{})})]})})})})})}),!1]})})}const Ai=localStorage.getItem("bh_theme"),Sp=window.matchMedia("(prefers-color-scheme: dark)").matches,Np=Ai==="dark"||!Ai&&Sp;Np?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");$n.createRoot(document.getElementById("root")).render(n.jsx(St.StrictMode,{children:n.jsx(Ip,{})}));
//# sourceMappingURL=index-be755782.js.map
