var Et=Object.defineProperty;var Dt=(r,s,t)=>s in r?Et(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var G=(r,s,t)=>(Dt(r,typeof s!="symbol"?s+"":s,t),t);import{j as e,u as rt,Q as Mt,a as $t}from"./query-7a13343f.js";import{a as Ft,r as d,u as Ye,N as at,b as Ke,L as le,c as Pt,R as it,B as Tt,d as Lt,e as Ne}from"./vendor-b4aac61f.js";import{F as Ut,t as Bs,f as Ot}from"./ffmpeg-c0c62554.js";import{B as zt,e as Bt}from"./azure-e79d136e.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();var ys={},Hs=Ft;ys.createRoot=Hs.createRoot,ys.hydrateRoot=Hs.hydrateRoot;const Ht="modulepreload",qt=function(r){return"/"+r},qs={},Wt=function(s,t,a){if(!t||t.length===0)return s();const i=document.getElementsByTagName("link");return Promise.all(t.map(l=>{if(l=qt(l),l in qs)return;qs[l]=!0;const u=l.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!a)for(let g=i.length-1;g>=0;g--){const k=i[g];if(k.href===l&&(!u||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${m}`))return;const b=document.createElement("link");if(b.rel=u?"stylesheet":Ht,u||(b.as="script",b.crossOrigin=""),b.href=l,document.head.appendChild(b),u)return new Promise((g,k)=>{b.addEventListener("load",g),b.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${l}`)))})})).then(()=>s()).catch(l=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l})};let ss;const Vt=new Uint8Array(16);function Gt(){if(!ss&&(ss=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ss))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ss(Vt)}const de=[];for(let r=0;r<256;++r)de.push((r+256).toString(16).slice(1));function Yt(r,s=0){return de[r[s+0]]+de[r[s+1]]+de[r[s+2]]+de[r[s+3]]+"-"+de[r[s+4]]+de[r[s+5]]+"-"+de[r[s+6]]+de[r[s+7]]+"-"+de[r[s+8]]+de[r[s+9]]+"-"+de[r[s+10]]+de[r[s+11]]+de[r[s+12]]+de[r[s+13]]+de[r[s+14]]+de[r[s+15]]}const Kt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ws={randomUUID:Kt};function Jt(r,s,t){if(Ws.randomUUID&&!s&&!r)return Ws.randomUUID();r=r||{};const a=r.random||(r.rng||Gt)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,s){t=t||0;for(let i=0;i<16;++i)s[t+i]=a[i];return s}return Yt(a)}const Pe={api:{baseUrl:"https://cwbhieastus001.azurewebsites.net/api"},azure:{blobSasUrl:"https://aistgvi.blob.core.windows.net/?sv=2024-11-04&ss=bfqt&srt=sco&sp=rwdlacupiyx&se=2026-06-26T11:43:55Z&st=2025-09-06T03:28:55Z&spr=https&sig=jlfi75igY6qW805u%2FWErZpEu7AZSll5hJOdvSJU35%2Bo%3D",containerName:"audio-uploads"},polling:{intervalMs:parseInt("3000",10),maxAttempts:60,backoffFactor:1.2},features:{enableFFmpegWorker:!0,enableDebugLogging:!1},audio:{acceptedFormats:[".wav",".mp3",".m4a",".aac",".flac"],maxFileSizeMB:100,targetSampleRate:44100,targetChannels:1}},Le={USER_ID:"bh_user_id",THEME:"bh_theme",UPLOAD_SESSIONS:"bh_upload_sessions",PROCESSING_MODE:"bh_processing_mode",USER_ID_CUSTOM:"bh_user_id_custom"},ze={HEALTH:"/health",SESSIONS_INITIATE:"/sessions/initiate",PREDICTIONS_SUBMIT:"/predictions/submit",PREDICTIONS_BY_USER:"/predictions",PREDICTIONS_BY_SESSION:"/predictions/sessions"},Be={SKIP_TO_CONTENT_ID:"main-content",ANNOUNCEMENTS_ID:"a11y-announcements",FOCUS_TIMEOUT:100,DEBOUNCE_MS:300},Se=()=>{let r=localStorage.getItem(Le.USER_ID);return(!r||r.trim().length===0)&&(r=Jt(),localStorage.setItem(Le.USER_ID,r)),r},Qt=()=>{const r=localStorage.getItem(Le.THEME);return r==="light"||r==="dark"?r:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},Vs=r=>{localStorage.setItem(Le.THEME,r),r==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},Zt=()=>{const r=localStorage.getItem(Le.PROCESSING_MODE);return r==="true"||r==="false"?r==="true":!1},Xt=r=>{localStorage.setItem(Le.PROCESSING_MODE,r.toString())},He=r=>{const s=new Date,t=new Date(r),a=s.getTime()-t.getTime(),i=Math.floor(a/(1e3*60)),l=Math.floor(a/(1e3*60*60)),u=Math.floor(a/(1e3*60*60*24));return i<1?"Just now":i<60?`${i}m ago`:l<24?`${l}h ago`:u<7?`${u}d ago`:t.toLocaleDateString()},Te=r=>new Date(r).toLocaleString(),pe=(r,s,t)=>({code:r,message:s,details:t,timestamp:new Date().toISOString()}),er=r=>r instanceof TypeError&&r.message.includes("fetch")?!0:r instanceof Error?r.message.includes("Network")||r.message.includes("connection")||r.message.includes("timeout"):!1,sr=(r,s="polite")=>{const t=document.createElement("div");t.setAttribute("aria-live",s),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=r,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)},tr=(r,s=100)=>{setTimeout(()=>{const t=document.getElementById(r);t&&t.focus()},s)},nt=d.createContext(void 0),rr=()=>{const r=d.useContext(nt);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},ar=({children:r})=>{const[s,t]=d.useState(Qt),a=u=>{t(u),Vs(u)},i=()=>{a(s==="light"?"dark":"light")};d.useEffect(()=>{Vs(s)},[s]),d.useEffect(()=>{const u=window.matchMedia("(prefers-color-scheme: dark)"),m=y=>{localStorage.getItem("bh_theme")||t(y.matches?"dark":"light")};return u.addEventListener("change",m),()=>u.removeEventListener("change",m)},[]);const l={theme:s,toggleTheme:i,setTheme:a};return e.jsx(nt.Provider,{value:l,children:r})};/*! @azure/msal-common v15.12.0 2025-08-19 */const he={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"};/*! @azure/msal-common v15.12.0 2025-08-19 */class Ns extends Error{constructor(s,t,a){const i=t?`${s}: ${t}`:s;super(i),Object.setPrototypeOf(this,Ns.prototype),this.errorCode=s||he.EMPTY_STRING,this.errorMessage=t||he.EMPTY_STRING,this.subError=a||he.EMPTY_STRING,this.name="AuthError"}setCorrelationId(s){this.correlationId=s}}/*! @azure/msal-common v15.12.0 2025-08-19 */var xe;(function(r){r[r.Error=0]="Error",r[r.Warning=1]="Warning",r[r.Info=2]="Info",r[r.Verbose=3]="Verbose",r[r.Trace=4]="Trace"})(xe||(xe={}));class os{constructor(s,t,a){this.level=xe.Info;const i=()=>{},l=s||os.createDefaultLoggerOptions();this.localCallback=l.loggerCallback||i,this.piiLoggingEnabled=l.piiLoggingEnabled||!1,this.level=typeof l.logLevel=="number"?l.logLevel:xe.Info,this.correlationId=l.correlationId||he.EMPTY_STRING,this.packageName=t||he.EMPTY_STRING,this.packageVersion=a||he.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:xe.Info}}clone(s,t,a){return new os({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:a||this.correlationId},s,t)}logMessage(s,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const l=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${xe[t.logLevel]} - ${s}`;this.executeCallback(t.logLevel,l,t.containsPii||!1)}executeCallback(s,t,a){this.localCallback&&this.localCallback(s,t,a)}error(s,t){this.logMessage(s,{logLevel:xe.Error,containsPii:!1,correlationId:t||he.EMPTY_STRING})}errorPii(s,t){this.logMessage(s,{logLevel:xe.Error,containsPii:!0,correlationId:t||he.EMPTY_STRING})}warning(s,t){this.logMessage(s,{logLevel:xe.Warning,containsPii:!1,correlationId:t||he.EMPTY_STRING})}warningPii(s,t){this.logMessage(s,{logLevel:xe.Warning,containsPii:!0,correlationId:t||he.EMPTY_STRING})}info(s,t){this.logMessage(s,{logLevel:xe.Info,containsPii:!1,correlationId:t||he.EMPTY_STRING})}infoPii(s,t){this.logMessage(s,{logLevel:xe.Info,containsPii:!0,correlationId:t||he.EMPTY_STRING})}verbose(s,t){this.logMessage(s,{logLevel:xe.Verbose,containsPii:!1,correlationId:t||he.EMPTY_STRING})}verbosePii(s,t){this.logMessage(s,{logLevel:xe.Verbose,containsPii:!0,correlationId:t||he.EMPTY_STRING})}trace(s,t){this.logMessage(s,{logLevel:xe.Trace,containsPii:!1,correlationId:t||he.EMPTY_STRING})}tracePii(s,t){this.logMessage(s,{logLevel:xe.Trace,containsPii:!0,correlationId:t||he.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-browser v4.23.0 2025-09-17 */var Gs;(function(r){r.Redirect="redirect",r.Popup="popup",r.Silent="silent",r.None="none"})(Gs||(Gs={}));const ir={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"};/*! @azure/msal-browser v4.23.0 2025-09-17 */const nr="storage_not_supported",oe="stubbed_public_client_application_called",or="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.23.0 2025-09-17 */const lr={[nr]:"Given storage configuration option was not supported.",[oe]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[or]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class ks extends Ns{constructor(s,t){super(s,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,ks.prototype)}}function ce(r){return new ks(r,lr[r])}/*! @azure/msal-browser v4.23.0 2025-09-17 */const cr={initialize:()=>Promise.reject(ce(oe)),acquireTokenPopup:()=>Promise.reject(ce(oe)),acquireTokenRedirect:()=>Promise.reject(ce(oe)),acquireTokenSilent:()=>Promise.reject(ce(oe)),acquireTokenByCode:()=>Promise.reject(ce(oe)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(ce(oe)),loginPopup:()=>Promise.reject(ce(oe)),loginRedirect:()=>Promise.reject(ce(oe)),logout:()=>Promise.reject(ce(oe)),logoutRedirect:()=>Promise.reject(ce(oe)),logoutPopup:()=>Promise.reject(ce(oe)),ssoSilent:()=>Promise.reject(ce(oe)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw ce(oe)},getLogger:()=>{throw ce(oe)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw ce(oe)},hydrateCache:()=>Promise.reject(ce(oe)),clearCache:()=>Promise.reject(ce(oe))};/*! @azure/msal-react v3.0.19 2025-08-19 */const dr={instance:cr,inProgress:ir.None,accounts:[],logger:new os({})},ot=d.createContext(dr);ot.Consumer;/*! @azure/msal-react v3.0.19 2025-08-19 */const ur=()=>d.useContext(ot),mr={scopes:["openid","profile","email","User.Read"],loginHint:"example@domain.com"},ae={ADMIN:"Admin",CONTROL_PANEL:"ControlPanel"},lt=d.createContext(void 0),_e=()=>{const r=d.useContext(lt);if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r},xr=({children:r})=>e.jsx(e.Fragment,{children:r}),hr=({children:r})=>null,gr={id:"mock-user-id",email:"anonymous@localhost",name:"Anonymous User",roles:["Admin"],primaryRole:"Admin",groups:[],preferredUsername:"anonymous"},pr=({children:r})=>{const s={user:gr,isAuthenticated:!0,isLoading:!1,error:null,login:async()=>{console.log("Mock login called - no action taken")},logout:async()=>{console.log("Mock logout called - no action taken")},clearError:()=>{console.log("Mock clearError called - no action taken")},hasRole:()=>!0,hasAnyRole:()=>!0,isAdmin:()=>!0,canAccessControlPanel:()=>!0};return e.jsx(lt.Provider,{value:s,children:r})};console.log("Authentication mode:","Mock authentication enabled");console.log("VITE_ENABLE_ENTRA_AUTH:","false");const yr=({children:r})=>e.jsx(pr,{children:r}),br=()=>{const{login:r,isLoading:s,error:t}=_e(),a=()=>{r().catch(console.error)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4 group cursor-pointer inline-block",children:e.jsx("span",{className:"group-hover:animate-brain-throb transition-transform duration-300",children:"ðŸ§ "})}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Please sign in to access the application"})]}),e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:t})}),e.jsx("button",{onClick:a,disabled:s,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"mr-2 h-4 w-4",viewBox:"0 0 21 21",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"1",y:"1",width:"9",height:"9",fill:"#f25022"}),e.jsx("rect",{x:"1",y:"11",width:"9",height:"9",fill:"#00a4ef"}),e.jsx("rect",{x:"11",y:"1",width:"9",height:"9",fill:"#7fba00"}),e.jsx("rect",{x:"11",y:"11",width:"9",height:"9",fill:"#ffb900"})]}),"Sign in with Microsoft"]})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Sign in using your organizational account"})})]})]})})},Ys=({children:r,fallback:s,redirectTo:t})=>{const a=Ye();return e.jsxs(e.Fragment,{children:[e.jsx(xr,{children:r}),e.jsx(hr,{children:s||(t?e.jsx(at,{to:t,state:{from:a},replace:!0}):e.jsx(br,{}))})]})},fr=({children:r,roles:s,requireAll:t=!1,fallback:a,redirectTo:i})=>{const{hasRole:l,hasAnyRole:u,user:m}=_e(),y=Ye();return(t?s.every(g=>l(g)):u(s))?e.jsx(e.Fragment,{children:r}):a?e.jsx(e.Fragment,{children:a}):i?e.jsx(at,{to:i,state:{from:y},replace:!0}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸš«"}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to access this resource."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["Required role",s.length>1?"s":"",": ",s.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Your role",m!=null&&m.roles.length&&m.roles.length>1?"s":"",": ",(m==null?void 0:m.roles.join(", "))||"None"]})]})]})})},we=({children:r,requireAuth:s=!0,requireRoles:t=[],requireAll:a=!1,fallback:i,redirectTo:l})=>!s&&t.length===0?e.jsx(e.Fragment,{children:r}):s&&t.length===0?e.jsx(Ys,{fallback:i,redirectTo:l,children:r}):e.jsx(Ys,{fallback:i,redirectTo:l,children:e.jsx(fr,{roles:t,requireAll:a,fallback:i,redirectTo:l,children:r})}),vr=()=>{const r=Ke(),s=Ye(),{user:t,isAuthenticated:a,isLoading:i,hasRole:l}=_e();return d.useEffect(()=>{if(i||!a||!t||s.pathname!=="/")return;let u="/";l(ae.CONTROL_PANEL)&&!l(ae.ADMIN)?u="/summary":(l(ae.ADMIN),u="/"),u!==s.pathname&&r(u,{replace:!0})},[t,a,i,s.pathname,r,l]),null};class jr{constructor(s,t){G(this,"msalInstance");G(this,"accounts");this.msalInstance=s,this.accounts=t}async getAuthHeaders(){if(!this.accounts||this.accounts.length===0)return{};try{return{Authorization:`Bearer ${(await this.msalInstance.acquireTokenSilent({...mr,account:this.accounts[0]})).accessToken}`,"X-User-ID":this.accounts[0].homeAccountId,"X-User-Principal":this.accounts[0].username}}catch(s){return console.warn("Failed to acquire access token silently:",s),{}}}getUserContext(){if(!this.accounts||this.accounts.length===0)return null;const s=this.accounts[0];return{userId:s.homeAccountId,username:s.username,name:s.name}}}const Nr=()=>{const{instance:r,accounts:s}=ur();return new jr(r,s)};class kr{constructor(s,t){G(this,"baseUrl");G(this,"authProvider");this.baseUrl=s,this.authProvider=t}setAuthProvider(s){this.authProvider=s}async handleResponse(s){if(!s.ok){const t=await s.json().catch(()=>({}));throw pe(`HTTP_${s.status}`,t.message||`HTTP ${s.status}: ${s.statusText}`,{status:s.status,statusText:s.statusText,data:t})}return s.json()}async request(s,t={}){try{const a=this.baseUrl.endsWith("/")?this.baseUrl.slice(0,-1):this.baseUrl,i=s.startsWith("/")?s:`/${s}`,l=`${a}${i}`,u={"Content-Type":"application/json",...t.headers};if(this.authProvider)try{const y=await this.authProvider.getAuthHeaders();Object.assign(u,y)}catch(y){console.warn("Failed to get authentication headers:",y)}const m=await fetch(l,{...t,headers:u});return this.handleResponse(m)}catch(a){throw er(a)?pe("NETWORK_ERROR","Unable to connect to the server. Please check your internet connection.",{originalError:a}):a instanceof Error&&"code"in a?a:pe("UNKNOWN_ERROR","An unexpected error occurred",{originalError:a})}}async get(s){return this.request(s,{method:"GET"})}async post(s,t){return this.request(s,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(s,t){return this.request(s,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(s){return this.request(s,{method:"DELETE"})}}const ge=new kr(Pe.api.baseUrl),wr=r=>{ge.setAuthProvider(r)},se={async checkHealth(){return ge.get(ze.HEALTH)},async initiateSession(r){return ge.post(ze.SESSIONS_INITIATE,r)},async submitPrediction(r){return ge.post(ze.PREDICTIONS_SUBMIT,r)},async getPredictionBySessionId(r){return ge.get(`${ze.PREDICTIONS_BY_SESSION}/${r}`)},async getUserPredictions(r){return ge.get(`${ze.PREDICTIONS_BY_USER}/${r}`)},async saveSessionData(r){return ge.post("sessions",r)},async getSessionData(r){return ge.get(`sessions/${r}`)},async getUserSessions(r){return ge.get(`sessions/users/${r}`)},async getAllSessions(){return ge.get("sessions/all")},async updateSessionData(r,s){return ge.put(`sessions/${r}`,s)},async deleteSessionData(r){return ge.delete(`sessions/${r}`)},async testConnection(){try{return await this.checkHealth(),{success:!0,message:"API connection successful"}}catch(r){return{success:!1,message:r.message||"Connection test failed"}}},async generateRiskAssessment(r){return ge.post(`sessions/${r}/risk-assessment`)},async getRiskAssessment(r){return ge.get(`sessions/${r}/risk-assessment`)},async correctGrammar(r){return ge.post("CorrectGrammar",{text:r})}};class Ks{constructor(s,t={}){G(this,"sessionId");G(this,"intervalMs");G(this,"maxAttempts");G(this,"backoffFactor");G(this,"currentAttempt",0);G(this,"timeoutId",null);G(this,"isPolling",!1);this.sessionId=s,this.intervalMs=t.intervalMs||Pe.polling.intervalMs,this.maxAttempts=t.maxAttempts||Pe.polling.maxAttempts,this.backoffFactor=t.backoffFactor||Pe.polling.backoffFactor}async start(s,t,a){if(this.isPolling)return;this.isPolling=!0,this.currentAttempt=0;const i=async()=>{try{const l=await se.getPredictionBySessionId(this.sessionId);if(s(l),l.status==="succeeded"||l.status==="success"||l.status==="failed"){this.stop(),t(l);return}if(this.currentAttempt++,this.currentAttempt>=this.maxAttempts){this.stop(),a(pe("POLLING_TIMEOUT","Prediction polling timed out. Please check the session manually.",{sessionId:this.sessionId,attempts:this.currentAttempt}));return}const u=this.intervalMs*Math.pow(this.backoffFactor,this.currentAttempt);this.timeoutId=window.setTimeout(i,u)}catch(l){this.stop(),a(l)}};await i()}stop(){this.isPolling=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}getStatus(){return{isPolling:this.isPolling,attempt:this.currentAttempt,maxAttempts:this.maxAttempts}}}const Sr=({children:r})=>{const s=Nr();return d.useEffect(()=>{wr(s)},[s]),e.jsx(e.Fragment,{children:r})},ct=()=>{const r=d.useCallback((a,i="polite")=>{sr(a,i)},[]),s=d.useCallback(a=>{r(a,"assertive")},[r]),t=d.useCallback(a=>{r(a,"polite")},[r]);return{announce:r,announceError:s,announceSuccess:t}},Ar=()=>{const r=d.useCallback(t=>{const a=i=>{i.key==="Escape"&&(i.preventDefault(),t())};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[]),s=d.useCallback(t=>a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t())},[]);return{handleEscape:r,handleEnterSpace:s}},Cr=()=>({skipToMain:d.useCallback(()=>{tr(Be.SKIP_TO_CONTENT_ID,Be.FOCUS_TIMEOUT)},[])}),_r=({className:r=""})=>{const{theme:s,toggleTheme:t}=rr(),{user:a,logout:i,isAuthenticated:l,isAdmin:u}=_e(),m=Ye(),{handleEnterSpace:y}=Ar(),[b,g]=d.useState(!1),[k,A]=d.useState(!1),L=!1,_=()=>[{path:"/",label:"Dashboard",icon:"ðŸ ",roles:[ae.ADMIN]},{path:"/upload",label:"Upload & Analyze",icon:"ðŸ“¤",roles:[ae.ADMIN]},{path:"/sessions",label:"Sessions",icon:"ðŸ“Š",roles:[ae.ADMIN]},{path:"/predictions",label:"My Predictions",icon:"ðŸ“ˆ",roles:[ae.ADMIN]}];d.useEffect(()=>{console.log("[Header] Authentication state:",{isAuthenticated:l,user:a?{id:a.id,name:a.name,roles:a.roles}:null,timestamp:new Date().toISOString()})},[l,a]);const M=_(),f=J=>J==="/"?m.pathname==="/":m.pathname.startsWith(J),P=()=>{g(!b)},$=()=>{g(!1)};return d.useEffect(()=>{g(!1),A(!1)},[m.pathname]),d.useEffect(()=>{const J=I=>{const v=I.target;k&&!v.closest("[data-user-menu]")&&A(!1)};return document.addEventListener("mousedown",J),()=>document.removeEventListener("mousedown",J)},[k]),e.jsx("header",{className:`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${r}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(le,{to:"/",className:"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group","aria-label":"Behavioral Health System - Go to Dashboard",children:[e.jsx("span",{className:"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105",role:"img","aria-label":"Brain icon",children:"ðŸ§ "}),e.jsx("span",{className:"hidden sm:block",children:"Behavioral Health System"}),e.jsx("span",{className:"sm:hidden",children:"BHS"})]})}),e.jsx("nav",{className:"hidden md:flex space-x-1",role:"navigation","aria-label":"Main navigation",children:M.map(({path:J,label:I,icon:v})=>e.jsxs(le,{to:J,className:`
                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                  ${f(J)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                `,"aria-current":f(J)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:v}),e.jsx("span",{children:I})]},J))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative","data-user-menu":!0,children:[e.jsxs("div",{className:`\r
                    flex items-center space-x-2 p-2 rounded-md text-gray-400 cursor-not-allowed opacity-50\r
                    dark:text-gray-500 transition-colors touch-target\r
                  `,"aria-label":"User authentication disabled",title:"Authentication is disabled",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-medium",children:"?"}),e.jsx("span",{className:"hidden sm:block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Auth Disabled"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),L]}),e.jsx("button",{onClick:t,onKeyDown:y(t),className:`\r
                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                transition-colors touch-target\r
              `,"aria-label":`Switch to ${s==="light"?"dark":"light"} mode`,type:"button",children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:s==="light"?"ðŸŒ™":"â˜€ï¸"})}),M.length>0&&e.jsx("button",{onClick:P,onKeyDown:y(P),className:`\r
                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r
                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r
                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r
                  transition-colors touch-target\r
                `,"aria-label":b?"Close mobile menu":"Open mobile menu",type:"button",...b?{"aria-expanded":!0}:{"aria-expanded":!1},children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:b?"âœ•":"â˜°"})})]})]}),b&&M.length>0&&e.jsx("div",{className:"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3",children:e.jsx("nav",{className:"space-y-1",role:"navigation","aria-label":"Mobile navigation",children:M.map(({path:J,label:I,icon:v})=>e.jsxs(le,{to:J,onClick:$,className:`
                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors
                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
                    ${f(J)?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700"}
                  `,"aria-current":f(J)?"page":void 0,children:[e.jsx("span",{role:"img","aria-hidden":"true",children:v}),e.jsx("span",{children:I})]},J))})})]})})},Ir=({size:r=20,className:s="",...t})=>e.jsxs("svg",{width:r,height:r,viewBox:"0 0 23 23",className:s,"aria-label":"Microsoft",...t,children:[e.jsx("rect",{x:"1",y:"1",width:"10",height:"10",fill:"#f25022"}),e.jsx("rect",{x:"12",y:"1",width:"10",height:"10",fill:"#7fba00"}),e.jsx("rect",{x:"1",y:"12",width:"10",height:"10",fill:"#00a4ef"}),e.jsx("rect",{x:"12",y:"12",width:"10",height:"10",fill:"#ffb900"})]}),Rr=({children:r,className:s=""})=>{const{skipToMain:t}=Cr();return e.jsxs("div",{className:"min-h-screen bg-background-light dark:bg-background-dark",children:[e.jsx("a",{href:`#${Be.SKIP_TO_CONTENT_ID}`,className:"skip-link",onClick:a=>{a.preventDefault(),t()},children:"Skip to main content"}),e.jsx(_r,{}),e.jsx("main",{id:Be.SKIP_TO_CONTENT_ID,className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${s}`,tabIndex:-1,children:r}),e.jsx("div",{id:Be.ANNOUNCEMENTS_ID,className:"sr-only","aria-live":"polite","aria-atomic":"true"}),e.jsx("footer",{className:"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ir,{size:24,className:"opacity-80"}),e.jsx("span",{className:"text-sm text-text-muted-light dark:text-text-muted-dark font-medium",children:"Powered by Microsoft"})]}),e.jsxs("div",{className:"text-center text-sm text-text-muted-light dark:text-text-muted-dark",children:[e.jsxs("p",{children:["Behavioral Health System Â© ",new Date().getFullYear()]}),e.jsx("p",{className:"mt-1",children:"WCAG 2.2 AA Compliant â€¢ Section 508 Compliant"})]})]})})})]})};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Dr=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,t,a)=>a?a.toUpperCase():t.toLowerCase()),Js=r=>{const s=Dr(r);return s.charAt(0).toUpperCase()+s.slice(1)},dt=(...r)=>r.filter((s,t,a)=>!!s&&s.trim()!==""&&a.indexOf(s)===t).join(" ").trim(),Mr=r=>{for(const s in r)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var $r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=d.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:i="",children:l,iconNode:u,...m},y)=>d.createElement("svg",{ref:y,...$r,width:s,height:s,stroke:r,strokeWidth:a?Number(t)*24/Number(s):t,className:dt("lucide",i),...!l&&!Mr(m)&&{"aria-hidden":"true"},...m},[...u.map(([b,g])=>d.createElement(b,g)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=(r,s)=>{const t=d.forwardRef(({className:a,...i},l)=>d.createElement(Fr,{ref:l,iconNode:s,className:dt(`lucide-${Er(Js(r))}`,`lucide-${r}`,a),...i}));return t.displayName=Js(r),t};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],qe=W("activity",Pr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Lr=W("arrow-left",Tr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Or=W("arrow-right",Ur);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Ce=W("brain",zr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ut=W("calendar",Br);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Qs=W("chart-column",Hr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Wr=W("chart-pie",qr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],mt=W("chevron-down",Vr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],xt=W("chevron-up",Gr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],ye=W("circle-alert",Yr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ue=W("circle-check-big",Kr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ls=W("circle-x",Jr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Re=W("clock",Qr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],cs=W("download",Zr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ea=W("eye-off",Xr);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],We=W("eye",sa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],ra=W("file-audio",ta);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ia=W("file-text",aa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],oa=W("file",na);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z",key:"1vo8kb"}],["path",{d:"M15 2v4a2 2 0 0 0 2 2h4",key:"sud9ri"}],["path",{d:"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1",key:"l4dndm"}]],ca=W("files",la);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ht=W("funnel",da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],gt=W("heart",ua);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ve=W("info",ma);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],ha=W("lightbulb",xa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Zs=W("loader-circle",ga);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ya=W("message-circle",pa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],bs=W("mic",ba);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],fs=W("pause",fa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ja=W("phone",va);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],$e=W("play",Na);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Xs=W("plus",ka);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],te=W("refresh-cw",wa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Aa=W("search",Sa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],pt=W("settings",Ca);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],vs=W("shield-alert",_a);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ra=W("target",Ia);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ns=W("trash-2",Ea);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],yt=W("trending-down",Da);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ds=W("trending-up",Ma);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ws=W("triangle-alert",$a);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Pa=W("upload",Fa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ta=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],us=W("user",Ta);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],bt=W("users",La);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ue=W("volume-2",Ua);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],za=W("volume-x",Oa);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Fe=W("x",Ba),ft={health:["health"],userPredictions:r=>["predictions","user",r],sessionPrediction:r=>["predictions","session",r],userSessions:r=>["sessions","user",r]},vt=()=>rt({queryKey:ft.health,queryFn:()=>se.checkHealth(),retry:2,staleTime:3e4,refetchOnWindowFocus:!1}),Ha=r=>{const s=r||Se();return rt({queryKey:ft.userSessions(s),queryFn:()=>se.getUserSessions(s),enabled:!!s,staleTime:3e4,refetchOnWindowFocus:!1})},qa=()=>{const{announce:r}=ct(),{canAccessControlPanel:s,user:t}=_e(),a=()=>(t==null?void 0:t.id)||Se(),{data:i,isLoading:l,error:u}=vt(),{data:m,isLoading:y}=Ha(a());d.useEffect(()=>{r("Dashboard page loaded","polite")},[r]);const b=[{title:"Upload & Analyze",description:"Upload audio files for behavioral health analysis",href:"/upload",icon:"ðŸ“¤",color:"primary",disabled:!1},{title:"View Sessions",description:"Browse all analysis sessions and their results",href:"/sessions",icon:"ðŸ“Š",color:"secondary",disabled:!1},{title:"My Predictions",description:"View your complete prediction history",href:"/predictions",icon:"ðŸ“ˆ",color:"accent",disabled:!1},{title:"Agent Experience",description:"Interactive chat with AI behavioral health agents",href:"/agent-experience",icon:"ðŸ¤–",color:"warning",disabled:!1},{title:"Speech Avatar Experience",description:"Real-time voice interaction with AI behavioral health agents using Azure Speech Avatar",href:"/speech-avatar-experience",icon:"ðŸŽ™ï¸",color:"accent",disabled:!1}],g=(k,A=!1)=>{const L=A?"block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60":"block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2";switch(k){case"primary":return`${L} border-primary-200 bg-primary-50 ${!A&&"hover:border-primary-300 hover:bg-primary-100"} dark:border-primary-800 dark:bg-primary-900 ${!A&&"dark:hover:border-primary-700 dark:hover:bg-primary-800"} focus:ring-primary-500`;case"secondary":return`${L} border-secondary-200 bg-secondary-50 ${!A&&"hover:border-secondary-300 hover:bg-secondary-100"} dark:border-secondary-800 dark:bg-secondary-900 ${!A&&"dark:hover:border-secondary-700 dark:hover:bg-secondary-800"} focus:ring-secondary-500`;case"accent":return`${L} border-accent-200 bg-accent-50 ${!A&&"hover:border-accent-300 hover:bg-accent-100"} dark:border-accent-800 dark:bg-accent-900 ${!A&&"dark:hover:border-accent-700 dark:hover:bg-accent-800"} focus:ring-accent-500`;case"warning":return`${L} border-warning-200 bg-warning-50 ${!A&&"hover:border-warning-300 hover:bg-warning-100"} dark:border-teal-600 dark:bg-teal-800 ${!A&&"dark:hover:border-teal-500 dark:hover:bg-teal-700"} focus:ring-warning-500`;default:return`${L} border-gray-200 bg-gray-50 ${!A&&"hover:border-gray-300 hover:bg-gray-100"} dark:border-gray-700 dark:bg-gray-800 ${!A&&"dark:hover:border-gray-600 dark:hover:bg-gray-700"} focus:ring-gray-500`}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark",children:"Behavioral Health System"}),e.jsx("p",{className:"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark",children:"Audio-based mental health prediction and analysis"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map(k=>k.disabled?e.jsxs("div",{className:`${g(k.color,!0)} relative`,"aria-label":`${k.title}: Coming Soon`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:k.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:k.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:k.description})]}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white font-bold text-sm mb-1",children:"ðŸš§"}),e.jsx("div",{className:"text-white font-semibold text-xs",children:"COMING SOON"})]})})]},k.href):e.jsx(le,{to:k.href,className:g(k.color,!1),"aria-label":`${k.title}: ${k.description}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",role:"img","aria-hidden":"true",children:k.icon}),e.jsx("h3",{className:"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1",children:k.title}),e.jsx("p",{className:"text-xs text-text-secondary-light dark:text-text-secondary-dark",children:k.description})]})},k.href))})]}),s()&&e.jsx("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Advanced analytics dashboard"})]}),e.jsx(le,{to:"/summary",className:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block",children:"View Summary"})]})}),e.jsxs("div",{className:"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4",children:"Recent Activity"}),y?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Loading recent sessions..."})]}):!(m!=null&&m.sessions)||m.sessions.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"No data",children:"ðŸ“­"}),e.jsxs("p",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:["No sessions yet.",e.jsx(le,{to:"/upload",className:"text-primary-600 dark:text-primary-400 hover:underline ml-1",children:"Upload your first audio file"})," to get started."]})]}):e.jsxs("div",{className:"space-y-3",children:[m.sessions.sort((k,A)=>new Date(A.createdAt).getTime()-new Date(k.createdAt).getTime()).slice(0,3).map(k=>{var A,L;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`status-${k.status||"completed"}`,children:k.status||"completed"}),e.jsx("span",{className:"text-text-primary-light dark:text-text-primary-dark",children:k.audioFileName||((A=k.sessionId)==null?void 0:A.slice(0,8))||"Unknown"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",title:k.createdAt,children:k.createdAt?new Date(k.createdAt).toLocaleString():""})]}),e.jsx(le,{to:`/sessions/${k.sessionId||""}`,className:"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1",title:"View session details","aria-label":`View details for session ${k.audioFileName||((L=k.sessionId)==null?void 0:L.slice(0,8))||"Unknown"}`,children:e.jsx(We,{className:"w-4 h-4","aria-hidden":"true"})})]},k.sessionId)}),m.sessions.length>3&&e.jsx("div",{className:"text-center pt-3",children:e.jsxs(le,{to:"/sessions",className:"text-primary-600 dark:text-primary-400 hover:underline",children:["View all ",m.sessions.length," sessions â†’"]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark",children:"System Status"}),e.jsx(le,{to:"/health",className:"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block",children:"System Health"})]}),l?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"spinner w-4 h-4"}),e.jsx("span",{className:"text-text-secondary-light dark:text-text-secondary-dark",children:"Checking system health..."})]}):u?e.jsxs("div",{className:"flex items-center space-x-2 text-error-600 dark:text-error-400",children:[e.jsx("span",{role:"img","aria-label":"Error",children:"âš ï¸"}),e.jsx("span",{children:"System health check failed"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-success-600 dark:text-success-400",children:[e.jsx("span",{role:"img","aria-label":"Healthy",children:"âœ…"}),e.jsx("span",{children:"All systems operational"}),(i==null?void 0:i.checks)&&e.jsxs("span",{className:"text-text-muted-light dark:text-text-muted-dark",children:["(",Object.keys(i.checks).length," services checked)"]})]})]})]})};class Wa{constructor(){G(this,"ffmpeg",null);G(this,"isLoaded",!1);G(this,"loadingPromise",null);this.ffmpeg=new Ut}async loadFFmpeg(){if(!this.isLoaded)return this.loadingPromise?this.loadingPromise:(this.loadingPromise=this.doLoadFFmpeg(),this.loadingPromise)}async doLoadFFmpeg(){if(!this.ffmpeg)throw pe("FFMPEG_INIT_ERROR","Failed to initialize FFmpeg");try{const s="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await this.ffmpeg.load({coreURL:await Bs(`${s}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Bs(`${s}/ffmpeg-core.wasm`,"application/wasm")}),this.isLoaded=!0}catch(s){throw this.loadingPromise=null,pe("FFMPEG_LOAD_ERROR","Failed to load FFmpeg. Please check your internet connection and try again.",{originalError:s})}}async convertAudio(s,t={outputFormat:"wav",sampleRate:44100,channels:1},a){try{if(a==null||a({stage:"loading",progress:0,message:"Loading audio processor..."}),await this.loadFFmpeg(),!this.ffmpeg)throw pe("FFMPEG_NOT_LOADED","FFmpeg not properly loaded");this.ffmpeg.on("progress",({progress:g})=>{a==null||a({stage:"converting",progress:Math.round(g*100),message:`Converting audio... ${Math.round(g*100)}%`})}),a==null||a({stage:"converting",progress:0,message:"Preparing audio file..."});const i="input."+this.getFileExtension(s.name);await this.ffmpeg.writeFile(i,await Ot(s));const l=`output.${t.outputFormat}`,u=["-i",i,"-ac",t.channels.toString(),"-ar",t.sampleRate.toString(),"-f",t.outputFormat,l];await this.ffmpeg.exec(u);const m=await this.ffmpeg.readFile(l),y=new Blob([m],{type:`audio/${t.outputFormat}`}),b=new File([y],`${this.getFileNameWithoutExtension(s.name)}.${t.outputFormat}`,{type:`audio/${t.outputFormat}`});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(l),a==null||a({stage:"completed",progress:100,message:"Audio conversion completed"}),b}catch(i){throw pe("AUDIO_CONVERSION_ERROR","Failed to convert audio file. Please try with a different file.",{originalError:i,fileName:s.name,fileSize:s.size,fileType:s.type})}}getFileExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.slice(t+1).toLowerCase():""}getFileNameWithoutExtension(s){const t=s.lastIndexOf(".");return t!==-1?s.slice(0,t):s}async isFormatSupported(s){try{await this.loadFFmpeg();const t=["wav","mp3","mp4","m4a","aac","flac","ogg"],a=this.getFileExtension(s.name);return t.includes(a)}catch{return!1}}dispose(){this.ffmpeg&&(this.ffmpeg.terminate(),this.ffmpeg=null),this.isLoaded=!1,this.loadingPromise=null}}let ms=null;const Va=()=>(ms||(ms=new Wa),ms),xs=async(r,s)=>{const a=await Va().convertAudio(r,{outputFormat:"wav",sampleRate:44100,channels:1},s?i=>s(i.progress):void 0);return new Blob([a],{type:"audio/wav"})};class Ga{constructor(s){G(this,"containerClient",null);G(this,"sasUrl");if(this.sasUrl=s||Pe.azure.blobSasUrl,!this.sasUrl)throw pe("AZURE_CONFIG_ERROR","Azure Blob Storage SAS URL not configured")}getContainerClient(){if(!this.containerClient)try{const s=new zt(this.sasUrl);this.containerClient=s.getContainerClient(Pe.azure.containerName)}catch(s){throw pe("AZURE_CLIENT_ERROR","Failed to initialize Azure Blob Storage client",{originalError:s})}return this.containerClient}async uploadFile(s,t,a,i){try{a==null||a({progress:0,stage:"preparing",message:"Preparing upload..."});const l=this.getContainerClient();let u;if(i){const b=i;if(t)u=`users/${b}/audio/${t}`;else{const g=new Date().toISOString().replace(/[:.]/g,"-"),k=Math.random().toString(36).substring(2,8),A=s.name.split(".").pop()||"wav";u=`users/${b}/audio/${g}-${k}.${A}`}}else u=t||this.generateBlobName(s.name);const m=l.getBlockBlobClient(u);a==null||a({progress:10,stage:"uploading",message:"Starting upload..."}),await m.uploadData(s,{blobHTTPHeaders:{blobContentType:s.type},onProgress:b=>{const g=b.loadedBytes&&s.size?Math.round(b.loadedBytes/s.size*90)+10:50;a==null||a({progress:g,stage:"uploading",message:`Uploading... ${g}%`})}});const y=m.url;return a==null||a({progress:100,stage:"completed",message:"Upload completed"}),{url:y,fileName:u,size:s.size}}catch(l){throw pe("UPLOAD_ERROR","Failed to upload file to Azure Blob Storage",{originalError:l,fileName:s.name,fileSize:s.size})}}generateBlobName(s,t){const a=t||Se(),i=new Date().toISOString().replace(/[:.]/g,"-"),l=Math.random().toString(36).substring(2,8),u=s.split(".").pop()||"wav";return`users/${a}/audio/${i}-${l}.${u}`}async testConnection(){try{return await this.getContainerClient().getProperties(),{success:!0,message:"Azure Blob Storage connection successful"}}catch{return{success:!1,message:"Failed to connect to Azure Blob Storage. Please check your SAS URL configuration."}}}async deleteFile(s){try{await this.getContainerClient().getBlockBlobClient(s).deleteIfExists()}catch(t){throw pe("DELETE_ERROR","Failed to delete file from Azure Blob Storage",{originalError:t,fileName:s})}}async listUserFiles(s){try{const t=s||Se(),a=this.getContainerClient(),i=`users/${t}/`,l=[];for await(const u of a.listBlobsFlat({prefix:i}))l.push(u.name);return l}catch(t){throw pe("LIST_ERROR","Failed to list user files from Azure Blob Storage",{originalError:t,userId:s})}}async deleteUserData(s){try{const t=s||Se(),a=await this.listUserFiles(t);let i=0;for(const l of a)await this.deleteFile(l),i++;return i}catch(t){throw pe("DELETE_USER_DATA_ERROR","Failed to delete user data from Azure Blob Storage",{originalError:t,userId:s})}}async getUserStorageUsage(s){try{const t=s||Se(),a=this.getContainerClient(),i=`users/${t}/`;let l=0,u=0;for await(const m of a.listBlobsFlat({prefix:i}))l++,u+=m.properties.contentLength||0;return{fileCount:l,totalSizeBytes:u}}catch(t){throw pe("STORAGE_USAGE_ERROR","Failed to get user storage usage from Azure Blob Storage",{originalError:t,userId:s})}}}let ts=null;const Ya=r=>((!ts||r&&r!==ts.sasUrl)&&(ts=new Ga(r)),ts),hs=async(r,s,t,a)=>{const i=Ya(),l=r instanceof File?r:new File([r],s,{type:r.type});return(await i.uploadFile(l,s,t?m=>t(m.progress):void 0,a)).url},Oe=()=>{const r=d.useRef(null),s=d.useCallback(m=>{if(!r.current){const y=document.createElement("div");y.setAttribute("aria-live","polite"),y.setAttribute("aria-atomic","true"),y.style.position="absolute",y.style.left="-10000px",y.style.width="1px",y.style.height="1px",y.style.overflow="hidden",document.body.appendChild(y),r.current=y}r.current.textContent="",setTimeout(()=>{r.current&&(r.current.textContent=m)},100)},[]),t={focusById:m=>{const y=document.getElementById(m);y&&y.focus()},focusFirstInContainer:m=>{const b=m.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')[0];b&&b.focus()},trapFocus:m=>{const y=m.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),b=y[0],g=y[y.length-1],k=A=>{A.key==="Tab"&&(A.shiftKey?document.activeElement===b&&(g.focus(),A.preventDefault()):document.activeElement===g&&(b.focus(),A.preventDefault()))};return m.addEventListener("keydown",k),()=>{m.removeEventListener("keydown",k)}}},a={handleArrowNavigation:(m,y,b,g)=>{var A;let k=b;switch(m.key){case"ArrowDown":m.preventDefault(),k=b<y.length-1?b+1:0;break;case"ArrowUp":m.preventDefault(),k=b>0?b-1:y.length-1;break;case"Home":m.preventDefault(),k=0;break;case"End":m.preventDefault(),k=y.length-1;break;default:return}g(k),(A=y[k])==null||A.focus()},handleEscape:(m,y)=>{m.key==="Escape"&&(m.preventDefault(),y())}},i=d.useCallback((m="element")=>`${m}-${Math.random().toString(36).substr(2,9)}`,[]),l=d.useCallback(()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),u=d.useCallback((m,y,b)=>{const g={};return m||(g["aria-invalid"]="true",y&&b&&(g["aria-describedby"]=b)),g},[]);return{announceToScreenReader:s,focusManagement:t,keyboardNavigation:a,generateId:i,prefersReducedMotion:l,getValidationAttributes:u}},Ka=()=>{var Es,Ds,Ms,$s,Fs,Ps,Ts,Ls,Us,Os,zs;const{user:r}=_e(),s=Ye(),[t,a]=d.useState([]),[i,l]=d.useState(()=>Zt()),[u,m]=d.useState({}),[y,b]=d.useState({}),[g,k]=d.useState({}),[A,L]=d.useState(!1),[_,M]=d.useState(null),[f,P]=d.useState({stage:"idle",progress:0,message:""}),[$,J]=d.useState(null),[I,v]=d.useState(!1),[E,Q]=d.useState(0),[C,j]=d.useState(null),n=s.state,[c,x]=d.useState({userId:"",age:((Ds=(Es=n==null?void 0:n.userMetadata)==null?void 0:Es.age)==null?void 0:Ds.toString())||"",gender:((Ms=n==null?void 0:n.userMetadata)==null?void 0:Ms.gender)||"",race:(($s=n==null?void 0:n.userMetadata)==null?void 0:$s.race)||"",ethnicity:((Fs=n==null?void 0:n.userMetadata)==null?void 0:Fs.ethnicity)||"",language:((Ts=(Ps=n==null?void 0:n.userMetadata)==null?void 0:Ps.language)==null?void 0:Ts.toString())||"",weight:((Us=(Ls=n==null?void 0:n.userMetadata)==null?void 0:Ls.weight)==null?void 0:Us.toString())||"",zipcode:((Os=n==null?void 0:n.userMetadata)==null?void 0:Os.zipcode)||"",sessionNotes:((zs=n==null?void 0:n.userMetadata)==null?void 0:zs.sessionNotes)||""}),[p,w]=d.useState(null),[R,B]=d.useState([]),[H,ie]=d.useState({}),[re,V]=d.useState(!1);d.useEffect(()=>{if(!c.userId){const o=`user-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;x(h=>({...h,userId:o}))}},[c.userId]);const X=d.useCallback(()=>(r==null?void 0:r.id)||Se(),[r==null?void 0:r.id]),N=d.useRef(null),Y=d.useRef(null),{announceToScreenReader:K}=Oe(),T=d.useCallback((o,h,S)=>{const D=Date.now().toString()+Math.random().toString(36).substr(2,9),O={id:D,type:o,title:h,message:S,timestamp:Date.now()};B(z=>[...z,O]),setTimeout(()=>{B(z=>z.filter(ee=>ee.id!==D))},o==="error"?8e3:5e3)},[]),me=d.useCallback(o=>{B(h=>h.filter(S=>S.id!==o))},[]);d.useEffect(()=>{if(n&&(T("info","Session Data Pre-filled",`Metadata and audio file from session ${n.originalSessionId?n.originalSessionId.slice(0,8)+"...":""} have been loaded. Click "Start Analysis" to begin processing.`),n.audioUrl&&n.audioFileName)){const o={name:n.audioFileName,size:0,type:"audio/wav",lastModified:Date.now(),stream:()=>new ReadableStream,arrayBuffer:()=>Promise.resolve(new ArrayBuffer(0)),text:()=>Promise.resolve(""),slice:()=>new Blob},h={id:`prefilled-${Date.now()}`,file:o,url:n.audioUrl,duration:void 0};i?a([h]):M(h)}},[n,T,i]);const ke=d.useCallback(()=>{a([]),M(null),P({stage:"idle",progress:0,message:""}),J(null),b({}),m({}),w(null),v(!1),Q(0),j(null),L(!1)},[]),Je=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),Ee=d.useCallback(o=>{const h=Je(),S=URL.createObjectURL(o),D={id:h,file:o,url:S};i?(a(F=>[...F,D]),k(F=>({...F,[h]:"ready"})),m(F=>({...F,[h]:{stage:"idle",progress:0,message:"Ready to process"}}))):M(D),K(`Audio file selected: ${o.name}`);const O=new Audio(S);O.addEventListener("loadedmetadata",()=>{i?a(F=>F.map(z=>z.id===h?{...z,duration:O.duration}:z)):M(F=>F?{...F,duration:O.duration}:null)})},[i,K]),jt=d.useCallback(o=>{i&&(a(h=>{const S=h.find(D=>D.id===o);return S&&URL.revokeObjectURL(S.url),h.filter(D=>D.id!==o)}),m(h=>{const{[o]:S,...D}=h;return D}),b(h=>{const{[o]:S,...D}=h;return D}),k(h=>{const{[o]:S,...D}=h;return D}))},[i]),Qe=d.useCallback(o=>{const h=o.target.files;!h||h.length===0||Array.from(h).forEach(S=>{const D=["audio/wav","audio/wave","audio/x-wav","audio/mp3","audio/mpeg","audio/mp4","audio/m4a","audio/x-m4a","audio/mp4a-latm","audio/aac","audio/x-aac","audio/flac","audio/x-flac"],O=S.name.toLowerCase(),z=[".wav",".mp3",".m4a",".aac",".flac"].some(ne=>O.endsWith(ne));if(!D.includes(S.type)&&!z){w(`Unsupported file type for ${S.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`),T("error","Unsupported File",`${S.name} is not a supported audio file format`),K(`Error: Unsupported file format selected for ${S.name}`);return}const fe=50*1024*1024;if(S.size>fe){w(`File ${S.name} is too large. File size must be less than 50MB`),T("error","File Too Large",`${S.name} size must be less than 50MB`),K(`Error: File ${S.name} is too large`);return}Ee(S),w(null)})},[K,Ee,T]),Nt=d.useCallback(o=>{o.preventDefault()},[]),kt=d.useCallback(o=>{o.preventDefault();const h=o.dataTransfer.files;h.length>0&&Qe({target:{files:h}})},[Qe]),wt=d.useCallback(()=>{l(o=>{const h=!o;return Xt(h),ke(),h})},[ke]),St=d.useCallback(()=>{N.current&&(I?(N.current.pause(),v(!1),K("Audio paused")):(N.current.play(),v(!0),K("Audio playing")))},[I,K]),At=d.useCallback(()=>{N.current&&Q(N.current.currentTime)},[]),Ze=d.useCallback(o=>{const h=Math.floor(o/60),S=Math.floor(o%60);return`${h}:${S.toString().padStart(2,"0")}`},[]),De=d.useCallback(()=>{const o=[];if(c.age){const h=parseInt(c.age);(isNaN(h)||h<18||h>130)&&o.push("Age must be between 18 and 130")}if(c.gender&&(["male","female","non-binary","transgender female","transgender male","other","prefer"].includes(c.gender)||o.push("Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer")),c.race&&(["white","black or african-american","asian","american indian or alaskan native","native Hawaiian or pacific islander","two or more races","other","prefer not to say"].includes(c.race)||o.push("Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say")),c.ethnicity&&(["Hispanic, Latino, or Spanish Origin","Not Hispanic, Latino, or Spanish Origin"].includes(c.ethnicity)||o.push("Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin")),c.zipcode&&(/^[a-zA-Z0-9]{1,10}$/.test(c.zipcode)||o.push("Zipcode must be alphanumeric and contain no more than 10 characters")),c.weight){const h=parseInt(c.weight);(isNaN(h)||h<10||h>1e3)&&o.push("Weight must be between 10 and 1000 pounds (lbs)")}return o},[c]),Ss=d.useCallback(o=>{if(!o)return;const h=parseInt(o);if(isNaN(h)||h<18||h>130)return"Age must be between 18 and 130"},[]),As=d.useCallback(o=>{if(!o)return;const h=parseInt(o);if(isNaN(h)||h<10||h>1e3)return"Weight must be between 10 and 1000 pounds (lbs)"},[]),Cs=d.useCallback(o=>{if(!o)return;if(!/^[a-zA-Z0-9]{1,10}$/.test(o))return"Zipcode must be alphanumeric and contain no more than 10 characters"},[]),_s=d.useCallback(o=>{if(o&&o.length>500)return"Session notes must be 500 characters or less"},[]),je=d.useCallback((o,h)=>{let S;switch(o){case"age":S=Ss(h);break;case"weight":S=As(h);break;case"zipcode":S=Cs(h);break;case"sessionNotes":S=_s(h);break;default:return}ie(D=>{const O={...D,[o]:S};return Object.values(O).some(z=>z!==void 0)?S===void 0&&w(z=>z&&z.toLowerCase().includes("validation")?null:z):w(null),O})},[Ss,As,Cs,_s]),Ct=d.useCallback(async()=>{if(c.sessionNotes.trim()){V(!0);try{const o=await se.correctGrammar(c.sessionNotes);x(h=>({...h,sessionNotes:o.correctedText})),T("success","Grammar Corrected","Grammar and spelling corrected successfully")}catch(o){console.error("Grammar correction failed:",o),T("error","Grammar Correction Failed",o.message||"Failed to correct grammar. Please try again.")}finally{V(!1)}}},[c.sessionNotes]),Xe=d.useCallback(()=>{const o={};let h=!1;return c.age&&(o.age=parseInt(c.age),h=!0),c.gender&&(o.gender=c.gender,h=!0),c.race&&(o.race=c.race,h=!0),c.ethnicity&&(o.ethnicity=c.ethnicity,h=!0),(c.language==="true"||c.language==="false")&&(o.language=c.language==="true",h=!0),c.weight&&(o.weight=parseInt(c.weight),h=!0),c.zipcode&&(o.zipcode=c.zipcode,h=!0),h?o:void 0},[c]),_t=d.useCallback(async()=>{if(i){if(t.length===0||!c.userId.trim()){w("Please select audio files. User ID is automatically generated."),T("error","Missing Information","Please select audio files. User ID is automatically generated.");return}await Is()}else{if(!_||!c.userId.trim()){w("Please select an audio file. User ID is automatically generated."),T("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}await Rt()}},[_,t,c.userId,i]),es=d.useCallback(async(o,h)=>{try{m(Z=>({...Z,[o]:{stage:"initiating",progress:5,message:"Initiating session..."}}));const S=Xe(),D={userid:c.userId.trim(),is_initiated:!0};S&&(D.metadata=S);const O=await se.initiateSession(D),F={sessionId:O.sessionId,userId:c.userId.trim()};m(Z=>({...Z,[o]:{stage:"initiating",progress:10,message:"Saving session data...",sessionId:O.sessionId}}));const z={sessionId:O.sessionId,userId:X(),metadata_user_id:c.userId.trim(),...S&&{userMetadata:S},audioFileName:h.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (multi-file):",z);const Z=await se.saveSessionData(z);console.log("Session data saved successfully (multi-file):",Z)}catch(Z){console.error("Failed to save session data (multi-file):",Z),console.error("Session data that failed to save:",z),T("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let ee,fe;if(h.url&&!h.url.startsWith("blob:"))m(Z=>({...Z,[o]:{stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}})),ee=h.url,fe=h.file.name,m(Z=>({...Z,[o]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));else{m(U=>({...U,[o]:{stage:"converting",progress:15,message:"Converting audio to required format..."}}));const Z=await xs(h.file,U=>{m(q=>({...q,[o]:{stage:"converting",progress:15+U*.25,message:`Converting audio... ${Math.round(U)}%`}}))});m(U=>({...U,[o]:{stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}})),fe=`${c.userId}_${F.sessionId}_${Date.now()}.wav`,ee=await hs(Z,fe,U=>{m(q=>({...q,[o]:{stage:"uploading",progress:40+U*.25,message:`Uploading... ${Math.round(U)}%`}}))},X())}m(Z=>({...Z,[o]:{stage:"submitting",progress:65,message:"Submitting for analysis..."}}));try{const Z={...z,audioUrl:ee,audioFileName:fe,status:"processing",updatedAt:new Date().toISOString()};await se.updateSessionData(F.sessionId,Z)}catch(Z){console.warn("Failed to update session data with audio info:",Z)}await se.submitPrediction({userId:c.userId.trim(),sessionid:F.sessionId,audioFileUrl:ee,audioFileName:fe}),m(Z=>({...Z,[o]:{stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}}));const ne=new Ks(F.sessionId);await new Promise((Z,U)=>{ne.start(q=>{const Me=q.status==="processing"?80:q.status==="success"?95:70;m(ve=>({...ve,[o]:{stage:"analyzing",progress:Me,message:`Analysis ${q.status}...`}})),q.predictError&&T("error","Prediction Error",`${q.predictError.error}: ${q.predictError.message}`)},q=>{if(q.predictError){T("error","Analysis Failed",`The analysis completed with an error: ${q.predictError.error} - ${q.predictError.message}`),m(be=>({...be,[o]:{stage:"error",progress:0,message:"Analysis failed with errors"}})),U(new Error(`Prediction error: ${q.predictError.error}`));return}const Me={sessionId:F.sessionId,depressionScore:q.predictedScoreDepression?parseFloat(q.predictedScoreDepression):0,riskLevel:q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.7?"high":q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",q.predictedScoreDepression?`Depression score: ${q.predictedScoreDepression}`:"",q.predictedScoreAnxiety?`Anxiety score: ${q.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(be=>be.trim()!==""),timestamp:q.updatedAt,audioUrl:ee,rawApiResponse:q},ve={...z,audioUrl:ee,prediction:q,analysisResults:{depressionScore:q.predictedScoreDepression?parseFloat(q.predictedScoreDepression):void 0,anxietyScore:q.predictedScoreAnxiety?parseFloat(q.predictedScoreAnxiety):void 0,riskLevel:q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.7?"high":q.predictedScoreDepression&&parseFloat(q.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",q.predictedScoreDepression?`Depression score: ${q.predictedScoreDepression}`:"",q.predictedScoreAnxiety?`Anxiety score: ${q.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(be=>be.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};se.saveSessionData(ve).then(be=>{console.log("Multi-file session data saved with analysis results for session:",F.sessionId),console.log("Save result:",be),T("success","Session Saved","Analysis results have been saved to session storage.")}).catch(be=>{console.error("Failed to save multi-file analysis results to session storage:",be),console.error("Session data that failed to save:",ve),T("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),m(be=>({...be,[o]:{stage:"complete",progress:100,message:"Analysis complete!"}})),b(be=>({...be,[o]:Me})),Z()},q=>{U(q)})})}catch(S){console.error(`Error processing file ${o}:`,S);let D="UNKNOWN_ERROR",O="An unexpected error occurred",F={};S&&typeof S=="object"?("code"in S&&typeof S.code=="string"&&(D=S.code),"message"in S&&typeof S.message=="string"&&(O=S.message),"details"in S&&typeof S.details=="object"&&(F=S.details)):S instanceof Error&&(O=S.message,D=S.name||"ERROR");try{const z=u[o];if(z&&z.sessionId){const ee={sessionId:z.sessionId,userId:X(),metadata_user_id:c.userId.trim(),audioFileName:h.file.name,createdAt:new Date().toISOString(),status:"failed",updatedAt:new Date().toISOString(),error:{code:D,message:O,details:F}};await se.updateSessionData(z.sessionId,ee),console.log(`Updated session ${z.sessionId} status to failed`)}}catch(z){console.error("Failed to update session status to failed:",z)}try{const z=u[o];if(z&&(z.stage==="uploading"||z.stage==="submitting"||z.stage==="analyzing")){const ee=`${c.userId}_*_*.wav`;console.log(`Attempting cleanup for file pattern: ${ee}`)}}catch(z){console.warn("Error during cleanup attempt:",z)}throw m(z=>({...z,[o]:{stage:"error",progress:0,message:"Processing failed",error:{code:D,message:O,details:F}}})),S}},[c.userId,Xe,se,hs,xs,T]),Is=d.useCallback(async()=>{L(!0),w(null);const o=De();if(o.length>0){w(`Validation error: ${o.join(", ")}`),T("error","Validation Error",o.join(", ")),L(!1);return}const h=t.filter(O=>g[O.id]==="ready");if(h.length===0){T("info","No Files Ready","No files are ready to process"),L(!1);return}const S=h.length;let D=0;try{for(const O of h){D++,T("info","Processing File",`Processing ${O.file.name} (${D}/${S})`),k(F=>({...F,[O.id]:"processing"}));try{await es(O.id,O),k(F=>({...F,[O.id]:"complete"})),T("success","File Complete",`${O.file.name} processed successfully`)}catch(F){let z="FILE_PROCESSING_ERROR",ee="An unexpected error occurred",fe={};F&&typeof F=="object"?("code"in F&&typeof F.code=="string"&&(z=F.code),"message"in F&&typeof F.message=="string"&&(ee=F.message),"details"in F&&typeof F.details=="object"&&(fe=F.details)):F instanceof Error&&(ee=F.message,z=F.name||"ERROR"),T("error","File Failed",`Failed to process ${O.file.name}: ${ee}`),k(ne=>({...ne,[O.id]:"error"})),m(ne=>({...ne,[O.id]:{stage:"error",progress:0,message:`Failed: ${ee}`,error:{code:z,message:ee,details:fe}}}))}}T("success","Batch Complete",`Processed ${D} file${D!==1?"s":""}`),K(`Batch processing complete. ${D} files processed.`)}catch(O){const F=O instanceof Error?O.message:"An unexpected error occurred";w(F),T("error","Batch Failed",F),K(`Error: ${F}`)}finally{L(!1)}},[t,g,De,T,K,es]),It=d.useCallback(async o=>{const h=t.find(D=>D.id===o);if(!h)return;const S=De();if(S.length>0){w(`Validation error: ${S.join(", ")}`),T("error","Validation Error",S.join(", "));return}k(D=>({...D,[o]:"processing"}));try{await es(o,h),k(D=>({...D,[o]:"complete"})),T("success","File Complete",`${h.file.name} processed successfully`)}catch(D){console.error(`Error processing ${h.file.name}:`,D);const O=D instanceof Error?D.message:"An unexpected error occurred";T("error","File Failed",`Failed to process ${h.file.name}: ${O}`),k(F=>({...F,[o]:"error"})),m(F=>({...F,[o]:{stage:"error",progress:0,message:`Failed: ${O}`}}))}},[t,De,T,es]),Rt=d.useCallback(async()=>{if(!_||!c.userId.trim()){w("Please select an audio file. User ID is automatically generated."),T("error","Missing Information","Please select an audio file. User ID is automatically generated.");return}const o=De();if(o.length>0){w(`Validation error: ${o.join(", ")}`),T("error","Validation Error",o.join(", "));return}try{w(null),P({stage:"initiating",progress:5,message:"Initiating session..."}),K("Starting analysis process - initiating session");const h=Xe(),S={userid:c.userId.trim(),is_initiated:!0};h&&(S.metadata=h);const D=await se.initiateSession(S),O={sessionId:D.sessionId,userId:c.userId.trim()};P({stage:"initiating",progress:10,message:"Saving session data..."});const F={sessionId:D.sessionId,userId:X(),metadata_user_id:c.userId.trim(),...h&&{userMetadata:h},audioFileName:_.file.name,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"initiated"};try{console.log("Attempting to save session data (single-file):",F);const ne=await se.saveSessionData(F);console.log("Session data saved successfully (single-file):",ne)}catch(ne){console.error("Failed to save session data (single-file):",ne),console.error("Session data that failed to save:",F),T("warning","Session Save Warning","Session data could not be saved to storage, but processing will continue.")}let z,ee;if(_.url&&!_.url.startsWith("blob:"))P({stage:"uploading",progress:40,message:"Using existing audio file from previous session..."}),K("Session created successfully, reusing previously processed audio file"),z=_.url,ee=_.file.name,P({stage:"submitting",progress:65,message:"Submitting for analysis..."});else{P({stage:"converting",progress:15,message:"Converting audio to required format..."}),K("Session created successfully, now converting audio");const ne=await xs(_.file,Z=>{P({stage:"converting",progress:15+Z*.25,message:`Converting audio... ${Math.round(Z)}%`})});P({stage:"uploading",progress:40,message:"Uploading to Azure Blob Storage..."}),K("Audio converted successfully, now uploading"),ee=`${c.userId}_${O.sessionId}_${Date.now()}.wav`,z=await hs(ne,ee,Z=>{P({stage:"uploading",progress:40+Z*.25,message:`Uploading... ${Math.round(Z)}%`})},X())}P({stage:"submitting",progress:65,message:"Submitting for analysis..."}),K("Upload complete, submitting for behavioral health analysis");try{const ne={...F,audioUrl:z,audioFileName:ee,status:"processing",updatedAt:new Date().toISOString()};await se.updateSessionData(O.sessionId,ne)}catch(ne){console.warn("Failed to update session data with audio info:",ne)}await se.submitPrediction({userId:c.userId.trim(),sessionid:O.sessionId,audioFileUrl:z,audioFileName:ee}),P({stage:"analyzing",progress:70,message:"Analyzing audio with Kintsugi Health API..."}),K("Prediction submitted, analysis in progress");const fe=new Ks(O.sessionId);await new Promise((ne,Z)=>{fe.start(U=>{const q=U.status==="processing"?80:U.status==="success"?95:70;P({stage:"analyzing",progress:q,message:`Analysis ${U.status}...`}),U.predictError&&T("error","Prediction Error",`${U.predictError.error}: ${U.predictError.message}`)},U=>{if(U.predictError){T("error","Analysis Failed",`The analysis completed with an error: ${U.predictError.error} - ${U.predictError.message}`),P({stage:"error",progress:0,message:"Analysis failed with errors"}),Z(new Error(`Prediction error: ${U.predictError.error}`));return}const q={sessionId:O.sessionId,depressionScore:U.predictedScoreDepression?parseFloat(U.predictedScoreDepression):0,riskLevel:U.predictedScoreDepression&&parseFloat(U.predictedScoreDepression)>.7?"high":U.predictedScoreDepression&&parseFloat(U.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",U.predictedScoreDepression?`Depression score: ${U.predictedScoreDepression}`:"",U.predictedScoreAnxiety?`Anxiety score: ${U.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(ve=>ve.trim()!==""),timestamp:U.updatedAt,audioUrl:z,rawApiResponse:U},Me={...F,audioUrl:z,prediction:U,analysisResults:{depressionScore:U.predictedScoreDepression?parseFloat(U.predictedScoreDepression):void 0,anxietyScore:U.predictedScoreAnxiety?parseFloat(U.predictedScoreAnxiety):void 0,riskLevel:U.predictedScoreDepression&&parseFloat(U.predictedScoreDepression)>.7?"high":U.predictedScoreDepression&&parseFloat(U.predictedScoreDepression)>.4?"medium":"low",confidence:.85,insights:["Analysis completed using Kintsugi Health API",U.predictedScoreDepression?`Depression score: ${U.predictedScoreDepression}`:"",U.predictedScoreAnxiety?`Anxiety score: ${U.predictedScoreAnxiety}`:"","Results should be reviewed by a qualified healthcare professional"].filter(ve=>ve.trim()!==""),completedAt:new Date().toISOString()},status:"completed",completedAt:new Date().toISOString(),updatedAt:new Date().toISOString()};se.saveSessionData(Me).then(ve=>{console.log("Session data saved with analysis results for session:",O.sessionId),console.log("Save result:",ve),T("success","Session Saved","Analysis results have been saved to session storage.")}).catch(ve=>{console.error("Failed to save analysis results to session storage:",ve),console.error("Session data that failed to save:",Me),T("warning","Save Warning","Analysis completed but failed to save to session storage. Results are still available.")}),P({stage:"complete",progress:100,message:"Analysis complete!"}),J(q),T("success","Analysis Complete","Your behavioral health analysis has been completed successfully."),K("Behavioral health analysis completed successfully"),ne()},U=>{T("error","Analysis Error",U.message||"An unexpected error occurred during analysis."),Z(U)})})}catch(h){console.error("Processing error:",h);const S=h instanceof Error?h.message:"An unexpected error occurred";w(S),P({stage:"error",progress:0,message:"Processing failed"}),T("error","Processing Failed",S),K(`Error: ${S}`)}},[_,c.userId,K,De,Xe]),Rs=d.useCallback(o=>{switch(o){case"error":return"processing-progress__fill--error";case"complete":return"processing-progress__fill--success";default:return""}},[]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Processing Mode:"}),e.jsxs("div",{className:"relative inline-flex items-center",children:[e.jsx("button",{type:"button",onClick:wt,className:`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${i?"bg-blue-600 hover:bg-blue-700":"bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500"}`,"aria-label":`Switch to ${i?"single file":"multi-file"} mode`,children:e.jsx("span",{className:`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${i?"translate-x-9":"translate-x-1"}`,children:i?e.jsx(ca,{className:"h-3 w-3 text-blue-600"}):e.jsx(oa,{className:"h-3 w-3 text-gray-600"})})}),e.jsxs("div",{className:"ml-3 flex items-center space-x-4",children:[e.jsx("span",{className:`text-sm font-medium ${i?"text-gray-500 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:"Single"}),e.jsx("span",{className:`text-sm font-medium ${i?"text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}`,children:"Multi"})]})]})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${i?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}),"Batch Processing"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z",clipRule:"evenodd"})}),"Single File"]})})]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Upload & Analyze Audio"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:["Upload ",i?"multiple audio files":"an audio file"," for behavioral health analysis using AI-powered speech pattern recognition"]}),e.jsx("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm ${i?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd"})]}),"Process multiple files with individual controls and batch options"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Upload and analyze one file at a time with detailed progress tracking"]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Patient Information (Optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"User ID (Auto-generated, editable)"}),e.jsx("input",{type:"text",id:"userId",value:c.userId,onChange:o=>x(h=>({...h,userId:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Auto-generated user ID"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for API calls. Auto-generated but can be customized."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"age",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsx("input",{type:"number",id:"age",value:c.age,onChange:o=>{const h=o.target.value;x(S=>({...S,age:h})),je("age",h)},onBlur:o=>je("age",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&je("age",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${H.age?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Age in years",min:"1",max:"150","aria-describedby":H.age?"age-error":void 0}),H.age&&e.jsx("p",{id:"age-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:H.age})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"weight",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsx("input",{type:"number",id:"weight",value:c.weight,onChange:o=>{const h=o.target.value;x(S=>({...S,weight:h})),je("weight",h)},onBlur:o=>je("weight",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&je("weight",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${H.weight?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Weight in lbs",min:"1",max:"1000","aria-describedby":H.weight?"weight-error":void 0}),H.weight&&e.jsx("p",{id:"weight-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:H.weight})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsxs("select",{id:"gender",value:c.gender,onChange:o=>x(h=>({...h,gender:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"non-binary",children:"Non-binary"}),e.jsx("option",{value:"transgender female",children:"Transgender female"}),e.jsx("option",{value:"transgender male",children:"Transgender male"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer",children:"Prefer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"race",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsxs("select",{id:"race",value:c.race,onChange:o=>x(h=>({...h,race:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select race"}),e.jsx("option",{value:"white",children:"White"}),e.jsx("option",{value:"black or african-american",children:"Black or African-American"}),e.jsx("option",{value:"asian",children:"Asian"}),e.jsx("option",{value:"american indian or alaskan native",children:"American Indian or Alaskan Native"}),e.jsx("option",{value:"native Hawaiian or pacific islander",children:"Native Hawaiian or Pacific Islander"}),e.jsx("option",{value:"two or more races",children:"Two or more races"}),e.jsx("option",{value:"other",children:"Other"}),e.jsx("option",{value:"prefer not to say",children:"Prefer not to say"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ethnicity",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsxs("select",{id:"ethnicity",value:c.ethnicity,onChange:o=>x(h=>({...h,ethnicity:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select ethnicity"}),e.jsx("option",{value:"Hispanic, Latino, or Spanish Origin",children:"Hispanic, Latino, or Spanish Origin"}),e.jsx("option",{value:"Not Hispanic, Latino, or Spanish Origin",children:"Not Hispanic, Latino, or Spanish Origin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language"}),e.jsxs("select",{id:"language",value:c.language,onChange:o=>x(h=>({...h,language:o.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Select language"}),e.jsx("option",{value:"true",children:"English"}),e.jsx("option",{value:"false",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"zipcode",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",id:"zipcode",value:c.zipcode,onChange:o=>{const h=o.target.value;x(S=>({...S,zipcode:h})),je("zipcode",h)},onBlur:o=>je("zipcode",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&je("zipcode",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${H.zipcode?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,placeholder:"Enter ZIP code",pattern:"[0-9]{5}(-[0-9]{4})?",title:"Enter a valid ZIP code (e.g., 12345 or 12345-6789)","aria-describedby":H.zipcode?"zipcode-error":void 0}),H.zipcode&&e.jsx("p",{id:"zipcode-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:H.zipcode})]}),e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{htmlFor:"sessionNotes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("textarea",{id:"sessionNotes",value:c.sessionNotes,onChange:o=>x(h=>({...h,sessionNotes:o.target.value})),onBlur:o=>je("sessionNotes",o.target.value),onKeyUp:o=>{(o.key==="Enter"||o.key==="Tab")&&je("sessionNotes",o.currentTarget.value)},className:`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${H.sessionNotes?"border-red-300 dark:border-red-600":"border-gray-300 dark:border-gray-600"}`,rows:3,placeholder:"Additional notes about this session or patient context","aria-describedby":H.sessionNotes?"sessionNotes-error":void 0}),H.sessionNotes&&e.jsx("p",{id:"sessionNotes-error",className:"mt-1 text-sm text-red-600 dark:text-red-400",role:"alert",children:H.sessionNotes}),e.jsxs("div",{className:"mt-1 flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[c.sessionNotes.length,"/500 characters"]}),e.jsxs("button",{type:"button",onClick:()=>Ct(),disabled:!c.sessionNotes.trim()||re,className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-blue-700 bg-blue-50 border border-blue-200 hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:text-blue-300 dark:bg-blue-900/20 dark:border-blue-700 dark:hover:bg-blue-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Correct grammar and spelling in session notes",title:"Correct grammar and spelling",children:[re?e.jsx(Zs,{className:"w-3.5 h-3.5 mr-1.5 animate-spin","aria-hidden":"true"}):e.jsx("svg",{className:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),re?"Correcting...":"Correct Grammar"]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Audio File Upload ",i&&e.jsx("span",{className:"text-sm font-normal text-gray-500 dark:text-gray-400",children:"(Multi-File Mode)"})]}),!i&&!_||i&&t.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors",onDragOver:Nt,onDrop:kt,children:[e.jsx(Pa,{className:"mx-auto h-12 w-12 text-gray-400 mb-4","aria-hidden":"true"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>{var o;return(o=Y.current)==null?void 0:o.click()},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Select Audio File",i?"s":""]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["or drag and drop ",i?"files":"file"," here"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)",i&&e.jsx("br",{}),i&&"You can select multiple files at once"]}),e.jsx("input",{ref:Y,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Qe,multiple:i,"aria-label":`Select audio file${i?"s":""} for analysis`})]}):e.jsxs("div",{className:"space-y-4",children:[!i&&_&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ue,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:_.file.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(_.file.size/1024/1024).toFixed(2)," MB",_.duration&&` â€¢ ${Ze(_.duration)}`]})]})]}),e.jsx("button",{type:"button",onClick:ke,className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Remove selected file",children:e.jsx(Fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:St,className:"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":I?"Pause audio":"Play audio",children:I?e.jsx(fs,{className:"h-5 w-5","aria-hidden":"true"}):e.jsx($e,{className:"h-5 w-5 ml-0.5","aria-hidden":"true"})}),e.jsx("div",{className:"flex-1",children:_.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Ze(E)," / ",Ze(_.duration)]})})]}),_.duration&&e.jsx("div",{className:"audio-progress",children:e.jsx("div",{className:"audio-progress__fill progress-animated",style:{width:`${E/_.duration*100}%`},role:"progressbar","aria-label":"Audio playback progress","aria-valuenow":E,"aria-valuemin":0,"aria-valuemax":_.duration})})]}),e.jsx("audio",{ref:N,src:_.url,onTimeUpdate:At,onEnded:()=>v(!1),onPlay:()=>v(!0),onPause:()=>v(!1),className:"hidden"})]}),i&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Selected Files (",t.length,")"]}),e.jsxs("button",{type:"button",onClick:()=>{var o;return(o=Y.current)==null?void 0:o.click()},className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Add More Files"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(o=>{const h=g[o.id]||"ready",S=u[o.id];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[e.jsx(Ue,{className:"h-4 w-4 text-blue-500 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:o.file.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(o.file.size/1024/1024).toFixed(2)," MB",o.duration&&` â€¢ ${Ze(o.duration)}`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[h==="ready"&&e.jsxs("button",{type:"button",onClick:()=>It(o.id),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800","aria-label":`Start processing ${o.file.name}`,children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Start"]}),h==="processing"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:"Processing..."}),h==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Complete"]}),h==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"Error"]}),e.jsx("button",{type:"button",onClick:()=>jt(o.id),className:"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400","aria-label":`Remove ${o.file.name}`,children:e.jsx(ns,{className:"h-4 w-4"})})]})]}),S&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:S.message}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(S.progress),"%"]})]}),e.jsx("div",{className:"processing-progress mt-1",children:e.jsx("div",{className:`processing-progress__fill ${Rs(S.stage)}`,style:{width:`${S.progress}%`}})})]})]},o.id)})}),e.jsx("input",{ref:Y,type:"file",className:"hidden",accept:".wav,.mp3,.m4a,.aac,.flac,audio/*",onChange:Qe,multiple:i,"aria-label":"Select additional audio files for analysis"})]})]})]}),p&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 text-red-500 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:p})]})}),!i&&f.stage!=="idle"&&!$&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:f.message}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[Math.round(f.progress),"%"]})]}),e.jsx("div",{className:"processing-progress",children:e.jsx("div",{className:`processing-progress__fill progress-animated ${Rs(f.stage)}`,style:{width:`${f.progress}%`},role:"progressbar","aria-label":"Processing progress","aria-valuenow":f.progress,"aria-valuemin":0,"aria-valuemax":100})}),f.stage==="analyzing"&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Zs,{className:"h-4 w-4 animate-spin mr-2","aria-hidden":"true"}),"This may take a few minutes..."]})]})]}),$&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ue,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analysis Results"})]}),$.rawApiResponse&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"API Response Details"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Predicted Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.predicted_score_anxiety||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:`font-mono ${$.rawApiResponse.status==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:$.rawApiResponse.status||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Model Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Category:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.model_category||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Granularity:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.model_granularity||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Calibrated:"}),e.jsx("span",{className:`font-mono ${$.rawApiResponse.is_calibrated?"text-green-600 dark:text-green-400":"text-yellow-600 dark:text-yellow-400"}`,children:$.rawApiResponse.is_calibrated?"Yes":"No"})]})]})]}),$.rawApiResponse.actual_score&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Clinical Assessment Scores"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[$.rawApiResponse.actual_score.depression_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.actual_score.depression_binary||"N/A"})]}),$.rawApiResponse.actual_score.anxiety_binary!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety Binary:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:$.rawApiResponse.actual_score.anxiety_binary||"N/A"})]}),$.rawApiResponse.actual_score.phq_9&&$.rawApiResponse.actual_score.phq_9.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-9:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",$.rawApiResponse.actual_score.phq_9.join(", "),"]"]})]}),$.rawApiResponse.actual_score.phq_2&&$.rawApiResponse.actual_score.phq_2.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PHQ-2:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",$.rawApiResponse.actual_score.phq_2.join(", "),"]"]})]}),$.rawApiResponse.actual_score.gad_7&&$.rawApiResponse.actual_score.gad_7.length>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"GAD-7:"}),e.jsxs("span",{className:"font-mono text-gray-900 dark:text-white",children:["[",$.rawApiResponse.actual_score.gad_7.join(", "),"]"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeline"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Created:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:$.rawApiResponse.created_at?new Date($.rawApiResponse.created_at).toLocaleString():"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Updated:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:$.rawApiResponse.updated_at?new Date($.rawApiResponse.updated_at).toLocaleString():"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Session Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white text-xs",children:$.sessionId})]})})]}),$.rawApiResponse.predict_error&&e.jsxs("div",{className:"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3",children:[e.jsx("h5",{className:"text-sm font-medium text-red-700 dark:text-red-300 mb-1",children:"Prediction Error"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Error Type:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:$.rawApiResponse.predict_error.error})]}),e.jsxs("div",{className:"text-red-700 dark:text-red-300",children:[e.jsx("span",{className:"font-medium",children:"Message:"})," ",$.rawApiResponse.predict_error.message]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify($.rawApiResponse,null,2)})})]})]})})]}),$.insights&&$.insights.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Clinical Insights"}),e.jsx("ul",{className:"space-y-1",children:$.insights.map((o,h)=>e.jsxs("li",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["â€¢ ",o]},h))})]}),e.jsx("div",{className:"mt-6 flex space-x-3",children:e.jsx("button",{type:"button",onClick:ke,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",children:"Analyze Another File"})})]}),(i&&t.length>0||!i&&_)&&!$&&Object.keys(y).length===0&&f.stage==="idle"&&!A&&e.jsx("div",{className:"text-center",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsxs("button",{type:"button",onClick:Is,disabled:t.length===0||!c.userId.trim()||!t.some(o=>g[o.id]==="ready")||!!p||Object.values(H).some(o=>o!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx($e,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start All Ready Files",t.filter(o=>g[o.id]==="ready").length>0&&` (${t.filter(o=>g[o.id]==="ready").length})`]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:'Use individual "Start" buttons on each file for selective processing, or "Start All" to process all ready files sequentially'})]}):e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:_t,disabled:!_||!c.userId.trim()||!!p||Object.values(H).some(o=>o!==void 0),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800",children:[e.jsx($e,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Start Analysis"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This will convert, upload, and analyze your audio file"})]})}),i&&Object.keys(y).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ue,{className:"h-6 w-6 text-green-500 mr-2","aria-hidden":"true"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Batch Analysis Results (",Object.keys(y).length," files)"]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(y).map(([o,h])=>{const S=t.find(O=>O.id===o),D=u[o];return e.jsxs("div",{className:"border dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:(S==null?void 0:S.file.name)||`File ${o}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(D==null?void 0:D.stage)==="complete"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Complete"]}),(D==null?void 0:D.stage)==="error"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"Error"]})]})]}),(D==null?void 0:D.stage)==="error"&&(D==null?void 0:D.error)&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ye,{className:"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0","aria-hidden":"true"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Error Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Code:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100",children:D.error.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:"Error Message:"}),e.jsx("span",{className:"font-mono text-red-900 dark:text-red-100 text-right",children:D.error.message})]})]}),D.error.details&&Object.keys(D.error.details).length>0&&e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100",children:"View Additional Error Details"}),e.jsx("div",{className:"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32",children:e.jsx("pre",{className:"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap",children:JSON.stringify(D.error.details,null,2)})})]})]})]})]})}),h.rawApiResponse&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Depression:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:h.rawApiResponse.predicted_score_depression||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Anxiety:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:h.rawApiResponse.predicted_score_anxiety||"N/A"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:h.sessionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:h.rawApiResponse.status||"N/A"})]})]})}),e.jsxs("details",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"View Raw JSON Response"}),e.jsx("div",{className:"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64",children:e.jsx("pre",{className:"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:JSON.stringify(h.rawApiResponse,null,2)})})]})]}),S&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{const O=document.getElementById(`audio-${o}`);O.paused?(document.querySelectorAll("audio").forEach(F=>F.pause()),j(o),O.play()):(O.pause(),j(null))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900","aria-label":C===o?"Pause audio":"Play audio",children:C===o?e.jsx(fs,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[S.file.name," â€¢ ",S.duration?`${Math.round(S.duration)}s`:"Duration unknown"]})]}),e.jsx("audio",{id:`audio-${o}`,src:S.url,onEnded:()=>j(null),className:"hidden"})]})]},o)})})]}),R.length>0&&e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:R.map(o=>e.jsx("div",{className:`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${o.type==="error"?"border-red-500":o.type==="warning"?"border-yellow-500":o.type==="success"?"border-green-500":"border-blue-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-shrink-0",children:[o.type==="error"&&e.jsx(ye,{className:"h-5 w-5 text-red-500","aria-hidden":"true"}),o.type==="warning"&&e.jsx(ye,{className:"h-5 w-5 text-yellow-500","aria-hidden":"true"}),o.type==="success"&&e.jsx(ue,{className:"h-5 w-5 text-green-500","aria-hidden":"true"}),o.type==="info"&&e.jsx(ye,{className:"h-5 w-5 text-blue-500","aria-hidden":"true"})]}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:o.message})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>me(o.id),className:"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close notification",children:e.jsx(Fe,{className:"h-4 w-4"})})})]})},o.id))})]})},rs={queued:{color:"yellow",icon:Re,label:"Queued"},running:{color:"blue",icon:te,label:"Processing"},processing:{color:"blue",icon:te,label:"Processing"},succeeded:{color:"green",icon:ue,label:"Completed"},success:{color:"green",icon:ue,label:"Completed"},completed:{color:"green",icon:ue,label:"Completed"},failed:{color:"red",icon:ls,label:"Failed"},error:{color:"red",icon:ls,label:"Error"}},as=r=>r?r.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):"â€”",is=r=>{if(!r)return 0;switch(r.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},Ja=()=>{const{user:r}=_e(),s=Ke(),[t,a]=d.useState([]),[i,l]=d.useState(!0),[u,m]=d.useState(null),[y,b]=d.useState(new Set),[g,k]=d.useState(!1),[A,L]=d.useState({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),{announceToScreenReader:_}=Oe(),M=d.useCallback(()=>(r==null?void 0:r.id)||Se(),[r==null?void 0:r.id]),f=d.useCallback(async()=>{try{l(!0),m(null);const n=M(),x=(await se.getUserSessions(n)).sessions.map(p=>{var B,H;const w=p.prediction,R=p.analysisResults;return{...p,uploadedAt:p.createdAt,fileName:p.audioFileName||`Audio_${p.sessionId.slice(-8)}.wav`,fileSize:Math.floor(Math.random()*5e6)+1e6,riskLevel:(R==null?void 0:R.riskLevel)||"unknown",depressionScore:((B=R==null?void 0:R.depressionScore)==null?void 0:B.toString())||(w==null?void 0:w.predicted_score_depression)||(w==null?void 0:w.predictedScoreDepression)||void 0,anxietyScore:((H=R==null?void 0:R.anxietyScore)==null?void 0:H.toString())||(w==null?void 0:w.predicted_score_anxiety)||(w==null?void 0:w.predictedScoreAnxiety)||void 0}});a(x),_(`${x.length} sessions loaded successfully`)}catch(n){const c=n;m(c),_(`Error loading sessions: ${c.message}`)}finally{l(!1)}},[_]);d.useEffect(()=>{f()},[f]);const P=d.useMemo(()=>{let n=t;if(A.search){const c=A.search.toLowerCase();n=n.filter(x=>{var p,w;return x.sessionId.toLowerCase().includes(c)||((p=x.fileName)==null?void 0:p.toLowerCase().includes(c))||((w=rs[x.status])==null?void 0:w.label.toLowerCase().includes(c))})}if(A.status!=="all"&&(n=n.filter(c=>c.status===A.status)),A.dateRange!=="all"){const c=new Date,x=new Date;switch(A.dateRange){case"today":x.setHours(0,0,0,0);break;case"week":x.setDate(c.getDate()-7);break;case"month":x.setMonth(c.getMonth()-1);break;case"year":x.setFullYear(c.getFullYear()-1);break}n=n.filter(p=>new Date(p.uploadedAt)>=x)}return n.sort((c,x)=>{let p=0;switch(A.sortBy){case"date":p=new Date(c.uploadedAt).getTime()-new Date(x.uploadedAt).getTime();break;case"status":p=c.status.localeCompare(x.status);break;case"depressionScore":const w=is(c.depressionScore),R=is(x.depressionScore);p=w-R;break;case"anxietyScore":const B=is(c.anxietyScore),H=is(x.anxietyScore);p=B-H;break}return A.sortOrder==="desc"?-p:p}),n},[t,A]),$=d.useCallback((n,c)=>{L(x=>({...x,[n]:c})),_(`Filter ${n} changed to ${c}`)},[_]),J=d.useCallback(n=>{b(c=>{const x=new Set(c);return x.has(n)?(x.delete(n),_("Session deselected")):(x.add(n),_("Session selected")),x})},[_]),I=d.useCallback(()=>{y.size===P.length?(b(new Set),_("All sessions deselected")):(b(new Set(P.map(c=>c.sessionId))),_(`All ${P.length} sessions selected`))},[y.size,P,_]),v=d.useCallback(async n=>{if(window.confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await se.deleteSessionData(n),a(x=>x.filter(p=>p.sessionId!==n)),b(x=>{const p=new Set(x);return p.delete(n),p}),_("Session deleted successfully")}catch(x){const p=x;_(`Error deleting session: ${p.message}`),alert(`Failed to delete session: ${p.message}`)}},[_]),E=d.useCallback(async n=>{if(window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled."))try{const x=t.find(p=>p.sessionId===n);if(!x){_("Cannot re-run analysis: Session not found"),alert("Cannot re-run analysis: Session not found");return}_("Redirecting to upload page for re-run..."),s("/upload",{state:{originalSessionId:x.sessionId,audioFileName:x.audioFileName,audioUrl:x.audioUrl,userMetadata:x.userMetadata}})}catch(x){const p=x;_(`Error preparing re-run: ${p.message}`),alert(`Failed to prepare re-run: ${p.message}`)}},[_,t,s]),Q=d.useCallback(async()=>{if(y.size===0||!window.confirm(`Are you sure you want to delete ${y.size} session(s)? This action cannot be undone.`))return;const c=Array.from(y);let x=0,p=[];for(const w of c)try{await se.deleteSessionData(w),x++}catch(R){const B=R;p.push(w),console.error(`Failed to delete session ${w}:`,B.message)}if(x>0&&a(w=>w.filter(R=>!(y.has(R.sessionId)&&!p.includes(R.sessionId)))),b(new Set),p.length===0)_(`${x} sessions deleted successfully`);else{const w=`${x} sessions deleted successfully, ${p.length} failed`;_(w),alert(`${w}. Failed sessions: ${p.join(", ")}`)}},[y,_]),C=n=>{if(n===0)return"0 B";const c=1024,x=["B","KB","MB","GB"],p=Math.floor(Math.log(n)/Math.log(c));return`${parseFloat((n/Math.pow(c,p)).toFixed(1))} ${x[p]}`},j=({status:n})=>{const c=n.toLowerCase();let x=rs[n];x||(c.includes("error")||c.includes("fail")?x=rs.error:x=rs.queued);const p=x.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":x.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":x.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${x.label}`,children:[e.jsx(p,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),x.label]})};return i?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(te,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading sessions..."})]})}):u?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Sessions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:u.message}),e.jsx("button",{type:"button",onClick:f,className:"mt-4 btn btn--primary","aria-label":"Retry loading sessions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Analysis Sessions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"View and manage your audio analysis sessions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:f,disabled:i,className:"btn btn--secondary","aria-label":"Refresh sessions list",children:[e.jsx(te,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsx(le,{to:"/upload",className:"btn btn--primary","aria-label":"Start new analysis session",children:"New Analysis"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{htmlFor:"search-sessions",className:"sr-only",children:"Search sessions"}),e.jsxs("div",{className:"relative",children:[e.jsx(Aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","aria-hidden":"true"}),e.jsx("input",{id:"search-sessions",type:"text",placeholder:"Search by session ID, filename, or status...",value:A.search,onChange:n=>$("search",n.target.value),className:"form__input w-full pl-10 pr-4 py-2","aria-describedby":"search-help"})]}),e.jsx("p",{id:"search-help",className:"sr-only",children:"Search through your analysis sessions by ID, filename, or status"})]}),e.jsxs("button",{type:"button",onClick:()=>k(!g),className:"btn btn--secondary flex items-center","aria-expanded":g,"aria-controls":"filter-panel","aria-label":`${g?"Hide":"Show"} filter options`,children:[e.jsx(ht,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",g?e.jsx(xt,{className:"w-4 h-4 ml-2","aria-hidden":"true"}):e.jsx(mt,{className:"w-4 h-4 ml-2","aria-hidden":"true"})]})]}),g&&e.jsxs("div",{id:"filter-panel",className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{id:"status-filter",value:A.status,onChange:n=>$("status",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"queued",children:"Queued"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"succeeded",children:"Completed"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-filter",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-filter",value:A.dateRange,onChange:n=>$("dateRange",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort By"}),e.jsxs("select",{id:"sort-by",value:A.sortBy,onChange:n=>$("sortBy",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"depressionScore",children:"Depression Score"}),e.jsx("option",{value:"anxietyScore",children:"Anxiety Score"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-order",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),e.jsxs("select",{id:"sort-order",value:A.sortOrder,onChange:n=>$("sortOrder",n.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]})]}),P.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[P.length," of ",t.length," sessions",y.size>0&&` â€¢ ${y.size} selected`]})}),y.size>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:Q,className:"btn btn--danger","aria-label":`Delete ${y.size} selected sessions`,children:[e.jsx(ns,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Delete Selected"]})})]}),P.length>0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",role:"table","aria-label":"Analysis sessions",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:y.size===P.length,onChange:I,className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":"Select all sessions"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Session"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Depression Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Anxiety Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:P.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:y.has(n.sessionId),onChange:()=>J(n.sessionId),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${n.sessionId}`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.fileName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",n.sessionId.slice(-12)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:C(n.fileSize||0)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(j,{status:n.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:n.depressionScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:as(n.depressionScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm",children:n.anxietyScore?e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:as(n.anxietyScore)}):e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:"â€”"})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:He(n.uploadedAt)}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:Te(n.uploadedAt)})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(le,{to:`/sessions/${n.sessionId}`,className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`View details for session ${n.sessionId}`,children:e.jsx(We,{className:"w-4 h-4","aria-hidden":"true"})}),n.status==="succeeded"&&e.jsx("button",{type:"button",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300","aria-label":`Download results for session ${n.sessionId}`,children:e.jsx(cs,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>E(n.sessionId),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300","aria-label":`Re-run analysis for session ${n.sessionId}`,children:e.jsx(te,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("button",{type:"button",onClick:()=>v(n.sessionId),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300","aria-label":`Delete session ${n.sessionId}`,children:e.jsx(ns,{className:"w-4 h-4","aria-hidden":"true"})})]})})]},n.sessionId))})]})}),e.jsx("div",{className:"md:hidden space-y-4 p-4",children:P.map(n=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("input",{type:"checkbox",checked:y.has(n.sessionId),onChange:()=>J(n.sessionId),className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500","aria-label":`Select session ${n.sessionId}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.fileName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ID: ",n.sessionId.slice(-12)]})]})]}),e.jsx(j,{status:n.status})]}),(n.depressionScore||n.anxietyScore)&&e.jsxs("div",{className:"text-sm",children:[n.depressionScore&&e.jsxs("div",{children:["Depression: ",as(n.depressionScore)]}),n.anxietyScore&&e.jsxs("div",{children:["Anxiety: ",as(n.anxietyScore)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:He(n.uploadedAt)}),e.jsx("span",{children:C(n.fileSize||0)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs(le,{to:`/sessions/${n.sessionId}`,className:"btn btn--secondary text-xs","aria-label":`View details for session ${n.sessionId}`,children:[e.jsx(We,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"View"]}),n.status==="succeeded"&&e.jsxs("button",{type:"button",className:"btn btn--secondary text-xs","aria-label":`Download results for session ${n.sessionId}`,children:[e.jsx(cs,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Download"]}),e.jsxs("button",{type:"button",onClick:()=>E(n.sessionId),className:"btn btn--secondary text-xs","aria-label":`Re-run analysis for session ${n.sessionId}`,children:[e.jsx(te,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:()=>v(n.sessionId),className:"btn btn--danger text-xs","aria-label":`Delete session ${n.sessionId}`,children:[e.jsx(ns,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Delete"]})]})]},n.sessionId))})]}):e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:t.length===0?"You haven't created any analysis sessions yet.":"No sessions match your current filters."}),t.length===0?e.jsx(le,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"}):e.jsx("button",{type:"button",onClick:()=>L({search:"",status:"all",dateRange:"all",sortBy:"date",sortOrder:"desc"}),className:"btn btn--secondary",children:"Clear Filters"})]})]})},Qa={low:{color:"green",label:"Low Risk",icon:ue,description:"Low likelihood of immediate concerns"},moderate:{color:"yellow",label:"Moderate Risk",icon:ws,description:"Some concerns that warrant attention"},high:{color:"red",label:"High Risk",icon:vs,description:"Significant concerns requiring immediate attention"},critical:{color:"red",label:"Critical Risk",icon:vs,description:"Urgent intervention required"}},Za=({sessionId:r,existingAssessment:s,onAssessmentUpdated:t})=>{const{announceToScreenReader:a}=Oe(),[i,l]=d.useState(s||null),[u,m]=d.useState(!1),[y,b]=d.useState(!1),[g,k]=d.useState(null),A=d.useCallback(async()=>{try{m(!0),k(null),a("Generating AI risk assessment...");const M=await se.generateRiskAssessment(r);if(M.success&&M.riskAssessment)l(M.riskAssessment),t==null||t(M.riskAssessment),a("Risk assessment generated successfully");else throw new Error(M.message||"Failed to generate risk assessment")}catch(M){const f=M;k(f),a(`Error generating assessment: ${f.message}`)}finally{m(!1)}},[r,t,a]),L=d.useCallback(async()=>{try{b(!0),k(null);const M=await se.getRiskAssessment(r);M.success&&M.riskAssessment&&(l(M.riskAssessment),t==null||t(M.riskAssessment))}catch(M){k(M)}finally{b(!1)}},[r,t]),_=({riskLevel:M,riskScore:f})=>{const P=Qa[M.toLowerCase()];if(!P)return null;const $=P.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${P.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":P.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Risk level: ${P.label}`,children:[e.jsx($,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),P.label,f&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold",children:[f,"/10"]})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:P.description})]})};return!i&&!u&&!y?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Risk Assessment Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Generate an AI-powered risk assessment based on session data and clinical insights."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:A,className:"btn btn--primary","aria-label":"Generate AI risk assessment",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Generate AI Risk Assessment"]}),e.jsxs("button",{type:"button",onClick:L,className:"btn btn--secondary","aria-label":"Check for existing assessment",children:[e.jsx(te,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Check for Existing Assessment"]})]}),g&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:g.message})})]})]}):u||y?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(te,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:u?"Generating AI risk assessment...":"Loading assessment..."})]}),u&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few moments as AI analyzes the session data..."})})]}):i?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"AI Risk Assessment"]}),e.jsx("div",{className:"flex items-center space-x-3 mt-4 sm:mt-0",children:e.jsxs("button",{type:"button",onClick:A,disabled:u,className:"btn btn--secondary text-xs","aria-label":"Regenerate risk assessment",children:[e.jsx(te,{className:`w-3 h-3 mr-1 ${u?"animate-spin":""}`,"aria-hidden":"true"}),"Regenerate"]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Overall Risk Level"}),e.jsx(_,{riskLevel:i.overallRiskLevel,riskScore:i.riskScore})]}),i.generatedAt&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(ut,{className:"w-4 h-4 mr-1","aria-hidden":"true"}),"Generated"]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:Te(i.generatedAt)})]})]}),i.summary&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ia,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Summary"]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-blue-900 dark:text-blue-100 text-sm leading-relaxed",children:i.summary})})]}),i.keyFactors&&i.keyFactors.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ws,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Key Risk Factors"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:i.keyFactors.map((M,f)=>e.jsxs("li",{className:"text-yellow-900 dark:text-yellow-100 text-sm flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0","aria-hidden":"true"}),M]},f))})})]}),i.recommendations&&i.recommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ha,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recommendations"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:e.jsx("ul",{className:"space-y-2",children:i.recommendations.map((M,f)=>e.jsxs("li",{className:"text-green-900 dark:text-green-100 text-sm flex items-start",children:[e.jsx(ue,{className:"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),M]},f))})})]}),i.immediateActions&&i.immediateActions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Ra,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Immediate Actions Required"]}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("ul",{className:"space-y-2",children:i.immediateActions.map((M,f)=>e.jsxs("li",{className:"text-red-900 dark:text-red-100 text-sm flex items-start",children:[e.jsx(vs,{className:"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),M]},f))})})]}),i.followUpRecommendations&&i.followUpRecommendations.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(ds,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Follow-up Recommendations"]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsx("ul",{className:"space-y-2",children:i.followUpRecommendations.map((M,f)=>e.jsxs("li",{className:"text-purple-900 dark:text-purple-100 text-sm flex items-start",children:[e.jsx(Re,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0","aria-hidden":"true"}),M]},f))})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(Re,{className:"w-3 h-3 mr-1","aria-hidden":"true"}),"Generated: ",Te(i.generatedAt),i.modelVersion&&e.jsxs("span",{className:"ml-4",children:["Model: ",i.modelVersion]})]})})]}),g&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:g.message})})]}):null},gs={queued:{color:"yellow",icon:Re,label:"Queued",description:"Waiting to be processed"},initiated:{color:"blue",icon:Re,label:"Initiated",description:"Session has been created"},running:{color:"blue",icon:te,label:"Processing",description:"Audio is being analyzed"},processing:{color:"blue",icon:te,label:"Processing",description:"Analysis in progress"},succeeded:{color:"green",icon:ue,label:"Completed",description:"Analysis completed successfully"},success:{color:"green",icon:ue,label:"Completed",description:"Analysis completed successfully"},completed:{color:"green",icon:ue,label:"Completed",description:"Analysis completed successfully"},failed:{color:"red",icon:ls,label:"Failed",description:"Analysis encountered an error"},error:{color:"red",icon:ls,label:"Error",description:"An error occurred during processing"}},Xa=()=>{var C,j,n,c,x,p,w,R,B,H,ie,re;const{sessionId:r}=Pt(),s=Ke(),{announceToScreenReader:t}=Oe(),[a,i]=d.useState(null),[l,u]=d.useState(!0),[m,y]=d.useState(null),[b,g]=d.useState(!1),[k,A]=d.useState(!1),[L,_]=d.useState(!1),M=d.useRef(null),f=d.useCallback(async()=>{if(r)try{u(!0),y(null);const V=await se.getSessionData(r);i(V),t(`Session ${r} loaded successfully`)}catch(V){const X=V;y(X),t(`Error loading session: ${X.message}`)}finally{u(!1)}},[r,t]),P=d.useCallback(async()=>{A(!0),await f(),A(!1),t("Session data refreshed")},[f,t]);d.useEffect(()=>{f()},[f]);const $=d.useCallback(()=>{g(V=>{const X=!V;return t(`Raw JSON view ${X?"enabled":"disabled"}`),X})},[t]),J=d.useCallback(()=>{M.current&&(L?(M.current.pause(),_(!1),t("Audio paused")):(M.current.play().catch(()=>{t("Failed to play audio")}),_(!0),t("Audio playing")))},[L,t]),I=d.useCallback(()=>{if(!a)return;const V=JSON.stringify(a,null,2),X=new Blob([V],{type:"application/json"}),N=URL.createObjectURL(X),Y=document.createElement("a");Y.href=N,Y.download=`session-${a.sessionId}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(N),t("Session data download started")},[a,t]),v=d.useCallback(async()=>{if(!(!(a!=null&&a.audioUrl)||!(a!=null&&a.audioFileName))&&a!=null&&a.audioUrl)try{const V=a.audioUrl;window.open(V,"_blank"),window.open(a.audioUrl,"_blank"),t(`Downloading audio file: ${a.audioFileName||"audio file"}`)}catch(V){console.error("Failed to download audio file:",V),t("Failed to download audio file")}},[a,t]),E=d.useCallback(()=>{!a||!window.confirm("Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.")||(t("Redirecting to upload page for re-run..."),s("/upload",{state:{originalSessionId:a.sessionId,audioFileName:a.audioFileName,audioUrl:a.audioUrl,userMetadata:a.userMetadata}}))},[a,s,t]),Q=({status:V})=>{const X=V.toLowerCase();let N=gs[V];N||(X.includes("error")||X.includes("fail")?N=gs.error:N=gs.initiated);const Y=N.icon;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${N.color==="green"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":N.color==="blue"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":N.color==="yellow"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,role:"status","aria-label":`Status: ${N.label}`,children:[e.jsx(Y,{className:`w-4 h-4 mr-2 ${N.color==="blue"&&V==="processing"?"animate-spin":""}`,"aria-hidden":"true"}),N.label]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:N.description})]})};return l?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(te,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading session details..."})]})}):m?e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Session"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:m.message}),e.jsxs("div",{className:"mt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:f,className:"btn btn--primary","aria-label":"Retry loading session",children:"Try Again"}),e.jsx(le,{to:"/sessions",className:"btn btn--secondary",children:"Back to Sessions"})]})]})]})})}):a?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:()=>s("/sessions"),className:"btn btn--secondary","aria-label":"Back to sessions list",children:[e.jsx(Lr,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Back to Sessions"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session Details"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:["ID: ",a.sessionId]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:$,className:"btn btn--secondary","aria-label":`${b?"Hide":"Show"} raw JSON data`,children:[b?e.jsx(ea,{className:"w-4 h-4 mr-2"}):e.jsx(We,{className:"w-4 h-4 mr-2"}),b?"Hide JSON":"Show JSON"]}),e.jsxs("button",{type:"button",onClick:P,disabled:k,className:"btn btn--secondary","aria-label":"Refresh session data",children:[e.jsx(te,{className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:E,className:"btn btn--secondary","aria-label":"Re-run analysis for this session",children:[e.jsx(te,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Re-run"]}),e.jsxs("button",{type:"button",onClick:I,className:"btn btn--primary","aria-label":"Download session data as JSON",children:[e.jsx(cs,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),b&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Raw Session Data"]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto",children:e.jsx("pre",{className:"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all",children:JSON.stringify(a,null,2)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsx(Q,{status:a.status})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ut,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Created"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:He(a.createdAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:Te(a.createdAt)})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Re,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Last Updated"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-gray-900 dark:text-white",children:He(a.updatedAt)}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:Te(a.updatedAt)})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(us,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.userId})]}),a.metadata_user_id&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(us,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Metadata User ID"]}),e.jsx("div",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all",children:a.metadata_user_id})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ra,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Audio Information"]}),e.jsxs("div",{className:"space-y-4",children:[a.audioFileName&&a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("button",{onClick:v,className:"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors",title:"Click to download audio file",children:a.audioFileName})]}),a.audioFileName&&!a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.audioFileName," (download not available)"]})]}),a.audioUrl&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Audio File"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{type:"button",onClick:J,className:"btn btn--secondary","aria-label":`${L?"Pause":"Play"} audio`,children:L?e.jsx(fs,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:L?"Playing audio...":"Audio playback available"})]}),e.jsx("audio",{ref:M,src:a.audioUrl,onPlay:()=>_(!0),onPause:()=>_(!1),onEnded:()=>_(!1),onError:()=>{_(!1),t("Audio playback failed - file may not be accessible")},className:"hidden",preload:"metadata"})]})]})]})]}),a.userMetadata&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(us,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Patient Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.userMetadata.age&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Age"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.age," years"]})]}),a.userMetadata.gender&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gender"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.gender.replace(/[_-]/g," ")})]}),a.userMetadata.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Weight"}),e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:[a.userMetadata.weight," lbs"]})]}),a.userMetadata.race&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Race"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white capitalize",children:a.userMetadata.race})]}),a.userMetadata.ethnicity&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ethnicity"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.ethnicity})]}),a.userMetadata.zipcode&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ZIP Code"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white font-mono",children:a.userMetadata.zipcode})]}),a.userMetadata.language!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Primary Language English"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.userMetadata.language?"Yes":"No"})]}),a.userMetadata.sessionNotes&&e.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Session Notes"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border",children:a.userMetadata.sessionNotes})]})]})]}),(a.analysisResults||a.prediction)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Analysis Results"]}),e.jsxs("div",{className:"space-y-6",children:[(a.analysisResults||a.prediction)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Mental Health Scores"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(((C=a.analysisResults)==null?void 0:C.depressionScore)||((j=a.prediction)==null?void 0:j.predicted_score_depression))&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Depression Score"}),e.jsx(ds,{className:"w-4 h-4 text-blue-600 dark:text-blue-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:((c=(n=a.analysisResults)==null?void 0:n.depressionScore)==null?void 0:c.toFixed(2))||((x=a.prediction)!=null&&x.predicted_score_depression?a.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase()):"N/A")})]}),(((p=a.analysisResults)==null?void 0:p.anxietyScore)||((w=a.prediction)==null?void 0:w.predicted_score_anxiety))&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Anxiety Score"}),e.jsx(gt,{className:"w-4 h-4 text-purple-600 dark:text-purple-400","aria-hidden":"true"})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:((B=(R=a.analysisResults)==null?void 0:R.anxietyScore)==null?void 0:B.toFixed(2))||((H=a.prediction)!=null&&H.predicted_score_anxiety?a.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase()):"N/A")})]})]})]}),((ie=a.analysisResults)==null?void 0:ie.insights)&&a.analysisResults.insights.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Clinical Insights"}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsx("ul",{className:"space-y-2",children:a.analysisResults.insights.map((V,X)=>e.jsxs("li",{className:"text-sm text-yellow-800 dark:text-yellow-200 flex items-start",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0","aria-hidden":"true"}),V]},X))})})]}),((re=a.analysisResults)==null?void 0:re.completedAt)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Analysis Completion"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ue,{className:"w-4 h-4 text-green-600 dark:text-green-400 mr-2","aria-hidden":"true"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 mr-2",children:"Completed:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:Te(a.analysisResults.completedAt)})]})})]})]})]}),e.jsx(Za,{sessionId:a.sessionId,existingAssessment:a.riskAssessment||null,onAssessmentUpdated:V=>{i(X=>X?{...X,riskAssessment:V}:null)}})]}):e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Session Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"The requested session could not be found."}),e.jsx(le,{to:"/sessions",className:"btn btn--primary",children:"Back to Sessions"})]})})},ei=()=>{const{user:r}=_e(),[s,t]=d.useState([]),[a,i]=d.useState(!0),[l,u]=d.useState(null),[m,y]=d.useState({dateRange:"all",scoreType:"all",showTrends:!0}),[b,g]=d.useState(!1),{announceToScreenReader:k}=Oe(),A=Ke(),L=d.useCallback(()=>(r==null?void 0:r.id)||Se(),[r==null?void 0:r.id]),_=d.useCallback(j=>{A(`/sessions/${j}`),k(`Navigating to session ${j} details`)},[A,k]),M=d.useCallback(async()=>{try{i(!0),u(null);const j=L(),c=(await se.getUserSessions(j)).sessions.filter(x=>x.analysisResults||x.prediction);t(c),k(`${c.length} prediction sessions loaded`)}catch(j){const n=j;u(n),k(`Error loading predictions: ${n.message}`)}finally{i(!1)}},[k]);d.useEffect(()=>{M()},[M]);const f=d.useMemo(()=>{if(m.dateRange==="all")return s;const j=new Date,n=new Date;switch(m.dateRange){case"week":n.setDate(j.getDate()-7);break;case"month":n.setMonth(j.getMonth()-1);break;case"quarter":n.setMonth(j.getMonth()-3);break;case"year":n.setFullYear(j.getFullYear()-1);break}return s.filter(c=>new Date(c.createdAt)>=n)},[s,m.dateRange]),P=d.useMemo(()=>f.map(j=>{var p,w;const n=R=>{if(!R)return null;switch(R.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return null}},c=n((p=j.prediction)==null?void 0:p.predicted_score_depression),x=n((w=j.prediction)==null?void 0:w.predicted_score_anxiety);return{date:j.createdAt,depression:c,anxiety:x,overall:null,sessionId:j.sessionId}}).sort((j,n)=>new Date(j.date).getTime()-new Date(n.date).getTime()),[f]),$=d.useMemo(()=>{const j={depression:[],anxiety:[]},n=[{category:"no_to_mild",label:"No to Mild",color:"bg-green-400"},{category:"mild_to_moderate",label:"Mild to Moderate",color:"bg-yellow-500"},{category:"moderate_to_severe",label:"Moderate to Severe",color:"bg-red-600"},{category:"no_or_minimal",label:"No or Minimal",color:"bg-green-400"},{category:"moderate",label:"Moderate",color:"bg-orange-500"},{category:"moderately_severe",label:"Moderately Severe",color:"bg-red-500"},{category:"severe",label:"Severe",color:"bg-red-700"}],c=f.map(p=>{var w;return(w=p.prediction)==null?void 0:w.predicted_score_depression}).filter(p=>p!==void 0);n.forEach(p=>{const w=c.filter(B=>B===p.category).length,R=c.length>0?w/c.length*100:0;w>0&&j.depression.push({category:p.label,count:w,percentage:R,color:p.color})});const x=f.map(p=>{var w;return(w=p.prediction)==null?void 0:w.predicted_score_anxiety}).filter(p=>p!==void 0);return n.forEach(p=>{const w=x.filter(B=>B===p.category).length,R=x.length>0?w/x.length*100:0;w>0&&j.anxiety.push({category:p.label,count:w,percentage:R,color:p.color})}),j},[f]),J=d.useMemo(()=>{const j={},n=p=>{if(!p)return 0;switch(p.toLowerCase()){case"no_to_mild":return 1;case"mild_to_moderate":return 2;case"moderate_to_severe":return 3;case"no_or_minimal":return 1;case"moderate":return 2;case"moderately_severe":return 3;case"severe":return 4;default:return 0}},c=f.map(p=>{var w;return(w=p.prediction)==null?void 0:w.predicted_score_depression}).filter(p=>p!==void 0);if(c.length<2)j.depression={direction:"stable",change:0,period:"insufficient data"};else{const p=c.map(n),w=p.slice(0,Math.floor(p.length/2)),R=p.slice(Math.floor(p.length/2)),B=w.reduce((re,V)=>re+V,0)/w.length,ie=R.reduce((re,V)=>re+V,0)/R.length-B;j.depression={direction:Math.abs(ie)<.5?"stable":ie<0?"improving":"worsening",change:Math.abs(ie),period:`${f.length} sessions`}}const x=f.map(p=>{var w;return(w=p.prediction)==null?void 0:w.predicted_score_anxiety}).filter(p=>p!==void 0);if(x.length<2)j.anxiety={direction:"stable",change:0,period:"insufficient data"};else{const p=x.map(n),w=p.slice(0,Math.floor(p.length/2)),R=p.slice(Math.floor(p.length/2)),B=w.reduce((re,V)=>re+V,0)/w.length,ie=R.reduce((re,V)=>re+V,0)/R.length-B;j.anxiety={direction:Math.abs(ie)<.5?"stable":ie<0?"improving":"worsening",change:Math.abs(ie),period:`${f.length} sessions`}}return j.overall={direction:"stable",change:0,period:"coming soon"},j},[f]),I=d.useMemo(()=>{const j={totalSessions:f.length,avgDepression:0,avgAnxiety:0,avgOverall:0,latestSession:null,improvementSessions:0};if(f.length===0)return j;const n=f.map(x=>{var p;return(p=x.prediction)==null?void 0:p.predictedScoreDepression}).filter(x=>x!==void 0),c=f.map(x=>{var p;return(p=x.prediction)==null?void 0:p.predictedScoreAnxiety}).filter(x=>x!==void 0);if(n.length>0){const x={};n.forEach(w=>{x[w]=(x[w]||0)+1});const p=Object.entries(x).sort(([,w],[,R])=>R-w)[0][0];j.avgDepression=x[p]}if(c.length>0){const x={};c.forEach(w=>{x[w]=(x[w]||0)+1});const p=Object.entries(x).sort(([,w],[,R])=>R-w)[0][0];j.avgAnxiety=x[p]}return j.latestSession=f.sort((x,p)=>new Date(p.createdAt).getTime()-new Date(x.createdAt).getTime())[0],j.improvementSessions=0,j},[f]),v=d.useCallback((j,n)=>{y(c=>({...c,[j]:n})),k(`Filter ${j} changed to ${n}`)},[k]),E=d.useCallback(()=>{const j=JSON.stringify(f,null,2),n=new Blob([j],{type:"application/json"}),c=URL.createObjectURL(n),x=document.createElement("a");x.href=c,x.download=`predictions-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c),k("Predictions data download started")},[f,k]),Q=({trend:j,label:n})=>{const c=j.direction==="improving"?yt:j.direction==="worsening"?ds:qe,x=j.direction==="improving"?"text-green-600 dark:text-green-400":j.direction==="worsening"?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:`w-4 h-4 ${x}`,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n}),e.jsxs("span",{className:`text-sm font-medium ${x} capitalize`,children:[j.direction,j.period==="insufficient data"?" (need more sessions)":j.period==="coming soon"?" (analysis coming soon)":` (${j.period})`]})]})},C=({data:j,type:n,onBarClick:c})=>{const x=j.map(N=>N[n]).filter(N=>N!==null);if(x.length===0)return e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});const p=Math.max(...x),w=Math.min(...x),R=p-w||1,B=N=>{switch(N){case 1:return"No to Mild / No or Minimal";case 2:return"Mild to Moderate / Moderate";case 3:return"Moderate to Severe / Moderately Severe";case 4:return"Severe";default:return"Unknown"}},H=(N,Y)=>{if(Y==="depression")switch(N){case 1:return"bg-blue-400";case 2:return"bg-blue-600";case 3:return"bg-blue-800";default:return"bg-blue-500"}else if(Y==="anxiety")switch(N){case 1:return"bg-purple-400";case 2:return"bg-purple-600";case 3:return"bg-purple-700";case 4:return"bg-purple-900";default:return"bg-purple-500"}else switch(N){case 1:return"bg-green-400";case 2:return"bg-green-600";case 3:return"bg-green-700";case 4:return"bg-green-800";default:return"bg-green-500"}},ie=N=>[{score:1,label:"No/Minimal"},{score:2,label:"Mild"},{score:3,label:"Moderate"},{score:4,label:"Mod-Severe"},{score:5,label:"Severe"}].map(K=>({...K,color:H(K.score,N)})),re=new Set(x),X=ie(n).filter(N=>re.has(N.score));return e.jsxs("div",{children:[e.jsx("div",{className:"h-32 flex items-end space-x-1 px-4 py-2 mb-4",children:j.map((N,Y)=>{const K=N[n];if(K===null)return null;const T=(K-w)/R*100,me=H(K,n),ke=B(K),Je=new Date(N.date).toLocaleDateString();return e.jsx("div",{className:`flex-1 ${me} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`,style:{"--chart-height":`${Math.max(T,8)}%`},onClick:()=>c(N.sessionId),role:"button",tabIndex:0,onKeyDown:Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),c(N.sessionId))},"aria-label":`View session details for ${ke} score on ${Je}`,children:e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsx("div",{className:"font-medium",children:ke}),e.jsx("div",{className:"text-gray-300",children:Je}),e.jsxs("div",{className:"text-gray-300",children:["Session: ",N.sessionId.slice(-8)]}),e.jsx("div",{className:"text-gray-400 text-xs mt-1",children:"Click to view details"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900"})]})},Y)})}),X.length>0&&e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 font-medium",children:"Legend:"}),X.map(N=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-3 h-3 ${N.color} rounded`}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:N.label})]},N.score))]})})]})};return a?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx(te,{className:"w-8 h-8 text-blue-600 animate-spin mr-3","aria-hidden":"true"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Loading predictions..."})]})}):l?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-5 h-5 text-red-500 mr-3","aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Error Loading Predictions"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:l.message}),e.jsx("button",{type:"button",onClick:M,className:"mt-4 btn btn--primary","aria-label":"Retry loading predictions",children:"Try Again"})]})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Predictions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Analyze your mental health trends and insights over time"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>g(!b),className:"btn btn--secondary","aria-expanded":b?"true":"false","aria-label":`${b?"Hide":"Show"} filter options`,children:[e.jsx(ht,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filters",b?e.jsx(xt,{className:"w-4 h-4 ml-2"}):e.jsx(mt,{className:"w-4 h-4 ml-2"})]}),e.jsxs("button",{type:"button",onClick:M,className:"btn btn--secondary","aria-label":"Refresh predictions data",children:[e.jsx(te,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Refresh"]}),e.jsxs("button",{type:"button",onClick:E,className:"btn btn--primary",disabled:f.length===0,"aria-label":"Download predictions data",children:[e.jsx(cs,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Download"]})]})]}),b&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-range",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("select",{id:"date-range",value:m.dateRange,onChange:j=>v("dateRange",j.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"week",children:"Past Week"}),e.jsx("option",{value:"month",children:"Past Month"}),e.jsx("option",{value:"quarter",children:"Past Quarter"}),e.jsx("option",{value:"year",children:"Past Year"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"score-type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Focus Score"}),e.jsxs("select",{id:"score-type",value:m.scoreType,onChange:j=>v("scoreType",j.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Scores"}),e.jsx("option",{value:"depression",children:"Depression"}),e.jsx("option",{value:"anxiety",children:"Anxiety"}),e.jsx("option",{value:"overall",children:"Overall"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.showTrends,onChange:j=>v("showTrends",j.target.checked),className:"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show trend analysis"})]})})]})}),f.length===0?e.jsxs("div",{className:"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4","aria-hidden":"true"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Prediction Data Available"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:s.length===0?"You haven't completed any analysis sessions yet.":"No sessions found for the selected date range."}),e.jsx(le,{to:"/upload",className:"btn btn--primary",children:"Start Your First Analysis"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(qe,{className:"w-8 h-8 text-blue-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:I.totalSessions})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Ce,{className:"w-8 h-8 text-purple-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Depression (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const j=f.map(x=>{var p;return(p=x.prediction)==null?void 0:p.predicted_score_depression}).filter(x=>x!==void 0);if(j.length===0)return"â€”";const n={};return j.forEach(x=>{n[x]=(n[x]||0)+1}),Object.entries(n).sort(([,x],[,p])=>p-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(gt,{className:"w-8 h-8 text-red-600","aria-hidden":"true"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Anxiety (Most Common)"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(()=>{const j=f.map(x=>{var p;return(p=x.prediction)==null?void 0:p.predicted_score_anxiety}).filter(x=>x!==void 0);if(j.length===0)return"â€”";const n={};return j.forEach(x=>{n[x]=(n[x]||0)+1}),Object.entries(n).sort(([,x],[,p])=>p-x)[0][0].replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})()})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(m.scoreType==="all"||m.scoreType==="depression")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Qs,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Depression Score Trend"]}),e.jsx(C,{data:P,type:"depression",onBarClick:_}),m.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(Q,{trend:J.depression,label:"Trend:"})})]}),(m.scoreType==="all"||m.scoreType==="anxiety")&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Wr,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Anxiety Score Trend"]}),e.jsx(C,{data:P,type:"anxiety",onBarClick:_}),m.showTrends&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsx(Q,{trend:J.anxiety,label:"Trend:"})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Qs,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Score Distribution"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries($).map(([j,n])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize",children:[j," Scores"]}),e.jsx("div",{className:"space-y-2",children:n.map(c=>e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:c.category}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[c.count," (",c.percentage.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${c.color} progress-dynamic progress-animated`,style:{"--progress-width":`${c.percentage}%`}})})]})},c.category))})]},j))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Re,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Recent Analysis Sessions"]}),e.jsx(le,{to:"/sessions",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm",children:"View All Sessions â†’"})]}),e.jsx("div",{className:"space-y-4",children:f.slice(0,5).map(j=>{var n,c;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${j.status==="succeeded"?"bg-green-500":j.status==="processing"?"bg-blue-500":j.status==="failed"?"bg-red-500":"bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:j.audioFileName||`Session ${j.sessionId.slice(-8)}`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:He(j.createdAt)})]})]})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[((n=j.prediction)==null?void 0:n.predicted_score_depression)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Depression"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:j.prediction.predicted_score_depression.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),((c=j.prediction)==null?void 0:c.predicted_score_anxiety)&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Anxiety"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:j.prediction.predicted_score_anxiety.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase())})]}),e.jsx(le,{to:`/sessions/${j.sessionId}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400","aria-label":`View session ${j.sessionId}`,children:e.jsx(We,{className:"w-4 h-4","aria-hidden":"true"})})]})]},j.sessionId)})})]})]})]})},js=(r,s)=>s>0?Math.round(r/s*100):0,si=r=>{const s=r.length,t=new Set(r.map(I=>I.userId)).size,a=r.filter(I=>I.status==="succeeded"||I.status==="completed"),i=r.filter(I=>I.status==="failed"),l=r.filter(I=>I.status==="processing"),u=js(a.length,s),m=t>0?Math.round(s/t*10)/10:0,y=new Date(Date.now()-24*60*60*1e3),b=r.filter(I=>new Date(I.createdAt)>y).length,g={low:0,medium:0,high:0,unknown:0};r.forEach(I=>{var E;const v=((E=I.analysisResults)==null?void 0:E.riskLevel)||"unknown";v in g&&g[v]++});const k={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},A={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};a.forEach(I=>{var Q,C,j,n;let v=null,E=null;if(I.prediction){const c=I.prediction;v=c.predictedScoreDepression||c.predicted_score_depression,E=c.predictedScoreAnxiety||c.predicted_score_anxiety}if(!v&&((Q=I.analysisResults)==null?void 0:Q.depressionScore)!==null&&((C=I.analysisResults)==null?void 0:C.depressionScore)!==void 0){const c=I.analysisResults.depressionScore;c>=0&&c<=4?v="no_to_mild":c>=5&&c<=9||c>=10&&c<=14?v="mild_to_moderate":c>=15&&c<=19?v="moderate_to_severe":c>=20&&(v="severe")}if(!E&&((j=I.analysisResults)==null?void 0:j.anxietyScore)!==null&&((n=I.analysisResults)==null?void 0:n.anxietyScore)!==void 0){const c=I.analysisResults.anxietyScore;c>=0&&c<=4?E="no_or_minimal":c>=5&&c<=9?E="mild":c>=10&&c<=14?E="moderate":c>=15&&c<=19?E="moderately_severe":c>=20&&(E="severe")}v&&v in k&&k[v]++,E&&E in A&&A[E]++});const L=[];for(let I=6;I>=0;I--){const v=new Date;v.setDate(v.getDate()-I);const E=v.toISOString().split("T")[0],Q=r.filter(C=>C.createdAt.split("T")[0]===E).length;L.push({date:E,count:Q})}const _=new Map;r.forEach(I=>{const v=I.metadata_user_id||I.userId;_.has(v)||_.set(v,{totalSessions:0,successfulSessions:0,sessions:[]});const E=_.get(v);E.totalSessions++,E.sessions.push(I),(I.status==="succeeded"||I.status==="completed")&&E.successfulSessions++});const M=Array.from(_.entries()).map(([I,v])=>{var w;const E=js(v.successfulSessions,v.totalSessions),Q=v.sessions.filter(R=>R.status==="succeeded"||R.status==="completed"),C=Q.map(R=>{var B;return(B=R.analysisResults)==null?void 0:B.confidence}).filter(R=>R!=null&&typeof R=="number"),j=C.length>0?C.reduce((R,B)=>R+B,0)/C.length:0,n={low:0,medium:0,high:0,unknown:0};v.sessions.forEach(R=>{var H;const B=((H=R.analysisResults)==null?void 0:H.riskLevel)||"unknown";B in n&&n[B]++});const c={no_to_mild:0,mild_to_moderate:0,moderate_to_severe:0,severe:0},x={no_or_minimal:0,mild:0,moderate:0,moderately_severe:0,severe:0};Q.forEach(R=>{var ie,re,V,X;let B=null,H=null;if(R.prediction){const N=R.prediction;B=N.predictedScoreDepression||N.predicted_score_depression,H=N.predictedScoreAnxiety||N.predicted_score_anxiety}if(!B&&((ie=R.analysisResults)==null?void 0:ie.depressionScore)!==null&&((re=R.analysisResults)==null?void 0:re.depressionScore)!==void 0){const N=R.analysisResults.depressionScore;N>=0&&N<=4?B="no_to_mild":N>=5&&N<=9||N>=10&&N<=14?B="mild_to_moderate":N>=15&&N<=19?B="moderate_to_severe":N>=20&&(B="severe")}if(!H&&((V=R.analysisResults)==null?void 0:V.anxietyScore)!==null&&((X=R.analysisResults)==null?void 0:X.anxietyScore)!==void 0){const N=R.analysisResults.anxietyScore;N>=0&&N<=4?H="no_or_minimal":N>=5&&N<=9?H="mild":N>=10&&N<=14?H="moderate":N>=15&&N<=19?H="moderately_severe":N>=20&&(H="severe")}B&&B in c&&c[B]++,H&&H in x&&x[H]++});const p=v.sessions.reduce((R,B)=>new Date(B.updatedAt)>new Date(R)?B.updatedAt:R,((w=v.sessions[0])==null?void 0:w.updatedAt)||new Date().toISOString());return{userId:I,totalSessions:v.totalSessions,successfulSessions:v.successfulSessions,successRate:E,avgConfidence:Math.round(j*100)/100,riskDistribution:n,lastActivity:p,depressionScores:c,anxietyScores:x}}).sort((I,v)=>v.totalSessions-I.totalSessions),f={ageDistribution:{},genderDistribution:{},raceDistribution:{},ethnicityDistribution:{},languageDistribution:{},weightDistribution:{},zipCodeDistribution:{}},P=I=>{var v,E;if(I.prediction){const Q=I.prediction,C=Q.predictedScoreDepression||Q.predicted_score_depression;return C==="moderate_to_severe"||C==="severe"}return((v=I.analysisResults)==null?void 0:v.depressionScore)!==null&&((E=I.analysisResults)==null?void 0:E.depressionScore)!==void 0?I.analysisResults.depressionScore>=10:!1},$=I=>{var v,E;if(I.prediction){const Q=I.prediction,C=Q.predictedScoreAnxiety||Q.predicted_score_anxiety;return C==="moderate"||C==="moderately_severe"||C==="severe"}return((v=I.analysisResults)==null?void 0:v.anxietyScore)!==null&&((E=I.analysisResults)==null?void 0:E.anxietyScore)!==void 0?I.analysisResults.anxietyScore>=10:!1};return r.filter(I=>I.userMetadata).forEach(I=>{const v=I.userMetadata,E=P(I),Q=$(I);if(v.age){let C;v.age<25?C="18-24":v.age<35?C="25-34":v.age<45?C="35-44":v.age<55?C="45-54":v.age<65?C="55-64":C="65+",f.ageDistribution[C]||(f.ageDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.ageDistribution[C].totalSessions++,E&&f.ageDistribution[C].depressionCases++,Q&&f.ageDistribution[C].anxietyCases++}if(v.gender){const C=v.gender;f.genderDistribution[C]||(f.genderDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.genderDistribution[C].totalSessions++,E&&f.genderDistribution[C].depressionCases++,Q&&f.genderDistribution[C].anxietyCases++}if(v.race){const C=v.race;f.raceDistribution[C]||(f.raceDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.raceDistribution[C].totalSessions++,E&&f.raceDistribution[C].depressionCases++,Q&&f.raceDistribution[C].anxietyCases++}if(v.ethnicity){const C=v.ethnicity;f.ethnicityDistribution[C]||(f.ethnicityDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.ethnicityDistribution[C].totalSessions++,E&&f.ethnicityDistribution[C].depressionCases++,Q&&f.ethnicityDistribution[C].anxietyCases++}if(v.language!==void 0){const C=v.language?"English":"Other";f.languageDistribution[C]||(f.languageDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.languageDistribution[C].totalSessions++,E&&f.languageDistribution[C].depressionCases++,Q&&f.languageDistribution[C].anxietyCases++}if(v.weight){let C;v.weight<120?C="Under 120 lbs":v.weight<150?C="120-149 lbs":v.weight<180?C="150-179 lbs":v.weight<220?C="180-219 lbs":C="220+ lbs",f.weightDistribution[C]||(f.weightDistribution[C]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.weightDistribution[C].totalSessions++,E&&f.weightDistribution[C].depressionCases++,Q&&f.weightDistribution[C].anxietyCases++}if(v.zipcode){const C=v.zipcode.substring(0,2);let j;["0","1","2"].some(n=>C.startsWith(n))?j="Northeast":["3","4"].some(n=>C.startsWith(n))?j="Southeast":["5","6"].some(n=>C.startsWith(n))?j="South Central":["7","8"].some(n=>C.startsWith(n))?j="Mountain/West":["9"].some(n=>C.startsWith(n))?j="Pacific":j="Other/International",f.zipCodeDistribution[j]||(f.zipCodeDistribution[j]={depressionCases:0,anxietyCases:0,totalSessions:0}),f.zipCodeDistribution[j].totalSessions++,E&&f.zipCodeDistribution[j].depressionCases++,Q&&f.zipCodeDistribution[j].anxietyCases++}}),{overview:{totalSessions:s,uniqueUsers:t,successRate:u,avgSessionsPerUser:m,recentActivity:b},sessionStatus:{succeeded:a.length,failed:i.length,processing:l.length,total:s},riskLevels:{...g,total:s},predictions:{depression:{...k,total:a.length},anxiety:{...A,total:a.length}},timeData:L,riskDistribution:g,userStats:M,correlations:f}},et=({title:r,value:s,subtitle:t,icon:a,trend:i,color:l="text-blue-600"})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:r}),e.jsx("p",{className:`text-2xl font-bold ${l} dark:text-white mt-1`,children:s}),t&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t})]}),e.jsx("div",{className:`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${l}`,children:a})]}),i&&e.jsxs("div",{className:"flex items-center mt-4",children:[i==="up"&&e.jsx(ds,{className:"h-4 w-4 text-green-500 mr-1"}),i==="down"&&e.jsx(yt,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("span",{className:`text-sm ${i==="up"?"text-green-600":i==="down"?"text-red-600":"text-gray-500"}`,children:i==="up"?"Trending up":i==="down"?"Trending down":"Stable"})]})]}),ps=({title:r,data:s,total:t})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),e.jsx("div",{className:"space-y-3",children:s.map((a,i)=>{const l=js(a.value,t);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.label}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[a.value," (",l,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${a.color}`,style:{width:`${l}%`},role:"progressbar","aria-label":`${a.label}: ${a.value} (${l}%)`})})]},i)})})]}),ti=({title:r,data:s})=>{const t=Math.max(...s.map(l=>l.count),1),a=0,i=t-a||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-48",children:e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})}),e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"rgb(59 130 246)",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"rgb(59 130 246)",stopOpacity:"0.6"})]})]}),e.jsx("rect",{width:"100",height:"100",fill:"url(#grid)"}),s.map((l,u)=>{const m=80/s.length,y=u/(s.length-1)*(100-m)+m/2,b=(l.count-a)/i*95,g=100-b;return e.jsx("rect",{x:y-m/2,y:g,width:m*.6,height:b,fill:"url(#barGradient)",stroke:"rgb(59 130 246)",strokeWidth:"0.2",className:"transition-all duration-300 hover:opacity-80",rx:"0.5"},u)})]})}),e.jsx("div",{className:"flex items-center justify-between mt-4 px-2",children:s.map((l,u)=>{const m=new Date(l.date),y=m.toLocaleDateString("en-US",{weekday:"short"}),b=m.toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:y}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:b}),e.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1",children:l.count})]},u)})})]})},Ie=({title:r,data:s,subtitle:t})=>{const a=Object.keys(s);return a.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:t}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No metadata available for this correlation"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:r}),t&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:t}),e.jsx("div",{className:"space-y-4",children:a.map((i,l)=>{const u=s[i],m=u.totalSessions>0?u.depressionCases/u.totalSessions*100:0,y=u.totalSessions>0?u.anxietyCases/u.totalSessions*100:0;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:i}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[u.totalSessions," sessions"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Depression Cases"}),e.jsxs("span",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:[u.depressionCases," (",m.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-red-500 rounded-full transition-all duration-500",style:{width:`${m}%`},role:"progressbar","aria-label":`Depression rate: ${m.toFixed(1)}%`})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anxiety Cases"}),e.jsxs("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:[u.anxietyCases," (",y.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-orange-500 rounded-full transition-all duration-500",style:{width:`${y}%`},role:"progressbar","aria-label":`Anxiety rate: ${y.toFixed(1)}%`})})]})]},l)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:a.reduce((i,l)=>i+s[l].depressionCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Depression Cases"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:a.reduce((i,l)=>i+s[l].anxietyCases,0)}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total Anxiety Cases"})]})]})})]})},ri=({title:r,depressionData:s,anxietyData:t})=>{const a=[{depression:s.no_to_mild,anxiety:t.no_or_minimal,severity:"Low",label:"Minimal/None"},{depression:s.mild_to_moderate,anxiety:t.mild,severity:"Mild",label:"Mild"},{depression:s.moderate_to_severe,anxiety:t.moderate,severity:"Moderate",label:"Moderate"},{depression:s.severe,anxiety:t.moderately_severe+t.severe,severity:"High",label:"Severe"}],i=Math.max(...a.map(u=>Math.max(u.depression,u.anxiety)),10),l=u=>{switch(u){case"Low":return"fill-green-500 stroke-green-600";case"Mild":return"fill-yellow-500 stroke-yellow-600";case"Moderate":return"fill-orange-500 stroke-orange-600";case"High":return"fill-red-500 stroke-red-600";default:return"fill-gray-500 stroke-gray-600"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"relative h-[28rem]",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 600 350",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"correlationGrid",width:"50",height:"35",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 35",fill:"none",stroke:"rgb(229 231 235)",strokeWidth:"0.5",className:"dark:stroke-gray-600"})})}),e.jsx("rect",{width:"600",height:"350",fill:"url(#correlationGrid)"}),e.jsx("line",{x1:"70",y1:"310",x2:"550",y2:"310",stroke:"rgb(107 114 128)",strokeWidth:"2"}),e.jsx("line",{x1:"70",y1:"310",x2:"70",y2:"40",stroke:"rgb(107 114 128)",strokeWidth:"2"}),a.map((u,m)=>{const y=70+u.depression/i*480,b=310-u.anxiety/i*270,g=Math.max(Math.sqrt(u.depression+u.anxiety)*3,10);return e.jsxs("g",{children:[e.jsx("circle",{cx:y,cy:b,r:g,className:`${l(u.severity)} opacity-70 hover:opacity-90 transition-opacity`,strokeWidth:"2"}),e.jsx("text",{x:y,y:b+5,textAnchor:"middle",className:"text-sm fill-white font-bold",children:u.depression+u.anxiety})]},m)}),e.jsx("text",{x:"310",y:"335",textAnchor:"middle",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"Depression Cases â†’"}),e.jsx("text",{x:"40",y:"175",textAnchor:"middle",transform:"rotate(-90 40 175)",className:"text-sm font-medium fill-gray-700 dark:fill-gray-300",children:"â† Anxiety Cases"})]})}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:a.map((u,m)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l(u.severity).replace("fill-","bg-").replace("stroke-","border-").replace(" stroke-gray-600","").replace(" stroke-green-600","").replace(" stroke-yellow-600","").replace(" stroke-orange-600","").replace(" stroke-red-600","")}`}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:u.label})]},m))})]})},ai=({title:r,sessionStatus:s})=>{const t=[{label:"Total Sessions",value:s.total,color:"bg-blue-500"},{label:"In Processing",value:s.processing,color:"bg-yellow-500"},{label:"Completed",value:s.succeeded,color:"bg-green-500"},{label:"Failed",value:s.failed,color:"bg-red-500"}],a=s.total||1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-6",children:r}),e.jsx("div",{className:"space-y-4",children:t.map((i,l)=>{const u=i.value/a*100,m=l>0?(i.value/t[0].value*100).toFixed(1):"100.0";return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i.label}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:i.value}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",m,"%)"]})]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:`h-full ${i.color} transition-all duration-700 ease-out flex items-center justify-center relative`,style:{width:`${u}%`},children:u>20&&e.jsx("span",{className:"text-xs font-medium text-white",children:i.value})}),l<t.length-1&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]},l)})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[(s.succeeded/s.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Success Rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[(s.failed/s.total*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Failure Rate"})]})]})})]})},ii=({userStats:r})=>{const[s,t]=d.useState(!1),[a,i]=d.useState(!1),l=g=>new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),u=(g,k)=>{if(k===0)return"text-gray-400";switch(g){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},m=r.length,y=m>0?Math.round(r.reduce((g,k)=>g+k.totalSessions,0)/m*10)/10:0,b=r.length>0?r.reduce((g,k)=>k.avgConfidence>g.avgConfidence?k:g,r[0]):null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 overflow-visible",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(bt,{className:"h-5 w-5 mr-2 text-blue-500"}),"Per-User Analytics"]}),e.jsxs("div",{className:"flex space-x-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:m}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:y}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Avg Sessions"})]}),b&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-blue-600",children:[(b.avgConfidence*100).toFixed(1),"%"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Highest Avg Confidence"})]})]})]}),r.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No user data available"}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:"Risk Distribution Legend:"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium",children:"L"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Low Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium",children:"M"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Medium Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium",children:"H"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"High Risk"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto overflow-y-visible relative",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-900 dark:text-white w-48",children:"User ID"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Sessions"}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white",children:e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Risk Distribution"}),e.jsx("button",{type:"button",onClick:()=>i(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Risk Distribution information",children:e.jsx(Ve,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]})})}),e.jsx("th",{className:"text-center py-3 px-2 font-medium text-gray-900 dark:text-white relative",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Avg Confidence"}),e.jsx("button",{type:"button",onClick:()=>t(!0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Show Average Confidence information",children:e.jsx(Ve,{className:"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer"})})]}),e.jsx("span",{className:"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1",children:"(Analysis accuracy 0-100%)"})]})}),e.jsx("th",{className:"text-right py-3 px-2 font-medium text-gray-900 dark:text-white",children:"Last Activity"})]})}),e.jsx("tbody",{children:r.map((g,k)=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${k%2===0?"bg-gray-50 dark:bg-gray-800":"bg-white dark:bg-gray-900"}`,children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-white",children:e.jsx("div",{className:"truncate max-w-[200px]",title:g.userId,children:g.userId})})}),e.jsxs("td",{className:"py-3 px-2 text-center",children:[e.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:g.totalSessions}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[g.successfulSessions," successful"]})]}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2 text-xs",children:[e.jsxs("span",{className:`px-1 py-0.5 rounded ${u("low",g.riskDistribution.low)}`,children:["L:",g.riskDistribution.low]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${u("medium",g.riskDistribution.medium)}`,children:["M:",g.riskDistribution.medium]}),e.jsxs("span",{className:`px-1 py-0.5 rounded ${u("high",g.riskDistribution.high)}`,children:["H:",g.riskDistribution.high]})]})}),e.jsx("td",{className:"py-3 px-2 text-center",children:e.jsxs("div",{className:"text-gray-900 dark:text-white font-medium",children:[(g.avgConfidence*100).toFixed(1),"%"]})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:l(g.lastActivity)})})]},g.userId))})]})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>t(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Average Confidence Information"}),e.jsx("button",{type:"button",onClick:()=>t(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(Fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Average Confidence Calculation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Calculated from AI model confidence scores"}),e.jsx("div",{children:"â€¢ Averaged across all successful sessions per user"}),e.jsx("div",{children:"â€¢ Related to risk distribution/evaluation accuracy"}),e.jsx("div",{children:"â€¢ Higher values indicate more reliable assessments"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy range: 0-100%"})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Risk Distribution Information"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded","aria-label":"Close modal",children:e.jsx(Fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"font-medium text-center text-gray-900 dark:text-white mb-3",children:"Risk Distribution Explanation:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:"â€¢ Shows the distribution of risk levels across all user sessions"}),e.jsx("div",{children:"â€¢ Visualized as colored dots representing risk categories"}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full mr-1"}),"Low Risk: Minimal behavioral health concerns"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-yellow-500 rounded-full mr-1"}),"Medium Risk: Moderate concerns requiring attention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full mr-1"}),"High Risk: Significant concerns requiring intervention"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full mr-1"}),"Unknown: Risk level could not be determined"]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:"Analysis accuracy: 0-100% (higher confidence = more reliable risk assessment)"})]})]})})]})},ni=()=>{const[r,s]=d.useState(null),[t,a]=d.useState(!1),[i,l]=d.useState(null),[u,m]=d.useState(new Date),{announceToScreenReader:y}=Oe(),b=parseInt("69")*1e3,g=d.useCallback(async()=>{try{a(!0),l(null);let A=[];try{const _=Date.now();console.log("ðŸ”„ ControlPanel: Fetching data with cache-buster:",_);const M=await se.getAllSessions();A=M.sessions,console.log("ðŸ“Š ControlPanel: Fetched sessions data:",{timestamp:_,totalCount:A.length,responseCount:M.count,firstFewSessions:A.slice(0,3).map(f=>({sessionId:f.sessionId,userId:f.userId,status:f.status,createdAt:f.createdAt}))})}catch(_){console.warn("getAllSessions endpoint not available:",_),A=[]}const L=si(A);console.log("ðŸ“ˆ ControlPanel: Aggregated analytics:",{totalSessions:L.overview.totalSessions,uniqueUsers:L.overview.uniqueUsers,successRate:L.overview.successRate,sessionStatusBreakdown:L.sessionStatus}),s(L),m(new Date),y("Control panel data loaded successfully")}catch(A){const L=A;l(L),y(`Error loading control panel data: ${L.message}`)}finally{a(!1)}},[y]);d.useEffect(()=>{g()},[g]),d.useEffect(()=>{console.log("ðŸ”„ ControlPanel: Setting up auto-refresh with interval:",b/1e3,"seconds");const A=setInterval(()=>{console.log("ðŸ”„ ControlPanel: Auto-refresh triggered, loading state:",t),g()},b);return()=>{console.log("ðŸ”„ ControlPanel: Cleaning up auto-refresh interval"),clearInterval(A)}},[g,b]);const k=d.useCallback(()=>{l(null),g()},[g]);return t?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"h-6 w-6 animate-spin text-blue-500"}),e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading control panel data..."})]})})})}):i?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ye,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Error Loading Control Panel"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:i.message}),e.jsxs("button",{onClick:k,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Summary"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"System-wide analytics and insights from all users and sessions"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",u.toLocaleTimeString()]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Auto-refresh: ",b/1e3,"s intervals"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:g,disabled:t,className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm","aria-label":"Refresh control panel data",children:[e.jsx(te,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),"Refresh"]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsx(et,{title:"Total Sessions",value:r.overview.totalSessions,subtitle:"All time",icon:e.jsx(qe,{className:"h-6 w-6"}),color:"text-blue-600"}),e.jsx(et,{title:"Unique Users",value:r.overview.uniqueUsers,subtitle:"Active users",icon:e.jsx(bt,{className:"h-6 w-6"}),color:"text-green-600"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ps,{title:"Risk Level Distribution",data:[{label:"Low Risk",value:r.riskLevels.low,color:"bg-green-500"},{label:"Medium Risk",value:r.riskLevels.medium,color:"bg-yellow-500"},{label:"High Risk",value:r.riskLevels.high,color:"bg-red-500"},{label:"Unknown",value:r.riskLevels.unknown,color:"bg-gray-500"}],total:r.riskLevels.total})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(ps,{title:"Depression Score Distribution",data:[{label:"No to Mild",value:r.predictions.depression.no_to_mild,color:"bg-green-500"},{label:"Mild to Moderate",value:r.predictions.depression.mild_to_moderate,color:"bg-yellow-500"},{label:"Moderate to Severe",value:r.predictions.depression.moderate_to_severe,color:"bg-orange-500"},{label:"Severe",value:r.predictions.depression.severe,color:"bg-red-500"}],total:r.predictions.depression.total}),e.jsx(ps,{title:"Anxiety Score Distribution",data:[{label:"No or Minimal",value:r.predictions.anxiety.no_or_minimal,color:"bg-green-500"},{label:"Mild",value:r.predictions.anxiety.mild,color:"bg-yellow-500"},{label:"Moderate",value:r.predictions.anxiety.moderate,color:"bg-orange-500"},{label:"Moderately Severe",value:r.predictions.anxiety.moderately_severe,color:"bg-red-500"},{label:"Severe",value:r.predictions.anxiety.severe,color:"bg-red-700"}],total:r.predictions.anxiety.total})]}),e.jsx("div",{className:"mb-8",children:e.jsx(ii,{userStats:r.userStats})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Demographic Correlation Analysis"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Correlation between patient demographics and mental health outcomes (Depression & Anxiety cases)"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ri,{title:"Depression vs Anxiety Correlation",depressionData:r.predictions.depression,anxietyData:r.predictions.anxiety})}),e.jsx(Ie,{title:"Age Groups vs Mental Health Cases",subtitle:"Distribution by age ranges showing depression and anxiety case rates",data:r.correlations.ageDistribution}),e.jsx(Ie,{title:"Gender vs Mental Health Cases",subtitle:"Distribution by gender identity showing case rates",data:r.correlations.genderDistribution}),e.jsx(Ie,{title:"Weight Groups vs Mental Health Cases",subtitle:"Distribution by weight ranges showing case rates",data:r.correlations.weightDistribution}),e.jsx(Ie,{title:"Race vs Mental Health Cases",subtitle:"Distribution by racial identity showing case rates",data:r.correlations.raceDistribution}),e.jsx(Ie,{title:"Ethnicity vs Mental Health Cases",subtitle:"Distribution by ethnic background showing case rates",data:r.correlations.ethnicityDistribution}),e.jsx(Ie,{title:"Primary Language vs Mental Health Cases",subtitle:"Distribution by language preference showing case rates",data:r.correlations.languageDistribution}),e.jsx(Ie,{title:"Geographic Region vs Mental Health Cases",subtitle:"Distribution by ZIP code regions showing case rates",data:r.correlations.zipCodeDistribution})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(ai,{title:"Session Completion Funnel",sessionStatus:r.sessionStatus})}),e.jsx("div",{className:"mb-8",children:e.jsx(ti,{title:"Sessions Over Time (7 Days)",data:r.timeData})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("span",{className:"text-lg text-gray-600 dark:text-gray-300",children:"No data available"})})})})},oi=()=>{const r=Ke();d.useEffect(()=>{const t=setTimeout(()=>{r("/speech-avatar-experience")},3e3);return()=>clearTimeout(t)},[r]);const s=()=>{r("/speech-avatar-experience")};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full mx-4 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:e.jsx(ya,{className:"h-8 w-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Agent Experience Upgraded"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"We've upgraded the agent experience with our new Speech Avatar technology for more natural, real-time conversations."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:s,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2",children:["Go to Speech Avatar Experience",e.jsx(Or,{className:"h-4 w-4"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Redirecting automatically in a few seconds..."})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"What's New:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-300 space-y-1 text-left",children:[e.jsx("li",{children:" Real-time speech interaction"}),e.jsx("li",{children:" Visual avatar representation"}),e.jsx("li",{children:" Enhanced behavioral health assessments"}),e.jsx("li",{children:" Improved agent coordination"})]})]})]})})},Ae=class Ae{constructor(){G(this,"availableDevices",[]);G(this,"selectedDeviceId","");G(this,"hasPermission",!1)}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}static isSupported(){return!!(navigator.mediaDevices&&typeof navigator.mediaDevices.getUserMedia=="function"&&typeof navigator.mediaDevices.enumerateDevices=="function"&&window.AudioContext)}async requestPermission(){try{return Ae.isSupported()?((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop()),this.hasPermission=!0,console.log("ðŸŽ¤ Microphone permission granted"),{granted:!0}):{granted:!1,error:"Browser does not support required audio APIs"}}catch(s){console.error("âŒ Failed to get microphone permission:",s);let t="Failed to access microphone",a=!1;return s instanceof Error&&(s.name==="NotAllowedError"?t="Microphone access denied. Please allow microphone access in your browser settings.":s.name==="NotFoundError"?t="No microphone found. Please connect a microphone and try again.":s.name==="NotReadableError"?t="Microphone is already in use by another application.":s.name==="OverconstrainedError"?t="Microphone does not meet the required constraints.":s.name==="SecurityError"?t="Microphone access blocked by security policy.":s.name==="AbortError"&&(t="Microphone access request was interrupted.",a=!0)),{granted:!1,error:t,needsUserGesture:a}}}async getAvailableDevices(){try{if(!this.hasPermission){const t=await this.requestPermission();if(!t.granted)throw new Error(t.error||"Permission required to list devices")}const s=await navigator.mediaDevices.enumerateDevices();if(this.availableDevices=s.filter(t=>t.kind==="audioinput").map((t,a)=>({deviceId:t.deviceId,label:t.label||`Microphone ${a+1}`,kind:t.kind,groupId:t.groupId,isDefault:t.deviceId==="default"})),console.log(`ðŸŽ¤ Found ${this.availableDevices.length} audio input devices:`,this.availableDevices),!this.selectedDeviceId&&this.availableDevices.length>0){const t=this.availableDevices.find(a=>a.isDefault)||this.availableDevices[0];this.selectedDeviceId=t.deviceId}return this.availableDevices}catch(s){throw console.error("âŒ Failed to enumerate audio devices:",s),new Error("Failed to get available microphones")}}setSelectedDevice(s){const t=this.availableDevices.find(a=>a.deviceId===s);t?(this.selectedDeviceId=s,console.log(`ðŸŽ¤ Selected audio device: ${t.label} (${s})`)):console.warn(`âš ï¸ Audio device not found: ${s}`)}getSelectedDevice(){return this.availableDevices.find(s=>s.deviceId===this.selectedDeviceId)||null}async createAudioStream(s){try{if(!this.hasPermission){const l=await this.requestPermission();if(!l.granted)throw new Error(l.error||"Microphone permission required")}const t={deviceId:this.selectedDeviceId?{exact:this.selectedDeviceId}:void 0,sampleRate:24e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,...s};console.log("ðŸŽ¤ Creating audio stream with constraints:",t);const a=await navigator.mediaDevices.getUserMedia({audio:t}),i=a.getAudioTracks()[0];return i&&(console.log(`ðŸŽ¤ Audio stream created successfully using: ${i.label}`),console.log("ðŸŽ¤ Track settings:",i.getSettings())),a}catch(t){if(console.error("âŒ Failed to create audio stream:",t),this.selectedDeviceId)return console.log("ðŸ”„ Trying with default audio device..."),this.selectedDeviceId="",this.createAudioStream(s);throw t}}async testAudioInput(s=1e4,t=!0){try{const a=await this.createAudioStream();return new Promise(i=>{const l=new AudioContext,u=l.createMediaStreamSource(a),m=l.createAnalyser();let y=null;t?(y=l.createGain(),y.gain.value=.3,u.connect(y),y.connect(l.destination),console.log("ðŸŽ¤ Audio test started - You should hear your microphone input through speakers at 30% volume")):console.log("ðŸŽ¤ Audio test started - Playback disabled"),m.fftSize=256,u.connect(m);const b=new Uint8Array(m.frequencyBinCount);let g=!1;const A=setInterval(()=>{m.getByteFrequencyData(b);const L=b.reduce((_,M)=>_+M,0)/b.length;L>.5&&(g=!0),console.log(`ðŸŽ¤ Audio test - Frequency average: ${L.toFixed(3)}, Input detected: ${g}`)},100);setTimeout(()=>{clearInterval(A),t&&y&&(u.disconnect(y),y.disconnect(l.destination)),a.getTracks().forEach(L=>L.stop()),l.close(),console.log(`ðŸŽ¤ Audio test completed - Input detected: ${g?"YES":"NO"}`),i(g)},s)})}catch(a){return console.error("âŒ Audio test failed:",a),!1}}async getPermissionStatus(){try{return(await navigator.mediaDevices.enumerateDevices()).some(a=>a.label!=="")?"granted":"permissions"in navigator?(await navigator.permissions.query({name:"microphone"})).state:"prompt"}catch(s){return console.warn("Could not determine permission status:",s),"prompt"}}reset(){this.availableDevices=[],this.selectedDeviceId="",this.hasPermission=!1}};G(Ae,"instance");let Ge=Ae;const li=Object.freeze(Object.defineProperty({__proto__:null,AudioDeviceService:Ge,default:Ge},Symbol.toStringTag,{value:"Module"}));class ci{constructor(s){this.connection=s}async update(s,t){const a={type:"session.update",session:s};t&&(a.event_id=t),await this.connection.send(a)}}class di{constructor(s){this.connection=s}async create(s,t,a){const i={type:"response.create",response:s};t&&(i.event_id=t),a&&(i.additional_instructions=a),await this.connection.send(i)}async cancel(s,t){const a={type:"response.cancel"};s&&(a.response_id=s),t&&(a.event_id=t),await this.connection.send(a)}}class ui{constructor(s){this.connection=s}async append(s,t){const a={type:"input_audio_buffer.append",audio:s};t&&(a.event_id=t),await this.connection.send(a)}async commit(s){const t={type:"input_audio_buffer.commit"};s&&(t.event_id=s),await this.connection.send(t)}async clear(s){const t={type:"input_audio_buffer.clear"};s&&(t.event_id=s),await this.connection.send(t)}}class mi{constructor(s){this.connection=s}async clear(s){const t={type:"output_audio_buffer.clear"};s&&(t.event_id=s),await this.connection.send(t)}}class xi{constructor(s){this.connection=s}async create(s,t,a){const i={type:"conversation.item.create",item:s};t&&(i.previous_item_id=t),a&&(i.event_id=a),await this.connection.send(i)}async delete(s,t){const a={type:"conversation.item.delete",item_id:s};t&&(a.event_id=t),await this.connection.send(a)}async truncate(s,t,a,i){const l={type:"conversation.item.truncate",item_id:s,audio_end_ms:t,content_index:a};i&&(l.event_id=i),await this.connection.send(l)}}class hi{constructor(s){G(this,"item");this.item=new xi(s)}}class gi extends Bt.EventEmitter{constructor(t){super();G(this,"websocket",null);G(this,"sessionId",null);G(this,"isConnected",!1);G(this,"isSessionReady",!1);G(this,"sessionReadyResolve",null);G(this,"currentAudioStream",null);G(this,"mediaRecorder",null);G(this,"audioContext",null);G(this,"audioWorkletNode",null);G(this,"audioLevelCallback",null);G(this,"session");G(this,"response");G(this,"inputAudioBuffer");G(this,"outputAudioBuffer");G(this,"conversation");this.config=t,this.session=new ci(this),this.response=new di(this),this.inputAudioBuffer=new ui(this),this.outputAudioBuffer=new mi(this),this.conversation=new hi(this)}async connect(){if(this.isConnected)throw new Error("Already connected");try{const t=this.buildWebSocketUrl();return console.log("ðŸ”— Connecting to Azure Voice Live API:",t.toString()),this.websocket=new WebSocket(t.toString()),new Promise((a,i)=>{if(!this.websocket){i(new Error("Failed to create WebSocket"));return}this.websocket.onopen=()=>{console.log("âœ… WebSocket connected to Azure Voice Live API"),this.isConnected=!0,this.setupMessageHandlers(),a()},this.websocket.onerror=l=>{var m;console.error("âŒ WebSocket connection error:",l),this.isConnected=!1;let u="WebSocket connection failed";((m=this.websocket)==null?void 0:m.readyState)===WebSocket.CLOSED&&(u="Azure Voice Live API insufficient resources (service may be overloaded)"),i(new Error(u))},this.websocket.onclose=l=>{console.log(`ðŸ”— WebSocket closed: ${l.code} - ${l.reason}`);let u="Unknown reason";switch(l.code){case 1e3:u="Normal closure";break;case 1006:u="Connection lost abnormally (likely insufficient resources or network issue)";break;case 1011:u="Server error (insufficient resources)";break;case 1012:u="Service restart";break;case 1013:u="Try again later (service overloaded)";break;default:u=`Close code ${l.code}: ${l.reason||"No additional information"}`}console.log(`ðŸ“Š Close reason: ${u}`),this.isConnected=!1,this.isSessionReady=!1,this.cleanup(),this.emit("disconnected",{code:l.code,reason:l.reason||u,wasClean:l.wasClean})}})}catch(t){throw new Error(`Failed to connect: ${t instanceof Error?t.message:"Unknown error"}`)}}async waitForSessionReady(){if(!this.isSessionReady)return new Promise(t=>{this.sessionReadyResolve=t})}buildWebSocketUrl(){const t=new URL(this.config.endpoint.replace("https://","wss://"));return t.pathname="/voice-live/realtime",t.searchParams.set("api-version",this.config.apiVersion||"2025-05-01-preview"),t.searchParams.set("model",this.config.model),t.searchParams.set("api-key",this.config.apiKey),t}setupMessageHandlers(){this.websocket&&(this.websocket.onmessage=t=>{try{const a=JSON.parse(t.data);this.handleServerEvent(a)}catch(a){console.error("âŒ Failed to parse WebSocket message:",a),this.emit("error",new Error("Failed to parse server message"))}})}handleServerEvent(t){var a,i,l,u,m;switch(console.log(`ðŸ“¨ Received event: ${t.type}`),t.type){case"session.created":case"session.updated":this.sessionId=((a=t.session)==null?void 0:a.id)||null,console.log(`âœ… Session ready: ${this.sessionId}`),this.isSessionReady||(this.isSessionReady=!0,this.sessionReadyResolve&&(this.sessionReadyResolve(),this.sessionReadyResolve=null)),this.emit("session.ready",t);break;case"input_audio_buffer.speech_started":console.log("ðŸŽ¤ User started speaking"),this.emit("speech.started");break;case"input_audio_buffer.speech_stopped":console.log("ðŸŽ¤ User stopped speaking"),this.emit("speech.stopped");break;case"response.created":console.log("ðŸ¤– Agent response created"),this.emit("response.created",t);break;case"response.audio.delta":(i=t.delta)!=null&&i.audio&&this.emit("audio.delta",t.delta.audio);break;case"response.audio.done":console.log("ðŸ”Š Audio response completed"),this.emit("audio.done",t);break;case"response.audio_transcript.done":console.log("ðŸ“ Audio transcript completed"),this.emit("audio.transcript.done",t);break;case"response.content_part.done":console.log("ðŸ“„ Content part completed"),this.emit("content.part.done",t);break;case"response.output_item.done":console.log("ðŸ“¤ Output item completed"),this.emit("output.item.done",t);break;case"response.done":console.log("âœ… Response completed"),this.emit("response.done",t);break;case"conversation.item.created":this.emit("item.created",t.item);break;case"conversation.item.input_audio_transcription.completed":console.log("ðŸ“ Input audio transcription completed"),this.emit("input.transcription.completed",t);break;case"response.output_item.added":console.log("ðŸ“¤ Output item added"),this.emit("output.item.added",t);break;case"response.content_part.added":console.log("ðŸ“„ Content part added"),this.emit("content.part.added",t);break;case"response.audio_transcript.delta":console.log("ðŸ“ Audio transcript delta"),this.emit("audio.transcript.delta",t);break;case"error":console.error("âŒ Server error:",t.error),((l=t.error)==null?void 0:l.type)==="invalid_request_error"&&(console.error("ðŸš¨ Protocol error - possibly sending data before session ready:",t.error.message),(u=t.error.message)!=null&&u.includes("input_audio_buffer")&&(console.log("ðŸ›‘ Stopping audio capture due to protocol error"),this.stopAudioCapture().catch(y=>console.error("Failed to stop audio:",y)))),this.emit("error",new Error(((m=t.error)==null?void 0:m.message)||"Server error"));break;default:console.log(`ðŸ“¨ Unhandled event type: ${t.type}`),this.emit("event",t);break}this.emit("server.event",t)}async send(t){if(!this.websocket||!this.isConnected)throw new Error("WebSocket not connected");try{const a=JSON.stringify(t);this.websocket.send(a),console.log(`ðŸ“¤ Sent event: ${t.type}`)}catch(a){throw console.error("âŒ Failed to send event:",a),new Error(`Failed to send event: ${a instanceof Error?a.message:"Unknown error"}`)}}async startAudioCapture(){try{this.currentAudioStream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:24e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),this.audioContext=new AudioContext({sampleRate:24e3}),await this.audioContext.audioWorklet.addModule("/audio-worklet-processor.js");const t=this.audioContext.createMediaStreamSource(this.currentAudioStream);this.audioWorkletNode=new AudioWorkletNode(this.audioContext,"audio-input-processor",{numberOfInputs:1,numberOfOutputs:0,channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers"}),this.audioWorkletNode.port.onmessage=a=>{const{type:i,audioBuffer:l,samples:u,average:m,peak:y,active:b}=a.data;i==="audioLevel"?console.log(`ðŸŽ¤ Audio Input Test - Samples: ${u}, Average: ${(m*100).toFixed(2)}%, Peak: ${(y*100).toFixed(2)}%, Active: ${b?"YES":"NO"}`):i==="audioData"&&this.isConnected&&this.isSessionReady&&this.processAudioChunk(l).catch(g=>{console.error("âŒ Failed to process audio chunk:",g)})},t.connect(this.audioWorkletNode),console.log("ðŸŽ¤ Audio capture started with AudioWorkletNode (replacing deprecated ScriptProcessorNode)"),this.emit("audio.capture.started")}catch(t){throw console.error("âŒ Failed to start audio capture:",t),new Error("Microphone access required for voice interaction")}}async processAudioChunk(t){try{if(!this.isConnected){console.warn("âš ï¸ Skipping audio chunk - WebSocket not connected");return}if(!this.isSessionReady){console.warn("âš ï¸ Skipping audio chunk - Session not ready");return}let a;if(t instanceof Blob?a=await t.arrayBuffer():a=t,a.byteLength%2!==0){console.warn("âš ï¸ Odd byte length detected, padding audio chunk");const l=new Uint8Array(a),u=new Uint8Array(a.byteLength+1);u.set(l),u[l.length]=0,a=u.buffer}const i=btoa(String.fromCharCode(...new Uint8Array(a)));await this.inputAudioBuffer.append(i)}catch(a){console.error("âŒ Failed to process audio chunk:",a),a instanceof Error&&a.message.includes("WebSocket not connected")&&(console.log("ðŸ›‘ Stopping audio capture due to WebSocket disconnection"),await this.stopAudioCapture())}}async stopAudioCapture(){this.audioWorkletNode&&(this.audioWorkletNode.disconnect(),this.audioWorkletNode=null),this.audioContext&&this.audioContext.state!=="closed"&&(await this.audioContext.close(),this.audioContext=null),this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.mediaRecorder.stop(),this.mediaRecorder=null),this.currentAudioStream&&(this.currentAudioStream.getTracks().forEach(t=>t.stop()),this.currentAudioStream=null),console.log("ðŸ›‘ Audio capture stopped"),this.emit("audio.capture.stopped")}async close(){await this.stopAudioCapture(),this.websocket&&this.isConnected&&this.websocket.close(1e3,"Client disconnecting"),this.cleanup()}cleanup(){this.isConnected=!1,this.isSessionReady=!1,this.sessionReadyResolve=null,this.sessionId=null,this.websocket=null,this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(console.log("ðŸ›‘ Stopping MediaRecorder during cleanup"),this.mediaRecorder.stop()),this.currentAudioStream&&(console.log("ðŸ›‘ Stopping audio stream during cleanup"),this.currentAudioStream.getTracks().forEach(t=>t.stop()),this.currentAudioStream=null),this.mediaRecorder=null,this.audioContext&&(this.audioContext.close(),this.audioContext=null)}get connected(){return this.isConnected}get sessionReady(){return this.isSessionReady}get currentSessionId(){return this.sessionId}}async function st(r){for(let a=0;a<=3;a++)try{console.log(`ðŸ”— Creating Voice Live connection (attempt ${a+1}/${3+1})...`);const i=new gi(r);return await i.connect(),await i.waitForSessionReady(),console.log("âœ… Voice Live connection established successfully"),i}catch(i){const l=i instanceof Error?i.message:"Unknown error";console.error(`âŒ Connection attempt ${a+1} failed:`,l);const u=l.toLowerCase().includes("insufficient")||l.toLowerCase().includes("overloaded")||l.toLowerCase().includes("connection failed");if(a<3&&u){const m=2e3*Math.pow(2,a);console.log(`â³ Retrying in ${m}ms due to resource constraints...`),await new Promise(y=>setTimeout(y,m))}else throw new Error(a>=3?"Failed to connect after 4 attempts. Azure Voice Live API may be overloaded. Please try again later.":`Connection failed: ${l}`)}throw new Error("Unexpected error in connection retry logic")}class pi{constructor(s){G(this,"connection",null);G(this,"config");G(this,"audioLevelCallback",null);this.config=s}async initialize(){try{console.log("ðŸŽ­ Initializing Speech Avatar Service..."),console.log("ðŸ”— Attempting to connect to Azure Voice Live API..."),this.connection=await st(this.config),this.audioLevelCallback&&(this.connection.audioLevelCallback=this.audioLevelCallback),await this.configureSession(),console.log("âœ… Speech Avatar Service initialized successfully")}catch(s){const t=s instanceof Error?s.message:"Unknown error";throw console.error("âŒ Failed to initialize Speech Avatar Service:",t),(t.includes("insufficient")||t.includes("overloaded"))&&console.log("ðŸ’¡ Tip: Azure Voice Live API may be experiencing high demand. Try again in a few minutes."),s}}async configureSession(){if(!this.connection)throw new Error("Connection not established");const s={modalities:["text","audio"],instructions:this.getBehavioralHealthInstructions(),voice:{name:this.config.voice||"en-US-AvaNeural",type:"azure-standard"},input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"azure_semantic_vad",threshold:.3,prefix_padding_ms:200,silence_duration_ms:500},max_response_output_tokens:4096,temperature:.7};await this.connection.session.update(s)}getBehavioralHealthInstructions(){return`You are Dr. Sarah Chen, a compassionate and experienced Behavioral Health Support Specialist. 

Your role is to:
- Provide empathetic, non-judgmental support
- Use active listening techniques
- Ask thoughtful, open-ended questions
- Validate feelings and experiences
- Suggest coping strategies when appropriate
- Maintain professional boundaries
- Know when to recommend professional help

Communication style:
- Warm, calm, and reassuring tone
- Use "I" statements and reflective responses
- Avoid medical advice or diagnosis
- Keep responses concise but meaningful
- Show genuine care and understanding

Remember: You are a supportive companion, not a therapist. Always encourage seeking professional help for serious concerns.`}onAudioLevel(s){this.audioLevelCallback=s,this.connection&&(this.connection.audioLevelCallback=s)}async checkMicrophonePermission(){const s=Ge.getInstance();try{const t=await s.getPermissionStatus();if(t==="granted"||t==="denied")return t;try{return(await s.requestPermission()).granted?"granted":"denied"}catch(a){return console.error("âŒ Failed to request microphone permission:",a),"denied"}}catch(t){return console.error("âŒ Failed to check microphone permission:",t),"prompt"}}async startSession(){var s;console.log("ðŸš€ startSession called, checking connection state..."),console.log("ðŸ” this.connection:",this.connection?"exists":"null"),console.log("ðŸ” connection.connected:",(s=this.connection)==null?void 0:s.connected),this.connection||(console.log("ðŸ”„ Connection is null, reinitializing..."),this.connection=await st(this.config),await this.configureSession(),console.log("âœ… Connection reinitialized successfully")),this.connection.connected||(console.log("ðŸ”„ Connection lost, attempting to reconnect..."),await this.connection.connect()),console.log("â³ Waiting for session to be ready..."),await this.connection.waitForSessionReady(),console.log("âœ… Session is ready, starting audio capture..."),await this.connection.startAudioCapture(),console.log("ðŸŽ­ Speech Avatar session started")}async endSession(){this.connection&&(await this.connection.close(),this.connection=null),console.log("ðŸ›‘ Speech Avatar session ended")}onAgentMessage(s){var t;(t=this.connection)==null||t.on("response.audio.done",a=>{var l;const i={agentName:"Speech Avatar",content:((l=a.response)==null?void 0:l.content)||"",timestamp:new Date().toISOString(),confidence:.95,suggestedActions:[]};s(i)})}onUserSpeech(s){var t,a;(t=this.connection)==null||t.on("input_audio_buffer.speech_started",()=>{s(!0)}),(a=this.connection)==null||a.on("input_audio_buffer.speech_stopped",()=>{s(!1)})}onError(s){var t;(t=this.connection)==null||t.on("error",a=>{var i;s(((i=a.error)==null?void 0:i.message)||"Unknown error")})}async stopSession(){await this.endSession()}on(s,t){var a;(a=this.connection)==null||a.on(s,t)}off(s,t){var a;(a=this.connection)==null||a.off(s,t)}get session(){var s;return(s=this.connection)==null?void 0:s.session}get response(){var s;return(s=this.connection)==null?void 0:s.response}get conversation(){var s;return(s=this.connection)==null?void 0:s.conversation}get inputAudioBuffer(){var s;return(s=this.connection)==null?void 0:s.inputAudioBuffer}get outputAudioBuffer(){var s;return(s=this.connection)==null?void 0:s.outputAudioBuffer}get isConnected(){var s;return((s=this.connection)==null?void 0:s.connected)||!1}get isSessionReady(){var s;return((s=this.connection)==null?void 0:s.sessionReady)||!1}}function yi({speechService:r,onClose:s,isOpen:t}){const[a,i]=d.useState([]),[l,u]=d.useState(null),[m,y]=d.useState("prompt"),[b,g]=d.useState(!1),[k,A]=d.useState(""),[L,_]=d.useState(!1),[M,f]=d.useState(null),P=async()=>{try{g(!0),A("");const v=await r.checkMicrophonePermission();if(y(v),v==="denied"){A("Microphone access is denied. Please enable microphone permissions in your browser settings.");return}const E=await r.getAvailableAudioDevices();i(E);const Q=r.getSelectedAudioDevice();u(Q),console.log(`ðŸŽ¤ Loaded ${E.length} audio devices`,E)}catch(v){console.error("Failed to load audio devices:",v),A(v instanceof Error?v.message:"Failed to load microphone devices")}finally{g(!1)}},$=async()=>{try{g(!0),A("");const v=await r.requestMicrophonePermission();v.granted?(y("granted"),await P()):(y("denied"),A(v.error||"Permission denied"))}catch(v){console.error("Failed to request permission:",v),A(v instanceof Error?v.message:"Failed to request permission")}finally{g(!1)}},J=v=>{try{r.setAudioDevice(v.deviceId),u(v),console.log(`ðŸŽ¤ Selected device: ${v.label}`)}catch(E){console.error("Failed to select device:",E),A("Failed to select audio device")}},I=async()=>{try{_(!0),f(null),A(""),console.log("ðŸŽ¤ Testing audio input...");const v=await r.testAudioInput(1e4);f(v),v||A("No audio input detected. Please check your microphone settings and try speaking.")}catch(v){console.error("Audio test failed:",v),A("Audio test failed. Please check your microphone connection."),f(!1)}finally{_(!1)}};return d.useEffect(()=>{t&&P()},[t]),t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pt,{size:20,className:"text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Microphone Settings"})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gray-50",children:[m==="granted"?e.jsx(ue,{size:20,className:"text-green-600"}):e.jsx(ye,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Permission Status: ",m==="granted"?"Granted":"Required"]}),m!=="granted"&&e.jsx("button",{onClick:$,disabled:b,className:"text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400",children:b?"Requesting...":"Request Permission"})]})]}),m==="granted"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-900",children:"Available Microphones"}),e.jsxs("button",{onClick:P,disabled:b,className:"text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400 flex items-center space-x-1",children:[e.jsx(te,{size:14,className:b?"animate-spin":""}),e.jsx("span",{children:"Refresh"})]})]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:a.map(v=>e.jsx("button",{onClick:()=>J(v),className:`w-full text-left p-3 rounded-lg border transition-colors ${(l==null?void 0:l.deviceId)===v.deviceId?"border-blue-500 bg-blue-50 text-blue-900":"border-gray-200 hover:border-gray-300 text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bs,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:v.label}),v.isDefault&&e.jsx("span",{className:"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded",children:"Default"}),(l==null?void 0:l.deviceId)===v.deviceId&&e.jsx(ue,{size:16,className:"text-blue-600"})]})},v.deviceId))}),a.length===0&&!b&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No microphones found. Please connect a microphone and refresh."})]}),m==="granted"&&l&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-900",children:"Test Audio Input"}),M!==null&&e.jsxs("div",{className:"flex items-center space-x-1",children:[M?e.jsx(ue,{size:16,className:"text-green-600"}):e.jsx(ye,{size:16,className:"text-red-600"}),e.jsx("span",{className:`text-xs ${M?"text-green-600":"text-red-600"}`,children:M?"Audio detected":"No audio detected"})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx("p",{className:"text-xs text-gray-600",children:"Click test to hear your microphone input through your speakers. This helps confirm your microphone is working properly."})}),e.jsx("button",{onClick:I,disabled:L||b,className:"w-full p-3 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed",children:e.jsx("div",{className:"flex items-center justify-center space-x-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{size:16,className:"text-blue-600 animate-pulse"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Testing... Speak now! (You should hear your voice)"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{size:16,className:"text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Test Microphone with Playback (10 seconds)"})]})})})]}),k&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{size:16,className:"text-red-600"}),e.jsx("p",{className:"text-sm text-red-700",children:k})]})})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 flex justify-end space-x-2",children:e.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})})]})}):null}function bi({agentType:r="PHQ9",userId:s,onSessionEnd:t,onRiskDetected:a}){var X;const[i,l]=d.useState(!1),[u,m]=d.useState(!1),[y,b]=d.useState(!1),[g,k]=d.useState(null),[A,L]=d.useState(""),[_,M]=d.useState([]),[f,P]=d.useState("disconnected"),[$,J]=d.useState(""),[I,v]=d.useState(!0),[E,Q]=d.useState({average:0,peak:0,active:!1}),[C,j]=d.useState(!1),n=d.useRef(null),c=d.useRef(null),x=d.useRef(null),p={PHQ9:{name:"Dr. Sarah Chen",role:"Depression Screening Specialist",voice:"en-US-AvaNeural",personality:"empathetic, professional, thorough"},PHQ2:{name:"Dr. Michael Torres",role:"Mental Health Screener",voice:"en-US-GuyNeural",personality:"supportive, gentle, efficient"},CRISIS:{name:"Dr. Jennifer Walsh",role:"Crisis Intervention Specialist",voice:"en-US-JennyNeural",personality:"calm, authoritative, compassionate"},COMEDIAN:{name:"Dr. Alex Rivera",role:"Therapeutic Humor Specialist",voice:"en-US-AriaNeural",personality:"warm, humorous, professional"}}[r],w=d.useCallback(async()=>{try{const N="https://cdc-traci-aif-002.cognitiveservices.azure.com/",Y="7fGpwV46hnYrzploQr6mnERZoTcIUBdKkKuuwlyQMqylmGbqkVTQJQQJ99BIACHYHv6XJ3w3AAAAACOGB48K",K={endpoint:N,apiKey:Y,model:"gpt-4o-realtime-preview",voice:"en-US-AvaNeural",instructions:`You are ${p.name}, a ${p.role}. Your personality is ${p.personality}. Conduct a compassionate, professional behavioral health interaction.`,agentPersonality:{name:"Dr. Sarah Chen",role:"Behavioral Health Support Specialist",traits:p.personality.split(", ")}},T=new pi(K);T.onAgentMessage(me=>{M(ke=>[...ke,me]),L(me.content),(me.content.toLowerCase().includes("crisis")||me.content.toLowerCase().includes("emergency")||me.content.toLowerCase().includes("harm"))&&(a==null||a("high"))}),T.onUserSpeech(me=>{m(me),me&&(b(!1),L("Listening..."))}),T.onError(me=>{J(me),P("error")}),await T.initialize(),n.current=T,T.onAudioLevel(me=>{Q(me)}),P("connected")}catch(N){console.error("Failed to initialize Speech Avatar service:",N);const Y=N instanceof Error?N.message:"Unknown error occurred";J(Y),P("error")}},[p]);d.useEffect(()=>(w(),()=>{n.current&&n.current.stopSession()}),[w]),d.useEffect(()=>{var N;(N=x.current)==null||N.scrollIntoView({behavior:"smooth"})},[_]);const R=d.useCallback(async()=>{try{if(P("connecting"),J(""),n.current)console.log("âœ… Service already available, using existing instance");else{if(console.log("ðŸ”„ Service not available, reinitializing..."),await w(),!n.current)throw new Error("Failed to reinitialize speech service");console.log("âœ… Service successfully reinitialized")}const N="https://cwbhieastus001.azurewebsites.net/api";let Y;try{const T=await fetch(`${N}/speech-avatar/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({agentType:r,userId:s,sessionConfig:{agentType:r,sessionId:"",enableAudio:!0,preferredVoice:p.voice}})});if(!T.ok)throw new Error("Backend not available");Y=await T.json()}catch(T){console.warn("Backend not available, using fallback session:",T),Y={sessionId:`fallback-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,status:"initialized",agentType:r}}k(Y.sessionId),l(!0),P("connected");try{await n.current.startSession(),console.log("âœ… Speech Avatar session started successfully"),m(!0),console.log("ðŸŽ¤ Manually setting listening state to true for audio testing")}catch(T){console.warn("âš ï¸ Azure Speech service connection failed, but allowing local audio testing:",T),m(!0)}const K={agentName:p.name,content:ie(r),timestamp:new Date().toISOString(),confidence:1};M([K]),L(K.content)}catch(N){console.error("Failed to start session:",N),J("Failed to start session. Please try again."),P("error")}},[s,r,p,w]),B=d.useCallback(async()=>{if(!(!n.current||!g))try{const Y=await fetch(`https://cwbhieastus001.azurewebsites.net/api/speech-avatar/sessions/${g}`,{method:"DELETE"});if(Y.ok){const K=await Y.json();t==null||t(K)}await n.current.stopSession(),l(!1),m(!1),b(!1),k(null),P("disconnected"),L("Session ended. Thank you for your time.")}catch(N){console.error("Failed to end session:",N),J("Failed to end session properly.")}},[g,t]),H=d.useCallback(()=>{v(N=>!N)},[]),ie=N=>{switch(N){case"PHQ9":return"Hello! I'm Dr. Sarah Chen. I'd like to have a conversation with you about how you've been feeling lately. This will help us understand your mental health better. Feel free to speak naturally - I'm here to listen.";case"PHQ2":return"Hi there! I'm Dr. Michael Torres. I'd like to ask you a couple of quick questions about your mood over the past two weeks. Just speak naturally, and I'll listen carefully.";case"CRISIS":return"Hello, I'm Dr. Jennifer Walsh, a crisis intervention specialist. I'm here to provide immediate support. Please tell me what's happening and how you're feeling right now.";case"COMEDIAN":return"Hey there! I'm Dr. Alex Rivera. I like to bring a little light-heartedness to our conversations while still taking your mental health seriously. Ready to chat?";default:return"Hello! I'm here to provide behavioral health support. Feel free to share what's on your mind."}},V=(()=>{switch(f){case"connecting":return{text:"Connecting...",color:"text-yellow-600"};case"connected":return{text:"Connected",color:"text-green-600"};case"error":return{text:"Connection Error",color:"text-red-600"};default:return{text:"Disconnected",color:"text-gray-600"}}})();return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold text-lg",children:p.name.split(" ").map(N=>N[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:p.name}),e.jsx("p",{className:"text-sm text-gray-600",children:p.role})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${V.color}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${f==="connected"?"bg-green-500":f==="connecting"?"bg-yellow-500":f==="error"?"bg-red-500":"bg-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:V.text})]}),e.jsx("button",{onClick:H,className:`p-2 rounded-full transition-colors ${I?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,title:I?"Mute Audio":"Unmute Audio",children:I?e.jsx(Ue,{size:20}):e.jsx(za,{size:20})}),e.jsx("button",{onClick:()=>j(!0),className:"p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors",title:"Microphone Settings",children:e.jsx(pt,{size:20})})]})]})}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsxs("div",{className:"w-1/2 bg-gray-900 relative",children:[e.jsx("video",{ref:c,className:"w-full h-full object-cover",autoPlay:!0,muted:!I,playsInline:!0}),!((X=c.current)!=null&&X.srcObject)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-32 h-32 bg-indigo-600 rounded-full flex items-center justify-center mb-4 mx-auto",children:e.jsx("span",{className:"text-white font-bold text-4xl",children:p.name.split(" ").map(N=>N[0]).join("")})}),e.jsx("p",{className:"text-white text-lg",children:p.name}),e.jsx("p",{className:"text-gray-300",children:p.role})]})}),e.jsx("div",{className:"absolute bottom-4 left-4",children:e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-full transition-all duration-200 ${i?u?E.active?"bg-green-500 text-white shadow-lg":"bg-green-600 text-white":y?"bg-blue-600 text-white":"bg-gray-700 text-gray-300":"bg-gray-600 text-gray-400"}`,children:[e.jsxs("div",{className:"relative",children:[i&&u?e.jsx(bs,{size:18,className:`transition-all duration-150 ${E.active?"scale-125 brightness-125 drop-shadow-md":"scale-100 brightness-100"}`}):i&&y?e.jsx(Ue,{size:18}):e.jsx(bs,{size:18}),i&&u&&E.active&&e.jsx("div",{className:`absolute inset-0 rounded-full border-2 border-yellow-300 animate-ping ${E.peak>.5?"scale-150 opacity-75":"scale-125 opacity-60"}`})]}),e.jsx("span",{className:"text-sm font-medium",children:i?u?E.active?"Recording...":"Listening...":y?"Speaking...":"Ready":"Mic Ready"}),i&&u&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:`w-1 h-3 rounded-full transition-all duration-150 ${E.average>.1?"bg-yellow-300":"bg-green-800"}`}),e.jsx("div",{className:`w-1 h-4 rounded-full transition-all duration-150 ${E.average>.2?"bg-yellow-300":"bg-green-800"}`}),e.jsx("div",{className:`w-1 h-5 rounded-full transition-all duration-150 ${E.peak>.3?"bg-yellow-300":"bg-green-800"}`})]})]})})]}),e.jsxs("div",{className:"w-1/2 bg-white flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Current Message"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:A||"Waiting for conversation to begin..."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[_.map((N,Y)=>e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-blue-900",children:N.agentName}),e.jsx("span",{className:"text-xs text-blue-600",children:new Date(N.timestamp).toLocaleTimeString()})]}),e.jsx("p",{className:"text-blue-800",children:N.content}),N.suggestedActions&&N.suggestedActions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Suggested Actions:"}),e.jsx("ul",{className:"text-sm text-blue-700 mt-1",children:N.suggestedActions.map((K,T)=>e.jsxs("li",{className:"ml-4",children:["â€¢ ",K]},T))})]})]},Y)),e.jsx("div",{ref:x})]}),e.jsxs("div",{className:"bg-gray-50 p-4 border-t border-gray-200",children:[i?e.jsxs("button",{onClick:B,className:`w-full bg-red-600 text-white py-3 px-4 rounded-lg font-semibold \r
                         hover:bg-red-700 transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(ja,{size:18}),e.jsx("span",{children:"End Session"})]}):e.jsx("button",{onClick:R,disabled:f!=="connected",className:`w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold \r
                         hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed`,children:f==="connecting"?"Connecting...":"Start Conversation"}),$&&e.jsxs("div",{className:"mt-3 p-3 bg-red-100 border border-red-400 rounded-lg flex items-center space-x-2",children:[e.jsx(ws,{size:16,className:"text-red-600"}),e.jsx("span",{className:"text-red-700 text-sm",children:$})]}),i&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Audio Debug Info"}),e.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("div",{children:["Listening: ",u?"YES":"NO"]}),e.jsxs("div",{children:["Audio Active: ",E.active?"YES":"NO"]}),e.jsxs("div",{children:["Average Level: ",(E.average*100).toFixed(1),"%"]}),e.jsxs("div",{children:["Peak Level: ",(E.peak*100).toFixed(1),"%"]})]}),e.jsx("button",{onClick:async()=>{console.log("ðŸŽ¤ Starting quick audio test...");const N=(await Wt(()=>Promise.resolve().then(()=>li),void 0)).default.getInstance();try{const Y=await N.testAudioInput(3e3,!1);console.log(`ðŸŽ¤ Quick test result: ${Y?"PASS":"FAIL"}`)}catch(Y){console.error("âŒ Quick test failed:",Y)}},className:"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors",children:"Quick Audio Test (3s)"})]})]})]})]}),e.jsx(yi,{speechService:n.current,isOpen:C,onClose:()=>j(!1)})]})}const fi=()=>{const{data:r,isLoading:s,error:t,refetch:a}=vt(),{announce:i}=ct();it.useEffect(()=>{i("System Health page loaded","polite")},[i]);const l=b=>{if(!b)return"Just now";try{const g=new Date(b);return isNaN(g.getTime())?"Just now":g.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return"Just now"}},u=b=>{switch(b==null?void 0:b.toLowerCase()){case"healthy":return"text-green-600 dark:text-green-400";case"degraded":return"text-yellow-600 dark:text-yellow-400";case"unhealthy":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},m=b=>{switch(b==null?void 0:b.toLowerCase()){case"healthy":return"âœ…";case"degraded":return"âš ï¸";case"unhealthy":return"âŒ";default:return"â“"}},y=b=>{const g="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium";switch(b==null?void 0:b.toLowerCase()){case"healthy":return`${g} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;case"degraded":return`${g} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;case"unhealthy":return`${g} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;default:return`${g} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"System Health"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-1",children:"Monitor API status and system connectivity"})]}),e.jsxs("button",{type:"button",onClick:()=>a(),disabled:s,className:"btn btn--secondary flex items-center space-x-2","aria-label":"Refresh system health status",children:[e.jsx(te,{className:`w-4 h-4 ${s?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})]}),s&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(te,{className:"w-6 h-6 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-lg text-gray-900 dark:text-white",children:"Checking system health..."})]})}),t&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"w-6 h-6 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200",children:"Health Check Failed"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1",children:t.message||"Unable to retrieve system health status"}),e.jsx("button",{type:"button",onClick:()=>a(),className:"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline",children:"Try again"})]})]})}),r&&!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Overall System Status"}),e.jsxs("div",{className:y(r.status),children:[e.jsx("span",{className:"mr-1",children:m(r.status)}),r.status]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:m(r.status)}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("div",{className:`font-medium ${u(r.status)}`,children:r.status})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"â±ï¸"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Response Time"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.totalDuration?`${r.totalDuration}ms`:"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“…"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last Checked"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:l(r.timestamp)})]})]})]}),r.checks&&Object.keys(r.checks).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"Service Details"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(r.checks).map(([b,g])=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:m(g.status)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:b.replace(/-/g," ")}),g.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:g.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[g.duration&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g.duration,"ms"]}),e.jsx("div",{className:y(g.status),children:g.status})]})]},b))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(Ve,{className:"w-5 h-5 mr-2"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"API Endpoints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Health Check:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/health"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Sessions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/sessions"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Predictions:"}),e.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:"/predictions"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Connection Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"API Connected"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Real-time Updates"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Auto-refresh Enabled"})]})]})]})]})]})]})]})},vi=()=>e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"The page you're looking for doesn't exist."}),e.jsx("a",{href:"/",className:"btn btn--primary",children:"Go to Dashboard"})]}),ji=new Mt({defaultOptions:{queries:{retry:(r,s)=>{if(s&&typeof s=="object"&&"code"in s){const t=s.code;if(t!=null&&t.startsWith("HTTP_4")&&t!=="HTTP_408")return!1}return r<3},staleTime:5*60*1e3,refetchOnWindowFocus:!1},mutations:{retry:1}}});function Ni(){return e.jsxs($t,{client:ji,children:[e.jsx(ar,{children:e.jsx(yr,{children:e.jsx(Sr,{children:e.jsx(Tt,{children:e.jsx(Rr,{children:e.jsxs(Lt,{children:[e.jsx(Ne,{path:"/",element:e.jsxs(we,{requireRoles:[ae.ADMIN,ae.CONTROL_PANEL],children:[e.jsx(vr,{}),e.jsx(qa,{})]})}),e.jsx(Ne,{path:"/upload",element:e.jsx(we,{requireRoles:[ae.ADMIN],children:e.jsx(Ka,{})})}),e.jsx(Ne,{path:"/sessions",element:e.jsx(we,{requireRoles:[ae.ADMIN],children:e.jsx(Ja,{})})}),e.jsx(Ne,{path:"/sessions/:sessionId",element:e.jsx(we,{requireRoles:[ae.ADMIN],children:e.jsx(Xa,{})})}),e.jsx(Ne,{path:"/predictions",element:e.jsx(we,{requireRoles:[ae.ADMIN],children:e.jsx(ei,{})})}),e.jsx(Ne,{path:"/summary",element:e.jsx(we,{requireRoles:[ae.ADMIN,ae.CONTROL_PANEL],children:e.jsx(ni,{})})}),e.jsx(Ne,{path:"/agent-experience",element:e.jsx(we,{requireRoles:[ae.ADMIN,ae.CONTROL_PANEL],children:e.jsx(oi,{})})}),e.jsx(Ne,{path:"/speech-avatar-experience",element:e.jsx(we,{requireRoles:[ae.ADMIN,ae.CONTROL_PANEL],children:e.jsx(bi,{userId:"current-user"})})}),e.jsx(Ne,{path:"/health",element:e.jsx(we,{requireRoles:[ae.ADMIN],children:e.jsx(fi,{})})}),e.jsx(Ne,{path:"*",element:e.jsx(vi,{})})]})})})})})}),!1]})}const tt=localStorage.getItem("bh_theme"),ki=window.matchMedia("(prefers-color-scheme: dark)").matches,wi=tt==="dark"||!tt&&ki;wi?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");ys.createRoot(document.getElementById("root")).render(e.jsx(it.StrictMode,{children:e.jsx(Ni,{})}));
//# sourceMappingURL=index-f376f115.js.map
