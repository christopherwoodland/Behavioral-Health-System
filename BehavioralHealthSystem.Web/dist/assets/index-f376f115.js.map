{"version":3,"mappings":"gqCAEIA,GAAIC,GAEYC,GAAA,WAAGF,GAAE,WACJE,GAAA,YAAGF,GAAE,g3BCF1B,IAAIG,GACJ,MAAMC,GAAQ,IAAI,WAAW,EAAE,EAChB,SAASC,IAAM,CAE5B,GAAI,CAACF,KAEHA,GAAkB,OAAO,OAAW,KAAe,OAAO,iBAAmB,OAAO,gBAAgB,KAAK,MAAM,EAE3G,CAACA,IACH,MAAM,IAAI,MAAM,0GAA0G,EAI9H,OAAOA,GAAgBC,EAAK,CAC9B,CCXA,MAAME,GAAY,GAElB,QAASC,EAAI,EAAGA,EAAI,IAAK,EAAEA,EACzBD,GAAU,MAAMC,EAAI,KAAO,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,EAG3C,SAASC,GAAgBC,EAAKC,EAAS,EAAG,CAG/C,OAAOJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,CAAC,CAAC,EAAI,IAAMJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,EAAIJ,GAAUG,EAAIC,EAAS,EAAE,CAAC,CACnf,CChBA,MAAMC,GAAa,OAAO,OAAW,KAAe,OAAO,YAAc,OAAO,WAAW,KAAK,MAAM,EACvFC,GAAA,CACb,WAAAD,EACF,ECCA,SAASE,GAAGC,EAASC,EAAKL,EAAQ,CAChC,GAAIE,GAAO,YAAc,CAACG,GAAO,CAACD,EAChC,OAAOF,GAAO,aAGhBE,EAAUA,GAAW,GACrB,MAAME,EAAOF,EAAQ,SAAWA,EAAQ,KAAOT,MAK/C,GAHAW,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAI,GAAO,GAC3BA,EAAK,CAAC,EAAIA,EAAK,CAAC,EAAI,GAAO,IAEvBD,EAAK,CACPL,EAASA,GAAU,EAEnB,QAAS,EAAI,EAAG,EAAI,GAAI,EAAE,EACxBK,EAAIL,EAAS,CAAC,EAAIM,EAAK,CAAC,EAG1B,OAAOD,CACR,CAED,OAAOP,GAAgBQ,CAAI,CAC7B,CCzBO,MAAMC,GAAS,CACpB,IAAK,CACH,QAAS,8CACX,EACA,MAAO,CACL,WAAY,uMACZ,cAAe,eACjB,EACA,QAAS,CACP,WAAY,SAAS,OAAiD,EAAE,EACxE,YAAa,GACb,cAAe,GACjB,EACA,SAAU,CACR,mBAAoB,GACpB,mBAAoB,EACtB,EACA,MAAO,CACL,gBAAiB,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAO,EACzD,cAAe,IACf,iBAAkB,MAClB,eAAgB,CAClB,CACF,EAGaC,GAAe,CAC1B,QAAS,aACT,MAAO,WACP,gBAAiB,qBACjB,gBAAiB,qBACjB,eAAgB,mBAClB,EAGaC,GAAgB,CAC3B,OAAQ,UACR,kBAAmB,qBACnB,mBAAoB,sBACpB,oBAAqB,eACrB,uBAAwB,uBAC1B,EAUaC,GAAO,CAClB,mBAAoB,eACpB,iBAAkB,qBAClB,cAAe,IACf,YAAa,GACf,EC5CaC,GAAY,IAAc,CAOrC,IAAIC,EAAS,aAAa,QAAQJ,GAAa,OAAO,EAGtD,OAAI,CAACI,GAAUA,EAAO,KAAK,EAAE,SAAW,KACtCA,EAASC,GAAO,EACH,qBAAQL,GAAa,QAASI,CAAM,GAG5CA,CACT,EA6BaE,GAAiB,IAAa,CACzC,MAAMC,EAAS,aAAa,QAAQP,GAAa,KAAK,EAClD,OAAAO,IAAW,SAAWA,IAAW,OAC5BA,EAIF,OAAO,WAAW,8BAA8B,EAAE,QAAU,OAAS,OAC9E,EAEaC,GAAkBC,GAAuB,CACvC,qBAAQT,GAAa,MAAOS,CAAK,EAG1CA,IAAU,OACH,yBAAgB,UAAU,IAAI,MAAM,EAEpC,yBAAgB,UAAU,OAAO,MAAM,CAEpD,EAGaC,GAA0B,IAAe,CACpD,MAAMH,EAAS,aAAa,QAAQP,GAAa,eAAe,EAC5D,OAAAO,IAAW,QAAUA,IAAW,QAC3BA,IAAW,OAIb,EACT,EAEaI,GAA2BC,GAA+B,CACrE,aAAa,QAAQZ,GAAa,gBAAiBY,EAAY,UAAU,CAC3E,EAuCaC,GAAsBC,GAAyB,CACpD,MAAAC,MAAU,KACVC,EAAS,IAAI,KAAKF,CAAI,EACtBG,EAASF,EAAI,QAAQ,EAAIC,EAAO,QAAQ,EACxCE,EAAc,KAAK,MAAMD,GAAU,IAAO,GAAG,EAC7CE,EAAY,KAAK,MAAMF,GAAU,IAAO,GAAK,GAAG,EAChDG,EAAW,KAAK,MAAMH,GAAU,IAAO,GAAK,GAAK,GAAG,EAE1D,OAAIC,EAAc,EAAU,WACxBA,EAAc,GAAW,GAAGA,CAAW,QACvCC,EAAY,GAAW,GAAGA,CAAS,QACnCC,EAAW,EAAU,GAAGA,CAAQ,QAE7BJ,EAAO,oBAChB,EAEaK,GAAkBP,GACtB,IAAI,KAAKA,CAAI,EAAE,eAAe,EAI1BQ,GAAiB,CAACC,EAAcC,EAAiBC,KAAiD,CAC7G,KAAAF,EACA,QAAAC,EACA,QAAAC,EACA,UAAW,IAAI,KAAK,EAAE,YAAY,CACpC,GAEaC,GAAkBC,GACzBA,aAAiB,WAAaA,EAAM,QAAQ,SAAS,OAAO,EACvD,GAGLA,aAAiB,MACZA,EAAM,QAAQ,SAAS,SAAS,GAChCA,EAAM,QAAQ,SAAS,YAAY,GACnCA,EAAM,QAAQ,SAAS,SAAS,EAGlC,GA+BIC,GAAyB,CAACJ,EAAiBK,EAAmC,WAAmB,CACtG,MAAAC,EAAe,SAAS,cAAc,KAAK,EACpCA,EAAA,aAAa,YAAaD,CAAQ,EAClCC,EAAA,aAAa,cAAe,MAAM,EAC/CA,EAAa,UAAY,UACzBA,EAAa,YAAcN,EAElB,cAAK,YAAYM,CAAY,EAGtC,WAAW,IAAM,CACN,cAAK,YAAYA,CAAY,GACrC,GAAI,CACT,EAEaC,GAAe,CAACC,EAAmBC,EAAQ,MAAc,CACpE,WAAW,IAAM,CACT,MAAAC,EAAU,SAAS,eAAeF,CAAS,EAC7CE,GACFA,EAAQ,MAAM,GAEfD,CAAK,CACV,ECrNME,GAAeC,gBAA4C,MAAS,EAE7DC,GAAW,IAAM,CACtB,MAAAC,EAAUC,aAAWJ,EAAY,EACvC,GAAIG,IAAY,OACR,UAAI,MAAM,8CAA8C,EAEzD,OAAAA,CACT,EAMaE,GAA8C,CAAC,CAAE,SAAAC,KAAe,CAC3E,KAAM,CAAChC,EAAOiC,CAAa,EAAIC,WAAgBrC,EAAc,EAEvDsC,EAAYC,GAAoB,CACpCH,EAAcG,CAAQ,EACtBrC,GAAeqC,CAAQ,GAGnBC,EAAc,IAAM,CAExBF,EADiBnC,IAAU,QAAU,OAAS,OAC7B,GAGnBsC,YAAU,IAAM,CAEdvC,GAAeC,CAAK,GACnB,CAACA,CAAK,CAAC,EAEVsC,YAAU,IAAM,CAER,MAAAC,EAAa,OAAO,WAAW,8BAA8B,EAE7DC,EAAgBC,GAA2B,CAC3B,aAAa,QAAQ,UAAU,GAGnCR,EAAAQ,EAAE,QAAU,OAAS,OAAO,CAC5C,EAGS,OAAAF,EAAA,iBAAiB,SAAUC,CAAY,EAC3C,IAAMD,EAAW,oBAAoB,SAAUC,CAAY,CACpE,EAAG,CAAE,GAEL,MAAME,EAAQ,CACZ,MAAA1C,EACA,YAAAqC,EACA,SAAAF,CAAA,EAGF,OAAQQ,MAAAjB,GAAa,SAAb,CAAsB,MAAAgB,EAAe,SAAAV,CAAS,EACxD,ECjEA,6CAMA,MAAMY,GAAY,CACd,aAAc,UACd,IAAK,iBAEL,kBAAmB,4CACnB,uBAAwB,4BACxB,sBAAuB,SAEvB,KAAM,OACN,KAAM,SAEN,6BAA8B,sGAE9B,cAAe,iBACf,yBAA0B,mBAE1B,eAAgB,IAEhB,WAAY,aAEZ,OAAQ,SAER,cAAe,uCAEf,aAAc,SACd,cAAe,UACf,qBAAsB,iBACtB,YAAa,QACb,gBAAiB,qBACjB,cAAe,gBACf,2BAA4B,OAC5B,sBAAuB,kDACvB,sBAAuB,wBACvB,YAAa,cACb,aAAc,GACd,eAAgB,MAChB,cAAe,gBACf,cAAe,IACf,cAAe,4DACf,aAAc,aACd,aAAc,IACd,gCAAiC,gBACjC,kCAAmC,sBACnC,oBAAqB,CACjB,4BACA,oBACA,sBACA,iBACH,EACD,mBAAoB,IACpB,iBAAkB,kBACtB,ECzDA,6CAgCA,MAAMC,WAAkB,KAAM,CAC1B,YAAYC,EAAWC,EAAcC,EAAU,CAC3C,MAAMC,EAAcF,EACd,GAAGD,CAAS,KAAKC,CAAY,GAC7BD,EACN,MAAMG,CAAW,EACjB,OAAO,eAAe,KAAMJ,GAAU,SAAS,EAC/C,KAAK,UAAYC,GAAaF,GAAU,aACxC,KAAK,aAAeG,GAAgBH,GAAU,aAC9C,KAAK,SAAWI,GAAYJ,GAAU,aACtC,KAAK,KAAO,WACf,CACD,iBAAiBM,EAAe,CAC5B,KAAK,cAAgBA,CACxB,CACL,CC/CA,6CAWA,IAAIC,IACH,SAAUA,EAAU,CACjBA,EAASA,EAAS,MAAW,CAAC,EAAI,QAClCA,EAASA,EAAS,QAAa,CAAC,EAAI,UACpCA,EAASA,EAAS,KAAU,CAAC,EAAI,OACjCA,EAASA,EAAS,QAAa,CAAC,EAAI,UACpCA,EAASA,EAAS,MAAW,CAAC,EAAI,OACtC,GAAGA,KAAaA,GAAW,CAAE,EAAC,EAI9B,MAAMC,EAAO,CACT,YAAYC,EAAeC,EAAaC,EAAgB,CAEpD,KAAK,MAAQJ,GAAS,KACtB,MAAMK,EAAwB,IAAM,CAE5C,EACcC,EAAmBJ,GAAiBD,GAAO,2BAA0B,EAC3E,KAAK,cACDK,EAAiB,gBAAkBD,EACvC,KAAK,kBAAoBC,EAAiB,mBAAqB,GAC/D,KAAK,MACD,OAAOA,EAAiB,UAAa,SAC/BA,EAAiB,SACjBN,GAAS,KACnB,KAAK,cACDM,EAAiB,eAAiBb,GAAU,aAChD,KAAK,YAAcU,GAAeV,GAAU,aAC5C,KAAK,eAAiBW,GAAkBX,GAAU,YACrD,CACD,OAAO,4BAA6B,CAChC,MAAO,CACH,eAAgB,IAAM,CAErB,EACD,kBAAmB,GACnB,SAAUO,GAAS,IAC/B,CACK,CAID,MAAMG,EAAaC,EAAgBL,EAAe,CAC9C,OAAO,IAAIE,GAAO,CACd,eAAgB,KAAK,cACrB,kBAAmB,KAAK,kBACxB,SAAU,KAAK,MACf,cAAeF,GAAiB,KAAK,aACjD,EAAWI,EAAaC,CAAc,CACjC,CAID,WAAWG,EAAYvE,EAAS,CAC5B,GAAIA,EAAQ,SAAW,KAAK,OACvB,CAAC,KAAK,mBAAqBA,EAAQ,YACpC,OAKJ,MAAMwE,EAAM,GADM,IAFA,IAAI,KAAM,EAAC,YAAW,CAET,QAAQxE,EAAQ,eAAiB,KAAK,eAAiB,EAAE,GAChE,MAAM,KAAK,WAAW,IAAI,KAAK,cAAc,MAAMgE,GAAShE,EAAQ,QAAQ,CAAC,MAAMuE,CAAU,GAErH,KAAK,gBAAgBvE,EAAQ,SAAUwE,EAAKxE,EAAQ,aAAe,EAAK,CAC3E,CAID,gBAAgByE,EAAO7C,EAAS8C,EAAa,CACrC,KAAK,eACL,KAAK,cAAcD,EAAO7C,EAAS8C,CAAW,CAErD,CAID,MAAM9C,EAASmC,EAAe,CAC1B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,MACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,SAAS7B,EAASmC,EAAe,CAC7B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,MACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,QAAQ7B,EAASmC,EAAe,CAC5B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,QACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,WAAW7B,EAASmC,EAAe,CAC/B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,QACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,KAAK7B,EAASmC,EAAe,CACzB,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,KACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,QAAQ7B,EAASmC,EAAe,CAC5B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,KACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,QAAQ7B,EAASmC,EAAe,CAC5B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,QACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,WAAW7B,EAASmC,EAAe,CAC/B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,QACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,MAAM7B,EAASmC,EAAe,CAC1B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,MACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,SAAS7B,EAASmC,EAAe,CAC7B,KAAK,WAAWnC,EAAS,CACrB,SAAUoC,GAAS,MACnB,YAAa,GACb,cAAeD,GAAiBN,GAAU,YACtD,CAAS,CACJ,CAID,qBAAsB,CAClB,OAAO,KAAK,mBAAqB,EACpC,CACL,CC/LA,6CA2GA,IAAIkB,IACH,SAAUA,EAAiB,CACxBA,EAAgB,SAAc,WAC9BA,EAAgB,MAAW,QAC3BA,EAAgB,OAAY,SAC5BA,EAAgB,KAAU,MAC9B,GAAGA,KAAoBA,GAAkB,CAAE,EAAC,EAK5C,MAAMC,GAAoB,CAItB,QAAS,UAIT,MAAO,QAIP,OAAQ,SAIR,aAAc,eAId,UAAW,YAIX,eAAgB,iBAIhB,KAAM,MACV,ECnJA,6CAMA,MAAMC,GAAsB,wBACtBC,GAAuC,2CACvCC,GAA2B,8BCRjC,6CAWA,MAAMC,GAAwC,CAC1C,CAACH,EAAmB,EAAG,wDACvB,CAACC,EAAoC,EAAG,iLACxC,CAACC,EAAwB,EAAG,uRAChC,EAsBA,MAAME,WAAsCvB,EAAU,CAClD,YAAYC,EAAWC,EAAc,CACjC,MAAMD,EAAWC,CAAY,EAC7B,KAAK,KAAO,gCACZ,OAAO,eAAe,KAAMqB,GAA8B,SAAS,CACtE,CACL,CACA,SAASC,GAAoCvB,EAAW,CACpD,OAAO,IAAIsB,GAA8BtB,EAAWqB,GAAsCrB,CAAS,CAAC,CACxG,CC9CA,6CASA,MAAMwB,GAAiC,CACnC,WAAY,IACD,QAAQ,OAAOD,GAAoCJ,EAAoC,CAAC,EAEnG,kBAAmB,IACR,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,qBAAsB,IACX,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,mBAAoB,IACT,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,mBAAoB,IACT,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,eAAgB,IACL,GAEX,WAAY,IACD,KAEX,mBAAoB,IACT,KAEX,qBAAsB,IACX,KAEX,oBAAqB,IACV,KAEX,sBAAuB,IACZ,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,WAAY,IACD,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,cAAe,IACJ,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,OAAQ,IACG,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,eAAgB,IACL,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,YAAa,IACF,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,UAAW,IACA,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,iBAAkB,IACP,KAEX,oBAAqB,IAAM,CAE1B,EACD,uBAAwB,IACb,GAEX,0BAA2B,IAChB,GAEX,2BAA4B,IAAM,CAEjC,EACD,4BAA6B,IAAM,CAElC,EACD,cAAe,IAAM,CACjB,MAAMI,GAAoCJ,EAAoC,CACjF,EACD,UAAW,IAAM,CACb,MAAMI,GAAoCJ,EAAoC,CACjF,EACD,UAAW,IAAM,CAEhB,EACD,iBAAkB,IAAM,CAEvB,EACD,iBAAkB,IACP,KAEX,yBAA0B,IAAM,CAE/B,EACD,oBAAqB,IAAM,CAE1B,EACD,iBAAkB,IAAM,CACpB,MAAMI,GAAoCJ,EAAoC,CACjF,EACD,aAAc,IACH,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,EAEnG,WAAY,IACD,QAAQ,OAAOI,GAAoCJ,EAAoC,CAAC,CAEvG,EC7GA,2CAaA,MAAMM,GAAqB,CACvB,SAAUD,GACV,WAAYP,GAAkB,KAC9B,SAAU,CAAE,EACZ,OAAQ,IAAIX,GAAO,EAAE,CACzB,EACMoB,GAAcC,gBAAoBF,EAAkB,EACrCC,GAAY,SCpBjC,2CAYA,MAAME,GAAU,IAAM5C,EAAU,WAAC0C,EAAW,ECmD/BG,GAA8B,CACzC,OAAQ,CAAC,SAAU,UAAW,QAAS,WAAW,EAClD,UAAW,oBACb,EAMaC,GAAY,CACvB,MAAO,QACP,cAAe,cACjB,ECpBMC,GAAclD,gBAA2C,MAAS,EAM3DmD,GAAU,IAAuB,CACtC,MAAAjD,EAAUC,aAAW+C,EAAW,EACtC,GAAIhD,IAAY,OACR,UAAI,MAAM,6CAA6C,EAExD,OAAAA,CACT,EAuOakD,GAAqD,CAAC,CAAE,SAAA/C,uBAKvD,SAAAA,CAAS,GAIVgD,GAAuD,CAAC,CAAE,SAAAhD,KAK5D,KCpTLiD,GAAqB,CACzB,GAAI,eACJ,MAAO,sBACP,KAAM,iBACN,MAAO,CAAC,OAAO,EACf,YAAa,QACb,OAAQ,CAAC,EACT,kBAAmB,WACrB,EAMaC,GAAoD,CAAC,CAAE,SAAAlD,KAAe,CACjF,MAAMmD,EAAgB,CAEpB,KAAMF,GACN,gBAAiB,GACjB,UAAW,GACX,MAAO,KAGP,MAAO,SAAY,CACjB,QAAQ,IAAI,qCAAqC,CACnD,EACA,OAAQ,SAAY,CAClB,QAAQ,IAAI,sCAAsC,CACpD,EACA,WAAY,IAAM,CAChB,QAAQ,IAAI,0CAA0C,CACxD,EAGA,QAAS,IAAM,GACf,WAAY,IAAM,GAClB,QAAS,IAAM,GACf,sBAAuB,IAAM,IAG/B,aACGJ,GAAY,SAAZ,CAAqB,MAAOM,EAC1B,SAAAnD,CACH,EAEJ,EClCA,QAAQ,IAAI,uBAA6D,6BAA6B,EACtG,QAAQ,IAAI,0BAA2B,OAAsC,EAItE,MAAMoD,GAAkE,CAAC,CAAE,SAAApD,KAa5EW,MAACuC,IACE,SAAAlD,CACH,GCbOqD,GAAwB,IAAM,CACzC,KAAM,CAAE,MAAAC,EAAO,UAAAC,EAAW,MAAArE,GAAU4D,GAAQ,EAEtCU,EAAc,IAAM,CAClBF,IAAE,MAAM,QAAQ,KAAK,GAG7B,aACG,MAAI,WAAU,uGACb,SAACG,EAAA,YAAI,UAAU,4BACb,UAACA,OAAA,OAAI,UAAU,cACb,UAAC9C,MAAA,OAAI,UAAU,kDACb,SAAAA,EAAA,IAAC,QAAK,UAAU,oEAAoE,cAAE,CACxF,GACCA,EAAA,UAAG,UAAU,wDAAwD,SAEtE,6BACCA,EAAA,SAAE,UAAU,gDAAgD,SAE7D,8CACF,EAEA8C,OAAC,MAAI,WAAU,YACZ,UACCvE,GAAAyB,EAAA,IAAC,OAAI,UAAU,wFACb,eAAC,MAAI,WAAU,yCACZ,SAAAzB,CAAA,CACH,CACF,GAGFyB,EAAA,IAAC,UACC,QAAS6C,EACT,SAAUD,EACV,UAAU,kSAET,SACCA,EAAAE,OAAC,MAAI,WAAU,oBACb,UAACA,OAAA,OAAI,UAAU,6CAA6C,MAAM,6BAA6B,KAAK,OAAO,QAAQ,YACjH,UAAA9C,EAAA,IAAC,SAAO,WAAU,aAAa,GAAG,KAAK,GAAG,KAAK,EAAE,KAAK,OAAO,eAAe,YAAY,IAAI,QAC3F,OAAK,WAAU,aAAa,KAAK,eAAe,EAAE,kHAAkH,GACvK,EAAM,gBAER,GAEA8C,OAAC,MAAI,WAAU,oBACb,UAAAA,OAAC,OAAI,UAAU,eAAe,QAAQ,YAAY,MAAM,6BACtD,UAAC9C,MAAA,QAAK,EAAE,IAAI,EAAE,IAAI,MAAM,IAAI,OAAO,IAAI,KAAK,SAAS,GACrDA,MAAC,OAAK,GAAE,IAAI,EAAE,KAAK,MAAM,IAAI,OAAO,IAAI,KAAK,SAAS,GACtDA,MAAC,OAAK,GAAE,KAAK,EAAE,IAAI,MAAM,IAAI,OAAO,IAAI,KAAK,SAAS,GACtDA,MAAC,OAAK,GAAE,KAAK,EAAE,KAAK,MAAM,IAAI,OAAO,IAAI,KAAK,SAAS,IACzD,EAAM,0BAER,EAEJ,EAEAA,MAAC,OAAI,UAAU,cACb,eAAC,IAAE,WAAU,2CAA2C,qDAExD,CACF,IACF,EACF,EACF,EAEJ,EAKa+C,GAA4C,CAAC,CACxD,SAAA1D,EACA,SAAA2D,EACA,WAAAC,CACF,IAAM,CACJ,MAAMC,EAAWC,KAEjB,OAEIL,EAAA,KAAAM,WAAA,WAAApD,MAACoC,IACE,SAAA/C,EACH,QACCgD,GACE,UAAAW,IACCC,EACGjD,MAAAqD,GAAA,CAAS,GAAIJ,EAAY,MAAO,CAAE,KAAMC,GAAY,QAAO,GAAC,EAE7DlD,MAAC0C,KAAY,GAGnB,CACF,GAEJ,EAKaY,GAAwC,CAAC,CACpD,SAAAjE,EACA,MAAAkE,EACA,WAAAC,EAAa,GACb,SAAAR,EACA,WAAAC,CACF,IAAM,CACJ,KAAM,CAAE,QAAAQ,EAAS,WAAAC,EAAY,KAAAC,GAASxB,GAAQ,EACxCe,EAAWC,KAOjB,OAJkBK,EACdD,EAAM,MAAMK,GAAQH,EAAQG,CAAI,CAAC,EACjCF,EAAWH,CAAK,qBAkCV,SAAAlE,CAAS,GA/Bb2D,oBACQ,SAASA,CAAA,GAGjBC,EACKjD,MAACqD,GAAS,IAAIJ,EAAY,MAAO,CAAE,KAAMC,CAAY,UAAO,EAAC,SAInE,MAAI,WAAU,uGACb,SAACJ,EAAA,YAAI,UAAU,wCACb,UAAC9C,EAAA,WAAI,UAAU,gBAAgB,SAAE,OAChCA,EAAA,UAAG,UAAU,wDAAwD,SAEtE,kBACCA,EAAA,SAAE,UAAU,mCAAmC,SAEhD,uDACA8C,OAAC,MAAI,WAAU,6CACb,UAACA,OAAA,KAAE,UAAU,gDAAgD,0BAC7CS,EAAM,OAAS,EAAI,IAAM,GAAG,KAAGA,EAAM,KAAK,IAAI,GAC9D,EACAT,OAAC,IAAE,WAAU,2CAA2C,sBAC5Ca,GAAA,MAAAA,EAAM,MAAM,QAAUA,EAAK,MAAM,OAAS,EAAI,IAAM,GAAG,MAAGA,GAAA,YAAAA,EAAM,MAAM,KAAK,QAAS,QAChG,GACF,EACF,EACF,EAKN,EA6CaE,GAAgD,CAAC,CAC5D,SAAAxE,EACA,YAAAyE,EAAc,GACd,aAAAC,EAAe,CAAC,EAChB,WAAAP,EAAa,GACb,SAAAR,EACA,WAAAC,CACF,IACM,CAACa,GAAeC,EAAa,SAAW,oBAChC,SAAA1E,CAAS,GAGjByE,GAAeC,EAAa,SAAW,EAEtC/D,MAAA+C,GAAA,CAAY,SAAAC,EAAoB,WAAAC,EAC9B,SAAA5D,CACH,GAKFW,MAAC+C,GAAY,UAAAC,EAAoB,WAAAC,EAC/B,SAAAjD,EAAA,IAACsD,GAAA,CACC,MAAOS,EACP,WAAAP,EACA,SAAAR,EACA,WAAAC,EAEC,SAAA5D,CAAA,CAEL,IC5OS2E,GAA8B,IAAM,CAC/C,MAAMC,EAAWC,KACXhB,EAAWC,KACX,CAAE,KAAAQ,EAAM,gBAAAQ,EAAiB,UAAAvB,EAAW,QAAAa,CAAA,EAAYtB,KAEtDxC,mBAAU,IAAM,CAOV,GALAiD,GAAa,CAACuB,GAAmB,CAACR,GAKlCT,EAAS,WAAa,IACxB,OAIF,IAAIkB,EAAc,IAEdX,EAAQxB,GAAU,aAAa,GAAK,CAACwB,EAAQxB,GAAU,KAAK,EAEhDmC,EAAA,YACLX,EAAQxB,GAAU,KAAK,EAElBmC,EAAA,KAOZA,IAAgBlB,EAAS,UAC3Be,EAASG,EAAa,CAAE,QAAS,EAAM,EACzC,EACC,CAACT,EAAMQ,EAAiBvB,EAAWM,EAAS,SAAUe,EAAUR,CAAO,CAAC,EAGpE,IACT,ECvCO,MAAMY,EAAa,CAIxB,YAAYC,EAAmBC,EAAe,CAHtCC,EAAA,qBACAA,EAAA,iBAGN,KAAK,aAAeF,EACpB,KAAK,SAAWC,CAClB,CAKA,MAAM,gBAAkD,CACtD,GAAI,CAAC,KAAK,UAAY,KAAK,SAAS,SAAW,EAC7C,MAAO,GAGL,IAOK,OACL,cAAiB,WANF,MAAM,KAAK,aAAa,mBAAmB,CAC1D,GAAGvC,GACH,QAAS,KAAK,SAAS,CAAC,EACzB,GAGqC,WAAW,GAC/C,YAAa,KAAK,SAAS,CAAC,EAAE,cAC9B,mBAAoB,KAAK,SAAS,CAAC,EAAE,gBAEhCzD,EAAO,CACN,oBAAK,2CAA4CA,CAAK,EACvD,EACT,CACF,CAKA,gBAAiB,CACf,GAAI,CAAC,KAAK,UAAY,KAAK,SAAS,SAAW,EACtC,YAGH,MAAAkG,EAAU,KAAK,SAAS,CAAC,EACxB,OACL,OAAQA,EAAQ,cAChB,SAAUA,EAAQ,SAClB,KAAMA,EAAQ,KAElB,CACF,CAKO,MAAMC,GAAkB,IAAM,CACnC,KAAM,CAAE,SAAAC,EAAU,SAAAJ,CAAS,EAAIxC,GAAQ,EAEhC,WAAIsC,GAAaM,EAAUJ,CAAQ,CAC5C,EC9CA,MAAMK,EAAU,CAId,YAAYC,EAAiBC,EAA4B,CAHjDN,EAAA,gBACAA,EAAA,qBAGN,KAAK,QAAUK,EACf,KAAK,aAAeC,CACtB,CAEA,gBAAgBA,EAA2B,CACzC,KAAK,aAAeA,CACtB,CAEA,MAAc,eAAkBC,EAAgC,CAC1D,IAACA,EAAS,GAAI,CACV,MAAAC,EAAY,MAAMD,EAAS,OAAO,MAAM,KAAO,CAAG,IAElD,MAAA7G,GACJ,QAAQ6G,EAAS,MAAM,GACvBC,EAAU,SAAW,QAAQD,EAAS,MAAM,KAAKA,EAAS,UAAU,GACpE,CACE,OAAQA,EAAS,OACjB,WAAYA,EAAS,WACrB,KAAMC,CACR,EAEJ,CAEA,OAAOD,EAAS,MAClB,CAEA,MAAc,QACZE,EACAzI,EAAuB,GACX,CACR,IAEF,MAAMqI,EAAU,KAAK,QAAQ,SAAS,GAAG,EAAI,KAAK,QAAQ,MAAM,EAAG,EAAE,EAAI,KAAK,QACxEK,EAAgBD,EAAS,WAAW,GAAG,EAAIA,EAAW,IAAIA,CAAQ,GAClEE,EAAM,GAAGN,CAAO,GAAGK,CAAa,GAEhCE,EAAiB,CACrB,eAAgB,mBAChB,GAAG5I,EAAQ,SAIb,GAAI,KAAK,aACH,IACF,MAAM6I,EAAc,MAAM,KAAK,aAAa,eAAe,EACpD,cAAOD,EAAgBC,CAAW,QAClCC,EAAW,CAEV,aAAK,wCAAyCA,CAAS,CACjE,CAGI,MAAAP,EAAW,MAAM,MAAMI,EAAK,CAChC,GAAG3I,EACH,QAAS4I,CAAA,CACV,EAEM,YAAK,eAAkBL,CAAQ,QAC/BxG,EAAO,CACV,MAAAD,GAAeC,CAAK,EAChBL,GACJ,gBACA,0EACA,CAAE,cAAeK,CAAM,GAIvBA,aAAiB,OAAS,SAAUA,EAChCA,EAGFL,GACJ,gBACA,+BACA,CAAE,cAAeK,CAAM,EAE3B,CACF,CAEA,MAAM,IAAO0G,EAA8B,CACzC,OAAO,KAAK,QAAWA,EAAU,CAAE,OAAQ,MAAO,CACpD,CAEA,MAAM,KAAQA,EAAkBM,EAA4B,CACnD,YAAK,QAAWN,EAAU,CAC/B,OAAQ,OACR,KAAMM,EAAO,KAAK,UAAUA,CAAI,EAAI,OACrC,CACH,CAEA,MAAM,IAAON,EAAkBM,EAA4B,CAClD,YAAK,QAAWN,EAAU,CAC/B,OAAQ,MACR,KAAMM,EAAO,KAAK,UAAUA,CAAI,EAAI,OACrC,CACH,CAEA,MAAM,OAAUN,EAA8B,CAC5C,OAAO,KAAK,QAAWA,EAAU,CAAE,OAAQ,SAAU,CACvD,CACF,CAGA,MAAMO,GAAY,IAAIZ,GAAUjI,GAAO,IAAI,OAAO,EAGrC8I,GAAsBX,GAA8B,CAC/DU,GAAU,gBAAgBV,CAAY,CACxC,EAGaY,GAAa,CAExB,MAAM,aAA4C,CACzC,OAAAF,GAAU,IAAyB3I,GAAc,MAAM,CAChE,EAGA,MAAM,gBAAgB8I,EAAmE,CACvF,OAAOH,GAAU,KACf3I,GAAc,kBACd8I,CAAA,CAEJ,EAGA,MAAM,iBAAiBA,EAAqE,CAC1F,OAAOH,GAAU,KACf3I,GAAc,mBACd8I,CAAA,CAEJ,EAGA,MAAM,yBAAyBC,EAA8C,CAC3E,OAAOJ,GAAU,IACf,GAAG3I,GAAc,sBAAsB,IAAI+I,CAAS,GAExD,EAGA,MAAM,mBAAmB5I,EAA6C,CACpE,OAAOwI,GAAU,IACf,GAAG3I,GAAc,mBAAmB,IAAIG,CAAM,GAElD,EAGA,MAAM,gBAAgB6I,EAA6F,CACjH,OAAOL,GAAU,KACf,WACAK,CAAA,CAEJ,EAEA,MAAM,eAAeD,EAAyC,CAC5D,OAAOJ,GAAU,IAAiB,YAAYI,CAAS,EAAE,CAC3D,EAEA,MAAM,gBAAgB5I,EAAuF,CAC3G,OAAOwI,GAAU,IACf,kBAAkBxI,CAAM,GAE5B,EAEA,MAAM,gBAAwF,CAC5F,OAAOwI,GAAU,IACf,eAEJ,EAEA,MAAM,kBAAkBI,EAAmBC,EAA0E,CACnH,OAAOL,GAAU,IACf,YAAYI,CAAS,GACrBC,CAAA,CAEJ,EAEA,MAAM,kBAAkBD,EAAmE,CACzF,OAAOJ,GAAU,OACf,YAAYI,CAAS,GAEzB,EAGA,MAAM,gBAAiE,CACjE,IACF,aAAM,KAAK,cACJ,CAAE,QAAS,GAAM,QAAS,2BAA4B,QACtDrH,EAAO,CAEP,OACL,QAAS,GACT,QAHeA,EAGG,SAAW,yBAEjC,CACF,EAKA,MAAM,uBAAuBqH,EAAoG,CAC/H,OAAOJ,GAAU,KACf,YAAYI,CAAS,mBAEzB,EAEA,MAAM,kBAAkBA,EAAoG,CAC1H,OAAOJ,GAAU,IACf,YAAYI,CAAS,mBAEzB,EAGA,MAAM,eAAeE,EAAwE,CAC3F,OAAON,GAAU,KACf,iBACA,CAAE,KAAAM,CAAK,EAEX,CACF,EAGO,MAAMC,EAAiB,CAS5B,YACEH,EACApJ,EAII,GACJ,CAfMgI,EAAA,kBACAA,EAAA,mBACAA,EAAA,oBACAA,EAAA,sBACAA,EAAA,sBAAiB,GACjBA,EAAA,iBAA2B,MAC3BA,EAAA,iBAAY,IAUlB,KAAK,UAAYoB,EACjB,KAAK,WAAapJ,EAAQ,YAAcG,GAAO,QAAQ,WACvD,KAAK,YAAcH,EAAQ,aAAeG,GAAO,QAAQ,YACzD,KAAK,cAAgBH,EAAQ,eAAiBG,GAAO,QAAQ,aAC/D,CAEA,MAAM,MACJqJ,EACAC,EACAC,EACe,CACf,GAAI,KAAK,UACP,OAGF,KAAK,UAAY,GACjB,KAAK,eAAiB,EAEtB,MAAMC,EAAO,SAA2B,CAClC,IACF,MAAMC,EAAS,MAAMV,GAAW,yBAAyB,KAAK,SAAS,EAInE,GAFJM,EAASI,CAAM,EAEXA,EAAO,SAAW,aAAeA,EAAO,SAAW,WAAaA,EAAO,SAAW,SAAU,CAC9F,KAAK,KAAK,EACVH,EAAWG,CAAM,EACjB,MACF,CAII,GAFC,sBAED,KAAK,gBAAkB,KAAK,YAAa,CAC3C,KAAK,KAAK,EACFF,EAAAhI,GACN,kBACA,mEACA,CAAE,UAAW,KAAK,UAAW,SAAU,KAAK,cAAe,EAC5D,EACD,MACF,CAGM,MAAAmI,EAAe,KAAK,WAAa,KAAK,IAAI,KAAK,cAAe,KAAK,cAAc,EACvF,KAAK,UAAY,OAAO,WAAWF,EAAME,CAAY,QAE9C9H,EAAO,CACd,KAAK,KAAK,EACV2H,EAAQ3H,CAAiB,CAC3B,GAIF,MAAM4H,EAAK,CACb,CAEA,MAAa,CACX,KAAK,UAAY,GACb,KAAK,YACP,aAAa,KAAK,SAAS,EAC3B,KAAK,UAAY,KAErB,CAEA,WAA0E,CACjE,OACL,UAAW,KAAK,UAChB,QAAS,KAAK,eACd,YAAa,KAAK,YAEtB,CACF,CCxUO,MAAMG,GAA8D,CAAC,CAAE,SAAAjH,KAAe,CAC3F,MAAMyF,EAAeJ,KAErB/E,mBAAU,IAAM,CAEd8F,GAAmBX,CAAY,GAC9B,CAACA,CAAY,CAAC,oBAEP,SAAAzF,CAAS,EACrB,ECXakH,GAAmB,IAAM,CACpC,MAAMC,EAAWC,EAAA,YAAY,CAC3BrI,EACAK,EAAmC,WAChC,CACHD,GAAuBJ,EAASK,CAAQ,CAC1C,EAAG,CAAE,GAECiI,EAAgBD,cAAarI,GAAoB,CACrDoI,EAASpI,EAAS,WAAW,GAC5B,CAACoI,CAAQ,CAAC,EAEPG,EAAkBF,cAAarI,GAAoB,CACvDoI,EAASpI,EAAS,QAAQ,GACzB,CAACoI,CAAQ,CAAC,EAEN,OACL,SAAAA,EACA,cAAAE,EACA,gBAAAC,CAAA,CAEJ,EA+CaC,GAAwB,IAAM,CACnC,MAAAC,EAAeJ,cAAaK,GAAyB,CACnD,MAAAC,EAAiBC,GAAyB,CAC1CA,EAAM,MAAQ,WAChBA,EAAM,eAAe,EACZF,IACX,EAGO,iCAAiB,UAAWC,CAAa,EAC3C,IAAM,SAAS,oBAAoB,UAAWA,CAAa,CACpE,EAAG,CAAE,GAECE,EAAmBR,cAAaK,GAC5BE,GAA+B,EACjCA,EAAM,MAAQ,SAAWA,EAAM,MAAQ,OACzCA,EAAM,eAAe,EACZF,IACX,EAED,CAAE,GAEE,OACL,aAAAD,EACA,iBAAAI,CAAA,CAEJ,EAiDaC,GAAmB,KAKvB,CAAE,WAJUT,cAAY,IAAM,CACtB9H,GAAA7B,GAAK,mBAAoBA,GAAK,aAAa,CAC1D,EAAG,CAAE,EAEe,GC/ITqK,GAAgC,CAAC,CAAE,UAAAC,EAAY,MAAS,CACnE,KAAM,CAAE,MAAA/J,EAAO,YAAAqC,CAAY,EAAIT,GAAS,EAClC,CAAE,KAAA0E,EAAM,OAAA0D,EAAQ,gBAAAlD,EAAiB,QAAAmD,CAAA,EAAYnF,KAC7Ce,EAAWC,KACX,CAAE,iBAAA8D,GAAqBL,KACvB,CAACW,EAAkBC,CAAmB,EAAIjI,WAAS,EAAK,EACxD,CAACkI,EAAcC,CAAe,EAAInI,WAAS,EAAK,EAGhDoI,EAAgB,GAGhBC,EAAqB,IACP,CAChB,CAAE,KAAM,IAAK,MAAO,YAAa,KAAM,KAAM,MAAO,CAAC3F,GAAU,KAAK,CAAE,EACtE,CAAE,KAAM,UAAW,MAAO,mBAAoB,KAAM,KAAM,MAAO,CAACA,GAAU,KAAK,CAAE,EACnF,CAAE,KAAM,YAAa,MAAO,WAAY,KAAM,KAAM,MAAO,CAACA,GAAU,KAAK,CAAE,EAC7E,CAAE,KAAM,eAAgB,MAAO,iBAAkB,KAAM,KAAM,MAAO,CAACA,GAAU,KAAK,CAAE,GAqB1FtC,YAAU,IAAM,CACd,QAAQ,IAAI,iCAAkC,CAC5C,gBAAAwE,EACA,KAAMR,EAAO,CAAE,GAAIA,EAAK,GAAI,KAAMA,EAAK,KAAM,MAAOA,EAAK,KAAU,OACnE,UAAW,IAAI,KAAK,EAAE,YAAY,EACnC,GACA,CAACQ,EAAiBR,CAAI,CAAC,EAE1B,MAAMkE,EAAWD,IAEXE,EAAgBC,GAChBA,IAAS,IACJ7E,EAAS,WAAa,IAExBA,EAAS,SAAS,WAAW6E,CAAI,EAGpCC,EAAmB,IAAM,CAC7BR,EAAoB,CAACD,CAAgB,GAGjCU,EAAkB,IAAM,CAC5BT,EAAoB,EAAK,GAI3B7H,mBAAU,IAAM,CACd6H,EAAoB,EAAK,EACzBE,EAAgB,EAAK,GACpB,CAACxE,EAAS,QAAQ,CAAC,EAGtBvD,YAAU,IAAM,CACR,MAAAuI,EAAsBlB,GAAsB,CAChD,MAAMpJ,EAASoJ,EAAM,OACjBS,GAAgB,CAAC7J,EAAO,QAAQ,kBAAkB,GACpD8J,EAAgB,EAAK,CACvB,EAGO,iCAAiB,YAAaQ,CAAkB,EAClD,IAAM,SAAS,oBAAoB,YAAaA,CAAkB,GACxE,CAACT,CAAY,CAAC,EAGfzH,EAAA,IAAC,UAAO,UAAW,uFAAuFoH,CAAS,GACjH,SAAAtE,EAAA,KAAC,MAAI,WAAU,yCACb,UAACA,OAAA,OAAI,UAAU,yCAEb,UAAC9C,MAAA,OAAI,UAAU,oBACb,SAAA8C,EAAA,KAACqF,GAAA,CACC,GAAG,IACH,UAAU,8OACV,aAAW,6CAEX,UAAAnI,MAAC,QAAK,UAAU,qFAAqF,KAAK,MAAM,aAAW,aAAa,SAAE,OACzIA,EAAA,YAAK,UAAU,kBAAkB,SAAwB,6BACzDA,EAAA,YAAK,UAAU,YAAY,SAAG,WAEnC,EAGCA,EAAA,WAAI,UAAU,2BAA2B,KAAK,aAAa,aAAW,kBACpE,SAAA6H,EAAS,IAAI,CAAC,CAAE,KAAAE,EAAM,MAAAK,EAAO,KAAAC,KAC5BvF,EAAA,KAACqF,GAAA,CAEC,GAAIJ,EACJ,UAAW;AAAA;AAAA;AAAA,oBAIPD,EAAaC,CAAI,EACb,4EACA,wHACN;AAAA,kBAEF,eAAcD,EAAaC,CAAI,EAAI,OAAS,OAE5C,UAAA/H,MAAC,OAAK,MAAK,MAAM,cAAY,OAAQ,SAAKqI,EAAA,EAC1CrI,MAAC,QAAM,SAAMoI,CAAA,KAdRL,CAgBR,GACH,EAGAjF,OAAC,MAAI,WAAU,8BAEb,UAAAA,EAAA,KAAC,MAAI,WAAU,WAAW,iBAAc,GACrC,UA+BCA,EAAA,KAAC,OACC,UAAU;AAAA;AAAA;AAAA,oBAIV,aAAW,+BACX,MAAwB,6BAExB,UAAC9C,EAAA,WAAI,UAAU,mGAAmG,SAElH,YACC,OAAK,WAAU,uEACb,SAAiB,gBACpB,EACAA,EAAA,IAAC,OACC,UAAU,UACV,KAAK,OACL,OAAO,eACP,QAAQ,YAER,SAAAA,EAAA,IAAC,QAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,gBAAiB,GACxF,GACF,EAID2H,CAqCC,EAEJ,EAEA3H,EAAA,IAAC,UACC,QAASN,EACT,UAAWuH,EAAiBvH,CAAW,EACvC,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,gBAMV,aAAY,aAAarC,IAAU,QAAU,OAAS,OAAO,QAC7D,KAAK,SAEL,SAAA2C,EAAA,IAAC,OAAK,WAAU,UAAU,KAAK,MAAM,cAAY,OAC9C,SAAA3C,IAAU,QAAU,KAAO,KAC9B,EACF,EAGCwK,EAAS,OAAS,GACjB7H,EAAA,IAAC,UACC,QAASgI,EACT,UAAWf,EAAiBe,CAAgB,EAC5C,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMV,aAAYT,EAAmB,oBAAsB,mBACrD,KAAK,SACJ,GAAIA,EAAmB,CAAE,gBAAiB,IAAS,CAAE,gBAAiB,EAAM,EAE7E,SAAAvH,MAAC,OAAK,WAAU,UAAU,KAAK,MAAM,cAAY,OAC9C,SAAmBuH,EAAA,IAAM,GAC5B,GACF,GAEJ,GACF,EAGCA,GAAoBM,EAAS,OAAS,SACpC,MAAI,WAAU,oEACb,SAAA7H,EAAA,IAAC,MAAI,WAAU,YAAY,KAAK,aAAa,aAAW,oBACrD,SAAS6H,EAAA,IAAI,CAAC,CAAE,KAAAE,EAAM,MAAAK,EAAO,KAAAC,CAC5B,IAAAvF,EAAA,KAACqF,GAAA,CAEC,GAAIJ,EACJ,QAASE,EACT,UAAW;AAAA;AAAA;AAAA,sBAIPH,EAAaC,CAAI,EACb,4EACA,wHACN;AAAA,oBAEF,eAAcD,EAAaC,CAAI,EAAI,OAAS,OAE5C,UAAA/H,MAAC,OAAK,MAAK,MAAM,cAAY,OAAQ,SAAKqI,EAAA,EAC1CrI,MAAC,QAAM,SAAMoI,CAAA,KAfRL,CAAA,CAiBR,EACH,CACF,GAEJ,EACF,EAEJ,EC1SaO,GAA8C,CAAC,CAC1D,KAAAC,EAAO,GACP,UAAAnB,EAAY,GACZ,GAAGoB,CACL,IAEI1F,EAAA,KAAC,OACC,MAAOyF,EACP,OAAQA,EACR,QAAQ,YACR,UAAAnB,EACA,aAAW,YACV,GAAGoB,EAGJ,UAACxI,MAAA,QAAK,EAAE,IAAI,EAAE,IAAI,MAAM,KAAK,OAAO,KAAK,KAAK,SAAU,GACxDA,MAAC,OAAK,GAAE,KAAK,EAAE,IAAI,MAAM,KAAK,OAAO,KAAK,KAAK,SAAU,GACzDA,MAAC,OAAK,GAAE,IAAI,EAAE,KAAK,MAAM,KAAK,OAAO,KAAK,KAAK,SAAU,GACzDA,MAAC,OAAK,GAAE,KAAK,EAAE,KAAK,MAAM,KAAK,OAAO,KAAK,KAAK,SAAU,MCdnDyI,GAAgC,CAAC,CAAE,SAAApJ,EAAU,UAAA+H,EAAY,MAAS,CACvE,MAAE,WAAAsB,GAAexB,KAGrB,OAAApE,EAAA,KAAC,MAAI,WAAU,2DAEb,UAAA9C,EAAA,IAAC,KACC,KAAM,IAAIlD,GAAK,kBAAkB,GACjC,UAAU,YACV,QAAUgD,GAAM,CACdA,EAAE,eAAe,EACN4I,GACb,EACD,gCAED,QAGCvB,GAAO,IAGRnH,EAAA,IAAC,QACC,GAAIlD,GAAK,mBACT,UAAW,+CAA+CsK,CAAS,GACnE,SAAU,GAET,SAAA/H,CAAA,CACH,EAGAW,EAAA,IAAC,OACC,GAAIlD,GAAK,iBACT,UAAU,UACV,YAAU,SACV,cAAY,OACd,EAGAkD,EAAA,IAAC,SAAO,WAAU,8FAChB,SAAAA,EAAA,IAAC,MAAI,WAAU,8CACb,SAAA8C,OAAC,MAAI,WAAU,uCAEb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAACsI,GAAc,MAAM,GAAI,UAAU,aAAa,EAC/CtI,EAAA,YAAK,UAAU,sEAAsE,SAEtF,0BACF,EAGA8C,OAAC,MAAI,WAAU,sEACb,UAAAA,OAAC,IAAE,yCACgC,IAAI,KAAK,EAAE,YAAY,GAC1D,EACC9C,EAAA,SAAE,UAAU,OAAO,SAEpB,mDACF,EACF,EACF,GACF,CACF,GAEJ,EC1EA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOA,MAAM2I,GAAeC,GAAWA,EAAO,QAAQ,qBAAsB,OAAO,EAAE,cACxEC,GAAeD,GAAWA,EAAO,QACrC,wBACA,CAACE,EAAOC,EAAIC,IAAOA,EAAKA,EAAG,YAAW,EAAKD,EAAG,YAAa,CAC7D,EACME,GAAgBL,GAAW,CAC/B,MAAMM,EAAYL,GAAYD,CAAM,EACpC,OAAOM,EAAU,OAAO,CAAC,EAAE,YAAW,EAAKA,EAAU,MAAM,CAAC,CAC9D,EACMC,GAAe,IAAIC,IAAYA,EAAQ,OAAO,CAAChC,EAAWiC,EAAOC,IAC9D,EAAQlC,GAAcA,EAAU,KAAI,IAAO,IAAMkC,EAAM,QAAQlC,CAAS,IAAMiC,CACtF,EAAE,KAAK,GAAG,EAAE,KAAI,EACXE,GAAef,GAAU,CAC7B,UAAWgB,KAAQhB,EACjB,GAAIgB,EAAK,WAAW,OAAO,GAAKA,IAAS,QAAUA,IAAS,QAC1D,MAAO,EAGb,ECzBA;AAAA;AAAA;AAAA;AAAA;AAAA,GAOA,IAAIC,GAAoB,CACtB,MAAO,6BACP,MAAO,GACP,OAAQ,GACR,QAAS,YACT,KAAM,OACN,OAAQ,eACR,YAAa,EACb,cAAe,QACf,eAAgB,OAClB,ECjBA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWA,MAAMC,GAAOC,EAAU,WACrB,CAAC,CACC,MAAAC,EAAQ,eACR,KAAArB,EAAO,GACP,YAAAsB,EAAc,EACd,oBAAAC,EACA,UAAA1C,EAAY,GACZ,SAAA/H,EACA,SAAA0K,EACA,GAAGC,CACJ,EAAEC,IAAQC,EAAa,cACtB,MACA,CACE,IAAAD,EACA,GAAGR,GACH,MAAOlB,EACP,OAAQA,EACR,OAAQqB,EACR,YAAaE,EAAsB,OAAOD,CAAW,EAAI,GAAK,OAAOtB,CAAI,EAAIsB,EAC7E,UAAWV,GAAa,SAAU/B,CAAS,EAC3C,GAAG,CAAC/H,GAAY,CAACkK,GAAYS,CAAI,GAAK,CAAE,cAAe,MAAQ,EAC/D,GAAGA,CACJ,EACD,CACE,GAAGD,EAAS,IAAI,CAAC,CAACI,EAAKC,CAAK,IAAMF,EAAa,cAACC,EAAKC,CAAK,CAAC,EAC3D,GAAG,MAAM,QAAQ/K,CAAQ,EAAIA,EAAW,CAACA,CAAQ,CAClD,CACF,CACH,ECvCA;AAAA;AAAA;AAAA;AAAA;AAAA,GAWA,MAAMgL,EAAmB,CAACC,EAAUP,IAAa,CAC/C,MAAMQ,EAAYZ,EAAU,WAC1B,CAAC,CAAE,UAAAvC,EAAW,GAAGoB,CAAO,EAAEyB,IAAQC,EAAa,cAACR,GAAM,CACpD,IAAAO,EACA,SAAAF,EACA,UAAWZ,GACT,UAAUR,GAAYM,GAAaqB,CAAQ,CAAC,CAAC,GAC7C,UAAUA,CAAQ,GAClBlD,CACD,EACD,GAAGoB,CACT,CAAK,CACL,EACE,OAAA+B,EAAU,YAActB,GAAaqB,CAAQ,EACtCC,CACT,EC1BA;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMC,GAAa,CACjB,CACE,OACA,CACE,EAAG,6HACH,IAAK,QACN,CACF,CACH,EACMC,GAAWJ,EAAiB,WAAYG,EAAU,EClBxD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,iBAAkB,IAAK,QAAQ,CAAE,EAC/C,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACME,GAAYL,EAAiB,aAAcG,EAAU,ECb3D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,gBAAiB,IAAK,QAAQ,CAAE,CAChD,EACMG,GAAaN,EAAiB,cAAeG,EAAU,ECb7D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,iDAAkD,IAAK,QAAQ,CAAE,EAC/E,CAAC,OAAQ,CAAE,EAAG,iDAAkD,IAAK,QAAQ,CAAE,EAC/E,CAAC,OAAQ,CAAE,EAAG,qCAAsC,IAAK,QAAQ,CAAE,EACnE,CAAC,OAAQ,CAAE,EAAG,2BAA4B,IAAK,QAAQ,CAAE,EACzD,CAAC,OAAQ,CAAE,EAAG,sDAAuD,IAAK,QAAQ,CAAE,EACpF,CAAC,OAAQ,CAAE,EAAG,0BAA2B,IAAK,QAAQ,CAAE,EACxD,CAAC,OAAQ,CAAE,EAAG,oCAAqC,IAAK,QAAQ,CAAE,CACpE,EACMI,GAAQP,EAAiB,QAASG,EAAU,ECnBlD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,SAAU,IAAK,QAAQ,CAAE,EACvC,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,MAAO,KAAM,OAAQ,KAAM,EAAG,IAAK,EAAG,IAAK,GAAI,IAAK,IAAK,QAAQ,CAAE,EAC9E,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACMK,GAAWR,EAAiB,WAAYG,EAAU,ECfxD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,2BAA4B,IAAK,QAAQ,CAAE,EACzD,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACMM,GAAcT,EAAiB,eAAgBG,EAAU,ECf/D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,uGACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,kCAAmC,IAAK,QAAQ,CAAE,CAClE,EACMO,GAAWV,EAAiB,YAAaG,EAAU,ECnBzD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CAAC,CAAC,OAAQ,CAAE,EAAG,eAAgB,IAAK,QAAU,EAAC,EAC5DQ,GAAcX,EAAiB,eAAgBG,EAAU,ECV/D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CAAC,CAAC,OAAQ,CAAE,EAAG,iBAAkB,IAAK,QAAU,EAAC,EAC9DS,GAAYZ,EAAiB,aAAcG,EAAU,ECV3D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,IAAK,QAAQ,CAAE,EACjE,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,QAAS,GAAI,KAAM,GAAI,KAAM,IAAK,QAAQ,CAAE,CACvE,EACMU,GAAcb,EAAiB,eAAgBG,EAAU,ECd/D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,kCAAmC,IAAK,QAAQ,CAAE,EAChE,CAAC,OAAQ,CAAE,EAAG,iBAAkB,IAAK,QAAQ,CAAE,CACjD,EACMW,GAAiBd,EAAiB,mBAAoBG,EAAU,ECbtE;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,EAC1C,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACMY,GAAUf,EAAiB,WAAYG,EAAU,ECdvD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,cAAe,IAAK,QAAQ,CAAE,EAC5C,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,CAC3D,EACMa,GAAQhB,EAAiB,QAASG,EAAU,ECblD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,4CAA6C,IAAK,QAAQ,CAAE,EAC1E,CAAC,OAAQ,CAAE,EAAG,gBAAiB,IAAK,QAAQ,CAAE,CAChD,EACMc,GAAWjB,EAAiB,WAAYG,EAAU,ECdxD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,iGACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,uCAAwC,IAAK,QAAQ,CAAE,EACrE,CACE,OACA,CACE,EAAG,+FACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,CAC7C,EACMe,GAASlB,EAAiB,UAAWG,EAAU,EC3BrD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,wGACH,IAAK,QACN,CACF,EACD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,CAC1D,EACMgB,GAAMnB,EAAiB,MAAOG,EAAU,ECnB9C;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,qDAAsD,IAAK,QAAQ,CAAE,EACnF,CAAC,OAAQ,CAAE,EAAG,0BAA2B,IAAK,QAAQ,CAAE,EACxD,CACE,OACA,CACE,EAAG,yFACH,IAAK,QACN,CACF,CACH,EACMiB,GAAYpB,EAAiB,aAAcG,EAAU,ECpB3D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,6DAA8D,IAAK,QAAQ,CAAE,EAC3F,CAAC,OAAQ,CAAE,EAAG,0BAA2B,IAAK,QAAQ,CAAE,EACxD,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACMkB,GAAWrB,EAAiB,YAAaG,EAAU,EChBzD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,6DAA8D,IAAK,QAAQ,CAAE,EAC3F,CAAC,OAAQ,CAAE,EAAG,0BAA2B,IAAK,QAAQ,CAAE,CAC1D,EACMmB,GAAOtB,EAAiB,OAAQG,EAAU,ECbhD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,iGACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,0BAA2B,IAAK,QAAQ,CAAE,EACxD,CAAC,OAAQ,CAAE,EAAG,0DAA2D,IAAK,QAAQ,CAAE,CAC1F,EACMoB,GAAQvB,EAAiB,QAASG,EAAU,ECpBlD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,qJACH,IAAK,QACN,CACF,CACH,EACMqB,GAASxB,EAAiB,SAAUG,EAAU,EClBpD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,wJACH,IAAK,QACN,CACF,CACH,EACMsB,GAAQzB,EAAiB,QAASG,EAAU,EClBlD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,EAC1C,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,CAC5C,EACMuB,GAAO1B,EAAiB,OAAQG,EAAU,ECdhD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,uGACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACMwB,GAAY3B,EAAiB,YAAaG,EAAU,ECpB1D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CAAC,CAAC,OAAQ,CAAE,EAAG,8BAA+B,IAAK,QAAU,EAAC,EAC3EyB,GAAe5B,EAAiB,gBAAiBG,EAAU,ECVjE;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,8HACH,IAAK,QACN,CACF,CACH,EACM0B,GAAgB7B,EAAiB,iBAAkBG,EAAU,EClBnE;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,6BAA8B,IAAK,QAAQ,CAAE,EAC3D,CAAC,OAAQ,CAAE,EAAG,IAAK,EAAG,IAAK,MAAO,IAAK,OAAQ,KAAM,GAAI,IAAK,IAAK,QAAQ,CAAE,CAC/E,EACM2B,GAAM9B,EAAiB,MAAOG,EAAU,ECd9C;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,KAAM,EAAG,IAAK,MAAO,IAAK,OAAQ,KAAM,GAAI,IAAK,IAAK,QAAQ,CAAE,EAC9E,CAAC,OAAQ,CAAE,EAAG,IAAK,EAAG,IAAK,MAAO,IAAK,OAAQ,KAAM,GAAI,IAAK,IAAK,QAAQ,CAAE,CAC/E,EACM4B,GAAQ/B,EAAiB,QAASG,EAAU,ECblD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,wNACH,IAAK,QACN,CACF,CACH,EACM6B,GAAQhC,EAAiB,QAASG,EAAU,EClBlD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,qFACH,IAAK,QACN,CACF,CACH,EACM8B,GAAOjC,EAAiB,OAAQG,EAAU,EClBhD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,CAC3C,EACM+B,GAAOlC,EAAiB,OAAQG,EAAU,ECbhD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,qDAAsD,IAAK,QAAQ,CAAE,EACnF,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,sDAAuD,IAAK,QAAQ,CAAE,EACpF,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,CAC5C,EACMgC,GAAYnC,EAAiB,aAAcG,EAAU,ECf3D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,mBAAoB,IAAK,QAAQ,CAAE,EACjD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,CAC1D,EACMiC,GAASpC,EAAiB,SAAUG,EAAU,ECbpD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,0UACH,IAAK,QACN,CACF,EACD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,CAC1D,EACMkC,GAAWrC,EAAiB,WAAYG,EAAU,ECnBxD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,qKACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,CAC7C,EACMmC,GAActC,EAAiB,eAAgBG,EAAU,ECpB/D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,IAAK,SAAU,EACzD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,EACxD,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,KAAM,EAAG,IAAK,IAAK,SAAU,CAC1D,EACMoC,GAASvC,EAAiB,SAAUG,EAAU,ECdpD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,2CAA4C,IAAK,QAAQ,CAAE,EACzE,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,EAAG,yCAA0C,IAAK,QAAQ,CAAE,CACzE,EACMqC,GAASxC,EAAiB,UAAWG,EAAU,EChBrD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,cAAe,IAAK,QAAQ,CAAE,EAC5C,CAAC,OAAQ,CAAE,EAAG,yBAA0B,IAAK,OAAO,CAAE,CACxD,EACMsC,GAAezC,EAAiB,gBAAiBG,EAAU,ECbjE;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,YAAa,IAAK,QAAQ,CAAE,EAC1C,CAAC,OAAQ,CAAE,EAAG,yBAA0B,IAAK,QAAQ,CAAE,CACzD,EACMuC,GAAa1C,EAAiB,cAAeG,EAAU,ECb7D;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,2EACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,UAAW,IAAK,QAAQ,CAAE,EACxC,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,CAC7C,EACMwC,GAAgB3C,EAAiB,iBAAkBG,EAAU,ECpBnE;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,WAAY,IAAK,QAAQ,CAAE,EACzC,CAAC,OAAQ,CAAE,EAAG,gBAAiB,IAAK,QAAQ,CAAE,EAC9C,CAAC,OAAQ,CAAE,EAAG,4CAA6C,IAAK,QAAQ,CAAE,CAC5E,EACMyC,GAAS5C,EAAiB,SAAUG,EAAU,ECdpD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,4CAA6C,IAAK,QAAQ,CAAE,EAC1E,CAAC,SAAU,CAAE,GAAI,KAAM,GAAI,IAAK,EAAG,IAAK,IAAK,SAAU,CACzD,EACM0C,GAAO7C,EAAiB,OAAQG,EAAU,ECbhD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,4CAA6C,IAAK,QAAQ,CAAE,EAC1E,CAAC,OAAQ,CAAE,EAAG,8BAA+B,IAAK,QAAQ,CAAE,EAC5D,CAAC,OAAQ,CAAE,EAAG,6BAA8B,IAAK,QAAQ,CAAE,EAC3D,CAAC,SAAU,CAAE,GAAI,IAAK,GAAI,IAAK,EAAG,IAAK,IAAK,QAAS,CACvD,EACM2C,GAAQ9C,EAAiB,QAASG,EAAU,ECflD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,2KACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,EAAG,sBAAuB,IAAK,QAAQ,CAAE,EACpD,CAAC,OAAQ,CAAE,EAAG,oCAAqC,IAAK,QAAQ,CAAE,CACpE,EACM4C,GAAU/C,EAAiB,WAAYG,EAAU,ECpBvD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CACE,OACA,CACE,EAAG,2KACH,IAAK,QACN,CACF,EACD,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,IAAK,QAAQ,CAAE,EACjE,CAAC,OAAQ,CAAE,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,IAAK,QAAQ,CAAE,CACnE,EACM6C,GAAUhD,EAAiB,WAAYG,EAAU,ECpBvD;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAa,CACjB,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,EAC3C,CAAC,OAAQ,CAAE,EAAG,aAAc,IAAK,QAAQ,CAAE,CAC7C,EACM8C,GAAIjD,EAAiB,IAAKG,EAAU,ECA7B+C,GAAa,CACxB,OAAQ,CAAC,QAAQ,EACjB,gBAAkBvQ,GAAmB,CAAC,cAAe,OAAQA,CAAM,EACnE,kBAAoB4I,GAAsB,CAAC,cAAe,UAAWA,CAAS,EAC9E,aAAe5I,GAAmB,CAAC,WAAY,OAAQA,CAAM,CAC/D,EAGawQ,GAAiB,IACrBC,GAAwC,CAC7C,SAAUF,GAAW,OACrB,QAAS,IAAM7H,GAAW,YAAY,EACtC,MAAO,EACP,UAAW,IACX,qBAAsB,GACvB,EAqEUgI,GAAmB1Q,GAAoB,CAC5C,MAAA2Q,EAAkB3Q,GAAUD,KAElC,OAAO0Q,GAAiF,CACtF,SAAUF,GAAW,aAAaI,CAAe,EACjD,QAAS,IAAMjI,GAAW,gBAAgBiI,CAAe,EACzD,QAAS,EAAQA,EACjB,UAAW,IACX,qBAAsB,GACvB,CACH,ECnGaC,GAAsB,IAAM,CACjC,MAAE,SAAApH,GAAaD,KACf,CAAE,sBAAAsH,EAAuB,KAAAlK,CAAK,EAAIxB,GAAQ,EAG1C2L,EAAyB,KAEtBnK,GAAA,YAAAA,EAAM,KAAM5G,KAIf,CAAE,KAAMgR,EAAc,UAAWC,EAAiB,MAAOC,GAAgBT,KACzE,CAAE,KAAMU,EAAkB,UAAWC,GAAsBT,GAAgBI,GAAwB,EAEzGnO,YAAU,IAAM,CACd6G,EAAS,wBAAyB,QAAQ,GACzC,CAACA,CAAQ,CAAC,EAEb,MAAM4H,EAAe,CACnB,CACE,MAAO,mBACP,YAAa,oDACb,KAAM,UACN,KAAM,KACN,MAAO,UACP,SAAU,EACZ,EACA,CACE,MAAO,gBACP,YAAa,iDACb,KAAM,YACN,KAAM,KACN,MAAO,YACP,SAAU,EACZ,EACA,CACE,MAAO,iBACP,YAAa,wCACb,KAAM,eACN,KAAM,KACN,MAAO,SACP,SAAU,EACZ,EACA,CACE,MAAO,mBACP,YAAa,oDACb,KAAM,oBACN,KAAM,KACN,MAAO,UACP,SAAU,EACZ,EACA,CACE,MAAO,2BACP,YAAa,yFACb,KAAM,4BACN,KAAM,MACN,MAAO,SACP,SAAU,EACZ,GAGIC,EAAmB,CAACzE,EAAe0E,EAAoB,KAAU,CAC/D,MAAAC,EAAcD,EAChB,iIACA,mHAEJ,OAAQ1E,EAAO,CACb,IAAK,UACI,SAAG2E,CAAW,qCAAqC,CAACD,GAAY,+CAA+C,gDAAgD,CAACA,GAAY,yDAAyD,0BAC9O,IAAK,YACI,SAAGC,CAAW,yCAAyC,CAACD,GAAY,mDAAmD,oDAAoD,CAACA,GAAY,6DAA6D,4BAC9P,IAAK,SACI,SAAGC,CAAW,mCAAmC,CAACD,GAAY,6CAA6C,8CAA8C,CAACA,GAAY,uDAAuD,yBACtO,IAAK,UACI,SAAGC,CAAW,qCAAqC,CAACD,GAAY,+CAA+C,0CAA0C,CAACA,GAAY,mDAAmD,0BAClO,QACS,SAAGC,CAAW,+BAA+B,CAACD,GAAY,yCAAyC,0CAA0C,CAACA,GAAY,mDAAmD,sBACxN,GAIA,OAAAxL,EAAA,KAAC,MAAI,WAAU,YAEb,UAACA,OAAA,OAAI,UAAU,cACb,UAAC9C,EAAA,UAAG,UAAU,yEAAyE,SAEvF,6BACCA,EAAA,SAAE,UAAU,uEAAuE,SAEpF,uDACF,SAGC,MACC,WAACA,EAAA,UAAG,UAAU,iFAAiF,SAE/F,wBACC,MAAI,WAAU,uDACZ,SAAaoO,EAAA,IAAKI,GACbA,EAAO,SAEP1L,EAAA,KAAC,OAEC,UAAW,GAAGuL,EAAiBG,EAAO,MAAO,EAAI,CAAC,YAClD,aAAY,GAAGA,EAAO,KAAK,gBAE3B,UAAC1L,OAAA,OAAI,UAAU,cACb,UAAC9C,MAAA,OAAI,UAAU,gBAAgB,KAAK,MAAM,cAAY,OACnD,WAAO,IACV,GACCA,EAAA,UAAG,UAAU,mFACX,WAAO,MACV,EACCA,EAAA,SAAE,UAAU,kEACV,WAAO,YACV,GACF,QAEC,MAAI,WAAU,sFACb,SAAC8C,EAAA,YAAI,UAAU,cACb,UAAC9C,EAAA,WAAI,UAAU,oCAAoC,SAAE,OACpDA,EAAA,WAAI,UAAU,mCAAmC,SAAW,iBAC/D,CACF,KArBKwO,EAAO,MA2BhBxO,EAAA,IAACmI,GAAA,CAEC,GAAIqG,EAAO,KACX,UAAWH,EAAiBG,EAAO,MAAO,EAAK,EAC/C,aAAY,GAAGA,EAAO,KAAK,KAAKA,EAAO,WAAW,GAElD,SAAA1L,EAAA,KAAC,MAAI,WAAU,cACb,UAAC9C,MAAA,OAAI,UAAU,gBAAgB,KAAK,MAAM,cAAY,OACnD,WAAO,IACV,GACCA,EAAA,UAAG,UAAU,mFACX,WAAO,MACV,EACCA,EAAA,SAAE,UAAU,kEACV,WAAO,YACV,GACF,GAfKwO,EAAO,KAkBjB,EACH,GACF,EAGCX,KACE7N,EAAA,WAAI,UAAU,wJACb,SAAA8C,OAAC,MAAI,WAAU,oCACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,iFAAiF,SAE/F,eACCA,EAAA,SAAE,UAAU,0DAA0D,SAEvE,kCACF,EACAA,EAAA,IAACmI,GAAA,CACC,GAAG,WACH,UAAU,4LACX,wBAED,GACF,CACF,GAIFrF,OAAC,MAAI,WAAU,wJACb,UAAC9C,EAAA,UAAG,UAAU,iFAAiF,SAE/F,oBACCmO,EACCrL,EAAA,KAAC,MAAI,WAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,iBAAkB,GAChCA,EAAA,YAAK,UAAU,0DAA0D,SAE1E,8BACF,IACG,EAACkO,GAAA,MAAAA,EAAkB,WAAYA,EAAiB,SAAS,SAAW,EACvEpL,EAAA,KAAC,MAAI,WAAU,mBACb,UAAA9C,MAAC,OAAI,UAAU,gBAAgB,KAAK,MAAM,aAAW,UAAU,SAAE,OACjE8C,OAAC,IAAE,WAAU,0DAA0D,6BAErE9C,EAAA,IAACmI,GAAA,CACC,GAAG,UACH,UAAU,8DACX,wCAED,EAAO,oBACT,EACF,GAEArF,OAAC,MAAI,WAAU,YACZ,UAAiBoL,EAAA,SACf,KAAK,CAACO,EAAGC,IAAM,IAAI,KAAKA,EAAE,SAAS,EAAE,UAAY,IAAI,KAAKD,EAAE,SAAS,EAAE,SAAS,EAChF,MAAM,EAAG,CAAC,EACV,IAAKE,GACN,SAAA7L,SAAA,KAAC,OAEC,UAAU,+EAEV,UAACA,OAAA,OAAI,UAAU,8BACb,UAAC9C,MAAA,OAAI,UAAW,UAAU2O,EAAQ,QAAU,WAAW,GACpD,SAAQA,EAAA,QAAU,WACrB,GACC3O,EAAA,YAAK,UAAU,sDACb,SAAQ2O,EAAA,iBAAiBC,EAAAD,EAAQ,YAAR,YAAAC,EAAmB,MAAM,EAAG,KAAM,SAC9D,SACC,OAAK,WAAU,gDAAgD,MAAOD,EAAQ,UAC5E,SAAAA,EAAQ,UAAY,IAAI,KAAKA,EAAQ,SAAS,EAAE,iBAAmB,GACtE,GACF,EACA3O,EAAA,IAACmI,GAAA,CACC,GAAI,aAAawG,EAAQ,WAAa,EAAE,GACxC,UAAU,yFACV,MAAM,uBACN,aAAY,4BAA4BA,EAAQ,iBAAiBE,EAAAF,EAAQ,YAAR,YAAAE,EAAmB,MAAM,EAAG,KAAM,SAAS,GAE5G,SAAC7O,EAAA,IAAAwL,GAAA,CAAI,UAAU,UAAU,cAAY,OAAO,EAC9C,IArBKmD,EAAQ,WAuBhB,EACAT,EAAiB,SAAS,OAAS,GACjClO,MAAA,OAAI,UAAU,mBACb,SAAA8C,EAAA,KAACqF,GAAA,CACC,GAAG,YACH,UAAU,yDACX,sBACW+F,EAAiB,SAAS,OAAO,iBAE/C,GAEJ,GAEJ,EAGApL,OAAC,MAAI,WAAU,OACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,UAAG,UAAU,4EAA4E,SAE1F,kBACAA,EAAA,IAACmI,GAAA,CACC,GAAG,UACH,UAAU,mMACX,yBAED,GACF,EACC6F,EACClL,EAAA,KAAC,MAAI,WAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,iBAAkB,GAChCA,EAAA,YAAK,UAAU,0DAA0D,SAE1E,8BACF,GACEiO,EACDnL,EAAA,YAAI,UAAU,iEACb,UAAA9C,MAAC,OAAK,MAAK,MAAM,aAAW,QAAQ,SAAE,OACtCA,MAAC,QAAK,SAA0B,+BAClC,GAEA8C,OAAC,MAAI,WAAU,qEACb,UAAA9C,MAAC,OAAK,MAAK,MAAM,aAAW,UAAU,SAAC,MACvCA,MAAC,QAAK,SAAuB,6BAC5B+N,GAAA,YAAAA,EAAc,SACZjL,OAAA,QAAK,UAAU,kDAAkD,cAC9D,OAAO,KAAKiL,EAAa,MAAM,EAAE,OAAO,sBAC5C,GAEJ,GAEJ,CACF,GAEJ,ECtRO,MAAMe,EAAe,CAK1B,aAAc,CAJNtK,EAAA,cAAwB,MACxBA,EAAA,gBAAW,IACXA,EAAA,sBAAuC,MAGxC,YAAS,IAAIuK,EACpB,CAEA,MAAc,YAA4B,CACxC,GAAI,MAAK,SAET,OAAI,KAAK,eACA,KAAK,gBAGT,oBAAiB,KAAK,eACpB,KAAK,eACd,CAEA,MAAc,cAA8B,CACtC,IAAC,KAAK,OACF,MAAA7Q,GACJ,oBACA,+BAIA,IAEF,MAAM8Q,EAAU,iDAEV,WAAK,OAAO,KAAK,CACrB,QAAS,MAAMC,GAAU,GAAGD,CAAO,kBAAmB,iBAAiB,EACvE,QAAS,MAAMC,GAAU,GAAGD,CAAO,oBAAqB,kBAAkB,EAC3E,EAED,KAAK,SAAW,SACTzQ,EAAO,CACd,WAAK,eAAiB,KAChBL,GACJ,oBACA,8EACA,CAAE,cAAeK,CAAM,EAE3B,CACF,CAEA,MAAM,aACJ2Q,EACA1S,EAAkC,CAChC,aAAc,MACd,WAAY,MACZ,SAAU,GAEZ2S,EACe,CACX,IAUE,GARSA,GAAA,MAAAA,EAAA,CACX,MAAO,UACP,SAAU,EACV,QAAS,+BAGX,MAAM,KAAK,aAEP,CAAC,KAAK,OACF,MAAAjR,GAAe,oBAAqB,4BAA4B,EAIxE,KAAK,OAAO,GAAG,WAAY,CAAC,CAAE,SAAAkR,KAAe,CAC9BD,GAAA,MAAAA,EAAA,CACX,MAAO,aACP,SAAU,KAAK,MAAMC,EAAW,GAAG,EACnC,QAAS,uBAAuB,KAAK,MAAMA,EAAW,GAAG,CAAC,KAC3D,CACF,EAEYD,GAAA,MAAAA,EAAA,CACX,MAAO,aACP,SAAU,EACV,QAAS,4BAIX,MAAME,EAAY,SAAW,KAAK,iBAAiBH,EAAK,IAAI,EAC5D,MAAM,KAAK,OAAO,UAAUG,EAAW,MAAMC,GAAUJ,CAAI,CAAC,EAGtD,MAAAK,EAAa,UAAU/S,EAAQ,YAAY,GAC3CgT,EAAU,CACd,KAAMH,EACN,MAAO7S,EAAQ,SAAS,SAAS,EACjC,MAAOA,EAAQ,WAAW,SAAS,EACnC,KAAMA,EAAQ,aACd+S,CAAA,EAII,WAAK,OAAO,KAAKC,CAAO,EAG9B,MAAMC,EAAa,MAAM,KAAK,OAAO,SAASF,CAAU,EAClDG,EAAa,IAAI,KAAK,CAACD,CAAoC,EAAG,CAAE,KAAM,SAASjT,EAAQ,YAAY,EAAI,GAGvGmT,EAAgB,IAAI,KACxB,CAACD,CAAU,EACX,GAAG,KAAK,4BAA4BR,EAAK,IAAI,CAAC,IAAI1S,EAAQ,YAAY,GACtE,CAAE,KAAM,SAASA,EAAQ,YAAY,EAAG,GAIpC,kBAAK,OAAO,WAAW6S,CAAS,EAChC,WAAK,OAAO,WAAWE,CAAU,EAE1BJ,GAAA,MAAAA,EAAA,CACX,MAAO,YACP,SAAU,IACV,QAAS,+BAGJQ,QAEApR,EAAO,CACR,MAAAL,GACJ,yBACA,kEACA,CACE,cAAeK,EACf,SAAU2Q,EAAK,KACf,SAAUA,EAAK,KACf,SAAUA,EAAK,IACjB,EAEJ,CACF,CAEQ,iBAAiBU,EAA0B,CAC3C,MAAAC,EAAUD,EAAS,YAAY,GAAG,EACjC,OAAAC,IAAY,GAAKD,EAAS,MAAMC,EAAU,CAAC,EAAE,YAAgB,IACtE,CAEQ,4BAA4BD,EAA0B,CACtD,MAAAC,EAAUD,EAAS,YAAY,GAAG,EACxC,OAAOC,IAAY,GAAKD,EAAS,MAAM,EAAGC,CAAO,EAAID,CACvD,CAEA,MAAM,kBAAkBV,EAA8B,CAChD,IACF,MAAM,KAAK,aAGL,MAAAY,EAAmB,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,OAAQ,KAAK,EACpEC,EAAY,KAAK,iBAAiBb,EAAK,IAAI,EAE1C,OAAAY,EAAiB,SAASC,CAAS,OACpC,CACC,QACT,CACF,CAEA,SAAgB,CACV,KAAK,SACP,KAAK,OAAO,YACZ,KAAK,OAAS,MAEhB,KAAK,SAAW,GAChB,KAAK,eAAiB,IACxB,CACF,CAGA,IAAIC,GAAgD,KAE7C,MAAMC,GAAoB,KAC1BD,KACHA,GAAyB,IAAIlB,IAExBkB,IAiCIE,GAAoB,MAC/BhB,EACAC,IACkB,CAGZ,MAAAQ,EAAgB,MAFJM,KAEoB,aACpCf,EACA,CACE,aAAc,MACd,WAAY,MACZ,SAAU,CACZ,EACAC,EAAcC,GAAaD,EAAWC,EAAS,QAAQ,EAAI,QAItD,WAAI,KAAK,CAACO,CAAa,EAAG,CAAE,KAAM,YAAa,CACxD,ECrOO,MAAMQ,EAAiB,CAI5B,YAAYC,EAAiB,CAHrB5L,EAAA,uBAA0C,MAC1CA,EAAA,eAKF,GAFC,YAAS4L,GAAUzT,GAAO,MAAM,WAEjC,CAAC,KAAK,OACF,MAAAuB,GACJ,qBACA,4CAGN,CAEQ,oBAAsC,CACxC,IAAC,KAAK,gBACJ,IACF,MAAMmS,EAAoB,IAAIC,GAAkB,KAAK,MAAM,EAC3D,KAAK,gBAAkBD,EAAkB,mBAAmB1T,GAAO,MAAM,aAAa,QAC/E4B,EAAO,CACR,MAAAL,GACJ,qBACA,iDACA,CAAE,cAAeK,CAAM,EAE3B,CAGF,OAAO,KAAK,eACd,CAEA,MAAM,WACJ2Q,EACAqB,EACApB,EACAnS,EACuB,CACnB,IACWmS,GAAA,MAAAA,EAAA,CACX,SAAU,EACV,MAAO,YACP,QAAS,wBAGL,MAAAqB,EAAkB,KAAK,qBAEzB,IAAAC,EACJ,GAAIzT,EAAQ,CACV,MAAM2Q,EAAkB3Q,EACxB,GAAIuT,EAESE,EAAA,SAAS9C,CAAe,UAAU4C,CAAQ,OAChD,CAEC,MAAAG,MAAgB,KAAK,EAAE,cAAc,QAAQ,QAAS,GAAG,EACzDC,EAAW,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,EAAG,CAAC,EACpDZ,EAAYb,EAAK,KAAK,MAAM,GAAG,EAAE,IAAS,SAChDuB,EAAW,SAAS9C,CAAe,UAAU+C,CAAS,IAAIC,CAAQ,IAAIZ,CAAS,EACjF,OAGAU,EAAWF,GAAY,KAAK,iBAAiBrB,EAAK,IAAI,EAElD,MAAA0B,EAAkBJ,EAAgB,mBAAmBC,CAAQ,EAGtDtB,GAAA,MAAAA,EAAA,CACX,SAAU,GACV,MAAO,YACP,QAAS,uBAGL,MAAAyB,EAAgB,WAAW1B,EAAM,CACrC,gBAAiB,CACf,gBAAiBA,EAAK,IACxB,EACA,WAAa2B,GAAmB,CAC9B,MAAMC,EAAkBD,EAAe,aAAe3B,EAAK,KACvD,KAAK,MAAO2B,EAAe,YAAc3B,EAAK,KAAQ,EAAE,EAAI,GAC5D,GAESC,GAAA,MAAAA,EAAA,CACX,SAAU2B,EACV,MAAO,YACP,QAAS,gBAAgBA,CAAe,KAE5C,EACD,EAGD,MAAMC,EAAUH,EAAgB,IAEnB,OAAAzB,GAAA,MAAAA,EAAA,CACX,SAAU,IACV,MAAO,YACP,QAAS,qBAGJ,CACL,IAAK4B,EACL,SAAUN,EACV,KAAMvB,EAAK,YAGN3Q,EAAO,CACR,MAAAL,GACJ,eACA,8CACA,CACE,cAAeK,EACf,SAAU2Q,EAAK,KACf,SAAUA,EAAK,IACjB,EAEJ,CACF,CAEQ,iBAAiB8B,EAA0BhU,EAAyB,CAEpE,MAAA2Q,EAAkB3Q,GAAUD,KAE5B2T,MAAgB,KAAK,EAAE,cAAc,QAAQ,QAAS,GAAG,EACzDC,EAAW,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,EAAG,CAAC,EACpDZ,EAAYiB,EAAiB,MAAM,GAAG,EAAE,IAAS,SAGvD,MAAO,SAASrD,CAAe,UAAU+C,CAAS,IAAIC,CAAQ,IAAIZ,CAAS,EAC7E,CAEA,MAAM,gBAAiE,CACjE,IAIF,aAHwB,KAAK,qBAGP,gBAEf,CACL,QAAS,GACT,QAAS,iDAEG,CACP,OACL,QAAS,GACT,QAAS,oFAEb,CACF,CAEA,MAAM,WAAWQ,EAAiC,CAC5C,IAIF,MAHwB,KAAK,qBACW,mBAAmBA,CAAQ,EAE7C,uBACfhS,EAAO,CACR,MAAAL,GACJ,eACA,gDACA,CAAE,cAAeK,EAAO,SAAAgS,CAAS,EAErC,CACF,CAKA,MAAM,cAAcvT,EAAoC,CAClD,IACI,MAAA2Q,EAAkB3Q,GAAUD,KAC5ByT,EAAkB,KAAK,qBACvBS,EAAa,SAAStD,CAAe,IAErCuD,EAAkB,GACxB,gBAAiBC,KAAQX,EAAgB,cAAc,CAAE,OAAQS,CAAA,CAAY,EACrEC,EAAA,KAAKC,EAAK,IAAI,EAGf,OAAAD,QACA3S,EAAO,CACR,MAAAL,GACJ,aACA,oDACA,CAAE,cAAeK,EAAO,OAAAvB,CAAO,EAEnC,CACF,CAKA,MAAM,eAAeA,EAAkC,CACjD,IACI,MAAA2Q,EAAkB3Q,GAAUD,KAC5BqU,EAAY,MAAM,KAAK,cAAczD,CAAe,EAE1D,IAAI0D,EAAe,EACnB,UAAWd,KAAYa,EACf,WAAK,WAAWb,CAAQ,EAC9Bc,IAGK,OAAAA,QACA9S,EAAO,CACR,MAAAL,GACJ,yBACA,qDACA,CAAE,cAAeK,EAAO,OAAAvB,CAAO,EAEnC,CACF,CAKA,MAAM,oBAAoBA,EAAyE,CAC7F,IACI,MAAA2Q,EAAkB3Q,GAAUD,KAC5ByT,EAAkB,KAAK,qBACvBS,EAAa,SAAStD,CAAe,IAE3C,IAAI2D,EAAY,EACZC,EAAiB,EAErB,gBAAiBJ,KAAQX,EAAgB,cAAc,CAAE,OAAQS,CAAA,CAAY,EAC3EK,IACkBC,GAAAJ,EAAK,WAAW,eAAiB,EAG9C,OAAE,UAAAG,EAAW,eAAAC,SACbhT,EAAO,CACR,MAAAL,GACJ,sBACA,2DACA,CAAE,cAAeK,EAAO,OAAAvB,CAAO,EAEnC,CACF,CACF,CAGA,IAAIwU,GAA+C,KAEtC,MAAAC,GAAkBrB,KACzB,CAACoB,IAAwBpB,GAAUA,IAAWoB,GAAoB,UAC9CA,GAAA,IAAIrB,GAAiBC,CAAM,GAE5CoB,IASIE,GAAoB,MAC/BxC,EACAqB,EACApB,EACAnS,IACoB,CACpB,MAAM2U,EAAcF,KAGdG,EAAe1C,aAAgB,KAAOA,EAAO,IAAI,KAAK,CAACA,CAAI,EAAGqB,EAAU,CAAE,KAAMrB,EAAK,IAAM,GASjG,OAPe,MAAMyC,EAAY,WAC/BC,EACArB,EACApB,EAAcC,GAAaD,EAAWC,EAAS,QAAQ,EAAI,OAC3DpS,CAAA,GAGY,GAChB,EC9Ra6U,GAAmB,IAAM,CAC9B,MAAAC,EAAkBC,SAA8B,IAAI,EAKpDvT,EAAyBiI,cAAarI,GAAoB,CAE1D,IAAC0T,EAAgB,QAAS,CACtB,MAAAE,EAAa,SAAS,cAAc,KAAK,EACpCA,EAAA,aAAa,YAAa,QAAQ,EAClCA,EAAA,aAAa,cAAe,MAAM,EAC7CA,EAAW,MAAM,SAAW,WAC5BA,EAAW,MAAM,KAAO,WACxBA,EAAW,MAAM,MAAQ,MACzBA,EAAW,MAAM,OAAS,MAC1BA,EAAW,MAAM,SAAW,SACnB,cAAK,YAAYA,CAAU,EACpCF,EAAgB,QAAUE,CAC5B,CAGAF,EAAgB,QAAQ,YAAc,GACtC,WAAW,IAAM,CACXA,EAAgB,UAClBA,EAAgB,QAAQ,YAAc1T,IAEvC,GAAG,CACR,EAAG,CAAE,GAKC6T,EAAkB,CAItB,UAAYrT,GAAsB,CAC1B,MAAAE,EAAU,SAAS,eAAeF,CAAS,EAC7CE,GACFA,EAAQ,MAAM,CAElB,EAKA,sBAAwBoT,GAA2B,CAK3C,MAAAC,EAJoBD,EAAU,iBAClC,4EAGqC,CAAC,EACpCC,GACFA,EAAa,MAAM,CAEvB,EAKA,UAAYD,GAA2B,CACrC,MAAME,EAAoBF,EAAU,iBAClC,4EAGIC,EAAeC,EAAkB,CAAC,EAClCC,EAAcD,EAAkBA,EAAkB,OAAS,CAAC,EAE5DE,EAAgBxS,GAAqB,CACrCA,EAAE,MAAQ,QAEVA,EAAE,SACA,SAAS,gBAAkBqS,IAC7BE,EAAY,MAAM,EAClBvS,EAAE,eAAe,GAGf,SAAS,gBAAkBuS,IAC7BF,EAAa,MAAM,EACnBrS,EAAE,eAAe,GAErB,EAGQ,OAAAoS,EAAA,iBAAiB,UAAWI,CAAY,EAG3C,IAAM,CACDJ,EAAA,oBAAoB,UAAWI,CAAY,EAEzD,GAMIC,EAAqB,CAIzB,sBAAuB,CACrBvL,EACAwL,EACAC,EACAC,IACG,OACH,IAAIC,EAAWF,EAEf,OAAQzL,EAAM,IAAK,CACjB,IAAK,YACHA,EAAM,eAAe,EACrB2L,EAAWF,EAAeD,EAAM,OAAS,EAAIC,EAAe,EAAI,EAChE,MACF,IAAK,UACHzL,EAAM,eAAe,EACrB2L,EAAWF,EAAe,EAAIA,EAAe,EAAID,EAAM,OAAS,EAChE,MACF,IAAK,OACHxL,EAAM,eAAe,EACV2L,EAAA,EACX,MACF,IAAK,MACH3L,EAAM,eAAe,EACrB2L,EAAWH,EAAM,OAAS,EAC1B,MACF,QACE,MACJ,CAEAE,EAAcC,CAAQ,GAChB/D,EAAA4D,EAAAG,CAAQ,IAAR,MAAA/D,EAAW,OACnB,EAKA,aAAc,CAAC5H,EAA4B4L,IAAyB,CAC9D5L,EAAM,MAAQ,WAChBA,EAAM,eAAe,EACZ4L,IAEb,GAMIC,EAAapM,cAAY,CAACqM,EAAiB,YACxC,GAAGA,CAAM,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CAAC,GAC1D,CAAE,GAKCC,EAAuBtM,cAAY,IAChC,OAAO,WAAW,kCAAkC,EAAE,QAC5D,CAAE,GAKCuM,EAA0BvM,EAAA,YAAY,CAC1CwM,EACA7S,EACA8S,IACG,CACH,MAAMC,EAAqC,GAE3C,OAAKF,IACHE,EAAW,cAAc,EAAI,OACzB/S,GAAgB8S,IAClBC,EAAW,kBAAkB,EAAID,IAI9BC,CACT,EAAG,CAAE,GAEE,OACL,uBAAA3U,EACA,gBAAAyT,EACA,mBAAAM,EACA,WAAAM,EACA,qBAAAE,EACA,wBAAAC,CAAA,CAEJ,ECpHMI,GAA0B,IAAM,sCAE9B,MAAE,KAAAzP,GAASxB,KACXe,EAAWC,KAEX,CAACkQ,EAAYC,CAAa,EAAI/T,EAAA,SAAsB,CAAE,GACtD,CAAC/B,EAAa+V,CAAc,EAAIhU,WAAS,IAAMjC,IAAyB,EACxE,CAACkW,EAAoBC,CAAqB,EAAIlU,EAAA,SAA6B,CAAE,GAC7E,CAACmU,EAASC,CAAU,EAAIpU,EAAA,SAAsB,CAAE,GAChD,CAACqU,EAAYC,CAAa,EAAItU,EAAA,SAA8B,CAAE,GAC9D,CAACuU,EAAcC,CAAe,EAAIxU,WAAS,EAAK,EAGhD,CAACyU,EAAWC,CAAY,EAAI1U,WAA2B,IAAI,EAC3D,CAAC6P,EAAU8E,CAAW,EAAI3U,WAAyB,CACvD,MAAO,OACP,SAAU,EACV,QAAS,GACV,EACK,CAAC6G,EAAQ+N,CAAS,EAAI5U,WAAgC,IAAI,EAC1D,CAAC6U,EAAWC,CAAY,EAAI9U,WAAS,EAAK,EAC1C,CAAC+U,EAAaC,CAAc,EAAIhV,WAAS,CAAC,EAC1C,CAACiV,EAAeC,CAAgB,EAAIlV,WAAwB,IAAI,EAGhEmV,EAAgBxR,EAAS,MAEzB,CAACyR,EAAcC,CAAe,EAAIrV,WAAS,CAC/C,OAAQ,GACR,MAAKsP,IAAAD,GAAA8F,GAAA,YAAAA,EAAe,eAAf,YAAA9F,GAA6B,MAA7B,YAAAC,GAAkC,aAAc,GACrD,SAAQgG,GAAAH,GAAA,YAAAA,EAAe,eAAf,YAAAG,GAA6B,SAAU,GAC/C,OAAMC,GAAAJ,GAAA,YAAAA,EAAe,eAAf,YAAAI,GAA6B,OAAQ,GAC3C,YAAWC,GAAAL,GAAA,YAAAA,EAAe,eAAf,YAAAK,GAA6B,YAAa,GACrD,WAAUC,IAAAC,GAAAP,GAAA,YAAAA,EAAe,eAAf,YAAAO,GAA6B,WAA7B,YAAAD,GAAuC,aAAc,GAC/D,SAAQE,IAAAC,GAAAT,GAAA,YAAAA,EAAe,eAAf,YAAAS,GAA6B,SAA7B,YAAAD,GAAqC,aAAc,GAC3D,UAASE,GAAAV,GAAA,YAAAA,EAAe,eAAf,YAAAU,GAA6B,UAAW,GACjD,eAAcC,GAAAX,GAAA,YAAAA,EAAe,eAAf,YAAAW,GAA6B,eAAgB,GAC5D,EACK,CAAC9W,EAAO+W,CAAQ,EAAI/V,WAAwB,IAAI,EAChD,CAACgW,EAAQC,CAAS,EAAIjW,EAAA,SAMxB,CAAE,GAGA,CAACkW,EAAkBC,EAAmB,EAAInW,EAAA,SAK7C,CAAE,GAEC,CAACoW,GAAqBC,CAAsB,EAAIrW,WAAS,EAAK,EAKpEI,YAAU,IAAM,CACV,IAACgV,EAAa,OAAQ,CACxB,MAAMkB,EAAY,QAAQ,KAAK,KAAK,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CAAC,GAC/EjB,MAAyB,CAAE,GAAGkB,EAAM,OAAQD,CAAY,GAC1D,GACC,CAAClB,EAAa,MAAM,CAAC,EAGlB,MAAA7G,EAAyBrH,cAAY,KAElC9C,GAAA,YAAAA,EAAM,KAAM5G,KAClB,CAAC4G,GAAA,YAAAA,EAAM,EAAE,CAAC,EAEPoS,EAAWhE,SAAyB,IAAI,EACxCiE,EAAejE,SAAyB,IAAI,EAC5C,CAAE,uBAAAvT,GAA2BqT,KAG7BoE,EAAWxP,EAAA,YAAY,CAACyP,EAAgDC,EAAe/X,IAAoB,CAC/G,MAAMgY,EAAK,KAAK,IAAI,EAAE,SAAa,OAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EACnEC,EAAW,CACf,GAAAD,EACA,KAAAF,EACA,MAAAC,EACA,QAAA/X,EACA,UAAW,KAAK,IAAI,GAEtBoX,EAAkBM,GAAA,CAAC,GAAGA,EAAMO,CAAQ,CAAC,EAIrC,WAAW,IAAM,CACfb,KAAkBM,EAAK,WAAgBQ,GAAM,KAAOF,CAAE,CAAC,GAFxCF,IAAS,QAAU,IAAO,GAGhC,CACb,EAAG,CAAE,GAECK,GAAc9P,cAAa2P,GAAe,CAC9CZ,KAAkBM,EAAK,UAAgBQ,EAAM,KAAOF,CAAE,CAAC,CACzD,EAAG,CAAE,GAGLzW,YAAU,IAAM,CACd,GAAI+U,IAEFuB,EAAS,OAAQ,0BACf,wCAAwCvB,EAAc,kBAAoBA,EAAc,kBAAkB,MAAM,EAAG,CAAC,EAAI,MAAQ,EAAE,kEAGhIA,EAAc,UAAYA,EAAc,eAAe,CAEzD,MAAM8B,EAAW,CACf,KAAM9B,EAAc,cACpB,KAAM,EACN,KAAM,YACN,aAAc,KAAK,IAAI,EACvB,OAAQ,IAAM,IAAI,eAClB,YAAa,IAAM,QAAQ,QAAQ,IAAI,YAAY,CAAC,CAAC,EACrD,KAAM,IAAM,QAAQ,QAAQ,EAAE,EAC9B,MAAO,IAAM,IAAI,IAAK,EAGlB+B,EAA8B,CAClC,GAAI,aAAa,KAAK,IAAK,IAC3B,KAAMD,EACN,IAAK9B,EAAc,SACnB,SAAU,QAGRlX,EACY8V,EAAA,CAACmD,CAAgB,CAAC,EAEhCxC,EAAawC,CAAgB,CAEjC,CAED,GAAC/B,EAAeuB,EAAUzY,CAAW,CAAC,EAEnC,MAAAkZ,GAAajQ,cAAY,IAAM,CACnC6M,EAAc,CAAE,GAChBW,EAAa,IAAI,EACjBC,EAAY,CAAE,MAAO,OAAQ,SAAU,EAAG,QAAS,GAAI,EACvDC,EAAU,IAAI,EACdR,EAAW,CAAE,GACbF,EAAsB,CAAE,GACxB6B,EAAS,IAAI,EACbjB,EAAa,EAAK,EAClBE,EAAe,CAAC,EAChBE,EAAiB,IAAI,EACrBV,EAAgB,EAAK,CACvB,EAAG,CAAE,GAEC4C,GAAiB,IACd,KAAK,MAAM,WAAa,KAAK,SAAS,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,EAGjEC,GAAenQ,cAAayI,GAAe,CAC/C,MAAMkH,EAAKO,KACLxR,EAAM,IAAI,gBAAgB+J,CAAI,EAC9B8E,EAAuB,CAAE,GAAAoC,EAAI,KAAAlH,EAAM,IAAA/J,CAAI,EAEzC3H,GACF8V,EAAsBwC,GAAA,CAAC,GAAGA,EAAM9B,CAAS,CAAC,EAC5BH,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAACM,CAAE,EAAG,OAAU,IAClD3C,EAA+BqC,IAAA,CAAE,GAAGA,EAAM,CAACM,CAAE,EAAG,CAAE,MAAO,OAAQ,SAAU,EAAG,QAAS,qBAAuB,GAE9GnC,EAAaD,CAAS,EAGDxV,EAAA,wBAAwB0Q,EAAK,IAAI,EAAE,EAGpD,MAAA2H,EAAQ,IAAI,MAAM1R,CAAG,EACrB0R,EAAA,iBAAiB,iBAAkB,IAAM,CACzCrZ,EACF8V,KAAsBwC,EAAK,IAAIgB,GAC7BA,EAAG,KAAOV,EAAK,CAAE,GAAGU,EAAI,SAAUD,EAAM,UAAaC,CAAA,CACtD,EAEY7C,EAAA6B,GAAQA,EAAO,CAAE,GAAGA,EAAM,SAAUe,EAAM,UAAa,IAAI,CAC1E,CACD,GACA,CAACrZ,EAAagB,CAAsB,CAAC,EAElCuY,GAAkBtQ,cAAauQ,GAAmB,CAClDxZ,IACF8V,EAAsBwC,GAAA,CACpB,MAAMmB,EAAenB,EAAK,KAAUoB,KAAE,KAAOF,CAAM,EACnD,OAAIC,GACE,oBAAgBA,EAAa,GAAG,EAE/BnB,EAAK,OAAYoB,KAAE,KAAOF,CAAM,EACxC,EAEDvD,EAA8BqC,GAAA,CAC5B,KAAM,CAAE,CAACkB,CAAM,EAAGG,EAAS,GAAGnN,GAAS8L,EAChC,OAAA9L,CAAA,CACR,EACD2J,EAAmBmC,GAAA,CACjB,KAAM,CAAE,CAACkB,CAAM,EAAGG,EAAS,GAAGnN,GAAS8L,EAChC,OAAA9L,CAAA,CACR,EACD6J,EAAsBiC,GAAA,CACpB,KAAM,CAAE,CAACkB,CAAM,EAAGG,EAAS,GAAGnN,GAAS8L,EAChC,OAAA9L,CAAA,CACR,EACH,EACC,CAACxM,CAAW,CAAC,EAEV4Z,GAAmB3Q,cAAaO,GAA+C,CAC7E,MAAAqQ,EAAQrQ,EAAM,OAAO,MACvB,CAACqQ,GAASA,EAAM,SAAW,GAG/B,MAAM,KAAKA,CAAK,EAAE,QAAgBnI,GAAA,CAEhC,MAAMoI,EAAqB,CACzB,YAAa,aAAc,cAC3B,YAAa,aAAc,YAC3B,YAAa,cAAe,kBAC5B,YAAa,cACb,aAAc,gBAGV/G,EAAWrB,EAAK,KAAK,YAAY,EAEjCqI,EADsB,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAO,EACtB,SAAYhH,EAAS,SAASiH,EAAG,CAAC,EAI5E,IAHqBF,EAAmB,SAASpI,EAAK,IAAI,GAGrC,CAACqI,EAAmB,CAClCjC,EAAA,6BAA6BpG,EAAK,IAAI,qEAAqE,EACpH+G,EAAS,QAAS,mBAAoB,GAAG/G,EAAK,IAAI,uCAAuC,EAClE1Q,EAAA,+CAA+C0Q,EAAK,IAAI,EAAE,EACjF,MACF,CAGM,MAAAuI,GAAU,GAAK,KAAO,KACxB,GAAAvI,EAAK,KAAOuI,GAAS,CACdnC,EAAA,QAAQpG,EAAK,IAAI,iDAAiD,EAC3E+G,EAAS,QAAS,iBAAkB,GAAG/G,EAAK,IAAI,8BAA8B,EACvD1Q,EAAA,eAAe0Q,EAAK,IAAI,eAAe,EAC9D,MACF,CAEA0H,GAAa1H,CAAI,EACjBoG,EAAS,IAAI,EACd,CACA,GAAC9W,EAAwBoY,GAAcX,CAAQ,CAAC,EAE7CyB,GAAiBjR,cAAa3G,GAAuB,CACzDA,EAAE,eAAe,CACnB,EAAG,CAAE,GAEC6X,GAAalR,cAAa3G,GAAuB,CACrDA,EAAE,eAAe,EACX,MAAAuX,EAAQvX,EAAE,aAAa,MACzBuX,EAAM,OAAS,GAEjBD,GADkB,CAAE,OAAQ,CAAE,MAAAC,CAAQ,EACZ,CAC5B,EACC,CAACD,EAAgB,CAAC,EAEfQ,GAAanR,cAAY,IAAM,CACnC8M,EAAuBuC,GAAA,CACrB,MAAM+B,EAAU,CAAC/B,EAEjB,OAAAvY,GAAwBsa,CAAO,EAEpBnB,KACJmB,CAAA,CACR,GACA,CAACnB,EAAU,CAAC,EAEToB,GAAkBrR,cAAY,IAAM,CACnCsP,EAAS,UAEV3B,GACF2B,EAAS,QAAQ,QACjB1B,EAAa,EAAK,EAClB7V,EAAuB,cAAc,IAErCuX,EAAS,QAAQ,OACjB1B,EAAa,EAAI,EACjB7V,EAAuB,eAAe,GACxC,EACC,CAAC4V,EAAW5V,CAAsB,CAAC,EAEhCuZ,GAAmBtR,cAAY,IAAM,CACrCsP,EAAS,SACIxB,EAAAwB,EAAS,QAAQ,WAAW,CAE/C,EAAG,CAAE,GAECiC,GAAavR,cAAawR,GAA4B,CAC1D,MAAMC,EAAO,KAAK,MAAMD,EAAU,EAAE,EAC9BE,EAAO,KAAK,MAAMF,EAAU,EAAE,EAC7B,SAAGC,CAAI,IAAIC,EAAK,WAAW,SAAS,EAAG,GAAG,CAAC,EACpD,EAAG,CAAE,GAECC,GAAmB3R,cAAY,IAAM,CACzC,MAAM4R,EAAmB,GAGzB,GAAI1D,EAAa,IAAK,CACd,MAAA2D,EAAM,SAAS3D,EAAa,GAAG,GACjC,MAAM2D,CAAG,GAAKA,EAAM,IAAMA,EAAM,MAClCD,EAAO,KAAK,gCAAgC,CAEhD,CAmCA,GAhCI1D,EAAa,SACM,CAAC,OAAQ,SAAU,aAAc,qBAAsB,mBAAoB,QAAS,QAAQ,EAC/F,SAASA,EAAa,MAAM,GAC5C0D,EAAO,KAAK,2GAA2G,GAKvH1D,EAAa,OACI,CAAC,QAAS,4BAA6B,QAAS,oCAAqC,sCAAuC,oBAAqB,QAAS,mBAAmB,EAChL,SAASA,EAAa,IAAI,GACxC0D,EAAO,KAAK,qLAAqL,GAKjM1D,EAAa,YACU,CAAC,sCAAuC,yCAAyC,EACpF,SAASA,EAAa,SAAS,GACnD0D,EAAO,KAAK,2GAA2G,GAKvH1D,EAAa,UACM,sBACH,KAAKA,EAAa,OAAO,GACzC0D,EAAO,KAAK,qEAAqE,GAKjF1D,EAAa,OAAQ,CACjB,MAAA4D,EAAS,SAAS5D,EAAa,MAAM,GACvC,MAAM4D,CAAM,GAAKA,EAAS,IAAMA,EAAS,MAC3CF,EAAO,KAAK,iDAAiD,CAEjE,CAEO,OAAAA,CAAA,EACN,CAAC1D,CAAY,CAAC,EAGX6D,GAAc/R,cAAa1G,GAAsC,CACrE,GAAI,CAACA,EAAc,OACb,MAAAuY,EAAM,SAASvY,CAAK,EAC1B,GAAI,MAAMuY,CAAG,GAAKA,EAAM,IAAMA,EAAM,IAC3B,sCAGX,EAAG,CAAE,GAECG,GAAiBhS,cAAa1G,GAAsC,CACxE,GAAI,CAACA,EAAc,OACb,MAAAwY,EAAS,SAASxY,CAAK,EAC7B,GAAI,MAAMwY,CAAM,GAAKA,EAAS,IAAMA,EAAS,IACpC,uDAGX,EAAG,CAAE,GAECG,GAAkBjS,cAAa1G,GAAsC,CACzE,GAAI,CAACA,EAAc,OAEnB,GAAI,CADiB,sBACH,KAAKA,CAAK,EACnB,2EAGX,EAAG,CAAE,GAEC4Y,GAAuBlS,cAAa1G,GAAsC,CAC9E,GAAKA,GACDA,EAAM,OAAS,IACV,oDAGX,EAAG,CAAE,GAGC6Y,GAAwBnS,cAAY,CAACoS,EAAe9Y,IAAkB,CACtExB,MAEJ,OAAQsa,EAAO,CACb,IAAK,MACHta,EAAQia,GAAYzY,CAAK,EACzB,MACF,IAAK,SACHxB,EAAQka,GAAe1Y,CAAK,EAC5B,MACF,IAAK,UACHxB,EAAQma,GAAgB3Y,CAAK,EAC7B,MACF,IAAK,eACHxB,EAAQoa,GAAqB5Y,CAAK,EAClC,MACF,QACE,MACJ,CAEA2V,GAA4BI,GAAA,CAC1B,MAAMgD,EAAY,CAChB,GAAGhD,EACH,CAAC+C,CAAK,EAAGta,CAAA,EAQX,OAJqB,OAAO,OAAOua,CAAS,EAAE,KAAKC,GAAOA,IAAQ,MAAS,EAMhExa,IAAU,QAEnB+W,EAAsB0D,GAChBA,GAAaA,EAAU,YAAc,WAAS,YAAY,EACrD,KAEFA,CACR,EARD1D,EAAS,IAAI,EAWRwD,CAAA,CACR,GACA,CAACN,GAAaC,GAAgBC,GAAiBC,EAAoB,CAAC,EAEjEM,GAA0BxS,cAAY,SAAY,CACtD,GAAKkO,EAAa,aAAa,OAI/B,CAAAiB,EAAuB,EAAI,EACvB,IACF,MAAM7Q,EAAW,MAAMW,GAAW,eAAeiP,EAAa,YAAY,EAG1EC,EAAyBkB,IAAA,CACvB,GAAGA,EACH,aAAc/Q,EAAS,aACvB,IAGOkR,EAAA,UAAW,oBAAqB,6CAA6C,QAE/E1X,EAAO,CACN,cAAM,6BAA8BA,CAAK,EAIjD0X,EAAS,QAAS,4BAHD1X,EAGuC,SAAW,8CAA8C,SACjH,CACAqX,EAAuB,EAAK,CAC9B,IACC,CAACjB,EAAa,YAAY,CAAC,EAExBuE,GAAgBzS,cAAY,IAAM,CACtC,MAAM0S,EAAqC,GAC3C,IAAIC,EAAc,GAElB,OAAIzE,EAAa,MACNwE,EAAA,IAAM,SAASxE,EAAa,GAAG,EAC1ByE,EAAA,IAEZzE,EAAa,SACfwE,EAAS,OAASxE,EAAa,OACjByE,EAAA,IAEZzE,EAAa,OACfwE,EAAS,KAAOxE,EAAa,KACfyE,EAAA,IAEZzE,EAAa,YACfwE,EAAS,UAAYxE,EAAa,UACpByE,EAAA,KAEZzE,EAAa,WAAa,QAAUA,EAAa,WAAa,WACvDwE,EAAA,SAAWxE,EAAa,WAAa,OAChCyE,EAAA,IAEZzE,EAAa,SACNwE,EAAA,OAAS,SAASxE,EAAa,MAAM,EAChCyE,EAAA,IAEZzE,EAAa,UACfwE,EAAS,QAAUxE,EAAa,QAClByE,EAAA,IAGTA,EAAcD,EAAW,QAC/B,CAACxE,CAAY,CAAC,EAEX0E,GAAoB5S,cAAY,SAAY,CAChD,GAAIjJ,EAAa,CACf,GAAI6V,EAAW,SAAW,GAAK,CAACsB,EAAa,OAAO,OAAQ,CAC1DW,EAAS,gEAAgE,EAChEW,EAAA,QAAS,sBAAuB,gEAAgE,EACzG,MACF,CACA,MAAMqD,GAAqB,MACtB,CACL,GAAI,CAACtF,GAAa,CAACW,EAAa,OAAO,OAAQ,CAC7CW,EAAS,kEAAkE,EAClEW,EAAA,QAAS,sBAAuB,kEAAkE,EAC3G,MACF,CACA,MAAMsD,GAAkB,CAC1B,GACC,CAACvF,EAAWX,EAAYsB,EAAa,OAAQnX,CAAW,CAAC,EAEtDgc,GAAwB/S,cAAY,MAAOuQ,EAAgBhD,IAAyB,CACpF,IAEFP,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,aAAc,SAAU,EAAG,QAAS,uBAAwB,CAC/E,IAEF,MAAMmC,EAAWD,KACXO,EAAsB,CAC1B,OAAQ9E,EAAa,OAAO,KAAK,EACjC,aAAc,IAIZwE,IACFM,EAAe,SAAWN,GAG5B,MAAMO,EAAkB,MAAMhU,GAAW,gBAAgB+T,CAAc,EAEjE5T,EAA2B,CAC/B,UAAW6T,EAAgB,UAC3B,OAAQ/E,EAAa,OAAO,KAAK,GAInClB,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,yBAA0B,UAAW0C,EAAgB,SAAU,CACvH,IAEF,MAAMC,EAAqB,CACzB,UAAWD,EAAgB,UAC3B,OAAQ5L,EAAuB,EAC/B,iBAAkB6G,EAAa,OAAO,KAAK,EAC3C,GAAIwE,GAAY,CAAE,aAAcA,CAAS,EACzC,cAAenF,EAAU,KAAK,KAC9B,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,OAAQ,aAGN,IACM,YAAI,gDAAiD2F,CAAkB,EAC/E,MAAMC,EAAa,MAAMlU,GAAW,gBAAgBiU,CAAkB,EAC9D,YAAI,gDAAiDC,CAAU,QAChErb,EAAO,CACN,cAAM,4CAA6CA,CAAK,EACxD,cAAM,oCAAqCob,CAAkB,EAC5D1D,EAAA,UAAW,uBAAwB,2EAA2E,CAGzH,CAEI,IAAA4D,GACAtJ,GAIJ,GAAIyD,EAAU,KAAO,CAACA,EAAU,IAAI,WAAW,OAAO,EAEpDP,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,oDAAqD,CAC5G,IAEF6C,GAAW7F,EAAU,IACrBzD,GAAWyD,EAAU,KAAK,KAG1BP,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,4BAA6B,CACrF,QACG,CAGLvD,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,wCAAyC,CACjG,IAGF,MAAM8C,EAAgB,MAAM5J,GAAkB8D,EAAU,KAAOlD,GAA4B,CACzF2C,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CACR,MAAO,aACP,SAAU,GAAMlG,EAAkB,IAClC,QAAS,uBAAuB,KAAK,MAAMA,CAAe,CAAC,GAC7D,CACA,IACH,EAED2C,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,oCAAqC,CAC5F,IAGSzG,GAAA,GAAGoE,EAAa,MAAM,IAAI9O,EAAY,SAAS,IAAI,KAAK,IAAK,QACxEgU,GAAW,MAAMnI,GAAkBoI,EAAevJ,GAAWO,GAA4B,CACvF2C,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CACR,MAAO,YACP,SAAU,GAAMlG,EAAkB,IAClC,QAAS,gBAAgB,KAAK,MAAMA,CAAe,CAAC,GACtD,CACA,KACDhD,EAAwB,EAC7B,CAEA2F,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,4BAA6B,CACrF,IAGE,IACF,MAAM+C,EAAqB,CACzB,GAAGJ,EACH,SAAAE,GACA,cAAetJ,GACf,OAAQ,aACR,UAAW,IAAI,KAAK,EAAE,YAAY,GAEpC,MAAM7K,GAAW,kBAAkBG,EAAY,UAAWkU,CAAkB,QACrExb,EAAO,CACN,aAAK,iDAAkDA,CAAK,CAEtE,CAGA,MAAMmH,GAAW,iBAAiB,CAChC,OAAQiP,EAAa,OAAO,KAAK,EACjC,UAAW9O,EAAY,UACvB,aAAcgU,GACd,cAAetJ,EAAA,CAChB,EAEDkD,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,6CAA8C,CACrG,IAGF,MAAMgD,GAAS,IAAIjU,GAAiBF,EAAY,SAAS,EAEzD,MAAM,IAAI,QAAc,CAACoU,EAASC,IAAW,CACpCF,GAAA,MACJ5T,GAA6B,CAEtB,MAAA0K,GAAkB1K,EAAO,SAAW,aAAe,GACnCA,EAAO,SAAW,UAAY,GAAK,GACzDqN,EAA+BqC,KAAA,CAC7B,GAAGA,GACH,CAACkB,CAAM,EAAG,CACR,MAAO,YACP,SAAUlG,GACV,QAAS,YAAY1K,EAAO,MAAM,KACpC,CACA,IAGEA,EAAO,cACT6P,EAAS,QAAS,mBAChB,GAAG7P,EAAO,aAAa,KAAK,KAAKA,EAAO,aAAa,OAAO,GAElE,EACCA,GAA6B,CAE5B,GAAIA,EAAO,aAAc,CACvB6P,EAAS,QAAS,kBAChB,yCAAyC7P,EAAO,aAAa,KAAK,MAAMA,EAAO,aAAa,OAAO,IACrGqN,EAA+BqC,KAAA,CAC7B,GAAGA,GACH,CAACkB,CAAM,EAAG,CAAE,MAAO,QAAS,SAAU,EAAG,QAAS,6BAA8B,CAChF,IACFkD,EAAO,IAAI,MAAM,qBAAqB9T,EAAO,aAAa,KAAK,EAAE,CAAC,EAClE,MACF,CAGA,MAAM+T,GAAiC,CACrC,UAAWtU,EAAY,UACvB,gBAAiBO,EAAO,yBAA2B,WAAWA,EAAO,wBAAwB,EAAI,EACjG,UAAWA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,OACxFA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,SAAW,MAC5G,WAAY,IACZ,SAAU,CACR,+CACAA,EAAO,yBAA2B,qBAAqBA,EAAO,wBAAwB,GAAK,GAC3FA,EAAO,sBAAwB,kBAAkBA,EAAO,qBAAqB,GAAK,GAClF,qEACA,OAAOgU,IAAWA,GAAQ,SAAW,EAAE,EACzC,UAAWhU,EAAO,UAClB,SAAAyT,GACA,eAAgBzT,CAAA,EAIZiU,GAAmB,CACvB,GAAGV,EACH,SAAAE,GACA,WAAYzT,EACZ,gBAAiB,CACf,gBAAiBA,EAAO,yBAA2B,WAAWA,EAAO,wBAAwB,EAAI,OACjG,aAAcA,EAAO,sBAAwB,WAAWA,EAAO,qBAAqB,EAAI,OACxF,UAAWA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,OACxFA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,SAAW,MAC5G,WAAY,IACZ,SAAU,CACR,+CACAA,EAAO,yBAA2B,qBAAqBA,EAAO,wBAAwB,GAAK,GAC3FA,EAAO,sBAAwB,kBAAkBA,EAAO,qBAAqB,GAAK,GAClF,qEACA,OAAOgU,IAAWA,GAAQ,SAAW,EAAE,EACzC,YAAa,IAAI,KAAK,EAAE,YAAY,CACtC,EACA,OAAQ,YACR,YAAa,IAAI,KAAK,EAAE,YAAY,EACpC,UAAW,IAAI,KAAK,EAAE,YAAY,GAIpC1U,GAAW,gBAAgB2U,EAAgB,EACxC,KAAMjU,IAAW,CACR,YAAI,mEAAoEP,EAAY,SAAS,EAC7F,YAAI,eAAgBO,EAAM,EACzB6P,EAAA,UAAW,gBAAiB,sDAAsD,EAC5F,EACA,MAAO1X,IAAU,CACR,cAAM,iEAAkEA,EAAK,EAC7E,cAAM,oCAAqC8b,EAAgB,EAC1DpE,EAAA,UAAW,eAAgB,wFAAwF,EAC7H,EAEHxC,EAA+BqC,KAAA,CAC7B,GAAGA,GACH,CAACkB,CAAM,EAAG,CAAE,MAAO,WAAY,SAAU,IAAK,QAAS,oBAAqB,CAC5E,IACFrD,EAAoBmC,KAAA,CAClB,GAAGA,GACH,CAACkB,CAAM,EAAGmD,EACV,IACMF,GACV,EACC1b,GAAoB,CACnB2b,EAAO3b,CAAK,CACd,EACF,CACD,QAEMwa,EAAK,CACZ,QAAQ,MAAM,yBAAyB/B,CAAM,IAAK+B,CAAG,EAGrD,IAAI5Y,EAAY,gBACZC,EAAe,+BACfka,EAAwC,GAExCvB,GAAO,OAAOA,GAAQ,UAEpB,SAAUA,GAAO,OAAOA,EAAI,MAAS,WACvC5Y,EAAY4Y,EAAI,MAEd,YAAaA,GAAO,OAAOA,EAAI,SAAY,WAC7C3Y,EAAe2Y,EAAI,SAEjB,YAAaA,GAAO,OAAOA,EAAI,SAAY,WAC7CuB,EAAevB,EAAI,UAEZA,aAAe,QACxB3Y,EAAe2Y,EAAI,QACnB5Y,EAAY4Y,EAAI,MAAQ,SAItB,IAEI,MAAAwB,EAAkB/G,EAAmBwD,CAAM,EAC7C,GAAAuD,GAAmBA,EAAgB,UAAW,CAEhD,MAAMC,GAAoB,CACxB,UAAWD,EAAgB,UAC3B,OAAQzM,EAAuB,EAC/B,iBAAkB6G,EAAa,OAAO,KAAK,EAC3C,cAAeX,EAAU,KAAK,KAC9B,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,OAAQ,SACR,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,MAAO,CACL,KAAM7T,EACN,QAASC,EACT,QAASka,CACX,GAGF,MAAM5U,GAAW,kBAAkB6U,EAAgB,UAAWC,EAAiB,EAC/E,QAAQ,IAAI,mBAAmBD,EAAgB,SAAS,mBAAmB,CAC7E,QACOE,EAAa,CACZ,cAAM,6CAA8CA,CAAW,CACzE,CAII,IAEI,MAAAF,EAAkB/G,EAAmBwD,CAAM,EAC7C,GAAAuD,IAAoBA,EAAgB,QAAU,aAC5BA,EAAgB,QAAU,cAC1BA,EAAgB,QAAU,aAAc,CAEtD,MAAAhK,GAAW,GAAGoE,EAAa,MAAM,WAG/B,YAAI,wCAAwCpE,EAAQ,EAAE,CAChE,QACOmK,EAAc,CACb,aAAK,gCAAiCA,CAAY,CAC5D,CAEA,MAAAjH,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CACR,MAAO,QACP,SAAU,EACV,QAAS,oBACT,MAAO,CACL,KAAM7W,EACN,QAASC,EACT,QAASka,CACX,CACF,CACA,IACIvB,CACR,GACC,CAACpE,EAAa,OAAQuE,GAAexT,GAAYgM,GAAmBxB,GAAmB+F,CAAQ,CAAC,EAE7FqD,GAAuB7S,cAAY,SAAY,CACnDsN,EAAgB,EAAI,EACpBuB,EAAS,IAAI,EAGb,MAAMG,EAAmB2C,KACrB3C,KAAiB,OAAS,EAAG,CAC/BH,EAAS,qBAAqBG,EAAiB,KAAK,IAAI,CAAC,EAAE,EAC3DQ,EAAS,QAAS,mBAAoBR,EAAiB,KAAK,IAAI,CAAC,EACjE1B,EAAgB,EAAK,EACrB,MACF,CAGM,MAAA4G,EAAiBtH,EAAW,OAAOnE,GAAQ0E,EAAW1E,EAAK,EAAE,IAAM,OAAO,EAE5E,GAAAyL,EAAe,SAAW,EAAG,CACtB1E,EAAA,OAAQ,iBAAkB,+BAA+B,EAClElC,EAAgB,EAAK,EACrB,MACF,CAEA,MAAM6G,EAAaD,EAAe,OAClC,IAAIE,EAAiB,EAEjB,IACF,UAAW7G,KAAa2G,EAAgB,CACtCE,IACS5E,EAAA,OAAQ,kBAAmB,cAAcjC,EAAU,KAAK,IAAI,KAAK6G,CAAc,IAAID,CAAU,GAAG,EAG3F/G,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAAC9B,EAAU,EAAE,EAAG,YAAe,IAE7D,IACI,MAAAwF,GAAsBxF,EAAU,GAAIA,CAAS,EACrCH,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAAC9B,EAAU,EAAE,EAAG,UAAa,IAC/DiC,EAAS,UAAW,gBAAiB,GAAGjC,EAAU,KAAK,IAAI,yBAAyB,QAC7EzV,EAAO,CAEd,IAAI4B,EAAY,wBACZC,GAAe,+BACfka,GAAwC,GAExC/b,GAAS,OAAOA,GAAU,UACxB,SAAUA,GAAS,OAAOA,EAAM,MAAS,WAC3C4B,EAAY5B,EAAM,MAEhB,YAAaA,GAAS,OAAOA,EAAM,SAAY,WACjD6B,GAAe7B,EAAM,SAEnB,YAAaA,GAAS,OAAOA,EAAM,SAAY,WACjD+b,GAAe/b,EAAM,UAEdA,aAAiB,QAC1B6B,GAAe7B,EAAM,QACrB4B,EAAY5B,EAAM,MAAQ,SAGnB0X,EAAA,QAAS,cAAe,qBAAqBjC,EAAU,KAAK,IAAI,KAAK5T,EAAY,EAAE,EAG9EyT,EAAAiC,KAAS,CAAE,GAAGA,GAAM,CAAC9B,EAAU,EAAE,EAAG,OAAU,IAC5DP,EAA+BqC,KAAA,CAC7B,GAAGA,GACH,CAAC9B,EAAU,EAAE,EAAG,CACd,MAAO,QACP,SAAU,EACV,QAAS,WAAW5T,EAAY,GAChC,MAAO,CACL,KAAMD,EACN,QAASC,GACT,QAASka,EACX,CACF,CACA,GACJ,CACF,CAESrE,EAAA,UAAW,iBAAkB,aAAa4E,CAAc,QAAQA,IAAmB,EAAI,IAAM,EAAE,EAAE,EACnFrc,EAAA,8BAA8Bqc,CAAc,mBAAmB,QAC/E9B,EAAK,CACZ,MAAM3Y,EAAe2Y,aAAe,MAAQA,EAAI,QAAU,+BAC1DzD,EAASlV,CAAY,EACZ6V,EAAA,QAAS,eAAgB7V,CAAY,EACvB5B,EAAA,UAAU4B,CAAY,EAAE,SAC/C,CACA2T,EAAgB,EAAK,CACvB,GACC,CAACV,EAAYO,EAAYwE,GAAkBnC,EAAUzX,EAAwBgb,EAAqB,CAAC,EAEhGsB,GAAkBrU,cAAY,MAAOuQ,GAAmB,CAC5D,MAAMhD,EAAYX,EAAW,KAAU6D,KAAE,KAAOF,CAAM,EACtD,GAAI,CAAChD,EAAW,OAGhB,MAAMyB,EAAmB2C,KACrB3C,KAAiB,OAAS,EAAG,CAC/BH,EAAS,qBAAqBG,EAAiB,KAAK,IAAI,CAAC,EAAE,EAC3DQ,EAAS,QAAS,mBAAoBR,EAAiB,KAAK,IAAI,CAAC,EACjE,MACF,CAEc5B,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAACkB,CAAM,EAAG,YAAe,IAEvD,IACI,MAAAwC,GAAsBxC,EAAQhD,CAAS,EAC/BH,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAACkB,CAAM,EAAG,UAAa,IACzDf,EAAS,UAAW,gBAAiB,GAAGjC,EAAU,KAAK,IAAI,yBAAyB,QAC7EzV,EAAO,CACd,QAAQ,MAAM,oBAAoByV,EAAU,KAAK,IAAI,IAAKzV,CAAK,EAC/D,MAAM6B,EAAe7B,aAAiB,MAAQA,EAAM,QAAU,+BAErD0X,EAAA,QAAS,cAAe,qBAAqBjC,EAAU,KAAK,IAAI,KAAK5T,CAAY,EAAE,EAC9EyT,EAAAiC,IAAS,CAAE,GAAGA,EAAM,CAACkB,CAAM,EAAG,OAAU,IACtDvD,EAA+BqC,IAAA,CAC7B,GAAGA,EACH,CAACkB,CAAM,EAAG,CAAE,MAAO,QAAS,SAAU,EAAG,QAAS,WAAW5W,CAAY,EAAG,CAC5E,GACJ,GACC,CAACiT,EAAY+E,GAAkBnC,EAAUuD,EAAqB,CAAC,EAE5DD,GAAoB9S,cAAY,SAAY,CAChD,GAAI,CAACuN,GAAa,CAACW,EAAa,OAAO,OAAQ,CAC7CW,EAAS,kEAAkE,EAClEW,EAAA,QAAS,sBAAuB,kEAAkE,EAC3G,MACF,CAGA,MAAMR,EAAmB2C,KACrB3C,KAAiB,OAAS,EAAG,CAC/BH,EAAS,qBAAqBG,EAAiB,KAAK,IAAI,CAAC,EAAE,EAC3DQ,EAAS,QAAS,mBAAoBR,EAAiB,KAAK,IAAI,CAAC,EACjE,MACF,CAEI,IACFH,EAAS,IAAI,EAGbpB,EAAY,CAAE,MAAO,aAAc,SAAU,EAAG,QAAS,wBAAyB,EAClF1V,EAAuB,gDAAgD,EAEvE,MAAM2a,EAAWD,KACXO,EAAsB,CAC1B,OAAQ9E,EAAa,OAAO,KAAK,EACjC,aAAc,IAIZwE,IACFM,EAAe,SAAWN,GAG5B,MAAMO,EAAkB,MAAMhU,GAAW,gBAAgB+T,CAAc,EAEjE5T,EAA2B,CAC/B,UAAW6T,EAAgB,UAC3B,OAAQ/E,EAAa,OAAO,KAAK,GAInCT,EAAY,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,yBAA0B,EAEpF,MAAMyF,EAAqB,CACzB,UAAWD,EAAgB,UAC3B,OAAQ5L,EAAuB,EAC/B,iBAAkB6G,EAAa,OAAO,KAAK,EAC3C,GAAIwE,GAAY,CAAE,aAAcA,CAAS,EACzC,cAAenF,EAAU,KAAK,KAC9B,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,OAAQ,aAGN,IACM,YAAI,iDAAkD2F,CAAkB,EAChF,MAAMC,GAAa,MAAMlU,GAAW,gBAAgBiU,CAAkB,EAC9D,YAAI,iDAAkDC,EAAU,QACjErb,GAAO,CACN,cAAM,6CAA8CA,EAAK,EACzD,cAAM,oCAAqCob,CAAkB,EAC5D1D,EAAA,UAAW,uBAAwB,2EAA2E,CAGzH,CAEI,IAAA4D,EACAtJ,GAIJ,GAAIyD,EAAU,KAAO,CAACA,EAAU,IAAI,WAAW,OAAO,EAEpDE,EAAY,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,qDAAsD,EAC/G1V,EAAuB,uEAAuE,EAE9Fqb,EAAW7F,EAAU,IACrBzD,GAAWyD,EAAU,KAAK,KAG1BE,EAAY,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,6BAA8B,MACnF,CAGLA,EAAY,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,yCAA0C,EACpG1V,EAAuB,oDAAoD,EAG3E,MAAMsb,GAAgB,MAAM5J,GAAkB8D,EAAU,KAAOlD,GAA4B,CAC7EoD,EAAA,CACV,MAAO,aACP,SAAU,GAAMpD,EAAkB,IAClC,QAAS,uBAAuB,KAAK,MAAMA,CAAe,CAAC,IAC5D,EACF,EAEDoD,EAAY,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,qCAAsC,EAC/F1V,EAAuB,6CAA6C,EAGzD+R,GAAA,GAAGoE,EAAa,MAAM,IAAI9O,EAAY,SAAS,IAAI,KAAK,IAAK,QACxEgU,EAAW,MAAMnI,GAAkBoI,GAAevJ,GAAWO,GAA4B,CAC3EoD,EAAA,CACV,MAAO,YACP,SAAU,GAAMpD,EAAkB,IAClC,QAAS,gBAAgB,KAAK,MAAMA,CAAe,CAAC,IACrD,GACAhD,EAAwB,EAC7B,CAEAoG,EAAY,CAAE,MAAO,aAAc,SAAU,GAAI,QAAS,6BAA8B,EACxF1V,EAAuB,4DAA4D,EAG/E,IACF,MAAMub,GAAqB,CACzB,GAAGJ,EACH,SAAAE,EACA,cAAetJ,GACf,OAAQ,aACR,UAAW,IAAI,KAAK,EAAE,YAAY,GAEpC,MAAM7K,GAAW,kBAAkBG,EAAY,UAAWkU,EAAkB,QACrExb,GAAO,CACN,aAAK,iDAAkDA,EAAK,CAEtE,CAGA,MAAMmH,GAAW,iBAAiB,CAChC,OAAQiP,EAAa,OAAO,KAAK,EACjC,UAAW9O,EAAY,UACvB,aAAcgU,EACd,cAAetJ,EAAA,CAChB,EAED2D,EAAY,CAAE,MAAO,YAAa,SAAU,GAAI,QAAS,8CAA+C,EACxG1V,EAAuB,4CAA4C,EAGnE,MAAMwb,GAAS,IAAIjU,GAAiBF,EAAY,SAAS,EAEzD,MAAM,IAAI,QAAc,CAACoU,GAASC,IAAW,CACpCF,GAAA,MACJ5T,GAA6B,CAEtB,MAAA0K,EAAkB1K,EAAO,SAAW,aAAe,GACnCA,EAAO,SAAW,UAAY,GAAK,GAC7C8N,EAAA,CACV,MAAO,YACP,SAAUpD,EACV,QAAS,YAAY1K,EAAO,MAAM,MACnC,EAGGA,EAAO,cACT6P,EAAS,QAAS,mBAChB,GAAG7P,EAAO,aAAa,KAAK,KAAKA,EAAO,aAAa,OAAO,GAElE,EACCA,GAA6B,CAE5B,GAAIA,EAAO,aAAc,CACvB6P,EAAS,QAAS,kBAChB,yCAAyC7P,EAAO,aAAa,KAAK,MAAMA,EAAO,aAAa,OAAO,IACrG8N,EAAY,CAAE,MAAO,QAAS,SAAU,EAAG,QAAS,8BAA+B,EACnFgG,EAAO,IAAI,MAAM,qBAAqB9T,EAAO,aAAa,KAAK,EAAE,CAAC,EAClE,MACF,CAGA,MAAM+T,EAAiC,CACrC,UAAWtU,EAAY,UACvB,gBAAiBO,EAAO,yBAA2B,WAAWA,EAAO,wBAAwB,EAAI,EACjG,UAAWA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,OACxFA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,SAAW,MAC5G,WAAY,IACd,SAAU,CACR,+CACAA,EAAO,yBAA2B,qBAAqBA,EAAO,wBAAwB,GAAK,GAC3FA,EAAO,sBAAwB,kBAAkBA,EAAO,qBAAqB,GAAK,GAClF,qEACA,OAAOgU,IAAWA,GAAQ,SAAW,EAAE,EACzC,UAAWhU,EAAO,UAClB,SAAAyT,EACA,eAAgBzT,CAAA,EAIZiU,GAAmB,CACvB,GAAGV,EACH,SAAAE,EACA,WAAYzT,EACZ,gBAAiB,CACf,gBAAiBA,EAAO,yBAA2B,WAAWA,EAAO,wBAAwB,EAAI,OACjG,aAAcA,EAAO,sBAAwB,WAAWA,EAAO,qBAAqB,EAAI,OACxF,UAAWA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,OACxFA,EAAO,0BAA4B,WAAWA,EAAO,wBAAwB,EAAI,GAAM,SAAW,MAC5G,WAAY,IACZ,SAAU,CACR,+CACAA,EAAO,yBAA2B,qBAAqBA,EAAO,wBAAwB,GAAK,GAC3FA,EAAO,sBAAwB,kBAAkBA,EAAO,qBAAqB,GAAK,GAClF,qEACA,OAAOgU,IAAWA,GAAQ,SAAW,EAAE,EACzC,YAAa,IAAI,KAAK,EAAE,YAAY,CACtC,EACA,OAAQ,YACR,YAAa,IAAI,KAAK,EAAE,YAAY,EACpC,UAAW,IAAI,KAAK,EAAE,YAAY,GAIpC1U,GAAW,gBAAgB2U,EAAgB,EACxC,KAAMjU,IAAW,CACR,YAAI,wDAAyDP,EAAY,SAAS,EAClF,YAAI,eAAgBO,EAAM,EACzB6P,EAAA,UAAW,gBAAiB,sDAAsD,EAC5F,EACA,MAAO1X,IAAU,CACR,cAAM,sDAAuDA,EAAK,EAClE,cAAM,oCAAqC8b,EAAgB,EAC1DpE,EAAA,UAAW,eAAgB,wFAAwF,EAC7H,EAEH/B,EAAY,CAAE,MAAO,WAAY,SAAU,IAAK,QAAS,qBAAsB,EAC/EC,EAAUgG,CAAc,EACflE,EAAA,UAAW,oBAAqB,kEAAkE,EAC3GzX,EAAuB,mDAAmD,EAClEyb,IACR,EACC1b,GAAoB,CACnB0X,EAAS,QAAS,iBAAkB1X,EAAM,SAAW,+CAA+C,EACpG2b,EAAO3b,CAAK,CACd,EACF,CACD,QAEMwa,EAAK,CACJ,cAAM,oBAAqBA,CAAG,EACtC,MAAM3Y,EAAe2Y,aAAe,MAAQA,EAAI,QAAU,+BAC1DzD,EAASlV,CAAY,EACrB8T,EAAY,CAAE,MAAO,QAAS,SAAU,EAAG,QAAS,oBAAqB,EAChE+B,EAAA,QAAS,oBAAqB7V,CAAY,EAC5B5B,EAAA,UAAU4B,CAAY,EAAE,CACjD,GACC,CAAC4T,EAAWW,EAAa,OAAQnW,EAAwB4Z,GAAkBc,EAAa,CAAC,EAEtF6B,GAAmBtU,cAAauU,GAAkB,CACtD,OAAQA,EAAO,CACb,IAAK,QAAgB,yCACrB,IAAK,WAAmB,2CACxB,QAAgB,QAClB,CACF,EAAG,CAAE,GAGH,OAAAlY,EAAA,KAAC,MAAI,WAAU,kCAEb,UAACA,OAAA,OAAI,UAAU,cACb,UAAA9C,MAAC,OAAI,UAAU,yCAEb,SAAC8C,EAAA,YAAI,UAAU,8BACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAC9C,EAAA,YAAK,UAAU,uDAAuD,SAAgB,qBACvF8C,OAAC,MAAI,WAAU,oCACb,UAAA9C,EAAA,IAAC,UAAO,KAAK,SACX,QAAS4X,GACT,UAAW,qLACTpa,EACI,gCACA,uEACN,GACA,aAAY,aAAaA,EAAc,cAAgB,YAAY,QAEnE,SAAAwC,EAAA,IAAC,QACC,UAAW,wGACTxC,EAAc,gBAAkB,eAClC,GAEC,SAAAA,QACEoO,GAAM,WAAU,wBAAwB,EAEzC5L,EAAA,IAAC2L,GAAK,WAAU,uBAAwB,GAE5C,EACF,EACA7I,OAAC,MAAI,WAAU,mCACb,UAAC9C,MAAA,QAAK,UAAW,uBAAwBxC,EAAgD,mCAAlC,+BAAoE,GAAI,SAE/H,WACAwC,MAAC,QAAK,UAAW,uBAAuBxC,EAAc,gCAAkC,kCAAkC,GAAI,SAE9H,WACF,GACF,GACF,EAGAwC,EAAA,IAAC,OAAI,UAAW,uEACdxC,EACI,gEACA,mEACN,GACG,SAAAA,EAEGsF,EAAA,KAAAM,EAAA,oBAAApD,MAAC,MAAI,WAAU,eAAe,KAAK,eAAe,QAAQ,YACxD,SAACA,EAAA,YAAK,SAAS,UAAU,EAAE,gJAAgJ,SAAS,SAAU,GAChM,EAAM,oBAER,EAGE8C,OAAAM,EAAA,oBAAApD,MAAC,MAAI,WAAU,eAAe,KAAK,eAAe,QAAQ,YACxD,SAACA,EAAA,YAAK,SAAS,UAAU,EAAE,iFAAiF,SAAS,SAAU,GACjI,EAAM,eAER,CAEJ,IACF,CACF,GAECA,EAAA,UAAG,UAAU,wDAAwD,SAEtE,2BACA8C,OAAC,IAAE,WAAU,wCAAwC,oBAC3CtF,EAAc,uBAAyB,gBAAgB,+EACjE,EAGAwC,EAAA,IAAC,OAAI,UAAW,yDACdxC,EACI,kEACA,qEACN,GACG,SAAAA,EAEGsF,EAAA,KAAAM,EAAA,oBAAAN,OAAC,OAAI,UAAU,eAAe,KAAK,eAAe,QAAQ,YACxD,UAAC9C,MAAA,QAAK,EAAE,oCAAqC,SAC5C,OAAK,UAAS,UAAU,EAAE,iFAAiF,SAAS,UAAU,GACjI,EAAM,qEAER,EAGE8C,OAAAM,EAAA,oBAAApD,MAAC,MAAI,WAAU,eAAe,KAAK,eAAe,QAAQ,YACxD,SAACA,EAAA,YAAK,SAAS,UAAU,EAAE,wLAAwL,SAAS,SAAU,GACxO,EAAM,yEAER,CAEJ,IACF,EAGA8C,OAAC,MAAI,WAAU,qDACb,UAAC9C,EAAA,UAAG,UAAU,2DAA2D,SAEzE,mCACA8C,OAAC,MAAI,WAAU,uDACb,UAAAA,OAAC,MACC,WAAA9C,MAAC,QAAM,SAAQ,SAAS,UAAU,kEAAkE,SAEpG,uCACAA,EAAA,IAAC,SACC,KAAK,OACL,GAAG,SACH,MAAO2U,EAAa,OACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,OAAQhW,EAAE,OAAO,KAAQ,IAC9E,UAAU,4LACV,YAAY,yBACd,EACCE,EAAA,SAAE,UAAU,gDAAgD,SAE7D,4EACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,MAAM,UAAU,kEAAkE,SAEjG,QACAA,EAAA,IAAC,SACC,KAAK,SACL,GAAG,MACH,MAAO2U,EAAa,IACpB,SAAW7U,GAAM,CACT,MAAAmb,EAAWnb,EAAE,OAAO,MAC1B8U,MAAyB,CAAE,GAAGkB,EAAM,IAAKmF,CAAW,IAEpDrC,GAAsB,MAAOqC,CAAQ,CACvC,EACA,OAASnb,GAAM8Y,GAAsB,MAAO9Y,EAAE,OAAO,KAAK,EAC1D,QAAUA,GAAM,EACVA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,QACX8Y,GAAA,MAAO9Y,EAAE,cAAc,KAAK,CAEtD,EACA,UAAW,2JACT2V,EAAiB,IACb,qCACA,sCACN,GACA,YAAY,eACZ,IAAI,IACJ,IAAI,MACJ,mBAAkBA,EAAiB,IAAM,YAAc,OACzD,EACCA,EAAiB,KAChBzV,MAAC,IAAE,IAAG,YAAY,UAAU,8CAA8C,KAAK,QAC5E,SAAAyV,EAAiB,GACpB,IAEJ,SAEC,MACC,WAAAzV,MAAC,QAAM,SAAQ,SAAS,UAAU,kEAAkE,SAEpG,WACAA,EAAA,IAAC,SACC,KAAK,SACL,GAAG,SACH,MAAO2U,EAAa,OACpB,SAAW7U,GAAM,CACT,MAAAmb,EAAWnb,EAAE,OAAO,MAC1B8U,MAAyB,CAAE,GAAGkB,EAAM,OAAQmF,CAAW,IAEvDrC,GAAsB,SAAUqC,CAAQ,CAC1C,EACA,OAASnb,GAAM8Y,GAAsB,SAAU9Y,EAAE,OAAO,KAAK,EAC7D,QAAUA,GAAM,EACVA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,QACX8Y,GAAA,SAAU9Y,EAAE,cAAc,KAAK,CAEzD,EACA,UAAW,2JACT2V,EAAiB,OACb,qCACA,sCACN,GACA,YAAY,gBACZ,IAAI,IACJ,IAAI,OACJ,mBAAkBA,EAAiB,OAAS,eAAiB,OAC/D,EACCA,EAAiB,QAChBzV,MAAC,IAAE,IAAG,eAAe,UAAU,8CAA8C,KAAK,QAC/E,SAAAyV,EAAiB,MACpB,IAEJ,SAEC,MACC,WAAAzV,MAAC,QAAM,SAAQ,SAAS,UAAU,kEAAkE,SAEpG,WACA8C,EAAA,KAAC,UACC,GAAG,SACH,MAAO6R,EAAa,OACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,OAAQhW,EAAE,OAAO,KAAQ,IAC9E,UAAU,+LAEV,UAACE,EAAA,cAAO,MAAM,GAAG,SAAa,kBAC7BA,EAAA,cAAO,MAAM,OAAO,SAAI,SACxBA,EAAA,cAAO,MAAM,SAAS,SAAM,WAC5BA,EAAA,cAAO,MAAM,aAAa,SAAU,eACpCA,EAAA,cAAO,MAAM,qBAAqB,SAAkB,uBACpDA,EAAA,cAAO,MAAM,mBAAmB,SAAgB,qBAChDA,EAAA,cAAO,MAAM,QAAQ,SAAK,UAC1BA,EAAA,cAAO,MAAM,SAAS,SAAM,YAC/B,GACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,OAAO,UAAU,kEAAkE,SAElG,SACA8C,EAAA,KAAC,UACC,GAAG,OACH,MAAO6R,EAAa,KACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,KAAMhW,EAAE,OAAO,KAAQ,IAC5E,UAAU,+LAEV,UAACE,EAAA,cAAO,MAAM,GAAG,SAAW,gBAC3BA,EAAA,cAAO,MAAM,QAAQ,SAAK,UAC1BA,EAAA,cAAO,MAAM,4BAA4B,SAAyB,8BAClEA,EAAA,cAAO,MAAM,QAAQ,SAAK,UAC1BA,EAAA,cAAO,MAAM,oCAAoC,SAAiC,sCAClFA,EAAA,cAAO,MAAM,sCAAsC,SAAmC,wCACtFA,EAAA,cAAO,MAAM,oBAAoB,SAAiB,sBAClDA,EAAA,cAAO,MAAM,QAAQ,SAAK,UAC1BA,EAAA,cAAO,MAAM,oBAAoB,SAAiB,uBACrD,GACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,YAAY,UAAU,kEAAkE,SAEvG,cACA8C,EAAA,KAAC,UACC,GAAG,YACH,MAAO6R,EAAa,UACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,UAAWhW,EAAE,OAAO,KAAQ,IACjF,UAAU,+LAEV,UAACE,EAAA,cAAO,MAAM,GAAG,SAAgB,qBAChCA,EAAA,cAAO,MAAM,sCAAsC,SAAmC,wCACtFA,EAAA,cAAO,MAAM,0CAA0C,SAAuC,6CACjG,GACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,WAAW,UAAU,kEAAkE,SAEtG,qBACA8C,EAAA,KAAC,UACC,GAAG,WACH,MAAO6R,EAAa,SACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,SAAUhW,EAAE,OAAO,KAAQ,IAChF,UAAU,+LAEV,UAACE,EAAA,cAAO,MAAM,GAAG,SAAe,oBAC/BA,EAAA,cAAO,MAAM,OAAO,SAAO,YAC3BA,EAAA,cAAO,MAAM,QAAQ,SAAK,WAC7B,GACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,UAAU,UAAU,kEAAkE,SAErG,aACAA,EAAA,IAAC,SACC,KAAK,OACL,GAAG,UACH,MAAO2U,EAAa,QACpB,SAAW7U,GAAM,CACT,MAAAmb,EAAWnb,EAAE,OAAO,MAC1B8U,MAAyB,CAAE,GAAGkB,EAAM,QAASmF,CAAW,IAExDrC,GAAsB,UAAWqC,CAAQ,CAC3C,EACA,OAASnb,GAAM8Y,GAAsB,UAAW9Y,EAAE,OAAO,KAAK,EAC9D,QAAUA,GAAM,EACVA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,QACX8Y,GAAA,UAAW9Y,EAAE,cAAc,KAAK,CAE1D,EACA,UAAW,2JACT2V,EAAiB,QACb,qCACA,sCACN,GACA,YAAY,iBACZ,QAAQ,uBACR,MAAM,qDACN,mBAAkBA,EAAiB,QAAU,gBAAkB,OACjE,EACCA,EAAiB,SAChBzV,MAAC,IAAE,IAAG,gBAAgB,UAAU,8CAA8C,KAAK,QAChF,SAAAyV,EAAiB,OACpB,IAEJ,EAEA3S,OAAC,MAAI,WAAU,8BACb,UAAA9C,MAAC,QAAM,SAAQ,eAAe,UAAU,kEAAkE,SAE1G,kBACAA,EAAA,IAAC,YACC,GAAG,eACH,MAAO2U,EAAa,aACpB,SAAW7U,GAAM8U,EAAyBkB,IAAA,CAAE,GAAGA,EAAM,aAAchW,EAAE,OAAO,KAAQ,IACpF,OAASA,GAAM8Y,GAAsB,eAAgB9Y,EAAE,OAAO,KAAK,EACnE,QAAUA,GAAM,EACVA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,QACX8Y,GAAA,eAAgB9Y,EAAE,cAAc,KAAK,CAE/D,EACA,UAAW,2JACT2V,EAAiB,aACb,qCACA,sCACN,GACA,KAAM,EACN,YAAY,yDACZ,mBAAkBA,EAAiB,aAAe,qBAAuB,OAC3E,EACCA,EAAiB,cAChBzV,MAAC,IAAE,IAAG,qBAAqB,UAAU,8CAA8C,KAAK,QACrF,SAAAyV,EAAiB,YACpB,GAEF3S,OAAC,MAAI,WAAU,yCACb,UAACA,OAAA,KAAE,UAAU,2CACV,UAAA6R,EAAa,aAAa,OAAO,mBACpC,EAGA7R,EAAA,KAAC,UACC,KAAK,SACL,QAAS,IAAMmW,GAAwB,EACvC,SAAU,CAACtE,EAAa,aAAa,KAAU,GAAAgB,GAC/C,UAAU,8XACV,aAAW,gDACX,MAAM,+BAEL,UAAAA,SACEuF,GAAQ,WAAU,kCAAkC,cAAY,MAAO,GAExElb,EAAA,IAAC,OACC,UAAU,qBACV,KAAK,OACL,OAAO,eACP,QAAQ,YACR,cAAY,OAEZ,SAAAA,EAAA,IAAC,QACC,cAAc,QACd,eAAe,QACf,YAAa,EACb,EAAE,mGACJ,EACF,EAED2V,GAAsB,gBAAkB,mBAC3C,GACF,GACF,GACF,GACF,EAGA7S,OAAC,MAAI,WAAU,qDACb,UAACA,OAAA,MAAG,UAAU,2DAA2D,+BACpDtF,GAAewC,EAAA,IAAC,OAAK,WAAU,uDAAuD,SAAiB,uBAC5H,EAEE,CAACxC,GAAe,CAACwW,GAAexW,GAAe6V,EAAW,SAAW,EACrEvQ,EAAA,KAAC,OACC,UAAU,4JACV,WAAY4U,GACZ,OAAQC,GAER,UAAA3X,EAAA,IAACiN,GAAO,WAAU,uCAAuC,cAAY,OAAO,EAC5EnK,OAAC,MAAI,WAAU,OACb,UAAAA,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAM,cAAA8L,EAAAoH,EAAa,UAAb,YAAApH,EAAsB,SACrC,UAAU,+OAEV,UAAC5O,MAAAuM,GAAA,CAAK,UAAU,cAAe,GAAE,oBACf/O,EAAc,IAAM,IACxC,EACAsF,OAAC,IAAE,WAAU,gDAAgD,8BACzCtF,EAAc,QAAU,OAAO,SACnD,GACF,EACAsF,OAAC,IAAE,WAAU,2CAA2C,wEAErDtF,SAAgB,KAAG,IACnBA,GAAe,yCAClB,EACAwC,EAAA,IAAC,SACC,IAAKgW,EACL,KAAK,OACL,UAAU,SACV,OAAO,oCACP,SAAUoB,GACV,SAAU5Z,EACV,aAAY,oBAAoBA,EAAc,IAAM,EAAE,gBACxD,GAGF,EAAAsF,EAAA,KAAC,MAAI,WAAU,YAEZ,WAACtF,GAAewW,GACdlR,EAAA,YAAI,UAAU,6DACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAACoN,GAAQ,WAAU,wBAAwB,cAAY,OAAO,SAC7D,MACC,WAAApN,MAAC,IAAE,WAAU,4CACV,SAAAgU,EAAU,KAAK,KAClB,EACAlR,OAAC,IAAE,WAAU,2CACT,WAAAkR,EAAU,KAAK,KAAO,KAAO,MAAM,QAAQ,CAAC,EAAE,MAC/CA,EAAU,UAAY,MAAMgE,GAAWhE,EAAU,QAAQ,CAAC,IAC7D,GACF,GACF,EACAhU,EAAA,IAAC,UAAO,KAAK,SACX,QAAS0W,GACT,UAAU,iEACV,aAAW,uBAEX,SAAA1W,MAACsN,GAAE,WAAU,SAAU,GACzB,GACF,EAGAxK,OAAC,MAAI,WAAU,YACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAAC,UAAO,KAAK,SACX,QAAS8X,GACT,UAAU,2MACV,aAAY1D,EAAY,cAAgB,aAEvC,SACCA,EAAApU,MAACoM,GAAM,WAAU,UAAU,cAAY,MAAO,GAE7CpM,MAAAsM,GAAA,CAAK,UAAU,iBAAiB,cAAY,OAAO,EAExD,EACAtM,MAAC,OAAI,UAAU,SACZ,WAAU,UACT8C,EAAA,KAAC,MAAI,WAAU,2CACZ,UAAAkV,GAAW1D,CAAW,EAAE,MAAI0D,GAAWhE,EAAU,QAAQ,GAC5D,CAEJ,IACF,EAECA,EAAU,UACRhU,MAAA,OAAI,UAAU,iBACb,SAAAA,EAAA,IAAC,OACC,UAAU,yCACV,MAAO,CAAE,MAAO,GAAIsU,EAAcN,EAAU,SAAY,GAAG,GAAI,EAC/D,KAAK,cACL,aAAW,0BACX,gBAAeM,EACf,gBAAe,EACf,gBAAeN,EAAU,WAE7B,GAEJ,EAEAhU,EAAA,IAAC,SACC,IAAK+V,EACL,IAAK/B,EAAU,IACf,aAAc+D,GACd,QAAS,IAAM1D,EAAa,EAAK,EACjC,OAAQ,IAAMA,EAAa,EAAI,EAC/B,QAAS,IAAMA,EAAa,EAAK,EACjC,UAAU,SACZ,GACF,EAID7W,GAAe6V,EAAW,OAAS,GAEhCvQ,OAAAM,WAAA,WAACN,OAAA,OAAI,UAAU,oCACb,UAACA,OAAA,MAAG,UAAU,oDAAoD,6BAC/CuQ,EAAW,OAAO,KACrC,EACAvQ,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAM,cAAA8L,EAAAoH,EAAa,UAAb,YAAApH,EAAsB,SACrC,UAAU,2TAEV,UAAC5O,MAAAuM,GAAA,CAAK,UAAU,cAAe,GAAE,kBAEnC,GACF,QAEC,MAAI,WAAU,wCACZ,SAAW8G,EAAA,IAAKnE,GAAS,CACxB,MAAMiM,EAAYvH,EAAW1E,EAAK,EAAE,GAAK,QACnCE,EAAWoE,EAAmBtE,EAAK,EAAE,EAGzC,OAAApM,EAAA,KAAC,MAAkB,WAAU,6DAC3B,UAACA,OAAA,OAAI,UAAU,yCACb,UAACA,OAAA,OAAI,UAAU,6CACb,UAAA9C,EAAA,IAACoN,GAAQ,WAAU,sCAAsC,cAAY,OAAO,EAC5EtK,OAAC,MAAI,WAAU,iBACb,UAAA9C,MAAC,IAAE,WAAU,qDACV,SAAAkP,EAAK,KAAK,KACb,EACApM,OAAC,IAAE,WAAU,2CACT,WAAAoM,EAAK,KAAK,KAAO,KAAO,MAAM,QAAQ,CAAC,EAAE,MAC1CA,EAAK,UAAY,MAAM8I,GAAW9I,EAAK,QAAQ,CAAC,IACnD,GACF,GACF,EACApM,OAAC,MAAI,WAAU,8BAEZ,UAAAqY,IAAc,SACbrY,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAMgY,GAAgB5L,EAAK,EAAE,EACtC,UAAU,oPACV,aAAY,oBAAoBA,EAAK,KAAK,IAAI,GAE9C,UAAClP,MAAAsM,GAAA,CAAK,UAAU,cAAe,GAAE,SAEnC,EAED6O,IAAc,cACbnb,MAAC,OAAK,WAAU,4IAA4I,SAE5J,kBAEDmb,IAAc,YACZrY,OAAA,QAAK,UAAU,wIACd,UAAC9C,MAAAob,GAAA,CAAY,UAAU,cAAe,GAAE,YAE1C,EAEDD,IAAc,SACZrY,OAAA,QAAK,UAAU,gIACd,UAAC9C,MAAAsN,GAAA,CAAE,UAAU,cAAe,GAAE,SAEhC,EAEFtN,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAM+W,GAAgB7H,EAAK,EAAE,EACtC,UAAU,+DACV,aAAY,UAAUA,EAAK,KAAK,IAAI,GAEpC,SAAAlP,MAAC6M,GAAO,WAAU,SAAU,GAC9B,GACF,GACF,EAGCuC,GACCtM,EAAA,KAAC,MAAI,WAAU,OACb,UAACA,OAAA,OAAI,UAAU,4CACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,mCACb,SAAAoP,EAAS,QACZ,EACAtM,OAAC,OAAK,WAAU,4CACb,UAAK,WAAMsM,EAAS,QAAQ,EAAE,KACjC,GACF,EACApP,MAAC,MAAI,WAAU,2BACb,SAAAA,EAAA,IAAC,OACC,UAAW,6BAA6B+a,GAAiB3L,EAAS,KAAK,CAAC,GACxE,MAAO,CAAE,MAAO,GAAGA,EAAS,QAAQ,GAAI,IAE5C,GACF,IAtEMF,EAAK,EAwEf,CAEH,GACH,EAEAlP,EAAA,IAAC,SACC,IAAKgW,EACL,KAAK,OACL,UAAU,SACV,OAAO,oCACP,SAAUoB,GACV,SAAU5Z,EACV,aAAW,6CACb,GACF,GAEJ,GAEJ,EAGCe,GACEyB,MAAA,OAAI,UAAU,wFAAwF,KAAK,QAC1G,SAAA8C,EAAA,KAAC,MAAI,WAAU,oBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,4BAA4B,cAAY,OAAO,EACrErb,EAAA,YAAK,UAAU,iCAAkC,SAAMzB,EAAA,GAC1D,CACF,GAID,CAACf,GAAe4R,EAAS,QAAU,QAAU,CAAChJ,GAC7CtD,EAAA,KAAC,MAAI,WAAU,qDACb,UAAC9C,EAAA,UAAG,UAAU,2DAA2D,SAEzE,sBACA8C,OAAC,MAAI,WAAU,YACb,UAACA,OAAA,OAAI,UAAU,oCACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,2CACb,SAAAoP,EAAS,QACZ,EACAtM,OAAC,OAAK,WAAU,oDACb,UAAK,WAAMsM,EAAS,QAAQ,EAAE,KACjC,GACF,EACApP,MAAC,MAAI,WAAU,sBACb,SAAAA,EAAA,IAAC,OACC,UAAW,+CAA+C+a,GAAiB3L,EAAS,KAAK,CAAC,GAC1F,MAAO,CAAE,MAAO,GAAGA,EAAS,QAAQ,GAAI,EACxC,KAAK,cACL,aAAW,sBACX,gBAAeA,EAAS,SACxB,gBAAe,EACf,gBAAe,MAEnB,EACCA,EAAS,QAAU,aACjBtM,EAAA,YAAI,UAAU,6DACb,UAAA9C,EAAA,IAACkb,GAAQ,WAAU,4BAA4B,cAAY,OAAO,EAAE,kCAEtE,GAEJ,GACF,EAID9U,GACCtD,EAAA,KAAC,MAAI,WAAU,qDACb,UAACA,OAAA,OAAI,UAAU,yBACb,UAAA9C,EAAA,IAACob,GAAY,WAAU,8BAA8B,cAAY,OAAO,EACvEpb,EAAA,UAAG,UAAU,sDAAsD,SAEpE,sBACF,EAGCoG,EAAO,gBACLtD,OAAA,OAAI,UAAU,OACb,UAAC9C,EAAA,UAAG,UAAU,iDAAiD,SAAoB,+BAClF,MAAI,WAAU,oDACb,SAAC8C,EAAA,YAAI,UAAU,YAEb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,4DAA4D,SAAgB,qBAC1F8C,OAAC,MAAI,WAAU,gDACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAW,sBAC7D,OAAK,WAAU,0CAA2C,SAAOoG,EAAA,eAAe,4BAA8B,MAAM,GACvH,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAQ,mBAC1D,OAAK,WAAU,0CAA2C,SAAOoG,EAAA,eAAe,yBAA2B,MAAM,GACpH,EAEAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAO,YACzDA,EAAA,YAAK,UAAW,aAAaoG,EAAO,eAAe,SAAW,UAAY,qCAAuC,gCAAgC,GAC/I,SAAOA,EAAA,eAAe,QAAU,MACnC,GACF,GACF,GACF,SAGC,MACC,WAACpG,EAAA,UAAG,UAAU,4DAA4D,SAAiB,sBAC3F8C,OAAC,MAAI,WAAU,gDACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAS,oBAC3D,OAAK,WAAU,0CAA2C,SAAOoG,EAAA,eAAe,gBAAkB,MAAM,GAC3G,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAY,uBAC9D,OAAK,WAAU,0CAA2C,SAAOoG,EAAA,eAAe,mBAAqB,MAAM,GAC9G,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAW,gBAC7DA,EAAA,YAAK,UAAW,aAAaoG,EAAO,eAAe,cAAgB,qCAAuC,sCAAsC,GAC9I,SAAAA,EAAO,eAAe,cAAgB,MAAQ,KACjD,GACF,GACF,GACF,EAGCA,EAAO,eAAe,cACrBtD,EAAA,KAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,4DAA4D,SAA0B,+BACpG8C,OAAC,MAAI,WAAU,gDACZ,UAAAsD,EAAO,eAAe,aAAa,oBAAsB,QACvDtD,EAAA,YAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAkB,uBACrEA,MAAC,QAAK,UAAU,0CACb,WAAO,eAAe,aAAa,mBAAqB,KAC3D,IACF,EAEDoG,EAAO,eAAe,aAAa,iBAAmB,QACpDtD,EAAA,YAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAe,oBAClEA,MAAC,QAAK,UAAU,0CACb,WAAO,eAAe,aAAa,gBAAkB,KACxD,IACF,EAEDoG,EAAO,eAAe,aAAa,OAASA,EAAO,eAAe,aAAa,MAAM,OAAS,GAC5FtD,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAM,WACzD8C,OAAC,OAAK,WAAU,0CAA0C,cACtDsD,EAAO,eAAe,aAAa,MAAM,KAAK,IAAI,EAAE,KACxD,GACF,EAEDA,EAAO,eAAe,aAAa,OAASA,EAAO,eAAe,aAAa,MAAM,OAAS,GAC5FtD,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAM,WACzD8C,OAAC,OAAK,WAAU,0CAA0C,cACtDsD,EAAO,eAAe,aAAa,MAAM,KAAK,IAAI,EAAE,KACxD,GACF,EAEDA,EAAO,eAAe,aAAa,OAASA,EAAO,eAAe,aAAa,MAAM,OAAS,GAC5FtD,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAM,WACzD8C,OAAC,OAAK,WAAU,0CAA0C,cACtDsD,EAAO,eAAe,aAAa,MAAM,KAAK,IAAI,EAAE,KACxD,GACF,GAEJ,GACF,SAID,MACC,WAACpG,EAAA,UAAG,UAAU,4DAA4D,SAAQ,aAClF8C,OAAC,MAAI,WAAU,gDACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAQ,aAC1DA,EAAA,YAAK,UAAU,kDACb,WAAO,eAAe,WAAa,IAAI,KAAKoG,EAAO,eAAe,UAAU,EAAE,iBAAmB,MACpG,GACF,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAQ,aAC1DA,EAAA,YAAK,UAAU,kDACb,WAAO,eAAe,WAAa,IAAI,KAAKoG,EAAO,eAAe,UAAU,EAAE,iBAAmB,MACpG,GACF,GACF,GACF,SAGC,MACC,WAACpG,EAAA,UAAG,UAAU,4DAA4D,SAAmB,8BAC5F,MAAI,WAAU,gDACb,SAAC8C,EAAA,YAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAW,gBAC7DA,EAAA,YAAK,UAAU,kDACb,WAAO,UACV,GACF,CACF,IACF,EAGCoG,EAAO,eAAe,eACpBtD,EAAA,YAAI,UAAU,6DACb,UAAC9C,EAAA,UAAG,UAAU,0DAA0D,SAAgB,qBACxF8C,OAAC,MAAI,WAAU,oBACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,iCAAiC,SAAW,sBAC3D,OAAK,WAAU,2CAA4C,SAAOoG,EAAA,eAAe,cAAc,MAAM,GACxG,EACAtD,OAAC,MAAI,WAAU,iCACb,UAAC9C,EAAA,YAAK,UAAU,cAAc,SAAQ,aAAO,IAAEoG,EAAO,eAAe,cAAc,SACrF,GACF,GACF,EAIFtD,OAAC,UAAQ,WAAU,OACjB,UAAC9C,EAAA,eAAQ,UAAU,gHAAgH,SAEnI,2BACCA,MAAA,OAAI,UAAU,8DACb,eAAC,MAAI,WAAU,+DACZ,cAAK,UAAUoG,EAAO,eAAgB,KAAM,CAAC,CAChD,GACF,GACF,GACF,CACF,IACF,EAGDA,EAAO,UAAYA,EAAO,SAAS,OAAS,GAC3CtD,EAAA,KAAC,MAAI,WAAU,OACb,UAAC9C,EAAA,UAAG,UAAU,iDAAiD,SAAiB,sBAC/EA,EAAA,UAAG,UAAU,YACX,SAAOoG,EAAA,SAAS,IAAI,CAACgU,EAAS/Q,IAC5BvG,OAAA,MAAe,UAAU,2CAA2C,eAChEsX,CAAA,GADI/Q,CAET,CACD,EACH,GACF,EAGFrJ,MAAC,MAAI,WAAU,sBACb,SAAAA,EAAA,IAAC,UAAO,KAAK,SACX,QAAS0W,GACT,UAAU,oPACX,kCAGH,GACF,GAIClZ,GAAe6V,EAAW,OAAS,GAAO,CAAC7V,GAAewW,IAC5D,CAAC5N,GAAU,OAAO,KAAKsN,CAAO,EAAE,SAAW,GAC3CtE,EAAS,QAAU,QAAU,CAAC0E,GAC7B9T,MAAC,MAAI,WAAU,cACZ,SAAAxC,EAECsF,OAAC,MAAI,WAAU,YACb,UAAC9C,MAAA,OAAI,UAAU,iDACb,SAAA8C,EAAA,KAAC,UAAO,KAAK,SACX,QAASwW,GACT,SAAUjG,EAAW,SAAW,GAAK,CAACsB,EAAa,OAAO,QACjD,CAACtB,EAAW,KAAanE,GAAA0E,EAAW1E,EAAK,EAAE,IAAM,OAAO,GACxD,CAAC,CAAC3Q,GAAS,OAAO,OAAOkX,CAAgB,EAAE,KAAKsD,GAAOA,IAAQ,MAAS,EACjF,UAAU,iSAEV,UAAA/Y,EAAA,IAACsM,GAAK,WAAU,eAAe,cAAY,OAAO,EAAE,wBAEnD+G,EAAW,OAAenE,GAAA0E,EAAW1E,EAAK,EAAE,IAAM,OAAO,EAAE,OAAS,GACpE,KAAKmE,EAAW,OAAenE,GAAA0E,EAAW1E,EAAK,EAAE,IAAM,OAAO,EAAE,MAAM,OAE3E,EACClP,EAAA,SAAE,UAAU,2CAA2C,SAExD,kIACF,SAGC,MACC,WAAA8C,EAAA,KAAC,UAAO,KAAK,SACX,QAASuW,GACT,SAAU,CAACrF,GAAa,CAACW,EAAa,OAAO,KACpC,IAAC,CAACpW,GAAS,OAAO,OAAOkX,CAAgB,EAAE,KAAKsD,GAAOA,IAAQ,MAAS,EACjF,UAAU,oSAEV,UAAA/Y,EAAA,IAACsM,GAAK,WAAU,eAAe,cAAY,OAAO,EAAE,kBAEtD,EACCtM,EAAA,SAAE,UAAU,gDAAgD,SAE7D,4DACF,EAEJ,EAIDxC,GAAe,OAAO,KAAKkW,CAAO,EAAE,OAAS,GAC5C5Q,OAAC,MAAI,WAAU,qDACb,UAACA,OAAA,OAAI,UAAU,yBACb,UAAA9C,EAAA,IAACob,GAAY,WAAU,8BAA8B,cAAY,OAAO,EACxEtY,OAAC,KAAG,WAAU,sDAAsD,qCACzC,OAAO,KAAK4Q,CAAO,EAAE,OAAO,WACvD,GACF,EAEC1T,MAAA,OAAI,UAAU,YACZ,SAAO,eAAQ0T,CAAO,EAAE,IAAI,CAAC,CAACsD,EAAQ5Q,CAAM,IAAM,CACjD,MAAM4N,EAAYX,EAAW,KAAU6D,KAAE,KAAOF,CAAM,EAChD5H,EAAWoE,EAAmBwD,CAAM,EAGxC,OAAAlU,EAAA,KAAC,MAAiB,WAAU,6CAC1B,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,MAAA,MAAG,UAAU,4CACX,UAAAgU,iBAAW,KAAK,OAAQ,QAAQgD,CAAM,EACzC,GACAlU,OAAC,MAAI,WAAU,8BACZ,WAAAsM,iBAAU,SAAU,YAClBtM,EAAA,aAAK,UAAU,wIACd,UAAC9C,MAAAob,GAAA,CAAY,UAAU,cAAe,GAAE,YAE1C,GAEDhM,iBAAU,SAAU,SAClBtM,EAAA,aAAK,UAAU,gIACd,UAAC9C,MAAAsN,GAAA,CAAE,UAAU,cAAe,GAAE,SAEhC,GAEJ,GACF,GAGC8B,iBAAU,SAAU,UAAWA,iBAAU,QACxCpP,EAAA,IAAC,MAAI,WAAU,6FACb,SAAA8C,OAAC,MAAI,WAAU,mBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,iDAAiD,cAAY,OAAO,EAC3FvY,OAAC,MAAI,WAAU,SACb,UAAC9C,EAAA,UAAG,UAAU,0DAA0D,SAExE,kBACA8C,OAAC,MAAI,WAAU,YACb,UAACA,OAAA,OAAI,UAAU,gDACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,6CAA6C,SAAW,sBACvE,OAAK,WAAU,2CAA4C,SAAAoP,EAAS,MAAM,KAAK,GAClF,EACAtM,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,6CAA6C,SAAc,yBAC1E,OAAK,WAAU,sDAAuD,SAAAoP,EAAS,MAAM,QAAQ,GAChG,GACF,EACCA,EAAS,MAAM,SAAW,OAAO,KAAKA,EAAS,MAAM,OAAO,EAAE,OAAS,GACrEtM,OAAA,WAAQ,UAAU,OACjB,UAAC9C,EAAA,eAAQ,UAAU,+GAA+G,SAElI,wCACC,MAAI,WAAU,wEACb,SAAAA,EAAA,IAAC,OAAI,UAAU,6DACZ,SAAK,eAAUoP,EAAS,MAAM,QAAS,KAAM,CAAC,CACjD,GACF,GACF,GAEJ,GACF,GACF,CACF,GAIDhJ,EAAO,gBACLtD,OAAA,OAAI,UAAU,oDACb,UAACA,OAAA,OAAI,UAAU,gDAEb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAW,gBAC9DA,MAAC,QAAK,UAAU,0CACb,SAAAoG,EAAO,eAAe,4BAA8B,MACvD,GACF,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAQ,aAC3DA,MAAC,QAAK,UAAU,0CACb,SAAAoG,EAAO,eAAe,yBAA2B,MACpD,GACF,GACF,QAGC,MAAI,WAAU,0DACb,SAACtD,EAAA,YAAI,UAAU,gDACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAW,sBAC7D,OAAK,WAAU,0CAA2C,SAAAoG,EAAO,UAAU,GAC9E,EACAtD,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAO,YAC1DA,MAAC,QAAK,UAAU,0CACb,SAAAoG,EAAO,eAAe,QAAU,MACnC,GACF,GACF,CACF,GAGAtD,OAAC,UAAQ,WAAU,0DACjB,UAAC9C,EAAA,eAAQ,UAAU,gHAAgH,SAEnI,2BACCA,MAAA,OAAI,UAAU,uEACb,eAAC,MAAI,WAAU,+DACZ,cAAK,UAAUoG,EAAO,eAAgB,KAAM,CAAC,CAChD,GACF,GACF,GACF,EAID4N,GACClR,EAAA,KAAC,MAAI,WAAU,kDACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAM,CACb,MAAM6W,EAAQ,SAAS,eAAe,SAASG,CAAM,EAAE,EACnDH,EAAM,QAER,SAAS,iBAAiB,OAAO,EAAE,QAAapI,KAAE,OAAO,EACzDgG,EAAiBuC,CAAM,EACvBH,EAAM,KAAK,IAEXA,EAAM,MAAM,EACZpC,EAAiB,IAAI,EAEzB,EACA,UAAU,oKACV,aAAYD,IAAkBwC,EAAS,cAAgB,aAEtD,SAAAxC,IAAkBwC,EACjBhX,MAACoM,GAAM,WAAU,SAAU,GAE3BpM,MAACsM,GAAK,WAAU,SAAU,GAE9B,EACAxJ,OAAC,OAAK,WAAU,2CACb,UAAAkR,EAAU,KAAK,KAAK,MAAIA,EAAU,SAAW,GAAG,KAAK,MAAMA,EAAU,QAAQ,CAAC,IAAM,oBACvF,GACF,EACAhU,EAAA,IAAC,SACC,GAAI,SAASgX,CAAM,GACnB,IAAKhD,EAAU,IACf,QAAS,IAAMS,EAAiB,IAAI,EACpC,UAAU,SACZ,GACF,IAhJMuC,CAkJV,CAEH,GACH,GACF,EAIDzB,EAAO,OAAS,GACdvV,EAAA,WAAI,UAAU,qCACZ,SAAAuV,EAAO,IAAKe,GACXtW,EAAA,IAAC,OAEC,UAAW,uHACTsW,EAAM,OAAS,QAAU,iBACzBA,EAAM,OAAS,UAAY,oBAC3BA,EAAM,OAAS,UAAY,mBAAqB,iBAClD,GACA,KAAK,QAEL,SAAAxT,EAAA,KAAC,MAAI,WAAU,mBACb,UAACA,OAAA,OAAI,UAAU,gBACZ,UAAAwT,EAAM,OAAS,SACdtW,MAACqb,IAAY,UAAU,uBAAuB,cAAY,OAAO,EAElE/E,EAAM,OAAS,WACdtW,MAACqb,IAAY,UAAU,0BAA0B,cAAY,OAAO,EAErE/E,EAAM,OAAS,WACdtW,MAACob,IAAY,UAAU,yBAAyB,cAAY,OAAO,EAEpE9E,EAAM,OAAS,QACdtW,MAACqb,IAAY,UAAU,wBAAwB,cAAY,OAAO,GAEtE,EACAvY,OAAC,MAAI,WAAU,cACb,UAAA9C,EAAA,IAAC,IAAE,WAAU,oDACV,SAAAsW,EAAM,MACT,EACCtW,EAAA,SAAE,UAAU,gDACV,WAAM,QACT,GACF,EACAA,MAAC,MAAI,WAAU,qBACb,SAAAA,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAMuW,GAAYD,EAAM,EAAE,EACnC,UAAU,6HACV,aAAW,qBAEX,SAAAtW,MAACsN,GAAE,WAAU,SAAU,KAE3B,GACF,GAxCKgJ,EAAM,EA0Cd,GACH,CAEJ,GAEJ,ECl2EMgF,GAAe,CACnB,OAAQ,CAAE,MAAO,SAAU,KAAMjQ,GAAO,MAAO,QAAS,EACxD,QAAS,CAAE,MAAO,OAAQ,KAAMmB,GAAW,MAAO,YAAa,EAC/D,WAAY,CAAE,MAAO,OAAQ,KAAMA,GAAW,MAAO,YAAa,EAClE,UAAW,CAAE,MAAO,QAAS,KAAM4O,GAAa,MAAO,WAAY,EACnE,QAAS,CAAE,MAAO,QAAS,KAAMA,GAAa,MAAO,WAAY,EACjE,UAAW,CAAE,MAAO,QAAS,KAAMA,GAAa,MAAO,WAAY,EACnE,OAAQ,CAAE,MAAO,MAAO,KAAMG,GAAS,MAAO,QAAS,EACvD,MAAO,CAAE,MAAO,MAAO,KAAMA,GAAS,MAAO,OAAQ,CACvD,EAGMC,GAAuBC,GACtBA,EACEA,EACJ,QAAQ,KAAM,GAAG,EACjB,QAAQ,QAAUC,GAAcA,EAAE,YAAa,GAH5B,IAOlBC,GAAoBF,GAA8B,CACtD,GAAI,CAACA,EAAiB,SACd,OAAAA,EAAS,YAAe,GAE9B,IAAK,aACI,SACT,IAAK,mBACI,SACT,IAAK,qBACI,SAET,IAAK,gBACI,SACT,IAAK,WACI,SACT,IAAK,oBACI,SACT,IAAK,SACI,SACT,QACS,QACX,CACF,EAEMG,GAAqB,IAAM,CACzB,MAAE,KAAAjY,GAASxB,KACX8B,EAAWC,KACX,CAAC2X,EAAUC,CAAW,EAAIvc,EAAA,SAA0B,CAAE,GACtD,CAACwc,EAASC,CAAU,EAAIzc,WAAS,EAAI,EACrC,CAAChB,EAAO+W,CAAQ,EAAI/V,WAA0B,IAAI,EAClD,CAAC0c,EAAkBC,CAAmB,EAAI3c,WAAsB,IAAI,GAAK,EACzE,CAAC4c,EAAaC,CAAc,EAAI7c,WAAS,EAAK,EAC9C,CAAC8c,EAASC,CAAU,EAAI/c,WAAyB,CACrD,OAAQ,GACR,OAAQ,MACR,UAAW,MACX,OAAQ,OACR,UAAW,OACZ,EAEK,CAAE,uBAAAf,GAA2BqT,KAG7B/D,EAAyBrH,cAAY,KAElC9C,GAAA,YAAAA,EAAM,KAAM5G,KAClB,CAAC4G,GAAA,YAAAA,EAAM,EAAE,CAAC,EAGP4Y,EAAe9V,cAAY,SAAY,CACvC,IACFuV,EAAW,EAAI,EACf1G,EAAS,IAAI,EAEb,MAAMtY,EAAS8Q,IAIT0O,GAHW,MAAM9W,GAAW,gBAAgB1I,CAAM,GAGF,SAAS,IAAe2R,GAAA,SAE5E,MAAM8N,EAAa9N,EAAQ,WACrB+N,EAAkB/N,EAAQ,gBAEzB,OACL,GAAGA,EACH,WAAYA,EAAQ,UACpB,SAAUA,EAAQ,eAAiB,SAASA,EAAQ,UAAU,MAAM,EAAE,CAAC,OACvE,SAAU,KAAK,MAAM,KAAK,OAAO,EAAI,GAAO,EAAI,IAChD,WAAW+N,GAAA,YAAAA,EAAiB,YAAa,UAEzC,kBAAiB9N,EAAA8N,GAAA,YAAAA,EAAiB,kBAAjB,YAAA9N,EAAkC,cACnC6N,GAAA,YAAAA,EAAY,8BACZA,GAAA,YAAAA,EAAY,2BACZ,OAChB,eAAc5N,EAAA6N,GAAA,YAAAA,EAAiB,eAAjB,YAAA7N,EAA+B,cAChC4N,GAAA,YAAAA,EAAY,2BACZA,GAAA,YAAAA,EAAY,wBACZ,OACf,CACD,EAEDX,EAAYU,CAAmB,EACRhe,EAAA,GAAGge,EAAoB,MAAM,+BAA+B,QAC5EzD,EAAK,CACZ,MAAM4D,EAAW5D,EACjBzD,EAASqH,CAAQ,EACMne,EAAA,2BAA2Bme,EAAS,OAAO,EAAE,SACpE,CACAX,EAAW,EAAK,CAClB,GACC,CAACxd,CAAsB,CAAC,EAG3BmB,YAAU,IAAM,CACD4c,GAAA,EACZ,CAACA,CAAY,CAAC,EAGX,MAAAK,EAA4BC,UAAQ,IAAM,CAC9C,IAAIC,EAAWjB,EAGf,GAAIQ,EAAQ,OAAQ,CACZ,MAAAU,EAAcV,EAAQ,OAAO,YAAY,EAC/CS,EAAWA,EAAS,OAAOnO,GAAA,SACzB,OAAAA,EAAQ,UAAU,cAAc,SAASoO,CAAW,KACpDnO,EAAAD,EAAQ,WAAR,YAAAC,EAAkB,cAAc,SAASmO,OACzCzB,KAAa3M,EAAQ,MAAmC,IAAxD2M,cAA2D,MAAM,cAAc,SAASyB,IAAW,CAEvG,CAQI,GALAV,EAAQ,SAAW,QACrBS,EAAWA,EAAS,OAAOnO,GAAWA,EAAQ,SAAW0N,EAAQ,MAAM,GAIrEA,EAAQ,YAAc,MAAO,CACzB,MAAA1e,MAAU,KACVqf,MAAgB,KAEtB,OAAQX,EAAQ,UAAW,CACzB,IAAK,QACHW,EAAU,SAAS,EAAG,EAAG,EAAG,CAAC,EAC7B,MACF,IAAK,OACHA,EAAU,QAAQrf,EAAI,QAAQ,EAAI,CAAC,EACnC,MACF,IAAK,QACHqf,EAAU,SAASrf,EAAI,SAAS,EAAI,CAAC,EACrC,MACF,IAAK,OACHqf,EAAU,YAAYrf,EAAI,YAAY,EAAI,CAAC,EAC3C,KACJ,CAEAmf,EAAWA,EAAS,OAClBnO,GAAA,IAAI,KAAKA,EAAQ,UAAU,GAAKqO,CAAA,CAEpC,CAGS,OAAAF,EAAA,KAAK,CAACrO,EAAGC,IAAM,CACtB,IAAIuO,EAAa,EAEjB,OAAQZ,EAAQ,OAAQ,CACtB,IAAK,OACHY,EAAa,IAAI,KAAKxO,EAAE,UAAU,EAAE,UAAY,IAAI,KAAKC,EAAE,UAAU,EAAE,QAAQ,EAC/E,MACF,IAAK,SACHuO,EAAaxO,EAAE,OAAO,cAAcC,EAAE,MAAM,EAC5C,MACF,IAAK,kBACG,MAAAwO,EAAcvB,GAAiBlN,EAAE,eAAe,EAChD0O,EAAcxB,GAAiBjN,EAAE,eAAe,EACtDuO,EAAaC,EAAcC,EAC3B,MACF,IAAK,eACG,MAAAC,EAAWzB,GAAiBlN,EAAE,YAAY,EAC1C4O,EAAW1B,GAAiBjN,EAAE,YAAY,EAChDuO,EAAaG,EAAWC,EACxB,KACJ,CAEA,OAAOhB,EAAQ,YAAc,OAAS,CAACY,EAAaA,CAAA,CACrD,EAEMH,CAAA,EACN,CAACjB,EAAUQ,CAAO,CAAC,EAGhBiB,EAAe7W,cAAY,CAAC8W,EAA2Bxd,IAAe,CAC/Duc,EAAAxG,IAAS,CAAE,GAAGA,EAAM,CAACyH,CAAG,EAAGxd,CAAQ,IAC9CvB,EAAuB,UAAU+e,CAAG,eAAexd,CAAK,EAAE,GACzD,CAACvB,CAAsB,CAAC,EAGrBgf,EAAyB/W,cAAab,GAAsB,CAChEsW,EAA4BpG,GAAA,CACpB,MAAA2H,EAAe,IAAI,IAAI3H,CAAI,EAC7B,OAAA2H,EAAa,IAAI7X,CAAS,GAC5B6X,EAAa,OAAO7X,CAAS,EAC7BpH,EAAuB,oBAAoB,IAE3Cif,EAAa,IAAI7X,CAAS,EAC1BpH,EAAuB,kBAAkB,GAEpCif,CAAA,CACR,GACA,CAACjf,CAAsB,CAAC,EAGrBkf,EAAkBjX,cAAY,IAAM,CACpBwV,EAAiB,OAASW,EAA0B,QAElDV,EAAA,IAAI,GAAK,EAC7B1d,EAAuB,yBAAyB,IAE5B0d,EAAA,IAAI,IAAIU,EAA0B,OAASe,EAAE,SAAS,CAAC,CAAC,EACrDnf,EAAA,OAAOoe,EAA0B,MAAM,oBAAoB,IAEnF,CAACX,EAAiB,KAAMW,EAA2Bpe,CAAsB,CAAC,EAGvEof,EAAsBnX,cAAY,MAAOb,GAAsB,CAEnE,GADkB,OAAO,QAAQ,6EAA6E,EAG1G,IACI,MAAAF,GAAW,kBAAkBE,CAAS,EAG5CkW,KAAoBhG,EAAK,UAAkBnH,EAAQ,YAAc/I,CAAS,CAAC,EAG3EsW,EAA4BpG,GAAA,CACpB,MAAA2H,EAAe,IAAI,IAAI3H,CAAI,EACjC,OAAA2H,EAAa,OAAO7X,CAAS,EACtB6X,CAAA,CACR,EAEDjf,EAAuB,8BAA8B,QAC9Cua,EAAK,CACZ,MAAM4D,EAAW5D,EACMva,EAAA,2BAA2Bme,EAAS,OAAO,EAAE,EAE9D,mCAA6BA,EAAS,OAAO,EAAE,CACvD,GACC,CAACne,CAAsB,CAAC,EAGrBqf,EAAqBpX,cAAY,MAAOb,GAAsB,CAElE,GADkB,OAAO,QAAQ,4IAA4I,EAGzK,IAEF,MAAM+I,EAAUkN,EAAS,KAAU8B,KAAE,YAAc/X,CAAS,EAC5D,GAAI,CAAC+I,EAAS,CACZnQ,EAAuB,2CAA2C,EAClE,MAAM,2CAA2C,EACjD,MACF,CAEAA,EAAuB,0CAA0C,EAGjEyF,EAAS,UAAW,CAClB,MAAO,CACL,kBAAmB0K,EAAQ,UAC3B,cAAeA,EAAQ,cACvB,SAAUA,EAAQ,SAClB,aAAcA,EAAQ,YACxB,EACD,QACMoK,EAAK,CACZ,MAAM4D,EAAW5D,EACMva,EAAA,2BAA2Bme,EAAS,OAAO,EAAE,EAC9D,mCAA6BA,EAAS,OAAO,EAAE,CACvD,CACC,GAACne,EAAwBqd,EAAU5X,CAAQ,CAAC,EAGzC6Z,EAAmBrX,cAAY,SAAY,CAI/C,GAHIwV,EAAiB,OAAS,GAG1B,CADc,OAAO,QAAQ,mCAAmCA,EAAiB,IAAI,4CAA4C,EACrH,OAEV,MAAA8B,EAAa,MAAM,KAAK9B,CAAgB,EAC9C,IAAI+B,EAAe,EACfC,EAA2B,GAG/B,UAAWrY,KAAamY,EAClB,IACI,MAAArY,GAAW,kBAAkBE,CAAS,EAC5CoY,UACOjF,EAAK,CACZ,MAAM4D,EAAW5D,EACjBkF,EAAe,KAAKrY,CAAS,EAC7B,QAAQ,MAAM,4BAA4BA,CAAS,IAAK+W,EAAS,OAAO,CAC1E,CAeE,GAXAqB,EAAe,GACLlC,EAAAhG,GAAQA,EAAK,OAAkBnH,GAElC,EADYsN,EAAiB,IAAItN,EAAQ,SAAS,GAAK,CAACsP,EAAe,SAAStP,EAAQ,SAAS,EAEzG,CAAC,EAIgBuN,EAAA,IAAI,GAAK,EAGzB+B,EAAe,SAAW,EACLzf,EAAA,GAAGwf,CAAY,gCAAgC,MACjE,CACL,MAAM5f,EAAU,GAAG4f,CAAY,mCAAmCC,EAAe,MAAM,UACvFzf,EAAuBJ,CAAO,EAC9B,MAAM,GAAGA,CAAO,sBAAsB6f,EAAe,KAAK,IAAI,CAAC,EAAE,CACnE,GACC,CAAChC,EAAkBzd,CAAsB,CAAC,EAGvC0f,EAAkBC,GAAkB,CACxC,GAAIA,IAAU,EAAU,YACxB,MAAMC,EAAI,KACJC,EAAQ,CAAC,IAAK,KAAM,KAAM,IAAI,EAC9BpiB,EAAI,KAAK,MAAM,KAAK,IAAIkiB,CAAK,EAAI,KAAK,IAAIC,CAAC,CAAC,EAClD,MAAO,GAAG,YAAYD,EAAQ,KAAK,IAAIC,EAAGniB,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAIoiB,EAAMpiB,CAAC,CAAC,IAIjEqiB,EAA4C,CAAC,CAAE,OAAAC,KAAa,CAE1D,MAAAC,EAAmBD,EAAO,cAC5B,IAAA5hB,EAAS2e,GAAaiD,CAAmC,EAExD5hB,IACC6hB,EAAiB,SAAS,OAAO,GAAKA,EAAiB,SAAS,MAAM,EACxE7hB,EAAS2e,GAAa,MAGtB3e,EAAS2e,GAAa,QAI1B,MAAM5R,EAAO/M,EAAO,KAGlB,OAAAmG,EAAA,KAAC,QACC,UAAW,2EACTnG,EAAO,QAAU,QAAU,oEAC3BA,EAAO,QAAU,OAAS,gEAC1BA,EAAO,QAAU,SAAW,wEAC5B,2DACF,GACA,KAAK,SACL,aAAY,WAAWA,EAAO,KAAK,GAEnC,UAAAqD,EAAA,IAAC0J,EAAK,WAAU,eAAe,cAAY,OAAO,EACjD/M,EAAO,QACV,EAIJ,OAAIof,QAEC,MAAI,WAAU,wBACb,SAACjZ,EAAA,YAAI,UAAU,yCACb,UAAA9C,EAAA,IAACwM,GAAU,WAAU,0CAA0C,cAAY,OAAO,EACjFxM,EAAA,YAAK,UAAU,wCAAwC,SAAmB,wBAC7E,EACF,GAIAzB,EAEAyB,MAAC,MAAI,WAAU,wBACb,SAAAA,MAAC,MAAI,WAAU,wFACb,SAAA8C,EAAA,KAAC,MAAI,WAAU,oBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,4BAA4B,cAAY,OAAO,SACrE,MACC,WAACrb,EAAA,UAAG,UAAU,qDAAqD,SAEnE,2BACCA,EAAA,SAAE,UAAU,sCAAuC,WAAM,QAAQ,EAClEA,EAAA,IAAC,UAAO,KAAK,SACX,QAASuc,EACT,UAAU,wBACV,aAAW,yBACZ,qBAED,GACF,GACF,EACF,CACF,GAKFzZ,EAAA,KAAC,MAAI,WAAU,kCAEb,UAACA,OAAA,OAAI,UAAU,qEACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,mDAAmD,SAEjE,sBACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,kDACF,EAEA8C,OAAC,MAAI,WAAU,0BACb,UAAAA,EAAA,KAAC,UAAO,KAAK,SACX,QAASyZ,EACT,SAAUR,EACV,UAAU,qBACV,aAAW,wBAEX,UAAC/b,MAAAwM,GAAA,CAAU,UAAW,gBAAgBuP,EAAU,eAAiB,EAAE,GAAI,cAAY,MAAO,GAAE,WAE9F,EAEA/b,EAAA,IAACmI,GAAA,CACC,GAAG,UACH,UAAU,mBACV,aAAW,6BACZ,wBAED,GACF,GACF,EAGArF,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,OAAI,UAAU,kDAEb,UAACA,OAAA,OAAI,UAAU,iBACb,UAAA9C,MAAC,QAAM,SAAQ,kBAAkB,UAAU,UAAU,SAErD,oBACA8C,OAAC,MAAI,WAAU,WACb,UAAA9C,EAAA,IAACyM,GAAO,WAAU,2EAA2E,cAAY,OAAO,EAChHzM,EAAA,IAAC,SACC,GAAG,kBACH,KAAK,OACL,YAAY,+CACZ,MAAOqc,EAAQ,OACf,SAAWvc,GAAMwd,EAAa,SAAUxd,EAAE,OAAO,KAAK,EACtD,UAAU,qCACV,mBAAiB,cACnB,GACF,QACC,IAAE,IAAG,cAAc,UAAU,UAAU,SAExC,sEACF,EAGAgD,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAMsZ,EAAe,CAACD,CAAW,EAC1C,UAAU,uCACV,gBAAeA,EACf,gBAAc,eACd,aAAY,GAAGA,EAAc,OAAS,MAAM,kBAE5C,UAAAnc,EAAA,IAACye,GAAO,WAAU,eAAe,cAAY,OAAO,EAAE,UAErDtC,EAAcnc,EAAA,IAACiL,GAAU,WAAU,eAAe,cAAY,MAAO,GAAMjL,EAAA,IAAAgL,GAAA,CAAY,UAAU,eAAe,cAAY,OAAO,GACtI,GACF,EAGCmR,GACErZ,OAAA,OAAI,GAAG,eAAe,UAAU,4DAE/B,UAAAA,OAAC,MACC,WAAA9C,MAAC,QAAM,SAAQ,gBAAgB,UAAU,kEAAkE,SAE3G,WACA8C,EAAA,KAAC,UACC,GAAG,gBACH,MAAOuZ,EAAQ,OACf,SAAWvc,GAAMwd,EAAa,SAAUxd,EAAE,OAAO,KAAK,EACtD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,MAAM,SAAY,iBAC/BA,EAAA,cAAO,MAAM,SAAS,SAAM,WAC5BA,EAAA,cAAO,MAAM,aAAa,SAAU,eACpCA,EAAA,cAAO,MAAM,UAAU,SAAO,YAC9BA,EAAA,cAAO,MAAM,YAAY,SAAS,cAClCA,EAAA,cAAO,MAAM,UAAU,SAAO,YAC9BA,EAAA,cAAO,MAAM,YAAY,SAAS,cAClCA,EAAA,cAAO,MAAM,SAAS,SAAM,YAC/B,GACF,SAGC,MACC,WAAAA,MAAC,QAAM,SAAQ,cAAc,UAAU,kEAAkE,SAEzG,eACA8C,EAAA,KAAC,UACC,GAAG,cACH,MAAOuZ,EAAQ,UACf,SAAWvc,GAAMwd,EAAa,YAAaxd,EAAE,OAAO,KAAK,EACzD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,MAAM,SAAQ,aAC3BA,EAAA,cAAO,MAAM,QAAQ,SAAK,UAC1BA,EAAA,cAAO,MAAM,OAAO,SAAS,cAC7BA,EAAA,cAAO,MAAM,QAAQ,SAAU,eAC/BA,EAAA,cAAO,MAAM,OAAO,SAAS,eAChC,GACF,SAGC,MACC,WAAAA,MAAC,QAAM,SAAQ,UAAU,UAAU,kEAAkE,SAErG,YACA8C,EAAA,KAAC,UACC,GAAG,UACH,MAAOuZ,EAAQ,OACf,SAAWvc,GAAMwd,EAAa,SAAUxd,EAAE,OAAO,KAAK,EACtD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,OAAO,SAAI,SACxBA,EAAA,cAAO,MAAM,SAAS,SAAM,WAC5BA,EAAA,cAAO,MAAM,kBAAkB,SAAgB,qBAC/CA,EAAA,cAAO,MAAM,eAAe,SAAa,mBAC5C,GACF,SAGC,MACC,WAAAA,MAAC,QAAM,SAAQ,aAAa,UAAU,kEAAkE,SAExG,eACA8C,EAAA,KAAC,UACC,GAAG,aACH,MAAOuZ,EAAQ,UACf,SAAWvc,GAAMwd,EAAa,YAAaxd,EAAE,OAAO,KAAK,EACzD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,OAAO,SAAY,iBAChCA,EAAA,cAAO,MAAM,MAAM,SAAY,kBAClC,GACF,GACF,GAEJ,EAGC4c,EAA0B,OAAS,GACjC9Z,EAAA,YAAI,UAAU,mHACb,UAAA9C,MAAC,OAAI,UAAU,0BACb,SAAC8C,EAAA,UAAE,UAAU,2CACV,UAA0B8Z,EAAA,OAAO,OAAKf,EAAS,OAAO,YACtDI,EAAiB,KAAO,GAAK,MAAMA,EAAiB,IAAI,aAC3D,CACF,GAECA,EAAiB,KAAO,GACtBjc,EAAA,WAAI,UAAU,0BACb,SAAA8C,EAAA,KAAC,UAAO,KAAK,SACX,QAASgb,EACT,UAAU,kBACV,aAAY,UAAU7B,EAAiB,IAAI,qBAE3C,UAAAjc,EAAA,IAAC6M,GAAO,WAAU,eAAe,cAAY,OAAO,EAAE,qBAG1D,GAEJ,EAID+P,EAA0B,OAAS,EACjC9Z,EAAA,YAAI,UAAU,mGAEb,UAAC9C,EAAA,WAAI,UAAU,kCACb,SAAC8C,OAAA,SAAM,UAAU,SAAS,KAAK,QAAQ,aAAW,oBAChD,UAAA9C,MAAC,QAAM,WAAU,8BACf,SAAA8C,EAAA,KAAC,KACC,WAAC9C,MAAA,MAAG,UAAU,sBACZ,SAAAA,EAAA,IAAC,SACC,KAAK,WACL,QAASic,EAAiB,OAASW,EAA0B,OAC7D,SAAUc,EACV,UAAU,4DACV,aAAW,wBAEf,EACC1d,EAAA,UAAG,UAAU,oGAAoG,SAElH,YACCA,EAAA,UAAG,UAAU,oGAAoG,SAElH,WACCA,EAAA,UAAG,UAAU,oGAAoG,SAElH,qBACCA,EAAA,UAAG,UAAU,oGAAoG,SAElH,kBACCA,EAAA,UAAG,UAAU,oGAAoG,SAElH,SACCA,EAAA,UAAG,UAAU,qGAAqG,SAEnH,aACF,CACF,SACC,QAAM,WAAU,gDACd,SAA0B4c,EAAA,IAAKjO,GAC9B7L,EAAA,KAAC,MAEC,UAAU,+DAEV,UAAC9C,MAAA,MAAG,UAAU,YACZ,SAAAA,EAAA,IAAC,SACC,KAAK,WACL,QAASic,EAAiB,IAAItN,EAAQ,SAAS,EAC/C,SAAU,IAAM6O,EAAuB7O,EAAQ,SAAS,EACxD,UAAU,4DACV,aAAY,kBAAkBA,EAAQ,SAAS,KAEnD,EACC3O,MAAA,MAAG,UAAU,YACZ,gBAAC,MACC,WAAAA,EAAA,IAAC,MAAI,WAAU,oDACZ,SAAA2O,EAAQ,SACX,EACA7L,OAAC,MAAI,WAAU,2CAA2C,iBACnD6L,EAAQ,UAAU,MAAM,GAAG,GAClC,EACA3O,MAAC,OAAI,UAAU,2CACZ,WAAe2O,EAAQ,UAAY,CAAC,EACvC,GACF,CACF,GACA3O,MAAC,MAAG,UAAU,YACZ,eAACse,EAAY,QAAQ3P,EAAQ,OAAQ,CACvC,GACA3O,EAAA,IAAC,KAAG,WAAU,YACZ,SAAAA,MAAC,OAAI,UAAU,UACZ,SAAQ2O,EAAA,gBACN3O,EAAA,YAAK,UAAU,4CACb,SAAAwb,GAAoB7M,EAAQ,eAAe,CAC9C,GAEC3O,EAAA,YAAK,UAAU,mCAAmC,SAAC,KAExD,GACF,EACAA,EAAA,IAAC,KAAG,WAAU,YACZ,SAAAA,MAAC,OAAI,UAAU,UACZ,SAAQ2O,EAAA,aACN3O,EAAA,YAAK,UAAU,4CACb,SAAAwb,GAAoB7M,EAAQ,YAAY,CAC3C,GAEC3O,EAAA,YAAK,UAAU,mCAAmC,SAAC,KAExD,GACF,EACA8C,OAAC,KAAG,WAAU,YACZ,UAAA9C,MAAC,OAAI,UAAU,wCACZ,SAAmBvC,GAAAkR,EAAQ,UAAU,EACxC,QACC,MAAI,WAAU,2CACZ,SAAe1Q,GAAA0Q,EAAQ,UAAU,EACpC,GACF,QACC,KAAG,WAAU,uBACZ,SAAC7L,EAAA,YAAI,UAAU,sCACb,UAAA9C,EAAA,IAACmI,GAAA,CACC,GAAI,aAAawG,EAAQ,SAAS,GAClC,UAAU,gFACV,aAAY,4BAA4BA,EAAQ,SAAS,GAEzD,SAAC3O,EAAA,IAAAwL,GAAA,CAAI,UAAU,UAAU,cAAY,OAAO,EAC9C,EACCmD,EAAQ,SAAW,aAClB3O,EAAA,IAAC,UAAO,KAAK,SACX,UAAU,gFACV,aAAY,gCAAgC2O,EAAQ,SAAS,GAE7D,SAAC3O,EAAA,IAAAsL,GAAA,CAAS,UAAU,UAAU,cAAY,OAAO,EACnD,EAEFtL,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAM6d,EAAmBlP,EAAQ,SAAS,EACnD,UAAU,gFACV,aAAY,+BAA+BA,EAAQ,SAAS,GAE5D,SAAC3O,EAAA,IAAAwM,GAAA,CAAU,UAAU,UAAU,cAAY,OAAO,EACpD,EACAxM,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAM4d,EAAoBjP,EAAQ,SAAS,EACpD,UAAU,4EACV,aAAY,kBAAkBA,EAAQ,SAAS,GAE/C,SAAC3O,EAAA,IAAA6M,GAAA,CAAO,UAAU,UAAU,cAAY,OAAO,EACjD,GACF,CACF,KA1FK8B,EAAQ,SA4FhB,GACH,GACF,CACF,SAGC,MAAI,WAAU,0BACZ,SAA0BiO,EAAA,IAAKjO,GAC9B7L,EAAA,KAAC,OAEC,UAAU,uEAEV,UAACA,OAAA,OAAI,UAAU,mCACb,UAACA,OAAA,OAAI,UAAU,6BACb,UAAA9C,EAAA,IAAC,SACC,KAAK,WACL,QAASic,EAAiB,IAAItN,EAAQ,SAAS,EAC/C,SAAU,IAAM6O,EAAuB7O,EAAQ,SAAS,EACxD,UAAU,iEACV,aAAY,kBAAkBA,EAAQ,SAAS,GACjD,SACC,MACC,WAAA3O,EAAA,IAAC,KAAG,WAAU,oDACX,SAAA2O,EAAQ,SACX,EACA7L,OAAC,IAAE,WAAU,2CAA2C,iBACjD6L,EAAQ,UAAU,MAAM,GAAG,GAClC,GACF,GACF,EACC3O,MAAAse,EAAA,CAAY,OAAQ3P,EAAQ,MAAQ,IACvC,GAEEA,EAAQ,iBAAmBA,EAAQ,eAClC7L,OAAA,OAAI,UAAU,UACZ,UAAQ6L,EAAA,wBACN,MAAI,0BAAa6M,GAAoB7M,EAAQ,eAAe,GAAE,EAEhEA,EAAQ,cACP7L,OAAC,MAAI,uBAAU0Y,GAAoB7M,EAAQ,YAAY,GAAE,GAE7D,EAGF7L,OAAC,MAAI,WAAU,6EACb,UAAA9C,EAAA,IAAC,OAAM,UAAAvC,GAAmBkR,EAAQ,UAAU,EAAE,QAC7C,OAAM,UAAAuP,EAAevP,EAAQ,UAAY,CAAC,EAAE,GAC/C,EAEA7L,OAAC,MAAI,WAAU,yFACb,UAAAA,EAAA,KAACqF,GAAA,CACC,GAAI,aAAawG,EAAQ,SAAS,GAClC,UAAU,6BACV,aAAY,4BAA4BA,EAAQ,SAAS,GAEzD,UAAA3O,EAAA,IAACwL,GAAI,WAAU,eAAe,cAAY,OAAO,EAAE,QAErD,EACCmD,EAAQ,SAAW,aAClB7L,EAAA,KAAC,UAAO,KAAK,SACX,UAAU,6BACV,aAAY,gCAAgC6L,EAAQ,SAAS,GAE7D,UAAA3O,EAAA,IAACsL,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,YAE1D,EAEFxI,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAM+a,EAAmBlP,EAAQ,SAAS,EACnD,UAAU,6BACV,aAAY,+BAA+BA,EAAQ,SAAS,GAE5D,UAAA3O,EAAA,IAACwM,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,UAE3D,EACA1J,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAM8a,EAAoBjP,EAAQ,SAAS,EACpD,UAAU,0BACV,aAAY,kBAAkBA,EAAQ,SAAS,GAE/C,UAAA3O,EAAA,IAAC6M,GAAO,WAAU,eAAe,cAAY,OAAO,EAAE,UAExD,GACF,IA1EK8B,EAAQ,SA4EhB,GACH,EACF,GAEA7L,OAAC,MAAI,WAAU,qGACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,uCAAuC,cAAY,OAAO,EAChFrb,EAAA,UAAG,UAAU,yDAAyD,SAEvE,sBACAA,MAAC,KAAE,UAAU,wCACV,WAAS,SAAW,EACjB,iDACA,yCAEN,GACC6b,EAAS,SAAW,EAClB7b,EAAA,IAAAmI,GAAA,CAAK,GAAG,UAAU,UAAU,mBAAmB,qCAEhD,EAEAnI,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAMsc,EAAW,CACxB,OAAQ,GACR,OAAQ,MACR,UAAW,MACX,OAAQ,OACR,UAAW,OACZ,EACD,UAAU,qBACX,yBAED,GAEJ,CAEJ,GAEJ,ECz0BMoC,GAAkB,CACtB,IAAK,CACH,MAAO,QACP,MAAO,WACP,KAAMtD,GACN,YAAa,sCACf,EACA,SAAU,CACR,MAAO,SACP,MAAO,gBACP,KAAMuD,GACN,YAAa,sCACf,EACA,KAAM,CACJ,MAAO,MACP,MAAO,YACP,KAAMhS,GACN,YAAa,oDACf,EACA,SAAU,CACR,MAAO,MACP,MAAO,gBACP,KAAMA,GACN,YAAa,8BACf,CACF,EAEMiS,GAAyD,CAAC,CAC9D,UAAAhZ,EACA,mBAAAiZ,EACA,oBAAAC,CACF,IAAM,CACE,MAAE,uBAAAtgB,GAA2BqT,KAC7B,CAACkN,EAAYC,CAAa,EAAIzf,WAAgCsf,GAAsB,IAAI,EACxF,CAACI,EAAcC,CAAe,EAAI3f,WAAS,EAAK,EAChD,CAACqD,EAAWuc,CAAY,EAAI5f,WAAS,EAAK,EAC1C,CAAChB,EAAO+W,CAAQ,EAAI/V,WAA0B,IAAI,EAGlD6f,EAAqB3Y,cAAY,SAAY,CAC7C,IACFyY,EAAgB,EAAI,EACpB5J,EAAS,IAAI,EACb9W,EAAuB,kCAAkC,EAEzD,MAAMuG,EAAW,MAAMW,GAAW,uBAAuBE,CAAS,EAE9D,GAAAb,EAAS,SAAWA,EAAS,eAC/Bia,EAAcja,EAAS,cAAc,EACrC+Z,GAAA,MAAAA,EAAsB/Z,EAAS,gBAC/BvG,EAAuB,wCAAwC,MAE/D,OAAM,IAAI,MAAMuG,EAAS,SAAW,oCAAoC,QAEnEgU,EAAK,CACZ,MAAM4D,EAAW5D,EACjBzD,EAASqH,CAAQ,EACMne,EAAA,gCAAgCme,EAAS,OAAO,EAAE,SACzE,CACAuC,EAAgB,EAAK,CACvB,CACC,GAACtZ,EAAWkZ,EAAqBtgB,CAAsB,CAAC,EAGrD6gB,EAAiB5Y,cAAY,SAAY,CACzC,IACF0Y,EAAa,EAAI,EACjB7J,EAAS,IAAI,EAEb,MAAMvQ,EAAW,MAAMW,GAAW,kBAAkBE,CAAS,EAEzDb,EAAS,SAAWA,EAAS,iBAC/Bia,EAAcja,EAAS,cAAc,EACrC+Z,GAAA,MAAAA,EAAsB/Z,EAAS,uBAE1BgU,EAAK,CAEZzD,EADiByD,CACA,SACjB,CACAoG,EAAa,EAAK,CACpB,GACC,CAACvZ,EAAWkZ,CAAmB,CAAC,EAG7BQ,EAAsE,CAAC,CAAE,UAAAC,EAAW,UAAAC,KAAgB,CACxG,MAAM7iB,EAAS+hB,GAAgBa,EAAU,YAA6C,GACtF,GAAI,CAAC5iB,EAAe,YAEpB,MAAM+M,EAAO/M,EAAO,KAGlB,OAAAmG,EAAA,KAAC,MAAI,WAAU,8BACb,UAAAA,EAAA,KAAC,QACC,UAAW,uEACTnG,EAAO,QAAU,QAAU,oEAC3BA,EAAO,QAAU,SAAW,wEAC5B,2DACF,GACA,KAAK,SACL,aAAY,eAAeA,EAAO,KAAK,GAEvC,UAAAqD,EAAA,IAAC0J,EAAK,WAAU,eAAe,cAAY,OAAO,EACjD/M,EAAO,MACP6iB,GACC1c,EAAA,KAAC,OAAK,WAAU,uEACb,UAAA0c,EAAU,OACb,GAEJ,EACCxf,EAAA,YAAK,UAAU,2CACb,WAAO,YACV,CACF,KAKJ,MAAI,CAAC+e,GAAc,CAACE,GAAgB,CAACrc,EAEjCE,EAAA,KAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,sBAEvD,EAEA9H,OAAC,MAAI,WAAU,mBACb,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,uCAAuC,cAAY,OAAO,EAC1E5K,EAAA,UAAG,UAAU,yDAAyD,SAEvE,iCACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,wFAEA8C,OAAC,MAAI,WAAU,YACb,UAAAA,EAAA,KAAC,UAAO,KAAK,SACX,QAASsc,EACT,UAAU,mBACV,aAAW,8BAEX,UAAApf,EAAA,IAAC4K,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,+BAEvD,EAEA9H,EAAA,KAAC,UAAO,KAAK,SACX,QAASuc,EACT,UAAU,qBACV,aAAW,gCAEX,UAAArf,EAAA,IAACwM,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,iCAE3D,GACF,EAECjO,GACEyB,EAAA,WAAI,UAAU,6FACb,SAACA,EAAA,SAAE,UAAU,yCACV,SAAMzB,EAAA,OACT,GACF,GAEJ,CACF,IAKA0gB,GAAgBrc,EAEhBE,EAAA,KAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,sBAEvD,EAEA9H,OAAC,MAAI,WAAU,yCACb,UAAA9C,EAAA,IAACwM,GAAU,WAAU,0CAA0C,cAAY,OAAO,QACjF,OAAK,WAAU,wCACb,SAAAyS,EAAe,mCAAqC,wBACvD,GACF,EAECA,GACEjf,EAAA,WAAI,UAAU,mBACb,eAAC,IAAE,WAAU,2CAA2C,0EAExD,CACF,EAEJ,IAKC+e,EAKHjc,EAAA,KAAC,MAAI,WAAU,uFACb,UAACA,OAAA,OAAI,UAAU,oEACb,UAACA,OAAA,MAAG,UAAU,wEACZ,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,sBAEvD,EAEA5K,MAAC,MAAI,WAAU,2CACb,SAAA8C,EAAA,KAAC,UAAO,KAAK,SACX,QAASsc,EACT,SAAUH,EACV,UAAU,6BACV,aAAW,6BAEX,UAACjf,MAAAwM,GAAA,CAAU,UAAW,gBAAgByS,EAAe,eAAiB,EAAE,GAAI,cAAY,MAAO,GAAE,gBAGrG,GACF,EAEAnc,OAAC,MAAI,WAAU,YAEb,UAACA,OAAA,OAAI,UAAU,wCACb,UAACA,OAAA,OAAI,UAAU,6CACb,UAAC9C,EAAA,UAAG,UAAU,4DAA4D,SAE1E,6BACCsf,EAAe,WAAWP,EAAW,iBAAkB,UAAWA,EAAW,UAAW,GAC3F,EAECA,EAAW,aACTjc,OAAA,OAAI,UAAU,6CACb,UAACA,OAAA,MAAG,UAAU,8EACZ,UAAA9C,EAAA,IAAC6K,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,aAE1D,QACC,MAAI,WAAU,wCACZ,SAAe5M,GAAA8gB,EAAW,WAAW,EACxC,GACF,GAEJ,EAGCA,EAAW,SACVjc,OAAC,MACC,WAACA,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAAC0L,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,WAE1D,EACA1L,EAAA,IAAC,MAAI,WAAU,4FACb,SAAAA,MAAC,KAAE,UAAU,2DACV,SAAW+e,EAAA,QACd,CACF,IACF,EAIDA,EAAW,YAAcA,EAAW,WAAW,OAAS,UACtD,MACC,WAACjc,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAAC2e,GAAc,WAAU,eAAe,cAAY,OAAO,EAAE,oBAE/D,QACC,MAAI,WAAU,oGACb,SAAA3e,MAAC,MAAG,UAAU,YACX,SAAW+e,EAAA,WAAW,IAAI,CAACU,EAAgBpW,IACzCvG,OAAA,MAAe,UAAU,gEACxB,UAAA9C,EAAA,IAAC,OAAK,WAAU,6FAA6F,cAAY,OAAO,EAC/Hyf,CAFM,GAAApW,CAGT,CACD,CACH,GACF,GACF,EAID0V,EAAW,iBAAmBA,EAAW,gBAAgB,OAAS,UAChE,MACC,WAACjc,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAACgM,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,mBAE3D,QACC,MAAI,WAAU,gGACb,SAAAhM,MAAC,MAAG,UAAU,YACX,SAAW+e,EAAA,gBAAgB,IAAI,CAACW,EAAwBrW,IACtDvG,OAAA,MAAe,UAAU,8DACxB,UAAA9C,EAAA,IAACob,GAAY,WAAU,uEAAuE,cAAY,OAAO,EAChHsE,CAFM,GAAArW,CAGT,CACD,CACH,GACF,GACF,EAID0V,EAAW,kBAAoBA,EAAW,iBAAiB,OAAS,UAClE,MACC,WAACjc,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAAC4M,GAAO,WAAU,eAAe,cAAY,OAAO,EAAE,8BAExD,QACC,MAAI,WAAU,wFACb,SAAA5M,MAAC,MAAG,UAAU,YACX,SAAW+e,EAAA,iBAAiB,IAAI,CAACvQ,EAAgBnF,IAC/CvG,OAAA,MAAe,UAAU,0DACxB,UAAA9C,EAAA,IAAC2M,GAAY,WAAU,mEAAmE,cAAY,OAAO,EAC5G6B,CAFM,GAAAnF,CAGT,CACD,CACH,GACF,GACF,EAID0V,EAAW,yBAA2BA,EAAW,wBAAwB,OAAS,UAChF,MACC,WAACjc,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAAC+M,GAAW,WAAU,eAAe,cAAY,OAAO,EAAE,6BAE5D,QACC,MAAI,WAAU,oGACb,SAAA/M,MAAC,MAAG,UAAU,YACX,SAAW+e,EAAA,wBAAwB,IAAI,CAACY,EAAkBtW,IACxDvG,OAAA,MAAe,UAAU,gEACxB,UAAA9C,EAAA,IAACqL,GAAM,WAAU,yEAAyE,cAAY,OAAO,EAC5GsU,CAFM,GAAAtW,CAGT,CACD,CACH,GACF,GACF,QAID,MAAI,WAAU,qDACb,SAACvG,EAAA,YAAI,UAAU,6DACb,UAAA9C,EAAA,IAACqL,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,cACzCpN,GAAe8gB,EAAW,WAAW,EAChDA,EAAW,cACTjc,OAAA,QAAK,UAAU,OAAO,oBAAQic,EAAW,cAAa,GAE3D,CACF,IACF,EAECxgB,GACEyB,EAAA,WAAI,UAAU,6FACb,SAACA,EAAA,SAAE,UAAU,yCACV,SAAMzB,EAAA,OACT,GACF,CAEJ,IAjKO,IAmKX,EClWM+c,GAAe,CACnB,OAAQ,CAAE,MAAO,SAAU,KAAMjQ,GAAO,MAAO,SAAU,YAAa,yBAA0B,EAChG,UAAW,CAAE,MAAO,OAAQ,KAAMA,GAAO,MAAO,YAAa,YAAa,0BAA2B,EACrG,QAAS,CAAE,MAAO,OAAQ,KAAMmB,GAAW,MAAO,aAAc,YAAa,yBAA0B,EACvG,WAAY,CAAE,MAAO,OAAQ,KAAMA,GAAW,MAAO,aAAc,YAAa,sBAAuB,EACvG,UAAW,CAAE,MAAO,QAAS,KAAM4O,GAAa,MAAO,YAAa,YAAa,iCAAkC,EACnH,QAAS,CAAE,MAAO,QAAS,KAAMA,GAAa,MAAO,YAAa,YAAa,iCAAkC,EACjH,UAAW,CAAE,MAAO,QAAS,KAAMA,GAAa,MAAO,YAAa,YAAa,iCAAkC,EACnH,OAAQ,CAAE,MAAO,MAAO,KAAMG,GAAS,MAAO,SAAU,YAAa,+BAAgC,EACrG,MAAO,CAAE,MAAO,MAAO,KAAMA,GAAS,MAAO,QAAS,YAAa,qCAAsC,CAC3G,EAEMqE,GAA0B,IAAM,+BAC9B,MAAE,UAAAha,GAAcia,KAChB5b,EAAWC,KACX,CAAE,uBAAA1F,GAA2BqT,KAE7B,CAAClD,EAASmR,CAAU,EAAIvgB,WAA6B,IAAI,EACzD,CAACwc,EAASC,CAAU,EAAIzc,WAAS,EAAI,EACrC,CAAChB,EAAO+W,CAAQ,EAAI/V,WAA0B,IAAI,EAClD,CAACwgB,EAAaC,CAAc,EAAIzgB,WAAS,EAAK,EAC9C,CAAC0gB,EAAcC,CAAe,EAAI3gB,WAAS,EAAK,EAChD,CAAC4gB,EAAcC,CAAe,EAAI7gB,WAAS,EAAK,EAChDwW,EAAWhE,SAAyB,IAAI,EAGxCsO,EAAc5Z,cAAY,SAAY,CAC1C,GAAKb,EAED,IACFoW,EAAW,EAAI,EACf1G,EAAS,IAAI,EAEb,MAAMzP,EAAc,MAAMH,GAAW,eAAeE,CAAS,EAC7Dka,EAAWja,CAAW,EACCrH,EAAA,WAAWoH,CAAS,sBAAsB,QAC1DmT,EAAK,CACZ,MAAM4D,EAAW5D,EACjBzD,EAASqH,CAAQ,EACMne,EAAA,0BAA0Bme,EAAS,OAAO,EAAE,SACnE,CACAX,EAAW,EAAK,CAClB,GACC,CAACpW,EAAWpH,CAAsB,CAAC,EAGhC8hB,EAAiB7Z,cAAY,SAAY,CAC7CyZ,EAAgB,EAAI,EACpB,MAAMG,EAAY,EAClBH,EAAgB,EAAK,EACrB1hB,EAAuB,wBAAwB,GAC9C,CAAC6hB,EAAa7hB,CAAsB,CAAC,EAGxCmB,YAAU,IAAM,CACF0gB,GAAA,EACX,CAACA,CAAW,CAAC,EAGV,MAAAE,EAAgB9Z,cAAY,IAAM,CACtCuZ,EAAuBlK,GAAA,CACrB,MAAM0K,EAAW,CAAC1K,EAClB,OAAAtX,EAAuB,iBAAiBgiB,EAAW,UAAY,UAAU,EAAE,EACpEA,CAAA,CACR,GACA,CAAChiB,CAAsB,CAAC,EAGrBiiB,EAAsBha,cAAY,IAAM,CACvCsP,EAAS,UAEVoK,GACFpK,EAAS,QAAQ,QACjBqK,EAAgB,EAAK,EACrB5hB,EAAuB,cAAc,IAErCuX,EAAS,QAAQ,KAAO,QAAM,IAAM,CAClCvX,EAAuB,sBAAsB,EAC9C,EACD4hB,EAAgB,EAAI,EACpB5hB,EAAuB,eAAe,GACxC,EACC,CAAC2hB,EAAc3hB,CAAsB,CAAC,EAGnCkiB,EAAsBja,cAAY,IAAM,CAC5C,GAAI,CAACkI,EAAS,OAEd,MAAMgS,EAAU,KAAK,UAAUhS,EAAS,KAAM,CAAC,EACzCiS,EAAW,IAAI,KAAK,CAACD,CAAO,EAAG,CAAE,KAAM,mBAAoB,EAC3Dxb,EAAM,IAAI,gBAAgByb,CAAQ,EAElCC,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAO1b,EACZ0b,EAAK,SAAW,WAAWlS,EAAQ,SAAS,IAAQ,WAAO,YAAc,QAAM,GAAG,EAAE,CAAC,CAAC,QAC7E,cAAK,YAAYkS,CAAI,EAC9BA,EAAK,MAAM,EACF,cAAK,YAAYA,CAAI,EAC9B,IAAI,gBAAgB1b,CAAG,EAEvB3G,EAAuB,+BAA+B,GACrD,CAACmQ,EAASnQ,CAAsB,CAAC,EAG9BsiB,EAAoBra,cAAY,SAAY,CAChD,GAAI,IAACkI,GAAA,MAAAA,EAAS,WAAY,EAACA,GAAA,MAAAA,EAAS,iBAC/BA,GAAA,MAAAA,EAAS,SAEV,IAEF,MAAMoS,EAAcpS,EAAQ,SAGrB,YAAKoS,EAAa,QAAQ,EAE1B,YAAKpS,EAAQ,SAAU,QAAQ,EAEtCnQ,EAAuB,2BAA2BmQ,EAAQ,eAAiB,YAAY,EAAE,QAClFpQ,EAAO,CACN,cAAM,iCAAkCA,CAAK,EACrDC,EAAuB,+BAA+B,CACxD,GACC,CAACmQ,EAASnQ,CAAsB,CAAC,EAG9Bqf,EAAqBpX,cAAY,IAAM,CACvC,CAACkI,GAGD,CADc,OAAO,QAAQ,4IAA4I,IAG7KnQ,EAAuB,0CAA0C,EAGjEyF,EAAS,UAAW,CAClB,MAAO,CACL,kBAAmB0K,EAAQ,UAC3B,cAAeA,EAAQ,cACvB,SAAUA,EAAQ,SAClB,aAAcA,EAAQ,YACxB,EACD,EACA,GAACA,EAAS1K,EAAUzF,CAAsB,CAAC,EAGxC8f,EAA4C,CAAC,CAAE,OAAAC,KAAa,CAE1D,MAAAC,EAAmBD,EAAO,cAC5B,IAAA5hB,EAAS2e,GAAaiD,CAAmC,EAExD5hB,IACC6hB,EAAiB,SAAS,OAAO,GAAKA,EAAiB,SAAS,MAAM,EACxE7hB,EAAS2e,GAAa,MAGtB3e,EAAS2e,GAAa,WAI1B,MAAM5R,EAAO/M,EAAO,KAGlB,OAAAmG,EAAA,KAAC,MAAI,WAAU,8BACb,UAAAA,EAAA,KAAC,QACC,UAAW,uEACTnG,EAAO,QAAU,QAAU,oEAC3BA,EAAO,QAAU,OAAS,gEAC1BA,EAAO,QAAU,SAAW,wEAC5B,2DACF,GACA,KAAK,SACL,aAAY,WAAWA,EAAO,KAAK,GAEnC,UAAAqD,EAAA,IAAC0J,EAAK,WAAW,gBAAgB/M,EAAO,QAAU,QAAU4hB,IAAW,aAAe,eAAiB,EAAE,GAAI,cAAY,OAAO,EAC/H5hB,EAAO,OACV,EACCqD,EAAA,YAAK,UAAU,2CACb,WAAO,YACV,CACF,KAIJ,OAAI+b,QAEC,MAAI,WAAU,wBACb,SAACjZ,EAAA,YAAI,UAAU,yCACb,UAAA9C,EAAA,IAACwM,GAAU,WAAU,0CAA0C,cAAY,OAAO,EACjFxM,EAAA,YAAK,UAAU,wCAAwC,SAA0B,+BACpF,EACF,GAIAzB,EAEAyB,MAAC,MAAI,WAAU,wBACb,SAAAA,MAAC,MAAI,WAAU,wFACb,SAAA8C,EAAA,KAAC,MAAI,WAAU,oBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,4BAA4B,cAAY,OAAO,SACrE,MACC,WAACrb,EAAA,UAAG,UAAU,qDAAqD,SAEnE,0BACCA,EAAA,SAAE,UAAU,sCAAuC,WAAM,QAAQ,EAClE8C,OAAC,MAAI,WAAU,iBACb,UAAA9C,EAAA,IAAC,UAAO,KAAK,SACX,QAASqgB,EACT,UAAU,mBACV,aAAW,wBACZ,qBAED,QACClY,GAAK,IAAG,YAAY,UAAU,qBAAqB,SAEpD,sBACF,GACF,GACF,EACF,CACF,GAICwG,EAoBH7L,EAAA,KAAC,MAAI,WAAU,kCAEb,UAACA,OAAA,OAAI,UAAU,qEACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAAA,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAMmB,EAAS,WAAW,EACnC,UAAU,qBACV,aAAW,wBAEX,UAAAjE,EAAA,IAAC0K,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,oBAE3D,SAEC,MACC,WAAC1K,EAAA,UAAG,UAAU,mDAAmD,SAEjE,oBACA8C,OAAC,IAAE,WAAU,wCAAwC,iBAC9C6L,EAAQ,WACf,GACF,GACF,EAEA7L,OAAC,MAAI,WAAU,0BACb,UAAAA,EAAA,KAAC,UAAO,KAAK,SACX,QAASyd,EACT,UAAU,qBACV,aAAY,GAAGR,EAAc,OAAS,MAAM,iBAE3C,UAAcA,EAAA/f,EAAA,IAACuL,IAAO,UAAU,eAAe,EAAMvL,MAAAwL,GAAA,CAAI,UAAU,cAAe,GAClFuU,EAAc,YAAc,aAC/B,EAEAjd,EAAA,KAAC,UAAO,KAAK,SACX,QAASwd,EACT,SAAUL,EACV,UAAU,qBACV,aAAW,uBAEX,UAACjgB,MAAAwM,GAAA,CAAU,UAAW,gBAAgByT,EAAe,eAAiB,EAAE,GAAI,cAAY,MAAO,GAAE,WAEnG,EAEAnd,EAAA,KAAC,UAAO,KAAK,SACX,QAAS+a,EACT,UAAU,qBACV,aAAW,mCAEX,UAAA7d,EAAA,IAACwM,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,UAE3D,EAEA1J,EAAA,KAAC,UAAO,KAAK,SACX,QAAS4d,EACT,UAAU,mBACV,aAAW,gCAEX,UAAA1gB,EAAA,IAACsL,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,YAE1D,GACF,GACF,EAGCyU,GACCjd,EAAA,KAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC+L,GAAK,WAAU,eAAe,cAAY,OAAO,EAAE,oBAEtD,EACC/L,EAAA,WAAI,UAAU,2DACb,eAAC,MAAI,WAAU,yEACZ,cAAK,UAAU2O,EAAS,KAAM,CAAC,CAClC,GACF,GACF,EAIF7L,OAAC,MAAI,WAAU,wCAEb,UAACA,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC+L,GAAK,WAAU,eAAe,cAAY,OAAO,EAAE,qBAEtD,EAEAjJ,OAAC,MAAI,WAAU,YACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,WACCA,MAAAse,EAAA,CAAY,OAAQ3P,EAAQ,MAAQ,IACvC,EAEA7L,OAAC,MAAI,WAAU,wCACb,UAAAA,OAAC,MACC,WAACA,OAAA,SAAM,UAAU,kEACf,UAAA9C,EAAA,IAAC6K,GAAS,WAAU,sBAAsB,cAAY,OAAO,EAAE,WAEjE,EACA/H,OAAC,MAAI,WAAU,UACb,UAAA9C,MAAC,OAAI,UAAU,gCACZ,SAAmBvC,GAAAkR,EAAQ,SAAS,EACvC,QACC,MAAI,WAAU,mCACZ,SAAe1Q,GAAA0Q,EAAQ,SAAS,EACnC,GACF,GACF,SAEC,MACC,WAAC7L,OAAA,SAAM,UAAU,kEACf,UAAA9C,EAAA,IAACqL,GAAM,WAAU,sBAAsB,cAAY,OAAO,EAAE,gBAE9D,EACAvI,OAAC,MAAI,WAAU,UACb,UAAA9C,MAAC,OAAI,UAAU,gCACZ,SAAmBvC,GAAAkR,EAAQ,SAAS,EACvC,QACC,MAAI,WAAU,mCACZ,SAAe1Q,GAAA0Q,EAAQ,SAAS,EACnC,GACF,GACF,GACF,SAEC,MACC,WAAC7L,OAAA,SAAM,UAAU,kEACf,UAAA9C,EAAA,IAACkN,GAAK,WAAU,sBAAsB,cAAY,OAAO,EAAE,WAE7D,EACClN,EAAA,WAAI,UAAU,oFACZ,WAAQ,OACX,GACF,EAEC2O,EAAQ,kBACP7L,OAAC,MACC,WAACA,OAAA,SAAM,UAAU,kEACf,UAAA9C,EAAA,IAACkN,GAAK,WAAU,sBAAsB,cAAY,OAAO,EAAE,oBAE7D,EACClN,EAAA,WAAI,UAAU,oFACZ,WAAQ,iBACX,GACF,GAEJ,GACF,EAGA8C,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAACyL,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,qBAE3D,EAEA3I,OAAC,MAAI,WAAU,YACZ,UAAA6L,EAAQ,eAAiBA,EAAQ,UAChC7L,OAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,cACAA,EAAA,IAAC,UACC,QAAS8gB,EACT,UAAU,gIACV,MAAM,+BAEL,SAAQnS,EAAA,cACX,GACF,EAGDA,EAAQ,eAAiB,CAACA,EAAQ,iBAChC,MACC,WAAC3O,EAAA,aAAM,UAAU,kEAAkE,SAEnF,cACA8C,OAAC,OAAK,WAAU,2CACb,UAAQ6L,EAAA,cAAc,6BACzB,GACF,EAGDA,EAAQ,UACP7L,OAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,eACA8C,OAAC,MAAI,WAAU,8BACb,UAAA9C,EAAA,IAAC,UAAO,KAAK,SACX,QAASygB,EACT,UAAU,qBACV,aAAY,GAAGN,EAAe,QAAU,MAAM,SAE7C,SAAAA,QAAgB/T,GAAM,WAAU,UAAU,EAAKpM,EAAA,IAACsM,GAAK,WAAU,SAAU,GAC5E,QACC,OAAK,WAAU,2CACb,SAAA6T,EAAe,mBAAqB,2BACvC,GACF,EACAngB,EAAA,IAAC,SACC,IAAK+V,EACL,IAAKpH,EAAQ,SACb,OAAQ,IAAMyR,EAAgB,EAAI,EAClC,QAAS,IAAMA,EAAgB,EAAK,EACpC,QAAS,IAAMA,EAAgB,EAAK,EACpC,QAAS,IAAM,CACbA,EAAgB,EAAK,EACrB5hB,EAAuB,oDAAoD,CAC7E,EACA,UAAU,SACV,QAAQ,WACV,GACF,GAEJ,GACF,GACF,EAGCmQ,EAAQ,cACN7L,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAACkN,GAAK,WAAU,eAAe,cAAY,OAAO,EAAE,uBAEtD,EAEApK,OAAC,MAAI,WAAU,uDACZ,UAAQ6L,EAAA,aAAa,KACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,QACA8C,OAAC,MAAI,WAAU,wCACZ,UAAA6L,EAAQ,aAAa,IAAI,UAC5B,GACF,EAGDA,EAAQ,aAAa,QACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,WACAA,MAAC,MAAI,WAAU,mDACZ,SAAA2O,EAAQ,aAAa,OAAO,QAAQ,QAAS,GAAG,CACnD,IACF,EAGDA,EAAQ,aAAa,QACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,WACA8C,OAAC,MAAI,WAAU,wCACZ,UAAA6L,EAAQ,aAAa,OAAO,QAC/B,GACF,EAGDA,EAAQ,aAAa,MACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,eACC,MAAI,WAAU,mDACZ,SAAA2O,EAAQ,aAAa,KACxB,GACF,EAGDA,EAAQ,aAAa,WACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,oBACC,MAAI,WAAU,wCACZ,SAAA2O,EAAQ,aAAa,UACxB,GACF,EAGDA,EAAQ,aAAa,SACpB7L,EAAA,KAAC,MACC,WAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,mBACC,MAAI,WAAU,kDACZ,SAAA2O,EAAQ,aAAa,QACxB,GACF,EAGDA,EAAQ,aAAa,WAAa,eAChC,MACC,WAAC3O,EAAA,aAAM,UAAU,kEAAkE,SAEnF,6BACAA,MAAC,OAAI,UAAU,wCACZ,WAAQ,aAAa,SAAW,MAAQ,IAC3C,IACF,EAGD2O,EAAQ,aAAa,cACnB7L,EAAA,YAAI,UAAU,8BACb,UAAC9C,EAAA,aAAM,UAAU,kEAAkE,SAEnF,wBACC,MAAI,WAAU,uFACZ,SAAA2O,EAAQ,aAAa,aACxB,GACF,GAEJ,GACF,GAIAA,EAAQ,iBAAmBA,EAAQ,aAClC7L,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAACyK,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,oBAE1D,EAEA3H,OAAC,MAAI,WAAU,YAEX,WAAA6L,EAAQ,iBAAmBA,EAAQ,aACnC7L,OAAC,MACC,WAACA,OAAA,MAAG,UAAU,2EACZ,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,wBAEvD,EAEA9H,OAAC,MAAI,WAAU,wCAEX,aAAQ8L,EAAAD,EAAA,8BAAAC,EAAiB,oBAAoBC,EAAAF,EAAQ,aAAR,YAAAE,EAA4B,8BACxE/L,OAAA,OAAI,UAAU,4FACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,YAAK,UAAU,uDAAuD,SAEvE,qBACCA,EAAA,IAAA+M,GAAA,CAAW,UAAU,2CAA2C,cAAY,OAAO,GACtF,EACC/M,MAAA,OAAI,UAAU,sDACZ,WAAQ8U,GAAAD,EAAAlG,EAAA,8BAAAkG,EAAiB,kBAAjB,YAAAC,EAAkC,QAAQ,OAChDC,EAAApG,EAAQ,aAAR,MAAAoG,EAA4B,2BAC3BpG,EAAQ,WAAmB,2BAA2B,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAU+M,GAAcA,EAAE,YAAa,GACzH,MACL,IACF,KAIAzG,EAAAtG,EAAQ,kBAAR,YAAAsG,EAAyB,iBAAiBD,EAAArG,EAAQ,aAAR,YAAAqG,EAA4B,2BACtElS,OAAC,MAAI,WAAU,oGACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,YAAK,UAAU,2DAA2D,SAE3E,kBACCA,EAAA,IAAA8L,GAAA,CAAM,UAAU,+CAA+C,cAAY,OAAO,GACrF,EACC9L,MAAA,OAAI,UAAU,0DACZ,WAAQkV,GAAAC,EAAAxG,EAAA,8BAAAwG,EAAiB,eAAjB,YAAAD,EAA+B,QAAQ,OAC7CE,EAAAzG,EAAQ,aAAR,MAAAyG,EAA4B,wBAC3BzG,EAAQ,WAAmB,wBAAwB,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAU+M,GAAcA,EAAE,YAAa,GACtH,MACL,IACF,GAKJ,GACF,IAIDrG,GAAA1G,EAAQ,kBAAR,YAAA0G,GAAyB,WAAY1G,EAAQ,gBAAgB,SAAS,OAAS,GAC9E7L,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,yDAAyD,SAEvE,4BACC,MAAI,WAAU,oGACb,SAACA,EAAA,UAAG,UAAU,YACX,SAAA2O,EAAQ,gBAAgB,SAAS,IAAI,CAACyL,EAAS/Q,IAC7CvG,EAAA,WAAe,UAAU,gEACxB,UAAA9C,EAAA,IAAC,OAAK,WAAU,6FAA6F,cAAY,OAAO,EAC/Hoa,CAFM,GAAA/Q,CAGT,CACD,CACH,GACF,GACF,IAID2X,GAAArS,EAAQ,kBAAR,YAAAqS,GAAyB,cACxBle,EAAA,KAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,yDAAyD,SAEvE,8BACC,MAAI,WAAU,6CACb,SAAC8C,EAAA,YAAI,UAAU,4BACb,UAAA9C,EAAA,IAACob,GAAY,WAAU,kDAAkD,cAAY,OAAO,EAC3Fpb,EAAA,YAAK,UAAU,wCAAwC,SAExD,eACAA,MAAC,QAAK,UAAU,4CACb,YAAe2O,EAAQ,gBAAgB,WAAW,EACrD,GACF,CACF,IACF,GAEJ,GACF,EAIF3O,EAAA,IAAC4e,GAAA,CACC,UAAWjQ,EAAQ,UACnB,mBAAoBA,EAAQ,gBAAkB,KAC9C,oBAAsBoQ,GAAe,CACxBe,EAAAhK,GAAQA,EAAO,CAAE,GAAGA,EAAM,eAAgBiJ,GAAe,IAAI,CAC1E,EACF,CACF,UAjcG,MAAI,WAAU,wBACb,SAACjc,EAAA,YAAI,UAAU,oBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,uCAAuC,cAAY,OAAO,EAChFrb,EAAA,UAAG,UAAU,yDAAyD,SAEvE,sBACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,oDACCmI,GAAK,IAAG,YAAY,UAAU,mBAAmB,SAElD,qBACF,EACF,EAsbN,EC7oBM8Y,GAAwB,IAAM,CAC5B,MAAE,KAAAtd,GAASxB,KACX,CAAC0Z,EAAUC,CAAW,EAAIvc,EAAA,SAAwB,CAAE,GACpD,CAACwc,EAASC,CAAU,EAAIzc,WAAS,EAAI,EACrC,CAAChB,EAAO+W,CAAQ,EAAI/V,WAA0B,IAAI,EAClD,CAAC8c,EAASC,CAAU,EAAI/c,WAA4B,CACxD,UAAW,MACX,UAAW,MACX,WAAY,GACb,EACK,CAAC4c,EAAaC,CAAc,EAAI7c,WAAS,EAAK,EAE9C,CAAE,uBAAAf,GAA2BqT,KAC7B5N,EAAWC,KAGX4J,EAAyBrH,cAAY,KAElC9C,GAAA,YAAAA,EAAM,KAAM5G,KAClB,CAAC4G,GAAA,YAAAA,EAAM,EAAE,CAAC,EAGPud,EAAiBza,cAAab,GAAsB,CAC/C3B,EAAA,aAAa2B,CAAS,EAAE,EACVpH,EAAA,yBAAyBoH,CAAS,UAAU,GAClE,CAAC3B,EAAUzF,CAAsB,CAAC,EAG/B2iB,EAAkB1a,cAAY,SAAY,CAC1C,IACFuV,EAAW,EAAI,EACf1G,EAAS,IAAI,EAEb,MAAMtY,EAAS8Q,IAITsT,GAHW,MAAM1b,GAAW,gBAAgB1I,CAAM,GAGf,SAAS,OAAkB2R,GAC3DA,EAAQ,iBAAmBA,EAAQ,UAC3C,EAEDmN,EAAYsF,CAAuB,EACZ5iB,EAAA,GAAG4iB,EAAwB,MAAM,6BAA6B,QAC9ErI,EAAK,CACZ,MAAM4D,EAAW5D,EACjBzD,EAASqH,CAAQ,EACMne,EAAA,8BAA8Bme,EAAS,OAAO,EAAE,SACvE,CACAX,EAAW,EAAK,CAClB,GACC,CAACxd,CAAsB,CAAC,EAE3BmB,YAAU,IAAM,CACEwhB,GAAA,EACf,CAACA,CAAe,CAAC,EAGd,MAAAE,EAAmBxE,UAAQ,IAAM,CACrC,GAAIR,EAAQ,YAAc,MAAc,OAAAR,EAElC,MAAAle,MAAU,KACVqf,MAAgB,KAEtB,OAAQX,EAAQ,UAAW,CACzB,IAAK,OACHW,EAAU,QAAQrf,EAAI,QAAQ,EAAI,CAAC,EACnC,MACF,IAAK,QACHqf,EAAU,SAASrf,EAAI,SAAS,EAAI,CAAC,EACrC,MACF,IAAK,UACHqf,EAAU,SAASrf,EAAI,SAAS,EAAI,CAAC,EACrC,MACF,IAAK,OACHqf,EAAU,YAAYrf,EAAI,YAAY,EAAI,CAAC,EAC3C,KACJ,CAEA,OAAOke,EAAS,OACdlN,GAAA,IAAI,KAAKA,EAAQ,SAAS,GAAKqO,CAAA,CAEhC,GAACnB,EAAUQ,EAAQ,SAAS,CAAC,EAG1BiF,EAAYzE,UAAQ,IACjBwE,EACJ,IAAe1S,GAAA,SAER,MAAA4S,EAAuB9F,GAAqC,CAChE,GAAI,CAACA,EAAiB,YACd,OAAAA,EAAS,YAAe,GAE9B,IAAK,aACI,SACT,IAAK,mBACI,SACT,IAAK,qBACI,SAET,IAAK,gBACI,SACT,IAAK,WACI,SACT,IAAK,oBACI,SACT,IAAK,SACI,SACT,QACS,WACX,GAGI+F,EAAaD,GAAqB3S,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,0BAA0B,EACxF6S,EAAUF,GAAqB1S,EAAAF,EAAQ,aAAR,YAAAE,EAA4B,uBAAuB,EAGjF,OACL,KAAMF,EAAQ,UACd,WAAA6S,EACA,QAAAC,EACA,QAAS,KACT,UAAW9S,EAAQ,UACrB,CACD,EACA,KAAK,CAACF,EAAGC,IAAM,IAAI,KAAKD,EAAE,IAAI,EAAE,UAAY,IAAI,KAAKC,EAAE,IAAI,EAAE,SAAS,EACxE,CAAC2S,CAAgB,CAAC,EAGfK,EAAoB7E,UAAQ,IAA2C,CAC3E,MAAM8E,EAAqD,CACzD,WAAY,CAAC,EACb,QAAS,CAAC,GAINC,EAAa,CAEjB,CAAE,SAAU,aAAc,MAAO,aAAc,MAAO,cAAe,EACrE,CAAE,SAAU,mBAAoB,MAAO,mBAAoB,MAAO,eAAgB,EAClF,CAAE,SAAU,qBAAsB,MAAO,qBAAsB,MAAO,YAAa,EAEnF,CAAE,SAAU,gBAAiB,MAAO,gBAAiB,MAAO,cAAe,EAC3E,CAAE,SAAU,WAAY,MAAO,WAAY,MAAO,eAAgB,EAClE,CAAE,SAAU,oBAAqB,MAAO,oBAAqB,MAAO,YAAa,EACjF,CAAE,SAAU,SAAU,MAAO,SAAU,MAAO,YAAa,GAIvDC,EAAmBR,EACtB,IAAgB1S,GAAA,cAAAC,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,2BAA0B,EACtE,OAAgBkT,OAAU,MAAS,EAEtCF,EAAW,QAAeG,GAAA,CACxB,MAAMC,EAAQH,EAAiB,UAAgBC,IAAUC,EAAI,QAAQ,EAAE,OACjEE,EAAaJ,EAAiB,OAAS,EAAKG,EAAQH,EAAiB,OAAU,IAAM,EAEvFG,EAAQ,GACVL,EAAc,WAAW,KAAK,CAC5B,SAAUI,EAAI,MACd,MAAAC,EACA,WAAAC,EACA,MAAOF,EAAI,MACZ,CACH,CACD,EAGK,MAAAG,EAAgBb,EACnB,IAAgB1S,GAAA,cAAAC,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,wBAAuB,EACnE,OAAgBkT,OAAU,MAAS,EAEtC,OAAAF,EAAW,QAAeG,GAAA,CACxB,MAAMC,EAAQE,EAAc,UAAgBJ,IAAUC,EAAI,QAAQ,EAAE,OAC9DE,EAAaC,EAAc,OAAS,EAAKF,EAAQE,EAAc,OAAU,IAAM,EAEjFF,EAAQ,GACVL,EAAc,QAAQ,KAAK,CACzB,SAAUI,EAAI,MACd,MAAAC,EACA,WAAAC,EACA,MAAOF,EAAI,MACZ,CACH,CACD,EAIMJ,CAAA,EACN,CAACN,CAAgB,CAAC,EAGfc,EAAgBtF,UAAQ,IAAqC,CACjE,MAAMuF,EAAwC,GAGxCC,EAAuB5G,GAA8B,CACzD,GAAI,CAACA,EAAiB,SACd,OAAAA,EAAS,YAAe,GAE9B,IAAK,aACI,SACT,IAAK,mBACI,SACT,IAAK,qBACI,SAET,IAAK,gBACI,SACT,IAAK,WACI,SACT,IAAK,oBACI,SACT,IAAK,SACI,SACT,QACS,QACX,GAII6G,EAAuBjB,EAC1B,IAAgB1S,GAAA,cAAAC,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,2BAA0B,EACtE,OAAcmT,OAAQ,MAAS,EAE9B,GAAAO,EAAqB,OAAS,EAChCF,EAAO,WAAa,CAAE,UAAW,SAAU,OAAQ,EAAG,OAAQ,yBACzD,CACC,MAAAG,EAAiBD,EAAqB,IAAID,CAAmB,EAC7DG,EAAYD,EAAe,MAAM,EAAG,KAAK,MAAMA,EAAe,OAAS,CAAC,CAAC,EACzEE,EAAaF,EAAe,MAAM,KAAK,MAAMA,EAAe,OAAS,CAAC,CAAC,EAEvEG,EAAWF,EAAU,OAAO,CAAC/T,GAAGC,IAAMD,GAAIC,EAAG,CAAC,EAAI8T,EAAU,OAE5DG,GADYF,EAAW,OAAO,CAAChU,GAAGC,IAAMD,GAAIC,EAAG,CAAC,EAAI+T,EAAW,OAC1CC,EAE3BN,EAAO,WAAa,CAClB,UAAW,KAAK,IAAIO,EAAM,EAAI,GAAM,SAAWA,GAAS,EAAI,YAAc,YAC1E,OAAQ,KAAK,IAAIA,EAAM,EACvB,OAAQ,GAAGtB,EAAiB,MAAM,YAEtC,CAGM,MAAAuB,EAAoBvB,EACvB,IAAgB1S,GAAA,cAAAC,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,wBAAuB,EACnE,OAAcmT,OAAQ,MAAS,EAE9B,GAAAa,EAAkB,OAAS,EAC7BR,EAAO,QAAU,CAAE,UAAW,SAAU,OAAQ,EAAG,OAAQ,yBACtD,CACC,MAAAG,EAAiBK,EAAkB,IAAIP,CAAmB,EAC1DG,EAAYD,EAAe,MAAM,EAAG,KAAK,MAAMA,EAAe,OAAS,CAAC,CAAC,EACzEE,EAAaF,EAAe,MAAM,KAAK,MAAMA,EAAe,OAAS,CAAC,CAAC,EAEvEG,EAAWF,EAAU,OAAO,CAAC/T,GAAGC,IAAMD,GAAIC,EAAG,CAAC,EAAI8T,EAAU,OAE5DG,GADYF,EAAW,OAAO,CAAChU,GAAGC,IAAMD,GAAIC,EAAG,CAAC,EAAI+T,EAAW,OAC1CC,EAE3BN,EAAO,QAAU,CACf,UAAW,KAAK,IAAIO,EAAM,EAAI,GAAM,SAAWA,GAAS,EAAI,YAAc,YAC1E,OAAQ,KAAK,IAAIA,EAAM,EACvB,OAAQ,GAAGtB,EAAiB,MAAM,YAEtC,CAGA,OAAAe,EAAO,QAAU,CAAE,UAAW,SAAU,OAAQ,EAAG,OAAQ,eAEpDA,CAAA,EACN,CAACf,CAAgB,CAAC,EAGfwB,EAAahG,UAAQ,IAAM,CAC/B,MAAMiG,EAAQ,CACZ,cAAezB,EAAiB,OAChC,cAAe,EACf,WAAY,EACZ,WAAY,EACZ,cAAe,KACf,oBAAqB,GAGvB,GAAIA,EAAiB,SAAW,EAAU,OAAAyB,EAGpC,MAAAR,EAAuBjB,EAC1B,IAAS1D,GAAA,cAAA/O,EAAA+O,EAAE,aAAF,YAAA/O,EAAc,yBAAwB,EAC/C,OAAY+O,OAAM,MAAS,EAExBiF,EAAoBvB,EACvB,IAAS1D,GAAA,cAAA/O,EAAA+O,EAAE,aAAF,YAAA/O,EAAc,sBAAqB,EAC5C,OAAY+O,OAAM,MAAS,EAG1B,GAAA2E,EAAqB,OAAS,EAAG,CACnC,MAAMS,EAA2C,GACjDT,EAAqB,QAAeP,GAAA,CAClCgB,EAAiBhB,CAAI,GAAKgB,EAAiBhB,CAAI,GAAK,GAAK,EAC1D,EACK,MAAAiB,EAAuB,OAAO,QAAQD,CAAgB,EACzD,KAAK,CAAC,CAAE,CAAAtU,CAAC,EAAG,CAAE,CAAAC,CAAC,IAAMA,EAAID,CAAC,EAAE,CAAC,EAAE,CAAC,EAC7BqU,EAAA,cAAgBC,EAAiBC,CAAoB,CAC7D,CAGI,GAAAJ,EAAkB,OAAS,EAAG,CAChC,MAAMK,EAAwC,GAC9CL,EAAkB,QAAeb,GAAA,CAC/BkB,EAAclB,CAAI,GAAKkB,EAAclB,CAAI,GAAK,GAAK,EACpD,EACK,MAAAmB,EAAoB,OAAO,QAAQD,CAAa,EACnD,KAAK,CAAC,CAAE,CAAAxU,CAAC,EAAG,CAAE,CAAAC,CAAC,IAAMA,EAAID,CAAC,EAAE,CAAC,EAAE,CAAC,EAC7BqU,EAAA,WAAaG,EAAcC,CAAiB,CACpD,CAEA,OAAAJ,EAAM,cAAgBzB,EAAiB,KAAK,CAAC5S,EAAGC,IAC9C,IAAI,KAAKA,EAAE,SAAS,EAAE,UAAY,IAAI,KAAKD,EAAE,SAAS,EAAE,QAAQ,GAChE,CAAC,EAGHqU,EAAM,oBAAsB,EAErBA,CAAA,EACN,CAACzB,CAAgB,CAAC,EAGf/D,EAAe7W,cAAY,CAAC8W,EAA8Bxd,IAAe,CAClEuc,EAAAxG,IAAS,CAAE,GAAGA,EAAM,CAACyH,CAAG,EAAGxd,CAAQ,IAC9CvB,EAAuB,UAAU+e,CAAG,eAAexd,CAAK,EAAE,GACzD,CAACvB,CAAsB,CAAC,EAGrB2kB,EAAsB1c,cAAY,IAAM,CAC5C,MAAMka,EAAU,KAAK,UAAUU,EAAkB,KAAM,CAAC,EAClDT,EAAW,IAAI,KAAK,CAACD,CAAO,EAAG,CAAE,KAAM,mBAAoB,EAC3Dxb,EAAM,IAAI,gBAAgByb,CAAQ,EAElCC,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAO1b,EACP0b,EAAA,SAAW,eAAe,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC,QAC5D,cAAK,YAAYA,CAAI,EAC9BA,EAAK,MAAM,EACF,cAAK,YAAYA,CAAI,EAC9B,IAAI,gBAAgB1b,CAAG,EAEvB3G,EAAuB,mCAAmC,GACzD,CAAC6iB,EAAkB7iB,CAAsB,CAAC,EAGvC4kB,EAAoE,CAAC,CAAE,MAAAC,EAAO,MAAAjb,KAAY,CACxF,MAAAsB,EAAO2Z,EAAM,YAAc,YAAcvW,GAClCuW,EAAM,YAAc,YAActW,GAAatC,GACtD6Y,EAAaD,EAAM,YAAc,YAAc,qCAClCA,EAAM,YAAc,YAAc,iCAClC,mCAGjB,OAAAvgB,EAAA,KAAC,MAAI,WAAU,8BACb,UAAA9C,MAAC0J,GAAK,UAAW,WAAW4Z,CAAU,GAAI,cAAY,OAAO,EAC5DtjB,EAAA,YAAK,UAAU,2CAA4C,SAAMoI,EAAA,EACjEtF,OAAA,QAAK,UAAW,uBAAuBwgB,CAAU,cAC/C,UAAMD,EAAA,UACNA,EAAM,SAAW,oBACd,wBACAA,EAAM,SAAW,cACf,0BACA,KAAKA,EAAM,MAAM,KAEzB,CACF,KAKEE,EAID,CAAC,CAAE,KAAAhe,EAAM,KAAA2Q,EAAM,WAAAsN,KAAiB,CAC7B,MAAAC,EAASle,EAAK,IAASme,KAAExN,CAAI,CAAC,EAAE,OAAYyH,OAAM,IAAI,EAC5D,GAAI8F,EAAO,SAAW,EAAG,OAAQzjB,MAAA,OAAI,UAAU,iCAAiC,SAAiB,sBAEjG,MAAM2jB,EAAW,KAAK,IAAI,GAAGF,CAAM,EAC7BG,EAAW,KAAK,IAAI,GAAGH,CAAM,EAC7BI,EAAQF,EAAWC,GAAY,EAG/BE,EAAwBhC,GAA0B,CACtD,OAAQA,EAAO,CACb,IAAK,GAAU,mCACf,IAAK,GAAU,oCACf,IAAK,GAAU,+CACf,IAAK,GAAU,eACf,QAAgB,eAClB,GAIIiC,EAAmB,CAACjC,EAAe5L,IAAuD,CAC9F,GAAIA,IAAS,aACX,OAAQ4L,EAAO,CACb,IAAK,GAAU,oBACf,IAAK,GAAU,oBACf,IAAK,GAAU,oBACf,QAAgB,mBAClB,SACS5L,IAAS,UAClB,OAAQ4L,EAAO,CACb,IAAK,GAAU,sBACf,IAAK,GAAU,sBACf,IAAK,GAAU,sBACf,IAAK,GAAU,sBACf,QAAgB,qBAClB,KAEA,QAAQA,EAAO,CACb,IAAK,GAAU,qBACf,IAAK,GAAU,qBACf,IAAK,GAAU,qBACf,IAAK,GAAU,qBACf,QAAgB,oBAClB,CACF,EAIIkC,GAAkBC,GACJ,CAChB,CAAE,MAAO,EAAG,MAAO,YAAa,EAChC,CAAE,MAAO,EAAG,MAAO,MAAO,EAC1B,CAAE,MAAO,EAAG,MAAO,UAAW,EAC9B,CAAE,MAAO,EAAG,MAAO,YAAa,EAChC,CAAE,MAAO,EAAG,MAAO,QAAS,GAGb,IAAaC,IAAA,CAC5B,GAAGA,EACH,MAAOH,EAAiBG,EAAK,MAAOD,CAAS,CAC7C,IAIEE,GAAa,IAAI,IAAIV,CAAM,EAE3BW,EADcJ,GAAe9N,CAAI,EACD,OAAOgO,GAAQC,GAAW,IAAID,EAAK,KAAK,CAAC,EAE/E,cACG,MACC,WAAAlkB,MAAC,OAAI,UAAU,+CACZ,WAAK,IAAI,CAACqkB,EAAWhb,IAAU,CACxB,MAAAyY,EAAQuC,EAAUnO,CAAI,EAC5B,GAAI4L,IAAU,KAAa,YAErB,MAAAwC,GAAWxC,EAAQ8B,GAAYC,EAAS,IACxCU,GAAgBR,EAAiBjC,EAAO5L,CAAI,EAC5CsO,GAAeV,EAAqBhC,CAAK,EACzC2C,GAAU,IAAI,KAAKJ,EAAU,IAAI,EAAE,qBAGvC,OAAArkB,EAAA,IAAC,OAEC,UAAW,UAAUukB,EAAa,sIAClC,MAAO,CAAE,iBAAkB,GAAG,KAAK,IAAID,EAAQ,CAAC,CAAC,GAAI,EACrD,QAAS,IAAMd,EAAWa,EAAU,SAAS,EAC7C,KAAK,SACL,SAAU,EACV,UAAYvkB,IAAM,EACZA,GAAE,MAAQ,SAAWA,GAAE,MAAQ,OACjCA,GAAE,eAAe,EACjB0jB,EAAWa,EAAU,SAAS,EAElC,EACA,aAAY,4BAA4BG,EAAY,aAAaC,EAAO,GAGxE,SAAA3hB,EAAA,KAAC,MAAI,WAAU,2OACb,UAAC9C,EAAA,WAAI,UAAU,cAAe,SAAawkB,GAAA,EAC1CxkB,EAAA,WAAI,UAAU,gBAAiB,SAAQykB,GAAA,EACxC3hB,OAAC,MAAI,WAAU,gBAAgB,sBAAUuhB,EAAU,UAAU,MAAM,EAAE,GAAE,EACtErkB,EAAA,WAAI,UAAU,6BAA6B,SAAqB,0BAEjEA,MAAC,MAAI,WAAU,4JAA6J,IAC9K,GAtBKqJ,CAAA,CAyBV,GACH,EAGC+a,EAAkB,OAAS,GACzBpkB,MAAA,OAAI,UAAU,OACb,SAAA8C,EAAA,KAAC,MAAI,WAAU,4CACb,UAAC9C,EAAA,YAAK,UAAU,+CAA+C,SAAO,YACrEokB,EAAkB,IAAKF,GACrBphB,OAAA,OAAqB,UAAU,0BAC9B,UAAA9C,MAAC,MAAI,WAAW,WAAWkkB,EAAK,KAAK,WAAY,EAChDlkB,EAAA,YAAK,UAAU,mCAAoC,WAAK,MAAM,IAFvDkkB,EAAK,KAGf,CACD,GACH,CACF,EAEJ,KAIJ,OAAInI,QAEC,MAAI,WAAU,wBACb,SAACjZ,EAAA,YAAI,UAAU,yCACb,UAAA9C,EAAA,IAACwM,GAAU,WAAU,0CAA0C,cAAY,OAAO,EACjFxM,EAAA,YAAK,UAAU,wCAAwC,SAAsB,2BAChF,EACF,GAIAzB,EAEAyB,MAAC,MAAI,WAAU,wBACb,SAAAA,MAAC,MAAI,WAAU,wFACb,SAAA8C,EAAA,KAAC,MAAI,WAAU,oBACb,UAAA9C,EAAA,IAACqb,GAAY,WAAU,4BAA4B,cAAY,OAAO,SACrE,MACC,WAACrb,EAAA,UAAG,UAAU,qDAAqD,SAEnE,8BACCA,EAAA,SAAE,UAAU,sCAAuC,WAAM,QAAQ,EAClEA,EAAA,IAAC,UACC,KAAK,SACL,QAASmhB,EACT,UAAU,wBACV,aAAW,4BACZ,qBAED,GACF,GACF,EACF,CACF,GAKFre,EAAA,KAAC,MAAI,WAAU,kCAEb,UAACA,OAAA,OAAI,UAAU,qEACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,mDAAmD,SAEjE,mBACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,8DACF,EAEA8C,OAAC,MAAI,WAAU,0BACb,UAAAA,EAAA,KAAC,UACC,KAAK,SACL,QAAS,IAAMsZ,EAAe,CAACD,CAAW,EAC1C,UAAU,qBACV,gBAAeA,EAAc,OAAS,QACtC,aAAY,GAAGA,EAAc,OAAS,MAAM,kBAE5C,UAAAnc,EAAA,IAACye,GAAO,WAAU,eAAe,cAAY,OAAO,EAAE,UAErDtC,QAAelR,GAAU,WAAU,eAAe,EAAKjL,MAACgL,GAAY,WAAU,cAAe,IAChG,EAEAlI,EAAA,KAAC,UACC,KAAK,SACL,QAASqe,EACT,UAAU,qBACV,aAAW,2BAEX,UAAAnhB,EAAA,IAACwM,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,WAE3D,EAEA1J,EAAA,KAAC,UACC,KAAK,SACL,QAASqgB,EACT,UAAU,mBACV,SAAU9B,EAAiB,SAAW,EACtC,aAAW,4BAEX,UAAArhB,EAAA,IAACsL,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,YAE1D,GACF,GACF,EAGC6Q,SACE,MAAI,WAAU,uFACb,SAACrZ,OAAA,OAAI,UAAU,wCACb,UAAAA,OAAC,MACC,WAAA9C,MAAC,QAAM,SAAQ,aAAa,UAAU,kEAAkE,SAExG,eACA8C,EAAA,KAAC,UACC,GAAG,aACH,MAAOuZ,EAAQ,UACf,SAAWvc,GAAMwd,EAAa,YAAaxd,EAAE,OAAO,KAAK,EACzD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,MAAM,SAAQ,aAC3BA,EAAA,cAAO,MAAM,OAAO,SAAS,cAC7BA,EAAA,cAAO,MAAM,QAAQ,SAAU,eAC/BA,EAAA,cAAO,MAAM,UAAU,SAAY,iBACnCA,EAAA,cAAO,MAAM,OAAO,SAAS,eAChC,GACF,SAEC,MACC,WAAAA,MAAC,QAAM,SAAQ,aAAa,UAAU,kEAAkE,SAExG,gBACA8C,EAAA,KAAC,UACC,GAAG,aACH,MAAOuZ,EAAQ,UACf,SAAWvc,GAAMwd,EAAa,YAAaxd,EAAE,OAAO,KAAK,EACzD,UAAU,4LAEV,UAACE,EAAA,cAAO,MAAM,MAAM,SAAU,eAC7BA,EAAA,cAAO,MAAM,aAAa,SAAU,eACpCA,EAAA,cAAO,MAAM,UAAU,SAAO,YAC9BA,EAAA,cAAO,MAAM,UAAU,SAAO,aACjC,GACF,QAEC,MAAI,WAAU,iBACb,SAAC8C,EAAA,cAAM,UAAU,oBACf,UAAA9C,EAAA,IAAC,SACC,KAAK,WACL,QAASqc,EAAQ,WACjB,SAAWvc,GAAMwd,EAAa,aAAcxd,EAAE,OAAO,OAAO,EAC5D,UAAU,mGACZ,EACCE,EAAA,YAAK,UAAU,2CAA2C,SAAmB,yBAChF,CACF,IACF,CACF,GAGDqhB,EAAiB,SAAW,EAC1Bve,EAAA,YAAI,UAAU,qGACb,UAAA9C,EAAA,IAAC4K,GAAM,WAAU,uCAAuC,cAAY,OAAO,EAC1E5K,EAAA,UAAG,UAAU,yDAAyD,SAEvE,iCACAA,MAAC,KAAE,UAAU,wCACV,WAAS,SAAW,EACjB,mDACA,gDAEN,SACCmI,GAAK,IAAG,UAAU,UAAU,mBAAmB,SAEhD,+BACF,EAIErF,OAAAM,EAAA,oBAACN,OAAA,OAAI,UAAU,uDACb,UAAA9C,MAAC,OAAI,UAAU,uFACb,SAAC8C,EAAA,YAAI,UAAU,oBACb,UAAC9C,MAAA,OAAI,UAAU,gBACb,SAAAA,EAAA,IAACyK,IAAS,UAAU,wBAAwB,cAAY,OAAO,CACjE,GACA3H,OAAC,MAAI,WAAU,OACb,UAAC9C,EAAA,SAAE,UAAU,uDAAuD,SAAc,mBACjFA,EAAA,SAAE,UAAU,uDAAwD,WAAW,cAAc,GAChG,GACF,CACF,SAEC,MAAI,WAAU,uFACb,SAAC8C,EAAA,YAAI,UAAU,oBACb,UAAC9C,MAAA,OAAI,UAAU,gBACb,SAAAA,EAAA,IAAC4K,IAAM,UAAU,0BAA0B,cAAY,OAAO,CAChE,GACA9H,OAAC,MAAI,WAAU,OACb,UAAC9C,EAAA,SAAE,UAAU,uDAAuD,SAAwB,6BAC3FA,EAAA,SAAE,UAAU,sDACT,UAAM,KACA,MAAAsiB,EAAuBjB,EAC1B,IAAU1D,GAAA,cAAA/O,EAAA+O,EAAE,aAAF,YAAA/O,EAAsB,2BAA0B,EAC1D,OAAY+O,OAAM,MAAS,EAE9B,GAAI2E,EAAqB,SAAW,EAAU,UAE9C,MAAMoC,EAAiC,GACvC,OAAApC,EAAqB,QAAeP,GAAA,CAClC2C,EAAO3C,CAAI,GAAK2C,EAAO3C,CAAI,GAAK,GAAK,EACtC,EAEkB,OAAO,QAAQ2C,CAAM,EACrC,KAAK,CAAC,CAAE,CAAAjW,CAAC,EAAG,CAAE,CAAAC,CAAC,IAAMA,EAAID,CAAC,EAAE,CAAC,EAAE,CAAC,EAEjB,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAUiN,GAAcA,EAAE,YAAa,OAExF,GACF,GACF,CACF,SAEC,MAAI,WAAU,uFACb,SAAC5Y,EAAA,YAAI,UAAU,oBACb,UAAC9C,MAAA,OAAI,UAAU,gBACb,SAAAA,EAAA,IAAC8L,IAAM,UAAU,uBAAuB,cAAY,OAAO,CAC7D,GACAhJ,OAAC,MAAI,WAAU,OACb,UAAC9C,EAAA,SAAE,UAAU,uDAAuD,SAAqB,0BACxFA,EAAA,SAAE,UAAU,sDACT,UAAM,KACA,MAAA4iB,EAAoBvB,EACvB,IAAU1D,GAAA,cAAA/O,EAAA+O,EAAE,aAAF,YAAA/O,EAAsB,wBAAuB,EACvD,OAAY+O,OAAM,MAAS,EAE9B,GAAIiF,EAAkB,SAAW,EAAU,UAE3C,MAAM8B,EAAiC,GACvC,OAAA9B,EAAkB,QAAeb,GAAA,CAC/B2C,EAAO3C,CAAI,GAAK2C,EAAO3C,CAAI,GAAK,GAAK,EACtC,EAEkB,OAAO,QAAQ2C,CAAM,EACrC,KAAK,CAAC,CAAE,CAAAjW,CAAC,EAAG,CAAE,CAAAC,CAAC,IAAMA,EAAID,CAAC,EAAE,CAAC,EAAE,CAAC,EAEjB,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAUiN,GAAcA,EAAE,YAAa,OAExF,GACF,GACF,CACF,IAoBF,EAGA5Y,OAAC,MAAI,WAAU,wCAEX,WAAQuZ,EAAA,YAAc,OAASA,EAAQ,YAAc,eACpDvZ,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC2kB,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,0BAE3D,QACCpB,EAAgB,MAAMjC,EAAW,KAAK,aAAa,WAAYJ,EAAgB,EAC/E7E,EAAQ,YACNrc,MAAA,OAAI,UAAU,0DACb,SAACA,MAAAojB,EAAA,CAAe,MAAOjB,EAAc,WAAY,MAAM,QAAS,GAClE,GAEJ,GAGA9F,EAAQ,YAAc,OAASA,EAAQ,YAAc,YACrDvZ,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC4kB,GAAS,WAAU,eAAe,cAAY,OAAO,EAAE,uBAE1D,QACCrB,EAAgB,MAAMjC,EAAW,KAAK,UAAU,WAAYJ,EAAgB,EAC5E7E,EAAQ,YACNrc,MAAA,OAAI,UAAU,0DACb,SAACA,MAAAojB,EAAA,CAAe,MAAOjB,EAAc,QAAS,MAAM,QAAS,GAC/D,GAEJ,GAEJ,EAGArf,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAA9C,EAAA,IAAC2kB,GAAU,WAAU,eAAe,cAAY,OAAO,EAAE,sBAE3D,EAEC3kB,EAAA,WAAI,UAAU,wCACZ,gBAAO,QAAQ0hB,CAAiB,EAAE,IAAI,CAAC,CAACmD,EAAWC,CAAY,WAC7D,MACC,WAAChiB,OAAA,MAAG,UAAU,uEACX,UAAA+hB,EAAU,WACb,EACC7kB,MAAA,OAAI,UAAU,YACZ,WAAa,IAAKkkB,GACjBlkB,MAAC,OAAwB,UAAU,oBACjC,SAAC8C,OAAA,OAAI,UAAU,SACb,UAACA,OAAA,OAAI,UAAU,oCACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,mCAAoC,SAAAkkB,EAAK,SAAS,EAClEphB,OAAC,OAAK,WAAU,mCAAoC,UAAKohB,EAAA,MAAM,KAAGA,EAAK,WAAW,QAAQ,CAAC,EAAE,MAAE,GACjG,EACAlkB,MAAC,MAAI,WAAU,uDACb,SAAAA,EAAA,IAAC,OACC,UAAW,oBAAoBkkB,EAAK,KAAK,sCACzC,MAAO,CAAE,mBAAoB,GAAGA,EAAK,UAAU,GAAI,IAEvD,GACF,CAZQ,EAAAA,EAAK,QAaf,CACD,CACH,KArBQW,CAsBV,CACD,EACH,GACF,EAGA/hB,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAACA,OAAA,MAAG,UAAU,wEACZ,UAAA9C,EAAA,IAACqL,GAAM,WAAU,eAAe,cAAY,OAAO,EAAE,4BAEvD,QACClD,GAAK,IAAG,YAAY,UAAU,+DAA+D,SAE9F,yBACF,EAECnI,EAAA,WAAI,UAAU,YACZ,WAAiB,MAAM,EAAG,CAAC,EAAE,IAAK2O,YAChC7L,SAAA,YAA4B,UAAU,+EACrC,UAAA9C,MAAC,OAAI,UAAU,SACb,SAAC8C,EAAA,YAAI,UAAU,8BACb,UAAA9C,MAAC,OAAI,UAAW,wBACd2O,EAAQ,SAAW,YAAc,eACjCA,EAAQ,SAAW,aAAe,cAClCA,EAAQ,SAAW,SAAW,aAAe,aAC/C,GAAI,SACH,MACC,WAAC3O,EAAA,SAAE,UAAU,oDACV,SAAQ2O,EAAA,eAAiB,WAAWA,EAAQ,UAAU,MAAM,EAAE,CAAC,GAClE,QACC,IAAE,WAAU,2CACV,SAAmBlR,GAAAkR,EAAQ,SAAS,EACvC,GACF,GACF,CACF,GAEA7L,OAAC,MAAI,WAAU,8BACX,YAAA8L,EAAAD,EAAQ,aAAR,YAAAC,EAA4B,6BAC3B9L,EAAA,YAAI,UAAU,aACb,UAAC9C,EAAA,SAAE,UAAU,2CAA2C,SAAU,qBACjE,IAAE,WAAU,oDACT,SAAQ2O,EAAA,WAAmB,2BAA2B,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAU+M,GAAcA,EAAE,YAAa,GAC5H,GACF,IAEA7M,EAAAF,EAAQ,aAAR,YAAAE,EAA4B,0BAC3B/L,EAAA,YAAI,UAAU,aACb,UAAC9C,EAAA,SAAE,UAAU,2CAA2C,SAAO,kBAC9D,IAAE,WAAU,oDACT,SAAQ2O,EAAA,WAAmB,wBAAwB,QAAQ,KAAM,GAAG,EAAE,QAAQ,QAAU+M,GAAcA,EAAE,YAAa,GACzH,GACF,EAEF1b,EAAA,IAACmI,GAAA,CACC,GAAI,aAAawG,EAAQ,SAAS,GAClC,UAAU,uDACV,aAAY,gBAAgBA,EAAQ,SAAS,GAE7C,SAAC3O,EAAA,IAAAwL,GAAA,CAAI,UAAU,UAAU,cAAY,OAAO,EAC9C,GACF,CA3CQ,GAAAmD,EAAQ,SA4ClB,EACD,EACH,GACF,GACF,CAEJ,GAEJ,EC5yBMoW,GAAgB,CAAChlB,EAAeilB,IAC7BA,EAAQ,EAAI,KAAK,MAAOjlB,EAAQilB,EAAS,GAAG,EAAI,EAInDC,GAAwBC,GAAsD,CAClF,MAAMC,EAAgBD,EAAY,OAC5BE,EAAc,IAAI,IAAIF,EAAY,IAASvH,KAAE,MAAM,CAAC,EAAE,KAEtD0H,EAAoBH,EAAY,OACpCvH,KAAE,SAAW,aAAeA,EAAE,SAAW,aAGrCM,EAAiBiH,EAAY,OAAOvH,GACxCA,EAAE,SAAW,UAGT2H,EAAqBJ,EAAY,OAAOvH,GAC5CA,EAAE,SAAW,cAIT4H,EAAcR,GAAcM,EAAkB,OAAQF,CAAa,EACnEK,EAAqBJ,EAAc,EAAI,KAAK,MAAOD,EAAgBC,EAAe,EAAE,EAAI,GAAK,EAG7FK,EAAqB,IAAI,KAAK,KAAK,MAAQ,GAAK,GAAK,GAAK,GAAI,EAC9DC,EAAiBR,EAAY,OACjCvH,GAAA,IAAI,KAAKA,EAAE,SAAS,EAAI8H,CACxB,SAGIE,EAAa,CACjB,IAAK,EACL,OAAQ,EACR,KAAM,EACN,QAAS,GAGXT,EAAY,QAAmBvW,GAAA,OACvB,MAAA4Q,IAAY3Q,EAAAD,EAAQ,kBAAR,YAAAC,EAAyB,YAAa,UACpD2Q,KAAaoG,GACfA,EAAWpG,CAAoC,GACjD,CACD,EAGD,MAAMwD,EAAmB,CACvB,WAAY,EACZ,iBAAkB,EAClB,mBAAoB,EACpB,OAAQ,GAIJE,EAAgB,CACpB,cAAe,EACf,KAAM,EACN,SAAU,EACV,kBAAmB,EACnB,OAAQ,GAGVoC,EAAkB,QAAmB1W,GAAA,aAEnC,IAAIiX,EAAoC,KACpCC,EAAiC,KAGrC,GAAIlX,EAAQ,WAAY,CACtB,MAAM8N,EAAa9N,EAAQ,WACNiX,EAAAnJ,EAAW,0BAA4BA,EAAW,2BACrDoJ,EAAApJ,EAAW,uBAAyBA,EAAW,uBACnE,CAGI,IAACmJ,KAAsBhX,EAAAD,EAAQ,kBAAR,YAAAC,EAAyB,mBAAoB,QAAQC,EAAAF,EAAQ,kBAAR,YAAAE,EAAyB,mBAAoB,OAAW,CAChI,MAAAiT,EAAQnT,EAAQ,gBAAgB,gBAElCmT,GAAS,GAAKA,GAAS,EAAwB8D,EAAA,aAC1C9D,GAAS,GAAKA,GAAS,GACvBA,GAAS,IAAMA,GAAS,GADuB8D,EAAA,mBAE/C9D,GAAS,IAAMA,GAAS,GAAyB8D,EAAA,qBACjD9D,GAAS,KAAyB8D,EAAA,SAC7C,CAEI,IAACC,KAAmBhR,EAAAlG,EAAQ,kBAAR,YAAAkG,EAAyB,gBAAiB,QAAQC,EAAAnG,EAAQ,kBAAR,YAAAmG,EAAyB,gBAAiB,OAAW,CACvH,MAAAgN,EAAQnT,EAAQ,gBAAgB,aAElCmT,GAAS,GAAKA,GAAS,EAAqB+D,EAAA,gBACvC/D,GAAS,GAAKA,GAAS,EAAqB+D,EAAA,OAC5C/D,GAAS,IAAMA,GAAS,GAAsB+D,EAAA,WAC9C/D,GAAS,IAAMA,GAAS,GAAsB+D,EAAA,oBAC9C/D,GAAS,KAAsB+D,EAAA,SAC1C,CAGID,GAAsBA,KAAsB7C,GAC9CA,EAAiB6C,CAAmD,IAGlEC,GAAmBA,KAAmB5C,GACxCA,EAAc4C,CAA6C,GAC7D,CACD,EAGD,MAAMC,EAAW,GACjB,QAAS7pB,EAAI,EAAGA,GAAK,EAAGA,IAAK,CACrB,MAAAyB,MAAW,KACjBA,EAAK,QAAQA,EAAK,QAAQ,EAAIzB,CAAC,EAC/B,MAAMwoB,EAAU/mB,EAAK,cAAc,MAAM,GAAG,EAAE,CAAC,EAEzCqoB,EAAiBb,EAAY,UACjCvH,EAAE,UAAU,MAAM,GAAG,EAAE,CAAC,IAAM8G,CAC9B,SAEFqB,EAAS,KAAK,CACZ,KAAMrB,EACN,MAAOsB,CAAA,CACR,CACH,CAGM,MAAAC,MAAmB,IAOzBd,EAAY,QAAmBvW,GAAA,CAEvB,MAAAsX,EAAiBtX,EAAQ,kBAAoBA,EAAQ,OAEtDqX,EAAa,IAAIC,CAAc,GAClCD,EAAa,IAAIC,EAAgB,CAC/B,cAAe,EACf,mBAAoB,EACpB,SAAU,CAAC,EACZ,EAEGC,QAAYF,EAAa,IAAIC,CAAc,EACjDC,EAAU,gBACVA,EAAU,SAAS,KAAKvX,CAAO,GAC3BA,EAAQ,SAAW,aAAeA,EAAQ,SAAW,cACvDuX,EAAU,oBACZ,CACD,EAGD,MAAMA,EAAY,MAAM,KAAKF,EAAa,SAAS,EAAE,IAAI,CAAC,CAAChpB,EAAQ8lB,CAAK,IAAM,OAC5E,MAAMyC,EAAcR,GAAcjC,EAAM,mBAAoBA,EAAM,aAAa,EAGzEqD,EAAqBrD,EAAM,SAAS,OACxCnF,KAAE,SAAW,aAAeA,EAAE,SAAW,aAGrCyI,EAAmBD,EACtB,IAASxI,GAAA,cAAA/O,EAAA+O,EAAE,kBAAF,YAAA/O,EAAmB,WAAU,EACtC,OAAOyX,GAAKA,GAAM,MAA2B,OAAOA,GAAM,QAAQ,EAE/DC,EAAgBF,EAAiB,OAAS,EAC5CA,EAAiB,OAAO,CAACG,EAAKF,IAAME,EAAMF,EAAI,CAAC,EAAID,EAAiB,OACpE,EAGEI,EAAuB,CAC3B,IAAK,EACL,OAAQ,EACR,KAAM,EACN,QAAS,GAGL1D,EAAA,SAAS,QAAmBnU,GAAA,OAC1B,MAAA4Q,IAAY3Q,EAAAD,EAAQ,kBAAR,YAAAC,EAAyB,YAAa,UACpD2Q,KAAaiH,GACfA,EAAqBjH,CAA8C,GACrE,CACD,EAGD,MAAMkH,EAAuB,CAC3B,WAAY,EACZ,iBAAkB,EAClB,mBAAoB,EACpB,OAAQ,GAGJC,EAAoB,CACxB,cAAe,EACf,KAAM,EACN,SAAU,EACV,kBAAmB,EACnB,OAAQ,GAGVP,EAAmB,QAAmBxX,GAAA,eAEpC,IAAIiX,EAAoC,KACpCC,EAAiC,KAGrC,GAAIlX,EAAQ,WAAY,CACtB,MAAM8N,EAAa9N,EAAQ,WACNiX,EAAAnJ,EAAW,0BAA4BA,EAAW,2BACrDoJ,EAAApJ,EAAW,uBAAyBA,EAAW,uBACnE,CAGI,IAACmJ,KAAsBhX,GAAAD,EAAQ,kBAAR,YAAAC,GAAyB,mBAAoB,QAAQC,GAAAF,EAAQ,kBAAR,YAAAE,GAAyB,mBAAoB,OAAW,CAChI,MAAAiT,EAAQnT,EAAQ,gBAAgB,gBAElCmT,GAAS,GAAKA,GAAS,EAAwB8D,EAAA,aAC1C9D,GAAS,GAAKA,GAAS,GACvBA,GAAS,IAAMA,GAAS,GADuB8D,EAAA,mBAE/C9D,GAAS,IAAMA,GAAS,GAAyB8D,EAAA,qBACjD9D,GAAS,KAAyB8D,EAAA,SAC7C,CAEI,IAACC,KAAmBhR,EAAAlG,EAAQ,kBAAR,YAAAkG,EAAyB,gBAAiB,QAAQC,EAAAnG,EAAQ,kBAAR,YAAAmG,EAAyB,gBAAiB,OAAW,CACvH,MAAAgN,EAAQnT,EAAQ,gBAAgB,aAElCmT,GAAS,GAAKA,GAAS,EAAqB+D,EAAA,gBACvC/D,GAAS,GAAKA,GAAS,EAAqB+D,EAAA,OAC5C/D,GAAS,IAAMA,GAAS,GAAsB+D,EAAA,WAC9C/D,GAAS,IAAMA,GAAS,GAAsB+D,EAAA,oBAC9C/D,GAAS,KAAsB+D,EAAA,SAC1C,CAGID,GAAsBA,KAAsBa,GAC9CA,EAAqBb,CAAuD,IAG1EC,GAAmBA,KAAmBa,GACxCA,EAAkBb,CAAiD,GACrE,CACD,EAGD,MAAMc,EAAe7D,EAAM,SAAS,OAAO,CAAC8D,EAAQjY,IAC3C,IAAI,KAAKA,EAAQ,SAAS,EAAI,IAAI,KAAKiY,CAAM,EAAIjY,EAAQ,UAAYiY,IAC3EhY,EAAAkU,EAAM,SAAS,CAAC,IAAhB,YAAAlU,EAAmB,YAAiB,WAAO,aAAa,EAEpD,OACL,OAAA5R,EACA,cAAe8lB,EAAM,cACrB,mBAAoBA,EAAM,mBAC1B,YAAAyC,EACA,cAAe,KAAK,MAAMe,EAAgB,GAAG,EAAI,IACjD,iBAAkBE,EAClB,aAAAG,EACA,iBAAkBF,EAClB,cAAeC,CAAA,CACjB,CACD,EAAE,KAAK,CAACjY,EAAGC,IAAMA,EAAE,cAAgBD,EAAE,aAAa,EAG7CoY,EAAe,CACnB,gBAAiB,CAAC,EAClB,mBAAoB,CAAC,EACrB,iBAAkB,CAAC,EACnB,sBAAuB,CAAC,EACxB,qBAAsB,CAAC,EACvB,mBAAoB,CAAC,EACrB,oBAAqB,CAAC,GAIlBC,EAAqBnY,GAA0C,SAEnE,GAAIA,EAAQ,WAAY,CACtB,MAAM8N,EAAa9N,EAAQ,WACrBiX,EAAqBnJ,EAAW,0BAA4BA,EAAW,2BACtE,OAAAmJ,IAAuB,sBAAwBA,IAAuB,QAC/E,CAEA,QAAIhX,EAAAD,EAAQ,kBAAR,YAAAC,EAAyB,mBAAoB,QAAQC,EAAAF,EAAQ,kBAAR,YAAAE,EAAyB,mBAAoB,OAC7FF,EAAQ,gBAAgB,iBAAmB,GAE7C,IAGHoY,EAAkBpY,GAA0C,SAEhE,GAAIA,EAAQ,WAAY,CACtB,MAAM8N,EAAa9N,EAAQ,WACrBkX,EAAkBpJ,EAAW,uBAAyBA,EAAW,wBACvE,OAAOoJ,IAAoB,YAAcA,IAAoB,qBAAuBA,IAAoB,QAC1G,CAEA,QAAIjX,EAAAD,EAAQ,kBAAR,YAAAC,EAAyB,gBAAiB,QAAQC,EAAAF,EAAQ,kBAAR,YAAAE,EAAyB,gBAAiB,OACvFF,EAAQ,gBAAgB,cAAgB,GAE1C,IAMT,OAF6BuW,EAAY,OAAOvW,GAAWA,EAAQ,YAAY,EAE1D,QAAmBA,GAAA,CACtC,MAAMwK,EAAWxK,EAAQ,aACnBqY,EAAgBF,EAAkBnY,CAAO,EACzCsY,EAAaF,EAAepY,CAAO,EAGzC,GAAIwK,EAAS,IAAK,CACZ,IAAA+N,EACA/N,EAAS,IAAM,GAAe+N,EAAA,QACzB/N,EAAS,IAAM,GAAe+N,EAAA,QAC9B/N,EAAS,IAAM,GAAe+N,EAAA,QAC9B/N,EAAS,IAAM,GAAe+N,EAAA,QAC9B/N,EAAS,IAAM,GAAe+N,EAAA,QACvBA,EAAA,MAEXL,EAAa,gBAAgBK,CAAQ,IAC3BL,EAAA,gBAAgBK,CAAQ,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAEpFL,EAAA,gBAAgBK,CAAQ,EAAE,gBACnCF,GAA4BH,EAAA,gBAAgBK,CAAQ,EAAE,kBACtDD,GAAyBJ,EAAA,gBAAgBK,CAAQ,EAAE,cACzD,CAGA,GAAI/N,EAAS,OAAQ,CACnB,MAAMgO,EAAShO,EAAS,OACnB0N,EAAa,mBAAmBM,CAAM,IAC5BN,EAAA,mBAAmBM,CAAM,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAErFN,EAAA,mBAAmBM,CAAM,EAAE,gBACpCH,GAA4BH,EAAA,mBAAmBM,CAAM,EAAE,kBACvDF,GAAyBJ,EAAA,mBAAmBM,CAAM,EAAE,cAC1D,CAGA,GAAIhO,EAAS,KAAM,CACjB,MAAMiO,EAAOjO,EAAS,KACjB0N,EAAa,iBAAiBO,CAAI,IACxBP,EAAA,iBAAiBO,CAAI,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAEjFP,EAAA,iBAAiBO,CAAI,EAAE,gBAChCJ,GAA4BH,EAAA,iBAAiBO,CAAI,EAAE,kBACnDH,GAAyBJ,EAAA,iBAAiBO,CAAI,EAAE,cACtD,CAGA,GAAIjO,EAAS,UAAW,CACtB,MAAMkO,EAAYlO,EAAS,UACtB0N,EAAa,sBAAsBQ,CAAS,IAClCR,EAAA,sBAAsBQ,CAAS,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAE3FR,EAAA,sBAAsBQ,CAAS,EAAE,gBAC1CL,GAA4BH,EAAA,sBAAsBQ,CAAS,EAAE,kBAC7DJ,GAAyBJ,EAAA,sBAAsBQ,CAAS,EAAE,cAChE,CAGI,GAAAlO,EAAS,WAAa,OAAW,CAC7B,MAAAmO,EAAWnO,EAAS,SAAW,UAAY,QAC5C0N,EAAa,qBAAqBS,CAAQ,IAChCT,EAAA,qBAAqBS,CAAQ,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAEzFT,EAAA,qBAAqBS,CAAQ,EAAE,gBACxCN,GAA4BH,EAAA,qBAAqBS,CAAQ,EAAE,kBAC3DL,GAAyBJ,EAAA,qBAAqBS,CAAQ,EAAE,cAC9D,CAGA,GAAInO,EAAS,OAAQ,CACf,IAAAoO,EACApO,EAAS,OAAS,IAAmBoO,EAAA,gBAChCpO,EAAS,OAAS,IAAmBoO,EAAA,cACrCpO,EAAS,OAAS,IAAmBoO,EAAA,cACrCpO,EAAS,OAAS,IAAmBoO,EAAA,cAC3BA,EAAA,WAEdV,EAAa,mBAAmBU,CAAW,IACjCV,EAAA,mBAAmBU,CAAW,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAE1FV,EAAA,mBAAmBU,CAAW,EAAE,gBACzCP,GAA4BH,EAAA,mBAAmBU,CAAW,EAAE,kBAC5DN,GAAyBJ,EAAA,mBAAmBU,CAAW,EAAE,cAC/D,CAGA,GAAIpO,EAAS,QAAS,CACpB,MAAMqO,EAAYrO,EAAS,QAAQ,UAAU,EAAG,CAAC,EAC7C,IAAAsO,EAEA,CAAC,IAAK,IAAK,GAAG,EAAE,KAAe3U,GAAA0U,EAAU,WAAW1U,CAAM,CAAC,EAAY2U,EAAA,YAClE,CAAC,IAAK,GAAG,EAAE,KAAe3U,GAAA0U,EAAU,WAAW1U,CAAM,CAAC,EAAY2U,EAAA,YAClE,CAAC,IAAK,GAAG,EAAE,KAAe3U,GAAA0U,EAAU,WAAW1U,CAAM,CAAC,EAAY2U,EAAA,gBAClE,CAAC,IAAK,GAAG,EAAE,KAAe3U,GAAA0U,EAAU,WAAW1U,CAAM,CAAC,EAAY2U,EAAA,gBAClE,CAAC,GAAG,EAAE,QAAeD,EAAU,WAAW1U,CAAM,CAAC,EAAY2U,EAAA,UACxDA,EAAA,sBAETZ,EAAa,oBAAoBY,CAAM,IAC7BZ,EAAA,oBAAoBY,CAAM,EAAI,CAAE,gBAAiB,EAAG,aAAc,EAAG,cAAe,IAEtFZ,EAAA,oBAAoBY,CAAM,EAAE,gBACrCT,GAA4BH,EAAA,oBAAoBY,CAAM,EAAE,kBACxDR,GAAyBJ,EAAA,oBAAoBY,CAAM,EAAE,cAC3D,EACD,EAEM,CACL,SAAU,CACR,cAAAtC,EACA,YAAAC,EACA,YAAAG,EACA,mBAAAC,EACA,eAAAE,CACF,EACA,cAAe,CACb,UAAWL,EAAkB,OAC7B,OAAQpH,EAAe,OACvB,WAAYqH,EAAmB,OAC/B,MAAOH,CACT,EACA,WAAY,CACV,GAAGQ,EACH,MAAOR,CACT,EACA,YAAa,CACX,WAAY,CACV,GAAGpC,EACH,MAAOsC,EAAkB,MAC3B,EACA,QAAS,CACP,GAAGpC,EACH,MAAOoC,EAAkB,MAC3B,CACF,EACA,SAAAS,EACA,iBAAkBH,EAClB,UAAAO,EACA,aAAAW,CAAA,CAEJ,EAKMa,GAOD,CAAC,CAAE,MAAAvR,EAAO,MAAApW,EAAO,SAAA4nB,EAAU,KAAAtf,EAAM,MAAAgb,EAAO,MAAAzZ,EAAQ,eAAgB,IAClE9G,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,OAAI,UAAU,oCACb,UAACA,OAAA,OAAI,UAAU,SACb,UAAC9C,EAAA,SAAE,UAAU,uDAAwD,SAAMmW,EAAA,QAC1E,IAAE,WAAW,sBAAsBvM,CAAK,wBAA0B,SAAM7J,EAAA,EACxE4nB,GACC3nB,EAAA,IAAC,IAAE,WAAU,gDAAiD,SAAS2nB,EAAA,GAE3E,QACC,MAAI,WAAW,iDAAiD/d,CAAK,GACnE,SACHvB,EAAA,GACF,EACCgb,GACCvgB,EAAA,KAAC,MAAI,WAAU,yBACZ,UAAAugB,IAAU,MAAQrjB,EAAA,IAAC+M,GAAW,WAAU,8BAA8B,EACtEsW,IAAU,QAAWrjB,EAAA,IAAA8M,GAAA,CAAa,UAAU,4BAA4B,QACxE,OAAK,WAAW,WACfuW,IAAU,KAAO,iBAAmBA,IAAU,OAAS,eAAiB,eAC1E,GACG,SAAUA,IAAA,KAAO,cAAgBA,IAAU,OAAS,gBAAkB,SACzE,GACF,EAEJ,GAIIuE,GAID,CAAC,CAAE,MAAAzR,EAAO,KAAA5Q,EAAM,MAAAyf,KACnBliB,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAC9EnW,MAAC,OAAI,UAAU,YACZ,WAAK,IAAI,CAACkkB,EAAM7a,IAAU,CACzB,MAAM4Y,EAAa8C,GAAcb,EAAK,MAAOc,CAAK,EAClD,cACG,MACC,WAACliB,OAAA,OAAI,UAAU,oCACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,mCAAoC,SAAAkkB,EAAK,MAAM,EAC/DphB,OAAC,OAAK,WAAU,4CACb,UAAKohB,EAAA,MAAM,KAAGjC,EAAW,MAC5B,GACF,EACAjiB,MAAC,MAAI,WAAU,uDACb,SAAAA,EAAA,IAAC,OACC,UAAW,gDAAgDkkB,EAAK,KAAK,GACrE,MAAO,CAAE,MAAO,GAAGjC,CAAU,GAAI,EACjC,KAAK,cACL,aAAY,GAAGiC,EAAK,KAAK,KAAKA,EAAK,KAAK,KAAKjC,CAAU,OAE3D,IAdQ5Y,CAeV,CAEH,GACH,EACF,GAIIwe,GAGD,CAAC,CAAE,MAAA1R,EAAO,KAAA5Q,KAAW,CAClB,MAAAuiB,EAAW,KAAK,IAAI,GAAGviB,EAAK,IAASme,KAAE,KAAK,EAAG,CAAC,EAChDqE,EAAW,EACXlE,EAAQiE,EAAWC,GAAY,EAGnC,OAAAjlB,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAG9EnW,MAAC,MAAI,WAAU,gBAEb,SAAA8C,EAAA,KAAC,OACC,UAAU,iCACV,QAAQ,cACR,oBAAoB,OAGpB,UAAAA,OAAC,OACC,WAAC9C,MAAA,WAAQ,GAAG,OAAO,MAAM,KAAK,OAAO,KAAK,aAAa,iBACrD,SAAAA,EAAA,IAAC,QACC,EAAE,oBACF,KAAK,OACL,OAAO,mBACP,YAAY,MACZ,UAAU,yBAEd,EACA8C,OAAC,iBAAe,IAAG,cAAc,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IACvD,UAAA9C,MAAC,QAAK,OAAO,KAAK,UAAU,kBAAkB,YAAY,MAAK,QAC9D,OAAK,QAAO,OAAO,UAAU,kBAAkB,YAAY,MAAK,GACnE,GACF,QAGC,OAAK,OAAM,MAAM,OAAO,MAAM,KAAK,aAAa,EAGhDuF,EAAK,IAAI,CAACyiB,EAAO3e,IAAU,CACpB,MAAA4e,EAAW,GAAK1iB,EAAK,OACrB2iB,EAAK7e,GAAS9D,EAAK,OAAS,IAAO,IAAM0iB,GAAYA,EAAW,EAChEE,GAAcH,EAAM,MAAQD,GAAYlE,EAAS,GACjDuE,EAAI,IAAMD,EAGd,OAAAnoB,EAAA,IAAC,QAEC,EAAGkoB,EAAID,EAAW,EAClB,EAAAG,EACA,MAAOH,EAAW,GAClB,OAAQE,EACR,KAAK,oBACL,OAAO,kBACP,YAAY,MACZ,UAAU,+CACV,GAAG,OATE9e,CAAA,CAUP,CAEH,KAEL,EAGArJ,MAAC,OAAI,UAAU,8CACZ,WAAK,IAAI,CAACkkB,EAAM7a,IAAU,CACzB,MAAM3L,EAAO,IAAI,KAAKwmB,EAAK,IAAI,EACzBmE,EAAU3qB,EAAK,mBAAmB,QAAS,CAAE,QAAS,QAAS,EAC/D4qB,EAAW5qB,EAAK,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,UAAW,EAGlF,OAAAoF,EAAA,KAAC,MAAgB,WAAU,qBACzB,UAAC9C,EAAA,WAAI,UAAU,oDACZ,SACHqoB,EAAA,EACCroB,EAAA,WAAI,UAAU,2CACZ,SACHsoB,EAAA,EACCtoB,EAAA,WAAI,UAAU,0DACZ,WAAK,MACR,IATQqJ,CAUV,CAEH,GACH,CACF,GAEJ,EAGMkf,GAID,CAAC,CAAE,MAAApS,EAAO,KAAA5Q,EAAM,SAAAoiB,KAAe,CAC5B,MAAA/F,EAAa,OAAO,KAAKrc,CAAI,EAE/B,OAAAqc,EAAW,SAAW,EAEtB9e,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAC7EwR,GACC3nB,EAAA,IAAC,IAAE,WAAU,gDAAiD,SAAS2nB,EAAA,EAExE3nB,EAAA,SAAE,UAAU,oDAAoD,SAEjE,8CACF,IAKF8C,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAC7EwR,GACC3nB,EAAA,IAAC,IAAE,WAAU,gDAAiD,SAAS2nB,EAAA,EAGzE3nB,MAAC,OAAI,UAAU,YACZ,WAAW,IAAI,CAACyb,EAAUpS,IAAU,CAC7B,MAAAmf,EAAejjB,EAAKkW,CAAQ,EAC5BgN,EAAiBD,EAAa,cAAgB,EAC/CA,EAAa,gBAAkBA,EAAa,cAAiB,IAC9D,EACEE,EAAcF,EAAa,cAAgB,EAC5CA,EAAa,aAAeA,EAAa,cAAiB,IAC3D,EAGF,OAAA1lB,EAAA,KAAC,MAAgB,WAAU,6CACzB,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,UAAG,UAAU,4CAA6C,SAASyb,EAAA,EACpE3Y,OAAC,OAAK,WAAU,2CACb,UAAa0lB,EAAA,cAAc,aAC9B,GACF,EAGA1lB,OAAC,MAAI,WAAU,OACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,YAAK,UAAU,2CAA2C,SAAgB,qBAC3E8C,OAAC,OAAK,WAAU,qDACb,UAAa0lB,EAAA,gBAAgB,KAAGC,EAAe,QAAQ,CAAC,EAAE,MAC7D,GACF,EACAzoB,MAAC,MAAI,WAAU,uDACb,SAAAA,EAAA,IAAC,OACC,UAAU,0DACV,MAAO,CAAE,MAAO,GAAGyoB,CAAc,GAAI,EACrC,KAAK,cACL,aAAY,oBAAoBA,EAAe,QAAQ,CAAC,CAAC,MAE7D,GACF,SAGC,MACC,WAAC3lB,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,YAAK,UAAU,2CAA2C,SAAa,kBACxE8C,OAAC,OAAK,WAAU,2DACb,UAAa0lB,EAAA,aAAa,KAAGE,EAAY,QAAQ,CAAC,EAAE,MACvD,GACF,EACA1oB,MAAC,MAAI,WAAU,uDACb,SAAAA,EAAA,IAAC,OACC,UAAU,6DACV,MAAO,CAAE,MAAO,GAAG0oB,CAAW,GAAI,EAClC,KAAK,cACL,aAAY,iBAAiBA,EAAY,QAAQ,CAAC,CAAC,MAEvD,GACF,IA1CQrf,CA2CV,CAEH,GACH,QAGC,MAAI,WAAU,qDACb,SAACvG,EAAA,YAAI,UAAU,qCACb,UAAAA,OAAC,MACC,WAAA9C,EAAA,IAAC,MAAI,WAAU,mDACZ,SAAA4hB,EAAW,OAAO,CAAC2E,EAAKxE,IAAQwE,EAAMhhB,EAAKwc,CAAG,EAAE,gBAAiB,CAAC,EACrE,EACC/hB,EAAA,WAAI,UAAU,2CAA2C,SAAsB,4BAClF,SACC,MACC,WAAAA,EAAA,IAAC,MAAI,WAAU,yDACZ,SAAA4hB,EAAW,OAAO,CAAC2E,EAAKxE,IAAQwE,EAAMhhB,EAAKwc,CAAG,EAAE,aAAc,CAAC,EAClE,EACC/hB,EAAA,WAAI,UAAU,2CAA2C,SAAmB,yBAC/E,GACF,CACF,EACF,GAEJ,EAGM2oB,GAID,CAAC,CAAE,MAAAxS,EAAO,eAAAyS,EAAgB,YAAAC,KAAkB,CAE/C,MAAMC,EAAoB,CACxB,CAAE,WAAYF,EAAe,WAAY,QAASC,EAAY,cAAe,SAAU,MAAO,MAAO,cAAe,EACpH,CAAE,WAAYD,EAAe,iBAAkB,QAASC,EAAY,KAAM,SAAU,OAAQ,MAAO,MAAO,EAC1G,CAAE,WAAYD,EAAe,mBAAoB,QAASC,EAAY,SAAU,SAAU,WAAY,MAAO,UAAW,EACxH,CAAE,WAAYD,EAAe,OAAQ,QAASC,EAAY,kBAAoBA,EAAY,OAAQ,SAAU,OAAQ,MAAO,QAAS,GAGhIE,EAAW,KAAK,IACpB,GAAGD,EAAkB,IAASE,GAAA,KAAK,IAAIA,EAAE,WAAYA,EAAE,OAAO,CAAC,EAC/D,IAGIC,EAAYC,GAAqB,CACrC,OAAQA,EAAU,CAChB,IAAK,MAAc,wCACnB,IAAK,OAAe,0CACpB,IAAK,WAAmB,0CACxB,IAAK,OAAe,oCACpB,QAAgB,qCAClB,GAIA,OAAApmB,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAE9EnW,MAAC,OAAI,UAAU,qBACb,gBAAC,MAAI,WAAU,gBAAgB,QAAQ,cAErC,UAACA,EAAA,YACC,SAACA,MAAA,WAAQ,GAAG,kBAAkB,MAAM,KAAK,OAAO,KAAK,aAAa,iBAChE,SAAAA,EAAA,IAAC,QACC,EAAE,oBACF,KAAK,OACL,OAAO,mBACP,YAAY,MACZ,UAAU,yBAEd,CACF,SAEC,OAAK,OAAM,MAAM,OAAO,MAAM,KAAK,wBAAwB,EAG3DA,EAAA,YAAK,GAAG,KAAK,GAAG,MAAM,GAAG,MAAM,GAAG,MAAM,OAAO,mBAAmB,YAAY,IAAI,EAClFA,EAAA,YAAK,GAAG,KAAK,GAAG,MAAM,GAAG,KAAK,GAAG,KAAK,OAAO,mBAAmB,YAAY,IAAI,EAGhF8oB,EAAkB,IAAI,CAACd,EAAO3e,IAAU,CACvC,MAAM6e,EAAI,GAAMF,EAAM,WAAae,EAAY,IACzCX,EAAI,IAAOJ,EAAM,QAAUe,EAAY,IACvCI,EAAS,KAAK,IAAI,KAAK,KAAKnB,EAAM,WAAaA,EAAM,OAAO,EAAI,EAAG,EAAE,EAE3E,cACG,IACC,WAAAhoB,EAAA,IAAC,UACC,GAAIkoB,EACJ,GAAIE,EACJ,EAAGe,EACH,UAAW,GAAGF,EAASjB,EAAM,QAAQ,CAAC,kDACtC,YAAY,IACd,EACAhoB,EAAA,IAAC,QACC,EAAAkoB,EACA,EAAGE,EAAI,EACP,WAAW,SACX,UAAU,+BAET,SAAAJ,EAAM,WAAaA,EAAM,QAC5B,IAfM3e,CAgBR,EAEH,EAGDrJ,MAAC,OAAK,GAAE,MAAM,EAAE,MAAM,WAAW,SAAS,UAAU,uDAAuD,SAE3G,uBACCA,EAAA,YAAK,EAAE,KAAK,EAAE,MAAM,WAAW,SAAS,UAAU,qBAAqB,UAAU,uDAAuD,SAEzI,qBACF,CACF,GAGCA,EAAA,WAAI,UAAU,qCACZ,SAAkB8oB,EAAA,IAAI,CAACd,EAAO3e,IAC7BvG,OAAC,MAAgB,WAAU,8BACzB,UAAA9C,EAAA,IAAC,MAAI,WAAW,wBAAwBipB,EAASjB,EAAM,QAAQ,EAAE,QAAQ,QAAS,KAAK,EAAE,QAAQ,UAAW,SAAS,EAAE,QAAQ,mBAAoB,EAAE,EAAE,QAAQ,oBAAqB,EAAE,EAAE,QAAQ,qBAAsB,EAAE,EAAE,QAAQ,qBAAsB,EAAE,EAAE,QAAQ,kBAAmB,EAAE,CAAC,GAAI,EAC7RhoB,EAAA,YAAK,UAAU,2CAA4C,WAAM,MAAM,IAFhEqJ,CAGV,CACD,EACH,CACF,GAEJ,EAGM+f,GAGD,CAAC,CAAE,MAAAjT,EAAO,cAAAkT,KAAoB,CACjC,MAAMC,EAAS,CACb,CAAE,MAAO,iBAAkB,MAAOD,EAAc,MAAO,MAAO,aAAc,EAC5E,CAAE,MAAO,gBAAiB,MAAOA,EAAc,WAAY,MAAO,eAAgB,EAClF,CAAE,MAAO,YAAa,MAAOA,EAAc,UAAW,MAAO,cAAe,EAC5E,CAAE,MAAO,SAAU,MAAOA,EAAc,OAAQ,MAAO,YAAa,GAGhEN,EAAWM,EAAc,OAAS,EAGtC,OAAAvmB,EAAA,KAAC,MAAI,WAAU,uFACb,UAAC9C,EAAA,UAAG,UAAU,yDAA0D,SAAMmW,EAAA,EAE9EnW,MAAC,OAAI,UAAU,YACZ,WAAO,IAAI,CAACgb,EAAO3R,IAAU,CACtB,MAAAkgB,EAASvO,EAAM,MAAQ+N,EAAY,IACnCS,EAAiBngB,EAAQ,GAAM2R,EAAM,MAAQsO,EAAO,CAAC,EAAE,MAAS,KAAK,QAAQ,CAAC,EAAI,QAGtF,OAAAxmB,EAAA,KAAC,MAAgB,WAAU,WACzB,UAACA,OAAA,OAAI,UAAU,yCACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,uDACb,SAAAgb,EAAM,MACT,EACAlY,OAAC,MAAI,WAAU,8BACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,kDACb,SAAAgb,EAAM,MACT,EACAlY,OAAC,OAAK,WAAU,2CAA2C,cACvD0mB,EAAe,MACnB,GACF,GACF,EAEA1mB,OAAC,MAAI,WAAU,uEACb,UAAA9C,EAAA,IAAC,OACC,UAAW,UAAUgb,EAAM,KAAK,kFAChC,MAAO,CAAE,MAAO,GAAGuO,CAAK,GAAI,EAE3B,WAAQ,IACPvpB,MAAC,QAAK,UAAU,iCACb,WAAM,KACT,GAEJ,EAGCqJ,EAAQigB,EAAO,OAAS,GACvBtpB,MAAC,OAAI,UAAU,sDACb,SAACA,EAAA,WAAI,UAAU,wBAAwB,KAAK,eAAe,QAAQ,YACjE,SAAAA,MAAC,OAAK,UAAS,UAAU,EAAE,2IAA2I,SAAS,SAAU,GAC3L,CACF,IAEJ,IAnCQqJ,CAoCV,CAEH,GACH,QAGC,MAAI,WAAU,kDACb,SAACvG,EAAA,YAAI,UAAU,qCACb,UAAAA,OAAC,MACC,WAACA,OAAA,OAAI,UAAU,uDACV,WAAAumB,EAAc,UAAYA,EAAc,MAAS,KAAK,QAAQ,CAAC,EAAE,KACtE,EACCrpB,EAAA,WAAI,UAAU,2CAA2C,SAAY,kBACxE,SACC,MACC,WAAC8C,OAAA,OAAI,UAAU,mDACV,WAAAumB,EAAc,OAASA,EAAc,MAAS,KAAK,QAAQ,CAAC,EAAE,KACnE,EACCrpB,EAAA,WAAI,UAAU,2CAA2C,SAAY,kBACxE,GACF,CACF,EACF,GAEJ,EAGMypB,GAED,CAAC,CAAE,UAAAvD,KAAgB,CACtB,KAAM,CAACwD,EAAqBC,CAAsB,EAAIpqB,WAAS,EAAK,EAC9D,CAACqqB,EAAeC,CAAgB,EAAItqB,WAAS,EAAK,EAElDuqB,EAAcC,GACL,IAAI,KAAKA,CAAU,EACpB,mBAAmB,QAAS,CACtC,MAAO,QACP,IAAK,UACL,KAAM,UACN,OAAQ,UACT,EAGGC,EAAe,CAACzK,EAAmByC,IAAkB,CACzD,GAAIA,IAAU,EAAU,sBACxB,OAAQzC,EAAW,CACjB,IAAK,MAAc,uBACnB,IAAK,SAAiB,wBACtB,IAAK,OAAe,qBACpB,QAAgB,qBAClB,GAII0K,EAAa/D,EAAU,OACvBV,EAAqByE,EAAa,EACpC,KAAK,MAAM/D,EAAU,OAAO,CAACK,EAAK2D,IAAM3D,EAAM2D,EAAE,cAAe,CAAC,EAAID,EAAa,EAAE,EAAI,GACvF,EACEE,EAAejE,EAAU,OAAS,EACpCA,EAAU,OAAO,CAACkE,EAAMC,IACtBA,EAAQ,cAAgBD,EAAK,cAAgBC,EAAUD,EAAMlE,EAAU,CAAC,CAAC,EAC3E,KAGF,OAAApjB,EAAA,KAAC,MAAI,WAAU,wGACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAACA,OAAA,MAAG,UAAU,sEACZ,UAAC9C,MAAAmN,GAAA,CAAM,UAAU,4BAA6B,GAAE,sBAElD,EAGArK,OAAC,MAAI,WAAU,yBACb,UAACA,OAAA,OAAI,UAAU,cACb,UAAC9C,EAAA,WAAI,UAAU,8CAA+C,SAAWiqB,EAAA,EACxEjqB,EAAA,WAAI,UAAU,mCAAmC,SAAW,iBAC/D,EACA8C,OAAC,MAAI,WAAU,cACb,UAAC9C,EAAA,WAAI,UAAU,8CAA+C,SAAmBwlB,EAAA,EAChFxlB,EAAA,WAAI,UAAU,mCAAmC,SAAY,kBAChE,EACCmqB,GACCrnB,EAAA,KAAC,MAAI,WAAU,cACb,UAACA,OAAA,OAAI,UAAU,8BAAgC,WAAaqnB,EAAA,cAAgB,KAAK,QAAQ,CAAC,EAAE,KAAC,EAC5FnqB,EAAA,WAAI,UAAU,mCAAmC,SAAsB,4BAC1E,GAEJ,GACF,EAECkmB,EAAU,SAAW,EACnBlmB,MAAA,KAAE,UAAU,oDAAoD,kCAEjE,EAEA8C,EAAA,KAAC,MAEC,WAAA9C,MAAC,OAAI,UAAU,iGACb,SAAC8C,EAAA,YAAI,UAAU,8BACb,UAAC9C,EAAA,YAAK,UAAU,uDAAuD,SAEvE,8BACA8C,OAAC,MAAI,WAAU,8BACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAC9C,EAAA,YAAK,UAAU,0GAA0G,SAE1H,MACCA,EAAA,YAAK,UAAU,2CAA2C,SAAQ,cACrE,EACA8C,OAAC,MAAI,WAAU,8BACb,UAAC9C,EAAA,YAAK,UAAU,8GAA8G,SAE9H,MACCA,EAAA,YAAK,UAAU,2CAA2C,SAAW,iBACxE,EACA8C,OAAC,MAAI,WAAU,8BACb,UAAC9C,EAAA,YAAK,UAAU,kGAAkG,SAElH,MACCA,EAAA,YAAK,UAAU,2CAA2C,SAAS,eACtE,GACF,GACF,CACF,SAEC,MAAI,WAAU,8CACf,SAAC8C,EAAA,cAAM,UAAU,iBACf,UAAA9C,MAAC,QACC,UAAA8C,OAAC,KAAG,WAAU,gDACZ,UAAC9C,EAAA,UAAG,UAAU,qEAAqE,SAEnF,YACCA,EAAA,UAAG,UAAU,kEAAkE,SAEhF,aACAA,EAAA,IAAC,KAAG,WAAU,kEACZ,SAAAA,EAAA,IAAC,MAAI,WAAU,6BACb,SAAA8C,OAAC,MAAI,WAAU,8BACb,UAAA9C,MAAC,QAAK,SAAiB,sBACvBA,EAAA,IAAC,UACC,KAAK,SACL,QAAS,IAAM6pB,EAAiB,EAAI,EACpC,UAAU,8DACV,aAAW,qCAEX,SAAA7pB,MAAC+L,GAAK,WAAU,0DAA2D,GAC7E,EACF,EACF,GACF,QACC,KAAG,WAAU,2EACZ,SAACjJ,EAAA,YAAI,UAAU,6BACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,MAAC,QAAK,SAAc,mBACpBA,EAAA,IAAC,UACC,KAAK,SACL,QAAS,IAAM2pB,EAAuB,EAAI,EAC1C,UAAU,8DACV,aAAW,sCAEX,SAAA3pB,MAAC+L,GAAK,WAAU,0DAA2D,GAC7E,GACF,EACC/L,EAAA,YAAK,UAAU,4DAA4D,SAE5E,gCACF,CACF,GACCA,EAAA,UAAG,UAAU,iEAAiE,SAE/E,mBACF,CACF,SACC,QACE,UAAAkmB,EAAU,IAAI,CAACviB,EAAM0F,IACpBvG,EAAA,KAAC,MAEC,UAAW,2GACTuG,EAAQ,IAAM,EAAI,8BAAgC,2BACpD,GAEA,UAAArJ,MAAC,MAAG,UAAU,YACZ,SAACA,EAAA,WAAI,UAAU,kDACb,SAAAA,MAAC,MAAI,WAAU,yBAAyB,MAAO2D,EAAK,OACjD,SAAKA,EAAA,OACR,EACF,CACF,GACAb,OAAC,KAAG,WAAU,wBACZ,UAAA9C,EAAA,IAAC,MAAI,WAAU,4CACZ,SAAA2D,EAAK,cACR,EACAb,OAAC,MAAI,WAAU,2CACZ,UAAKa,EAAA,mBAAmB,eAC3B,GACF,QACC,KAAG,WAAU,wBACZ,SAACb,EAAA,YAAI,UAAU,wCACb,UAACA,OAAA,QAAK,UAAW,uBAAuBknB,EAAa,MAAOrmB,EAAK,iBAAiB,GAAG,CAAC,GAAI,eACrFA,EAAK,iBAAiB,KAC3B,EACAb,OAAC,OAAK,WAAW,uBAAuBknB,EAAa,SAAUrmB,EAAK,iBAAiB,MAAM,CAAC,GAAI,eAC3FA,EAAK,iBAAiB,QAC3B,EACAb,OAAC,OAAK,WAAW,uBAAuBknB,EAAa,OAAQrmB,EAAK,iBAAiB,IAAI,CAAC,GAAI,eACvFA,EAAK,iBAAiB,MAC3B,GACF,CACF,SACC,KAAG,WAAU,wBACZ,SAACb,EAAA,YAAI,UAAU,4CACX,WAAKa,EAAA,cAAgB,KAAK,QAAQ,CAAC,EAAE,KACzC,CACF,GACC3D,EAAA,UAAG,UAAU,uBACZ,SAACA,MAAA,OAAI,UAAU,2CACZ,SAAW8pB,EAAAnmB,EAAK,YAAY,CAC/B,GACF,IA1CKA,EAAK,MA4Cb,GACH,GACF,CACF,IACA,EAID+lB,GACE1pB,MAAA,OAAI,UAAU,6EAA6E,QAAS,IAAM2pB,EAAuB,EAAK,EACrI,SAAC7mB,OAAA,OAAI,UAAU,2EAA2E,QAAUhD,GAAMA,EAAE,gBAC1G,YAACgD,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,UAAG,UAAU,sDAAsD,SAA8B,mCAClGA,EAAA,IAAC,UACC,KAAK,SACL,QAAS,IAAM2pB,EAAuB,EAAK,EAC3C,UAAU,yHACV,aAAW,cAEX,SAAA3pB,MAACsN,GAAE,WAAU,SAAU,GACzB,GACF,EACAxK,OAAC,MAAI,WAAU,qDACb,UAAC9C,EAAA,WAAI,UAAU,6DAA6D,SAA+B,oCAC3G8C,OAAC,MAAI,WAAU,YACb,UAAA9C,MAAC,OAAI,SAA4C,iDACjDA,MAAC,OAAI,SAAkD,uDACvDA,MAAC,OAAI,SAAkD,uDACvDA,MAAC,OAAI,SAAkD,wDACzD,EACCA,EAAA,WAAI,UAAU,+GAA+G,SAE9H,qCACF,GACF,CACF,GAID4pB,GACE5pB,MAAA,OAAI,UAAU,6EAA6E,QAAS,IAAM6pB,EAAiB,EAAK,EAC/H,SAAC/mB,OAAA,OAAI,UAAU,2EAA2E,QAAUhD,GAAMA,EAAE,gBAC1G,YAACgD,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,UAAG,UAAU,sDAAsD,SAA6B,kCACjGA,EAAA,IAAC,UACC,KAAK,SACL,QAAS,IAAM6pB,EAAiB,EAAK,EACrC,UAAU,yHACV,aAAW,cAEX,SAAA7pB,MAACsN,GAAE,WAAU,SAAU,GACzB,GACF,EACAxK,OAAC,MAAI,WAAU,qDACb,UAAC9C,EAAA,WAAI,UAAU,6DAA6D,SAA8B,mCAC1G8C,OAAC,MAAI,WAAU,YACb,UAAA9C,MAAC,OAAI,SAAgE,qEACrEA,MAAC,OAAI,SAAyD,qEAC7D,MAAI,gBAAEA,MAAC,OAAK,WAAU,qDAAsD,GAAO,gDAA4C,SAC/H,MAAI,gBAAEA,MAAC,OAAK,WAAU,sDAAuD,GAAO,sDAAkD,SACtI,MAAI,gBAAEA,MAAC,OAAK,WAAU,mDAAoD,GAAO,0DAAsD,SACvI,MAAI,gBAAEA,MAAC,OAAK,WAAU,oDAAqD,GAAO,+CAA2C,GAChI,EACCA,EAAA,WAAI,UAAU,+GAA+G,SAE9H,mFACF,GACF,CACF,EAEJ,GAEJ,EAEasqB,GAAyB,IAAM,CAC1C,KAAM,CAACC,EAAWC,CAAY,EAAIjrB,WAA+B,IAAI,EAC/D,CAACwc,EAASC,CAAU,EAAIzc,WAAS,EAAK,EACtC,CAAChB,EAAO+W,CAAQ,EAAI/V,WAA0B,IAAI,EAClD,CAACkrB,EAAaC,CAAc,EAAInrB,WAAe,IAAI,IAAM,EACzD,CAAE,uBAAAf,GAA2BqT,KAG7B8Y,EAAkB,SAAS,IAA2D,EAAI,IAG1FC,EAAgBnkB,cAAY,SAAY,CACxC,IACFuV,EAAW,EAAI,EACf1G,EAAS,IAAI,EAGb,IAAI4P,EAAqC,GAErC,IAEI,MAAAxU,EAAY,KAAK,MACf,YAAI,oDAAqDA,CAAS,EAEpE,MAAAma,EAAsB,MAAMnlB,GAAW,iBAC7Cwf,EAAc2F,EAAoB,SAClC,QAAQ,IAAI,0CAA2C,CACrD,UAAAna,EACA,WAAYwU,EAAY,OACxB,cAAe2F,EAAoB,MACnC,iBAAkB3F,EAAY,MAAM,EAAG,CAAC,EAAE,IAAUvH,IAAA,CAClD,UAAWA,EAAE,UACb,OAAQA,EAAE,OACV,OAAQA,EAAE,OACV,UAAWA,EAAE,WACb,EACH,QACMmN,EAAU,CACT,aAAK,yCAA0CA,CAAQ,EAG/D5F,EAAc,EAChB,CAEM,MAAA6F,EAAiB9F,GAAqBC,CAAW,EACvD,QAAQ,IAAI,yCAA0C,CACpD,cAAe6F,EAAe,SAAS,cACvC,YAAaA,EAAe,SAAS,YACrC,YAAaA,EAAe,SAAS,YACrC,uBAAwBA,EAAe,cACxC,EACDP,EAAaO,CAAc,EACZL,EAAA,IAAI,IAAM,EAEzBlsB,EAAuB,wCAAwC,QACxDua,EAAK,CACZ,MAAM4D,EAAW5D,EACjBzD,EAASqH,CAAQ,EACMne,EAAA,qCAAqCme,EAAS,OAAO,EAAE,SAC9E,CACAX,EAAW,EAAK,CAClB,GACC,CAACxd,CAAsB,CAAC,EAG3BmB,YAAU,IAAM,CACAirB,GAAA,EACb,CAACA,CAAa,CAAC,EAGlBjrB,YAAU,IAAM,CACd,QAAQ,IAAI,0DAA2DgrB,EAAkB,IAAM,SAAS,EAElG,MAAAK,EAAW,YAAY,IAAM,CACzB,YAAI,0DAA2DjP,CAAO,EAEhE6O,KACbD,CAAe,EAElB,MAAO,IAAM,CACX,QAAQ,IAAI,oDAAoD,EAChE,cAAcK,CAAQ,EACxB,EACC,CAACJ,EAAeD,CAAe,CAAC,EAG7B,MAAAM,EAAcxkB,cAAY,IAAM,CACpC6O,EAAS,IAAI,EACCsV,GAAA,EACb,CAACA,CAAa,CAAC,EAElB,OAAI7O,EAEC/b,MAAA,OAAI,UAAU,+CACb,eAAC,MAAI,WAAU,oBACb,SAAAA,EAAA,IAAC,OAAI,UAAU,wCACb,SAAC8C,OAAA,OAAI,UAAU,8BACb,UAAC9C,MAAAwM,GAAA,CAAU,UAAU,oCAAqC,GACzDxM,EAAA,YAAK,UAAU,2CAA2C,SAE3D,iCACF,GACF,GACF,CACF,GAIAzB,EAECyB,MAAA,OAAI,UAAU,+CACb,eAAC,MAAI,WAAU,oBACb,SAAAA,EAAA,IAAC,OAAI,UAAU,wCACb,SAAC8C,OAAA,OAAI,UAAU,cACb,UAAC9C,MAAAqb,GAAA,CAAY,UAAU,qCAAsC,GAC5Drb,EAAA,UAAG,UAAU,2DAA2D,SAEzE,gCACCA,EAAA,SAAE,UAAU,wCACV,WAAM,QACT,EACA8C,EAAA,KAAC,UACC,QAASmoB,EACT,UAAU,2GAEV,UAACjrB,MAAAwM,GAAA,CAAU,UAAU,cAAe,GAAE,SAExC,CACF,GACF,GACF,CACF,GAIC+d,QAeF,MAAI,WAAU,+CACb,SAACznB,EAAA,YAAI,UAAU,oBAEb,UAAA9C,MAAC,OAAI,UAAU,OACb,SAAC8C,EAAA,YAAI,UAAU,oCACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,mDAAmD,SAEjE,YACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,oEACF,EAGA8C,OAAC,MAAI,WAAU,8BACb,UAACA,OAAA,OAAI,UAAU,aACb,UAACA,OAAA,OAAI,UAAU,2CAA2C,2BACzC2nB,EAAY,mBAAmB,GAChD,EACA3nB,OAAC,MAAI,WAAU,2CAA2C,2BACzC6nB,EAAkB,IAAK,eACxC,GACF,EACA3qB,MAAC,MAAI,WAAU,iBACb,SAAA8C,EAAA,KAAC,UACC,QAAS8nB,EACT,SAAU7O,EACV,UAAU,uIACV,aAAW,6BAEX,UAAA/b,MAACwM,IAAU,UAAW,gBAAgBuP,EAAU,eAAiB,EAAE,GAAI,EAAE,aAG7E,GACF,GACF,CACF,GAGAjZ,OAAC,MAAI,WAAU,6CACb,UAAA9C,EAAA,IAAC0nB,GAAA,CACC,MAAM,iBACN,MAAO6C,EAAU,SAAS,cAC1B,SAAS,WACT,KAAMvqB,MAACyK,GAAS,WAAU,SAAU,GACpC,MAAM,gBACR,EACAzK,EAAA,IAAC0nB,GAAA,CACC,MAAM,eACN,MAAO6C,EAAU,SAAS,YAC1B,SAAS,eACT,KAAMvqB,MAACmN,GAAM,WAAU,SAAU,GACjC,MAAM,iBACR,GACF,QAGC,MAAI,WAAU,6CAEb,SAACnN,MAAA,OAAI,UAAU,gBACb,SAAAA,EAAA,IAAC4nB,GAAA,CACC,MAAM,0BACN,KAAM,CACJ,CAAE,MAAO,WAAY,MAAO2C,EAAU,WAAW,IAAK,MAAO,cAAe,EAC5E,CAAE,MAAO,cAAe,MAAOA,EAAU,WAAW,OAAQ,MAAO,eAAgB,EACnF,CAAE,MAAO,YAAa,MAAOA,EAAU,WAAW,KAAM,MAAO,YAAa,EAC5E,CAAE,MAAO,UAAW,MAAOA,EAAU,WAAW,QAAS,MAAO,aAAc,CAChF,EACA,MAAOA,EAAU,WAAW,QAEhC,CACF,GAGAznB,OAAC,MAAI,WAAU,6CAEb,UAAA9C,EAAA,IAAC4nB,GAAA,CACC,MAAM,gCACN,KAAM,CACJ,CAAE,MAAO,aAAc,MAAO2C,EAAU,YAAY,WAAW,WAAY,MAAO,cAAe,EACjG,CAAE,MAAO,mBAAoB,MAAOA,EAAU,YAAY,WAAW,iBAAkB,MAAO,eAAgB,EAC9G,CAAE,MAAO,qBAAsB,MAAOA,EAAU,YAAY,WAAW,mBAAoB,MAAO,eAAgB,EAClH,CAAE,MAAO,SAAU,MAAOA,EAAU,YAAY,WAAW,OAAQ,MAAO,YAAa,CACzF,EACA,MAAOA,EAAU,YAAY,WAAW,MAC1C,EAGAvqB,EAAA,IAAC4nB,GAAA,CACC,MAAM,6BACN,KAAM,CACJ,CAAE,MAAO,gBAAiB,MAAO2C,EAAU,YAAY,QAAQ,cAAe,MAAO,cAAe,EACpG,CAAE,MAAO,OAAQ,MAAOA,EAAU,YAAY,QAAQ,KAAM,MAAO,eAAgB,EACnF,CAAE,MAAO,WAAY,MAAOA,EAAU,YAAY,QAAQ,SAAU,MAAO,eAAgB,EAC3F,CAAE,MAAO,oBAAqB,MAAOA,EAAU,YAAY,QAAQ,kBAAmB,MAAO,YAAa,EAC1G,CAAE,MAAO,SAAU,MAAOA,EAAU,YAAY,QAAQ,OAAQ,MAAO,YAAa,CACtF,EACA,MAAOA,EAAU,YAAY,QAAQ,MACvC,GACF,EAGAvqB,MAAC,OAAI,UAAU,OACb,eAACypB,GAAe,WAAWc,EAAU,UAAW,CAClD,GAGAznB,OAAC,MAAI,WAAU,OACb,UAACA,OAAA,OAAI,UAAU,OACb,UAAC9C,EAAA,UAAG,UAAU,wDAAwD,SAEtE,qCACCA,EAAA,SAAE,UAAU,mCAAmC,SAEhD,sGACF,EAEA8C,OAAC,MAAI,WAAU,wCAEb,UAAC9C,MAAA,OAAI,UAAU,gBACb,SAAAA,EAAA,IAAC2oB,GAAA,CACC,MAAM,oCACN,eAAgB4B,EAAU,YAAY,WACtC,YAAaA,EAAU,YAAY,UAEvC,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,oCACN,SAAS,uEACT,KAAMgC,EAAU,aAAa,gBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,gCACN,SAAS,qDACT,KAAMgC,EAAU,aAAa,mBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,uCACN,SAAS,mDACT,KAAMgC,EAAU,aAAa,mBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,8BACN,SAAS,qDACT,KAAMgC,EAAU,aAAa,iBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,mCACN,SAAS,uDACT,KAAMgC,EAAU,aAAa,sBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,0CACN,SAAS,yDACT,KAAMgC,EAAU,aAAa,qBAC/B,EAGAvqB,EAAA,IAACuoB,GAAA,CACC,MAAM,2CACN,SAAS,sDACT,KAAMgC,EAAU,aAAa,oBAC/B,GACF,GACF,EAGAvqB,MAAC,MAAI,WAAU,OACb,SAAAA,EAAA,IAACopB,GAAA,CACC,MAAM,4BACN,cAAemB,EAAU,gBAE7B,EAGAvqB,MAAC,MAAI,WAAU,OACb,SAAAA,EAAA,IAAC6nB,GAAA,CACC,MAAM,8BACN,KAAM0C,EAAU,WAEpB,EACF,EACF,SAhNG,MAAI,WAAU,+CACb,SAACvqB,MAAA,OAAI,UAAU,oBACb,SAAAA,EAAA,IAAC,OAAI,UAAU,wCACb,eAAC,OAAK,WAAU,2CAA2C,SAE3D,qBACF,EACF,EACF,EA0MN,EC9mDakrB,GAA4B,IAAM,CAC7C,MAAMjnB,EAAWC,KAEjBvE,YAAU,IAAM,CAER,MAAAwrB,EAAQ,WAAW,IAAM,CAC7BlnB,EAAS,2BAA2B,GACnC,GAAI,EAEA,UAAM,aAAaknB,CAAK,GAC9B,CAAClnB,CAAQ,CAAC,EAEb,MAAMmnB,EAAoB,IAAM,CAC9BnnB,EAAS,2BAA2B,GAGtC,aACG,MAAI,WAAU,iIACb,SAACnB,EAAA,YAAI,UAAU,uFACb,UAACA,OAAA,OAAI,UAAU,OACb,UAAA9C,MAAC,OAAI,UAAU,oGACb,eAACkM,GAAc,WAAU,2CAA2C,CACtE,GACClM,EAAA,UAAG,UAAU,wDAAwD,SAEtE,8BACCA,EAAA,SAAE,UAAU,mCAAmC,SAGhD,0HACF,EAEA8C,OAAC,MAAI,WAAU,YACb,UAAAA,EAAA,KAAC,UACC,QAASsoB,EACT,UAAU,yJACX,2CAECprB,MAAC2K,GAAW,WAAU,SAAU,IAClC,EAEC3K,EAAA,SAAE,UAAU,2CAA2C,SAExD,mDACF,EAEA8C,OAAC,MAAI,WAAU,kDACb,UAAC9C,EAAA,UAAG,UAAU,iDAAiD,SAE/D,gBACA8C,OAAC,KAAG,WAAU,+DACZ,UAAA9C,MAAC,MAAG,SAA6B,kCACjCA,MAAC,MAAG,SAA6B,kCACjCA,MAAC,MAAG,SAAuC,4CAC3CA,MAAC,MAAG,SAA4B,kCAClC,GACF,EACF,EACF,EAEJ,ECrDaqrB,GAAN,MAAMA,EAAmB,CAMtB,aAAc,CAJd7mB,EAAA,wBAAkC,IAClCA,EAAA,wBAA2B,IAC3BA,EAAA,qBAAyB,GAEV,CAEvB,OAAO,aAAkC,CACnC,OAAC6mB,GAAmB,WACHA,GAAA,SAAW,IAAIA,IAE7BA,GAAmB,QAC5B,CAGA,OAAO,aAAuB,CAC5B,MAAO,CAAC,EACN,UAAU,cACV,OAAO,UAAU,aAAa,cAAiB,YAC/C,OAAO,UAAU,aAAa,kBAAqB,YACnD,OAAO,aAEX,CAGA,MAAM,mBAAoD,CACpD,IACE,OAACA,GAAmB,gBAQT,MAAM,UAAU,aAAa,aAAa,CACvD,MAAO,GACR,GAGM,YAAY,QAAiBC,KAAM,MAAM,EAEhD,KAAK,cAAgB,GACrB,QAAQ,IAAI,kCAAkC,EAEvC,CAAE,QAAS,KAjBT,CACL,QAAS,GACT,MAAO,sDAiBJ/sB,EAAO,CACN,cAAM,yCAA0CA,CAAK,EAE7D,IAAI6B,EAAe,8BACfmrB,EAAmB,GAEvB,OAAIhtB,aAAiB,QACfA,EAAM,OAAS,kBACF6B,EAAA,qFACN7B,EAAM,OAAS,gBACT6B,EAAA,kEACN7B,EAAM,OAAS,mBACT6B,EAAA,uDACN7B,EAAM,OAAS,uBACT6B,EAAA,qDACN7B,EAAM,OAAS,gBACT6B,EAAA,gDACN7B,EAAM,OAAS,eACT6B,EAAA,6CACImrB,EAAA,KAIhB,CACL,QAAS,GACT,MAAOnrB,EACP,iBAAAmrB,CAAA,CAEJ,CACF,CAGA,MAAM,qBAA8C,CAC9C,IACE,IAAC,KAAK,cAAe,CACjB,MAAAC,EAAa,MAAM,KAAK,oBAC1B,IAACA,EAAW,QACd,MAAM,IAAI,MAAMA,EAAW,OAAS,qCAAqC,CAE7E,CAEA,MAAMC,EAAU,MAAM,UAAU,aAAa,iBAAiB,EAe9D,GAbK,sBAAmBA,EACrB,OAAiBC,KAAO,OAAS,YAAY,EAC7C,IAAI,CAACA,EAAQriB,KAAW,CACvB,SAAUqiB,EAAO,SACjB,MAAOA,EAAO,OAAS,cAAcriB,EAAQ,CAAC,GAC9C,KAAMqiB,EAAO,KACb,QAASA,EAAO,QAChB,UAAWA,EAAO,WAAa,SAC/B,IAEJ,QAAQ,IAAI,YAAY,KAAK,iBAAiB,MAAM,wBAAyB,KAAK,gBAAgB,EAG9F,CAAC,KAAK,kBAAoB,KAAK,iBAAiB,OAAS,EAAG,CACxD,MAAAC,EAAgB,KAAK,iBAAiB,KAAKjI,GAAKA,EAAE,SAAS,GAAK,KAAK,iBAAiB,CAAC,EAC7F,KAAK,iBAAmBiI,EAAc,QACxC,CAEA,OAAO,KAAK,uBAELptB,EAAO,CACN,oBAAM,uCAAwCA,CAAK,EACrD,IAAI,MAAM,qCAAqC,CACvD,CACF,CAGA,kBAAkBqtB,EAAwB,CACxC,MAAMF,EAAS,KAAK,iBAAiB,KAAUhI,KAAE,WAAakI,CAAQ,EAClEF,GACF,KAAK,iBAAmBE,EACxB,QAAQ,IAAI,6BAA6BF,EAAO,KAAK,KAAKE,CAAQ,GAAG,GAE7D,aAAK,8BAA8BA,CAAQ,EAAE,CAEzD,CAGA,mBAAwC,CAC/B,YAAK,iBAAiB,KAAKlI,GAAKA,EAAE,WAAa,KAAK,gBAAgB,GAAK,IAClF,CAGA,MAAM,kBAAkBmI,EAA2D,CAC7E,IACE,IAAC,KAAK,cAAe,CACjB,MAAAL,EAAa,MAAM,KAAK,oBAC1B,IAACA,EAAW,QACd,MAAM,IAAI,MAAMA,EAAW,OAAS,gCAAgC,CAExE,CAEA,MAAMM,EAA0C,CAC9C,SAAU,KAAK,iBAAmB,CAAE,MAAO,KAAK,gBAAqB,SACrE,WAAY,KACZ,aAAc,EACd,iBAAkB,GAClB,iBAAkB,GAClB,gBAAiB,GACjB,GAAGD,CAAA,EAGG,YAAI,6CAA8CC,CAAgB,EAE1E,MAAMC,EAAS,MAAM,UAAU,aAAa,aAAa,CACvD,MAAOD,CAAA,CACR,EAEKR,EAAQS,EAAO,eAAe,EAAE,CAAC,EACvC,OAAIT,IACF,QAAQ,IAAI,+CAA+CA,EAAM,KAAK,EAAE,EACxE,QAAQ,IAAI,qBAAsBA,EAAM,YAAa,IAGhDS,QAEAxtB,EAAO,CAId,GAHQ,cAAM,mCAAoCA,CAAK,EAGnD,KAAK,iBACP,eAAQ,IAAI,wCAAwC,EACpD,KAAK,iBAAmB,GACjB,KAAK,kBAAkBstB,CAAW,EAGrC,MAAAttB,CACR,CACF,CAGA,MAAM,eAAeytB,EAAqB,IAAOC,EAA0B,GAAwB,CAC7F,IACI,MAAAF,EAAS,MAAM,KAAK,oBAEnB,WAAI,QAAS9R,GAAY,CACxB,MAAAiS,EAAe,IAAI,aACnBC,EAASD,EAAa,wBAAwBH,CAAM,EACpDK,EAAWF,EAAa,iBAG9B,IAAIG,EAA4B,KAE5BJ,GACFI,EAAWH,EAAa,aACxBG,EAAS,KAAK,MAAQ,GAGtBF,EAAO,QAAQE,CAAQ,EACdA,EAAA,QAAQH,EAAa,WAAW,EACzC,QAAQ,IAAI,8FAA8F,GAE1G,QAAQ,IAAI,2CAA2C,EAGzDE,EAAS,QAAU,IACnBD,EAAO,QAAQC,CAAQ,EAEvB,MAAME,EAAY,IAAI,WAAWF,EAAS,iBAAiB,EAC3D,IAAIG,EAAgB,GAcd,MAAAvB,EAAW,YAZE,IAAM,CACvBoB,EAAS,qBAAqBE,CAAS,EACjC,MAAAE,EAAUF,EAAU,OAAO,CAAC/F,EAAKxmB,IAAUwmB,EAAMxmB,EAAO,CAAC,EAAIusB,EAAU,OAGzEE,EAAU,KACID,EAAA,IAGV,YAAI,sCAAsCC,EAAQ,QAAQ,CAAC,CAAC,qBAAqBD,CAAa,EAAE,GAGjE,GAAG,EAE5C,WAAW,IAAM,CACf,cAAcvB,CAAQ,EAGlBiB,GAAkBI,IACpBF,EAAO,WAAWE,CAAQ,EACjBA,EAAA,WAAWH,EAAa,WAAW,GAG9CH,EAAO,YAAY,QAAiBT,KAAM,MAAM,EAChDY,EAAa,MAAM,EAEnB,QAAQ,IAAI,6CAA6CK,EAAgB,MAAQ,IAAI,EAAE,EACvFtS,EAAQsS,CAAa,GACpBP,CAAU,EACd,QAEMztB,EAAO,CACN,qBAAM,uBAAwBA,CAAK,EACpC,EACT,CACF,CAGA,MAAM,qBAAgE,CAChE,IAKF,OAHgB,MAAM,UAAU,aAAa,iBAAiB,GAC5B,KAAemtB,KAAO,QAAU,EAAE,EAG3D,UAIL,gBAAiB,WACJ,MAAO,UAAU,YAAoB,MAAM,CAAE,KAAM,aAAc,GAClE,MAGT,eACAntB,EAAO,CACN,oBAAK,yCAA0CA,CAAK,EACrD,QACT,CACF,CAGA,OAAc,CACZ,KAAK,iBAAmB,GACxB,KAAK,iBAAmB,GACxB,KAAK,cAAgB,EACvB,CACF,EAtREiG,EADW6mB,GACI,YADV,IAAMoB,GAANpB,wIC+GA,MAAMqB,EAAgB,CAC3B,YAAoBC,EAAiC,CAAjC,gBAAAA,CAAkC,CAEtD,MAAM,OAAOhe,EAAwBie,EAAiC,CACpE,MAAM5lB,EAAqB,CACzB,KAAM,iBACN,QAAA2H,CAAA,EAEEie,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CACF,CAEO,MAAM6lB,EAAiB,CAC5B,YAAoBF,EAAiC,CAAjC,gBAAAA,CAAkC,CAEtD,MAAM,OACJ5nB,EACA6nB,EACAE,EACe,CACf,MAAM9lB,EAAqB,CACzB,KAAM,kBACN,SAAAjC,CAAA,EAEE6nB,IACF5lB,EAAM,SAAW4lB,GAEfE,IACF9lB,EAAM,wBAA0B8lB,GAE5B,WAAK,WAAW,KAAK9lB,CAAK,CAClC,CAEA,MAAM,OAAO+lB,EAAqBH,EAAiC,CACjE,MAAM5lB,EAAqB,CACzB,KAAM,mBAEJ+lB,IACF/lB,EAAM,YAAc+lB,GAElBH,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CACF,CAEO,MAAMgmB,EAAyB,CACpC,YAAoBL,EAAiC,CAAjC,gBAAAA,CAAkC,CAEtD,MAAM,OAAO9V,EAAe+V,EAAiC,CAC3D,MAAM5lB,EAAqB,CACzB,KAAM,4BACN,MAAA6P,CAAA,EAEE+V,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CAEA,MAAM,OAAO4lB,EAAiC,CAC5C,MAAM5lB,EAAqB,CACzB,KAAM,6BAEJ4lB,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CAEA,MAAM,MAAM4lB,EAAiC,CAC3C,MAAM5lB,EAAqB,CACzB,KAAM,4BAEJ4lB,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CACF,CAEO,MAAMimB,EAA0B,CACrC,YAAoBN,EAAiC,CAAjC,gBAAAA,CAAkC,CAEtD,MAAM,MAAMC,EAAiC,CAC3C,MAAM5lB,EAAqB,CACzB,KAAM,6BAEJ4lB,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CACF,CAEO,MAAMkmB,EAAyB,CACpC,YAAoBP,EAAiC,CAAjC,gBAAAA,CAAkC,CAEtD,MAAM,OACJzI,EACAiJ,EACAP,EACe,CACf,MAAM5lB,EAAqB,CACzB,KAAM,2BACN,KAAAkd,CAAA,EAEEiJ,IACFnmB,EAAM,iBAAmBmmB,GAEvBP,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CAEA,MAAM,OAAOomB,EAAgBR,EAAiC,CAC5D,MAAM5lB,EAAqB,CACzB,KAAM,2BACN,QAASomB,CAAA,EAEPR,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CAEA,MAAM,SACJomB,EACAC,EACAC,EACAV,EACe,CACf,MAAM5lB,EAAqB,CACzB,KAAM,6BACN,QAASomB,EACT,aAAcC,EACd,cAAeC,CAAA,EAEbV,IACF5lB,EAAM,SAAW4lB,GAEb,WAAK,WAAW,KAAK5lB,CAAK,CAClC,CACF,CAEO,MAAMumB,EAAqB,CAGhC,YAAYZ,EAAiC,CAF7BnoB,EAAA,aAGT,UAAO,IAAI0oB,GAAyBP,CAAU,CACrD,CACF,CAIO,MAAMa,WAA4BC,eAAa,CAmBpD,YAAoB9wB,EAAyB,CACrC,QAnBA6H,EAAA,iBAA8B,MAC9BA,EAAA,iBAA2B,MAC3BA,EAAA,mBAAc,IACdA,EAAA,sBAAiB,IACjBA,EAAA,2BAAsD,MACtDA,EAAA,0BAAyC,MACzCA,EAAA,qBAAsC,MACtCA,EAAA,oBAAoC,MACpCA,EAAA,wBAA4C,MAC7CA,EAAA,0BAAoG,MAG3FA,EAAA,gBACAA,EAAA,iBACAA,EAAA,yBACAA,EAAA,0BACAA,EAAA,qBAEI,YAAA7H,EAIb,aAAU,IAAI+vB,GAAgB,IAAI,EAClC,cAAW,IAAIG,GAAiB,IAAI,EACpC,sBAAmB,IAAIG,GAAyB,IAAI,EACpD,uBAAoB,IAAIC,GAA0B,IAAI,EACtD,kBAAe,IAAIM,GAAqB,IAAI,CACnD,CAEA,MAAM,SAAyB,CAC7B,GAAI,KAAK,YACD,UAAI,MAAM,mBAAmB,EAGjC,IACI,MAAAG,EAAQ,KAAK,oBACnB,eAAQ,IAAI,yCAA0CA,EAAM,SAAU,GAEtE,KAAK,UAAY,IAAI,UAAUA,EAAM,SAAU,GAExC,IAAI,QAAQ,CAACzT,EAASC,IAAW,CAClC,IAAC,KAAK,UAAW,CACZA,EAAA,IAAI,MAAM,4BAA4B,CAAC,EAC9C,MACF,CAEK,eAAU,OAAS,IAAM,CAC5B,QAAQ,IAAI,+CAA+C,EAC3D,KAAK,YAAc,GACnB,KAAK,qBAAqB,EAClBD,GAAA,EAGL,eAAU,QAAW1b,GAAU,OAC1B,cAAM,gCAAiCA,CAAK,EACpD,KAAK,YAAc,GAGnB,IAAI6B,EAAe,gCACfwO,EAAA,KAAK,YAAL,YAAAA,EAAgB,cAAe,UAAU,SAC5BxO,EAAA,2EAGV8Z,EAAA,IAAI,MAAM9Z,CAAY,CAAC,GAG3B,eAAU,QAAW4G,GAAU,CAClC,QAAQ,IAAI,wBAAwBA,EAAM,IAAI,MAAMA,EAAM,MAAM,EAAE,EAGlE,IAAI2mB,EAAc,iBAClB,OAAQ3mB,EAAM,KAAM,CAClB,IAAK,KACW2mB,EAAA,iBACd,MACF,IAAK,MACWA,EAAA,8EACd,MACF,IAAK,MACWA,EAAA,wCACd,MACF,IAAK,MACWA,EAAA,kBACd,MACF,IAAK,MACWA,EAAA,uCACd,MACF,QACEA,EAAc,cAAc3mB,EAAM,IAAI,KAAKA,EAAM,QAAU,2BAA2B,EAC1F,CAEQ,YAAI,oBAAoB2mB,CAAW,EAAE,EAE7C,KAAK,YAAc,GACnB,KAAK,eAAiB,GACtB,KAAK,QAAQ,EACb,KAAK,KAAK,eAAgB,CACxB,KAAM3mB,EAAM,KACZ,OAAQA,EAAM,QAAU2mB,EACxB,SAAU3mB,EAAM,SACjB,EACH,CACD,QACMzI,EAAO,CACR,UAAI,MAAM,sBAAsBA,aAAiB,MAAQA,EAAM,QAAU,eAAe,EAAE,CAClG,CACF,CAEA,MAAM,qBAAqC,CACzC,GAAI,MAAK,eAIF,WAAI,QAAS0b,GAAY,CAC9B,KAAK,oBAAsBA,CAAA,CAC5B,CACH,CAEQ,mBAAyB,CACzB,MAAAyT,EAAQ,IAAI,IAAI,KAAK,OAAO,SAAS,QAAQ,WAAY,QAAQ,CAAC,EACxE,OAAAA,EAAM,SAAW,uBACjBA,EAAM,aAAa,IAAI,cAAe,KAAK,OAAO,YAAc,oBAAoB,EACpFA,EAAM,aAAa,IAAI,QAAS,KAAK,OAAO,KAAK,EACjDA,EAAM,aAAa,IAAI,UAAW,KAAK,OAAO,MAAM,EAC7CA,CACT,CAEQ,sBAA6B,CAC9B,KAAK,YAEL,eAAU,UAAa1mB,GAAU,CAChC,IACF,MAAMzB,EAAO,KAAK,MAAMyB,EAAM,IAAI,EAClC,KAAK,kBAAkBzB,CAAI,QACpBhH,EAAO,CACN,cAAM,uCAAwCA,CAAK,EAC3D,KAAK,KAAK,QAAS,IAAI,MAAM,gCAAgC,CAAC,CAChE,GAEJ,CAEQ,kBAAkBgH,EAAyB,eAGjD,OAFA,QAAQ,IAAI,sBAAsBA,EAAK,IAAI,EAAE,EAErCA,EAAK,KAAM,CACjB,IAAK,kBACL,IAAK,kBACE,iBAAYqJ,EAAArJ,EAAK,UAAL,YAAAqJ,EAAc,KAAM,KACrC,QAAQ,IAAI,oBAAoB,KAAK,SAAS,EAAE,EAE3C,KAAK,iBACR,KAAK,eAAiB,GAClB,KAAK,sBACP,KAAK,oBAAoB,EACzB,KAAK,oBAAsB,OAG1B,UAAK,gBAAiBrJ,CAAI,EAC/B,MAEF,IAAK,oCACH,QAAQ,IAAI,0BAA0B,EACtC,KAAK,KAAK,gBAAgB,EAC1B,MAEF,IAAK,oCACH,QAAQ,IAAI,0BAA0B,EACtC,KAAK,KAAK,gBAAgB,EAC1B,MAEF,IAAK,mBACH,QAAQ,IAAI,2BAA2B,EAClC,UAAK,mBAAoBA,CAAI,EAClC,MAEF,IAAK,wBACCsJ,EAAAtJ,EAAK,QAAL,MAAAsJ,EAAY,OACd,KAAK,KAAK,cAAetJ,EAAK,MAAM,KAAK,EAE3C,MAEF,IAAK,sBACH,QAAQ,IAAI,6BAA6B,EACpC,UAAK,aAAcA,CAAI,EAC5B,MAEF,IAAK,iCACH,QAAQ,IAAI,+BAA+B,EACtC,UAAK,wBAAyBA,CAAI,EACvC,MAEF,IAAK,6BACH,QAAQ,IAAI,2BAA2B,EAClC,UAAK,oBAAqBA,CAAI,EACnC,MAEF,IAAK,4BACH,QAAQ,IAAI,0BAA0B,EACjC,UAAK,mBAAoBA,CAAI,EAClC,MAEF,IAAK,gBACH,QAAQ,IAAI,sBAAsB,EAC7B,UAAK,gBAAiBA,CAAI,EAC/B,MAEF,IAAK,4BACE,UAAK,eAAgBA,EAAK,IAAI,EACnC,MAEF,IAAK,wDACH,QAAQ,IAAI,wCAAwC,EAC/C,UAAK,gCAAiCA,CAAI,EAC/C,MAEF,IAAK,6BACH,QAAQ,IAAI,sBAAsB,EAC7B,UAAK,oBAAqBA,CAAI,EACnC,MAEF,IAAK,8BACH,QAAQ,IAAI,uBAAuB,EAC9B,UAAK,qBAAsBA,CAAI,EACpC,MAEF,IAAK,kCACH,QAAQ,IAAI,2BAA2B,EAClC,UAAK,yBAA0BA,CAAI,EACxC,MAEF,IAAK,QACK,cAAM,kBAAmBA,EAAK,KAAK,IAEvCsP,EAAAtP,EAAK,QAAL,YAAAsP,EAAY,QAAS,0BACvB,QAAQ,MAAM,kEAAmEtP,EAAK,MAAM,OAAO,GAE/FuP,EAAAvP,EAAK,MAAM,UAAX,MAAAuP,EAAoB,SAAS,wBAC/B,QAAQ,IAAI,iDAAiD,EACxD,wBAAmB,MAAMiE,GAAO,QAAQ,MAAM,wBAAyBA,CAAG,CAAC,IAG/E,UAAK,QAAS,IAAI,QAAMhE,EAAAxP,EAAK,QAAL,YAAAwP,EAAY,UAAW,cAAc,CAAC,EACnE,MAEF,QACE,QAAQ,IAAI,4BAA4BxP,EAAK,IAAI,EAAE,EAC9C,UAAK,QAASA,CAAI,EACvB,KACJ,CAGK,UAAK,eAAgBA,CAAI,CAChC,CAEA,MAAM,KAAKyB,EAAmC,CAC5C,GAAI,CAAC,KAAK,WAAa,CAAC,KAAK,YACrB,UAAI,MAAM,yBAAyB,EAGvC,IACI,MAAAzB,EAAO,KAAK,UAAUyB,CAAK,EAC5B,eAAU,KAAKzB,CAAI,EACxB,QAAQ,IAAI,kBAAkByB,EAAM,IAAI,EAAE,QACnCzI,EAAO,CACN,oBAAM,0BAA2BA,CAAK,EACxC,IAAI,MAAM,yBAAyBA,aAAiB,MAAQA,EAAM,QAAU,eAAe,EAAE,CACrG,CACF,CAEA,MAAM,mBAAmC,CACnC,IAEF,KAAK,mBAAqB,MAAM,UAAU,aAAa,aAAa,CAClE,MAAO,CACL,WAAY,KACZ,aAAc,EACd,iBAAkB,GAClB,iBAAkB,GAClB,gBAAiB,EACnB,EACD,EAGD,KAAK,aAAe,IAAI,aAAa,CAAE,WAAY,KAAO,EAG1D,MAAM,KAAK,aAAa,aAAa,UAAU,6BAA6B,EAE5E,MAAM4tB,EAAS,KAAK,aAAa,wBAAwB,KAAK,kBAAkB,EAGhF,KAAK,iBAAmB,IAAI,iBAAiB,KAAK,aAAc,wBAAyB,CACvF,eAAgB,EAChB,gBAAiB,EACjB,aAAc,EACd,iBAAkB,WAClB,sBAAuB,WACxB,EAGD,KAAK,iBAAiB,KAAK,UAAanlB,GAAU,CAC1C,MAAE,KAAAkP,EAAM,YAAA0X,EAAa,QAAAC,EAAS,QAAArB,EAAS,KAAAsB,EAAM,OAAAC,CAAA,EAAW/mB,EAAM,KAEhEkP,IAAS,aAEX,QAAQ,IAAI,kCAAkC2X,CAAO,eAAerB,EAAU,KAAK,QAAQ,CAAC,CAAC,aAAasB,EAAO,KAAK,QAAQ,CAAC,CAAC,cAAcC,EAAS,MAAQ,IAAI,EAAE,EAC5J7X,IAAS,aAAe,KAAK,aAAe,KAAK,gBAE1D,KAAK,kBAAkB0X,CAAW,EAAE,MAAervB,GAAA,CACzC,cAAM,mCAAoCA,CAAK,EACxD,CACH,EAIK4tB,EAAA,QAAQ,KAAK,gBAAgB,EAEpC,QAAQ,IAAI,2FAA2F,EACvG,KAAK,KAAK,uBAAuB,QAE1B5tB,EAAO,CACN,oBAAM,mCAAoCA,CAAK,EACjD,IAAI,MAAM,kDAAkD,CACpE,CACF,CAEA,MAAc,kBAAkByvB,EAA8C,CACxE,IAEE,IAAC,KAAK,YAAa,CACrB,QAAQ,KAAK,mDAAmD,EAChE,MACF,CAGI,IAAC,KAAK,eAAgB,CACxB,QAAQ,KAAK,6CAA6C,EAC1D,MACF,CAEI,IAAAC,EAQA,GAPAD,aAAqB,KACTC,EAAA,MAAMD,EAAU,cAEhBC,EAAAD,EAIZC,EAAY,WAAa,IAAM,EAAG,CACpC,QAAQ,KAAK,kDAAkD,EACzD,MAAAC,EAAe,IAAI,WAAWD,CAAW,EACzCE,EAAa,IAAI,WAAWF,EAAY,WAAa,CAAC,EAC5DE,EAAW,IAAID,CAAY,EAChBC,EAAAD,EAAa,MAAM,EAAI,EAClCD,EAAcE,EAAW,MAC3B,CAEM,MAAAC,EAAc,KAAK,OAAO,aAAa,GAAG,IAAI,WAAWH,CAAW,CAAC,CAAC,EACtE,WAAK,iBAAiB,OAAOG,CAAW,QACvC7vB,EAAO,CACN,cAAM,mCAAoCA,CAAK,EAEnDA,aAAiB,OAASA,EAAM,QAAQ,SAAS,yBAAyB,IAC5E,QAAQ,IAAI,0DAA0D,EACtE,MAAM,KAAK,mBAEf,CACF,CAEA,MAAM,kBAAkC,CAElC,KAAK,mBACP,KAAK,iBAAiB,aACtB,KAAK,iBAAmB,MAGtB,KAAK,cAAgB,KAAK,aAAa,QAAU,WAC7C,WAAK,aAAa,QACxB,KAAK,aAAe,MAIlB,KAAK,eAAiB,KAAK,cAAc,QAAU,aACrD,KAAK,cAAc,OACnB,KAAK,cAAgB,MAInB,KAAK,qBACP,KAAK,mBAAmB,YAAY,QAAiB+sB,KAAM,MAAM,EACjE,KAAK,mBAAqB,MAG5B,QAAQ,IAAI,0BAA0B,EACtC,KAAK,KAAK,uBAAuB,CACnC,CAEA,MAAM,OAAuB,CAC3B,MAAM,KAAK,mBAEP,KAAK,WAAa,KAAK,aACpB,eAAU,MAAM,IAAM,sBAAsB,EAGnD,KAAK,QAAQ,CACf,CAEQ,SAAgB,CACtB,KAAK,YAAc,GACnB,KAAK,eAAiB,GACtB,KAAK,oBAAsB,KAC3B,KAAK,UAAY,KACjB,KAAK,UAAY,KAGb,KAAK,eAAiB,KAAK,cAAc,QAAU,aACrD,QAAQ,IAAI,0CAA0C,EACtD,KAAK,cAAc,QAIjB,KAAK,qBACP,QAAQ,IAAI,yCAAyC,EACrD,KAAK,mBAAmB,YAAY,QAAiBA,KAAM,MAAM,EACjE,KAAK,mBAAqB,MAI5B,KAAK,cAAgB,KAEjB,KAAK,eACP,KAAK,aAAa,QAClB,KAAK,aAAe,KAExB,CAGA,IAAI,WAAqB,CACvB,OAAO,KAAK,WACd,CAEA,IAAI,cAAwB,CAC1B,OAAO,KAAK,cACd,CAEA,IAAI,kBAAkC,CACpC,OAAO,KAAK,SACd,CACF,CAIA,eAAsB+C,GAA0B1xB,EAAuD,CAIrG,QAAS2xB,EAAU,EAAGA,GAAW,EAAYA,IACvC,IACF,QAAQ,IAAI,8CAA8CA,EAAU,CAAC,IAAI,EAAa,CAAC,MAAM,EAEvF,MAAA3B,EAAa,IAAIa,GAAoB7wB,CAAM,EACjD,aAAMgwB,EAAW,UACjB,MAAMA,EAAW,sBAEjB,QAAQ,IAAI,kDAAkD,EACvDA,QAEApuB,EAAO,CACd,MAAM6B,EAAe7B,aAAiB,MAAQA,EAAM,QAAU,gBAC9D,QAAQ,MAAM,wBAAwB+vB,EAAU,CAAC,WAAYluB,CAAY,EAGzE,MAAMmuB,EAAkBnuB,EAAa,cAAc,SAAS,cAAc,GACnDA,EAAa,YAAY,EAAE,SAAS,YAAY,GAChDA,EAAa,YAAY,EAAE,SAAS,mBAAmB,EAE1E,GAAAkuB,EAAU,GAAcC,EAAiB,CAC3C,MAAM1vB,EAAQ,IAAY,KAAK,IAAI,EAAGyvB,CAAO,EACrC,YAAI,iBAAiBzvB,CAAK,mCAAmC,EACrE,MAAM,IAAI,QAAQob,GAAW,WAAWA,EAASpb,CAAK,CAAC,MAQjD,OALa,IAAI,MACrByvB,GAAW,EACP,sGACA,sBAAsBluB,CAAY,GAI5C,CAII,UAAI,MAAM,4CAA4C,CAC9D,CAIO,MAAMouB,EAAoB,CAK/B,YAAY7xB,EAAyB,CAJ7B6H,EAAA,kBAAyC,MACzCA,EAAA,eACAA,EAAA,0BAAoG,MAG1G,KAAK,OAAS7H,CAChB,CAEA,MAAM,YAA4B,CAC5B,IACF,QAAQ,IAAI,0CAA0C,EACtD,QAAQ,IAAI,qDAAqD,EAGjE,KAAK,WAAa,MAAM0xB,GAA0B,KAAK,MAAM,EAGzD,KAAK,qBACF,gBAAW,mBAAqB,KAAK,oBAI5C,MAAM,KAAK,mBAEX,QAAQ,IAAI,kDAAkD,QACvD9vB,EAAO,CACd,MAAM6B,EAAe7B,aAAiB,MAAQA,EAAM,QAAU,gBACtD,oBAAM,gDAAiD6B,CAAY,GAGvEA,EAAa,SAAS,cAAc,GAAKA,EAAa,SAAS,YAAY,IAC7E,QAAQ,IAAI,2FAA2F,EAGnG7B,CACR,CACF,CAEA,MAAc,kBAAkC,CAC1C,IAAC,KAAK,WACF,UAAI,MAAM,4BAA4B,EAG9C,MAAMkwB,EAA+B,CACnC,WAAY,CAAC,OAAQ,OAAO,EAC5B,aAAc,KAAK,gCAAgC,EACnD,MAAO,CACL,KAAM,KAAK,OAAO,OAAS,kBAC3B,KAAM,gBACR,EACA,mBAAoB,QACpB,oBAAqB,QACrB,0BAA2B,CACzB,MAAO,WACT,EACA,eAAgB,CACd,KAAM,qBACN,UAAW,GACX,kBAAmB,IACnB,oBAAqB,GACvB,EACA,2BAA4B,KAC5B,YAAa,IAGf,MAAM,KAAK,WAAW,QAAQ,OAAOA,CAAa,CACpD,CAEQ,iCAA0C,CACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4HAmBT,CAEA,aAAa3nB,EAAsF,CACjG,KAAK,mBAAqBA,EAGtB,KAAK,aACP,KAAK,WAAW,mBAAqBA,EAEzC,CAEA,MAAM,2BAAsE,CACpE,MAAA4nB,EAAqBjC,GAAmB,cAE1C,IAEI,MAAAkC,EAAmB,MAAMD,EAAmB,sBAE9C,GAAAC,IAAqB,WAAaA,IAAqB,SAClD,OAAAA,EAIL,IAEK,OADQ,MAAMD,EAAmB,qBAC1B,QAAU,UAAY,eAC7BnwB,EAAO,CACN,qBAAM,6CAA8CA,CAAK,EAC1D,QACT,QACOA,EAAO,CACN,qBAAM,2CAA4CA,CAAK,EACxD,QACT,CACF,CAEA,MAAM,cAA8B,OAClC,QAAQ,IAAI,sDAAsD,EAClE,QAAQ,IAAI,sBAAuB,KAAK,WAAa,SAAW,MAAM,EACtE,QAAQ,IAAI,4BAA4BqQ,EAAA,KAAK,aAAL,YAAAA,EAAiB,SAAS,EAE7D,KAAK,aACR,QAAQ,IAAI,0CAA0C,EAEtD,KAAK,WAAa,MAAMyf,GAA0B,KAAK,MAAM,EAC7D,MAAM,KAAK,mBACX,QAAQ,IAAI,yCAAyC,GAGlD,KAAK,WAAW,YACnB,QAAQ,IAAI,gDAAgD,EACtD,WAAK,WAAW,WAIxB,QAAQ,IAAI,sCAAsC,EAC5C,WAAK,WAAW,sBACtB,QAAQ,IAAI,+CAA+C,EAErD,WAAK,WAAW,oBACtB,QAAQ,IAAI,kCAAkC,CAChD,CAEA,MAAM,YAA4B,CAC5B,KAAK,aACD,WAAK,WAAW,QACtB,KAAK,WAAa,MAEpB,QAAQ,IAAI,gCAAgC,CAC9C,CAGA,eAAevnB,EAAiD,QAC9D8H,EAAA,KAAK,aAAL,MAAAA,EAAiB,GAAG,sBAAwB5H,GAAuB,OACjE,MAAM5I,EAAwB,CAC5B,UAAW,gBACX,UAASwQ,EAAA5H,EAAM,WAAN,YAAA4H,EAAgB,UAAW,GACpC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,WAAY,IACZ,iBAAkB,CAAC,GAErB9H,EAAS1I,CAAO,GAEpB,CAEA,aAAa0I,EAA6C,UACnD8H,EAAA,wBAAAA,EAAY,GAAG,oCAAqC,IAAM,CAC7D9H,EAAS,EAAI,KAEV+H,EAAA,wBAAAA,EAAY,GAAG,oCAAqC,IAAM,CAC7D/H,EAAS,EAAK,GAElB,CAEA,QAAQA,EAAyC,QAC/C8H,EAAA,KAAK,aAAL,MAAAA,EAAiB,GAAG,QAAU5H,GAAuB,OAC1CF,IAAA8H,EAAA5H,EAAM,QAAN,YAAA4H,EAAa,UAAW,eAAe,GAEpD,CAEA,MAAM,aAA6B,CACjC,MAAM,KAAK,YACb,CAGA,GAAG5H,EAAe4nB,EAA8C,QACzDhgB,EAAA,wBAAAA,EAAY,GAAG5H,EAAO4nB,EAC7B,CAEA,IAAI5nB,EAAe4nB,EAA8C,QAC1DhgB,EAAA,wBAAAA,EAAY,IAAI5H,EAAO4nB,EAC9B,CAGA,IAAI,SAAU,OACZ,OAAOhgB,EAAA,KAAK,aAAL,YAAAA,EAAiB,OAC1B,CAEA,IAAI,UAAW,OACb,OAAOA,EAAA,KAAK,aAAL,YAAAA,EAAiB,QAC1B,CAEA,IAAI,cAAe,OACjB,OAAOA,EAAA,KAAK,aAAL,YAAAA,EAAiB,YAC1B,CAEA,IAAI,kBAAmB,OACrB,OAAOA,EAAA,KAAK,aAAL,YAAAA,EAAiB,gBAC1B,CAEA,IAAI,mBAAoB,OACtB,OAAOA,EAAA,KAAK,aAAL,YAAAA,EAAiB,iBAC1B,CAEA,IAAI,aAAuB,OAClB,QAAAA,EAAA,KAAK,aAAL,YAAAA,EAAiB,YAAa,EACvC,CAEA,IAAI,gBAA0B,OACrB,QAAAA,EAAA,KAAK,aAAL,YAAAA,EAAiB,eAAgB,EAC1C,CACF,CC/+BO,SAASigB,GAAmB,CAAE,cAAAC,EAAe,QAAAC,EAAS,OAAAC,GAAmC,CAC9F,KAAM,CAACvD,EAASwD,CAAU,EAAI1vB,EAAA,SAAwB,CAAE,GAClD,CAAC2vB,EAAgBC,CAAiB,EAAI5vB,WAA6B,IAAI,EACvE,CAACovB,EAAkBS,CAAmB,EAAI7vB,WAA0C,QAAQ,EAC5F,CAACqD,EAAWuc,CAAY,EAAI5f,WAAS,EAAK,EAC1C,CAAChB,EAAO+W,CAAQ,EAAI/V,WAAiB,EAAE,EACvC,CAAC8vB,EAAcC,CAAe,EAAI/vB,WAAS,EAAK,EAChD,CAACgwB,EAAiBC,CAAkB,EAAIjwB,WAAyB,IAAI,EAGrEkwB,EAAc,SAAY,CAC1B,IACFtQ,EAAa,EAAI,EACjB7J,EAAS,EAAE,EAGL,MAAAkW,EAAa,MAAMsD,EAAc,4BAGvC,GAFAM,EAAoB5D,CAAU,EAE1BA,IAAe,SAAU,CAC3BlW,EAAS,6FAA6F,EACtG,MACF,CAGM,MAAAoa,EAAmB,MAAMZ,EAAc,2BAC7CG,EAAWS,CAAgB,EAGrB,MAAArF,EAAUyE,EAAc,yBAC9BK,EAAkB9E,CAAO,EAEzB,QAAQ,IAAI,aAAaqF,EAAiB,MAAM,iBAAkBA,CAAgB,QAE3E3W,EAAK,CACJ,cAAM,gCAAiCA,CAAG,EAClDzD,EAASyD,aAAe,MAAQA,EAAI,QAAU,mCAAmC,SACjF,CACAoG,EAAa,EAAK,CACpB,GAIIwQ,EAAoB,SAAY,CAChC,IACFxQ,EAAa,EAAI,EACjB7J,EAAS,EAAE,EAEL,MAAAlP,EAAS,MAAM0oB,EAAc,8BAE/B1oB,EAAO,SACTgpB,EAAoB,SAAS,EAC7B,MAAMK,EAAY,IAElBL,EAAoB,QAAQ,EACnB9Z,EAAAlP,EAAO,OAAS,mBAAmB,SAGvC2S,EAAK,CACJ,cAAM,gCAAiCA,CAAG,EAClDzD,EAASyD,aAAe,MAAQA,EAAI,QAAU,8BAA8B,SAC5E,CACAoG,EAAa,EAAK,CACpB,GAIIyQ,EAAgBlE,GAAwB,CACxC,IACYoD,EAAA,eAAepD,EAAO,QAAQ,EAC5CyD,EAAkBzD,CAAM,EACxB,QAAQ,IAAI,uBAAuBA,EAAO,KAAK,EAAE,QAC1C3S,EAAK,CACJ,cAAM,2BAA4BA,CAAG,EAC7CzD,EAAS,+BAA+B,CAC1C,GAIIua,EAAY,SAAY,CACxB,IACFP,EAAgB,EAAI,EACpBE,EAAmB,IAAI,EACvBla,EAAS,EAAE,EAEX,QAAQ,IAAI,2BAA2B,EACvC,MAAMwa,EAAW,MAAMhB,EAAc,eAAe,GAAK,EACzDU,EAAmBM,CAAQ,EAEtBA,GACHxa,EAAS,kFAAkF,QAGtFyD,EAAK,CACJ,cAAM,qBAAsBA,CAAG,EACvCzD,EAAS,6DAA6D,EACtEka,EAAmB,EAAK,SACxB,CACAF,EAAgB,EAAK,CACvB,GAUF,OANA3vB,YAAU,IAAM,CACVqvB,GACUS,GACd,EACC,CAACT,CAAM,CAAC,EAENA,QAGF,MAAI,WAAU,6EACb,SAAClsB,EAAA,YAAI,UAAU,qDAEb,UAACA,OAAA,OAAI,UAAU,iEACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAAC0M,GAAS,MAAM,GAAI,UAAU,gBAAgB,EAC7C1M,EAAA,UAAG,UAAU,sCAAsC,SAAmB,yBACzE,EACAA,EAAA,IAAC,UACC,QAAS+uB,EACT,UAAU,sDACX,aAED,GACF,EAGAjsB,OAAC,MAAI,WAAU,gBAEb,UAACA,OAAA,OAAI,UAAU,wDACZ,UAAA6rB,IAAqB,UACpB3uB,MAACob,GAAY,MAAM,GAAI,UAAU,gBAAiB,GAEjDpb,MAAAqb,GAAA,CAAY,KAAM,GAAI,UAAU,kBAAkB,SAEpD,MACC,WAACvY,OAAA,KAAE,UAAU,oCAAoC,gCAC3B6rB,IAAqB,UAAY,UAAY,YACnE,EACCA,IAAqB,WACpB3uB,EAAA,IAAC,UACC,QAAS2vB,EACT,SAAU/sB,EACV,UAAU,mEAET,WAAY,gBAAkB,qBACjC,GAEJ,GACF,EAGC+rB,IAAqB,WACpB7rB,OAAC,MACC,WAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,aAAM,UAAU,oCAAoC,SAAqB,0BAC1E8C,EAAA,KAAC,UACC,QAAS2sB,EACT,SAAU7sB,EACV,UAAU,+FAEV,UAAA5C,MAACwM,IAAU,KAAM,GAAI,UAAW5J,EAAY,eAAiB,GAAI,EACjE5C,MAAC,QAAK,SAAO,aACf,GACF,QAEC,MAAI,WAAU,qCACZ,SAAQyrB,EAAA,IAAKC,GACZ1rB,EAAA,IAAC,UAEC,QAAS,IAAM4vB,EAAalE,CAAM,EAClC,UAAW,6DACTwD,GAAA,YAAAA,EAAgB,YAAaxD,EAAO,SAChC,2CACA,qDACN,GAEA,SAAA5oB,EAAA,KAAC,MAAI,WAAU,8BACb,UAAC9C,MAAAmM,GAAA,CAAI,KAAM,EAAI,GACdnM,EAAA,YAAK,UAAU,sBAAuB,WAAO,MAAM,EACnD0rB,EAAO,WACN1rB,MAAC,OAAK,WAAU,sDAAsD,SAEtE,aAEDkvB,GAAA,YAAAA,EAAgB,YAAaxD,EAAO,gBAClCtQ,GAAY,MAAM,GAAI,UAAU,eAAgB,IAErD,GAnBKsQ,EAAO,QAqBf,GACH,EAECD,EAAQ,SAAW,GAAK,CAAC7oB,GACvB5C,EAAA,SAAE,UAAU,yCAAyC,SAEtD,oEAEJ,EAID2uB,IAAqB,WAAaO,GACjCpsB,EAAA,KAAC,MACC,WAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,aAAM,UAAU,oCAAoC,SAAgB,qBACpEuvB,IAAoB,MAClBzsB,OAAA,OAAI,UAAU,8BACZ,UAAAysB,EACEvvB,EAAA,IAAAob,GAAA,CAAY,KAAM,GAAI,UAAU,iBAAiB,EAElDpb,EAAA,IAACqb,GAAY,MAAM,GAAI,UAAU,eAAe,EAElDrb,MAAC,OAAK,WAAW,WAAWuvB,EAAkB,iBAAmB,cAAc,GAC5E,SAAkBA,EAAA,iBAAmB,mBACxC,IACF,GAEJ,EAEAvvB,MAAC,OAAI,UAAU,OACb,eAAC,IAAE,WAAU,wBAAwB,mIAErC,CACF,GAEAA,EAAA,IAAC,UACC,QAAS6vB,EACT,SAAUR,GAAgBzsB,EAC1B,UAAU,wIAEV,SAAC5C,EAAA,WAAI,UAAU,6CACZ,WAEG8C,OAAAM,EAAA,oBAAApD,EAAA,IAACoN,GAAQ,MAAM,GAAI,UAAU,8BAA8B,EAC1DpN,EAAA,YAAK,UAAU,wBAAwB,SAAkD,wDAC5F,EAGE8C,OAAAM,EAAA,oBAAApD,EAAA,IAACoN,GAAQ,MAAM,GAAI,UAAU,gBAAgB,EAC5CpN,EAAA,YAAK,UAAU,wBAAwB,SAA0C,gDACpF,CAEJ,GACF,GACF,EAIDzB,SACE,MAAI,WAAU,iDACb,SAACuE,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAACqb,GAAY,MAAM,GAAI,UAAU,eAAe,EAC/Crb,EAAA,SAAE,UAAU,uBAAwB,SAAMzB,EAAA,GAC7C,CACF,IAEJ,EAGAyB,MAAC,MAAI,WAAU,0DACb,SAAAA,EAAA,IAAC,UACC,QAAS+uB,EACT,UAAU,yGACX,mBAGH,EACF,EACF,GAlKkB,IAoKtB,CC/QO,SAASgB,GAAuB,CACrC,UAAAC,EAAY,OACZ,OAAAhzB,EACA,aAAAizB,EACA,eAAAC,CACF,EAAgC,OAE9B,KAAM,CAACC,EAAiBC,CAAkB,EAAI7wB,WAAS,EAAK,EACtD,CAAC8wB,EAAaC,CAAc,EAAI/wB,WAAS,EAAK,EAC9C,CAACgxB,EAAYC,CAAa,EAAIjxB,WAAS,EAAK,EAC5C,CAACqG,EAAW6qB,CAAY,EAAIlxB,WAAwB,IAAI,EACxD,CAACmxB,EAAgBC,CAAiB,EAAIpxB,WAAiB,EAAE,EACzD,CAACqxB,EAAqBC,CAAsB,EAAItxB,EAAA,SAAyB,CAAE,GAC3E,CAACuxB,EAAkBC,CAAmB,EAAIxxB,WAAgE,cAAc,EACxH,CAACa,EAAc4wB,CAAe,EAAIzxB,WAAiB,EAAE,EACrD,CAAC0xB,EAAgBC,CAAiB,EAAI3xB,WAAS,EAAI,EACnD,CAAC4xB,EAAaC,CAAc,EAAI7xB,WAA6D,CACjG,QAAS,EACT,KAAM,EACN,OAAQ,GACT,EACK,CAAC8xB,EAAiBC,CAAkB,EAAI/xB,WAAS,EAAK,EAGtDgyB,EAAmBxf,SAAmC,IAAI,EAC1Dyf,EAAiBzf,SAAyB,IAAI,EAC9C0f,EAAqB1f,SAAuB,IAAI,EAGhD2f,EAAc,CAClB,KAAM,CACJ,KAAM,iBACN,KAAM,kCACN,MAAO,kBACP,YAAa,oCACf,EACA,KAAM,CACJ,KAAM,qBACN,KAAM,yBACN,MAAO,kBACP,YAAa,+BACf,EACA,OAAQ,CACN,KAAM,qBACN,KAAM,iCACN,MAAO,oBACP,YAAa,oCACf,EACA,SAAU,CACR,KAAM,kBACN,KAAM,+BACN,MAAO,mBACP,YAAa,8BACf,GACA1B,CAAS,EAGL2B,EAA0BlrB,cAAY,SAAY,CAClD,IAEI,MAAAxB,EAAW,yDACX2sB,EAAS,uFAMTj1B,EAA6B,CACjC,SAAAsI,EACA,OAAA2sB,EACA,MAAO,0BACP,MAAO,kBACP,aAAyD,WAAWF,EAAY,IAAI,OAAOA,EAAY,IAAI,yBAAyBA,EAAY,WAAW,yEAC3J,iBAAkB,CAChB,KAAM,iBACN,KAAM,uCACN,OAAQA,EAAY,YAAY,MAAM,IAAI,CAC5C,GAGIG,EAAU,IAAIrD,GAAoB7xB,CAAM,EAGtCk1B,EAAA,eAAgBzzB,IAA0B,CAChDyyB,EAA+B/a,IAAA,CAAC,GAAGA,GAAM1X,EAAO,CAAC,EACjDuyB,EAAkBvyB,GAAQ,OAAO,GAG7BA,GAAQ,QAAQ,YAAY,EAAE,SAAS,QAAQ,GAC/CA,GAAQ,QAAQ,cAAc,SAAS,WAAW,GAClDA,GAAQ,QAAQ,cAAc,SAAS,MAAM,KAC/C8xB,GAAA,MAAAA,EAAiB,QACnB,CACD,EAEO2B,EAAA,aAAcC,IAAsB,CAC1CxB,EAAewB,EAAQ,EACnBA,KACFtB,EAAc,EAAK,EACnBG,EAAkB,cAAc,EAClC,CACD,EAEOkB,EAAA,QAAStzB,IAAkB,CACjCyyB,EAAgBzyB,EAAK,EACrBwyB,EAAoB,OAAO,EAC5B,EAED,MAAMc,EAAQ,aACdN,EAAiB,QAAUM,EAGnBA,EAAA,aAAcE,IAA+D,CACnFX,EAAeW,EAAM,EACtB,EAEDhB,EAAoB,WAAW,QAExBxyB,EAAO,CACN,cAAM,8CAA+CA,CAAK,EAClE,MAAMyzB,EAAWzzB,aAAiB,MAAQA,EAAM,QAAU,yBAC1DyyB,EAAgBgB,CAAQ,EACxBjB,EAAoB,OAAO,CAC7B,GACC,CAACW,CAAW,CAAC,EAGhB/xB,YAAU,KACgBgyB,IAEjB,IAAM,CACPJ,EAAiB,SACnBA,EAAiB,QAAQ,aAC3B,GAED,CAACI,CAAuB,CAAC,EAG5BhyB,YAAU,IAAM,QACdiP,EAAA6iB,EAAmB,UAAnB,MAAA7iB,EAA4B,eAAe,CAAE,SAAU,QAAU,IAChE,CAACgiB,CAAmB,CAAC,EAGlB,MAAAqB,EAAexrB,cAAY,SAAY,CACvC,IAKE,GAJJsqB,EAAoB,YAAY,EAChCC,EAAgB,EAAE,EAGbO,EAAiB,QAUpB,QAAQ,IAAI,sDAAsD,MAVrC,CAKzB,GAJJ,QAAQ,IAAI,6CAA6C,EACzD,MAAMI,EAAwB,EAG1B,CAACJ,EAAiB,QACd,UAAI,MAAM,uCAAuC,EAEzD,QAAQ,IAAI,sCAAsC,EAM9C,MAAAW,EAAa,+CACf,IAAArsB,EAEA,IACF,MAAMd,EAAW,MAAM,MAAM,GAAGmtB,CAAU,0BAA2B,CACnE,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,UAAAlC,EACA,OAAAhzB,EACA,cAAe,CACb,UAAAgzB,EACA,UAAW,GACX,YAAa,GACb,eAAgB0B,EAAY,KAC9B,EACD,EACF,EAEG,IAAC3sB,EAAS,GACN,UAAI,MAAM,uBAAuB,EAG3Bc,EAAA,MAAMd,EAAS,aACtBotB,EAAc,CACb,aAAK,iDAAkDA,CAAY,EAE7DtsB,EAAA,CACZ,UAAW,YAAY,KAAK,IAAK,KAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CAAC,GAC5E,OAAQ,cACR,UAAAmqB,CAAA,CAEJ,CAEAS,EAAa5qB,EAAY,SAAS,EAGlCuqB,EAAmB,EAAI,EACvBW,EAAoB,WAAW,EAG3B,IACI,MAAAQ,EAAiB,QAAQ,eAC/B,QAAQ,IAAI,8CAA8C,EAG1DjB,EAAe,EAAI,EACnB,QAAQ,IAAI,+DAA+D,QAEpE8B,EAAa,CACZ,aAAK,+EAAgFA,CAAW,EAExG9B,EAAe,EAAI,CACrB,CAGA,MAAM+B,EAA+B,CACnC,UAAWX,EAAY,KACvB,QAASY,GAAkBtC,CAAS,EACpC,UAAW,IAAI,KAAK,EAAE,YAAY,EAClC,WAAY,GAGSa,EAAA,CAACwB,CAAc,CAAC,EACvC1B,EAAkB0B,EAAe,OAAO,QAEjC9zB,EAAO,CACN,cAAM,2BAA4BA,CAAK,EAC/CyyB,EAAgB,4CAA4C,EAC5DD,EAAoB,OAAO,CAC7B,GACC,CAAC/zB,EAAQgzB,EAAW0B,EAAaC,CAAuB,CAAC,EAGtDY,EAAa9rB,cAAY,SAAY,CACrC,MAAC8qB,EAAiB,SAAW,CAAC3rB,GAE9B,IAGF,MAAMb,EAAW,MAAM,MAAM,uEAAwCa,CAAS,GAAI,CAChF,OAAQ,SACT,EAED,GAAIb,EAAS,GAAI,CACT,MAAAytB,EAAiB,MAAMztB,EAAS,OACtCkrB,GAAA,MAAAA,EAAeuC,EACjB,CAGM,MAAAjB,EAAiB,QAAQ,cAE/BnB,EAAmB,EAAK,EACxBE,EAAe,EAAK,EACpBE,EAAc,EAAK,EACnBC,EAAa,IAAI,EACjBM,EAAoB,cAAc,EAClCJ,EAAkB,yCAAyC,QAEpDpyB,EAAO,CACN,cAAM,yBAA0BA,CAAK,EAC7CyyB,EAAgB,iCAAiC,CACnD,GACC,CAACprB,EAAWqqB,CAAY,CAAC,EAGtBwC,EAAchsB,cAAY,IAAM,CAClByqB,EAAApb,GAAQ,CAACA,CAAI,CAEjC,EAAG,CAAE,GAECwc,GAAqBpc,GAAyB,CAClD,OAAQA,EAAM,CACZ,IAAK,OACI,6NACT,IAAK,OACI,oLACT,IAAK,SACI,kLACT,IAAK,WACI,wKACT,QACS,qGACX,GAgBIwc,GAb6B,IAAM,CACvC,OAAQ5B,EAAkB,CACxB,IAAK,aACH,MAAO,CAAE,KAAM,gBAAiB,MAAO,iBAAkB,EAC3D,IAAK,YACH,MAAO,CAAE,KAAM,YAAa,MAAO,gBAAiB,EACtD,IAAK,QACH,MAAO,CAAE,KAAM,mBAAoB,MAAO,cAAe,EAC3D,QACE,MAAO,CAAE,KAAM,eAAgB,MAAO,eAAgB,CAC1D,MAMA,OAAAhuB,EAAA,KAAC,MAAI,WAAU,sEAEb,UAAA9C,MAAC,OAAI,UAAU,kDACb,SAAC8C,EAAA,YAAI,UAAU,oCACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,wEACb,SAAAA,MAAC,QAAK,UAAU,mCACb,WAAY,KAAK,MAAM,GAAG,EAAE,OAAS2yB,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,EACrD,CACF,UACC,MACC,WAAA3yB,EAAA,IAAC,KAAG,WAAU,sCAAuC,SAAA0xB,EAAY,KAAK,EACrE1xB,EAAA,SAAE,UAAU,wBAAyB,WAAY,KAAK,GACzD,GACF,EAEA8C,OAAC,MAAI,WAAU,8BACb,UAAAA,OAAC,MAAI,WAAW,+BAA+B4vB,EAAc,KAAK,GAChE,UAAA1yB,EAAA,IAAC,MAAI,WAAW,wBACd8wB,IAAqB,YAAc,eACnCA,IAAqB,aAAe,gBACpCA,IAAqB,QAAU,aAAe,aAChD,GAAI,EACH9wB,EAAA,YAAK,UAAU,sBAAuB,WAAc,KAAK,GAC5D,EAEAA,EAAA,IAAC,UACC,QAASyyB,EACT,UAAW,sCACTxB,EAAiB,8BAAgC,yBACnD,GACA,MAAOA,EAAiB,aAAe,eAEtC,SAAAA,QAAkB7jB,GAAQ,MAAM,GAAI,EAAKpN,EAAA,IAACqN,GAAQ,MAAM,EAAI,GAC/D,EAEArN,EAAA,IAAC,UACC,QAAS,IAAMsxB,EAAmB,EAAI,EACtC,UAAU,iFACV,MAAM,sBAEN,SAAAtxB,MAAC0M,GAAS,MAAM,EAAI,GACtB,GACF,GACF,CACF,GAGA5J,OAAC,MAAI,WAAU,cAEb,UAACA,OAAA,OAAI,UAAU,6BACb,UAAA9C,EAAA,IAAC,SACC,IAAKwxB,EACL,UAAU,6BACV,SAAQ,GACR,MAAO,CAACP,EACR,YAAW,GACb,EAGC,GAACriB,EAAA4iB,EAAe,UAAf,MAAA5iB,EAAwB,YACxB5O,MAAC,MAAI,WAAU,oDACb,SAAA8C,EAAA,KAAC,MAAI,WAAU,cACb,UAAC9C,MAAA,OAAI,UAAU,qFACb,SAAAA,MAAC,QAAK,UAAU,gCACb,WAAY,KAAK,MAAM,GAAG,EAAE,OAAS2yB,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,EACrD,CACF,GACC3yB,EAAA,SAAE,UAAU,qBAAsB,WAAY,KAAK,EACnDA,EAAA,SAAE,UAAU,gBAAiB,WAAY,KAAK,GACjD,CACF,SAID,MAAI,WAAU,2BAEb,SAAC8C,EAAA,YAAI,UAAW,kFACdqtB,EACEE,EACEc,EAAY,OACR,oCACA,0BACFZ,EACA,yBACA,4BACF,2BACN,GACE,UAACztB,OAAA,OAAI,UAAU,WACZ,UAAAqtB,GAAmBE,EAClBrwB,EAAA,IAACmM,GAAA,CACC,KAAM,GACN,UAAW,+BACTglB,EAAY,OACR,0CACA,0BACN,GACF,EACEhB,GAAmBI,EACpBvwB,MAAAoN,GAAA,CAAQ,KAAM,EAAI,GAEnBpN,MAACmM,GAAI,MAAM,EAAI,GAIhBgkB,GAAmBE,GAAec,EAAY,QAC7CnxB,EAAA,IAAC,OACC,UAAW,yEACTmxB,EAAY,KAAO,GAAM,uBAAyB,sBACpD,GACF,GAEJ,EAECnxB,EAAA,YAAK,UAAU,sBACb,SAACmwB,EACDE,EAAec,EAAY,OAAS,eAAiB,eACrDZ,EAAa,cAAgB,QAFV,YAGtB,EAGCJ,GAAmBE,GACjBvtB,OAAA,OAAI,UAAU,8BACb,UAAA9C,EAAA,IAAC,OACC,UAAW,oDACTmxB,EAAY,QAAU,GAAM,gBAAkB,cAChD,GACF,EACAnxB,EAAA,IAAC,OACC,UAAW,oDACTmxB,EAAY,QAAU,GAAM,gBAAkB,cAChD,GACF,EACAnxB,EAAA,IAAC,OACC,UAAW,oDACTmxB,EAAY,KAAO,GAAM,gBAAkB,cAC7C,GACF,GACF,GAEJ,CACF,IACF,EAGAruB,OAAC,MAAI,WAAU,+BAEb,UAACA,OAAA,OAAI,UAAU,0CACb,UAAC9C,EAAA,UAAG,UAAU,2CAA2C,SAAe,oBACvEA,EAAA,SAAE,UAAU,gCACV,YAAkB,uCACrB,GACF,EAGA8C,OAAC,MAAI,WAAU,uCACZ,UAAA8tB,EAAoB,IAAI,CAACxyB,EAASiL,IAChCvG,OAAA,OAAgB,UAAU,4BACzB,UAACA,OAAA,OAAI,UAAU,mCACb,UAAA9C,EAAA,IAAC,OAAK,WAAU,8BAA+B,SAAA5B,EAAQ,UAAU,EACjE4B,MAAC,OAAK,WAAU,wBACb,aAAI,KAAK5B,EAAQ,SAAS,EAAE,mBAC/B,KACF,EACC4B,EAAA,SAAE,UAAU,gBAAiB,WAAQ,QAAQ,EAC7C5B,EAAQ,kBAAoBA,EAAQ,iBAAiB,OAAS,GAC7D0E,EAAA,KAAC,MAAI,WAAU,OACb,UAAC9C,EAAA,SAAE,UAAU,oCAAoC,SAAkB,uBAClEA,EAAA,UAAG,UAAU,6BACX,SAAQ5B,EAAA,iBAAiB,IAAI,CAACoQ,EAAQokB,IACpC9vB,OAAA,MAAqB,UAAU,OAAO,eAAG0L,CAAA,GAAjCokB,CAAwC,CAClD,EACH,GACF,IAhBMvpB,CAkBV,CACD,EACDrJ,MAAC,MAAI,KAAKyxB,CAAoB,IAChC,EAGA3uB,OAAC,MAAI,WAAU,0CACZ,UAACqtB,EAUArtB,EAAA,KAAC,UACC,QAASyvB,EACT,UAAU;AAAA,wGAGV,UAACvyB,MAAAqM,GAAA,CAAM,KAAM,EAAI,GACjBrM,MAAC,QAAK,SAAW,iBACnB,EAhBAA,EAAA,IAAC,UACC,QAASiyB,EACT,SAAUnB,IAAqB,YAC/B,UAAU;AAAA,iHAGT,SAAAA,IAAqB,aAAe,gBAAkB,uBAc1D1wB,GACC0C,EAAA,KAAC,MAAI,WAAU,mFACb,UAAA9C,EAAA,IAAC2e,GAAc,MAAM,GAAI,UAAU,eAAe,EACjD3e,EAAA,YAAK,UAAU,uBAAwB,SAAaI,EAAA,GACvD,EAID+vB,GACCrtB,EAAA,KAAC,MAAI,WAAU,wDACb,UAAC9C,EAAA,UAAG,UAAU,yCAAyC,SAAgB,qBACvE8C,OAAC,MAAI,WAAU,kCACb,UAAAA,OAAC,MAAI,yBAAYutB,EAAc,MAAQ,MAAK,SAC3C,MAAI,4BAAec,EAAY,OAAS,MAAQ,MAAK,SACrD,MAAI,8BAAiBA,EAAY,QAAU,KAAK,QAAQ,CAAC,EAAE,KAAC,SAC5D,MAAI,2BAAcA,EAAY,KAAO,KAAK,QAAQ,CAAC,EAAE,KAAC,GACzD,EAGAnxB,EAAA,IAAC,UACC,QAAS,SAAY,CACnB,QAAQ,IAAI,iCAAiC,EAC7C,MAAM6yB,GAAgB,aAAM,2BAAAnE,EAAA,EAAuC,SAAG,QAAQ,YAAY,EACtF,IACF,MAAMtoB,EAAS,MAAMysB,EAAa,eAAe,IAAM,EAAK,EAC5D,QAAQ,IAAI,yBAAyBzsB,EAAS,OAAS,MAAM,EAAE,QACxD7H,EAAO,CACN,cAAM,uBAAwBA,CAAK,CAC7C,CACF,EACA,UAAU,4FACX,iCAED,GACF,GAEJ,GACF,GACF,EAGAyB,EAAA,IAAC6uB,GAAA,CACC,cAAe0C,EAAiB,QAChC,OAAQF,EACR,QAAS,IAAMC,EAAmB,EAAK,EACzC,CACF,GAEJ,CCriBO,MAAMwB,GAAyB,IAAM,CAC1C,KAAM,CAAE,KAAM/kB,EAAc,UAAAnL,EAAW,MAAArE,EAAO,QAAAw0B,CAAA,EAAYvlB,KACpD,CAAE,SAAAhH,GAAaD,KAErBysB,GAAM,UAAU,IAAM,CACpBxsB,EAAS,4BAA6B,QAAQ,GAC7C,CAACA,CAAQ,CAAC,EAEP,MAAAysB,EAAmBviB,GAAuB,CAC9C,GAAI,CAACA,EAAkB,iBAEnB,IACI,MAAAhT,EAAO,IAAI,KAAKgT,CAAS,EAC/B,OAAI,MAAMhT,EAAK,QAAQ,CAAC,EACf,WAGFA,EAAK,eAAe,OAAW,CACpC,KAAM,UACN,MAAO,QACP,IAAK,UACL,KAAM,UACN,OAAQ,UACR,OAAQ,UACT,OACa,CACP,gBACT,GAGIw1B,EAAkB3U,GAAmB,CACjC,OAAAA,GAAA,YAAAA,EAAQ,cAAe,CAC7B,IAAK,UACI,2CACT,IAAK,WACI,6CACT,IAAK,YACI,uCACT,QACS,wCACX,GAGI4U,EAAiB5U,GAAmB,CAChC,OAAAA,GAAA,YAAAA,EAAQ,cAAe,CAC7B,IAAK,UACI,UACT,IAAK,WACI,WACT,IAAK,YACI,UACT,QACS,SACX,GAGI6U,EAAkB7U,GAAmB,CACzC,MAAMhQ,EAAc,sEACZ,OAAAgQ,GAAA,YAAAA,EAAQ,cAAe,CAC7B,IAAK,UACH,MAAO,GAAGhQ,CAAW,qEACvB,IAAK,WACH,MAAO,GAAGA,CAAW,yEACvB,IAAK,YACH,MAAO,GAAGA,CAAW,6DACvB,QACE,MAAO,GAAGA,CAAW,gEACzB,GAIA,OAAAzL,EAAA,KAAC,MAAI,WAAU,kCAEb,UAACA,OAAA,OAAI,UAAU,oCACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,mDAAmD,SAEjE,kBACCA,EAAA,SAAE,UAAU,wCAAwC,SAErD,gDACF,EACA8C,EAAA,KAAC,UAAO,KAAK,SACX,QAAS,IAAMiwB,EAAQ,EACvB,SAAUnwB,EACV,UAAU,iDACV,aAAW,+BAEX,UAAA5C,MAACwM,IAAU,UAAW,WAAW5J,EAAY,eAAiB,EAAE,GAAI,EACpE5C,MAAC,QAAK,SAAO,aACf,GACF,EAGC4C,SACE,MAAI,WAAU,yCACb,SAACE,OAAA,OAAI,UAAU,8BACb,UAAC9C,MAAAwM,GAAA,CAAU,UAAU,oCAAqC,GACzDxM,EAAA,YAAK,UAAU,wCAAwC,SAExD,+BACF,CACF,GAIDzB,SACE,MAAI,WAAU,wFACb,SAACuE,OAAA,OAAI,UAAU,oBACb,UAAC9C,MAAAqb,GAAA,CAAY,UAAU,2BAA4B,UAClD,MACC,WAACrb,EAAA,UAAG,UAAU,qDAAqD,SAEnE,8BACC,IAAE,WAAU,sCACV,SAAAzB,EAAM,SAAW,0CACpB,EACAyB,EAAA,IAAC,UAAO,KAAK,SACX,QAAS,IAAM+yB,EAAQ,EACvB,UAAU,mGACX,qBAED,GACF,GACF,CACF,GAIDhlB,GAAgB,CAACnL,GAGdE,EAAA,KAAAM,EAAA,oBAACN,OAAA,OAAI,UAAU,uFACb,UAACA,OAAA,OAAI,UAAU,yCACb,UAAC9C,EAAA,UAAG,UAAU,sDAAsD,SAEpE,iCACC,MAAI,WAAWozB,EAAerlB,EAAa,MAAM,EAChD,UAAA/N,MAAC,QAAK,UAAU,OAAQ,SAAcmzB,EAAAplB,EAAa,MAAM,EAAE,EAC1DA,EAAa,QAChB,GACF,EAEAjL,OAAC,MAAI,WAAU,wCACb,UAACA,OAAA,OAAI,UAAU,cACb,UAAA9C,MAAC,OAAI,UAAU,gBAAiB,SAAcmzB,EAAAplB,EAAa,MAAM,EAAE,EAClE/N,EAAA,WAAI,UAAU,2CAA2C,SAAM,WAChEA,MAAC,MAAI,WAAW,eAAekzB,EAAenlB,EAAa,MAAM,CAAC,GAC/D,SAAAA,EAAa,MAChB,IACF,EAEAjL,OAAC,MAAI,WAAU,cACb,UAAC9C,EAAA,WAAI,UAAU,gBAAgB,SAAE,OAChCA,EAAA,WAAI,UAAU,2CAA2C,SAAa,kBACvEA,MAAC,MAAI,WAAU,4CACZ,SAAA+N,EAAa,cAAgB,GAAGA,EAAa,aAAa,KAAO,KACpE,IACF,EAEAjL,OAAC,MAAI,WAAU,cACb,UAAC9C,EAAA,WAAI,UAAU,gBAAgB,SAAE,OAChCA,EAAA,WAAI,UAAU,2CAA2C,SAAY,uBACrE,MAAI,WAAU,4CACZ,SAAgBizB,EAAAllB,EAAa,SAAS,EACzC,GACF,GACF,GACF,EAGCA,EAAa,QAAU,OAAO,KAAKA,EAAa,MAAM,EAAE,OAAS,GAChEjL,EAAA,KAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAC9C,MAAAyK,GAAA,CAAS,UAAU,cAAe,GAAE,mBAEvC,QAEC,MAAI,WAAU,YACZ,SAAO,eAAQsD,EAAa,MAAM,EAAE,IAAI,CAAC,CAACslB,EAAaC,CAAa,IAClExwB,OAAA,OAAsB,UAAU,+EAC/B,UAACA,OAAA,OAAI,UAAU,8BACb,UAAA9C,MAAC,QAAK,UAAU,UAAW,SAAcmzB,EAAAG,EAAc,MAAM,EAAE,SAC9D,MACC,WAAAtzB,MAAC,OAAI,UAAU,uDACZ,WAAY,QAAQ,KAAM,GAAG,EAChC,EACCszB,EAAc,aACbtzB,EAAA,IAAC,OAAI,UAAU,2CACZ,WAAc,YACjB,GAEJ,GACF,EAEA8C,OAAC,MAAI,WAAU,8BACZ,UAAAwwB,EAAc,UACbxwB,OAAC,MAAI,WAAU,2CACZ,UAAcwwB,EAAA,SAAS,MAC1B,EAEFtzB,MAAC,OAAI,UAAWozB,EAAeE,EAAc,MAAM,EAChD,WAAc,OACjB,GACF,IAxBQD,CAyBV,CACD,EACH,GACF,EAIFvwB,OAAC,MAAI,WAAU,uFACb,UAACA,OAAA,MAAG,UAAU,6EACZ,UAAC9C,MAAA+L,GAAA,CAAK,UAAU,cAAe,GAAE,sBAEnC,EAEAjJ,OAAC,MAAI,WAAU,wCACb,UAAAA,OAAC,MACC,WAAC9C,EAAA,UAAG,UAAU,iDAAiD,SAAa,kBAC5E8C,OAAC,MAAI,WAAU,oBACb,UAACA,OAAA,OAAI,UAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAa,kBAC/DA,EAAA,YAAK,UAAU,0CAA0C,SAAO,aACnE,EACA8C,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAS,cAC3DA,EAAA,YAAK,UAAU,0CAA0C,SAAS,eACrE,EACA8C,OAAC,MAAI,WAAU,uBACb,UAAC9C,EAAA,YAAK,UAAU,mCAAmC,SAAY,iBAC9DA,EAAA,YAAK,UAAU,0CAA0C,SAAY,kBACxE,GACF,GACF,SAEC,MACC,WAACA,EAAA,UAAG,UAAU,iDAAiD,SAAiB,sBAChF8C,OAAC,MAAI,WAAU,oBACb,UAACA,OAAA,OAAI,UAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,mCAAoC,GAClDA,EAAA,YAAK,UAAU,gCAAgC,SAAa,mBAC/D,EACA8C,OAAC,MAAI,WAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,kCAAmC,GACjDA,EAAA,YAAK,UAAU,gCAAgC,SAAiB,uBACnE,EACA8C,OAAC,MAAI,WAAU,8BACb,UAAC9C,MAAA,OAAI,UAAU,oCAAqC,GACnDA,EAAA,YAAK,UAAU,gCAAgC,SAAoB,0BACtE,GACF,GACF,GACF,GACF,GACF,CAEJ,GAEJ,EAEauzB,GAAqB,IAE9BzwB,EAAA,KAAC,MAAI,WAAU,oBACb,UAAC9C,EAAA,UAAG,UAAU,0BAA0B,SAAc,mBACrDA,EAAA,SAAE,UAAU,wCAAwC,SAErD,+CACAA,EAAA,IAAC,KACC,KAAK,IACL,UAAU,mBACX,2BAED,CACF,ICxREwzB,GAAc,IAAIC,GAAY,CAClC,eAAgB,CACd,QAAS,CACP,MAAO,CAACC,EAAcn1B,IAAU,CAE9B,GAAIA,GAAS,OAAOA,GAAU,UAAY,SAAUA,EAAO,CACzD,MAAM4B,EAAa5B,EAAc,KACjC,GAAI4B,GAAA,MAAAA,EAAW,WAAW,WAAaA,IAAc,WAC5C,QAEX,CACA,OAAOuzB,EAAe,CACxB,EACA,UAAW,EAAI,GAAK,IACpB,qBAAsB,EACxB,EACA,UAAW,CACT,MAAO,CACT,CACF,CACF,CAAC,EAED,SAASC,IAAM,CAEX,OAAA7wB,EAAA,KAAC8wB,GAAoB,QAAQJ,GAC3B,UAACxzB,MAAAZ,GAAA,CACC,SAACY,EAAA,IAAAyC,GAAA,CACC,SAACzC,MAAAsG,GAAA,CACC,eAACutB,GACC,UAAA7zB,MAACyI,GACC,UAAA3F,EAAA,KAACgxB,GAEG,WAAA9zB,EAAA,IAAC+zB,GAAA,CACC,KAAK,IACL,eACGlwB,GAAe,cAAc,CAAC5B,GAAU,MAAOA,GAAU,aAAa,EACrE,UAAAjC,EAAA,IAACgE,GAAkB,UAClB4J,GAAU,KACb,EAEJ,EAGA5N,EAAA,IAAC+zB,GAAA,CACC,KAAK,UACL,QACG/zB,MAAA6D,GAAA,CAAe,aAAc,CAAC5B,GAAU,KAAK,EAC5C,SAACjC,EAAA,IAAAoT,GAAA,EAAc,CACjB,GAEJ,EACApT,EAAA,IAAC+zB,GAAA,CACC,KAAK,YACL,QACG/zB,MAAA6D,GAAA,CAAe,aAAc,CAAC5B,GAAU,KAAK,EAC5C,SAACjC,EAAA,IAAA4b,GAAA,EAAS,CACZ,GAEJ,EACA5b,EAAA,IAAC+zB,GAAA,CACC,KAAK,uBACL,QACG/zB,MAAA6D,GAAA,CAAe,aAAc,CAAC5B,GAAU,KAAK,EAC5C,SAACjC,EAAA,IAAA4f,GAAA,EAAc,CACjB,GAEJ,EACA5f,EAAA,IAAC+zB,GAAA,CACC,KAAK,eACL,QACG/zB,MAAA6D,GAAA,CAAe,aAAc,CAAC5B,GAAU,KAAK,EAC5C,SAACjC,EAAA,IAAAihB,GAAA,EAAY,CACf,GAEJ,EACAjhB,EAAA,IAAC+zB,GAAA,CACC,KAAK,WACL,QACE/zB,EAAA,IAAC6D,GAAe,cAAc,CAAC5B,GAAU,MAAOA,GAAU,aAAa,EACrE,SAACjC,MAAAsqB,GAAA,EAAa,CAChB,GAEJ,EACAtqB,EAAA,IAAC+zB,GAAA,CACC,KAAK,oBACL,QACE/zB,EAAA,IAAC6D,GAAe,cAAc,CAAC5B,GAAU,MAAOA,GAAU,aAAa,EACrE,SAACjC,MAAAkrB,GAAA,EAAgB,CACnB,GAEJ,EACAlrB,EAAA,IAAC+zB,GAAA,CACC,KAAK,4BACL,QACE/zB,EAAA,IAAC6D,GAAe,cAAc,CAAC5B,GAAU,MAAOA,GAAU,aAAa,EACrE,SAAAjC,MAAC+vB,GAAuB,QAAO,cAAe,GAChD,EAEJ,EACA/vB,EAAA,IAAC+zB,GAAA,CACC,KAAK,UACL,QACG/zB,MAAA6D,GAAA,CAAe,aAAc,CAAC5B,GAAU,KAAK,EAC5C,SAACjC,EAAA,IAAA8yB,GAAA,EAAa,CAChB,GAEJ,QAGCiB,GAAM,MAAK,IAAI,QAAS/zB,MAACuzB,IAAS,GAAI,GACzC,CACF,GACF,CACF,GACF,CACF,GAGC,EACH,GAEN,CChIA,MAAMS,GAAc,aAAa,QAAQ,UAAU,EAC7CC,GAAc,OAAO,WAAW,8BAA8B,EAAE,QAChEC,GAAeF,KAAgB,QAAW,CAACA,IAAeC,GAE5DC,GACO,yBAAgB,UAAU,IAAI,MAAM,EAEpC,yBAAgB,UAAU,OAAO,MAAM,EAGlDC,GAAS,WAAW,SAAS,eAAe,MAAM,CAAE,EAAE,aACnDnB,GAAM,WAAN,CACC,SAAAhzB,MAAC2zB,IAAI,GACP,CACF","names":["m","require$$0","client","getRandomValues","rnds8","rng","byteToHex","i","unsafeStringify","arr","offset","randomUUID","native","v4","options","buf","rnds","config","STORAGE_KEYS","API_ENDPOINTS","A11Y","getUserId","userId","uuidv4","getStoredTheme","stored","setStoredTheme","theme","getStoredProcessingMode","setStoredProcessingMode","isMultiMode","formatRelativeTime","date","now","target","diffMs","diffMinutes","diffHours","diffDays","formatDateTime","createAppError","code","message","details","isNetworkError","error","announceToScreenReader","priority","announcement","focusElement","elementId","delay","element","ThemeContext","createContext","useTheme","context","useContext","ThemeProvider","children","setThemeState","useState","setTheme","newTheme","toggleTheme","useEffect","mediaQuery","handleChange","e","value","jsx","Constants","AuthError","errorCode","errorMessage","suberror","errorString","correlationId","LogLevel","Logger","loggerOptions","packageName","packageVersion","defaultLoggerCallback","setLoggerOptions","logMessage","log","level","containsPii","InteractionType","InteractionStatus","storageNotSupported","stubbedPublicClientApplicationCalled","inMemRedirectUnavailable","BrowserConfigurationAuthErrorMessages","BrowserConfigurationAuthError","createBrowserConfigurationAuthError","stubbedPublicClientApplication","defaultMsalContext","MsalContext","React.createContext","useMsal","silentRequest","APP_ROLES","AuthContext","useAuth","AuthenticatedTemplate","UnauthenticatedTemplate","mockUser","MockAuthProvider","mockAuthValue","ConditionalAuthProvider","LoginPrompt","login","isLoading","handleLogin","jsxs","RequireAuth","fallback","redirectTo","location","useLocation","Fragment","Navigate","RequireRole","roles","requireAll","hasRole","hasAnyRole","user","role","ProtectedRoute","requireAuth","requireRoles","RoleBasedRedirect","navigate","useNavigate","isAuthenticated","defaultPath","AuthProvider","msalInstance","accounts","__publicField","account","useAuthProvider","instance","ApiClient","baseUrl","authProvider","response","errorData","endpoint","cleanEndpoint","url","defaultHeaders","authHeaders","authError","data","apiClient","setApiAuthProvider","apiService","request","sessionId","sessionData","text","PredictionPoller","onUpdate","onComplete","onError","poll","result","nextInterval","ApiAuthInitializer","useAnnouncements","announce","useCallback","announceError","announceSuccess","useKeyboardNavigation","handleEscape","callback","handleKeyDown","event","handleEnterSpace","useSkipToContent","Header","className","logout","isAdmin","isMobileMenuOpen","setIsMobileMenuOpen","showUserMenu","setShowUserMenu","isAuthEnabled","getNavigationItems","navItems","isActivePath","path","toggleMobileMenu","closeMobileMenu","handleClickOutside","Link","label","icon","MicrosoftLogo","size","props","Layout","skipToMain","toKebabCase","string","toCamelCase","match","p1","p2","toPascalCase","camelCase","mergeClasses","classes","index","array","hasA11yProp","prop","defaultAttributes","Icon","forwardRef","color","strokeWidth","absoluteStrokeWidth","iconNode","rest","ref","createElement","tag","attrs","createLucideIcon","iconName","Component","__iconNode","Activity","ArrowLeft","ArrowRight","Brain","Calendar","ChartColumn","ChartPie","ChevronDown","ChevronUp","CircleAlert","CircleCheckBig","CircleX","Clock","Download","EyeOff","Eye","FileAudio","FileText","File","Files","Funnel","Heart","Info","Lightbulb","LoaderCircle","MessageCircle","Mic","Pause","Phone","Play","Plus","RefreshCw","Search","Settings","ShieldAlert","Target","Trash2","TrendingDown","TrendingUp","TriangleAlert","Upload","User","Users","Volume2","VolumeX","X","QUERY_KEYS","useHealthCheck","useQuery","useUserSessions","effectiveUserId","Dashboard","canAccessControlPanel","getAuthenticatedUserId","healthStatus","isHealthLoading","healthError","sessionsResponse","isSessionsLoading","quickActions","getActionClasses","disabled","baseClasses","action","a","b","session","_a","_b","AudioProcessor","FFmpeg","baseURL","toBlobURL","file","onProgress","progress","inputName","fetchFile","outputName","command","outputData","outputBlob","convertedFile","filename","lastDot","supportedFormats","extension","audioProcessorInstance","getAudioProcessor","convertAudioToWav","AzureBlobService","sasUrl","blobServiceClient","BlobServiceClient","fileName","containerClient","blobName","timestamp","randomId","blockBlobClient","uploadProgress","progressPercent","blobUrl","originalFileName","userPrefix","blobs","blob","userFiles","deletedCount","fileCount","totalSizeBytes","blobServiceInstance","getBlobService","uploadToAzureBlob","blobService","fileToUpload","useAccessibility","announcementRef","useRef","liveRegion","focusManagement","container","firstElement","focusableElements","lastElement","handleTabKey","keyboardNavigation","items","currentIndex","onIndexChange","newIndex","onEscape","generateId","prefix","prefersReducedMotion","getValidationAttributes","isValid","describedById","attributes","UploadAnalyze","audioFiles","setAudioFiles","setIsMultiMode","processingProgress","setProcessingProgress","results","setResults","fileStates","setFileStates","isProcessing","setIsProcessing","audioFile","setAudioFile","setProgress","setResult","isPlaying","setIsPlaying","currentTime","setCurrentTime","playingFileId","setPlayingFileId","prefilledData","userMetadata","setUserMetadata","_c","_d","_e","_g","_f","_i","_h","_j","_k","setError","toasts","setToasts","validationErrors","setValidationErrors","isCorrectingGrammar","setIsCorrectingGrammar","newUserId","prev","audioRef","fileInputRef","addToast","type","title","id","newToast","toast","removeToast","mockFile","virtualAudioFile","resetState","generateFileId","addAudioFile","audio","af","removeAudioFile","fileId","fileToRemove","f","removed","handleFileSelect","files","supportedMimeTypes","hasValidExtension","ext","maxSize","handleDragOver","handleDrop","toggleMode","newMode","handlePlayPause","handleTimeUpdate","formatTime","seconds","mins","secs","validateMetadata","errors","age","weight","validateAge","validateWeight","validateZipcode","validateSessionNotes","handleFieldValidation","field","newErrors","err","prevError","handleGrammarCorrection","buildMetadata","metadata","hasMetadata","processAndAnalyze","processMultipleFiles","processSingleFile","processSingleFileById","sessionRequest","sessionResponse","initialSessionData","saveResult","audioUrl","convertedBlob","updatedSessionData","poller","resolve","reject","analysisResult","insight","finalSessionData","errorDetails","currentProgress","failedSessionData","updateError","cleanupError","filesToProcess","totalFiles","completedFiles","startSingleFile","getProgressColor","stage","newValue","Loader2","fileState","CheckCircle","AlertCircle","statusConfig","XCircle","formatScoreCategory","category","l","getSeverityLevel","Sessions","sessions","setSessions","loading","setLoading","selectedSessions","setSelectedSessions","showFilters","setShowFilters","filters","setFilters","loadSessions","transformedSessions","prediction","analysisResults","appError","filteredAndSortedSessions","useMemo","filtered","searchLower","startDate","comparison","depressionA","depressionB","anxietyA","anxietyB","updateFilter","key","toggleSessionSelection","newSelection","toggleSelectAll","s","handleDeleteSession","handleRerunSession","handleBulkDelete","sessionIds","successCount","failedSessions","formatFileSize","bytes","k","sizes","StatusBadge","status","normalizedStatus","Filter","riskLevelConfig","AlertTriangle","RiskAssessmentComponent","existingAssessment","onAssessmentUpdated","assessment","setAssessment","isGenerating","setIsGenerating","setIsLoading","generateAssessment","loadAssessment","RiskLevelBadge","riskLevel","riskScore","factor","recommendation","followUp","SessionDetail","useParams","setSession","showRawJson","setShowRawJson","isRefreshing","setIsRefreshing","audioPlaying","setAudioPlaying","loadSession","refreshSession","toggleRawJson","newState","toggleAudioPlayback","downloadSessionData","dataStr","dataBlob","link","downloadAudioFile","downloadUrl","_l","Predictions","handleBarClick","loadPredictions","sessionsWithPredictions","filteredSessions","chartData","mapCategoryToNumber","depression","anxiety","scoreDistribution","distributions","categories","depressionScores","score","cat","count","percentage","anxietyScores","trendAnalysis","trends","getCategorySeverity","depressionCategories","severityScores","firstHalf","secondHalf","firstAvg","change","anxietyCategories","statistics","stats","depressionCounts","mostCommonDepression","anxietyCounts","mostCommonAnxiety","downloadPredictions","TrendIndicator","trend","colorClass","SimpleLineChart","onBarClick","scores","d","maxScore","minScore","range","getScoreCategoryName","getCategoryColor","getLegendItems","chartType","item","usedScores","activeLegendItems","dataPoint","height","categoryColor","categoryName","dateStr","counts","BarChart3","PieChart","scoreType","distribution","getPercentage","total","aggregateSessionData","allSessions","totalSessions","uniqueUsers","completedSessions","processingSessions","successRate","avgSessionsPerUser","twentyFourHoursAgo","recentActivity","riskCounts","depressionCategory","anxietyCategory","timeData","sessionsOnDate","userStatsMap","groupingUserId","userStats","successfulSessions","confidenceValues","c","avgConfidence","sum","userRiskDistribution","userDepressionScores","userAnxietyScores","lastActivity","latest","correlations","hasDepressionCase","hasAnxietyCase","hasDepression","hasAnxiety","ageGroup","gender","race","ethnicity","language","weightGroup","zipPrefix","region","MetricCard","subtitle","DistributionChart","TimeSeriesChart","maxCount","minCount","point","barWidth","x","barHeight","y","dayName","monthDay","MetadataCorrelationChart","categoryData","depressionRate","anxietyRate","CorrelationChart","depressionData","anxietyData","correlationPoints","maxValue","p","getColor","severity","radius","FunnelChart","sessionStatus","stages","width","conversionRate","UserStatsTable","showConfidenceModal","setShowConfidenceModal","showRiskModal","setShowRiskModal","formatDate","dateString","getRiskColor","totalUsers","u","topPerformer","best","current","ControlPanel","analytics","setAnalytics","lastRefresh","setLastRefresh","refreshInterval","loadAnalytics","allSessionsResponse","apiError","aggregatedData","interval","handleRetry","AgentExperience","timer","handleRedirectNow","_AudioDeviceService","track","needsUserGesture","permission","devices","device","defaultDevice","deviceId","constraints","audioConstraints","stream","durationMs","enablePlayback","audioContext","source","analyser","gainNode","dataArray","hasAudioInput","average","AudioDeviceService","SessionResource","connection","eventId","ResponseResource","additionalInstructions","responseId","InputAudioBufferResource","OutputAudioBufferResource","ConversationItemResource","previousItemId","itemId","audioEndMs","contentIndex","ConversationResource","VoiceLiveConnection","EventEmitter","wsUrl","closeReason","audioBuffer","samples","peak","active","audioData","arrayBuffer","originalData","paddedData","base64Audio","createVoiceLiveConnection","attempt","isResourceError","SpeechAvatarService","sessionConfig","audioDeviceService","permissionStatus","listener","MicrophoneSettings","speechService","onClose","isOpen","setDevices","selectedDevice","setSelectedDevice","setPermissionStatus","testingAudio","setTestingAudio","audioTestResult","setAudioTestResult","loadDevices","availableDevices","requestPermission","selectDevice","testAudio","hasInput","SpeechAvatarExperience","agentType","onSessionEnd","onRiskDetected","isSessionActive","setIsSessionActive","isListening","setIsListening","isSpeaking","setIsSpeaking","setSessionId","currentMessage","setCurrentMessage","conversationHistory","setConversationHistory","connectionStatus","setConnectionStatus","setErrorMessage","isAudioEnabled","setIsAudioEnabled","audioLevels","setAudioLevels","showMicSettings","setShowMicSettings","speechServiceRef","avatarVideoRef","conversationEndRef","agentConfig","initializeSpeechService","apiKey","service","isActive","levels","errorMsg","startSession","apiBaseUrl","backendError","speechError","welcomeMessage","getWelcomeMessage","endSession","sessionSummary","toggleAudio","statusDisplay","n","actionIndex","audioService","SystemHealth","refetch","React","formatTimestamp","getStatusColor","getStatusIcon","getStatusBadge","serviceName","serviceStatus","NotFound","queryClient","QueryClient","failureCount","App","QueryClientProvider","Router","Routes","Route","storedTheme","prefersDark","initialTheme","ReactDOM"],"sources":["../../node_modules/react-dom/client.js","../../node_modules/uuid/dist/esm-browser/rng.js","../../node_modules/uuid/dist/esm-browser/stringify.js","../../node_modules/uuid/dist/esm-browser/native.js","../../node_modules/uuid/dist/esm-browser/v4.js","../../src/config/constants.ts","../../src/utils/index.ts","../../src/contexts/ThemeContext.tsx","../../node_modules/@azure/msal-common/dist/utils/Constants.mjs","../../node_modules/@azure/msal-common/dist/error/AuthError.mjs","../../node_modules/@azure/msal-common/dist/logger/Logger.mjs","../../node_modules/@azure/msal-browser/dist/utils/BrowserConstants.mjs","../../node_modules/@azure/msal-browser/dist/error/BrowserConfigurationAuthErrorCodes.mjs","../../node_modules/@azure/msal-browser/dist/error/BrowserConfigurationAuthError.mjs","../../node_modules/@azure/msal-browser/dist/app/IPublicClientApplication.mjs","../../node_modules/@azure/msal-react/dist/MsalContext.js","../../node_modules/@azure/msal-react/dist/hooks/useMsal.js","../../src/config/authConfig.ts","../../src/contexts/AuthContext.tsx","../../src/contexts/MockAuthContext.tsx","../../src/components/auth/ConditionalAuthProvider.tsx","../../src/components/auth/AuthGuards.tsx","../../src/components/auth/RoleBasedRedirect.tsx","../../src/services/authProvider.ts","../../src/services/api.ts","../../src/components/auth/ApiAuthInitializer.tsx","../../src/hooks/accessibility.ts","../../src/components/layout/Header.tsx","../../src/components/icons/MicrosoftLogo.tsx","../../src/components/layout/Layout.tsx","../../node_modules/lucide-react/dist/esm/shared/src/utils.js","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/Icon.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/activity.js","../../node_modules/lucide-react/dist/esm/icons/arrow-left.js","../../node_modules/lucide-react/dist/esm/icons/arrow-right.js","../../node_modules/lucide-react/dist/esm/icons/brain.js","../../node_modules/lucide-react/dist/esm/icons/calendar.js","../../node_modules/lucide-react/dist/esm/icons/chart-column.js","../../node_modules/lucide-react/dist/esm/icons/chart-pie.js","../../node_modules/lucide-react/dist/esm/icons/chevron-down.js","../../node_modules/lucide-react/dist/esm/icons/chevron-up.js","../../node_modules/lucide-react/dist/esm/icons/circle-alert.js","../../node_modules/lucide-react/dist/esm/icons/circle-check-big.js","../../node_modules/lucide-react/dist/esm/icons/circle-x.js","../../node_modules/lucide-react/dist/esm/icons/clock.js","../../node_modules/lucide-react/dist/esm/icons/download.js","../../node_modules/lucide-react/dist/esm/icons/eye-off.js","../../node_modules/lucide-react/dist/esm/icons/eye.js","../../node_modules/lucide-react/dist/esm/icons/file-audio.js","../../node_modules/lucide-react/dist/esm/icons/file-text.js","../../node_modules/lucide-react/dist/esm/icons/file.js","../../node_modules/lucide-react/dist/esm/icons/files.js","../../node_modules/lucide-react/dist/esm/icons/funnel.js","../../node_modules/lucide-react/dist/esm/icons/heart.js","../../node_modules/lucide-react/dist/esm/icons/info.js","../../node_modules/lucide-react/dist/esm/icons/lightbulb.js","../../node_modules/lucide-react/dist/esm/icons/loader-circle.js","../../node_modules/lucide-react/dist/esm/icons/message-circle.js","../../node_modules/lucide-react/dist/esm/icons/mic.js","../../node_modules/lucide-react/dist/esm/icons/pause.js","../../node_modules/lucide-react/dist/esm/icons/phone.js","../../node_modules/lucide-react/dist/esm/icons/play.js","../../node_modules/lucide-react/dist/esm/icons/plus.js","../../node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../../node_modules/lucide-react/dist/esm/icons/search.js","../../node_modules/lucide-react/dist/esm/icons/settings.js","../../node_modules/lucide-react/dist/esm/icons/shield-alert.js","../../node_modules/lucide-react/dist/esm/icons/target.js","../../node_modules/lucide-react/dist/esm/icons/trash-2.js","../../node_modules/lucide-react/dist/esm/icons/trending-down.js","../../node_modules/lucide-react/dist/esm/icons/trending-up.js","../../node_modules/lucide-react/dist/esm/icons/triangle-alert.js","../../node_modules/lucide-react/dist/esm/icons/upload.js","../../node_modules/lucide-react/dist/esm/icons/user.js","../../node_modules/lucide-react/dist/esm/icons/users.js","../../node_modules/lucide-react/dist/esm/icons/volume-2.js","../../node_modules/lucide-react/dist/esm/icons/volume-x.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../src/hooks/api.ts","../../src/pages/Dashboard.tsx","../../src/services/audio.ts","../../src/services/azure.ts","../../src/hooks/useAccessibility.ts","../../src/pages/UploadAnalyze.tsx","../../src/pages/Sessions.tsx","../../src/components/RiskAssessment.tsx","../../src/pages/SessionDetail.tsx","../../src/pages/Predictions.tsx","../../src/pages/ControlPanel.tsx","../../src/pages/AgentExperience.tsx","../../src/services/audioDeviceService.ts","../../src/services/speechAvatarServiceV2.ts","../../src/components/MicrophoneSettings.tsx","../../src/components/SpeechAvatarExperience.tsx","../../src/pages/index.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","// Environment configuration\r\nexport const config = {\r\n  api: {\r\n    baseUrl: import.meta.env.VITE_API_BASE || 'http://localhost:7071/api',\r\n  },\r\n  azure: {\r\n    blobSasUrl: import.meta.env.VITE_AZURE_BLOB_SAS_URL || '',\r\n    containerName: import.meta.env.VITE_STORAGE_CONTAINER_NAME || 'audio-uploads',\r\n  },\r\n  polling: {\r\n    intervalMs: parseInt(import.meta.env.VITE_POLL_INTERVAL_MS || '3000', 10),\r\n    maxAttempts: 60, // 3 minutes at 3s intervals\r\n    backoffFactor: 1.2,\r\n  },\r\n  features: {\r\n    enableFFmpegWorker: import.meta.env.VITE_ENABLE_FFMPEG_WORKER === 'true',\r\n    enableDebugLogging: import.meta.env.VITE_ENABLE_DEBUG_LOGGING === 'true',\r\n  },\r\n  audio: {\r\n    acceptedFormats: ['.wav', '.mp3', '.m4a', '.aac', '.flac'],\r\n    maxFileSizeMB: 100,\r\n    targetSampleRate: 44100,\r\n    targetChannels: 1,\r\n  },\r\n} as const;\r\n\r\n// Storage keys\r\nexport const STORAGE_KEYS = {\r\n  USER_ID: 'bh_user_id',\r\n  THEME: 'bh_theme',\r\n  UPLOAD_SESSIONS: 'bh_upload_sessions',\r\n  PROCESSING_MODE: 'bh_processing_mode',\r\n  USER_ID_CUSTOM: 'bh_user_id_custom',\r\n} as const;\r\n\r\n// API endpoints\r\nexport const API_ENDPOINTS = {\r\n  HEALTH: '/health',\r\n  SESSIONS_INITIATE: '/sessions/initiate',\r\n  PREDICTIONS_SUBMIT: '/predictions/submit',\r\n  PREDICTIONS_BY_USER: '/predictions',\r\n  PREDICTIONS_BY_SESSION: '/predictions/sessions',\r\n} as const;\r\n\r\n// Validation constants\r\nexport const VALIDATION = {\r\n  USER_ID_PATTERN: /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,\r\n  SESSION_ID_PATTERN: /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,\r\n  MAX_FILE_SIZE_BYTES: 100 * 1024 * 1024, // 100MB\r\n} as const;\r\n\r\n// Accessibility constants\r\nexport const A11Y = {\r\n  SKIP_TO_CONTENT_ID: 'main-content',\r\n  ANNOUNCEMENTS_ID: 'a11y-announcements',\r\n  FOCUS_TIMEOUT: 100,\r\n  DEBOUNCE_MS: 300,\r\n} as const;\r\n","import { v4 as uuidv4 } from 'uuid';\r\nimport { STORAGE_KEYS, VALIDATION } from '@/config/constants';\r\nimport type { Theme, AppError } from '@/types';\r\n\r\n// Global variable to hold the current authenticated user ID\r\nlet currentAuthenticatedUserId: string | null = null;\r\n\r\n// Set the authenticated user ID (called from auth context)\r\nexport const setAuthenticatedUserId = (userId: string | null): void => {\r\n  currentAuthenticatedUserId = userId;\r\n};\r\n\r\n// User ID management - prioritizes authenticated user ID\r\nexport const getUserId = (): string => {\r\n  // If user is authenticated, use their ID\r\n  if (currentAuthenticatedUserId) {\r\n    return currentAuthenticatedUserId;\r\n  }\r\n\r\n  // Fallback to local storage for non-authenticated users\r\n  let userId = localStorage.getItem(STORAGE_KEYS.USER_ID);\r\n  \r\n  // If no User ID exists, generate a new UUID\r\n  if (!userId || userId.trim().length === 0) {\r\n    userId = uuidv4();\r\n    localStorage.setItem(STORAGE_KEYS.USER_ID, userId);\r\n  }\r\n  \r\n  return userId;\r\n};\r\n\r\n// Set a custom user ID\r\nexport const setUserId = (userId: string): void => {\r\n  if (!userId || userId.trim().length === 0) {\r\n    throw new Error('User ID cannot be empty');\r\n  }\r\n  localStorage.setItem(STORAGE_KEYS.USER_ID, userId.trim());\r\n};\r\n\r\n// Generate a new user ID\r\nexport const generateNewUserId = (): string => {\r\n  const newUserId = uuidv4();\r\n  localStorage.setItem(STORAGE_KEYS.USER_ID, newUserId);\r\n  setUserIdMode(false); // Mark as auto-generated\r\n  return newUserId;\r\n};\r\n\r\n// Check if user ID is custom (not auto-generated)\r\nexport const isCustomUserId = (): boolean => {\r\n  return localStorage.getItem('bh_user_id_custom') === 'true';\r\n};\r\n\r\n// Set user ID as custom or auto-generated\r\nexport const setUserIdMode = (isCustom: boolean): void => {\r\n  localStorage.setItem('bh_user_id_custom', isCustom.toString());\r\n};\r\n\r\n// Theme management\r\nexport const getStoredTheme = (): Theme => {\r\n  const stored = localStorage.getItem(STORAGE_KEYS.THEME) as Theme;\r\n  if (stored === 'light' || stored === 'dark') {\r\n    return stored;\r\n  }\r\n  \r\n  // Default to system preference\r\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n};\r\n\r\nexport const setStoredTheme = (theme: Theme): void => {\r\n  localStorage.setItem(STORAGE_KEYS.THEME, theme);\r\n  \r\n  // Apply theme to document\r\n  if (theme === 'dark') {\r\n    document.documentElement.classList.add('dark');\r\n  } else {\r\n    document.documentElement.classList.remove('dark');\r\n  }\r\n};\r\n\r\n// Processing mode management\r\nexport const getStoredProcessingMode = (): boolean => {\r\n  const stored = localStorage.getItem(STORAGE_KEYS.PROCESSING_MODE);\r\n  if (stored === 'true' || stored === 'false') {\r\n    return stored === 'true';\r\n  }\r\n  \r\n  // Default to single file mode\r\n  return false;\r\n};\r\n\r\nexport const setStoredProcessingMode = (isMultiMode: boolean): void => {\r\n  localStorage.setItem(STORAGE_KEYS.PROCESSING_MODE, isMultiMode.toString());\r\n};\r\n\r\n// File utilities\r\nexport const formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  \r\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n};\r\n\r\nexport const formatDuration = (seconds: number): string => {\r\n  const minutes = Math.floor(seconds / 60);\r\n  const remainingSeconds = Math.floor(seconds % 60);\r\n  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n};\r\n\r\nexport const getAudioDuration = (file: File): Promise<number> => {\r\n  return new Promise((resolve, reject) => {\r\n    const audio = new Audio();\r\n    const url = URL.createObjectURL(file);\r\n    \r\n    audio.addEventListener('loadedmetadata', () => {\r\n      URL.revokeObjectURL(url);\r\n      resolve(audio.duration);\r\n    });\r\n    \r\n    audio.addEventListener('error', () => {\r\n      URL.revokeObjectURL(url);\r\n      reject(new Error('Unable to load audio metadata'));\r\n    });\r\n    \r\n    audio.src = url;\r\n  });\r\n};\r\n\r\n// Date utilities\r\nexport const formatRelativeTime = (date: string): string => {\r\n  const now = new Date();\r\n  const target = new Date(date);\r\n  const diffMs = now.getTime() - target.getTime();\r\n  const diffMinutes = Math.floor(diffMs / (1000 * 60));\r\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n  \r\n  if (diffMinutes < 1) return 'Just now';\r\n  if (diffMinutes < 60) return `${diffMinutes}m ago`;\r\n  if (diffHours < 24) return `${diffHours}h ago`;\r\n  if (diffDays < 7) return `${diffDays}d ago`;\r\n  \r\n  return target.toLocaleDateString();\r\n};\r\n\r\nexport const formatDateTime = (date: string): string => {\r\n  return new Date(date).toLocaleString();\r\n};\r\n\r\n// Error handling\r\nexport const createAppError = (code: string, message: string, details?: Record<string, unknown>): AppError => ({\r\n  code,\r\n  message,\r\n  details,\r\n  timestamp: new Date().toISOString(),\r\n});\r\n\r\nexport const isNetworkError = (error: unknown): boolean => {\r\n  if (error instanceof TypeError && error.message.includes('fetch')) {\r\n    return true;\r\n  }\r\n  \r\n  if (error instanceof Error) {\r\n    return error.message.includes('Network') || \r\n           error.message.includes('connection') ||\r\n           error.message.includes('timeout');\r\n  }\r\n  \r\n  return false;\r\n};\r\n\r\n// Validation utilities\r\nexport const isValidUUID = (uuid: string): boolean => {\r\n  const uuidPattern = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n  return uuidPattern.test(uuid);\r\n};\r\n\r\nexport const isValidAudioFile = (file: File): { valid: boolean; error?: string } => {\r\n  // Check file size\r\n  if (file.size > VALIDATION.MAX_FILE_SIZE_BYTES) {\r\n    return {\r\n      valid: false,\r\n      error: `File size exceeds maximum limit of ${formatFileSize(VALIDATION.MAX_FILE_SIZE_BYTES)}`\r\n    };\r\n  }\r\n  \r\n  // Check file type\r\n  const validTypes = ['audio/wav', 'audio/mpeg', 'audio/mp4', 'audio/aac', 'audio/flac', 'audio/x-m4a'];\r\n  if (!validTypes.includes(file.type) && !file.name.match(/\\.(wav|mp3|m4a|aac|flac)$/i)) {\r\n    return {\r\n      valid: false,\r\n      error: 'Please select a valid audio file (WAV, MP3, M4A, AAC, or FLAC)'\r\n    };\r\n  }\r\n  \r\n  return { valid: true };\r\n};\r\n\r\n// Accessibility utilities\r\nexport const announceToScreenReader = (message: string, priority: 'polite' | 'assertive' = 'polite'): void => {\r\n  const announcement = document.createElement('div');\r\n  announcement.setAttribute('aria-live', priority);\r\n  announcement.setAttribute('aria-atomic', 'true');\r\n  announcement.className = 'sr-only';\r\n  announcement.textContent = message;\r\n  \r\n  document.body.appendChild(announcement);\r\n  \r\n  // Remove after announcement\r\n  setTimeout(() => {\r\n    document.body.removeChild(announcement);\r\n  }, 1000);\r\n};\r\n\r\nexport const focusElement = (elementId: string, delay = 100): void => {\r\n  setTimeout(() => {\r\n    const element = document.getElementById(elementId);\r\n    if (element) {\r\n      element.focus();\r\n    }\r\n  }, delay);\r\n};\r\n\r\nexport const trapFocus = (container: HTMLElement): { release: () => void } => {\r\n  const focusableElements = container.querySelectorAll(\r\n    'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n  );\r\n  \r\n  const firstFocusable = focusableElements[0] as HTMLElement;\r\n  const lastFocusable = focusableElements[focusableElements.length - 1] as HTMLElement;\r\n  \r\n  const handleTabKey = (e: KeyboardEvent) => {\r\n    if (e.key !== 'Tab') return;\r\n    \r\n    if (e.shiftKey) {\r\n      if (document.activeElement === firstFocusable) {\r\n        lastFocusable?.focus();\r\n        e.preventDefault();\r\n      }\r\n    } else {\r\n      if (document.activeElement === lastFocusable) {\r\n        firstFocusable?.focus();\r\n        e.preventDefault();\r\n      }\r\n    }\r\n  };\r\n  \r\n  container.addEventListener('keydown', handleTabKey);\r\n  firstFocusable?.focus();\r\n  \r\n  return {\r\n    release: () => {\r\n      container.removeEventListener('keydown', handleTabKey);\r\n    }\r\n  };\r\n};\r\n\r\n// Debounce utility\r\nexport const debounce = <T extends (...args: unknown[]) => void>(\r\n  fn: T,\r\n  delay: number\r\n): ((...args: Parameters<T>) => void) => {\r\n  let timeoutId: NodeJS.Timeout;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn(...args), delay);\r\n  };\r\n};\r\n","import { createContext, useContext, useEffect, useState } from 'react';\r\nimport { getStoredTheme, setStoredTheme } from '@/utils';\r\nimport type { Theme } from '@/types';\r\n\r\ninterface ThemeContextType {\r\n  theme: Theme;\r\n  toggleTheme: () => void;\r\n  setTheme: (theme: Theme) => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport const useTheme = () => {\r\n  const context = useContext(ThemeContext);\r\n  if (context === undefined) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\ninterface ThemeProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const ThemeProvider: React.FC<ThemeProviderProps> = ({ children }) => {\r\n  const [theme, setThemeState] = useState<Theme>(getStoredTheme);\r\n\r\n  const setTheme = (newTheme: Theme) => {\r\n    setThemeState(newTheme);\r\n    setStoredTheme(newTheme);\r\n  };\r\n\r\n  const toggleTheme = () => {\r\n    const newTheme = theme === 'light' ? 'dark' : 'light';\r\n    setTheme(newTheme);\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Apply theme on mount\r\n    setStoredTheme(theme);\r\n  }, [theme]);\r\n\r\n  useEffect(() => {\r\n    // Listen for system theme changes\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n    \r\n    const handleChange = (e: MediaQueryListEvent) => {\r\n      const storedTheme = localStorage.getItem('bh_theme');\r\n      if (!storedTheme) {\r\n        // Only auto-switch if user hasn't set a preference\r\n        setThemeState(e.matches ? 'dark' : 'light');\r\n      }\r\n    };\r\n\r\n    mediaQuery.addEventListener('change', handleChange);\r\n    return () => mediaQuery.removeEventListener('change', handleChange);\r\n  }, []);\r\n\r\n  const value = {\r\n    theme,\r\n    toggleTheme,\r\n    setTheme,\r\n  };\r\n\r\n  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\r\n};\r\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst Constants = {\r\n    LIBRARY_NAME: \"MSAL.JS\",\r\n    SKU: \"msal.js.common\",\r\n    // default authority\r\n    DEFAULT_AUTHORITY: \"https://login.microsoftonline.com/common/\",\r\n    DEFAULT_AUTHORITY_HOST: \"login.microsoftonline.com\",\r\n    DEFAULT_COMMON_TENANT: \"common\",\r\n    // ADFS String\r\n    ADFS: \"adfs\",\r\n    DSTS: \"dstsv2\",\r\n    // Default AAD Instance Discovery Endpoint\r\n    AAD_INSTANCE_DISCOVERY_ENDPT: \"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=\",\r\n    // CIAM URL\r\n    CIAM_AUTH_URL: \".ciamlogin.com\",\r\n    AAD_TENANT_DOMAIN_SUFFIX: \".onmicrosoft.com\",\r\n    // Resource delimiter - used for certain cache entries\r\n    RESOURCE_DELIM: \"|\",\r\n    // Placeholder for non-existent account ids/objects\r\n    NO_ACCOUNT: \"NO_ACCOUNT\",\r\n    // Claims\r\n    CLAIMS: \"claims\",\r\n    // Consumer UTID\r\n    CONSUMER_UTID: \"9188040d-6c67-4c5b-b112-36a304b66dad\",\r\n    // Default scopes\r\n    OPENID_SCOPE: \"openid\",\r\n    PROFILE_SCOPE: \"profile\",\r\n    OFFLINE_ACCESS_SCOPE: \"offline_access\",\r\n    EMAIL_SCOPE: \"email\",\r\n    CODE_GRANT_TYPE: \"authorization_code\",\r\n    RT_GRANT_TYPE: \"refresh_token\",\r\n    S256_CODE_CHALLENGE_METHOD: \"S256\",\r\n    URL_FORM_CONTENT_TYPE: \"application/x-www-form-urlencoded;charset=utf-8\",\r\n    AUTHORIZATION_PENDING: \"authorization_pending\",\r\n    NOT_DEFINED: \"not_defined\",\r\n    EMPTY_STRING: \"\",\r\n    NOT_APPLICABLE: \"N/A\",\r\n    NOT_AVAILABLE: \"Not Available\",\r\n    FORWARD_SLASH: \"/\",\r\n    IMDS_ENDPOINT: \"http://169.254.169.254/metadata/instance/compute/location\",\r\n    IMDS_VERSION: \"2020-06-01\",\r\n    IMDS_TIMEOUT: 2000,\r\n    AZURE_REGION_AUTO_DISCOVER_FLAG: \"TryAutoDetect\",\r\n    REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX: \"login.microsoft.com\",\r\n    KNOWN_PUBLIC_CLOUDS: [\r\n        \"login.microsoftonline.com\",\r\n        \"login.windows.net\",\r\n        \"login.microsoft.com\",\r\n        \"sts.windows.net\",\r\n    ],\r\n    SHR_NONCE_VALIDITY: 240,\r\n    INVALID_INSTANCE: \"invalid_instance\",\r\n};\r\nconst HttpStatus = {\r\n    SUCCESS: 200,\r\n    SUCCESS_RANGE_START: 200,\r\n    SUCCESS_RANGE_END: 299,\r\n    REDIRECT: 302,\r\n    CLIENT_ERROR: 400,\r\n    CLIENT_ERROR_RANGE_START: 400,\r\n    BAD_REQUEST: 400,\r\n    UNAUTHORIZED: 401,\r\n    NOT_FOUND: 404,\r\n    REQUEST_TIMEOUT: 408,\r\n    GONE: 410,\r\n    TOO_MANY_REQUESTS: 429,\r\n    CLIENT_ERROR_RANGE_END: 499,\r\n    SERVER_ERROR: 500,\r\n    SERVER_ERROR_RANGE_START: 500,\r\n    SERVICE_UNAVAILABLE: 503,\r\n    GATEWAY_TIMEOUT: 504,\r\n    SERVER_ERROR_RANGE_END: 599,\r\n    MULTI_SIDED_ERROR: 600,\r\n};\r\nconst HttpMethod = {\r\n    GET: \"GET\",\r\n    POST: \"POST\",\r\n};\r\nconst OIDC_DEFAULT_SCOPES = [\r\n    Constants.OPENID_SCOPE,\r\n    Constants.PROFILE_SCOPE,\r\n    Constants.OFFLINE_ACCESS_SCOPE,\r\n];\r\nconst OIDC_SCOPES = [...OIDC_DEFAULT_SCOPES, Constants.EMAIL_SCOPE];\r\n/**\r\n * Request header names\r\n */\r\nconst HeaderNames = {\r\n    CONTENT_TYPE: \"Content-Type\",\r\n    CONTENT_LENGTH: \"Content-Length\",\r\n    RETRY_AFTER: \"Retry-After\",\r\n    CCS_HEADER: \"X-AnchorMailbox\",\r\n    WWWAuthenticate: \"WWW-Authenticate\",\r\n    AuthenticationInfo: \"Authentication-Info\",\r\n    X_MS_REQUEST_ID: \"x-ms-request-id\",\r\n    X_MS_HTTP_VERSION: \"x-ms-httpver\",\r\n};\r\n/**\r\n * Persistent cache keys MSAL which stay while user is logged in.\r\n */\r\nconst PersistentCacheKeys = {\r\n    ACTIVE_ACCOUNT_FILTERS: \"active-account-filters\", // new cache entry for active_account for a more robust version for browser\r\n};\r\n/**\r\n * String constants related to AAD Authority\r\n */\r\nconst AADAuthorityConstants = {\r\n    COMMON: \"common\",\r\n    ORGANIZATIONS: \"organizations\",\r\n    CONSUMERS: \"consumers\",\r\n};\r\n/**\r\n * Claims request keys\r\n */\r\nconst ClaimsRequestKeys = {\r\n    ACCESS_TOKEN: \"access_token\",\r\n    XMS_CC: \"xms_cc\",\r\n};\r\n/**\r\n * we considered making this \"enum\" in the request instead of string, however it looks like the allowed list of\r\n * prompt values kept changing over past couple of years. There are some undocumented prompt values for some\r\n * internal partners too, hence the choice of generic \"string\" type instead of the \"enum\"\r\n */\r\nconst PromptValue = {\r\n    LOGIN: \"login\",\r\n    SELECT_ACCOUNT: \"select_account\",\r\n    CONSENT: \"consent\",\r\n    NONE: \"none\",\r\n    CREATE: \"create\",\r\n    NO_SESSION: \"no_session\",\r\n};\r\n/**\r\n * allowed values for codeVerifier\r\n */\r\nconst CodeChallengeMethodValues = {\r\n    PLAIN: \"plain\",\r\n    S256: \"S256\",\r\n};\r\n/**\r\n * Allowed values for response_type\r\n */\r\nconst OAuthResponseType = {\r\n    CODE: \"code\",\r\n    IDTOKEN_TOKEN: \"id_token token\",\r\n    IDTOKEN_TOKEN_REFRESHTOKEN: \"id_token token refresh_token\",\r\n};\r\n/**\r\n * allowed values for server response type\r\n * @deprecated Use ResponseMode instead\r\n */\r\nconst ServerResponseType = {\r\n    QUERY: \"query\",\r\n    FRAGMENT: \"fragment\",\r\n};\r\n/**\r\n * allowed values for response_mode\r\n */\r\nconst ResponseMode = {\r\n    QUERY: \"query\",\r\n    FRAGMENT: \"fragment\",\r\n    FORM_POST: \"form_post\",\r\n};\r\n/**\r\n * allowed grant_type\r\n */\r\nconst GrantType = {\r\n    IMPLICIT_GRANT: \"implicit\",\r\n    AUTHORIZATION_CODE_GRANT: \"authorization_code\",\r\n    CLIENT_CREDENTIALS_GRANT: \"client_credentials\",\r\n    RESOURCE_OWNER_PASSWORD_GRANT: \"password\",\r\n    REFRESH_TOKEN_GRANT: \"refresh_token\",\r\n    DEVICE_CODE_GRANT: \"device_code\",\r\n    JWT_BEARER: \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\r\n};\r\n/**\r\n * Account types in Cache\r\n */\r\nconst CacheAccountType = {\r\n    MSSTS_ACCOUNT_TYPE: \"MSSTS\",\r\n    ADFS_ACCOUNT_TYPE: \"ADFS\",\r\n    MSAV1_ACCOUNT_TYPE: \"MSA\",\r\n    GENERIC_ACCOUNT_TYPE: \"Generic\", // NTLM, Kerberos, FBA, Basic etc\r\n};\r\n/**\r\n * Separators used in cache\r\n */\r\nconst Separators = {\r\n    CACHE_KEY_SEPARATOR: \"-\",\r\n    CLIENT_INFO_SEPARATOR: \".\",\r\n};\r\n/**\r\n * Credential Type stored in the cache\r\n */\r\nconst CredentialType = {\r\n    ID_TOKEN: \"IdToken\",\r\n    ACCESS_TOKEN: \"AccessToken\",\r\n    ACCESS_TOKEN_WITH_AUTH_SCHEME: \"AccessToken_With_AuthScheme\",\r\n    REFRESH_TOKEN: \"RefreshToken\",\r\n};\r\n/**\r\n * Combine all cache types\r\n */\r\nconst CacheType = {\r\n    ADFS: 1001,\r\n    MSA: 1002,\r\n    MSSTS: 1003,\r\n    GENERIC: 1004,\r\n    ACCESS_TOKEN: 2001,\r\n    REFRESH_TOKEN: 2002,\r\n    ID_TOKEN: 2003,\r\n    APP_METADATA: 3001,\r\n    UNDEFINED: 9999,\r\n};\r\n/**\r\n * More Cache related constants\r\n */\r\nconst APP_METADATA = \"appmetadata\";\r\nconst CLIENT_INFO = \"client_info\";\r\nconst THE_FAMILY_ID = \"1\";\r\nconst AUTHORITY_METADATA_CONSTANTS = {\r\n    CACHE_KEY: \"authority-metadata\",\r\n    REFRESH_TIME_SECONDS: 3600 * 24, // 24 Hours\r\n};\r\nconst AuthorityMetadataSource = {\r\n    CONFIG: \"config\",\r\n    CACHE: \"cache\",\r\n    NETWORK: \"network\",\r\n    HARDCODED_VALUES: \"hardcoded_values\",\r\n};\r\nconst SERVER_TELEM_CONSTANTS = {\r\n    SCHEMA_VERSION: 5,\r\n    MAX_LAST_HEADER_BYTES: 330,\r\n    MAX_CACHED_ERRORS: 50,\r\n    CACHE_KEY: \"server-telemetry\",\r\n    CATEGORY_SEPARATOR: \"|\",\r\n    VALUE_SEPARATOR: \",\",\r\n    OVERFLOW_TRUE: \"1\",\r\n    OVERFLOW_FALSE: \"0\",\r\n    UNKNOWN_ERROR: \"unknown_error\",\r\n};\r\n/**\r\n * Type of the authentication request\r\n */\r\nconst AuthenticationScheme = {\r\n    BEARER: \"Bearer\",\r\n    POP: \"pop\",\r\n    SSH: \"ssh-cert\",\r\n};\r\n/**\r\n * Constants related to throttling\r\n */\r\nconst ThrottlingConstants = {\r\n    // Default time to throttle RequestThumbprint in seconds\r\n    DEFAULT_THROTTLE_TIME_SECONDS: 60,\r\n    // Default maximum time to throttle in seconds, overrides what the server sends back\r\n    DEFAULT_MAX_THROTTLE_TIME_SECONDS: 3600,\r\n    // Prefix for storing throttling entries\r\n    THROTTLING_PREFIX: \"throttling\",\r\n    // Value assigned to the x-ms-lib-capability header to indicate to the server the library supports throttling\r\n    X_MS_LIB_CAPABILITY_VALUE: \"retry-after, h429\",\r\n};\r\nconst Errors = {\r\n    INVALID_GRANT_ERROR: \"invalid_grant\",\r\n    CLIENT_MISMATCH_ERROR: \"client_mismatch\",\r\n};\r\n/**\r\n * Password grant parameters\r\n */\r\nconst PasswordGrantConstants = {\r\n    username: \"username\",\r\n    password: \"password\",\r\n};\r\n/**\r\n * Region Discovery Sources\r\n */\r\nconst RegionDiscoverySources = {\r\n    FAILED_AUTO_DETECTION: \"1\",\r\n    INTERNAL_CACHE: \"2\",\r\n    ENVIRONMENT_VARIABLE: \"3\",\r\n    IMDS: \"4\",\r\n};\r\n/**\r\n * Region Discovery Outcomes\r\n */\r\nconst RegionDiscoveryOutcomes = {\r\n    CONFIGURED_NO_AUTO_DETECTION: \"2\",\r\n    AUTO_DETECTION_REQUESTED_SUCCESSFUL: \"4\",\r\n    AUTO_DETECTION_REQUESTED_FAILED: \"5\",\r\n};\r\n/**\r\n * Specifies the reason for fetching the access token from the identity provider\r\n */\r\nconst CacheOutcome = {\r\n    // When a token is found in the cache or the cache is not supposed to be hit when making the request\r\n    NOT_APPLICABLE: \"0\",\r\n    // When the token request goes to the identity provider because force_refresh was set to true. Also occurs if claims were requested\r\n    FORCE_REFRESH_OR_CLAIMS: \"1\",\r\n    // When the token request goes to the identity provider because no cached access token exists\r\n    NO_CACHED_ACCESS_TOKEN: \"2\",\r\n    // When the token request goes to the identity provider because cached access token expired\r\n    CACHED_ACCESS_TOKEN_EXPIRED: \"3\",\r\n    // When the token request goes to the identity provider because refresh_in was used and the existing token needs to be refreshed\r\n    PROACTIVELY_REFRESHED: \"4\",\r\n};\r\nconst JsonWebTokenTypes = {\r\n    Jwt: \"JWT\",\r\n    Jwk: \"JWK\",\r\n    Pop: \"pop\",\r\n};\r\nconst ONE_DAY_IN_MS = 86400000;\r\n// Token renewal offset default in seconds\r\nconst DEFAULT_TOKEN_RENEWAL_OFFSET_SEC = 300;\r\nconst EncodingTypes = {\r\n    BASE64: \"base64\",\r\n    HEX: \"hex\",\r\n    UTF8: \"utf-8\",\r\n};\n\nexport { AADAuthorityConstants, APP_METADATA, AUTHORITY_METADATA_CONSTANTS, AuthenticationScheme, AuthorityMetadataSource, CLIENT_INFO, CacheAccountType, CacheOutcome, CacheType, ClaimsRequestKeys, CodeChallengeMethodValues, Constants, CredentialType, DEFAULT_TOKEN_RENEWAL_OFFSET_SEC, EncodingTypes, Errors, GrantType, HeaderNames, HttpMethod, HttpStatus, JsonWebTokenTypes, OAuthResponseType, OIDC_DEFAULT_SCOPES, OIDC_SCOPES, ONE_DAY_IN_MS, PasswordGrantConstants, PersistentCacheKeys, PromptValue, RegionDiscoveryOutcomes, RegionDiscoverySources, ResponseMode, SERVER_TELEM_CONSTANTS, Separators, ServerResponseType, THE_FAMILY_ID, ThrottlingConstants };\n//# sourceMappingURL=Constants.mjs.map\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\nimport { Constants } from '../utils/Constants.mjs';\nimport { postRequestFailed, unexpectedError } from './AuthErrorCodes.mjs';\nimport * as AuthErrorCodes from './AuthErrorCodes.mjs';\nexport { AuthErrorCodes };\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst AuthErrorMessages = {\r\n    [unexpectedError]: \"Unexpected error in authentication.\",\r\n    [postRequestFailed]: \"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details.\",\r\n};\r\n/**\r\n * AuthErrorMessage class containing string constants used by error codes and messages.\r\n * @deprecated Use AuthErrorCodes instead\r\n */\r\nconst AuthErrorMessage = {\r\n    unexpectedError: {\r\n        code: unexpectedError,\r\n        desc: AuthErrorMessages[unexpectedError],\r\n    },\r\n    postRequestFailed: {\r\n        code: postRequestFailed,\r\n        desc: AuthErrorMessages[postRequestFailed],\r\n    },\r\n};\r\n/**\r\n * General error class thrown by the MSAL.js library.\r\n */\r\nclass AuthError extends Error {\r\n    constructor(errorCode, errorMessage, suberror) {\r\n        const errorString = errorMessage\r\n            ? `${errorCode}: ${errorMessage}`\r\n            : errorCode;\r\n        super(errorString);\r\n        Object.setPrototypeOf(this, AuthError.prototype);\r\n        this.errorCode = errorCode || Constants.EMPTY_STRING;\r\n        this.errorMessage = errorMessage || Constants.EMPTY_STRING;\r\n        this.subError = suberror || Constants.EMPTY_STRING;\r\n        this.name = \"AuthError\";\r\n    }\r\n    setCorrelationId(correlationId) {\r\n        this.correlationId = correlationId;\r\n    }\r\n}\r\nfunction createAuthError(code, additionalMessage) {\r\n    return new AuthError(code, additionalMessage\r\n        ? `${AuthErrorMessages[code]} ${additionalMessage}`\r\n        : AuthErrorMessages[code]);\r\n}\n\nexport { AuthError, AuthErrorMessage, AuthErrorMessages, createAuthError };\n//# sourceMappingURL=AuthError.mjs.map\n","/*! @azure/msal-common v15.12.0 2025-08-19 */\n'use strict';\nimport { Constants } from '../utils/Constants.mjs';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Log message level.\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"Error\"] = 0] = \"Error\";\r\n    LogLevel[LogLevel[\"Warning\"] = 1] = \"Warning\";\r\n    LogLevel[LogLevel[\"Info\"] = 2] = \"Info\";\r\n    LogLevel[LogLevel[\"Verbose\"] = 3] = \"Verbose\";\r\n    LogLevel[LogLevel[\"Trace\"] = 4] = \"Trace\";\r\n})(LogLevel || (LogLevel = {}));\r\n/**\r\n * Class which facilitates logging of messages to a specific place.\r\n */\r\nclass Logger {\r\n    constructor(loggerOptions, packageName, packageVersion) {\r\n        // Current log level, defaults to info.\r\n        this.level = LogLevel.Info;\r\n        const defaultLoggerCallback = () => {\r\n            return;\r\n        };\r\n        const setLoggerOptions = loggerOptions || Logger.createDefaultLoggerOptions();\r\n        this.localCallback =\r\n            setLoggerOptions.loggerCallback || defaultLoggerCallback;\r\n        this.piiLoggingEnabled = setLoggerOptions.piiLoggingEnabled || false;\r\n        this.level =\r\n            typeof setLoggerOptions.logLevel === \"number\"\r\n                ? setLoggerOptions.logLevel\r\n                : LogLevel.Info;\r\n        this.correlationId =\r\n            setLoggerOptions.correlationId || Constants.EMPTY_STRING;\r\n        this.packageName = packageName || Constants.EMPTY_STRING;\r\n        this.packageVersion = packageVersion || Constants.EMPTY_STRING;\r\n    }\r\n    static createDefaultLoggerOptions() {\r\n        return {\r\n            loggerCallback: () => {\r\n                // allow users to not set loggerCallback\r\n            },\r\n            piiLoggingEnabled: false,\r\n            logLevel: LogLevel.Info,\r\n        };\r\n    }\r\n    /**\r\n     * Create new Logger with existing configurations.\r\n     */\r\n    clone(packageName, packageVersion, correlationId) {\r\n        return new Logger({\r\n            loggerCallback: this.localCallback,\r\n            piiLoggingEnabled: this.piiLoggingEnabled,\r\n            logLevel: this.level,\r\n            correlationId: correlationId || this.correlationId,\r\n        }, packageName, packageVersion);\r\n    }\r\n    /**\r\n     * Log message with required options.\r\n     */\r\n    logMessage(logMessage, options) {\r\n        if (options.logLevel > this.level ||\r\n            (!this.piiLoggingEnabled && options.containsPii)) {\r\n            return;\r\n        }\r\n        const timestamp = new Date().toUTCString();\r\n        // Add correlationId to logs if set, correlationId provided on log messages take precedence\r\n        const logHeader = `[${timestamp}] : [${options.correlationId || this.correlationId || \"\"}]`;\r\n        const log = `${logHeader} : ${this.packageName}@${this.packageVersion} : ${LogLevel[options.logLevel]} - ${logMessage}`;\r\n        // debug(`msal:${LogLevel[options.logLevel]}${options.containsPii ? \"-Pii\": Constants.EMPTY_STRING}${options.context ? `:${options.context}` : Constants.EMPTY_STRING}`)(logMessage);\r\n        this.executeCallback(options.logLevel, log, options.containsPii || false);\r\n    }\r\n    /**\r\n     * Execute callback with message.\r\n     */\r\n    executeCallback(level, message, containsPii) {\r\n        if (this.localCallback) {\r\n            this.localCallback(level, message, containsPii);\r\n        }\r\n    }\r\n    /**\r\n     * Logs error messages.\r\n     */\r\n    error(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Error,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs error messages with PII.\r\n     */\r\n    errorPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Error,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs warning messages.\r\n     */\r\n    warning(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Warning,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs warning messages with PII.\r\n     */\r\n    warningPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Warning,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs info messages.\r\n     */\r\n    info(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Info,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs info messages with PII.\r\n     */\r\n    infoPii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Info,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs verbose messages.\r\n     */\r\n    verbose(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Verbose,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs verbose messages with PII.\r\n     */\r\n    verbosePii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Verbose,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs trace messages.\r\n     */\r\n    trace(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Trace,\r\n            containsPii: false,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Logs trace messages with PII.\r\n     */\r\n    tracePii(message, correlationId) {\r\n        this.logMessage(message, {\r\n            logLevel: LogLevel.Trace,\r\n            containsPii: true,\r\n            correlationId: correlationId || Constants.EMPTY_STRING,\r\n        });\r\n    }\r\n    /**\r\n     * Returns whether PII Logging is enabled or not.\r\n     */\r\n    isPiiLoggingEnabled() {\r\n        return this.piiLoggingEnabled || false;\r\n    }\r\n}\n\nexport { LogLevel, Logger };\n//# sourceMappingURL=Logger.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { OIDC_DEFAULT_SCOPES } from '@azure/msal-common/browser';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Constants\r\n */\r\nconst BrowserConstants = {\r\n    /**\r\n     * Invalid grant error code\r\n     */\r\n    INVALID_GRANT_ERROR: \"invalid_grant\",\r\n    /**\r\n     * Default popup window width\r\n     */\r\n    POPUP_WIDTH: 483,\r\n    /**\r\n     * Default popup window height\r\n     */\r\n    POPUP_HEIGHT: 600,\r\n    /**\r\n     * Name of the popup window starts with\r\n     */\r\n    POPUP_NAME_PREFIX: \"msal\",\r\n    /**\r\n     * Default popup monitor poll interval in milliseconds\r\n     */\r\n    DEFAULT_POLL_INTERVAL_MS: 30,\r\n    /**\r\n     * Msal-browser SKU\r\n     */\r\n    MSAL_SKU: \"msal.js.browser\",\r\n};\r\nconst PlatformAuthConstants = {\r\n    CHANNEL_ID: \"53ee284d-920a-4b59-9d30-a60315b26836\",\r\n    PREFERRED_EXTENSION_ID: \"ppnbnpeolgkicgegkbkbjmhlideopiji\",\r\n    MATS_TELEMETRY: \"MATS\",\r\n    MICROSOFT_ENTRA_BROKERID: \"MicrosoftEntra\",\r\n    DOM_API_NAME: \"DOM API\",\r\n    PLATFORM_DOM_APIS: \"get-token-and-sign-out\",\r\n    PLATFORM_DOM_PROVIDER: \"PlatformAuthDOMHandler\",\r\n    PLATFORM_EXTENSION_PROVIDER: \"PlatformAuthExtensionHandler\",\r\n};\r\nconst NativeExtensionMethod = {\r\n    HandshakeRequest: \"Handshake\",\r\n    HandshakeResponse: \"HandshakeResponse\",\r\n    GetToken: \"GetToken\",\r\n    Response: \"Response\",\r\n};\r\nconst BrowserCacheLocation = {\r\n    LocalStorage: \"localStorage\",\r\n    SessionStorage: \"sessionStorage\",\r\n    MemoryStorage: \"memoryStorage\",\r\n};\r\n/**\r\n * HTTP Request types supported by MSAL.\r\n */\r\nconst HTTP_REQUEST_TYPE = {\r\n    GET: \"GET\",\r\n    POST: \"POST\",\r\n};\r\nconst INTERACTION_TYPE = {\r\n    SIGNIN: \"signin\",\r\n    SIGNOUT: \"signout\",\r\n};\r\n/**\r\n * Temporary cache keys for MSAL, deleted after any request.\r\n */\r\nconst TemporaryCacheKeys = {\r\n    ORIGIN_URI: \"request.origin\",\r\n    URL_HASH: \"urlHash\",\r\n    REQUEST_PARAMS: \"request.params\",\r\n    VERIFIER: \"code.verifier\",\r\n    INTERACTION_STATUS_KEY: \"interaction.status\",\r\n    NATIVE_REQUEST: \"request.native\",\r\n};\r\n/**\r\n * Cache keys stored in-memory\r\n */\r\nconst InMemoryCacheKeys = {\r\n    WRAPPER_SKU: \"wrapper.sku\",\r\n    WRAPPER_VER: \"wrapper.version\",\r\n};\r\n/**\r\n * API Codes for Telemetry purposes.\r\n * Before adding a new code you must claim it in the MSAL Telemetry tracker as these number spaces are shared across all MSALs\r\n * 0-99 Silent Flow\r\n * 800-899 Auth Code Flow\r\n */\r\nconst ApiId = {\r\n    acquireTokenRedirect: 861,\r\n    acquireTokenPopup: 862,\r\n    ssoSilent: 863,\r\n    acquireTokenSilent_authCode: 864,\r\n    handleRedirectPromise: 865,\r\n    acquireTokenByCode: 866,\r\n    acquireTokenSilent_silentFlow: 61,\r\n    logout: 961,\r\n    logoutPopup: 962,\r\n};\r\n/*\r\n * Interaction type of the API - used for state and telemetry\r\n */\r\nvar InteractionType;\r\n(function (InteractionType) {\r\n    InteractionType[\"Redirect\"] = \"redirect\";\r\n    InteractionType[\"Popup\"] = \"popup\";\r\n    InteractionType[\"Silent\"] = \"silent\";\r\n    InteractionType[\"None\"] = \"none\";\r\n})(InteractionType || (InteractionType = {}));\r\n/**\r\n * Types of interaction currently in progress.\r\n * Used in events in wrapper libraries to invoke functions when certain interaction is in progress or all interactions are complete.\r\n */\r\nconst InteractionStatus = {\r\n    /**\r\n     * Initial status before interaction occurs\r\n     */\r\n    Startup: \"startup\",\r\n    /**\r\n     * Status set when all login calls occuring\r\n     */\r\n    Login: \"login\",\r\n    /**\r\n     * Status set when logout call occuring\r\n     */\r\n    Logout: \"logout\",\r\n    /**\r\n     * Status set for acquireToken calls\r\n     */\r\n    AcquireToken: \"acquireToken\",\r\n    /**\r\n     * Status set for ssoSilent calls\r\n     */\r\n    SsoSilent: \"ssoSilent\",\r\n    /**\r\n     * Status set when handleRedirect in progress\r\n     */\r\n    HandleRedirect: \"handleRedirect\",\r\n    /**\r\n     * Status set when interaction is complete\r\n     */\r\n    None: \"none\",\r\n};\r\nconst DEFAULT_REQUEST = {\r\n    scopes: OIDC_DEFAULT_SCOPES,\r\n};\r\n/**\r\n * JWK Key Format string (Type MUST be defined for window crypto APIs)\r\n */\r\nconst KEY_FORMAT_JWK = \"jwk\";\r\n// Supported wrapper SKUs\r\nconst WrapperSKU = {\r\n    React: \"@azure/msal-react\",\r\n    Angular: \"@azure/msal-angular\",\r\n};\r\n// DatabaseStorage Constants\r\nconst DB_NAME = \"msal.db\";\r\nconst DB_VERSION = 1;\r\nconst DB_TABLE_NAME = `${DB_NAME}.keys`;\r\nconst CacheLookupPolicy = {\r\n    /*\r\n     * acquireTokenSilent will attempt to retrieve an access token from the cache. If the access token is expired\r\n     * or cannot be found the refresh token will be used to acquire a new one. Finally, if the refresh token\r\n     * is expired acquireTokenSilent will attempt to acquire new access and refresh tokens.\r\n     */\r\n    Default: 0,\r\n    /*\r\n     * acquireTokenSilent will only look for access tokens in the cache. It will not attempt to renew access or\r\n     * refresh tokens.\r\n     */\r\n    AccessToken: 1,\r\n    /*\r\n     * acquireTokenSilent will attempt to retrieve an access token from the cache. If the access token is expired or\r\n     * cannot be found, the refresh token will be used to acquire a new one. If the refresh token is expired, it\r\n     * will not be renewed and acquireTokenSilent will fail.\r\n     */\r\n    AccessTokenAndRefreshToken: 2,\r\n    /*\r\n     * acquireTokenSilent will not attempt to retrieve access tokens from the cache and will instead attempt to\r\n     * exchange the cached refresh token for a new access token. If the refresh token is expired, it will not be\r\n     * renewed and acquireTokenSilent will fail.\r\n     */\r\n    RefreshToken: 3,\r\n    /*\r\n     * acquireTokenSilent will not look in the cache for the access token. It will go directly to network with the\r\n     * cached refresh token. If the refresh token is expired an attempt will be made to renew it. This is equivalent to\r\n     * setting \"forceRefresh: true\".\r\n     */\r\n    RefreshTokenAndNetwork: 4,\r\n    /*\r\n     * acquireTokenSilent will attempt to renew both access and refresh tokens. It will not look in the cache. This will\r\n     * always fail if 3rd party cookies are blocked by the browser.\r\n     */\r\n    Skip: 5,\r\n};\r\nconst iFrameRenewalPolicies = [\r\n    CacheLookupPolicy.Default,\r\n    CacheLookupPolicy.Skip,\r\n    CacheLookupPolicy.RefreshTokenAndNetwork,\r\n];\n\nexport { ApiId, BrowserCacheLocation, BrowserConstants, CacheLookupPolicy, DB_NAME, DB_TABLE_NAME, DB_VERSION, DEFAULT_REQUEST, HTTP_REQUEST_TYPE, INTERACTION_TYPE, InMemoryCacheKeys, InteractionStatus, InteractionType, KEY_FORMAT_JWK, NativeExtensionMethod, PlatformAuthConstants, TemporaryCacheKeys, WrapperSKU, iFrameRenewalPolicies };\n//# sourceMappingURL=BrowserConstants.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst storageNotSupported = \"storage_not_supported\";\r\nconst stubbedPublicClientApplicationCalled = \"stubbed_public_client_application_called\";\r\nconst inMemRedirectUnavailable = \"in_mem_redirect_unavailable\";\n\nexport { inMemRedirectUnavailable, storageNotSupported, stubbedPublicClientApplicationCalled };\n//# sourceMappingURL=BrowserConfigurationAuthErrorCodes.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { AuthError } from '@azure/msal-common/browser';\nimport { inMemRedirectUnavailable, stubbedPublicClientApplicationCalled, storageNotSupported } from './BrowserConfigurationAuthErrorCodes.mjs';\nimport * as BrowserConfigurationAuthErrorCodes from './BrowserConfigurationAuthErrorCodes.mjs';\nexport { BrowserConfigurationAuthErrorCodes };\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst BrowserConfigurationAuthErrorMessages = {\r\n    [storageNotSupported]: \"Given storage configuration option was not supported.\",\r\n    [stubbedPublicClientApplicationCalled]: \"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors\",\r\n    [inMemRedirectUnavailable]: \"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true.\",\r\n};\r\n/**\r\n * BrowserAuthErrorMessage class containing string constants used by error codes and messages.\r\n * @deprecated Use BrowserAuthErrorCodes instead\r\n */\r\nconst BrowserConfigurationAuthErrorMessage = {\r\n    storageNotSupportedError: {\r\n        code: storageNotSupported,\r\n        desc: BrowserConfigurationAuthErrorMessages[storageNotSupported],\r\n    },\r\n    stubPcaInstanceCalled: {\r\n        code: stubbedPublicClientApplicationCalled,\r\n        desc: BrowserConfigurationAuthErrorMessages[stubbedPublicClientApplicationCalled],\r\n    },\r\n    inMemRedirectUnavailable: {\r\n        code: inMemRedirectUnavailable,\r\n        desc: BrowserConfigurationAuthErrorMessages[inMemRedirectUnavailable],\r\n    },\r\n};\r\n/**\r\n * Browser library error class thrown by the MSAL.js library for SPAs\r\n */\r\nclass BrowserConfigurationAuthError extends AuthError {\r\n    constructor(errorCode, errorMessage) {\r\n        super(errorCode, errorMessage);\r\n        this.name = \"BrowserConfigurationAuthError\";\r\n        Object.setPrototypeOf(this, BrowserConfigurationAuthError.prototype);\r\n    }\r\n}\r\nfunction createBrowserConfigurationAuthError(errorCode) {\r\n    return new BrowserConfigurationAuthError(errorCode, BrowserConfigurationAuthErrorMessages[errorCode]);\r\n}\n\nexport { BrowserConfigurationAuthError, BrowserConfigurationAuthErrorMessage, BrowserConfigurationAuthErrorMessages, createBrowserConfigurationAuthError };\n//# sourceMappingURL=BrowserConfigurationAuthError.mjs.map\n","/*! @azure/msal-browser v4.23.0 2025-09-17 */\n'use strict';\nimport { createBrowserConfigurationAuthError } from '../error/BrowserConfigurationAuthError.mjs';\nimport { stubbedPublicClientApplicationCalled } from '../error/BrowserConfigurationAuthErrorCodes.mjs';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\nconst stubbedPublicClientApplication = {\r\n    initialize: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenSilent: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    acquireTokenByCode: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    getAllAccounts: () => {\r\n        return [];\r\n    },\r\n    getAccount: () => {\r\n        return null;\r\n    },\r\n    getAccountByHomeId: () => {\r\n        return null;\r\n    },\r\n    getAccountByUsername: () => {\r\n        return null;\r\n    },\r\n    getAccountByLocalId: () => {\r\n        return null;\r\n    },\r\n    handleRedirectPromise: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    loginPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    loginRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logout: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logoutRedirect: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    logoutPopup: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    ssoSilent: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    addEventCallback: () => {\r\n        return null;\r\n    },\r\n    removeEventCallback: () => {\r\n        return;\r\n    },\r\n    addPerformanceCallback: () => {\r\n        return \"\";\r\n    },\r\n    removePerformanceCallback: () => {\r\n        return false;\r\n    },\r\n    enableAccountStorageEvents: () => {\r\n        return;\r\n    },\r\n    disableAccountStorageEvents: () => {\r\n        return;\r\n    },\r\n    getTokenCache: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    getLogger: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    setLogger: () => {\r\n        return;\r\n    },\r\n    setActiveAccount: () => {\r\n        return;\r\n    },\r\n    getActiveAccount: () => {\r\n        return null;\r\n    },\r\n    initializeWrapperLibrary: () => {\r\n        return;\r\n    },\r\n    setNavigationClient: () => {\r\n        return;\r\n    },\r\n    getConfiguration: () => {\r\n        throw createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled);\r\n    },\r\n    hydrateCache: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n    clearCache: () => {\r\n        return Promise.reject(createBrowserConfigurationAuthError(stubbedPublicClientApplicationCalled));\r\n    },\r\n};\n\nexport { stubbedPublicClientApplication };\n//# sourceMappingURL=IPublicClientApplication.mjs.map\n","/*! @azure/msal-react v3.0.19 2025-08-19 */\n'use strict';\nimport * as React from 'react';\nimport { Logger, InteractionStatus, stubbedPublicClientApplication } from '@azure/msal-browser';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/*\r\n * Stubbed context implementation\r\n * Only used when there is no provider, which is an unsupported scenario\r\n */\r\nconst defaultMsalContext = {\r\n    instance: stubbedPublicClientApplication,\r\n    inProgress: InteractionStatus.None,\r\n    accounts: [],\r\n    logger: new Logger({}),\r\n};\r\nconst MsalContext = React.createContext(defaultMsalContext);\r\nconst MsalConsumer = MsalContext.Consumer;\n\nexport { MsalConsumer, MsalContext };\n//# sourceMappingURL=MsalContext.js.map\n","/*! @azure/msal-react v3.0.19 2025-08-19 */\n'use strict';\nimport { useContext } from 'react';\nimport { MsalContext } from '../MsalContext.js';\n\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n/**\r\n * Returns Msal Context values\r\n */\r\nconst useMsal = () => useContext(MsalContext);\n\nexport { useMsal };\n//# sourceMappingURL=useMsal.js.map\n","import { Configuration, PopupRequest, RedirectRequest } from '@azure/msal-browser';\r\n\r\n/**\r\n * Azure AD B2C / Entra ID Configuration\r\n * \r\n * Configure these values with your Azure AD tenant information:\r\n * - clientId: Application (client) ID from Azure AD app registration\r\n * - authority: Azure AD tenant authority URL\r\n * - redirectUri: Redirect URI configured in Azure AD app registration\r\n */\r\nexport const msalConfig: Configuration = {\r\n  auth: {\r\n    clientId: import.meta.env.VITE_AZURE_CLIENT_ID || 'your-client-id-here', \r\n    authority: import.meta.env.VITE_AZURE_AUTHORITY || `https://login.microsoftonline.com/${import.meta.env.VITE_AZURE_TENANT_ID}`,\r\n    redirectUri: import.meta.env.VITE_AZURE_REDIRECT_URI || window.location.origin,\r\n    postLogoutRedirectUri: import.meta.env.VITE_AZURE_POST_LOGOUT_REDIRECT_URI || window.location.origin,\r\n  },\r\n  cache: {\r\n    cacheLocation: 'sessionStorage', // This configures where your cache will be stored\r\n    storeAuthStateInCookie: false, // Set this to \"true\" if you are having issues on IE11 or Edge\r\n  },\r\n  system: {\r\n    loggerOptions: {\r\n      loggerCallback: (level, message, containsPii) => {\r\n        if (containsPii) {\r\n          return;\r\n        }\r\n        switch (level) {\r\n          case 0: // LogLevel.Error\r\n            console.error('[MSAL Error]:', message);\r\n            break;\r\n          case 1: // LogLevel.Warning\r\n            console.warn('[MSAL Warning]:', message);\r\n            break;\r\n          case 2: // LogLevel.Info\r\n            console.info('[MSAL Info]:', message);\r\n            break;\r\n          case 3: // LogLevel.Verbose\r\n            console.debug('[MSAL Verbose]:', message);\r\n            break;\r\n        }\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * Scopes you add here will be prompted for user consent during sign-in.\r\n * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\r\n */\r\nexport const loginRequest: RedirectRequest = {\r\n  scopes: [\r\n    'openid',\r\n    'profile',\r\n    'email',\r\n    'User.Read', // Microsoft Graph API scope for reading user profile\r\n  ],\r\n};\r\n\r\n/**\r\n * An optional silentRequest object can be used to achieve silent SSO\r\n * between applications by providing a \"login_hint\" property.\r\n */\r\nexport const silentRequest: PopupRequest = {\r\n  scopes: ['openid', 'profile', 'email', 'User.Read'],\r\n  loginHint: 'example@domain.com', // Used for silent SSO\r\n};\r\n\r\n/**\r\n * Application roles for RBAC\r\n * These should match the app roles defined in your Azure AD app registration\r\n */\r\nexport const APP_ROLES = {\r\n  ADMIN: 'Admin',\r\n  CONTROL_PANEL: 'ControlPanel',\r\n} as const;\r\n\r\n/**\r\n * Claims that contain role information\r\n * Roles can be provided via app roles or group membership\r\n */\r\nexport const ROLE_CLAIMS = {\r\n  APP_ROLES: 'roles', // App roles claim\r\n  GROUPS: 'groups', // Group membership claim\r\n} as const;\r\n\r\n/**\r\n * Group IDs for role mapping (if using groups instead of app roles)\r\n * Configure these with your Azure AD group object IDs\r\n */\r\nexport const ROLE_GROUPS = {\r\n  ADMIN_GROUP_ID: import.meta.env.VITE_AZURE_ADMIN_GROUP_ID || 'admin-group-id-here',\r\n  CONTROL_PANEL_GROUP_ID: import.meta.env.VITE_AZURE_CONTROL_PANEL_GROUP_ID || 'control-panel-group-id-here',\r\n} as const;\r\n\r\n/**\r\n * Default user role when no specific role is assigned\r\n */\r\nexport const DEFAULT_ROLE = APP_ROLES.CONTROL_PANEL;\r\n\r\nexport type UserRole = typeof APP_ROLES[keyof typeof APP_ROLES];","import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\r\nimport { \r\n  EventType, \r\n  EventMessage, \r\n  AccountInfo,\r\n  InteractionStatus,\r\n  PopupRequest,\r\n  RedirectRequest\r\n} from '@azure/msal-browser';\r\nimport { \r\n  useMsal, \r\n  useAccount, \r\n  useIsAuthenticated,\r\n  AuthenticatedTemplate as MsalAuthenticatedTemplate,\r\n  UnauthenticatedTemplate as MsalUnauthenticatedTemplate\r\n} from '@azure/msal-react';\r\nimport { loginRequest, ROLE_CLAIMS, APP_ROLES } from '@/config/authConfig';\r\nimport { setAuthenticatedUserId } from '@/utils';\r\n\r\n// Define the default role for users without specific roles\r\nconst DEFAULT_ROLE = 'User';\r\n\r\n// User information interface\r\nexport interface UserInfo {\r\n  id: string;\r\n  email: string;\r\n  name: string;\r\n  roles: string[];\r\n  primaryRole: string;\r\n  groups: string[];\r\n  preferredUsername?: string;\r\n  tenantId?: string;\r\n}\r\n\r\n// Authentication context interface\r\ninterface AuthContextType {\r\n  // User state\r\n  user: UserInfo | null;\r\n  isAuthenticated: boolean;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n\r\n  // Authentication methods\r\n  login: (request?: PopupRequest | RedirectRequest) => Promise<void>;\r\n  logout: (request?: PopupRequest | RedirectRequest) => Promise<void>;\r\n  clearError: () => void;\r\n\r\n  // Authorization helpers\r\n  hasRole: (role: string) => boolean;\r\n  hasAnyRole: (roles: string[]) => boolean;\r\n  isAdmin: () => boolean;\r\n  canAccessControlPanel: () => boolean;\r\n}\r\n\r\n// Create the context\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// Export the context so MockAuthProvider can use the same one\r\nexport { AuthContext };\r\n\r\n// Hook to use the auth context\r\nexport const useAuth = (): AuthContextType => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n/**\r\n * Extract user roles from account info based on group membership or token claims\r\n */\r\nconst extractUserRoles = (account: AccountInfo): string[] => {\r\n  const claims = account.idTokenClaims as any;\r\n  const roles: string[] = [];\r\n\r\n  // Check for roles in token claims (preferred method)\r\n  if (claims?.[ROLE_CLAIMS.APP_ROLES]) {\r\n    const tokenRoles = Array.isArray(claims[ROLE_CLAIMS.APP_ROLES]) \r\n      ? claims[ROLE_CLAIMS.APP_ROLES] \r\n      : [claims[ROLE_CLAIMS.APP_ROLES]];\r\n    roles.push(...tokenRoles);\r\n  }\r\n\r\n  // Check for group-based roles (fallback)\r\n  if (claims?.[ROLE_CLAIMS.GROUPS]) {\r\n    const groups = Array.isArray(claims[ROLE_CLAIMS.GROUPS]) \r\n      ? claims[ROLE_CLAIMS.GROUPS] \r\n      : [claims[ROLE_CLAIMS.GROUPS]];\r\n    \r\n    // Map group IDs to roles based on configuration\r\n    groups.forEach((groupId: string) => {\r\n      if (groupId === process.env.VITE_AZURE_AD_ADMIN_GROUP_ID) {\r\n        roles.push(APP_ROLES.ADMIN);\r\n      } else if (groupId === process.env.VITE_AZURE_AD_CONTROL_PANEL_GROUP_ID) {\r\n        roles.push(APP_ROLES.CONTROL_PANEL);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Remove duplicates and return\r\n  return [...new Set(roles)];\r\n};\r\n\r\n/**\r\n * Get the primary role for a user (highest priority role)\r\n */\r\nconst getPrimaryRole = (roles: string[]): string => {\r\n  // Admin has highest priority\r\n  if (roles.includes(APP_ROLES.ADMIN)) {\r\n    return APP_ROLES.ADMIN;\r\n  }\r\n  if (roles.includes(APP_ROLES.CONTROL_PANEL)) {\r\n    return APP_ROLES.CONTROL_PANEL;\r\n  }\r\n  return DEFAULT_ROLE;\r\n};\r\n\r\n/**\r\n * Create UserInfo from account\r\n */\r\nconst createUserInfo = (account: AccountInfo | null): UserInfo | null => {\r\n  if (!account) {\r\n    return null;\r\n  }\r\n\r\n  const roles = extractUserRoles(account);\r\n  const primaryRole = getPrimaryRole(roles);\r\n  const claims = account.idTokenClaims as any;\r\n\r\n  return {\r\n    id: account.localAccountId || account.homeAccountId,\r\n    email: account.username,\r\n    name: account.name || account.username,\r\n    roles,\r\n    primaryRole,\r\n    groups: claims?.[ROLE_CLAIMS.GROUPS] || [],\r\n    preferredUsername: claims?.preferred_username,\r\n    tenantId: account.tenantId,\r\n  };\r\n};\r\n\r\n// Auth Provider Component\r\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const { instance, accounts, inProgress } = useMsal();\r\n  const account = useAccount(accounts[0] || {});\r\n  const isAuthenticated = useIsAuthenticated();\r\n  \r\n  const [user, setUser] = useState<UserInfo | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Update user info when account changes\r\n  useEffect(() => {\r\n    const userInfo = createUserInfo(account);\r\n    setUser(userInfo);\r\n    \r\n    // Update the global user ID for API calls\r\n    if (userInfo) {\r\n      setAuthenticatedUserId(userInfo.id);\r\n    } else {\r\n      setAuthenticatedUserId(null);\r\n    }\r\n  }, [account]);\r\n\r\n  // Update loading state based on MSAL interaction status\r\n  useEffect(() => {\r\n    setIsLoading(inProgress !== InteractionStatus.None);\r\n  }, [inProgress]);\r\n\r\n  // Handle MSAL events\r\n  useEffect(() => {\r\n    const callbackId = instance.addEventCallback((event: EventMessage) => {\r\n      switch (event.eventType) {\r\n        case EventType.LOGIN_SUCCESS:\r\n          console.log('[Auth] Login successful');\r\n          setError(null);\r\n          break;\r\n        case EventType.LOGIN_FAILURE:\r\n          console.error('[Auth] Login failed:', event.error);\r\n          setError(event.error?.message || 'Login failed');\r\n          break;\r\n        case EventType.LOGOUT_SUCCESS:\r\n          console.log('[Auth] Logout successful');\r\n          setUser(null);\r\n          setError(null);\r\n          break;\r\n        case EventType.ACQUIRE_TOKEN_SUCCESS:\r\n          console.log('[Auth] Token acquired successfully');\r\n          setError(null);\r\n          break;\r\n        case EventType.ACQUIRE_TOKEN_FAILURE:\r\n          console.error('[Auth] Token acquisition failed:', event.error);\r\n          setError(event.error?.message || 'Token acquisition failed');\r\n          break;\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (callbackId) {\r\n        instance.removeEventCallback(callbackId);\r\n      }\r\n    };\r\n  }, [instance]);\r\n\r\n  // Authentication methods\r\n  const login = async (request?: PopupRequest | RedirectRequest): Promise<void> => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n      \r\n      const loginRequestWithDefaults = {\r\n        ...loginRequest,\r\n        ...request,\r\n      };\r\n\r\n      // Use popup login (you can change to redirect if preferred)\r\n      await instance.loginPopup(loginRequestWithDefaults);\r\n    } catch (error: any) {\r\n      console.error('[Auth] Login error:', error);\r\n      setError(error.message || 'Login failed');\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = async (request?: PopupRequest | RedirectRequest): Promise<void> => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n      \r\n      const logoutRequest = {\r\n        account: account || undefined,\r\n        ...request,\r\n      };\r\n\r\n      // Use popup logout (you can change to redirect if preferred)\r\n      await instance.logoutPopup(logoutRequest);\r\n    } catch (error: any) {\r\n      console.error('[Auth] Logout error:', error);\r\n      setError(error.message || 'Logout failed');\r\n      throw error;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const clearError = (): void => {\r\n    setError(null);\r\n  };\r\n\r\n  // Authorization helpers\r\n  const hasRole = (role: string): boolean => {\r\n    return user?.roles.includes(role) ?? false;\r\n  };\r\n\r\n  const hasAnyRole = (roles: string[]): boolean => {\r\n    return roles.some(role => hasRole(role));\r\n  };\r\n\r\n  const isAdmin = (): boolean => {\r\n    return hasRole(APP_ROLES.ADMIN);\r\n  };\r\n\r\n  const canAccessControlPanel = (): boolean => {\r\n    return hasAnyRole([APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]);\r\n  };\r\n\r\n  // Context value\r\n  const contextValue: AuthContextType = {\r\n    user,\r\n    isAuthenticated,\r\n    isLoading,\r\n    error,\r\n    login,\r\n    logout,\r\n    clearError,\r\n    hasRole,\r\n    hasAnyRole,\r\n    isAdmin,\r\n    canAccessControlPanel,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// Conditional authentication templates\r\nconst isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\ninterface AuthTemplateProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AuthenticatedTemplate: React.FC<AuthTemplateProps> = ({ children }) => {\r\n  if (isAuthEnabled) {\r\n    return <MsalAuthenticatedTemplate>{children}</MsalAuthenticatedTemplate>;\r\n  } else {\r\n    // In mock mode, always show authenticated content\r\n    return <>{children}</>;\r\n  }\r\n};\r\n\r\nexport const UnauthenticatedTemplate: React.FC<AuthTemplateProps> = ({ children }) => {\r\n  if (isAuthEnabled) {\r\n    return <MsalUnauthenticatedTemplate>{children}</MsalUnauthenticatedTemplate>;\r\n  } else {\r\n    // In mock mode, never show unauthenticated content\r\n    return null;\r\n  }\r\n};","import React, { ReactNode } from 'react';\r\nimport { UserInfo, AuthContext } from '@/contexts/AuthContext';\r\n\r\n// Mock user for non-authenticated mode\r\nconst mockUser: UserInfo = {\r\n  id: 'mock-user-id',\r\n  email: 'anonymous@localhost',\r\n  name: 'Anonymous User',\r\n  roles: ['Admin'], // Give admin role for unrestricted access\r\n  primaryRole: 'Admin',\r\n  groups: [],\r\n  preferredUsername: 'anonymous',\r\n};\r\n\r\ninterface MockAuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const MockAuthProvider: React.FC<MockAuthProviderProps> = ({ children }) => {\r\n  const mockAuthValue = {\r\n    // User state - always \"authenticated\" with mock user\r\n    user: mockUser,\r\n    isAuthenticated: true,\r\n    isLoading: false,\r\n    error: null,\r\n\r\n    // Authentication methods (no-ops)\r\n    login: async () => {\r\n      console.log('Mock login called - no action taken');\r\n    },\r\n    logout: async () => {\r\n      console.log('Mock logout called - no action taken');\r\n    },\r\n    clearError: () => {\r\n      console.log('Mock clearError called - no action taken');\r\n    },\r\n\r\n    // Authorization helpers (always return true for unrestricted access)\r\n    hasRole: () => true,\r\n    hasAnyRole: () => true,\r\n    isAdmin: () => true,\r\n    canAccessControlPanel: () => true,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={mockAuthValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};","import React, { ReactNode } from 'react';\r\nimport { PublicClientApplication } from '@azure/msal-browser';\r\nimport { MsalProvider } from '@azure/msal-react';\r\nimport { AuthProvider } from '@/contexts/AuthContext';\r\nimport { MockAuthProvider } from '@/contexts/MockAuthContext';\r\nimport { msalConfig } from '@/config/authConfig';\r\n\r\ninterface ConditionalAuthProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\n// Create MSAL instance only if authentication is enabled\r\nconst isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\n// Log authentication mode for debugging\r\nconsole.log('Authentication mode:', isAuthEnabled ? 'Entra ID enabled' : 'Mock authentication enabled');\r\nconsole.log('VITE_ENABLE_ENTRA_AUTH:', import.meta.env.VITE_ENABLE_ENTRA_AUTH);\r\n\r\nconst msalInstance = isAuthEnabled ? new PublicClientApplication(msalConfig) : null;\r\n\r\nexport const ConditionalAuthProvider: React.FC<ConditionalAuthProviderProps> = ({ children }) => {\r\n  if (isAuthEnabled && msalInstance) {\r\n    // Use real Entra ID authentication\r\n    return (\r\n      <MsalProvider instance={msalInstance}>\r\n        <AuthProvider>\r\n          {children}\r\n        </AuthProvider>\r\n      </MsalProvider>\r\n    );\r\n  } else {\r\n    // Use mock authentication (no login required)\r\n    return (\r\n      <MockAuthProvider>\r\n        {children}\r\n      </MockAuthProvider>\r\n    );\r\n  }\r\n};","import React, { ReactNode } from 'react';\r\nimport { Navigate, useLocation } from 'react-router-dom';\r\nimport { useAuth, AuthenticatedTemplate, UnauthenticatedTemplate } from '@/contexts/AuthContext';\r\nimport { APP_ROLES, type UserRole } from '@/config/authConfig';\r\n\r\n/**\r\n * Props for authorization components\r\n */\r\ninterface AuthorizationProps {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  redirectTo?: string;\r\n}\r\n\r\ninterface RoleGuardProps extends AuthorizationProps {\r\n  roles: UserRole[];\r\n  requireAll?: boolean; // If true, user must have ALL roles, otherwise ANY role\r\n}\r\n\r\n/**\r\n * Login component for unauthenticated users\r\n */\r\nexport const LoginPrompt: React.FC = () => {\r\n  const { login, isLoading, error } = useAuth();\r\n\r\n  const handleLogin = () => {\r\n    login().catch(console.error);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-6xl mb-4 group cursor-pointer inline-block\">\r\n            <span className=\"group-hover:animate-brain-throb transition-transform duration-300\"></span>\r\n          </div>\r\n          <h2 className=\"text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n            Behavioral Health System\r\n          </h2>\r\n          <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\r\n            Please sign in to access the application\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {error && (\r\n            <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4\">\r\n              <div className=\"text-sm text-red-700 dark:text-red-300\">\r\n                {error}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <button\r\n            onClick={handleLogin}\r\n            disabled={isLoading}\r\n            className=\"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n          >\r\n            {isLoading ? (\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"animate-spin -ml-1 mr-3 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n                Signing in...\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center\">\r\n                <svg className=\"mr-2 h-4 w-4\" viewBox=\"0 0 21 21\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <rect x=\"1\" y=\"1\" width=\"9\" height=\"9\" fill=\"#f25022\"/>\r\n                  <rect x=\"1\" y=\"11\" width=\"9\" height=\"9\" fill=\"#00a4ef\"/>\r\n                  <rect x=\"11\" y=\"1\" width=\"9\" height=\"9\" fill=\"#7fba00\"/>\r\n                  <rect x=\"11\" y=\"11\" width=\"9\" height=\"9\" fill=\"#ffb900\"/>\r\n                </svg>\r\n                Sign in with Microsoft\r\n              </div>\r\n            )}\r\n          </button>\r\n          \r\n          <div className=\"text-center\">\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n              Sign in using your organizational account\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Component that requires authentication\r\n */\r\nexport const RequireAuth: React.FC<AuthorizationProps> = ({ \r\n  children, \r\n  fallback,\r\n  redirectTo \r\n}) => {\r\n  const location = useLocation();\r\n  \r\n  return (\r\n    <>\r\n      <AuthenticatedTemplate>\r\n        {children}\r\n      </AuthenticatedTemplate>\r\n      <UnauthenticatedTemplate>\r\n        {fallback || (\r\n          redirectTo ? (\r\n            <Navigate to={redirectTo} state={{ from: location }} replace />\r\n          ) : (\r\n            <LoginPrompt />\r\n          )\r\n        )}\r\n      </UnauthenticatedTemplate>\r\n    </>\r\n  );\r\n};\r\n\r\n/**\r\n * Component that requires specific roles\r\n */\r\nexport const RequireRole: React.FC<RoleGuardProps> = ({ \r\n  children, \r\n  roles, \r\n  requireAll = false,\r\n  fallback,\r\n  redirectTo \r\n}) => {\r\n  const { hasRole, hasAnyRole, user } = useAuth();\r\n  const location = useLocation();\r\n  \r\n  // Check if user has required roles\r\n  const hasAccess = requireAll \r\n    ? roles.every(role => hasRole(role))\r\n    : hasAnyRole(roles);\r\n  \r\n  if (!hasAccess) {\r\n    if (fallback) {\r\n      return <>{fallback}</>;\r\n    }\r\n    \r\n    if (redirectTo) {\r\n      return <Navigate to={redirectTo} state={{ from: location }} replace />;\r\n    }\r\n    \r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"max-w-md w-full text-center space-y-4\">\r\n          <div className=\"text-6xl mb-4\"></div>\r\n          <h2 className=\"text-3xl font-extrabold text-gray-900 dark:text-white\">\r\n            Access Denied\r\n          </h2>\r\n          <p className=\"text-gray-600 dark:text-gray-400\">\r\n            You don't have permission to access this resource.\r\n          </p>\r\n          <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">\r\n              Required role{roles.length > 1 ? 's' : ''}: {roles.join(', ')}\r\n            </p>\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              Your role{user?.roles.length && user.roles.length > 1 ? 's' : ''}: {user?.roles.join(', ') || 'None'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return <>{children}</>;\r\n};\r\n\r\n/**\r\n * Component that requires admin role\r\n */\r\nexport const RequireAdmin: React.FC<AuthorizationProps> = (props) => (\r\n  <RequireRole {...props} roles={[APP_ROLES.ADMIN]} />\r\n);\r\n\r\n/**\r\n * Component that allows both admin and control panel roles\r\n */\r\nexport const RequireControlPanelAccess: React.FC<AuthorizationProps> = (props) => (\r\n  <RequireRole {...props} roles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]} />\r\n);\r\n\r\n/**\r\n * Hook for conditional rendering based on roles\r\n */\r\nexport const useRoleAccess = () => {\r\n  const { hasRole, hasAnyRole, isAdmin, canAccessControlPanel } = useAuth();\r\n  \r\n  return {\r\n    hasRole,\r\n    hasAnyRole,\r\n    isAdmin,\r\n    canAccessControlPanel,\r\n    // Convenience methods\r\n    canAccessAdminOnly: () => isAdmin(),\r\n    hasControlPanelAccess: () => canAccessControlPanel(),\r\n  };\r\n};\r\n\r\n/**\r\n * Route guard component for protecting routes\r\n */\r\ninterface ProtectedRouteProps {\r\n  children: ReactNode;\r\n  requireAuth?: boolean;\r\n  requireRoles?: UserRole[];\r\n  requireAll?: boolean;\r\n  fallback?: ReactNode;\r\n  redirectTo?: string;\r\n}\r\n\r\nexport const ProtectedRoute: React.FC<ProtectedRouteProps> = ({\r\n  children,\r\n  requireAuth = true,\r\n  requireRoles = [],\r\n  requireAll = false,\r\n  fallback,\r\n  redirectTo\r\n}) => {\r\n  if (!requireAuth && requireRoles.length === 0) {\r\n    return <>{children}</>;\r\n  }\r\n  \r\n  if (requireAuth && requireRoles.length === 0) {\r\n    return (\r\n      <RequireAuth fallback={fallback} redirectTo={redirectTo}>\r\n        {children}\r\n      </RequireAuth>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <RequireAuth fallback={fallback} redirectTo={redirectTo}>\r\n      <RequireRole \r\n        roles={requireRoles} \r\n        requireAll={requireAll} \r\n        fallback={fallback} \r\n        redirectTo={redirectTo}\r\n      >\r\n        {children}\r\n      </RequireRole>\r\n    </RequireAuth>\r\n  );\r\n};","import { useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\n/**\r\n * Component that redirects users to their appropriate default page based on their role\r\n */\r\nexport const RoleBasedRedirect: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { user, isAuthenticated, isLoading, hasRole } = useAuth();\r\n\r\n  useEffect(() => {\r\n    // Wait for authentication to complete\r\n    if (isLoading || !isAuthenticated || !user) {\r\n      return;\r\n    }\r\n\r\n    // Only redirect from the root path\r\n    if (location.pathname !== '/') {\r\n      return;\r\n    }\r\n\r\n    // Determine default page based on user's primary role\r\n    let defaultPath = '/';\r\n\r\n    if (hasRole(APP_ROLES.CONTROL_PANEL) && !hasRole(APP_ROLES.ADMIN)) {\r\n      // ControlPanel users go to summary page by default\r\n      defaultPath = '/summary';\r\n    } else if (hasRole(APP_ROLES.ADMIN)) {\r\n      // Admin users stay on dashboard (current behavior)\r\n      defaultPath = '/';\r\n    } else {\r\n      // Default fallback\r\n      defaultPath = '/';\r\n    }\r\n\r\n    // Only navigate if we're changing paths\r\n    if (defaultPath !== location.pathname) {\r\n      navigate(defaultPath, { replace: true });\r\n    }\r\n  }, [user, isAuthenticated, isLoading, location.pathname, navigate, hasRole]);\r\n\r\n  // This component doesn't render anything\r\n  return null;\r\n};","import { useMsal } from '@azure/msal-react';\r\nimport { silentRequest } from '@/config/authConfig';\r\n\r\n/**\r\n * Authentication provider for API client\r\n * Provides access tokens and user context for API requests\r\n */\r\nexport class AuthProvider {\r\n  private msalInstance: any;\r\n  private accounts: any;\r\n\r\n  constructor(msalInstance: any, accounts: any) {\r\n    this.msalInstance = msalInstance;\r\n    this.accounts = accounts;\r\n  }\r\n\r\n  /**\r\n   * Get authentication headers for API requests\r\n   */\r\n  async getAuthHeaders(): Promise<Record<string, string>> {\r\n    if (!this.accounts || this.accounts.length === 0) {\r\n      return {}; // Return empty headers if not authenticated\r\n    }\r\n\r\n    try {\r\n      // Get access token silently\r\n      const response = await this.msalInstance.acquireTokenSilent({\r\n        ...silentRequest,\r\n        account: this.accounts[0],\r\n      });\r\n\r\n      return {\r\n        'Authorization': `Bearer ${response.accessToken}`,\r\n        'X-User-ID': this.accounts[0].homeAccountId,\r\n        'X-User-Principal': this.accounts[0].username,\r\n      };\r\n    } catch (error) {\r\n      console.warn('Failed to acquire access token silently:', error);\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user information for API context\r\n   */\r\n  getUserContext() {\r\n    if (!this.accounts || this.accounts.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const account = this.accounts[0];\r\n    return {\r\n      userId: account.homeAccountId,\r\n      username: account.username,\r\n      name: account.name,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Hook to create auth provider from MSAL context\r\n */\r\nexport const useAuthProvider = () => {\r\n  const { instance, accounts } = useMsal();\r\n  \r\n  return new AuthProvider(instance, accounts);\r\n};","import { config, API_ENDPOINTS } from '@/config/constants';\r\nimport { createAppError, isNetworkError } from '@/utils';\r\nimport type {\r\n  SessionInitiateRequest,\r\n  SessionInitiateResponse,\r\n  PredictionSubmitRequest,\r\n  PredictionSubmitResponse,\r\n  PredictionResult,\r\n  HealthCheckResponse,\r\n  SessionData,\r\n  RiskAssessment,\r\n  AppError,\r\n} from '@/types';\r\n\r\n// Type for authentication context\r\ninterface AuthHeaders {\r\n  getAuthHeaders(): Promise<Record<string, string>>;\r\n}\r\n\r\n// Base API client with error handling and authentication\r\nclass ApiClient {\r\n  private baseUrl: string;\r\n  private authProvider?: AuthHeaders;\r\n\r\n  constructor(baseUrl: string, authProvider?: AuthHeaders) {\r\n    this.baseUrl = baseUrl;\r\n    this.authProvider = authProvider;\r\n  }\r\n\r\n  setAuthProvider(authProvider: AuthHeaders) {\r\n    this.authProvider = authProvider;\r\n  }\r\n\r\n  private async handleResponse<T>(response: Response): Promise<T> {\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      \r\n      throw createAppError(\r\n        `HTTP_${response.status}`,\r\n        errorData.message || `HTTP ${response.status}: ${response.statusText}`,\r\n        {\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          data: errorData,\r\n        }\r\n      );\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  private async request<T>(\r\n    endpoint: string,\r\n    options: RequestInit = {}\r\n  ): Promise<T> {\r\n    try {\r\n      // Handle trailing/leading slashes to avoid double slashes\r\n      const baseUrl = this.baseUrl.endsWith('/') ? this.baseUrl.slice(0, -1) : this.baseUrl;\r\n      const cleanEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\r\n      const url = `${baseUrl}${cleanEndpoint}`;\r\n      \r\n      const defaultHeaders = {\r\n        'Content-Type': 'application/json',\r\n        ...options.headers,\r\n      };\r\n\r\n      // Add authentication headers if available\r\n      if (this.authProvider) {\r\n        try {\r\n          const authHeaders = await this.authProvider.getAuthHeaders();\r\n          Object.assign(defaultHeaders, authHeaders);\r\n        } catch (authError) {\r\n          // Log auth error but continue with request - some endpoints may not require auth\r\n          console.warn('Failed to get authentication headers:', authError);\r\n        }\r\n      }\r\n\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers: defaultHeaders,\r\n      });\r\n\r\n      return this.handleResponse<T>(response);\r\n    } catch (error) {\r\n      if (isNetworkError(error)) {\r\n        throw createAppError(\r\n          'NETWORK_ERROR',\r\n          'Unable to connect to the server. Please check your internet connection.',\r\n          { originalError: error }\r\n        );\r\n      }\r\n      \r\n      if (error instanceof Error && 'code' in error) {\r\n        throw error; // Re-throw AppError\r\n      }\r\n      \r\n      throw createAppError(\r\n        'UNKNOWN_ERROR',\r\n        'An unexpected error occurred',\r\n        { originalError: error }\r\n      );\r\n    }\r\n  }\r\n\r\n  async get<T>(endpoint: string): Promise<T> {\r\n    return this.request<T>(endpoint, { method: 'GET' });\r\n  }\r\n\r\n  async post<T>(endpoint: string, data?: unknown): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: 'POST',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  async put<T>(endpoint: string, data?: unknown): Promise<T> {\r\n    return this.request<T>(endpoint, {\r\n      method: 'PUT',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n    });\r\n  }\r\n\r\n  async delete<T>(endpoint: string): Promise<T> {\r\n    return this.request<T>(endpoint, { method: 'DELETE' });\r\n  }\r\n}\r\n\r\n// Create API client instance\r\nconst apiClient = new ApiClient(config.api.baseUrl);\r\n\r\n// Function to set authentication provider (called from app initialization)\r\nexport const setApiAuthProvider = (authProvider: AuthHeaders) => {\r\n  apiClient.setAuthProvider(authProvider);\r\n};\r\n\r\n// API Service functions\r\nexport const apiService = {\r\n  // Health check\r\n  async checkHealth(): Promise<HealthCheckResponse> {\r\n    return apiClient.get<HealthCheckResponse>(API_ENDPOINTS.HEALTH);\r\n  },\r\n\r\n  // Session management\r\n  async initiateSession(request: SessionInitiateRequest): Promise<SessionInitiateResponse> {\r\n    return apiClient.post<SessionInitiateResponse>(\r\n      API_ENDPOINTS.SESSIONS_INITIATE,\r\n      request\r\n    );\r\n  },\r\n\r\n  // Prediction submission\r\n  async submitPrediction(request: PredictionSubmitRequest): Promise<PredictionSubmitResponse> {\r\n    return apiClient.post<PredictionSubmitResponse>(\r\n      API_ENDPOINTS.PREDICTIONS_SUBMIT,\r\n      request\r\n    );\r\n  },\r\n\r\n  // Get prediction results\r\n  async getPredictionBySessionId(sessionId: string): Promise<PredictionResult> {\r\n    return apiClient.get<PredictionResult>(\r\n      `${API_ENDPOINTS.PREDICTIONS_BY_SESSION}/${sessionId}`\r\n    );\r\n  },\r\n\r\n  // Get user predictions\r\n  async getUserPredictions(userId: string): Promise<PredictionResult[]> {\r\n    return apiClient.get<PredictionResult[]>(\r\n      `${API_ENDPOINTS.PREDICTIONS_BY_USER}/${userId}`\r\n    );\r\n  },\r\n\r\n  // Session Storage API methods\r\n  async saveSessionData(sessionData: SessionData): Promise<{ success: boolean; sessionId: string; message: string }> {\r\n    return apiClient.post<{ success: boolean; sessionId: string; message: string }>(\r\n      'sessions',\r\n      sessionData\r\n    );\r\n  },\r\n\r\n  async getSessionData(sessionId: string): Promise<SessionData> {\r\n    return apiClient.get<SessionData>(`sessions/${sessionId}`);\r\n  },\r\n\r\n  async getUserSessions(userId: string): Promise<{ success: boolean; count: number; sessions: SessionData[] }> {\r\n    return apiClient.get<{ success: boolean; count: number; sessions: SessionData[] }>(\r\n      `sessions/users/${userId}`\r\n    );\r\n  },\r\n\r\n  async getAllSessions(): Promise<{ success: boolean; count: number; sessions: SessionData[] }> {\r\n    return apiClient.get<{ success: boolean; count: number; sessions: SessionData[] }>(\r\n      'sessions/all'\r\n    );\r\n  },\r\n\r\n  async updateSessionData(sessionId: string, sessionData: SessionData): Promise<{ success: boolean; message: string }> {\r\n    return apiClient.put<{ success: boolean; message: string }>(\r\n      `sessions/${sessionId}`,\r\n      sessionData\r\n    );\r\n  },\r\n\r\n  async deleteSessionData(sessionId: string): Promise<{ success: boolean; message: string }> {\r\n    return apiClient.delete<{ success: boolean; message: string }>(\r\n      `sessions/${sessionId}`\r\n    );\r\n  },\r\n\r\n  // Test API connection\r\n  async testConnection(): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      await this.checkHealth();\r\n      return { success: true, message: 'API connection successful' };\r\n    } catch (error) {\r\n      const appError = error as AppError;\r\n      return { \r\n        success: false, \r\n        message: appError.message || 'Connection test failed' \r\n      };\r\n    }\r\n  },\r\n\r\n\r\n\r\n  // Risk Assessment API methods\r\n  async generateRiskAssessment(sessionId: string): Promise<{ success: boolean; riskAssessment?: RiskAssessment; message: string }> {\r\n    return apiClient.post<{ success: boolean; riskAssessment?: RiskAssessment; message: string }>(\r\n      `sessions/${sessionId}/risk-assessment`\r\n    );\r\n  },\r\n\r\n  async getRiskAssessment(sessionId: string): Promise<{ success: boolean; riskAssessment?: RiskAssessment; message: string }> {\r\n    return apiClient.get<{ success: boolean; riskAssessment?: RiskAssessment; message: string }>(\r\n      `sessions/${sessionId}/risk-assessment`\r\n    );\r\n  },\r\n\r\n  // Grammar Correction API methods\r\n  async correctGrammar(text: string): Promise<{ originalText: string; correctedText: string }> {\r\n    return apiClient.post<{ originalText: string; correctedText: string }>(\r\n      'CorrectGrammar',\r\n      { text }\r\n    );\r\n  },\r\n};\r\n\r\n// Polling utilities\r\nexport class PredictionPoller {\r\n  private sessionId: string;\r\n  private intervalMs: number;\r\n  private maxAttempts: number;\r\n  private backoffFactor: number;\r\n  private currentAttempt = 0;\r\n  private timeoutId: number | null = null;\r\n  private isPolling = false;\r\n\r\n  constructor(\r\n    sessionId: string,\r\n    options: {\r\n      intervalMs?: number;\r\n      maxAttempts?: number;\r\n      backoffFactor?: number;\r\n    } = {}\r\n  ) {\r\n    this.sessionId = sessionId;\r\n    this.intervalMs = options.intervalMs || config.polling.intervalMs;\r\n    this.maxAttempts = options.maxAttempts || config.polling.maxAttempts;\r\n    this.backoffFactor = options.backoffFactor || config.polling.backoffFactor;\r\n  }\r\n\r\n  async start(\r\n    onUpdate: (result: PredictionResult) => void,\r\n    onComplete: (result: PredictionResult) => void,\r\n    onError: (error: AppError) => void\r\n  ): Promise<void> {\r\n    if (this.isPolling) {\r\n      return;\r\n    }\r\n\r\n    this.isPolling = true;\r\n    this.currentAttempt = 0;\r\n\r\n    const poll = async (): Promise<void> => {\r\n      try {\r\n        const result = await apiService.getPredictionBySessionId(this.sessionId);\r\n        \r\n        onUpdate(result);\r\n\r\n        if (result.status === 'succeeded' || result.status === 'success' || result.status === 'failed') {\r\n          this.stop();\r\n          onComplete(result);\r\n          return;\r\n        }\r\n\r\n        this.currentAttempt++;\r\n\r\n        if (this.currentAttempt >= this.maxAttempts) {\r\n          this.stop();\r\n          onError(createAppError(\r\n            'POLLING_TIMEOUT',\r\n            'Prediction polling timed out. Please check the session manually.',\r\n            { sessionId: this.sessionId, attempts: this.currentAttempt }\r\n          ));\r\n          return;\r\n        }\r\n\r\n        // Schedule next poll with exponential backoff\r\n        const nextInterval = this.intervalMs * Math.pow(this.backoffFactor, this.currentAttempt);\r\n        this.timeoutId = window.setTimeout(poll, nextInterval);\r\n\r\n      } catch (error) {\r\n        this.stop();\r\n        onError(error as AppError);\r\n      }\r\n    };\r\n\r\n    // Start polling immediately\r\n    await poll();\r\n  }\r\n\r\n  stop(): void {\r\n    this.isPolling = false;\r\n    if (this.timeoutId) {\r\n      clearTimeout(this.timeoutId);\r\n      this.timeoutId = null;\r\n    }\r\n  }\r\n\r\n  getStatus(): { isPolling: boolean; attempt: number; maxAttempts: number } {\r\n    return {\r\n      isPolling: this.isPolling,\r\n      attempt: this.currentAttempt,\r\n      maxAttempts: this.maxAttempts,\r\n    };\r\n  }\r\n}\r\n\r\n\r\n// Export PredictionResult type for external use\r\nexport type { PredictionResult } from '@/types';\r\n","import { useEffect } from 'react';\r\nimport { useAuthProvider } from '@/services/authProvider';\r\nimport { setApiAuthProvider } from '@/services/api';\r\n\r\n/**\r\n * Component that initializes the API authentication provider\r\n * Must be used within MsalProvider context\r\n */\r\nexport const ApiAuthInitializer: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const authProvider = useAuthProvider();\r\n\r\n  useEffect(() => {\r\n    // Set the auth provider for the API client\r\n    setApiAuthProvider(authProvider);\r\n  }, [authProvider]);\r\n\r\n  return <>{children}</>;\r\n};","import { useEffect, useRef, useCallback } from 'react';\r\nimport { announceToScreenReader, focusElement, trapFocus, debounce } from '@/utils';\r\nimport { A11Y } from '@/config/constants';\r\n// import type { A11yAnnouncement } from '@/types'; // Commented out until used\r\n\r\n// Screen reader announcements\r\nexport const useAnnouncements = () => {\r\n  const announce = useCallback((\r\n    message: string, \r\n    priority: 'polite' | 'assertive' = 'polite'\r\n  ) => {\r\n    announceToScreenReader(message, priority);\r\n  }, []);\r\n\r\n  const announceError = useCallback((message: string) => {\r\n    announce(message, 'assertive');\r\n  }, [announce]);\r\n\r\n  const announceSuccess = useCallback((message: string) => {\r\n    announce(message, 'polite');\r\n  }, [announce]);\r\n\r\n  return {\r\n    announce,\r\n    announceError,\r\n    announceSuccess,\r\n  };\r\n};\r\n\r\n// Focus management\r\nexport const useFocusManagement = () => {\r\n  const focusById = useCallback((elementId: string, delay?: number) => {\r\n    focusElement(elementId, delay);\r\n  }, []);\r\n\r\n  const focusFirst = useCallback((container?: HTMLElement) => {\r\n    const target = container || document;\r\n    const firstFocusable = target.querySelector(\r\n      'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex=\"-1\"])'\r\n    ) as HTMLElement;\r\n    \r\n    if (firstFocusable) {\r\n      firstFocusable.focus();\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    focusById,\r\n    focusFirst,\r\n  };\r\n};\r\n\r\n// Focus trap for modals and dialogs\r\nexport const useFocusTrap = (isActive: boolean) => {\r\n  const containerRef = useRef<HTMLElement>(null);\r\n  const trapRef = useRef<{ release: () => void } | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (isActive && containerRef.current) {\r\n      trapRef.current = trapFocus(containerRef.current);\r\n    }\r\n\r\n    return () => {\r\n      if (trapRef.current) {\r\n        trapRef.current.release();\r\n        trapRef.current = null;\r\n      }\r\n    };\r\n  }, [isActive]);\r\n\r\n  return containerRef;\r\n};\r\n\r\n// Keyboard navigation\r\nexport const useKeyboardNavigation = () => {\r\n  const handleEscape = useCallback((callback: () => void) => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault();\r\n        callback();\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, []);\r\n\r\n  const handleEnterSpace = useCallback((callback: () => void) => {\r\n    return (event: React.KeyboardEvent) => {\r\n      if (event.key === 'Enter' || event.key === ' ') {\r\n        event.preventDefault();\r\n        callback();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    handleEscape,\r\n    handleEnterSpace,\r\n  };\r\n};\r\n\r\n// ARIA live regions for dynamic content\r\nexport const useAriaLive = () => {\r\n  const liveRegionRef = useRef<HTMLDivElement>(null);\r\n\r\n  const updateLiveRegion = useCallback((\r\n    message: string,\r\n    priority: 'polite' | 'assertive' = 'polite'\r\n  ) => {\r\n    if (liveRegionRef.current) {\r\n      liveRegionRef.current.setAttribute('aria-live', priority);\r\n      liveRegionRef.current.textContent = message;\r\n    }\r\n  }, []);\r\n\r\n  const clearLiveRegion = useCallback(() => {\r\n    if (liveRegionRef.current) {\r\n      liveRegionRef.current.textContent = '';\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    liveRegionRef,\r\n    updateLiveRegion,\r\n    clearLiveRegion,\r\n  };\r\n};\r\n\r\n// Progress announcements with debouncing\r\nexport const useProgressAnnouncement = () => {\r\n  const lastAnnouncedProgress = useRef(-1);\r\n\r\n  const debouncedProgressAnnounce = debounce((...args: unknown[]) => {\r\n    const progress = args[0] as number;\r\n    const message = args[1] as string;\r\n    // Only announce significant progress changes\r\n    if (Math.abs(progress - lastAnnouncedProgress.current) >= 10 || progress === 100) {\r\n      announceToScreenReader(`${message} ${progress}% complete`, 'polite');\r\n      lastAnnouncedProgress.current = progress;\r\n    }\r\n  }, A11Y.DEBOUNCE_MS);\r\n\r\n  const announceProgress = useCallback(debouncedProgressAnnounce, []);\r\n\r\n  return { announceProgress };\r\n};\r\n\r\n// Skip to content functionality\r\nexport const useSkipToContent = () => {\r\n  const skipToMain = useCallback(() => {\r\n    focusElement(A11Y.SKIP_TO_CONTENT_ID, A11Y.FOCUS_TIMEOUT);\r\n  }, []);\r\n\r\n  return { skipToMain };\r\n};\r\n\r\n// Form accessibility helpers\r\nexport const useFormAccessibility = () => {\r\n  const getFieldId = useCallback((name: string) => `field-${name}`, []);\r\n  const getErrorId = useCallback((name: string) => `error-${name}`, []);\r\n  const getDescriptionId = useCallback((name: string) => `description-${name}`, []);\r\n\r\n  const getFieldProps = useCallback((\r\n    name: string,\r\n    hasError: boolean,\r\n    hasDescription: boolean\r\n  ) => {\r\n    const props: React.InputHTMLAttributes<HTMLInputElement> = {\r\n      id: getFieldId(name),\r\n      'aria-invalid': hasError,\r\n    };\r\n\r\n    const describedBy: string[] = [];\r\n    \r\n    if (hasError) {\r\n      describedBy.push(getErrorId(name));\r\n    }\r\n    \r\n    if (hasDescription) {\r\n      describedBy.push(getDescriptionId(name));\r\n    }\r\n\r\n    if (describedBy.length > 0) {\r\n      props['aria-describedby'] = describedBy.join(' ');\r\n    }\r\n\r\n    return props;\r\n  }, [getFieldId, getErrorId, getDescriptionId]);\r\n\r\n  return {\r\n    getFieldId,\r\n    getErrorId,\r\n    getDescriptionId,\r\n    getFieldProps,\r\n  };\r\n};\r\n\r\n// Status announcements for file uploads and processing\r\nexport const useStatusAnnouncements = () => {\r\n  const announceUploadStart = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Starting upload of ${fileName}`, 'polite');\r\n  }, []);\r\n\r\n  const announceUploadComplete = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Upload of ${fileName} completed successfully`, 'polite');\r\n  }, []);\r\n\r\n  const announceConversionStart = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Starting audio conversion for ${fileName}`, 'polite');\r\n  }, []);\r\n\r\n  const announceConversionComplete = useCallback((fileName: string) => {\r\n    announceToScreenReader(`Audio conversion for ${fileName} completed`, 'polite');\r\n  }, []);\r\n\r\n  const announcePredictionStart = useCallback((sessionId: string) => {\r\n    announceToScreenReader(`Starting behavioral health prediction for session ${sessionId}`, 'polite');\r\n  }, []);\r\n\r\n  const announcePredictionComplete = useCallback((sessionId: string) => {\r\n    announceToScreenReader(`Behavioral health prediction completed for session ${sessionId}`, 'polite');\r\n  }, []);\r\n\r\n  const announceError = useCallback((operation: string, error: string) => {\r\n    announceToScreenReader(`Error during ${operation}: ${error}`, 'assertive');\r\n  }, []);\r\n\r\n  return {\r\n    announceUploadStart,\r\n    announceUploadComplete,\r\n    announceConversionStart,\r\n    announceConversionComplete,\r\n    announcePredictionStart,\r\n    announcePredictionComplete,\r\n    announceError,\r\n  };\r\n};\r\n","import { useState, useEffect } from 'react';\r\nimport { Link, useLocation } from 'react-router-dom';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { useKeyboardNavigation } from '@/hooks/accessibility';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\ninterface HeaderProps {\r\n  className?: string;\r\n}\r\n\r\nexport const Header: React.FC<HeaderProps> = ({ className = '' }) => {\r\n  const { theme, toggleTheme } = useTheme();\r\n  const { user, logout, isAuthenticated, isAdmin } = useAuth();\r\n  const location = useLocation();\r\n  const { handleEnterSpace } = useKeyboardNavigation();\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [showUserMenu, setShowUserMenu] = useState(false);\r\n\r\n  // Check if authentication is enabled\r\n  const isAuthEnabled = import.meta.env.VITE_ENABLE_ENTRA_AUTH === 'true';\r\n\r\n  // Filter navigation items based on user permissions\r\n  const getNavigationItems = () => {\r\n    const baseItems = [\r\n      { path: '/', label: 'Dashboard', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/upload', label: 'Upload & Analyze', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/sessions', label: 'Sessions', icon: '', roles: [APP_ROLES.ADMIN] },\r\n      { path: '/predictions', label: 'My Predictions', icon: '', roles: [APP_ROLES.ADMIN] },\r\n    ];\r\n\r\n    // If auth is disabled, show all navigation items\r\n    if (!isAuthEnabled) {\r\n      return baseItems;\r\n    }\r\n\r\n    // If auth is enabled but user is not authenticated, show no items\r\n    if (!isAuthenticated) {\r\n      return [];\r\n    }\r\n\r\n    // Only show navigation items to Admin users, ControlPanel users get no navigation buttons\r\n    return baseItems.filter(() => {\r\n      if (isAdmin()) return true; // Admins can access everything\r\n      return false; // ControlPanel users see no navigation buttons\r\n    });\r\n  };\r\n\r\n  // Debug authentication state\r\n  useEffect(() => {\r\n    console.log('[Header] Authentication state:', {\r\n      isAuthenticated,\r\n      user: user ? { id: user.id, name: user.name, roles: user.roles } : null,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }, [isAuthenticated, user]);\r\n\r\n  const navItems = getNavigationItems();\r\n\r\n  const isActivePath = (path: string) => {\r\n    if (path === '/') {\r\n      return location.pathname === '/';\r\n    }\r\n    return location.pathname.startsWith(path);\r\n  };\r\n\r\n  const toggleMobileMenu = () => {\r\n    setIsMobileMenuOpen(!isMobileMenuOpen);\r\n  };\r\n\r\n  const closeMobileMenu = () => {\r\n    setIsMobileMenuOpen(false);\r\n  };\r\n\r\n  // Close mobile menu when route changes\r\n  useEffect(() => {\r\n    setIsMobileMenuOpen(false);\r\n    setShowUserMenu(false);\r\n  }, [location.pathname]);\r\n\r\n  // Close user menu when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      const target = event.target as Element;\r\n      if (showUserMenu && !target.closest('[data-user-menu]')) {\r\n        setShowUserMenu(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [showUserMenu]);\r\n\r\n  return (\r\n    <header className={`bg-surface-light dark:bg-surface-dark border-b border-gray-200 dark:border-gray-700 ${className}`}>\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n        <div className=\"flex justify-between items-center h-16\">\r\n          {/* Logo and title */}\r\n          <div className=\"flex items-center\">\r\n            <Link\r\n              to=\"/\"\r\n              className=\"flex items-center space-x-3 text-xl font-bold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-md px-2 py-1 group\"\r\n              aria-label=\"Behavioral Health System - Go to Dashboard\"\r\n            >\r\n              <span className=\"text-2xl group-hover:brain-throb transition-all duration-300 group-hover:scale-105\" role=\"img\" aria-label=\"Brain icon\"></span>\r\n              <span className=\"hidden sm:block\">Behavioral Health System</span>\r\n              <span className=\"sm:hidden\">BHS</span>\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Navigation */}\r\n          <nav className=\"hidden md:flex space-x-1\" role=\"navigation\" aria-label=\"Main navigation\">\r\n            {navItems.map(({ path, label, icon }) => (\r\n              <Link\r\n                key={path}\r\n                to={path}\r\n                className={`\r\n                  flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-colors\r\n                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                  ${\r\n                    isActivePath(path)\r\n                      ? 'bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100'\r\n                      : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700'\r\n                  }\r\n                `}\r\n                aria-current={isActivePath(path) ? 'page' : undefined}\r\n              >\r\n                <span role=\"img\" aria-hidden=\"true\">{icon}</span>\r\n                <span>{label}</span>\r\n              </Link>\r\n            ))}\r\n          </nav>\r\n\r\n          {/* User menu and theme toggle */}\r\n          <div className=\"flex items-center space-x-2\">\r\n            {/* User indicator - always visible */}\r\n            <div className=\"relative\" data-user-menu>\r\n              {isAuthEnabled && isAuthenticated && user ? (\r\n                // Authenticated user - fully functional\r\n                <button\r\n                  onClick={() => setShowUserMenu(!showUserMenu)}\r\n                  onKeyDown={handleEnterSpace(() => setShowUserMenu(!showUserMenu))}\r\n                  className=\"\r\n                    flex items-center space-x-2 p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                    dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                    transition-colors touch-target\r\n                  \"\r\n                  aria-label=\"User menu\"\r\n                  type=\"button\"\r\n                >\r\n                  <div className=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium\">\r\n                    {user.name.charAt(0).toUpperCase()}\r\n                  </div>\r\n                  <span className=\"hidden sm:block text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {user.name}\r\n                  </span>\r\n                  <svg\r\n                    className={`w-4 h-4 transition-transform ${showUserMenu ? 'rotate-180' : ''}`}\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </button>\r\n              ) : (\r\n                // Disabled user indicator - grey and unclickable\r\n                <div\r\n                  className=\"\r\n                    flex items-center space-x-2 p-2 rounded-md text-gray-400 cursor-not-allowed opacity-50\r\n                    dark:text-gray-500 transition-colors touch-target\r\n                  \"\r\n                  aria-label=\"User authentication disabled\"\r\n                  title={!isAuthEnabled ? \"Authentication is disabled\" : \"Not signed in\"}\r\n                >\r\n                  <div className=\"w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center text-white text-sm font-medium\">\r\n                    ?\r\n                  </div>\r\n                  <span className=\"hidden sm:block text-sm font-medium text-gray-500 dark:text-gray-400\">\r\n                    {!isAuthEnabled ? \"Auth Disabled\" : \"Not Signed In\"}\r\n                  </span>\r\n                  <svg\r\n                    className=\"w-4 h-4\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                  </svg>\r\n                </div>\r\n              )}\r\n\r\n              {/* User dropdown menu - only show for authenticated users */}\r\n              {isAuthEnabled && isAuthenticated && user && showUserMenu && (\r\n                <div className=\"absolute right-0 mt-2 w-72 bg-white dark:bg-gray-800 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50\">\r\n                  <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className=\"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium\">\r\n                        {user.name.charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{user.name}</p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{user.email}</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"mt-2\">\r\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">\r\n                        {user.primaryRole}\r\n                      </span>\r\n                      {user.roles.length > 1 && (\r\n                        <span className=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                          +{user.roles.length - 1} more\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"py-1\">\r\n                    <button\r\n                      onClick={() => {\r\n                        logout();\r\n                        setShowUserMenu(false);\r\n                      }}\r\n                      className=\"\r\n                        w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 \r\n                        hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\r\n                      \"\r\n                    >\r\n                      Sign out\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <button\r\n              onClick={toggleTheme}\r\n              onKeyDown={handleEnterSpace(toggleTheme)}\r\n              className=\"\r\n                p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                transition-colors touch-target\r\n              \"\r\n              aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}\r\n              type=\"button\"\r\n            >\r\n              <span className=\"text-xl\" role=\"img\" aria-hidden=\"true\">\r\n                {theme === 'light' ? '' : ''}\r\n              </span>\r\n            </button>\r\n\r\n            {/* Mobile menu button - show when there are navigation items to display */}\r\n            {navItems.length > 0 && (\r\n              <button\r\n                onClick={toggleMobileMenu}\r\n                onKeyDown={handleEnterSpace(toggleMobileMenu)}\r\n                className=\"\r\n                  md:hidden p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100\r\n                  dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-700\r\n                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                  transition-colors touch-target\r\n                \"\r\n                aria-label={isMobileMenuOpen ? \"Close mobile menu\" : \"Open mobile menu\"}\r\n                type=\"button\"\r\n                {...(isMobileMenuOpen ? { 'aria-expanded': true } : { 'aria-expanded': false })}\r\n              >\r\n                <span className=\"text-xl\" role=\"img\" aria-hidden=\"true\">\r\n                  {isMobileMenuOpen ? '' : ''}\r\n                </span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Mobile navigation */}\r\n        {isMobileMenuOpen && navItems.length > 0 && (\r\n          <div className=\"md:hidden border-t border-gray-200 dark:border-gray-700 pt-4 pb-3\">\r\n            <nav className=\"space-y-1\" role=\"navigation\" aria-label=\"Mobile navigation\">\r\n              {navItems.map(({ path, label, icon }) => (\r\n                <Link\r\n                  key={path}\r\n                  to={path}\r\n                  onClick={closeMobileMenu}\r\n                  className={`\r\n                    flex items-center space-x-3 px-3 py-2 rounded-md text-base font-medium transition-colors\r\n                    focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2\r\n                    ${\r\n                      isActivePath(path)\r\n                        ? 'bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100'\r\n                        : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-gray-100 dark:hover:bg-gray-700'\r\n                    }\r\n                  `}\r\n                  aria-current={isActivePath(path) ? 'page' : undefined}\r\n                >\r\n                  <span role=\"img\" aria-hidden=\"true\">{icon}</span>\r\n                  <span>{label}</span>\r\n                </Link>\r\n              ))}\r\n            </nav>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n","import { SVGProps } from 'react';\r\n\r\ninterface MicrosoftLogoProps extends SVGProps<SVGSVGElement> {\r\n  size?: number;\r\n  className?: string;\r\n}\r\n\r\nexport const MicrosoftLogo: React.FC<MicrosoftLogoProps> = ({\r\n  size = 20,\r\n  className = '',\r\n  ...props\r\n}) => {\r\n  return (\r\n    <svg\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 23 23\"\r\n      className={className}\r\n      aria-label=\"Microsoft\"\r\n      {...props}\r\n    >\r\n      {/* Microsoft logo squares */}\r\n      <rect x=\"1\" y=\"1\" width=\"10\" height=\"10\" fill=\"#f25022\" />\r\n      <rect x=\"12\" y=\"1\" width=\"10\" height=\"10\" fill=\"#7fba00\" />\r\n      <rect x=\"1\" y=\"12\" width=\"10\" height=\"10\" fill=\"#00a4ef\" />\r\n      <rect x=\"12\" y=\"12\" width=\"10\" height=\"10\" fill=\"#ffb900\" />\r\n    </svg>\r\n  );\r\n};\r\n","import { ReactNode } from 'react';\r\nimport { Header } from './Header';\r\nimport { useSkipToContent } from '@/hooks/accessibility';\r\nimport { A11Y } from '@/config/constants';\r\nimport { MicrosoftLogo } from '@/components/icons';\r\n\r\ninterface LayoutProps {\r\n  children: ReactNode;\r\n  className?: string;\r\n}\r\n\r\nexport const Layout: React.FC<LayoutProps> = ({ children, className = '' }) => {\r\n  const { skipToMain } = useSkipToContent();\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background-light dark:bg-background-dark\">\r\n      {/* Skip to content link for keyboard navigation */}\r\n      <a\r\n        href={`#${A11Y.SKIP_TO_CONTENT_ID}`}\r\n        className=\"skip-link\"\r\n        onClick={(e) => {\r\n          e.preventDefault();\r\n          skipToMain();\r\n        }}\r\n      >\r\n        Skip to main content\r\n      </a>\r\n\r\n      {/* Header */}\r\n      <Header />\r\n\r\n      {/* Main content */}\r\n      <main\r\n        id={A11Y.SKIP_TO_CONTENT_ID}\r\n        className={`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${className}`}\r\n        tabIndex={-1}\r\n      >\r\n        {children}\r\n      </main>\r\n\r\n      {/* ARIA live region for announcements */}\r\n      <div\r\n        id={A11Y.ANNOUNCEMENTS_ID}\r\n        className=\"sr-only\"\r\n        aria-live=\"polite\"\r\n        aria-atomic=\"true\"\r\n      />\r\n\r\n      {/* Footer */}\r\n      <footer className=\"bg-surface-light dark:bg-surface-dark border-t border-gray-200 dark:border-gray-700 mt-auto\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\r\n          <div className=\"flex flex-col items-center space-y-4\">\r\n            {/* Microsoft Logo */}\r\n            <div className=\"flex items-center space-x-2\">\r\n              <MicrosoftLogo size={24} className=\"opacity-80\" />\r\n              <span className=\"text-sm text-text-muted-light dark:text-text-muted-dark font-medium\">\r\n                Powered by Microsoft\r\n              </span>\r\n            </div>\r\n            \r\n            {/* Copyright and Compliance */}\r\n            <div className=\"text-center text-sm text-text-muted-light dark:text-text-muted-dark\">\r\n              <p>\r\n                Behavioral Health System &copy; {new Date().getFullYear()}\r\n              </p>\r\n              <p className=\"mt-1\">\r\n                WCAG 2.2 AA Compliant  Section 508 Compliant\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </footer>\r\n    </div>\r\n  );\r\n};\r\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst toCamelCase = (string) => string.replace(\n  /^([A-Z])|[\\s-_]+(\\w)/g,\n  (match, p1, p2) => p2 ? p2.toUpperCase() : p1.toLowerCase()\n);\nconst toPascalCase = (string) => {\n  const camelCase = toCamelCase(string);\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n};\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\nconst hasA11yProp = (props) => {\n  for (const prop in props) {\n    if (prop.startsWith(\"aria-\") || prop === \"role\" || prop === \"title\") {\n      return true;\n    }\n  }\n};\n\nexport { hasA11yProp, mergeClasses, toCamelCase, toKebabCase, toPascalCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses, hasA11yProp } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => createElement(\n    \"svg\",\n    {\n      ref,\n      ...defaultAttributes,\n      width: size,\n      height: size,\n      stroke: color,\n      strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n      className: mergeClasses(\"lucide\", className),\n      ...!children && !hasA11yProp(rest) && { \"aria-hidden\": \"true\" },\n      ...rest\n    },\n    [\n      ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n      ...Array.isArray(children) ? children : [children]\n    ]\n  )\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase, toPascalCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(\n        `lucide-${toKebabCase(toPascalCase(iconName))}`,\n        `lucide-${iconName}`,\n        className\n      ),\n      ...props\n    })\n  );\n  Component.displayName = toPascalCase(iconName);\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2\",\n      key: \"169zse\"\n    }\n  ]\n];\nconst Activity = createLucideIcon(\"activity\", __iconNode);\n\nexport { __iconNode, Activity as default };\n//# sourceMappingURL=activity.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m12 19-7-7 7-7\", key: \"1l729n\" }],\n  [\"path\", { d: \"M19 12H5\", key: \"x3x0zl\" }]\n];\nconst ArrowLeft = createLucideIcon(\"arrow-left\", __iconNode);\n\nexport { __iconNode, ArrowLeft as default };\n//# sourceMappingURL=arrow-left.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"m12 5 7 7-7 7\", key: \"xquz4c\" }]\n];\nconst ArrowRight = createLucideIcon(\"arrow-right\", __iconNode);\n\nexport { __iconNode, ArrowRight as default };\n//# sourceMappingURL=arrow-right.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 18V5\", key: \"adv99a\" }],\n  [\"path\", { d: \"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4\", key: \"1e3is1\" }],\n  [\"path\", { d: \"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5\", key: \"1gqd8o\" }],\n  [\"path\", { d: \"M17.997 5.125a4 4 0 0 1 2.526 5.77\", key: \"iwvgf7\" }],\n  [\"path\", { d: \"M18 18a4 4 0 0 0 2-7.464\", key: \"efp6ie\" }],\n  [\"path\", { d: \"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517\", key: \"1gq6am\" }],\n  [\"path\", { d: \"M6 18a4 4 0 0 1-2-7.464\", key: \"k1g0md\" }],\n  [\"path\", { d: \"M6.003 5.125a4 4 0 0 0-2.526 5.77\", key: \"q97ue3\" }]\n];\nconst Brain = createLucideIcon(\"brain\", __iconNode);\n\nexport { __iconNode, Brain as default };\n//# sourceMappingURL=brain.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }]\n];\nconst Calendar = createLucideIcon(\"calendar\", __iconNode);\n\nexport { __iconNode, Calendar as default };\n//# sourceMappingURL=calendar.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 3v16a2 2 0 0 0 2 2h16\", key: \"c24i48\" }],\n  [\"path\", { d: \"M18 17V9\", key: \"2bz60n\" }],\n  [\"path\", { d: \"M13 17V5\", key: \"1frdt8\" }],\n  [\"path\", { d: \"M8 17v-3\", key: \"17ska0\" }]\n];\nconst ChartColumn = createLucideIcon(\"chart-column\", __iconNode);\n\nexport { __iconNode, ChartColumn as default };\n//# sourceMappingURL=chart-column.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z\",\n      key: \"pzmjnu\"\n    }\n  ],\n  [\"path\", { d: \"M21.21 15.89A10 10 0 1 1 8 2.83\", key: \"k2fpak\" }]\n];\nconst ChartPie = createLucideIcon(\"chart-pie\", __iconNode);\n\nexport { __iconNode, ChartPie as default };\n//# sourceMappingURL=chart-pie.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m6 9 6 6 6-6\", key: \"qrunsl\" }]];\nconst ChevronDown = createLucideIcon(\"chevron-down\", __iconNode);\n\nexport { __iconNode, ChevronDown as default };\n//# sourceMappingURL=chevron-down.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m18 15-6-6-6 6\", key: \"153udz\" }]];\nconst ChevronUp = createLucideIcon(\"chevron-up\", __iconNode);\n\nexport { __iconNode, ChevronUp as default };\n//# sourceMappingURL=chevron-up.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n];\nconst CircleAlert = createLucideIcon(\"circle-alert\", __iconNode);\n\nexport { __iconNode, CircleAlert as default };\n//# sourceMappingURL=circle-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21.801 10A10 10 0 1 1 17 3.335\", key: \"yps3ct\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n];\nconst CircleCheckBig = createLucideIcon(\"circle-check-big\", __iconNode);\n\nexport { __iconNode, CircleCheckBig as default };\n//# sourceMappingURL=circle-check-big.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m15 9-6 6\", key: \"1uzhvr\" }],\n  [\"path\", { d: \"m9 9 6 6\", key: \"z0biqf\" }]\n];\nconst CircleX = createLucideIcon(\"circle-x\", __iconNode);\n\nexport { __iconNode, CircleX as default };\n//# sourceMappingURL=circle-x.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 6v6l4 2\", key: \"mmk7yg\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst Clock = createLucideIcon(\"clock\", __iconNode);\n\nexport { __iconNode, Clock as default };\n//# sourceMappingURL=clock.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 15V3\", key: \"m9g1x1\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"path\", { d: \"m7 10 5 5 5-5\", key: \"brsn70\" }]\n];\nconst Download = createLucideIcon(\"download\", __iconNode);\n\nexport { __iconNode, Download as default };\n//# sourceMappingURL=download.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49\",\n      key: \"ct8e1f\"\n    }\n  ],\n  [\"path\", { d: \"M14.084 14.158a3 3 0 0 1-4.242-4.242\", key: \"151rxh\" }],\n  [\n    \"path\",\n    {\n      d: \"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143\",\n      key: \"13bj9a\"\n    }\n  ],\n  [\"path\", { d: \"m2 2 20 20\", key: \"1ooewy\" }]\n];\nconst EyeOff = createLucideIcon(\"eye-off\", __iconNode);\n\nexport { __iconNode, EyeOff as default };\n//# sourceMappingURL=eye-off.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0\",\n      key: \"1nclc0\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Eye = createLucideIcon(\"eye\", __iconNode);\n\nexport { __iconNode, Eye as default };\n//# sourceMappingURL=eye.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3\", key: \"rslqgf\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\n    \"path\",\n    {\n      d: \"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0\",\n      key: \"9f7x3i\"\n    }\n  ]\n];\nconst FileAudio = createLucideIcon(\"file-audio\", __iconNode);\n\nexport { __iconNode, FileAudio as default };\n//# sourceMappingURL=file-audio.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M10 9H8\", key: \"b1mrlr\" }],\n  [\"path\", { d: \"M16 13H8\", key: \"t4e002\" }],\n  [\"path\", { d: \"M16 17H8\", key: \"z1uh3a\" }]\n];\nconst FileText = createLucideIcon(\"file-text\", __iconNode);\n\nexport { __iconNode, FileText as default };\n//# sourceMappingURL=file-text.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }]\n];\nconst File = createLucideIcon(\"file\", __iconNode);\n\nexport { __iconNode, File as default };\n//# sourceMappingURL=file.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z\",\n      key: \"1vo8kb\"\n    }\n  ],\n  [\"path\", { d: \"M15 2v4a2 2 0 0 0 2 2h4\", key: \"sud9ri\" }],\n  [\"path\", { d: \"M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1\", key: \"l4dndm\" }]\n];\nconst Files = createLucideIcon(\"files\", __iconNode);\n\nexport { __iconNode, Files as default };\n//# sourceMappingURL=files.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z\",\n      key: \"sc7q7i\"\n    }\n  ]\n];\nconst Funnel = createLucideIcon(\"funnel\", __iconNode);\n\nexport { __iconNode, Funnel as default };\n//# sourceMappingURL=funnel.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5\",\n      key: \"mvr1a0\"\n    }\n  ]\n];\nconst Heart = createLucideIcon(\"heart\", __iconNode);\n\nexport { __iconNode, Heart as default };\n//# sourceMappingURL=heart.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"M12 16v-4\", key: \"1dtifu\" }],\n  [\"path\", { d: \"M12 8h.01\", key: \"e9boi3\" }]\n];\nconst Info = createLucideIcon(\"info\", __iconNode);\n\nexport { __iconNode, Info as default };\n//# sourceMappingURL=info.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5\",\n      key: \"1gvzjb\"\n    }\n  ],\n  [\"path\", { d: \"M9 18h6\", key: \"x1upvd\" }],\n  [\"path\", { d: \"M10 22h4\", key: \"ceow96\" }]\n];\nconst Lightbulb = createLucideIcon(\"lightbulb\", __iconNode);\n\nexport { __iconNode, Lightbulb as default };\n//# sourceMappingURL=lightbulb.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]];\nconst LoaderCircle = createLucideIcon(\"loader-circle\", __iconNode);\n\nexport { __iconNode, LoaderCircle as default };\n//# sourceMappingURL=loader-circle.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719\",\n      key: \"1sd12s\"\n    }\n  ]\n];\nconst MessageCircle = createLucideIcon(\"message-circle\", __iconNode);\n\nexport { __iconNode, MessageCircle as default };\n//# sourceMappingURL=message-circle.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 19v3\", key: \"npa21l\" }],\n  [\"path\", { d: \"M19 10v2a7 7 0 0 1-14 0v-2\", key: \"1vc78b\" }],\n  [\"rect\", { x: \"9\", y: \"2\", width: \"6\", height: \"13\", rx: \"3\", key: \"s6n7sd\" }]\n];\nconst Mic = createLucideIcon(\"mic\", __iconNode);\n\nexport { __iconNode, Mic as default };\n//# sourceMappingURL=mic.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { x: \"14\", y: \"3\", width: \"5\", height: \"18\", rx: \"1\", key: \"kaeet6\" }],\n  [\"rect\", { x: \"5\", y: \"3\", width: \"5\", height: \"18\", rx: \"1\", key: \"1wsw3u\" }]\n];\nconst Pause = createLucideIcon(\"pause\", __iconNode);\n\nexport { __iconNode, Pause as default };\n//# sourceMappingURL=pause.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384\",\n      key: \"9njp5v\"\n    }\n  ]\n];\nconst Phone = createLucideIcon(\"phone\", __iconNode);\n\nexport { __iconNode, Phone as default };\n//# sourceMappingURL=phone.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z\",\n      key: \"10ikf1\"\n    }\n  ]\n];\nconst Play = createLucideIcon(\"play\", __iconNode);\n\nexport { __iconNode, Play as default };\n//# sourceMappingURL=play.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n];\nconst Plus = createLucideIcon(\"plus\", __iconNode);\n\nexport { __iconNode, Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n];\nconst RefreshCw = createLucideIcon(\"refresh-cw\", __iconNode);\n\nexport { __iconNode, RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m21 21-4.34-4.34\", key: \"14j7rj\" }],\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }]\n];\nconst Search = createLucideIcon(\"search\", __iconNode);\n\nexport { __iconNode, Search as default };\n//# sourceMappingURL=search.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915\",\n      key: \"1i5ecw\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n];\nconst Settings = createLucideIcon(\"settings\", __iconNode);\n\nexport { __iconNode, Settings as default };\n//# sourceMappingURL=settings.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z\",\n      key: \"oel41y\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v4\", key: \"1got3b\" }],\n  [\"path\", { d: \"M12 16h.01\", key: \"1drbdi\" }]\n];\nconst ShieldAlert = createLucideIcon(\"shield-alert\", __iconNode);\n\nexport { __iconNode, ShieldAlert as default };\n//# sourceMappingURL=shield-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"6\", key: \"1vlfrh\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }]\n];\nconst Target = createLucideIcon(\"target\", __iconNode);\n\nexport { __iconNode, Target as default };\n//# sourceMappingURL=target.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 11v6\", key: \"nco0om\" }],\n  [\"path\", { d: \"M14 11v6\", key: \"outv1u\" }],\n  [\"path\", { d: \"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6\", key: \"miytrc\" }],\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\", key: \"e791ji\" }]\n];\nconst Trash2 = createLucideIcon(\"trash-2\", __iconNode);\n\nexport { __iconNode, Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 17h6v-6\", key: \"t6n2it\" }],\n  [\"path\", { d: \"m22 17-8.5-8.5-5 5L2 7\", key: \"x473p\" }]\n];\nconst TrendingDown = createLucideIcon(\"trending-down\", __iconNode);\n\nexport { __iconNode, TrendingDown as default };\n//# sourceMappingURL=trending-down.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 7h6v6\", key: \"box55l\" }],\n  [\"path\", { d: \"m22 7-8.5 8.5-5-5L2 17\", key: \"1t1m79\" }]\n];\nconst TrendingUp = createLucideIcon(\"trending-up\", __iconNode);\n\nexport { __iconNode, TrendingUp as default };\n//# sourceMappingURL=trending-up.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\",\n      key: \"wmoenq\"\n    }\n  ],\n  [\"path\", { d: \"M12 9v4\", key: \"juzpu7\" }],\n  [\"path\", { d: \"M12 17h.01\", key: \"p32p05\" }]\n];\nconst TriangleAlert = createLucideIcon(\"triangle-alert\", __iconNode);\n\nexport { __iconNode, TriangleAlert as default };\n//# sourceMappingURL=triangle-alert.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3v12\", key: \"1x0j5s\" }],\n  [\"path\", { d: \"m17 8-5-5-5 5\", key: \"7q97r8\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }]\n];\nconst Upload = createLucideIcon(\"upload\", __iconNode);\n\nexport { __iconNode, Upload as default };\n//# sourceMappingURL=upload.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n];\nconst User = createLucideIcon(\"user\", __iconNode);\n\nexport { __iconNode, User as default };\n//# sourceMappingURL=user.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"path\", { d: \"M16 3.128a4 4 0 0 1 0 7.744\", key: \"16gr8j\" }],\n  [\"path\", { d: \"M22 21v-2a4 4 0 0 0-3-3.87\", key: \"kshegd\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }]\n];\nconst Users = createLucideIcon(\"users\", __iconNode);\n\nexport { __iconNode, Users as default };\n//# sourceMappingURL=users.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"path\", { d: \"M16 9a5 5 0 0 1 0 6\", key: \"1q6k2b\" }],\n  [\"path\", { d: \"M19.364 18.364a9 9 0 0 0 0-12.728\", key: \"ijwkga\" }]\n];\nconst Volume2 = createLucideIcon(\"volume-2\", __iconNode);\n\nexport { __iconNode, Volume2 as default };\n//# sourceMappingURL=volume-2.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z\",\n      key: \"uqj9uw\"\n    }\n  ],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"9\", y2: \"15\", key: \"1ewh16\" }],\n  [\"line\", { x1: \"16\", x2: \"22\", y1: \"9\", y2: \"15\", key: \"5ykzw1\" }]\n];\nconst VolumeX = createLucideIcon(\"volume-x\", __iconNode);\n\nexport { __iconNode, VolumeX as default };\n//# sourceMappingURL=volume-x.js.map\n","/**\n * @license lucide-react v0.542.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n];\nconst X = createLucideIcon(\"x\", __iconNode);\n\nexport { __iconNode, X as default };\n//# sourceMappingURL=x.js.map\n","import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { apiService, PredictionPoller } from '@/services/api';\r\nimport { getUserId } from '@/utils';\r\nimport type {\r\n  SessionInitiateRequest,\r\n  PredictionSubmitRequest,\r\n  PredictionResult,\r\n  HealthCheckResponse,\r\n  SessionData,\r\n  AppError,\r\n} from '@/types';\r\n\r\n// Query keys\r\nexport const QUERY_KEYS = {\r\n  health: ['health'] as const,\r\n  userPredictions: (userId: string) => ['predictions', 'user', userId] as const,\r\n  sessionPrediction: (sessionId: string) => ['predictions', 'session', sessionId] as const,\r\n  userSessions: (userId: string) => ['sessions', 'user', userId] as const,\r\n} as const;\r\n\r\n// Health check query\r\nexport const useHealthCheck = () => {\r\n  return useQuery<HealthCheckResponse, AppError>({\r\n    queryKey: QUERY_KEYS.health,\r\n    queryFn: () => apiService.checkHealth(),\r\n    retry: 2,\r\n    staleTime: 30000, // 30 seconds\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Session initiation mutation\r\nexport const useInitiateSession = () => {\r\n  return useMutation({\r\n    mutationFn: (request: SessionInitiateRequest) => \r\n      apiService.initiateSession(request),\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Prediction submission mutation\r\nexport const useSubmitPrediction = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: (request: PredictionSubmitRequest) => \r\n      apiService.submitPrediction(request),\r\n    onSuccess: (_, variables) => {\r\n      // Invalidate related queries\r\n      queryClient.invalidateQueries({\r\n        queryKey: QUERY_KEYS.sessionPrediction(variables.sessionid),\r\n      });\r\n      \r\n      const userId = getUserId();\r\n      queryClient.invalidateQueries({\r\n        queryKey: QUERY_KEYS.userPredictions(userId),\r\n      });\r\n    },\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Get prediction by session ID\r\nexport const useSessionPrediction = (sessionId: string, enabled = true) => {\r\n  return useQuery<PredictionResult, AppError>({\r\n    queryKey: QUERY_KEYS.sessionPrediction(sessionId),\r\n    queryFn: () => apiService.getPredictionBySessionId(sessionId),\r\n    enabled: enabled && Boolean(sessionId),\r\n    retry: (failureCount, error) => {\r\n      // Don't retry on 404s (session not found)\r\n      if (error.code === 'HTTP_404') {\r\n        return false;\r\n      }\r\n      return failureCount < 3;\r\n    },\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Get user predictions\r\nexport const useUserPredictions = (userId?: string) => {\r\n  const effectiveUserId = userId || getUserId();\r\n\r\n  return useQuery<PredictionResult[], AppError>({\r\n    queryKey: QUERY_KEYS.userPredictions(effectiveUserId),\r\n    queryFn: () => apiService.getUserPredictions(effectiveUserId),\r\n    enabled: Boolean(effectiveUserId),\r\n    staleTime: 60000, // 1 minute\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Get user sessions with complete session data\r\nexport const useUserSessions = (userId?: string) => {\r\n  const effectiveUserId = userId || getUserId();\r\n\r\n  return useQuery<{ success: boolean; count: number; sessions: SessionData[] }, AppError>({\r\n    queryKey: QUERY_KEYS.userSessions(effectiveUserId),\r\n    queryFn: () => apiService.getUserSessions(effectiveUserId),\r\n    enabled: Boolean(effectiveUserId),\r\n    staleTime: 30000, // 30 seconds\r\n    refetchOnWindowFocus: false,\r\n  });\r\n};\r\n\r\n// Prediction polling hook\r\nexport const usePredictionPolling = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  const startPolling = (\r\n    sessionId: string,\r\n    options?: {\r\n      onUpdate?: (result: PredictionResult) => void;\r\n      onComplete?: (result: PredictionResult) => void;\r\n      onError?: (error: AppError) => void;\r\n    }\r\n  ) => {\r\n    const poller = new PredictionPoller(sessionId);\r\n\r\n    return poller.start(\r\n      (result) => {\r\n        // Update cache\r\n        queryClient.setQueryData(\r\n          QUERY_KEYS.sessionPrediction(sessionId),\r\n          result\r\n        );\r\n        options?.onUpdate?.(result);\r\n      },\r\n      (result) => {\r\n        // Final update and invalidate user predictions\r\n        queryClient.setQueryData(\r\n          QUERY_KEYS.sessionPrediction(sessionId),\r\n          result\r\n        );\r\n        \r\n        const userId = getUserId();\r\n        queryClient.invalidateQueries({\r\n          queryKey: QUERY_KEYS.userPredictions(userId),\r\n        });\r\n        \r\n        options?.onComplete?.(result);\r\n      },\r\n      (error) => {\r\n        options?.onError?.(error);\r\n      }\r\n    );\r\n  };\r\n\r\n  return { startPolling };\r\n};\r\n\r\n// API connection test\r\nexport const useTestConnection = () => {\r\n  return useMutation({\r\n    mutationFn: () => apiService.testConnection(),\r\n    onError: () => {\r\n      // Error is handled by the UI components\r\n    },\r\n  });\r\n};\r\n\r\n// Optimistic updates helper\r\nexport const useOptimisticUpdates = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  const updateSessionStatus = (sessionId: string, status: PredictionResult['status']) => {\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.sessionPrediction(sessionId),\r\n      (old: PredictionResult | undefined) => {\r\n        if (!old) return old;\r\n        return {\r\n          ...old,\r\n          status,\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n      }\r\n    );\r\n  };\r\n\r\n  const addNewSession = (sessionId: string, userId: string) => {\r\n    const newSession: PredictionResult = {\r\n      sessionId,\r\n      status: 'queued',\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    // Add to session cache\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.sessionPrediction(sessionId),\r\n      newSession\r\n    );\r\n\r\n    // Add to user predictions cache\r\n    queryClient.setQueryData(\r\n      QUERY_KEYS.userPredictions(userId),\r\n      (old: PredictionResult[] | undefined) => {\r\n        if (!old) return [newSession];\r\n        return [newSession, ...old];\r\n      }\r\n    );\r\n  };\r\n\r\n  return {\r\n    updateSessionStatus,\r\n    addNewSession,\r\n  };\r\n};\r\n","import { useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Eye } from 'lucide-react';\r\nimport { useHealthCheck, useUserSessions } from '@/hooks/api';\r\nimport { useAnnouncements } from '@/hooks/accessibility';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { getUserId } from '@/utils';\r\n\r\nexport const Dashboard: React.FC = () => {\r\n  const { announce } = useAnnouncements();\r\n  const { canAccessControlPanel, user } = useAuth();\r\n  \r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = (): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  };\r\n  \r\n  // Fetch health status and recent sessions\r\n  const { data: healthStatus, isLoading: isHealthLoading, error: healthError } = useHealthCheck();\r\n  const { data: sessionsResponse, isLoading: isSessionsLoading } = useUserSessions(getAuthenticatedUserId());\r\n\r\n  useEffect(() => {\r\n    announce('Dashboard page loaded', 'polite');\r\n  }, [announce]);\r\n\r\n  const quickActions = [\r\n    {\r\n      title: 'Upload & Analyze',\r\n      description: 'Upload audio files for behavioral health analysis',\r\n      href: '/upload',\r\n      icon: '',\r\n      color: 'primary',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'View Sessions',\r\n      description: 'Browse all analysis sessions and their results',\r\n      href: '/sessions',\r\n      icon: '',\r\n      color: 'secondary',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'My Predictions',\r\n      description: 'View your complete prediction history',\r\n      href: '/predictions',\r\n      icon: '',\r\n      color: 'accent',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'Agent Experience',\r\n      description: 'Interactive chat with AI behavioral health agents',\r\n      href: '/agent-experience',\r\n      icon: '',\r\n      color: 'warning',\r\n      disabled: false\r\n    },\r\n    {\r\n      title: 'Speech Avatar Experience',\r\n      description: 'Real-time voice interaction with AI behavioral health agents using Azure Speech Avatar',\r\n      href: '/speech-avatar-experience',\r\n      icon: '',\r\n      color: 'accent',\r\n      disabled: false\r\n    }\r\n  ];\r\n\r\n  const getActionClasses = (color: string, disabled: boolean = false) => {\r\n    const baseClasses = disabled \r\n      ? 'block p-4 rounded-lg border-2 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-not-allowed opacity-60' \r\n      : 'block p-4 rounded-lg border-2 transition-all hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2';\r\n    \r\n    switch (color) {\r\n      case 'primary':\r\n        return `${baseClasses} border-primary-200 bg-primary-50 ${!disabled && 'hover:border-primary-300 hover:bg-primary-100'} dark:border-primary-800 dark:bg-primary-900 ${!disabled && 'dark:hover:border-primary-700 dark:hover:bg-primary-800'} focus:ring-primary-500`;\r\n      case 'secondary':\r\n        return `${baseClasses} border-secondary-200 bg-secondary-50 ${!disabled && 'hover:border-secondary-300 hover:bg-secondary-100'} dark:border-secondary-800 dark:bg-secondary-900 ${!disabled && 'dark:hover:border-secondary-700 dark:hover:bg-secondary-800'} focus:ring-secondary-500`;\r\n      case 'accent':\r\n        return `${baseClasses} border-accent-200 bg-accent-50 ${!disabled && 'hover:border-accent-300 hover:bg-accent-100'} dark:border-accent-800 dark:bg-accent-900 ${!disabled && 'dark:hover:border-accent-700 dark:hover:bg-accent-800'} focus:ring-accent-500`;\r\n      case 'warning':\r\n        return `${baseClasses} border-warning-200 bg-warning-50 ${!disabled && 'hover:border-warning-300 hover:bg-warning-100'} dark:border-teal-600 dark:bg-teal-800 ${!disabled && 'dark:hover:border-teal-500 dark:hover:bg-teal-700'} focus:ring-warning-500`;\r\n      default:\r\n        return `${baseClasses} border-gray-200 bg-gray-50 ${!disabled && 'hover:border-gray-300 hover:bg-gray-100'} dark:border-gray-700 dark:bg-gray-800 ${!disabled && 'dark:hover:border-gray-600 dark:hover:bg-gray-700'} focus:ring-gray-500`;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      {/* Page header */}\r\n      <div className=\"text-center\">\r\n        <h1 className=\"text-3xl font-bold text-text-primary-light dark:text-text-primary-dark\">\r\n          Behavioral Health System\r\n        </h1>\r\n        <p className=\"mt-2 text-lg text-text-secondary-light dark:text-text-secondary-dark\">\r\n          Audio-based mental health prediction and analysis\r\n        </p>\r\n      </div>\r\n\r\n      {/* Quick actions */}\r\n      <div>\r\n        <h2 className=\"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6\">\r\n          Quick Actions\r\n        </h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {quickActions.map((action) => {\r\n            if (action.disabled) {\r\n              return (\r\n                <div\r\n                  key={action.href}\r\n                  className={`${getActionClasses(action.color, true)} relative`}\r\n                  aria-label={`${action.title}: Coming Soon`}\r\n                >\r\n                  <div className=\"text-center\">\r\n                    <div className=\"text-2xl mb-2\" role=\"img\" aria-hidden=\"true\">\r\n                      {action.icon}\r\n                    </div>\r\n                    <h3 className=\"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1\">\r\n                      {action.title}\r\n                    </h3>\r\n                    <p className=\"text-xs text-text-secondary-light dark:text-text-secondary-dark\">\r\n                      {action.description}\r\n                    </p>\r\n                  </div>\r\n                  {/* Coming Soon Overlay */}\r\n                  <div className=\"absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center\">\r\n                    <div className=\"text-center\">\r\n                      <div className=\"text-white font-bold text-sm mb-1\"></div>\r\n                      <div className=\"text-white font-semibold text-xs\">COMING SOON</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            }\r\n            \r\n            return (\r\n              <Link\r\n                key={action.href}\r\n                to={action.href}\r\n                className={getActionClasses(action.color, false)}\r\n                aria-label={`${action.title}: ${action.description}`}\r\n              >\r\n                <div className=\"text-center\">\r\n                  <div className=\"text-2xl mb-2\" role=\"img\" aria-hidden=\"true\">\r\n                    {action.icon}\r\n                  </div>\r\n                  <h3 className=\"text-base font-semibold text-text-primary-light dark:text-text-primary-dark mb-1\">\r\n                    {action.title}\r\n                  </h3>\r\n                  <p className=\"text-xs text-text-secondary-light dark:text-text-secondary-dark\">\r\n                    {action.description}\r\n                  </p>\r\n                </div>\r\n              </Link>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Summary Access - Only for authorized users */}\r\n      {canAccessControlPanel() && (\r\n        <div className=\"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-2\">\r\n                 Summary\r\n              </h2>\r\n              <p className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n                Advanced analytics dashboard\r\n              </p>\r\n            </div>\r\n            <Link\r\n              to=\"/summary\"\r\n              className=\"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 inline-block\"\r\n            >\r\n              View Summary\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Recent activity */}\r\n      <div className=\"card border-2 border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 dark:border-primary-800 dark:from-primary-900 dark:to-secondary-900\">\r\n        <h2 className=\"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark mb-4\">\r\n          Recent Activity\r\n        </h2>\r\n        {isSessionsLoading ? (\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"spinner w-4 h-4\"></div>\r\n            <span className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              Loading recent sessions...\r\n            </span>\r\n          </div>\r\n        ) : (!sessionsResponse?.sessions || sessionsResponse.sessions.length === 0) ? (\r\n          <div className=\"text-center py-8\">\r\n            <div className=\"text-4xl mb-4\" role=\"img\" aria-label=\"No data\"></div>\r\n            <p className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              No sessions yet. \r\n              <Link \r\n                to=\"/upload\" \r\n                className=\"text-primary-600 dark:text-primary-400 hover:underline ml-1\"\r\n              >\r\n                Upload your first audio file\r\n              </Link> to get started.\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {sessionsResponse.sessions\r\n              .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\r\n              .slice(0, 3)\r\n              .map((session) => (\r\n              <div\r\n                key={session.sessionId}\r\n                className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md\"\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className={`status-${session.status || 'completed'}`}>\r\n                    {session.status || 'completed'}\r\n                  </div>\r\n                  <span className=\"text-text-primary-light dark:text-text-primary-dark\">\r\n                    {session.audioFileName || session.sessionId?.slice(0, 8) || 'Unknown'}\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\" title={session.createdAt}>\r\n                    {session.createdAt ? new Date(session.createdAt).toLocaleString() : ''}\r\n                  </span>\r\n                </div>\r\n                <Link\r\n                  to={`/sessions/${session.sessionId || ''}`}\r\n                  className=\"text-primary-600 dark:text-primary-400 hover:underline text-sm flex items-center gap-1\"\r\n                  title=\"View session details\"\r\n                  aria-label={`View details for session ${session.audioFileName || session.sessionId?.slice(0, 8) || 'Unknown'}`}\r\n                >\r\n                  <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                </Link>\r\n              </div>\r\n            ))}\r\n            {sessionsResponse.sessions.length > 3 && (\r\n              <div className=\"text-center pt-3\">\r\n                <Link\r\n                  to=\"/sessions\"\r\n                  className=\"text-primary-600 dark:text-primary-400 hover:underline\"\r\n                >\r\n                  View all {sessionsResponse.sessions.length} sessions \r\n                </Link>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* System status */}\r\n      <div className=\"card\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h2 className=\"text-lg font-semibold text-text-primary-light dark:text-text-primary-dark\">\r\n            System Status\r\n          </h2>\r\n          <Link\r\n            to=\"/health\"\r\n            className=\"px-6 py-3 bg-black hover:bg-gray-800 text-white border-2 border-white rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 inline-block\"\r\n          >\r\n            System Health\r\n          </Link>\r\n        </div>\r\n        {isHealthLoading ? (\r\n          <div className=\"flex items-center space-x-2\">\r\n            <div className=\"spinner w-4 h-4\"></div>\r\n            <span className=\"text-text-secondary-light dark:text-text-secondary-dark\">\r\n              Checking system health...\r\n            </span>\r\n          </div>\r\n        ) : healthError ? (\r\n          <div className=\"flex items-center space-x-2 text-error-600 dark:text-error-400\">\r\n            <span role=\"img\" aria-label=\"Error\"></span>\r\n            <span>System health check failed</span>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center space-x-2 text-success-600 dark:text-success-400\">\r\n            <span role=\"img\" aria-label=\"Healthy\"></span>\r\n            <span>All systems operational</span>\r\n            {healthStatus?.checks && (\r\n              <span className=\"text-text-muted-light dark:text-text-muted-dark\">\r\n                ({Object.keys(healthStatus.checks).length} services checked)\r\n              </span>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import { FFmpeg } from '@ffmpeg/ffmpeg';\r\nimport { fetchFile, toBlobURL } from '@ffmpeg/util';\r\nimport { config } from '@/config/constants';\r\nimport { createAppError } from '@/utils';\r\nimport type { AudioConversionOptions } from '@/types';\r\n// import type { AppError } from '@/types'; // Commented out until used\r\n\r\nexport interface ConversionProgress {\r\n  stage: 'loading' | 'converting' | 'completed';\r\n  progress: number;\r\n  message: string;\r\n}\r\n\r\nexport class AudioProcessor {\r\n  private ffmpeg: FFmpeg | null = null;\r\n  private isLoaded = false;\r\n  private loadingPromise: Promise<void> | null = null;\r\n\r\n  constructor() {\r\n    this.ffmpeg = new FFmpeg();\r\n  }\r\n\r\n  private async loadFFmpeg(): Promise<void> {\r\n    if (this.isLoaded) return;\r\n    \r\n    if (this.loadingPromise) {\r\n      return this.loadingPromise;\r\n    }\r\n\r\n    this.loadingPromise = this.doLoadFFmpeg();\r\n    return this.loadingPromise;\r\n  }\r\n\r\n  private async doLoadFFmpeg(): Promise<void> {\r\n    if (!this.ffmpeg) {\r\n      throw createAppError(\r\n        'FFMPEG_INIT_ERROR',\r\n        'Failed to initialize FFmpeg'\r\n      );\r\n    }\r\n\r\n    try {\r\n      // Load FFmpeg with CDN URLs for better reliability\r\n      const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm';\r\n      \r\n      await this.ffmpeg.load({\r\n        coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),\r\n        wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),\r\n      });\r\n\r\n      this.isLoaded = true;\r\n    } catch (error) {\r\n      this.loadingPromise = null;\r\n      throw createAppError(\r\n        'FFMPEG_LOAD_ERROR',\r\n        'Failed to load FFmpeg. Please check your internet connection and try again.',\r\n        { originalError: error }\r\n      );\r\n    }\r\n  }\r\n\r\n  async convertAudio(\r\n    file: File,\r\n    options: AudioConversionOptions = {\r\n      outputFormat: 'wav',\r\n      sampleRate: 44100,\r\n      channels: 1,\r\n    },\r\n    onProgress?: (progress: ConversionProgress) => void\r\n  ): Promise<File> {\r\n    try {\r\n      // Notify loading stage\r\n      onProgress?.({\r\n        stage: 'loading',\r\n        progress: 0,\r\n        message: 'Loading audio processor...',\r\n      });\r\n\r\n      await this.loadFFmpeg();\r\n\r\n      if (!this.ffmpeg) {\r\n        throw createAppError('FFMPEG_NOT_LOADED', 'FFmpeg not properly loaded');\r\n      }\r\n\r\n      // Setup progress callback\r\n      this.ffmpeg.on('progress', ({ progress }) => {\r\n        onProgress?.({\r\n          stage: 'converting',\r\n          progress: Math.round(progress * 100),\r\n          message: `Converting audio... ${Math.round(progress * 100)}%`,\r\n        });\r\n      });\r\n\r\n      onProgress?.({\r\n        stage: 'converting',\r\n        progress: 0,\r\n        message: 'Preparing audio file...',\r\n      });\r\n\r\n      // Write input file\r\n      const inputName = 'input.' + this.getFileExtension(file.name);\r\n      await this.ffmpeg.writeFile(inputName, await fetchFile(file));\r\n\r\n      // Build FFmpeg command\r\n      const outputName = `output.${options.outputFormat}`;\r\n      const command = [\r\n        '-i', inputName,\r\n        '-ac', options.channels.toString(),\r\n        '-ar', options.sampleRate.toString(),\r\n        '-f', options.outputFormat,\r\n        outputName\r\n      ];\r\n\r\n      // Execute conversion\r\n      await this.ffmpeg.exec(command);\r\n\r\n      // Read output file\r\n      const outputData = await this.ffmpeg.readFile(outputName);\r\n      const outputBlob = new Blob([outputData as unknown as ArrayBuffer], { type: `audio/${options.outputFormat}` });\r\n      \r\n      // Create new File object with converted audio\r\n      const convertedFile = new File(\r\n        [outputBlob],\r\n        `${this.getFileNameWithoutExtension(file.name)}.${options.outputFormat}`,\r\n        { type: `audio/${options.outputFormat}` }\r\n      );\r\n\r\n      // Clean up temporary files\r\n      await this.ffmpeg.deleteFile(inputName);\r\n      await this.ffmpeg.deleteFile(outputName);\r\n\r\n      onProgress?.({\r\n        stage: 'completed',\r\n        progress: 100,\r\n        message: 'Audio conversion completed',\r\n      });\r\n\r\n      return convertedFile;\r\n\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'AUDIO_CONVERSION_ERROR',\r\n        'Failed to convert audio file. Please try with a different file.',\r\n        { \r\n          originalError: error,\r\n          fileName: file.name,\r\n          fileSize: file.size,\r\n          fileType: file.type\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private getFileExtension(filename: string): string {\r\n    const lastDot = filename.lastIndexOf('.');\r\n    return lastDot !== -1 ? filename.slice(lastDot + 1).toLowerCase() : '';\r\n  }\r\n\r\n  private getFileNameWithoutExtension(filename: string): string {\r\n    const lastDot = filename.lastIndexOf('.');\r\n    return lastDot !== -1 ? filename.slice(0, lastDot) : filename;\r\n  }\r\n\r\n  async isFormatSupported(file: File): Promise<boolean> {\r\n    try {\r\n      await this.loadFFmpeg();\r\n      \r\n      // Check if file extension is in supported formats\r\n      const supportedFormats = ['wav', 'mp3', 'mp4', 'm4a', 'aac', 'flac', 'ogg'];\r\n      const extension = this.getFileExtension(file.name);\r\n      \r\n      return supportedFormats.includes(extension);\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  dispose(): void {\r\n    if (this.ffmpeg) {\r\n      this.ffmpeg.terminate();\r\n      this.ffmpeg = null;\r\n    }\r\n    this.isLoaded = false;\r\n    this.loadingPromise = null;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet audioProcessorInstance: AudioProcessor | null = null;\r\n\r\nexport const getAudioProcessor = (): AudioProcessor => {\r\n  if (!audioProcessorInstance) {\r\n    audioProcessorInstance = new AudioProcessor();\r\n  }\r\n  return audioProcessorInstance;\r\n};\r\n\r\n// Fallback for browsers that don't support SharedArrayBuffer or other requirements\r\nexport const isFFmpegSupported = (): boolean => {\r\n  try {\r\n    // Check for SharedArrayBuffer support (required for FFmpeg.wasm)\r\n    if (typeof SharedArrayBuffer === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    // Check if in a secure context (required for some FFmpeg features)\r\n    if (!window.isSecureContext) {\r\n      return false;\r\n    }\r\n\r\n    return config.features.enableFFmpegWorker;\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\n\r\n// Server fallback (for when FFmpeg.wasm is not supported)\r\nexport const convertAudioOnServer = async (\r\n  file: File,\r\n  _options: AudioConversionOptions\r\n): Promise<File> => {\r\n  // This would be implemented as a backend endpoint\r\n  // For now, return the original file as fallback\r\n  return file;\r\n};\r\n\r\n// Convenience function for the Upload & Analyze page\r\nexport const convertAudioToWav = async (\r\n  file: File,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const processor = getAudioProcessor();\r\n  \r\n  const convertedFile = await processor.convertAudio(\r\n    file,\r\n    {\r\n      outputFormat: 'wav',\r\n      sampleRate: 44100,\r\n      channels: 1,\r\n    },\r\n    onProgress ? (progress) => onProgress(progress.progress) : undefined\r\n  );\r\n\r\n  // Convert File to Blob\r\n  return new Blob([convertedFile], { type: 'audio/wav' });\r\n};\r\n","import { BlobServiceClient, ContainerClient } from '@azure/storage-blob';\r\nimport { config } from '@/config/constants';\r\nimport { createAppError, getUserId } from '@/utils';\r\n\r\nexport interface UploadProgress {\r\n  progress: number;\r\n  stage: 'preparing' | 'uploading' | 'completed';\r\n  message: string;\r\n}\r\n\r\nexport interface UploadResult {\r\n  url: string;\r\n  fileName: string;\r\n  size: number;\r\n}\r\n\r\nexport class AzureBlobService {\r\n  private containerClient: ContainerClient | null = null;\r\n  private sasUrl: string;\r\n\r\n  constructor(sasUrl?: string) {\r\n    this.sasUrl = sasUrl || config.azure.blobSasUrl;\r\n    \r\n    if (!this.sasUrl) {\r\n      throw createAppError(\r\n        'AZURE_CONFIG_ERROR',\r\n        'Azure Blob Storage SAS URL not configured'\r\n      );\r\n    }\r\n  }\r\n\r\n  private getContainerClient(): ContainerClient {\r\n    if (!this.containerClient) {\r\n      try {\r\n        const blobServiceClient = new BlobServiceClient(this.sasUrl);\r\n        this.containerClient = blobServiceClient.getContainerClient(config.azure.containerName);\r\n      } catch (error) {\r\n        throw createAppError(\r\n          'AZURE_CLIENT_ERROR',\r\n          'Failed to initialize Azure Blob Storage client',\r\n          { originalError: error }\r\n        );\r\n      }\r\n    }\r\n    \r\n    return this.containerClient;\r\n  }\r\n\r\n  async uploadFile(\r\n    file: File,\r\n    fileName?: string,\r\n    onProgress?: (progress: UploadProgress) => void,\r\n    userId?: string\r\n  ): Promise<UploadResult> {\r\n    try {\r\n      onProgress?.({\r\n        progress: 0,\r\n        stage: 'preparing',\r\n        message: 'Preparing upload...',\r\n      });\r\n\r\n      const containerClient = this.getContainerClient();\r\n      // When userId is provided, create proper folder structure with custom filename or generated filename\r\n      let blobName: string;\r\n      if (userId) {\r\n        const effectiveUserId = userId;\r\n        if (fileName) {\r\n          // Use custom filename (includes metadata user ID) within user folder structure\r\n          blobName = `users/${effectiveUserId}/audio/${fileName}`;\r\n        } else {\r\n          // Generate filename with timestamp and random ID\r\n          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n          const randomId = Math.random().toString(36).substring(2, 8);\r\n          const extension = file.name.split('.').pop() || 'wav';\r\n          blobName = `users/${effectiveUserId}/audio/${timestamp}-${randomId}.${extension}`;\r\n        }\r\n      } else {\r\n        // Fallback to original logic when no userId provided\r\n        blobName = fileName || this.generateBlobName(file.name);\r\n      }\r\n      const blockBlobClient = containerClient.getBlockBlobClient(blobName);\r\n\r\n      // Upload with progress tracking\r\n      onProgress?.({\r\n        progress: 10,\r\n        stage: 'uploading',\r\n        message: 'Starting upload...',\r\n      });\r\n\r\n      await blockBlobClient.uploadData(file, {\r\n        blobHTTPHeaders: {\r\n          blobContentType: file.type,\r\n        },\r\n        onProgress: (uploadProgress) => {\r\n          const progressPercent = uploadProgress.loadedBytes && file.size \r\n            ? Math.round((uploadProgress.loadedBytes / file.size) * 90) + 10\r\n            : 50;\r\n            \r\n          onProgress?.({\r\n            progress: progressPercent,\r\n            stage: 'uploading',\r\n            message: `Uploading... ${progressPercent}%`,\r\n          });\r\n        },\r\n      });\r\n\r\n      // Get the URL for the uploaded blob\r\n      const blobUrl = blockBlobClient.url;\r\n\r\n      onProgress?.({\r\n        progress: 100,\r\n        stage: 'completed',\r\n        message: 'Upload completed',\r\n      });\r\n\r\n      return {\r\n        url: blobUrl,\r\n        fileName: blobName,\r\n        size: file.size,\r\n      };\r\n\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'UPLOAD_ERROR',\r\n        'Failed to upload file to Azure Blob Storage',\r\n        { \r\n          originalError: error,\r\n          fileName: file.name,\r\n          fileSize: file.size\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private generateBlobName(originalFileName: string, userId?: string): string {\r\n    // Get user ID for data isolation\r\n    const effectiveUserId = userId || getUserId();\r\n    \r\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n    const randomId = Math.random().toString(36).substring(2, 8);\r\n    const extension = originalFileName.split('.').pop() || 'wav';\r\n    \r\n    // Include user ID in the path for data isolation\r\n    return `users/${effectiveUserId}/audio/${timestamp}-${randomId}.${extension}`;\r\n  }\r\n\r\n  async testConnection(): Promise<{ success: boolean; message: string }> {\r\n    try {\r\n      const containerClient = this.getContainerClient();\r\n      \r\n      // Try to get container properties to test connection\r\n      await containerClient.getProperties();\r\n      \r\n      return {\r\n        success: true,\r\n        message: 'Azure Blob Storage connection successful',\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        message: 'Failed to connect to Azure Blob Storage. Please check your SAS URL configuration.',\r\n      };\r\n    }\r\n  }\r\n\r\n  async deleteFile(fileName: string): Promise<void> {\r\n    try {\r\n      const containerClient = this.getContainerClient();\r\n      const blockBlobClient = containerClient.getBlockBlobClient(fileName);\r\n      \r\n      await blockBlobClient.deleteIfExists();\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'DELETE_ERROR',\r\n        'Failed to delete file from Azure Blob Storage',\r\n        { originalError: error, fileName }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * List all files for a specific user\r\n   */\r\n  async listUserFiles(userId?: string): Promise<string[]> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const containerClient = this.getContainerClient();\r\n      const userPrefix = `users/${effectiveUserId}/`;\r\n      \r\n      const blobs: string[] = [];\r\n      for await (const blob of containerClient.listBlobsFlat({ prefix: userPrefix })) {\r\n        blobs.push(blob.name);\r\n      }\r\n      \r\n      return blobs;\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'LIST_ERROR',\r\n        'Failed to list user files from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete all files for a specific user (for GDPR compliance)\r\n   */\r\n  async deleteUserData(userId?: string): Promise<number> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const userFiles = await this.listUserFiles(effectiveUserId);\r\n      \r\n      let deletedCount = 0;\r\n      for (const fileName of userFiles) {\r\n        await this.deleteFile(fileName);\r\n        deletedCount++;\r\n      }\r\n      \r\n      return deletedCount;\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'DELETE_USER_DATA_ERROR',\r\n        'Failed to delete user data from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get storage usage for a specific user\r\n   */\r\n  async getUserStorageUsage(userId?: string): Promise<{ fileCount: number; totalSizeBytes: number }> {\r\n    try {\r\n      const effectiveUserId = userId || getUserId();\r\n      const containerClient = this.getContainerClient();\r\n      const userPrefix = `users/${effectiveUserId}/`;\r\n      \r\n      let fileCount = 0;\r\n      let totalSizeBytes = 0;\r\n      \r\n      for await (const blob of containerClient.listBlobsFlat({ prefix: userPrefix })) {\r\n        fileCount++;\r\n        totalSizeBytes += blob.properties.contentLength || 0;\r\n      }\r\n      \r\n      return { fileCount, totalSizeBytes };\r\n    } catch (error) {\r\n      throw createAppError(\r\n        'STORAGE_USAGE_ERROR',\r\n        'Failed to get user storage usage from Azure Blob Storage',\r\n        { originalError: error, userId }\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet blobServiceInstance: AzureBlobService | null = null;\r\n\r\nexport const getBlobService = (sasUrl?: string): AzureBlobService => {\r\n  if (!blobServiceInstance || (sasUrl && sasUrl !== blobServiceInstance['sasUrl'])) {\r\n    blobServiceInstance = new AzureBlobService(sasUrl);\r\n  }\r\n  return blobServiceInstance;\r\n};\r\n\r\n// Check if Azure Blob Storage is properly configured\r\nexport const isAzureBlobConfigured = (): boolean => {\r\n  return Boolean(config.azure.blobSasUrl && config.azure.containerName);\r\n};\r\n\r\n// Convenience function for the Upload & Analyze page with user isolation\r\nexport const uploadToAzureBlob = async (\r\n  file: File | Blob,\r\n  fileName: string,\r\n  onProgress?: (progress: number) => void,\r\n  userId?: string\r\n): Promise<string> => {\r\n  const blobService = getBlobService();\r\n  \r\n  // Convert Blob to File if needed\r\n  const fileToUpload = file instanceof File ? file : new File([file], fileName, { type: file.type });\r\n  \r\n  const result = await blobService.uploadFile(\r\n    fileToUpload,\r\n    fileName,\r\n    onProgress ? (progress) => onProgress(progress.progress) : undefined,\r\n    userId\r\n  );\r\n\r\n  return result.url;\r\n};\r\n","import { useCallback, useRef } from 'react';\r\n\r\n/**\r\n * Hook for accessibility features like screen reader announcements\r\n */\r\nexport const useAccessibility = () => {\r\n  const announcementRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  /**\r\n   * Announce text to screen readers\r\n   */\r\n  const announceToScreenReader = useCallback((message: string) => {\r\n    // Create a live region if it doesn't exist\r\n    if (!announcementRef.current) {\r\n      const liveRegion = document.createElement('div');\r\n      liveRegion.setAttribute('aria-live', 'polite');\r\n      liveRegion.setAttribute('aria-atomic', 'true');\r\n      liveRegion.style.position = 'absolute';\r\n      liveRegion.style.left = '-10000px';\r\n      liveRegion.style.width = '1px';\r\n      liveRegion.style.height = '1px';\r\n      liveRegion.style.overflow = 'hidden';\r\n      document.body.appendChild(liveRegion);\r\n      announcementRef.current = liveRegion;\r\n    }\r\n\r\n    // Clear previous message and set new one\r\n    announcementRef.current.textContent = '';\r\n    setTimeout(() => {\r\n      if (announcementRef.current) {\r\n        announcementRef.current.textContent = message;\r\n      }\r\n    }, 100);\r\n  }, []);\r\n\r\n  /**\r\n   * Focus management utilities\r\n   */\r\n  const focusManagement = {\r\n    /**\r\n     * Set focus to element by ID\r\n     */\r\n    focusById: (elementId: string) => {\r\n      const element = document.getElementById(elementId);\r\n      if (element) {\r\n        element.focus();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Focus the first focusable element within a container\r\n     */\r\n    focusFirstInContainer: (container: HTMLElement) => {\r\n      const focusableElements = container.querySelectorAll(\r\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n      );\r\n      \r\n      const firstElement = focusableElements[0] as HTMLElement;\r\n      if (firstElement) {\r\n        firstElement.focus();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Trap focus within a container (for modals)\r\n     */\r\n    trapFocus: (container: HTMLElement) => {\r\n      const focusableElements = container.querySelectorAll(\r\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n      ) as NodeListOf<HTMLElement>;\r\n\r\n      const firstElement = focusableElements[0];\r\n      const lastElement = focusableElements[focusableElements.length - 1];\r\n\r\n      const handleTabKey = (e: KeyboardEvent) => {\r\n        if (e.key !== 'Tab') return;\r\n\r\n        if (e.shiftKey) {\r\n          if (document.activeElement === firstElement) {\r\n            lastElement.focus();\r\n            e.preventDefault();\r\n          }\r\n        } else {\r\n          if (document.activeElement === lastElement) {\r\n            firstElement.focus();\r\n            e.preventDefault();\r\n          }\r\n        }\r\n      };\r\n\r\n      container.addEventListener('keydown', handleTabKey);\r\n\r\n      // Return cleanup function\r\n      return () => {\r\n        container.removeEventListener('keydown', handleTabKey);\r\n      };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Keyboard navigation helpers\r\n   */\r\n  const keyboardNavigation = {\r\n    /**\r\n     * Handle arrow key navigation for lists\r\n     */\r\n    handleArrowNavigation: (\r\n      event: React.KeyboardEvent,\r\n      items: HTMLElement[],\r\n      currentIndex: number,\r\n      onIndexChange: (newIndex: number) => void\r\n    ) => {\r\n      let newIndex = currentIndex;\r\n\r\n      switch (event.key) {\r\n        case 'ArrowDown':\r\n          event.preventDefault();\r\n          newIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;\r\n          break;\r\n        case 'ArrowUp':\r\n          event.preventDefault();\r\n          newIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;\r\n          break;\r\n        case 'Home':\r\n          event.preventDefault();\r\n          newIndex = 0;\r\n          break;\r\n        case 'End':\r\n          event.preventDefault();\r\n          newIndex = items.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      onIndexChange(newIndex);\r\n      items[newIndex]?.focus();\r\n    },\r\n\r\n    /**\r\n     * Handle escape key to close modals/dropdowns\r\n     */\r\n    handleEscape: (event: React.KeyboardEvent, onEscape: () => void) => {\r\n      if (event.key === 'Escape') {\r\n        event.preventDefault();\r\n        onEscape();\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generate unique IDs for form elements\r\n   */\r\n  const generateId = useCallback((prefix: string = 'element') => {\r\n    return `${prefix}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }, []);\r\n\r\n  /**\r\n   * Check if user prefers reduced motion\r\n   */\r\n  const prefersReducedMotion = useCallback(() => {\r\n    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  }, []);\r\n\r\n  /**\r\n   * Get appropriate ARIA attributes for form validation\r\n   */\r\n  const getValidationAttributes = useCallback((\r\n    isValid: boolean,\r\n    errorMessage?: string,\r\n    describedById?: string\r\n  ) => {\r\n    const attributes: Record<string, string> = {};\r\n\r\n    if (!isValid) {\r\n      attributes['aria-invalid'] = 'true';\r\n      if (errorMessage && describedById) {\r\n        attributes['aria-describedby'] = describedById;\r\n      }\r\n    }\r\n\r\n    return attributes;\r\n  }, []);\r\n\r\n  return {\r\n    announceToScreenReader,\r\n    focusManagement,\r\n    keyboardNavigation,\r\n    generateId,\r\n    prefersReducedMotion,\r\n    getValidationAttributes,\r\n  };\r\n};\r\n","import React, { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { Upload, Play, Pause, X, AlertCircle, CheckCircle, Loader2, Volume2, Plus, Trash2, Files, File } from 'lucide-react';\r\nimport { convertAudioToWav } from '../services/audio';\r\nimport { uploadToAzureBlob } from '../services/azure';\r\nimport { apiService, PredictionPoller } from '../services/api';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { getStoredProcessingMode, setStoredProcessingMode, getUserId } from '../utils';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport type { PredictionResult, AppError, SessionMetadata } from '../types';\r\n\r\ninterface UploadProgress {\r\n  stage: 'idle' | 'starting' | 'initiating' | 'converting' | 'uploading' | 'submitting' | 'analyzing' | 'complete' | 'error';\r\n  progress: number;\r\n  message: string;\r\n  sessionId?: string; // Track session ID for status updates\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: Record<string, unknown>;\r\n    uploadedFileUrl?: string; // Track uploaded file for cleanup\r\n  };\r\n}\r\n\r\ninterface AudioFile {\r\n  id: string;\r\n  file: File;\r\n  url: string;\r\n  duration?: number;\r\n}\r\n\r\ninterface ProcessingProgress {\r\n  [fileId: string]: UploadProgress;\r\n}\r\n\r\ninterface FileResults {\r\n  [fileId: string]: AnalysisResult;\r\n}\r\n\r\ninterface FileProcessingState {\r\n  [fileId: string]: 'ready' | 'processing' | 'complete' | 'error';\r\n}\r\n\r\ninterface SessionInfo {\r\n  sessionId: string;\r\n  userId: string;\r\n}\r\n\r\ninterface AnalysisResult {\r\n  sessionId: string;\r\n  depressionScore?: number;\r\n  riskLevel?: 'low' | 'medium' | 'high';\r\n  confidence?: number;\r\n  insights?: string[];\r\n  timestamp: string;\r\n  audioUrl?: string;\r\n  rawApiResponse?: any; // Store the complete API response\r\n}\r\n\r\n// Interface for pre-filled data from re-run functionality\r\ninterface PrefilledSessionData {\r\n  userMetadata?: {\r\n    age?: number;\r\n    gender?: string;\r\n    race?: string;\r\n    ethnicity?: string;\r\n    language?: boolean;\r\n    weight?: number;\r\n    zipcode?: string;\r\n    sessionNotes?: string;\r\n  };\r\n  audioUrl?: string;\r\n  audioFileName?: string;\r\n  originalSessionId?: string;\r\n}\r\n\r\nconst UploadAnalyze: React.FC = () => {\r\n  // Auth context for user identification\r\n  const { user } = useAuth();\r\n  const location = useLocation();\r\n  \r\n  const [audioFiles, setAudioFiles] = useState<AudioFile[]>([]);\r\n  const [isMultiMode, setIsMultiMode] = useState(() => getStoredProcessingMode());\r\n  const [processingProgress, setProcessingProgress] = useState<ProcessingProgress>({});\r\n  const [results, setResults] = useState<FileResults>({});\r\n  const [fileStates, setFileStates] = useState<FileProcessingState>({});\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  \r\n  // Legacy single file state for backward compatibility\r\n  const [audioFile, setAudioFile] = useState<AudioFile | null>(null);\r\n  const [progress, setProgress] = useState<UploadProgress>({\r\n    stage: 'idle',\r\n    progress: 0,\r\n    message: ''\r\n  });\r\n  const [result, setResult] = useState<AnalysisResult | null>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [playingFileId, setPlayingFileId] = useState<string | null>(null);\r\n  \r\n  // Get pre-filled data from location state (for re-run functionality)\r\n  const prefilledData = location.state as PrefilledSessionData | undefined;\r\n  \r\n  const [userMetadata, setUserMetadata] = useState({\r\n    userId: '', // Will be auto-generated on component mount\r\n    age: prefilledData?.userMetadata?.age?.toString() || '',\r\n    gender: prefilledData?.userMetadata?.gender || '',\r\n    race: prefilledData?.userMetadata?.race || '',\r\n    ethnicity: prefilledData?.userMetadata?.ethnicity || '',\r\n    language: prefilledData?.userMetadata?.language?.toString() || '',\r\n    weight: prefilledData?.userMetadata?.weight?.toString() || '',\r\n    zipcode: prefilledData?.userMetadata?.zipcode || '',\r\n    sessionNotes: prefilledData?.userMetadata?.sessionNotes || ''\r\n  });\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [toasts, setToasts] = useState<Array<{\r\n    id: string;\r\n    type: 'error' | 'warning' | 'info' | 'success';\r\n    title: string;\r\n    message: string;\r\n    timestamp: number;\r\n  }>>([]);\r\n\r\n  // Validation state for real-time field validation\r\n  const [validationErrors, setValidationErrors] = useState<{\r\n    age?: string;\r\n    weight?: string;\r\n    zipcode?: string;\r\n    sessionNotes?: string;\r\n  }>({});\r\n\r\n  const [isCorrectingGrammar, setIsCorrectingGrammar] = useState(false);\r\n\r\n  // User ID management state - REMOVED (now part of metadata)\r\n  \r\n  // Auto-generate user ID when component loads (for form metadata)\r\n  useEffect(() => {\r\n    if (!userMetadata.userId) {\r\n      const newUserId = `user-${Date.now()}-${Math.random().toString(36).substr(2, 6)}`;\r\n      setUserMetadata(prev => ({ ...prev, userId: newUserId }));\r\n    }\r\n  }, [userMetadata.userId]);\r\n\r\n  // Helper function to get authenticated user ID for blob storage\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Toast utility functions\r\n  const addToast = useCallback((type: 'error' | 'warning' | 'info' | 'success', title: string, message: string) => {\r\n    const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n    const newToast = {\r\n      id,\r\n      type,\r\n      title,\r\n      message,\r\n      timestamp: Date.now()\r\n    };\r\n    setToasts(prev => [...prev, newToast]);\r\n    \r\n    // Auto-remove toast after 8 seconds for errors, 5 seconds for others\r\n    const duration = type === 'error' ? 8000 : 5000;\r\n    setTimeout(() => {\r\n      setToasts(prev => prev.filter(toast => toast.id !== id));\r\n    }, duration);\r\n  }, []);\r\n\r\n  const removeToast = useCallback((id: string) => {\r\n    setToasts(prev => prev.filter(toast => toast.id !== id));\r\n  }, []);\r\n\r\n  // Handle pre-filled data from re-run functionality\r\n  useEffect(() => {\r\n    if (prefilledData) {\r\n      // Show a toast to inform user that data has been pre-filled\r\n      addToast('info', 'Session Data Pre-filled', \r\n        `Metadata and audio file from session ${prefilledData.originalSessionId ? prefilledData.originalSessionId.slice(0, 8) + '...' : ''} have been loaded. Click \"Start Analysis\" to begin processing.`);\r\n      \r\n      // If there's an audio URL, create a virtual audio file entry\r\n      if (prefilledData.audioUrl && prefilledData.audioFileName) {\r\n        // Create a mock file object since we already have the URL\r\n        const mockFile = {\r\n          name: prefilledData.audioFileName,\r\n          size: 0,\r\n          type: 'audio/wav',\r\n          lastModified: Date.now(),\r\n          stream: () => new ReadableStream(),\r\n          arrayBuffer: () => Promise.resolve(new ArrayBuffer(0)),\r\n          text: () => Promise.resolve(''),\r\n          slice: () => new Blob()\r\n        } as File;\r\n\r\n        const virtualAudioFile: AudioFile = {\r\n          id: `prefilled-${Date.now()}`,\r\n          file: mockFile,\r\n          url: prefilledData.audioUrl,\r\n          duration: undefined\r\n        };\r\n        \r\n        if (isMultiMode) {\r\n          setAudioFiles([virtualAudioFile]);\r\n        } else {\r\n          setAudioFile(virtualAudioFile);\r\n        }\r\n      }\r\n    }\r\n  }, [prefilledData, addToast, isMultiMode]); // Include dependencies\r\n\r\n  const resetState = useCallback(() => {\r\n    setAudioFiles([]);\r\n    setAudioFile(null);\r\n    setProgress({ stage: 'idle', progress: 0, message: '' });\r\n    setResult(null);\r\n    setResults({});\r\n    setProcessingProgress({});\r\n    setError(null);\r\n    setIsPlaying(false);\r\n    setCurrentTime(0);\r\n    setPlayingFileId(null);\r\n    setIsProcessing(false);\r\n  }, []);\r\n\r\n  const generateFileId = () => {\r\n    return Date.now().toString() + Math.random().toString(36).substr(2, 9);\r\n  };\r\n\r\n  const addAudioFile = useCallback((file: File) => {\r\n    const id = generateFileId();\r\n    const url = URL.createObjectURL(file);\r\n    const audioFile: AudioFile = { id, file, url };\r\n    \r\n    if (isMultiMode) {\r\n      setAudioFiles(prev => [...prev, audioFile]);\r\n      setFileStates(prev => ({ ...prev, [id]: 'ready' }));\r\n      setProcessingProgress(prev => ({ ...prev, [id]: { stage: 'idle', progress: 0, message: 'Ready to process' } }));\r\n    } else {\r\n      setAudioFile(audioFile);\r\n    }\r\n    \r\n    announceToScreenReader(`Audio file selected: ${file.name}`);\r\n\r\n    // Get audio duration\r\n    const audio = new Audio(url);\r\n    audio.addEventListener('loadedmetadata', () => {\r\n      if (isMultiMode) {\r\n        setAudioFiles(prev => prev.map(af => \r\n          af.id === id ? { ...af, duration: audio.duration } : af\r\n        ));\r\n      } else {\r\n        setAudioFile(prev => prev ? { ...prev, duration: audio.duration } : null);\r\n      }\r\n    });\r\n  }, [isMultiMode, announceToScreenReader]);\r\n\r\n  const removeAudioFile = useCallback((fileId: string) => {\r\n    if (isMultiMode) {\r\n      setAudioFiles(prev => {\r\n        const fileToRemove = prev.find(f => f.id === fileId);\r\n        if (fileToRemove) {\r\n          URL.revokeObjectURL(fileToRemove.url);\r\n        }\r\n        return prev.filter(f => f.id !== fileId);\r\n      });\r\n      // Clean up associated progress, results, and states\r\n      setProcessingProgress(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n      setResults(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n      setFileStates(prev => {\r\n        const { [fileId]: removed, ...rest } = prev;\r\n        return rest;\r\n      });\r\n    }\r\n  }, [isMultiMode]);\r\n\r\n  const handleFileSelect = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = event.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    // Process multiple files or single file\r\n    Array.from(files).forEach(file => {\r\n      // Validate file type - check both MIME type and file extension\r\n      const supportedMimeTypes = [\r\n        'audio/wav', 'audio/wave', 'audio/x-wav',\r\n        'audio/mp3', 'audio/mpeg', 'audio/mp4',\r\n        'audio/m4a', 'audio/x-m4a', 'audio/mp4a-latm',\r\n        'audio/aac', 'audio/x-aac',\r\n        'audio/flac', 'audio/x-flac'\r\n      ];\r\n      \r\n      const fileName = file.name.toLowerCase();\r\n      const supportedExtensions = ['.wav', '.mp3', '.m4a', '.aac', '.flac'];\r\n      const hasValidExtension = supportedExtensions.some(ext => fileName.endsWith(ext));\r\n      const hasValidMimeType = supportedMimeTypes.includes(file.type);\r\n      \r\n      // Accept file if either MIME type OR extension is valid (some browsers don't set MIME types correctly)\r\n      if (!hasValidMimeType && !hasValidExtension) {\r\n        setError(`Unsupported file type for ${file.name}. Please select supported audio files (WAV, MP3, M4A, AAC, or FLAC)`);\r\n        addToast('error', 'Unsupported File', `${file.name} is not a supported audio file format`);\r\n        announceToScreenReader(`Error: Unsupported file format selected for ${file.name}`);\r\n        return;\r\n      }\r\n\r\n      // Validate file size (50MB limit)\r\n      const maxSize = 50 * 1024 * 1024;\r\n      if (file.size > maxSize) {\r\n        setError(`File ${file.name} is too large. File size must be less than 50MB`);\r\n        addToast('error', 'File Too Large', `${file.name} size must be less than 50MB`);\r\n        announceToScreenReader(`Error: File ${file.name} is too large`);\r\n        return;\r\n      }\r\n\r\n      addAudioFile(file);\r\n      setError(null);\r\n    });\r\n  }, [announceToScreenReader, addAudioFile, addToast]);\r\n\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  }, []);\r\n\r\n  const handleDrop = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    const files = e.dataTransfer.files;\r\n    if (files.length > 0) {\r\n      const mockEvent = { target: { files } } as React.ChangeEvent<HTMLInputElement>;\r\n      handleFileSelect(mockEvent);\r\n    }\r\n  }, [handleFileSelect]);\r\n\r\n  const toggleMode = useCallback(() => {\r\n    setIsMultiMode(prev => {\r\n      const newMode = !prev;\r\n      // Save to localStorage\r\n      setStoredProcessingMode(newMode);\r\n      // Clear files when switching modes\r\n      resetState();\r\n      return newMode;\r\n    });\r\n  }, [resetState]);\r\n\r\n  const handlePlayPause = useCallback(() => {\r\n    if (!audioRef.current) return;\r\n\r\n    if (isPlaying) {\r\n      audioRef.current.pause();\r\n      setIsPlaying(false);\r\n      announceToScreenReader('Audio paused');\r\n    } else {\r\n      audioRef.current.play();\r\n      setIsPlaying(true);\r\n      announceToScreenReader('Audio playing');\r\n    }\r\n  }, [isPlaying, announceToScreenReader]);\r\n\r\n  const handleTimeUpdate = useCallback(() => {\r\n    if (audioRef.current) {\r\n      setCurrentTime(audioRef.current.currentTime);\r\n    }\r\n  }, []);\r\n\r\n  const formatTime = useCallback((seconds: number): string => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  }, []);\r\n\r\n  const validateMetadata = useCallback(() => {\r\n    const errors: string[] = [];\r\n\r\n    // Age validation\r\n    if (userMetadata.age) {\r\n      const age = parseInt(userMetadata.age);\r\n      if (isNaN(age) || age < 18 || age > 130) {\r\n        errors.push('Age must be between 18 and 130');\r\n      }\r\n    }\r\n\r\n    // Gender validation\r\n    if (userMetadata.gender) {\r\n      const validGenders = ['male', 'female', 'non-binary', 'transgender female', 'transgender male', 'other', 'prefer'];\r\n      if (!validGenders.includes(userMetadata.gender)) {\r\n        errors.push('Invalid gender. Must be: male, female, non-binary, transgender female, transgender male, other, or prefer');\r\n      }\r\n    }\r\n\r\n    // Race validation\r\n    if (userMetadata.race) {\r\n      const validRaces = ['white', 'black or african-american', 'asian', 'american indian or alaskan native', 'native Hawaiian or pacific islander', 'two or more races', 'other', 'prefer not to say'];\r\n      if (!validRaces.includes(userMetadata.race)) {\r\n        errors.push('Invalid race. Must be: white, black or african-american, asian, american indian or alaskan native, native Hawaiian or pacific islander, two or more races, other, prefer not to say');\r\n      }\r\n    }\r\n\r\n    // Ethnicity validation\r\n    if (userMetadata.ethnicity) {\r\n      const validEthnicities = ['Hispanic, Latino, or Spanish Origin', 'Not Hispanic, Latino, or Spanish Origin'];\r\n      if (!validEthnicities.includes(userMetadata.ethnicity)) {\r\n        errors.push('Invalid ethnicity. Must be: Hispanic, Latino, or Spanish Origin | Not Hispanic, Latino, or Spanish Origin');\r\n      }\r\n    }\r\n\r\n    // Zipcode validation\r\n    if (userMetadata.zipcode) {\r\n      const zipcodeRegex = /^[a-zA-Z0-9]{1,10}$/;\r\n      if (!zipcodeRegex.test(userMetadata.zipcode)) {\r\n        errors.push('Zipcode must be alphanumeric and contain no more than 10 characters');\r\n      }\r\n    }\r\n\r\n    // Weight validation\r\n    if (userMetadata.weight) {\r\n      const weight = parseInt(userMetadata.weight);\r\n      if (isNaN(weight) || weight < 10 || weight > 1000) {\r\n        errors.push('Weight must be between 10 and 1000 pounds (lbs)');\r\n      }\r\n    }\r\n\r\n    return errors;\r\n  }, [userMetadata]);\r\n\r\n  // Individual field validation functions for real-time validation\r\n  const validateAge = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    const age = parseInt(value);\r\n    if (isNaN(age) || age < 18 || age > 130) {\r\n      return 'Age must be between 18 and 130';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateWeight = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    const weight = parseInt(value);\r\n    if (isNaN(weight) || weight < 10 || weight > 1000) {\r\n      return 'Weight must be between 10 and 1000 pounds (lbs)';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateZipcode = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    const zipcodeRegex = /^[a-zA-Z0-9]{1,10}$/;\r\n    if (!zipcodeRegex.test(value)) {\r\n      return 'Zipcode must be alphanumeric and contain no more than 10 characters';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  const validateSessionNotes = useCallback((value: string): string | undefined => {\r\n    if (!value) return undefined;\r\n    if (value.length > 500) {\r\n      return 'Session notes must be 500 characters or less';\r\n    }\r\n    return undefined;\r\n  }, []);\r\n\r\n  // Real-time field validation handler\r\n  const handleFieldValidation = useCallback((field: string, value: string) => {\r\n    let error: string | undefined;\r\n    \r\n    switch (field) {\r\n      case 'age':\r\n        error = validateAge(value);\r\n        break;\r\n      case 'weight':\r\n        error = validateWeight(value);\r\n        break;\r\n      case 'zipcode':\r\n        error = validateZipcode(value);\r\n        break;\r\n      case 'sessionNotes':\r\n        error = validateSessionNotes(value);\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    setValidationErrors(prev => {\r\n      const newErrors = {\r\n        ...prev,\r\n        [field]: error\r\n      };\r\n      \r\n      // Check if all validation errors are cleared\r\n      const hasAnyErrors = Object.values(newErrors).some(err => err !== undefined);\r\n      \r\n      // Clear global error if no field validation errors exist, or if this specific field error was cleared\r\n      // and the global error contains validation messages\r\n      if (!hasAnyErrors) {\r\n        setError(null);\r\n      } else if (error === undefined) {\r\n        // If this specific field error was cleared, check if global error is validation-related and clear it\r\n        setError(prevError => {\r\n          if (prevError && prevError.toLowerCase().includes('validation')) {\r\n            return null;\r\n          }\r\n          return prevError;\r\n        });\r\n      }\r\n      \r\n      return newErrors;\r\n    });\r\n  }, [validateAge, validateWeight, validateZipcode, validateSessionNotes]);\r\n\r\n  const handleGrammarCorrection = useCallback(async () => {\r\n    if (!userMetadata.sessionNotes.trim()) {\r\n      return;\r\n    }\r\n\r\n    setIsCorrectingGrammar(true);\r\n    try {\r\n      const response = await apiService.correctGrammar(userMetadata.sessionNotes);\r\n      \r\n      // Update the session notes with the corrected text\r\n      setUserMetadata(prev => ({\r\n        ...prev,\r\n        sessionNotes: response.correctedText\r\n      }));\r\n      \r\n      // Show success toast\r\n      addToast('success', 'Grammar Corrected', 'Grammar and spelling corrected successfully');\r\n      \r\n    } catch (error) {\r\n      console.error('Grammar correction failed:', error);\r\n      const appError = error as AppError;\r\n      \r\n      // Show error toast\r\n      addToast('error', 'Grammar Correction Failed', appError.message || 'Failed to correct grammar. Please try again.');\r\n    } finally {\r\n      setIsCorrectingGrammar(false);\r\n    }\r\n  }, [userMetadata.sessionNotes]);\r\n\r\n  const buildMetadata = useCallback(() => {\r\n    const metadata: Partial<SessionMetadata> = {};\r\n    let hasMetadata = false;\r\n\r\n    if (userMetadata.age) {\r\n      metadata.age = parseInt(userMetadata.age);\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.gender) {\r\n      metadata.gender = userMetadata.gender as SessionMetadata['gender'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.race) {\r\n      metadata.race = userMetadata.race as SessionMetadata['race'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.ethnicity) {\r\n      metadata.ethnicity = userMetadata.ethnicity as SessionMetadata['ethnicity'];\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.language === 'true' || userMetadata.language === 'false') {\r\n      metadata.language = userMetadata.language === 'true';\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.weight) {\r\n      metadata.weight = parseInt(userMetadata.weight);\r\n      hasMetadata = true;\r\n    }\r\n    if (userMetadata.zipcode) {\r\n      metadata.zipcode = userMetadata.zipcode;\r\n      hasMetadata = true;\r\n    }\r\n\r\n    return hasMetadata ? metadata : undefined;\r\n  }, [userMetadata]);\r\n\r\n  const processAndAnalyze = useCallback(async () => {\r\n    if (isMultiMode) {\r\n      if (audioFiles.length === 0 || !userMetadata.userId.trim()) {\r\n        setError('Please select audio files. User ID is automatically generated.');\r\n        addToast('error', 'Missing Information', 'Please select audio files. User ID is automatically generated.');\r\n        return;\r\n      }\r\n      await processMultipleFiles();\r\n    } else {\r\n      if (!audioFile || !userMetadata.userId.trim()) {\r\n        setError('Please select an audio file. User ID is automatically generated.');\r\n        addToast('error', 'Missing Information', 'Please select an audio file. User ID is automatically generated.');\r\n        return;\r\n      }\r\n      await processSingleFile();\r\n    }\r\n  }, [audioFile, audioFiles, userMetadata.userId, isMultiMode]);\r\n\r\n  const processSingleFileById = useCallback(async (fileId: string, audioFile: AudioFile) => {\r\n    try {\r\n      // Step 1: Initiate session\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'initiating', progress: 5, message: 'Initiating session...' }\r\n      }));\r\n\r\n      const metadata = buildMetadata();\r\n      const sessionRequest: any = {\r\n        userid: userMetadata.userId.trim(),\r\n        is_initiated: true\r\n      };\r\n\r\n      // Only include metadata if we have any\r\n      if (metadata) {\r\n        sessionRequest.metadata = metadata;\r\n      }\r\n\r\n      const sessionResponse = await apiService.initiateSession(sessionRequest);\r\n\r\n      const sessionData: SessionInfo = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: userMetadata.userId.trim()\r\n      };\r\n\r\n      // Save initial session data to blob storage so it appears in Analysis Sessions UI\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'initiating', progress: 10, message: 'Saving session data...', sessionId: sessionResponse.sessionId }\r\n      }));\r\n\r\n      const initialSessionData = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: getAuthenticatedUserId(), // Use authenticated user ID for session filtering/access control\r\n        metadata_user_id: userMetadata.userId.trim(), // Store metadata user ID separately\r\n        ...(metadata && { userMetadata: metadata }), // Only include userMetadata if metadata exists\r\n        audioFileName: audioFile.file.name,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        status: 'initiated'\r\n      };\r\n\r\n      try {\r\n        console.log('Attempting to save session data (multi-file):', initialSessionData);\r\n        const saveResult = await apiService.saveSessionData(initialSessionData);\r\n        console.log('Session data saved successfully (multi-file):', saveResult);\r\n      } catch (error) {\r\n        console.error('Failed to save session data (multi-file):', error);\r\n        console.error('Session data that failed to save:', initialSessionData);\r\n        addToast('warning', 'Session Save Warning', 'Session data could not be saved to storage, but processing will continue.');\r\n        // Continue with the process even if saving fails\r\n        // This is not critical for the main workflow, but user should be informed\r\n      }\r\n\r\n      let audioUrl: string;\r\n      let fileName: string;\r\n\r\n      // Check if this is a pre-filled session with existing audio URL (re-run scenario)\r\n      // Ensure the URL is a valid Azure Storage URL, not a blob URL\r\n      if (audioFile.url && !audioFile.url.startsWith('blob:')) {\r\n        // Skip conversion and upload for re-run - audio is already processed and stored\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'uploading', progress: 40, message: 'Using existing audio file from previous session...' }\r\n        }));\r\n        \r\n        audioUrl = audioFile.url;\r\n        fileName = audioFile.file.name;\r\n        \r\n        // Skip to 65% progress since conversion and upload are not needed\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'submitting', progress: 65, message: 'Submitting for analysis...' }\r\n        }));\r\n      } else {\r\n        // Normal flow: convert and upload new audio file\r\n        // This includes the case where audioFile.url is a blob URL (invalid for backend)\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'converting', progress: 15, message: 'Converting audio to required format...' }\r\n        }));\r\n\r\n        // Step 2: Convert audio using FFmpeg\r\n        const convertedBlob = await convertAudioToWav(audioFile.file, (progressPercent: number) => {\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [fileId]: {\r\n              stage: 'converting',\r\n              progress: 15 + (progressPercent * 0.25), // 15-40% for conversion\r\n              message: `Converting audio... ${Math.round(progressPercent)}%`\r\n            }\r\n          }));\r\n        });\r\n\r\n        setProcessingProgress(prev => ({\r\n          ...prev,\r\n          [fileId]: { stage: 'uploading', progress: 40, message: 'Uploading to Azure Blob Storage...' }\r\n        }));\r\n\r\n        // Step 3: Upload to Azure Blob Storage\r\n        fileName = `${userMetadata.userId}_${sessionData.sessionId}_${Date.now()}.wav`;\r\n        audioUrl = await uploadToAzureBlob(convertedBlob, fileName, (progressPercent: number) => {\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [fileId]: {\r\n              stage: 'uploading',\r\n              progress: 40 + (progressPercent * 0.25), // 40-65% for upload\r\n              message: `Uploading... ${Math.round(progressPercent)}%`\r\n            }\r\n          }));\r\n        }, getAuthenticatedUserId()); // Use authenticated user ID for blob storage folder structure\r\n      }\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'submitting', progress: 65, message: 'Submitting for analysis...' }\r\n      }));\r\n\r\n      // Update session data with audio information\r\n      try {\r\n        const updatedSessionData = {\r\n          ...initialSessionData,\r\n          audioUrl: audioUrl,\r\n          audioFileName: fileName,\r\n          status: 'processing',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n        await apiService.updateSessionData(sessionData.sessionId, updatedSessionData);\r\n      } catch (error) {\r\n        console.warn('Failed to update session data with audio info:', error);\r\n        // Continue with the process even if updating fails\r\n      }\r\n\r\n      // Step 4: Submit prediction with URL to /predictions/submit endpoint\r\n      await apiService.submitPrediction({\r\n        userId: userMetadata.userId.trim(),\r\n        sessionid: sessionData.sessionId,\r\n        audioFileUrl: audioUrl,\r\n        audioFileName: fileName\r\n      });\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'analyzing', progress: 70, message: 'Analyzing audio with Kintsugi Health API...' }\r\n      }));\r\n\r\n      // Step 5: Poll for results\r\n      const poller = new PredictionPoller(sessionData.sessionId);\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        poller.start(\r\n          (result: PredictionResult) => {\r\n            // Update progress during polling\r\n            const progressPercent = result.status === 'processing' ? 80 : \r\n                                  result.status === 'success' ? 95 : 70;\r\n            setProcessingProgress(prev => ({\r\n              ...prev,\r\n              [fileId]: { \r\n                stage: 'analyzing', \r\n                progress: progressPercent, \r\n                message: `Analysis ${result.status}...` \r\n              }\r\n            }));\r\n\r\n            // Check for predict_error and show toast\r\n            if (result.predictError) {\r\n              addToast('error', 'Prediction Error', \r\n                `${result.predictError.error}: ${result.predictError.message}`);\r\n            }\r\n          },\r\n          (result: PredictionResult) => {\r\n            // Check for final errors before completing\r\n            if (result.predictError) {\r\n              addToast('error', 'Analysis Failed', \r\n                `The analysis completed with an error: ${result.predictError.error} - ${result.predictError.message}`);\r\n              setProcessingProgress(prev => ({\r\n                ...prev,\r\n                [fileId]: { stage: 'error', progress: 0, message: 'Analysis failed with errors' }\r\n              }));\r\n              reject(new Error(`Prediction error: ${result.predictError.error}`));\r\n              return;\r\n            }\r\n\r\n            // Analysis complete successfully\r\n            const analysisResult: AnalysisResult = {\r\n              sessionId: sessionData.sessionId,\r\n              depressionScore: result.predictedScoreDepression ? parseFloat(result.predictedScoreDepression) : 0,\r\n              riskLevel: result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.7 ? 'high' :\r\n                        result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.4 ? 'medium' : 'low',\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n              insights: [\r\n                'Analysis completed using Kintsugi Health API',\r\n                result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                'Results should be reviewed by a qualified healthcare professional'\r\n              ].filter(insight => insight.trim() !== ''),\r\n              timestamp: result.updatedAt,\r\n              audioUrl: audioUrl,\r\n              rawApiResponse: result // Store the complete API response\r\n            };\r\n            \r\n            // Update session data with final analysis results (fire-and-forget)\r\n            const finalSessionData = {\r\n              ...initialSessionData,\r\n              audioUrl: audioUrl,\r\n              prediction: result, // Store the complete API response\r\n              analysisResults: {\r\n                depressionScore: result.predictedScoreDepression ? parseFloat(result.predictedScoreDepression) : undefined,\r\n                anxietyScore: result.predictedScoreAnxiety ? parseFloat(result.predictedScoreAnxiety) : undefined,\r\n                riskLevel: result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.7 ? 'high' :\r\n                          result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.4 ? 'medium' : 'low',\r\n                confidence: 0.85, // This would come from the API in a real scenario\r\n                insights: [\r\n                  'Analysis completed using Kintsugi Health API',\r\n                  result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                  result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                  'Results should be reviewed by a qualified healthcare professional'\r\n                ].filter(insight => insight.trim() !== ''),\r\n                completedAt: new Date().toISOString()\r\n              },\r\n              status: 'completed',\r\n              completedAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString()\r\n            };\r\n            \r\n            // Save analysis results to session storage (async, non-blocking)\r\n            apiService.saveSessionData(finalSessionData)\r\n              .then((result) => {\r\n                console.log('Multi-file session data saved with analysis results for session:', sessionData.sessionId);\r\n                console.log('Save result:', result);\r\n                addToast('success', 'Session Saved', 'Analysis results have been saved to session storage.');\r\n              })\r\n              .catch((error) => {\r\n                console.error('Failed to save multi-file analysis results to session storage:', error);\r\n                console.error('Session data that failed to save:', finalSessionData);\r\n                addToast('warning', 'Save Warning', 'Analysis completed but failed to save to session storage. Results are still available.');\r\n              });\r\n              \r\n            setProcessingProgress(prev => ({\r\n              ...prev,\r\n              [fileId]: { stage: 'complete', progress: 100, message: 'Analysis complete!' }\r\n            }));\r\n            setResults(prev => ({\r\n              ...prev,\r\n              [fileId]: analysisResult\r\n            }));\r\n            resolve();\r\n          },\r\n          (error: AppError) => {\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n\r\n    } catch (err) {\r\n      console.error(`Error processing file ${fileId}:`, err);\r\n      \r\n      // Extract error details for enhanced error display\r\n      let errorCode = 'UNKNOWN_ERROR';\r\n      let errorMessage = 'An unexpected error occurred';\r\n      let errorDetails: Record<string, unknown> = {};\r\n\r\n      if (err && typeof err === 'object') {\r\n        // Handle AppError interface\r\n        if ('code' in err && typeof err.code === 'string') {\r\n          errorCode = err.code;\r\n        }\r\n        if ('message' in err && typeof err.message === 'string') {\r\n          errorMessage = err.message;\r\n        }\r\n        if ('details' in err && typeof err.details === 'object') {\r\n          errorDetails = err.details as Record<string, unknown>;\r\n        }\r\n      } else if (err instanceof Error) {\r\n        errorMessage = err.message;\r\n        errorCode = err.name || 'ERROR';\r\n      }\r\n\r\n      // Update session status to failed if session was created\r\n      try {\r\n        // Try to find the session data from the processing progress or session context\r\n        const currentProgress = processingProgress[fileId];\r\n        if (currentProgress && currentProgress.sessionId) {\r\n          // Update session status to failed\r\n          const failedSessionData = {\r\n            sessionId: currentProgress.sessionId,\r\n            userId: getAuthenticatedUserId(),\r\n            metadata_user_id: userMetadata.userId.trim(),\r\n            audioFileName: audioFile.file.name,\r\n            createdAt: new Date().toISOString(), // Set as current time since we don't have original\r\n            status: 'failed',\r\n            updatedAt: new Date().toISOString(),\r\n            error: {\r\n              code: errorCode,\r\n              message: errorMessage,\r\n              details: errorDetails\r\n            }\r\n          };\r\n          \r\n          await apiService.updateSessionData(currentProgress.sessionId, failedSessionData);\r\n          console.log(`Updated session ${currentProgress.sessionId} status to failed`);\r\n        }\r\n      } catch (updateError) {\r\n        console.error('Failed to update session status to failed:', updateError);\r\n      }\r\n\r\n      // Attempt to find and cleanup uploaded file if it exists\r\n      // The file name should follow the pattern we used: `${userMetadata.userId}_${sessionId}_${timestamp}.wav`\r\n      try {\r\n        // Try to extract session ID from error context or generate cleanup pattern\r\n        const currentProgress = processingProgress[fileId];\r\n        if (currentProgress && (currentProgress.stage === 'uploading' || \r\n                              currentProgress.stage === 'submitting' || \r\n                              currentProgress.stage === 'analyzing')) {\r\n          // File was likely uploaded, attempt cleanup with pattern matching\r\n          const fileName = `${userMetadata.userId}_*_*.wav`; // Pattern for potential cleanup\r\n          // Note: In a real implementation, you'd want to track the exact fileName\r\n          // For now, log the cleanup attempt\r\n          console.log(`Attempting cleanup for file pattern: ${fileName}`);\r\n        }\r\n      } catch (cleanupError) {\r\n        console.warn('Error during cleanup attempt:', cleanupError);\r\n      }\r\n\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { \r\n          stage: 'error', \r\n          progress: 0, \r\n          message: 'Processing failed',\r\n          error: {\r\n            code: errorCode,\r\n            message: errorMessage,\r\n            details: errorDetails\r\n          }\r\n        }\r\n      }));\r\n      throw err; // Re-throw to be handled by the calling function\r\n    }\r\n  }, [userMetadata.userId, buildMetadata, apiService, uploadToAzureBlob, convertAudioToWav, addToast]);\r\n\r\n  const processMultipleFiles = useCallback(async () => {\r\n    setIsProcessing(true);\r\n    setError(null);\r\n    \r\n    // Validate metadata once for all files\r\n    const validationErrors = validateMetadata();\r\n    if (validationErrors.length > 0) {\r\n      setError(`Validation error: ${validationErrors.join(', ')}`);\r\n      addToast('error', 'Validation Error', validationErrors.join(', '));\r\n      setIsProcessing(false);\r\n      return;\r\n    }\r\n\r\n    // Only process files that are in 'ready' state\r\n    const filesToProcess = audioFiles.filter(file => fileStates[file.id] === 'ready');\r\n    \r\n    if (filesToProcess.length === 0) {\r\n      addToast('info', 'No Files Ready', 'No files are ready to process');\r\n      setIsProcessing(false);\r\n      return;\r\n    }\r\n\r\n    const totalFiles = filesToProcess.length;\r\n    let completedFiles = 0;\r\n\r\n    try {\r\n      for (const audioFile of filesToProcess) {\r\n        completedFiles++;\r\n        addToast('info', 'Processing File', `Processing ${audioFile.file.name} (${completedFiles}/${totalFiles})`);\r\n        \r\n        // Set file state to processing\r\n        setFileStates(prev => ({ ...prev, [audioFile.id]: 'processing' }));\r\n        \r\n        try {\r\n          await processSingleFileById(audioFile.id, audioFile);\r\n          setFileStates(prev => ({ ...prev, [audioFile.id]: 'complete' }));\r\n          addToast('success', 'File Complete', `${audioFile.file.name} processed successfully`);\r\n        } catch (error) {\r\n          // Extract detailed error information\r\n          let errorCode = 'FILE_PROCESSING_ERROR';\r\n          let errorMessage = 'An unexpected error occurred';\r\n          let errorDetails: Record<string, unknown> = {};\r\n\r\n          if (error && typeof error === 'object') {\r\n            if ('code' in error && typeof error.code === 'string') {\r\n              errorCode = error.code;\r\n            }\r\n            if ('message' in error && typeof error.message === 'string') {\r\n              errorMessage = error.message;\r\n            }\r\n            if ('details' in error && typeof error.details === 'object') {\r\n              errorDetails = error.details as Record<string, unknown>;\r\n            }\r\n          } else if (error instanceof Error) {\r\n            errorMessage = error.message;\r\n            errorCode = error.name || 'ERROR';\r\n          }\r\n\r\n          addToast('error', 'File Failed', `Failed to process ${audioFile.file.name}: ${errorMessage}`);\r\n          \r\n          // Set error state for this file with detailed error information\r\n          setFileStates(prev => ({ ...prev, [audioFile.id]: 'error' }));\r\n          setProcessingProgress(prev => ({\r\n            ...prev,\r\n            [audioFile.id]: { \r\n              stage: 'error', \r\n              progress: 0, \r\n              message: `Failed: ${errorMessage}`,\r\n              error: {\r\n                code: errorCode,\r\n                message: errorMessage,\r\n                details: errorDetails\r\n              }\r\n            }\r\n          }));\r\n        }\r\n      }\r\n      \r\n      addToast('success', 'Batch Complete', `Processed ${completedFiles} file${completedFiles !== 1 ? 's' : ''}`);\r\n      announceToScreenReader(`Batch processing complete. ${completedFiles} files processed.`);\r\n    } catch (err) {\r\n      const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';\r\n      setError(errorMessage);\r\n      addToast('error', 'Batch Failed', errorMessage);\r\n      announceToScreenReader(`Error: ${errorMessage}`);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  }, [audioFiles, fileStates, validateMetadata, addToast, announceToScreenReader, processSingleFileById]);\r\n\r\n  const startSingleFile = useCallback(async (fileId: string) => {\r\n    const audioFile = audioFiles.find(f => f.id === fileId);\r\n    if (!audioFile) return;\r\n\r\n    // Validate metadata\r\n    const validationErrors = validateMetadata();\r\n    if (validationErrors.length > 0) {\r\n      setError(`Validation error: ${validationErrors.join(', ')}`);\r\n      addToast('error', 'Validation Error', validationErrors.join(', '));\r\n      return;\r\n    }\r\n\r\n    setFileStates(prev => ({ ...prev, [fileId]: 'processing' }));\r\n    \r\n    try {\r\n      await processSingleFileById(fileId, audioFile);\r\n      setFileStates(prev => ({ ...prev, [fileId]: 'complete' }));\r\n      addToast('success', 'File Complete', `${audioFile.file.name} processed successfully`);\r\n    } catch (error) {\r\n      console.error(`Error processing ${audioFile.file.name}:`, error);\r\n      const errorMessage = error instanceof Error ? error.message : 'An unexpected error occurred';\r\n      \r\n      addToast('error', 'File Failed', `Failed to process ${audioFile.file.name}: ${errorMessage}`);\r\n      setFileStates(prev => ({ ...prev, [fileId]: 'error' }));\r\n      setProcessingProgress(prev => ({\r\n        ...prev,\r\n        [fileId]: { stage: 'error', progress: 0, message: `Failed: ${errorMessage}` }\r\n      }));\r\n    }\r\n  }, [audioFiles, validateMetadata, addToast, processSingleFileById]);\r\n\r\n  const processSingleFile = useCallback(async () => {\r\n    if (!audioFile || !userMetadata.userId.trim()) {\r\n      setError('Please select an audio file. User ID is automatically generated.');\r\n      addToast('error', 'Missing Information', 'Please select an audio file. User ID is automatically generated.');\r\n      return;\r\n    }\r\n\r\n    // Validate metadata\r\n    const validationErrors = validateMetadata();\r\n    if (validationErrors.length > 0) {\r\n      setError(`Validation error: ${validationErrors.join(', ')}`);\r\n      addToast('error', 'Validation Error', validationErrors.join(', '));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setError(null);\r\n      \r\n      // Step 1: Initiate session\r\n      setProgress({ stage: 'initiating', progress: 5, message: 'Initiating session...' });\r\n      announceToScreenReader('Starting analysis process - initiating session');\r\n\r\n      const metadata = buildMetadata();\r\n      const sessionRequest: any = {\r\n        userid: userMetadata.userId.trim(),\r\n        is_initiated: true\r\n      };\r\n\r\n      // Only include metadata if we have any\r\n      if (metadata) {\r\n        sessionRequest.metadata = metadata;\r\n      }\r\n\r\n      const sessionResponse = await apiService.initiateSession(sessionRequest);\r\n\r\n      const sessionData: SessionInfo = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: userMetadata.userId.trim()\r\n      };\r\n\r\n      // Save initial session data to blob storage so it appears in Analysis Sessions UI\r\n      setProgress({ stage: 'initiating', progress: 10, message: 'Saving session data...' });\r\n\r\n      const initialSessionData = {\r\n        sessionId: sessionResponse.sessionId,\r\n        userId: getAuthenticatedUserId(), // Use authenticated user ID for session filtering/access control\r\n        metadata_user_id: userMetadata.userId.trim(), // Store metadata user ID separately\r\n        ...(metadata && { userMetadata: metadata }), // Only include userMetadata if metadata exists\r\n        audioFileName: audioFile.file.name,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString(),\r\n        status: 'initiated'\r\n      };\r\n\r\n      try {\r\n        console.log('Attempting to save session data (single-file):', initialSessionData);\r\n        const saveResult = await apiService.saveSessionData(initialSessionData);\r\n        console.log('Session data saved successfully (single-file):', saveResult);\r\n      } catch (error) {\r\n        console.error('Failed to save session data (single-file):', error);\r\n        console.error('Session data that failed to save:', initialSessionData);\r\n        addToast('warning', 'Session Save Warning', 'Session data could not be saved to storage, but processing will continue.');\r\n        // Continue with the process even if saving fails\r\n        // This is not critical for the main workflow, but user should be informed\r\n      }\r\n\r\n      let audioUrl: string;\r\n      let fileName: string;\r\n\r\n      // Check if this is a pre-filled session with existing audio URL (re-run scenario)\r\n      // Ensure the URL is a valid Azure Storage URL, not a blob URL\r\n      if (audioFile.url && !audioFile.url.startsWith('blob:')) {\r\n        // Skip conversion and upload for re-run - audio is already processed and stored\r\n        setProgress({ stage: 'uploading', progress: 40, message: 'Using existing audio file from previous session...' });\r\n        announceToScreenReader('Session created successfully, reusing previously processed audio file');\r\n        \r\n        audioUrl = audioFile.url;\r\n        fileName = audioFile.file.name;\r\n        \r\n        // Skip to 65% progress since conversion and upload are not needed\r\n        setProgress({ stage: 'submitting', progress: 65, message: 'Submitting for analysis...' });\r\n      } else {\r\n        // Normal flow: convert and upload new audio file\r\n        // This includes the case where audioFile.url is a blob URL (invalid for backend)\r\n        setProgress({ stage: 'converting', progress: 15, message: 'Converting audio to required format...' });\r\n        announceToScreenReader('Session created successfully, now converting audio');\r\n\r\n        // Step 2: Convert audio using FFmpeg\r\n        const convertedBlob = await convertAudioToWav(audioFile.file, (progressPercent: number) => {\r\n          setProgress({\r\n            stage: 'converting',\r\n            progress: 15 + (progressPercent * 0.25), // 15-40% for conversion\r\n            message: `Converting audio... ${Math.round(progressPercent)}%`\r\n          });\r\n        });\r\n\r\n        setProgress({ stage: 'uploading', progress: 40, message: 'Uploading to Azure Blob Storage...' });\r\n        announceToScreenReader('Audio converted successfully, now uploading');\r\n\r\n        // Step 3: Upload to Azure Blob Storage\r\n        fileName = `${userMetadata.userId}_${sessionData.sessionId}_${Date.now()}.wav`;\r\n        audioUrl = await uploadToAzureBlob(convertedBlob, fileName, (progressPercent: number) => {\r\n          setProgress({\r\n            stage: 'uploading',\r\n            progress: 40 + (progressPercent * 0.25), // 40-65% for upload\r\n            message: `Uploading... ${Math.round(progressPercent)}%`\r\n          });\r\n        }, getAuthenticatedUserId()); // Use authenticated user ID for blob storage folder structure\r\n      }\r\n\r\n      setProgress({ stage: 'submitting', progress: 65, message: 'Submitting for analysis...' });\r\n      announceToScreenReader('Upload complete, submitting for behavioral health analysis');\r\n\r\n      // Update session data with audio information\r\n      try {\r\n        const updatedSessionData = {\r\n          ...initialSessionData,\r\n          audioUrl: audioUrl,\r\n          audioFileName: fileName,\r\n          status: 'processing',\r\n          updatedAt: new Date().toISOString()\r\n        };\r\n        await apiService.updateSessionData(sessionData.sessionId, updatedSessionData);\r\n      } catch (error) {\r\n        console.warn('Failed to update session data with audio info:', error);\r\n        // Continue with the process even if updating fails\r\n      }\r\n\r\n      // Step 4: Submit prediction with URL to /predictions/submit endpoint\r\n      await apiService.submitPrediction({\r\n        userId: userMetadata.userId.trim(),\r\n        sessionid: sessionData.sessionId,\r\n        audioFileUrl: audioUrl,\r\n        audioFileName: fileName\r\n      });\r\n\r\n      setProgress({ stage: 'analyzing', progress: 70, message: 'Analyzing audio with Kintsugi Health API...' });\r\n      announceToScreenReader('Prediction submitted, analysis in progress');\r\n\r\n      // Step 5: Poll for results\r\n      const poller = new PredictionPoller(sessionData.sessionId);\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        poller.start(\r\n          (result: PredictionResult) => {\r\n            // Update progress during polling\r\n            const progressPercent = result.status === 'processing' ? 80 : \r\n                                  result.status === 'success' ? 95 : 70;\r\n            setProgress({ \r\n              stage: 'analyzing', \r\n              progress: progressPercent, \r\n              message: `Analysis ${result.status}...` \r\n            });\r\n\r\n            // Check for predict_error and show toast\r\n            if (result.predictError) {\r\n              addToast('error', 'Prediction Error', \r\n                `${result.predictError.error}: ${result.predictError.message}`);\r\n            }\r\n          },\r\n          (result: PredictionResult) => {\r\n            // Check for final errors before completing\r\n            if (result.predictError) {\r\n              addToast('error', 'Analysis Failed', \r\n                `The analysis completed with an error: ${result.predictError.error} - ${result.predictError.message}`);\r\n              setProgress({ stage: 'error', progress: 0, message: 'Analysis failed with errors' });\r\n              reject(new Error(`Prediction error: ${result.predictError.error}`));\r\n              return;\r\n            }\r\n\r\n            // Analysis complete successfully\r\n            const analysisResult: AnalysisResult = {\r\n              sessionId: sessionData.sessionId,\r\n              depressionScore: result.predictedScoreDepression ? parseFloat(result.predictedScoreDepression) : 0,\r\n              riskLevel: result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.7 ? 'high' :\r\n                        result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.4 ? 'medium' : 'low',\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n            insights: [\r\n              'Analysis completed using Kintsugi Health API',\r\n              result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n              result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n              'Results should be reviewed by a qualified healthcare professional'\r\n            ].filter(insight => insight.trim() !== ''),\r\n            timestamp: result.updatedAt,\r\n            audioUrl: audioUrl,\r\n            rawApiResponse: result // Store the complete API response\r\n          };\r\n          \r\n          // Update session data with final analysis results (fire-and-forget)\r\n          const finalSessionData = {\r\n            ...initialSessionData,\r\n            audioUrl: audioUrl,\r\n            prediction: result, // Store the complete API response\r\n            analysisResults: {\r\n              depressionScore: result.predictedScoreDepression ? parseFloat(result.predictedScoreDepression) : undefined,\r\n              anxietyScore: result.predictedScoreAnxiety ? parseFloat(result.predictedScoreAnxiety) : undefined,\r\n              riskLevel: result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.7 ? 'high' :\r\n                        result.predictedScoreDepression && parseFloat(result.predictedScoreDepression) > 0.4 ? 'medium' : 'low',\r\n              confidence: 0.85, // This would come from the API in a real scenario\r\n              insights: [\r\n                'Analysis completed using Kintsugi Health API',\r\n                result.predictedScoreDepression ? `Depression score: ${result.predictedScoreDepression}` : '',\r\n                result.predictedScoreAnxiety ? `Anxiety score: ${result.predictedScoreAnxiety}` : '',\r\n                'Results should be reviewed by a qualified healthcare professional'\r\n              ].filter(insight => insight.trim() !== ''),\r\n              completedAt: new Date().toISOString()\r\n            },\r\n            status: 'completed',\r\n            completedAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n          };\r\n          \r\n          // Save analysis results to session storage (async, non-blocking)\r\n          apiService.saveSessionData(finalSessionData)\r\n            .then((result) => {\r\n              console.log('Session data saved with analysis results for session:', sessionData.sessionId);\r\n              console.log('Save result:', result);\r\n              addToast('success', 'Session Saved', 'Analysis results have been saved to session storage.');\r\n            })\r\n            .catch((error) => {\r\n              console.error('Failed to save analysis results to session storage:', error);\r\n              console.error('Session data that failed to save:', finalSessionData);\r\n              addToast('warning', 'Save Warning', 'Analysis completed but failed to save to session storage. Results are still available.');\r\n            });\r\n            \r\n          setProgress({ stage: 'complete', progress: 100, message: 'Analysis complete!' });\r\n          setResult(analysisResult);\r\n          addToast('success', 'Analysis Complete', 'Your behavioral health analysis has been completed successfully.');\r\n          announceToScreenReader('Behavioral health analysis completed successfully');\r\n          resolve();\r\n          },\r\n          (error: AppError) => {\r\n            addToast('error', 'Analysis Error', error.message || 'An unexpected error occurred during analysis.');\r\n            reject(error);\r\n          }\r\n        );\r\n      });\r\n\r\n    } catch (err) {\r\n      console.error('Processing error:', err);\r\n      const errorMessage = err instanceof Error ? err.message : 'An unexpected error occurred';\r\n      setError(errorMessage);\r\n      setProgress({ stage: 'error', progress: 0, message: 'Processing failed' });\r\n      addToast('error', 'Processing Failed', errorMessage);\r\n      announceToScreenReader(`Error: ${errorMessage}`);\r\n    }\r\n  }, [audioFile, userMetadata.userId, announceToScreenReader, validateMetadata, buildMetadata]);\r\n\r\n  const getProgressColor = useCallback((stage: string) => {\r\n    switch (stage) {\r\n      case 'error': return 'processing-progress__fill--error';\r\n      case 'complete': return 'processing-progress__fill--success';\r\n      default: return ''; // Use default blue color from CSS\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6 space-y-8\">\r\n      {/* Header with Dark Mode Toggle and Mode Switcher */}\r\n      <div className=\"text-center\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          {/* Mode Switcher */}\r\n          <div className=\"flex items-center space-x-4\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Processing Mode:</span>\r\n              <div className=\"relative inline-flex items-center\">\r\n                <button type=\"button\"\r\n                  onClick={toggleMode}\r\n                  className={`relative inline-flex h-8 w-16 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 ${\r\n                    isMultiMode \r\n                      ? 'bg-blue-600 hover:bg-blue-700' \r\n                      : 'bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-500'\r\n                  }`}\r\n                  aria-label={`Switch to ${isMultiMode ? 'single file' : 'multi-file'} mode`}\r\n                >\r\n                  <span\r\n                    className={`inline-flex h-6 w-6 transform rounded-full bg-white items-center justify-center transition-transform ${\r\n                      isMultiMode ? 'translate-x-9' : 'translate-x-1'\r\n                    }`}\r\n                  >\r\n                    {isMultiMode ? (\r\n                      <Files className=\"h-3 w-3 text-blue-600\" />\r\n                    ) : (\r\n                      <File className=\"h-3 w-3 text-gray-600\" />\r\n                    )}\r\n                  </span>\r\n                </button>\r\n                <div className=\"ml-3 flex items-center space-x-4\">\r\n                  <span className={`text-sm font-medium ${!isMultiMode ? 'text-gray-900 dark:text-white' : 'text-gray-500 dark:text-gray-400'}`}>\r\n                    Single\r\n                  </span>\r\n                  <span className={`text-sm font-medium ${isMultiMode ? 'text-gray-900 dark:text-white' : 'text-gray-500 dark:text-gray-400'}`}>\r\n                    Multi\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Status Badge */}\r\n            <div className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${\r\n              isMultiMode \r\n                ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' \r\n                : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\r\n            }`}>\r\n              {isMultiMode ? (\r\n                <>\r\n                  <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  Batch Processing\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <svg className=\"w-3 h-3 mr-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                    <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                  Single File\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\r\n          Upload & Analyze Audio\r\n        </h1>\r\n        <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\r\n          Upload {isMultiMode ? 'multiple audio files' : 'an audio file'} for behavioral health analysis using AI-powered speech pattern recognition\r\n        </p>\r\n        \r\n        {/* Mode Description */}\r\n        <div className={`inline-flex items-center px-4 py-2 rounded-lg text-sm ${\r\n          isMultiMode \r\n            ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300' \r\n            : 'bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-300'\r\n        }`}>\r\n          {isMultiMode ? (\r\n            <>\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path d=\"M9 12a1 1 0 000 2h2a1 1 0 100-2H9z\" />\r\n                <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Process multiple files with individual controls and batch options\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Upload and analyze one file at a time with detailed progress tracking\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* User Metadata Form */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Patient Information (Optional)\r\n        </h2>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          <div>\r\n            <label htmlFor=\"userId\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              User ID (Auto-generated, editable)\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"userId\"\r\n              value={userMetadata.userId}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, userId: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              placeholder=\"Auto-generated user ID\"\r\n            />\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n              Unique identifier for API calls. Auto-generated but can be customized.\r\n            </p>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"age\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Age\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              id=\"age\"\r\n              value={userMetadata.age}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, age: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('age', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('age', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('age', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.age \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Age in years\"\r\n              min=\"1\"\r\n              max=\"150\"\r\n              aria-describedby={validationErrors.age ? \"age-error\" : undefined}\r\n            />\r\n            {validationErrors.age && (\r\n              <p id=\"age-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.age}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"weight\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Weight\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              id=\"weight\"\r\n              value={userMetadata.weight}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, weight: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('weight', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('weight', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('weight', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.weight \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Weight in lbs\"\r\n              min=\"1\"\r\n              max=\"1000\"\r\n              aria-describedby={validationErrors.weight ? \"weight-error\" : undefined}\r\n            />\r\n            {validationErrors.weight && (\r\n              <p id=\"weight-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.weight}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Gender\r\n            </label>\r\n            <select\r\n              id=\"gender\"\r\n              value={userMetadata.gender}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, gender: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select gender</option>\r\n              <option value=\"male\">Male</option>\r\n              <option value=\"female\">Female</option>\r\n              <option value=\"non-binary\">Non-binary</option>\r\n              <option value=\"transgender female\">Transgender female</option>\r\n              <option value=\"transgender male\">Transgender male</option>\r\n              <option value=\"other\">Other</option>\r\n              <option value=\"prefer\">Prefer</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"race\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Race\r\n            </label>\r\n            <select\r\n              id=\"race\"\r\n              value={userMetadata.race}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, race: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select race</option>\r\n              <option value=\"white\">White</option>\r\n              <option value=\"black or african-american\">Black or African-American</option>\r\n              <option value=\"asian\">Asian</option>\r\n              <option value=\"american indian or alaskan native\">American Indian or Alaskan Native</option>\r\n              <option value=\"native Hawaiian or pacific islander\">Native Hawaiian or Pacific Islander</option>\r\n              <option value=\"two or more races\">Two or more races</option>\r\n              <option value=\"other\">Other</option>\r\n              <option value=\"prefer not to say\">Prefer not to say</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"ethnicity\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Ethnicity\r\n            </label>\r\n            <select\r\n              id=\"ethnicity\"\r\n              value={userMetadata.ethnicity}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, ethnicity: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select ethnicity</option>\r\n              <option value=\"Hispanic, Latino, or Spanish Origin\">Hispanic, Latino, or Spanish Origin</option>\r\n              <option value=\"Not Hispanic, Latino, or Spanish Origin\">Not Hispanic, Latino, or Spanish Origin</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"language\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Primary Language\r\n            </label>\r\n            <select\r\n              id=\"language\"\r\n              value={userMetadata.language}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, language: e.target.value }))}\r\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white\"\r\n            >\r\n              <option value=\"\">Select language</option>\r\n              <option value=\"true\">English</option>\r\n              <option value=\"false\">Other</option>\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"zipcode\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              ZIP Code\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"zipcode\"\r\n              value={userMetadata.zipcode}\r\n              onChange={(e) => {\r\n                const newValue = e.target.value;\r\n                setUserMetadata(prev => ({ ...prev, zipcode: newValue }));\r\n                // Trigger validation on change for immediate feedback\r\n                handleFieldValidation('zipcode', newValue);\r\n              }}\r\n              onBlur={(e) => handleFieldValidation('zipcode', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('zipcode', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.zipcode \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              placeholder=\"Enter ZIP code\"\r\n              pattern=\"[0-9]{5}(-[0-9]{4})?\"\r\n              title=\"Enter a valid ZIP code (e.g., 12345 or 12345-6789)\"\r\n              aria-describedby={validationErrors.zipcode ? \"zipcode-error\" : undefined}\r\n            />\r\n            {validationErrors.zipcode && (\r\n              <p id=\"zipcode-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.zipcode}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"md:col-span-2 lg:col-span-3\">\r\n            <label htmlFor=\"sessionNotes\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n              Session Notes\r\n            </label>\r\n            <textarea\r\n              id=\"sessionNotes\"\r\n              value={userMetadata.sessionNotes}\r\n              onChange={(e) => setUserMetadata(prev => ({ ...prev, sessionNotes: e.target.value }))}\r\n              onBlur={(e) => handleFieldValidation('sessionNotes', e.target.value)}\r\n              onKeyUp={(e) => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  handleFieldValidation('sessionNotes', e.currentTarget.value);\r\n                }\r\n              }}\r\n              className={`w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${\r\n                validationErrors.sessionNotes \r\n                  ? 'border-red-300 dark:border-red-600' \r\n                  : 'border-gray-300 dark:border-gray-600'\r\n              }`}\r\n              rows={3}\r\n              placeholder=\"Additional notes about this session or patient context\"\r\n              aria-describedby={validationErrors.sessionNotes ? \"sessionNotes-error\" : undefined}\r\n            />\r\n            {validationErrors.sessionNotes && (\r\n              <p id=\"sessionNotes-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\" role=\"alert\">\r\n                {validationErrors.sessionNotes}\r\n              </p>\r\n            )}\r\n            <div className=\"mt-1 flex items-center justify-between\">\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {userMetadata.sessionNotes.length}/500 characters\r\n              </p>\r\n              \r\n              {/* Grammar Correction Button - Next to character count */}\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => handleGrammarCorrection()}\r\n                disabled={!userMetadata.sessionNotes.trim() || isCorrectingGrammar}\r\n                className=\"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-blue-700 bg-blue-50 border border-blue-200 hover:bg-blue-100 hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 dark:text-blue-300 dark:bg-blue-900/20 dark:border-blue-700 dark:hover:bg-blue-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                aria-label=\"Correct grammar and spelling in session notes\"\r\n                title=\"Correct grammar and spelling\"\r\n              >\r\n                {isCorrectingGrammar ? (\r\n                  <Loader2 className=\"w-3.5 h-3.5 mr-1.5 animate-spin\" aria-hidden=\"true\" />\r\n                ) : (\r\n                  <svg \r\n                    className=\"w-3.5 h-3.5 mr-1.5\" \r\n                    fill=\"none\" \r\n                    stroke=\"currentColor\" \r\n                    viewBox=\"0 0 24 24\"\r\n                    aria-hidden=\"true\"\r\n                  >\r\n                    <path \r\n                      strokeLinecap=\"round\" \r\n                      strokeLinejoin=\"round\" \r\n                      strokeWidth={2} \r\n                      d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\" \r\n                    />\r\n                  </svg>\r\n                )}\r\n                {isCorrectingGrammar ? 'Correcting...' : 'Correct Grammar'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* File Upload Area */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\r\n          Audio File Upload {isMultiMode && <span className=\"text-sm font-normal text-gray-500 dark:text-gray-400\">(Multi-File Mode)</span>}\r\n        </h2>\r\n        \r\n        {(!isMultiMode && !audioFile) || (isMultiMode && audioFiles.length === 0) ? (\r\n          <div\r\n            className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors\"\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n          >\r\n            <Upload className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" aria-hidden=\"true\" />\r\n            <div className=\"mb-4\">\r\n              <button type=\"button\"\r\n                onClick={() => fileInputRef.current?.click()}\r\n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n              >\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Select Audio File{isMultiMode ? 's' : ''}\r\n              </button>\r\n              <p className=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\r\n                or drag and drop {isMultiMode ? 'files' : 'file'} here\r\n              </p>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n              Supported formats: WAV, MP3, M4A, AAC, FLAC (max 50MB each)\r\n              {isMultiMode && <br />}\r\n              {isMultiMode && 'You can select multiple files at once'}\r\n            </p>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              className=\"hidden\"\r\n              accept=\".wav,.mp3,.m4a,.aac,.flac,audio/*\"\r\n              onChange={handleFileSelect}\r\n              multiple={isMultiMode}\r\n              aria-label={`Select audio file${isMultiMode ? 's' : ''} for analysis`}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            {/* Single File Display */}\r\n            {!isMultiMode && audioFile && (\r\n              <div className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <Volume2 className=\"h-5 w-5 text-blue-500\" aria-hidden=\"true\" />\r\n                    <div>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">\r\n                        {audioFile.file.name}\r\n                      </p>\r\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                        {(audioFile.file.size / 1024 / 1024).toFixed(2)} MB\r\n                        {audioFile.duration && `  ${formatTime(audioFile.duration)}`}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <button type=\"button\"\r\n                    onClick={resetState}\r\n                    className=\"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                    aria-label=\"Remove selected file\"\r\n                  >\r\n                    <X className=\"h-5 w-5\" />\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Audio Player */}\r\n                <div className=\"space-y-3\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <button type=\"button\"\r\n                      onClick={handlePlayPause}\r\n                      className=\"flex items-center justify-center w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n                      aria-label={isPlaying ? 'Pause audio' : 'Play audio'}\r\n                    >\r\n                      {isPlaying ? (\r\n                        <Pause className=\"h-5 w-5\" aria-hidden=\"true\" />\r\n                      ) : (\r\n                        <Play className=\"h-5 w-5 ml-0.5\" aria-hidden=\"true\" />\r\n                      )}\r\n                    </button>\r\n                    <div className=\"flex-1\">\r\n                      {audioFile.duration && (\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          {formatTime(currentTime)} / {formatTime(audioFile.duration)}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {audioFile.duration && (\r\n                    <div className=\"audio-progress\">\r\n                      <div\r\n                        className=\"audio-progress__fill progress-animated\"\r\n                        style={{ width: `${(currentTime / audioFile.duration) * 100}%` }}\r\n                        role=\"progressbar\"\r\n                        aria-label=\"Audio playback progress\"\r\n                        aria-valuenow={currentTime}\r\n                        aria-valuemin={0}\r\n                        aria-valuemax={audioFile.duration}\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <audio\r\n                  ref={audioRef}\r\n                  src={audioFile.url}\r\n                  onTimeUpdate={handleTimeUpdate}\r\n                  onEnded={() => setIsPlaying(false)}\r\n                  onPlay={() => setIsPlaying(true)}\r\n                  onPause={() => setIsPlaying(false)}\r\n                  className=\"hidden\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Multi-File Display */}\r\n            {isMultiMode && audioFiles.length > 0 && (\r\n              <>\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-lg font-medium text-gray-900 dark:text-white\">\r\n                    Selected Files ({audioFiles.length})\r\n                  </h3>\r\n                  <button type=\"button\"\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                    className=\"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n                  >\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Add More Files\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  {audioFiles.map((file) => {\r\n                    const fileState = fileStates[file.id] || 'ready';\r\n                    const progress = processingProgress[file.id];\r\n                    \r\n                    return (\r\n                      <div key={file.id} className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4\">\r\n                        <div className=\"flex items-center justify-between mb-2\">\r\n                          <div className=\"flex items-center space-x-2 flex-1 min-w-0\">\r\n                            <Volume2 className=\"h-4 w-4 text-blue-500 flex-shrink-0\" aria-hidden=\"true\" />\r\n                            <div className=\"min-w-0 flex-1\">\r\n                              <p className=\"font-medium text-gray-900 dark:text-white truncate\">\r\n                                {file.file.name}\r\n                              </p>\r\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                {(file.file.size / 1024 / 1024).toFixed(2)} MB\r\n                                {file.duration && `  ${formatTime(file.duration)}`}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center space-x-2\">\r\n                            {/* Start button for individual file */}\r\n                            {fileState === 'ready' && (\r\n                              <button type=\"button\"\r\n                                onClick={() => startSingleFile(file.id)}\r\n                                className=\"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-offset-gray-800\"\r\n                                aria-label={`Start processing ${file.file.name}`}\r\n                              >\r\n                                <Play className=\"h-3 w-3 mr-1\" />\r\n                                Start\r\n                              </button>\r\n                            )}\r\n                            {fileState === 'processing' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\">\r\n                                Processing...\r\n                              </span>\r\n                            )}\r\n                            {fileState === 'complete' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\r\n                                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                                Complete\r\n                              </span>\r\n                            )}\r\n                            {fileState === 'error' && (\r\n                              <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\r\n                                <X className=\"h-3 w-3 mr-1\" />\r\n                                Error\r\n                              </span>\r\n                            )}\r\n                            <button type=\"button\"\r\n                              onClick={() => removeAudioFile(file.id)}\r\n                              className=\"p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400\"\r\n                              aria-label={`Remove ${file.file.name}`}\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                        \r\n                        {/* Processing status for this file */}\r\n                        {progress && (\r\n                          <div className=\"mt-2\">\r\n                            <div className=\"flex items-center justify-between text-xs\">\r\n                              <span className=\"text-gray-600 dark:text-gray-400\">\r\n                                {progress.message}\r\n                              </span>\r\n                              <span className=\"font-medium text-gray-900 dark:text-white\">\r\n                                {Math.round(progress.progress)}%\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"processing-progress mt-1\">\r\n                              <div\r\n                                className={`processing-progress__fill ${getProgressColor(progress.stage)}`}\r\n                                style={{ width: `${progress.progress}%` }}\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n\r\n                <input\r\n                  ref={fileInputRef}\r\n                  type=\"file\"\r\n                  className=\"hidden\"\r\n                  accept=\".wav,.mp3,.m4a,.aac,.flac,audio/*\"\r\n                  onChange={handleFileSelect}\r\n                  multiple={isMultiMode}\r\n                  aria-label=\"Select additional audio files for analysis\"\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\" role=\"alert\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"h-5 w-5 text-red-500 mr-2\" aria-hidden=\"true\" />\r\n            <span className=\"text-red-700 dark:text-red-300\">{error}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Progress Display - Only show in single-file mode */}\r\n      {!isMultiMode && progress.stage !== 'idle' && !result && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\r\n            Processing Status\r\n          </h3>\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                {progress.message}\r\n              </span>\r\n              <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                {Math.round(progress.progress)}%\r\n              </span>\r\n            </div>\r\n            <div className=\"processing-progress\">\r\n              <div\r\n                className={`processing-progress__fill progress-animated ${getProgressColor(progress.stage)}`}\r\n                style={{ width: `${progress.progress}%` }}\r\n                role=\"progressbar\"\r\n                aria-label=\"Processing progress\"\r\n                aria-valuenow={progress.progress}\r\n                aria-valuemin={0}\r\n                aria-valuemax={100}\r\n              />\r\n            </div>\r\n            {progress.stage === 'analyzing' && (\r\n              <div className=\"flex items-center text-sm text-gray-600 dark:text-gray-400\">\r\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" aria-hidden=\"true\" />\r\n                This may take a few minutes...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analysis Results */}\r\n      {result && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <CheckCircle className=\"h-6 w-6 text-green-500 mr-2\" aria-hidden=\"true\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Analysis Results\r\n            </h3>\r\n          </div>\r\n          \r\n          {/* Raw API Response */}\r\n          {result.rawApiResponse && (\r\n            <div className=\"mb-6\">\r\n              <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">API Response Details</h4>\r\n              <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 border\">\r\n                <div className=\"space-y-3\">\r\n                  {/* Predicted Scores */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Predicted Scores</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Depression:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.predicted_score_depression || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Anxiety:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.predicted_score_anxiety || 'N/A'}</span>\r\n                      </div>\r\n                      {/* Note: Overall predicted_score is deprecated and no longer displayed */}\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Status:</span>\r\n                        <span className={`font-mono ${result.rawApiResponse.status === 'success' ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>\r\n                          {result.rawApiResponse.status || 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Model Information */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Model Information</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Category:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.model_category || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Granularity:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white\">{result.rawApiResponse.model_granularity || 'N/A'}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Calibrated:</span>\r\n                        <span className={`font-mono ${result.rawApiResponse.is_calibrated ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}`}>\r\n                          {result.rawApiResponse.is_calibrated ? 'Yes' : 'No'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Actual Scores (if available) */}\r\n                  {result.rawApiResponse.actual_score && (\r\n                    <div>\r\n                      <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Clinical Assessment Scores</h5>\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                        {result.rawApiResponse.actual_score.depression_binary !== undefined && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Depression Binary:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.actual_score.depression_binary || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.anxiety_binary !== undefined && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Anxiety Binary:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.actual_score.anxiety_binary || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.phq_9 && result.rawApiResponse.actual_score.phq_9.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">PHQ-9:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.phq_9.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.phq_2 && result.rawApiResponse.actual_score.phq_2.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">PHQ-2:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.phq_2.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {result.rawApiResponse.actual_score.gad_7 && result.rawApiResponse.actual_score.gad_7.length > 0 && (\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">GAD-7:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              [{result.rawApiResponse.actual_score.gad_7.join(', ')}]\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Timestamps */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Timeline</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Created:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.rawApiResponse.created_at ? new Date(result.rawApiResponse.created_at).toLocaleString() : 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Updated:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.rawApiResponse.updated_at ? new Date(result.rawApiResponse.updated_at).toLocaleString() : 'N/A'}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Session Information */}\r\n                  <div>\r\n                    <h5 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Session Information</h5>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span className=\"text-gray-600 dark:text-gray-400\">Session ID:</span>\r\n                        <span className=\"font-mono text-gray-900 dark:text-white text-xs\">\r\n                          {result.sessionId}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Error Information (if present) */}\r\n                  {result.rawApiResponse.predict_error && (\r\n                    <div className=\"border-l-4 border-red-400 bg-red-50 dark:bg-red-900/20 p-3\">\r\n                      <h5 className=\"text-sm font-medium text-red-700 dark:text-red-300 mb-1\">Prediction Error</h5>\r\n                      <div className=\"text-sm space-y-1\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-red-600 dark:text-red-400\">Error Type:</span>\r\n                          <span className=\"font-mono text-red-900 dark:text-red-100\">{result.rawApiResponse.predict_error.error}</span>\r\n                        </div>\r\n                        <div className=\"text-red-700 dark:text-red-300\">\r\n                          <span className=\"font-medium\">Message:</span> {result.rawApiResponse.predict_error.message}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Raw JSON Toggle */}\r\n                  <details className=\"mt-4\">\r\n                    <summary className=\"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\">\r\n                      View Raw JSON Response\r\n                    </summary>\r\n                    <div className=\"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto\">\r\n                      <pre className=\"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">\r\n                        {JSON.stringify(result.rawApiResponse, null, 2)}\r\n                      </pre>\r\n                    </div>\r\n                  </details>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {result.insights && result.insights.length > 0 && (\r\n            <div className=\"mt-6\">\r\n              <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">Clinical Insights</h4>\r\n              <ul className=\"space-y-1\">\r\n                {result.insights.map((insight, index) => (\r\n                  <li key={index} className=\"text-gray-600 dark:text-gray-400 text-sm\">\r\n                     {insight}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"mt-6 flex space-x-3\">\r\n            <button type=\"button\"\r\n              onClick={resetState}\r\n              className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800\"\r\n            >\r\n              Analyze Another File\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analyze Button */}\r\n      {((isMultiMode && audioFiles.length > 0) || (!isMultiMode && audioFile)) && \r\n       !result && Object.keys(results).length === 0 && \r\n       progress.stage === 'idle' && !isProcessing && (\r\n        <div className=\"text-center\">\r\n          {isMultiMode ? (\r\n            // Multi-file mode controls\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n                <button type=\"button\"\r\n                  onClick={processMultipleFiles}\r\n                  disabled={audioFiles.length === 0 || !userMetadata.userId.trim() || \r\n                           !audioFiles.some(file => fileStates[file.id] === 'ready') ||\r\n                           !!error || Object.values(validationErrors).some(err => err !== undefined)}\r\n                  className=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800\"\r\n                >\r\n                  <Play className=\"h-5 w-5 mr-2\" aria-hidden=\"true\" />\r\n                  Start All Ready Files\r\n                  {audioFiles.filter(file => fileStates[file.id] === 'ready').length > 0 && \r\n                   ` (${audioFiles.filter(file => fileStates[file.id] === 'ready').length})`}\r\n                </button>\r\n              </div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                Use individual \"Start\" buttons on each file for selective processing, or \"Start All\" to process all ready files sequentially\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            // Single-file mode controls\r\n            <div>\r\n              <button type=\"button\"\r\n                onClick={processAndAnalyze}\r\n                disabled={!audioFile || !userMetadata.userId.trim() || \r\n                         !!error || Object.values(validationErrors).some(err => err !== undefined)}\r\n                className=\"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed dark:focus:ring-offset-gray-800\"\r\n              >\r\n                <Play className=\"h-5 w-5 mr-2\" aria-hidden=\"true\" />\r\n                Start Analysis\r\n              </button>\r\n              <p className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\r\n                This will convert, upload, and analyze your audio file\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Multi-File Results */}\r\n      {isMultiMode && Object.keys(results).length > 0 && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <CheckCircle className=\"h-6 w-6 text-green-500 mr-2\" aria-hidden=\"true\" />\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Batch Analysis Results ({Object.keys(results).length} files)\r\n            </h3>\r\n          </div>\r\n\r\n          <div className=\"space-y-6\">\r\n            {Object.entries(results).map(([fileId, result]) => {\r\n              const audioFile = audioFiles.find(f => f.id === fileId);\r\n              const progress = processingProgress[fileId];\r\n              \r\n              return (\r\n                <div key={fileId} className=\"border dark:border-gray-700 rounded-lg p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <h4 className=\"font-medium text-gray-900 dark:text-white\">\r\n                      {audioFile?.file.name || `File ${fileId}`}\r\n                    </h4>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      {progress?.stage === 'complete' && (\r\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\r\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                          Complete\r\n                        </span>\r\n                      )}\r\n                      {progress?.stage === 'error' && (\r\n                        <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\r\n                          <X className=\"h-3 w-3 mr-1\" />\r\n                          Error\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Error Details Section */}\r\n                  {progress?.stage === 'error' && progress?.error && (\r\n                    <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-3\">\r\n                      <div className=\"flex items-start\">\r\n                        <AlertCircle className=\"h-5 w-5 text-red-500 mr-3 mt-0.5 flex-shrink-0\" aria-hidden=\"true\" />\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"text-sm font-medium text-red-800 dark:text-red-200 mb-2\">\r\n                            Error Details\r\n                          </h4>\r\n                          <div className=\"space-y-2\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                              <div className=\"flex justify-between\">\r\n                                <span className=\"text-red-600 dark:text-red-400 font-medium\">Error Code:</span>\r\n                                <span className=\"font-mono text-red-900 dark:text-red-100\">{progress.error.code}</span>\r\n                              </div>\r\n                              <div className=\"flex justify-between\">\r\n                                <span className=\"text-red-600 dark:text-red-400 font-medium\">Error Message:</span>\r\n                                <span className=\"font-mono text-red-900 dark:text-red-100 text-right\">{progress.error.message}</span>\r\n                              </div>\r\n                            </div>\r\n                            {progress.error.details && Object.keys(progress.error.details).length > 0 && (\r\n                              <details className=\"mt-3\">\r\n                                <summary className=\"cursor-pointer text-sm font-medium text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100\">\r\n                                  View Additional Error Details\r\n                                </summary>\r\n                                <div className=\"mt-2 bg-red-100 dark:bg-red-900/40 rounded p-3 overflow-auto max-h-32\">\r\n                                  <pre className=\"text-xs text-red-800 dark:text-red-200 whitespace-pre-wrap\">\r\n                                    {JSON.stringify(progress.error.details, null, 2)}\r\n                                  </pre>\r\n                                </div>\r\n                              </details>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* API Response Summary for this file */}\r\n                  {result.rawApiResponse && (\r\n                    <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 border\">\r\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                        {/* Note: Overall predicted_score is deprecated */}\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-600 dark:text-gray-400\">Depression:</span>\r\n                          <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                            {result.rawApiResponse.predicted_score_depression || 'N/A'}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-600 dark:text-gray-400\">Anxiety:</span>\r\n                          <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                            {result.rawApiResponse.predicted_score_anxiety || 'N/A'}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                      \r\n                      {/* Session Info */}\r\n                      <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Session ID:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">{result.sessionId}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">Status:</span>\r\n                            <span className=\"font-mono text-gray-900 dark:text-white\">\r\n                              {result.rawApiResponse.status || 'N/A'}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Raw JSON Toggle for this file */}\r\n                      <details className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\r\n                        <summary className=\"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white\">\r\n                          View Raw JSON Response\r\n                        </summary>\r\n                        <div className=\"mt-2 bg-gray-100 dark:bg-gray-800 rounded p-3 overflow-auto max-h-64\">\r\n                          <pre className=\"text-xs text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">\r\n                            {JSON.stringify(result.rawApiResponse, null, 2)}\r\n                          </pre>\r\n                        </div>\r\n                      </details>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Audio Player for this file */}\r\n                  {audioFile && (\r\n                    <div className=\"mt-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <button type=\"button\"\r\n                          onClick={() => {\r\n                            const audio = document.getElementById(`audio-${fileId}`) as HTMLAudioElement;\r\n                            if (audio.paused) {\r\n                              // Pause all other audio elements first\r\n                              document.querySelectorAll('audio').forEach(a => a.pause());\r\n                              setPlayingFileId(fileId);\r\n                              audio.play();\r\n                            } else {\r\n                              audio.pause();\r\n                              setPlayingFileId(null);\r\n                            }\r\n                          }}\r\n                          className=\"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900\"\r\n                          aria-label={playingFileId === fileId ? 'Pause audio' : 'Play audio'}\r\n                        >\r\n                          {playingFileId === fileId ? (\r\n                            <Pause className=\"h-4 w-4\" />\r\n                          ) : (\r\n                            <Play className=\"h-4 w-4\" />\r\n                          )}\r\n                        </button>\r\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                          {audioFile.file.name}  {audioFile.duration ? `${Math.round(audioFile.duration)}s` : 'Duration unknown'}\r\n                        </span>\r\n                      </div>\r\n                      <audio\r\n                        id={`audio-${fileId}`}\r\n                        src={audioFile.url}\r\n                        onEnded={() => setPlayingFileId(null)}\r\n                        className=\"hidden\"\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toast Notifications */}\r\n      {toasts.length > 0 && (\r\n        <div className=\"fixed top-4 right-4 z-50 space-y-2\">\r\n          {toasts.map((toast) => (\r\n            <div\r\n              key={toast.id}\r\n              className={`max-w-sm w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg border-l-4 p-4 transition-all duration-300 transform ${\r\n                toast.type === 'error' ? 'border-red-500' :\r\n                toast.type === 'warning' ? 'border-yellow-500' :\r\n                toast.type === 'success' ? 'border-green-500' : 'border-blue-500'\r\n              }`}\r\n              role=\"alert\"\r\n            >\r\n              <div className=\"flex items-start\">\r\n                <div className=\"flex-shrink-0\">\r\n                  {toast.type === 'error' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-red-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'warning' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-yellow-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'success' && (\r\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                  {toast.type === 'info' && (\r\n                    <AlertCircle className=\"h-5 w-5 text-blue-500\" aria-hidden=\"true\" />\r\n                  )}\r\n                </div>\r\n                <div className=\"ml-3 flex-1\">\r\n                  <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {toast.title}\r\n                  </p>\r\n                  <p className=\"mt-1 text-sm text-gray-600 dark:text-gray-400\">\r\n                    {toast.message}\r\n                  </p>\r\n                </div>\r\n                <div className=\"ml-4 flex-shrink-0\">\r\n                  <button type=\"button\"\r\n                    onClick={() => removeToast(toast.id)}\r\n                    className=\"inline-flex text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    aria-label=\"Close notification\"\r\n                  >\r\n                    <X className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UploadAnalyze;\r\n","import React, { useState, useCallback, useMemo, useEffect } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { Search, Filter, ChevronDown, ChevronUp, Eye, Download, Trash2, RefreshCw, AlertCircle, CheckCircle, Clock, XCircle } from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { apiService } from '../services/api';\r\nimport { getUserId, formatRelativeTime, formatDateTime } from '../utils';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Session interface for UI with additional computed fields\r\ninterface SessionWithUI extends SessionData {\r\n  fileName?: string;\r\n  fileSize?: number;\r\n  uploadedAt: string;\r\n  riskLevel?: string;\r\n  depressionScore?: string;\r\n  anxietyScore?: string;\r\n}\r\n\r\n// Filter and sort types\r\ninterface SessionFilters {\r\n  search: string;\r\n  status: string | 'all';\r\n  dateRange: 'all' | 'today' | 'week' | 'month' | 'year';\r\n  sortBy: 'date' | 'status' | 'depressionScore' | 'anxietyScore';\r\n  sortOrder: 'asc' | 'desc';\r\n}\r\n\r\n// Status color mapping for accessibility\r\nconst statusConfig = {\r\n  queued: { color: 'yellow', icon: Clock, label: 'Queued' },\r\n  running: { color: 'blue', icon: RefreshCw, label: 'Processing' },\r\n  processing: { color: 'blue', icon: RefreshCw, label: 'Processing' },\r\n  succeeded: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  success: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  completed: { color: 'green', icon: CheckCircle, label: 'Completed' },\r\n  failed: { color: 'red', icon: XCircle, label: 'Failed' },\r\n  error: { color: 'red', icon: XCircle, label: 'Error' },\r\n} as const;\r\n\r\n// Utility function to format score categories\r\nconst formatScoreCategory = (category?: string): string => {\r\n  if (!category) return '';\r\n  return category\r\n    .replace(/_/g, ' ')\r\n    .replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n};\r\n\r\n// Utility function to get severity level for sorting\r\nconst getSeverityLevel = (category?: string): number => {\r\n  if (!category) return 0;\r\n  switch (category.toLowerCase()) {\r\n    // Depression categories: no_to_mild, mild_to_moderate, moderate_to_severe\r\n    case 'no_to_mild':\r\n      return 1;\r\n    case 'mild_to_moderate':\r\n      return 2;\r\n    case 'moderate_to_severe':\r\n      return 3;\r\n    // Anxiety categories: no_or_minimal, moderate, moderately_severe, severe\r\n    case 'no_or_minimal':\r\n      return 1;\r\n    case 'moderate':\r\n      return 2;\r\n    case 'moderately_severe':\r\n      return 3;\r\n    case 'severe':\r\n      return 4;\r\n    default:\r\n      return 0;\r\n  }\r\n};\r\n\r\nconst Sessions: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [sessions, setSessions] = useState<SessionWithUI[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [selectedSessions, setSelectedSessions] = useState<Set<string>>(new Set());\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [filters, setFilters] = useState<SessionFilters>({\r\n    search: '',\r\n    status: 'all',\r\n    dateRange: 'all',\r\n    sortBy: 'date',\r\n    sortOrder: 'desc',\r\n  });\r\n\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  // Load sessions from API\r\n  const loadSessions = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const userId = getAuthenticatedUserId(); // Use authenticated user ID to match blob storage folder structure\r\n      const response = await apiService.getUserSessions(userId);\r\n      \r\n      // Transform session data to include computed UI fields\r\n      const transformedSessions: SessionWithUI[] = response.sessions.map(session => {\r\n        // Handle both camelCase and snake_case property names from API\r\n        const prediction = session.prediction as any;\r\n        const analysisResults = session.analysisResults;\r\n        \r\n        return {\r\n          ...session,\r\n          uploadedAt: session.createdAt,\r\n          fileName: session.audioFileName || `Audio_${session.sessionId.slice(-8)}.wav`,\r\n          fileSize: Math.floor(Math.random() * 5000000) + 1000000, // Mock file size for now\r\n          riskLevel: analysisResults?.riskLevel || 'unknown',\r\n          // Prioritize analysisResults, then fall back to prediction data\r\n          depressionScore: analysisResults?.depressionScore?.toString() ||\r\n                          prediction?.predicted_score_depression || \r\n                          prediction?.predictedScoreDepression ||\r\n                          undefined,\r\n          anxietyScore: analysisResults?.anxietyScore?.toString() ||\r\n                       prediction?.predicted_score_anxiety || \r\n                       prediction?.predictedScoreAnxiety ||\r\n                       undefined,\r\n        };\r\n      });\r\n\r\n      setSessions(transformedSessions);\r\n      announceToScreenReader(`${transformedSessions.length} sessions loaded successfully`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading sessions: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Load sessions on component mount\r\n  useEffect(() => {\r\n    loadSessions();\r\n  }, [loadSessions]);\r\n\r\n  // Filter and sort sessions\r\n  const filteredAndSortedSessions = useMemo(() => {\r\n    let filtered = sessions;\r\n\r\n    // Search filter\r\n    if (filters.search) {\r\n      const searchLower = filters.search.toLowerCase();\r\n      filtered = filtered.filter(session => \r\n        session.sessionId.toLowerCase().includes(searchLower) ||\r\n        session.fileName?.toLowerCase().includes(searchLower) ||\r\n        statusConfig[session.status as keyof typeof statusConfig]?.label.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    // Status filter\r\n    if (filters.status !== 'all') {\r\n      filtered = filtered.filter(session => session.status === filters.status);\r\n    }\r\n\r\n    // Date range filter\r\n    if (filters.dateRange !== 'all') {\r\n      const now = new Date();\r\n      const startDate = new Date();\r\n      \r\n      switch (filters.dateRange) {\r\n        case 'today':\r\n          startDate.setHours(0, 0, 0, 0);\r\n          break;\r\n        case 'week':\r\n          startDate.setDate(now.getDate() - 7);\r\n          break;\r\n        case 'month':\r\n          startDate.setMonth(now.getMonth() - 1);\r\n          break;\r\n        case 'year':\r\n          startDate.setFullYear(now.getFullYear() - 1);\r\n          break;\r\n      }\r\n      \r\n      filtered = filtered.filter(session => \r\n        new Date(session.uploadedAt) >= startDate\r\n      );\r\n    }\r\n\r\n    // Sort\r\n    filtered.sort((a, b) => {\r\n      let comparison = 0;\r\n      \r\n      switch (filters.sortBy) {\r\n        case 'date':\r\n          comparison = new Date(a.uploadedAt).getTime() - new Date(b.uploadedAt).getTime();\r\n          break;\r\n        case 'status':\r\n          comparison = a.status.localeCompare(b.status);\r\n          break;\r\n        case 'depressionScore':\r\n          const depressionA = getSeverityLevel(a.depressionScore);\r\n          const depressionB = getSeverityLevel(b.depressionScore);\r\n          comparison = depressionA - depressionB;\r\n          break;\r\n        case 'anxietyScore':\r\n          const anxietyA = getSeverityLevel(a.anxietyScore);\r\n          const anxietyB = getSeverityLevel(b.anxietyScore);\r\n          comparison = anxietyA - anxietyB;\r\n          break;\r\n      }\r\n      \r\n      return filters.sortOrder === 'desc' ? -comparison : comparison;\r\n    });\r\n\r\n    return filtered;\r\n  }, [sessions, filters]);\r\n\r\n  // Handle filter changes\r\n  const updateFilter = useCallback((key: keyof SessionFilters, value: any) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n    announceToScreenReader(`Filter ${key} changed to ${value}`);\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle session selection\r\n  const toggleSessionSelection = useCallback((sessionId: string) => {\r\n    setSelectedSessions(prev => {\r\n      const newSelection = new Set(prev);\r\n      if (newSelection.has(sessionId)) {\r\n        newSelection.delete(sessionId);\r\n        announceToScreenReader('Session deselected');\r\n      } else {\r\n        newSelection.add(sessionId);\r\n        announceToScreenReader('Session selected');\r\n      }\r\n      return newSelection;\r\n    });\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle select all\r\n  const toggleSelectAll = useCallback(() => {\r\n    const allSelected = selectedSessions.size === filteredAndSortedSessions.length;\r\n    if (allSelected) {\r\n      setSelectedSessions(new Set());\r\n      announceToScreenReader('All sessions deselected');\r\n    } else {\r\n      setSelectedSessions(new Set(filteredAndSortedSessions.map(s => s.sessionId)));\r\n      announceToScreenReader(`All ${filteredAndSortedSessions.length} sessions selected`);\r\n    }\r\n  }, [selectedSessions.size, filteredAndSortedSessions, announceToScreenReader]);\r\n\r\n  // Handle individual session deletion\r\n  const handleDeleteSession = useCallback(async (sessionId: string) => {\r\n    const confirmed = window.confirm('Are you sure you want to delete this session? This action cannot be undone.');\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      await apiService.deleteSessionData(sessionId);\r\n      \r\n      // Remove from local state after successful API call\r\n      setSessions(prev => prev.filter(session => session.sessionId !== sessionId));\r\n      \r\n      // Remove from selection if it was selected\r\n      setSelectedSessions(prev => {\r\n        const newSelection = new Set(prev);\r\n        newSelection.delete(sessionId);\r\n        return newSelection;\r\n      });\r\n      \r\n      announceToScreenReader('Session deleted successfully');\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      announceToScreenReader(`Error deleting session: ${appError.message}`);\r\n      // Optionally show a toast or alert for the error\r\n      alert(`Failed to delete session: ${appError.message}`);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Handle individual session re-run - navigate to upload page with session data pre-filled\r\n  const handleRerunSession = useCallback(async (sessionId: string) => {\r\n    const confirmed = window.confirm('Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.');\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      // Find the session data to pass to upload page\r\n      const session = sessions.find(s => s.sessionId === sessionId);\r\n      if (!session) {\r\n        announceToScreenReader('Cannot re-run analysis: Session not found');\r\n        alert('Cannot re-run analysis: Session not found');\r\n        return;\r\n      }\r\n\r\n      announceToScreenReader('Redirecting to upload page for re-run...');\r\n      \r\n      // Navigate to upload page with session data\r\n      navigate('/upload', {\r\n        state: {\r\n          originalSessionId: session.sessionId,\r\n          audioFileName: session.audioFileName,\r\n          audioUrl: session.audioUrl,\r\n          userMetadata: session.userMetadata\r\n        }\r\n      });\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      announceToScreenReader(`Error preparing re-run: ${appError.message}`);\r\n      alert(`Failed to prepare re-run: ${appError.message}`);\r\n    }\r\n  }, [announceToScreenReader, sessions, navigate]);\r\n\r\n  // Handle bulk actions\r\n  const handleBulkDelete = useCallback(async () => {\r\n    if (selectedSessions.size === 0) return;\r\n    \r\n    const confirmed = window.confirm(`Are you sure you want to delete ${selectedSessions.size} session(s)? This action cannot be undone.`);\r\n    if (!confirmed) return;\r\n\r\n    const sessionIds = Array.from(selectedSessions);\r\n    let successCount = 0;\r\n    let failedSessions: string[] = [];\r\n\r\n    // Process deletions sequentially to avoid overwhelming the server\r\n    for (const sessionId of sessionIds) {\r\n      try {\r\n        await apiService.deleteSessionData(sessionId);\r\n        successCount++;\r\n      } catch (err) {\r\n        const appError = err as AppError;\r\n        failedSessions.push(sessionId);\r\n        console.error(`Failed to delete session ${sessionId}:`, appError.message);\r\n      }\r\n    }\r\n\r\n    // Remove successfully deleted sessions from local state\r\n    if (successCount > 0) {\r\n      setSessions(prev => prev.filter(session => {\r\n        const wasDeleted = selectedSessions.has(session.sessionId) && !failedSessions.includes(session.sessionId);\r\n        return !wasDeleted;\r\n      }));\r\n    }\r\n\r\n    // Clear selection\r\n    setSelectedSessions(new Set());\r\n\r\n    // Announce results\r\n    if (failedSessions.length === 0) {\r\n      announceToScreenReader(`${successCount} sessions deleted successfully`);\r\n    } else {\r\n      const message = `${successCount} sessions deleted successfully, ${failedSessions.length} failed`;\r\n      announceToScreenReader(message);\r\n      alert(`${message}. Failed sessions: ${failedSessions.join(', ')}`);\r\n    }\r\n  }, [selectedSessions, announceToScreenReader]);\r\n\r\n  // Format file size\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes === 0) return '0 B';\r\n    const k = 1024;\r\n    const sizes = ['B', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n  };\r\n\r\n  // Get status badge component\r\n  const StatusBadge: React.FC<{ status: string }> = ({ status }) => {\r\n    // For any unknown status that contains \"error\" or \"fail\", treat as error\r\n    const normalizedStatus = status.toLowerCase();\r\n    let config = statusConfig[status as keyof typeof statusConfig];\r\n    \r\n    if (!config) {\r\n      if (normalizedStatus.includes('error') || normalizedStatus.includes('fail')) {\r\n        config = statusConfig.error;\r\n      } else {\r\n        // Default to queued for unknown statuses instead of failed\r\n        config = statusConfig.queued;\r\n      }\r\n    }\r\n    \r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <span\r\n        className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n          config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n          config.color === 'blue' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\r\n          config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n          'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n        }`}\r\n        role=\"status\"\r\n        aria-label={`Status: ${config.label}`}\r\n      >\r\n        <Icon className=\"w-3 h-3 mr-1\" aria-hidden=\"true\" />\r\n        {config.label}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading sessions...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Sessions\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <button type=\"button\"\r\n                onClick={loadSessions}\r\n                className=\"mt-4 btn btn--primary\"\r\n                aria-label=\"Retry loading sessions\"\r\n              >\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            Analysis Sessions\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            View and manage your audio analysis sessions\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button type=\"button\"\r\n            onClick={loadSessions}\r\n            disabled={loading}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh sessions list\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <Link\r\n            to=\"/upload\"\r\n            className=\"btn btn--primary\"\r\n            aria-label=\"Start new analysis session\"\r\n          >\r\n            New Analysis\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters and Search */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <div className=\"flex flex-col lg:flex-row lg:items-center gap-4\">\r\n          {/* Search */}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <label htmlFor=\"search-sessions\" className=\"sr-only\">\r\n              Search sessions\r\n            </label>\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" aria-hidden=\"true\" />\r\n              <input\r\n                id=\"search-sessions\"\r\n                type=\"text\"\r\n                placeholder=\"Search by session ID, filename, or status...\"\r\n                value={filters.search}\r\n                onChange={(e) => updateFilter('search', e.target.value)}\r\n                className=\"form__input w-full pl-10 pr-4 py-2\"\r\n                aria-describedby=\"search-help\"\r\n              />\r\n            </div>\r\n            <p id=\"search-help\" className=\"sr-only\">\r\n              Search through your analysis sessions by ID, filename, or status\r\n            </p>\r\n          </div>\r\n\r\n          {/* Filter Toggle */}\r\n          <button type=\"button\"\r\n            onClick={() => setShowFilters(!showFilters)}\r\n            className=\"btn btn--secondary flex items-center\"\r\n            aria-expanded={showFilters}\r\n            aria-controls=\"filter-panel\"\r\n            aria-label={`${showFilters ? 'Hide' : 'Show'} filter options`}\r\n          >\r\n            <Filter className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Filters\r\n            {showFilters ? <ChevronUp className=\"w-4 h-4 ml-2\" aria-hidden=\"true\" /> : <ChevronDown className=\"w-4 h-4 ml-2\" aria-hidden=\"true\" />}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Expanded Filters */}\r\n        {showFilters && (\r\n          <div id=\"filter-panel\" className=\"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            {/* Status Filter */}\r\n            <div>\r\n              <label htmlFor=\"status-filter\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Status\r\n              </label>\r\n              <select\r\n                id=\"status-filter\"\r\n                value={filters.status}\r\n                onChange={(e) => updateFilter('status', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Statuses</option>\r\n                <option value=\"queued\">Queued</option>\r\n                <option value=\"processing\">Processing</option>\r\n                <option value=\"running\">Running</option>\r\n                <option value=\"succeeded\">Completed</option>\r\n                <option value=\"success\">Success</option>\r\n                <option value=\"completed\">Completed</option>\r\n                <option value=\"failed\">Failed</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Date Range Filter */}\r\n            <div>\r\n              <label htmlFor=\"date-filter\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Date Range\r\n              </label>\r\n              <select\r\n                id=\"date-filter\"\r\n                value={filters.dateRange}\r\n                onChange={(e) => updateFilter('dateRange', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Time</option>\r\n                <option value=\"today\">Today</option>\r\n                <option value=\"week\">Past Week</option>\r\n                <option value=\"month\">Past Month</option>\r\n                <option value=\"year\">Past Year</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Sort By */}\r\n            <div>\r\n              <label htmlFor=\"sort-by\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Sort By\r\n              </label>\r\n              <select\r\n                id=\"sort-by\"\r\n                value={filters.sortBy}\r\n                onChange={(e) => updateFilter('sortBy', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"date\">Date</option>\r\n                <option value=\"status\">Status</option>\r\n                <option value=\"depressionScore\">Depression Score</option>\r\n                <option value=\"anxietyScore\">Anxiety Score</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Sort Order */}\r\n            <div>\r\n              <label htmlFor=\"sort-order\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Sort Order\r\n              </label>\r\n              <select\r\n                id=\"sort-order\"\r\n                value={filters.sortOrder}\r\n                onChange={(e) => updateFilter('sortOrder', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"desc\">Newest First</option>\r\n                <option value=\"asc\">Oldest First</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Results Summary and Bulk Actions */}\r\n      {filteredAndSortedSessions.length > 0 && (\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n              {filteredAndSortedSessions.length} of {sessions.length} sessions\r\n              {selectedSessions.size > 0 && `  ${selectedSessions.size} selected`}\r\n            </p>\r\n          </div>\r\n          \r\n          {selectedSessions.size > 0 && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <button type=\"button\"\r\n                onClick={handleBulkDelete}\r\n                className=\"btn btn--danger\"\r\n                aria-label={`Delete ${selectedSessions.size} selected sessions`}\r\n              >\r\n                <Trash2 className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n                Delete Selected\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Sessions Table */}\r\n      {filteredAndSortedSessions.length > 0 ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          {/* Desktop Table */}\r\n          <div className=\"hidden md:block overflow-x-auto\">\r\n            <table className=\"w-full\" role=\"table\" aria-label=\"Analysis sessions\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-700\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedSessions.size === filteredAndSortedSessions.length}\r\n                      onChange={toggleSelectAll}\r\n                      className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                      aria-label=\"Select all sessions\"\r\n                    />\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Session\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Status\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Depression Score\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Anxiety Score\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                    Actions\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200 dark:divide-gray-600\">\r\n                {filteredAndSortedSessions.map((session) => (\r\n                  <tr\r\n                    key={session.sessionId}\r\n                    className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\"\r\n                  >\r\n                    <td className=\"px-6 py-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedSessions.has(session.sessionId)}\r\n                        onChange={() => toggleSessionSelection(session.sessionId)}\r\n                        className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                        aria-label={`Select session ${session.sessionId}`}\r\n                      />\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div>\r\n                        <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {session.fileName}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          ID: {session.sessionId.slice(-12)}\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                          {formatFileSize(session.fileSize || 0)}\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <StatusBadge status={session.status} />\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm\">\r\n                        {session.depressionScore ? (\r\n                          <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                            {formatScoreCategory(session.depressionScore)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400 dark:text-gray-500\"></span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm\">\r\n                        {session.anxietyScore ? (\r\n                          <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                            {formatScoreCategory(session.anxietyScore)}\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-gray-400 dark:text-gray-500\"></span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                        {formatRelativeTime(session.uploadedAt)}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        {formatDateTime(session.uploadedAt)}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 text-right\">\r\n                      <div className=\"flex items-center justify-end gap-2\">\r\n                        <Link\r\n                          to={`/sessions/${session.sessionId}`}\r\n                          className=\"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300\"\r\n                          aria-label={`View details for session ${session.sessionId}`}\r\n                        >\r\n                          <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </Link>\r\n                        {session.status === 'succeeded' && (\r\n                          <button type=\"button\"\r\n                            className=\"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300\"\r\n                            aria-label={`Download results for session ${session.sessionId}`}\r\n                          >\r\n                            <Download className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                          </button>\r\n                        )}\r\n                        <button type=\"button\"\r\n                          onClick={() => handleRerunSession(session.sessionId)}\r\n                          className=\"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300\"\r\n                          aria-label={`Re-run analysis for session ${session.sessionId}`}\r\n                        >\r\n                          <RefreshCw className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </button>\r\n                        <button type=\"button\"\r\n                          onClick={() => handleDeleteSession(session.sessionId)}\r\n                          className=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300\"\r\n                          aria-label={`Delete session ${session.sessionId}`}\r\n                        >\r\n                          <Trash2 className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          {/* Mobile Cards */}\r\n          <div className=\"md:hidden space-y-4 p-4\">\r\n            {filteredAndSortedSessions.map((session) => (\r\n              <div\r\n                key={session.sessionId}\r\n                className=\"border border-gray-200 dark:border-gray-600 rounded-lg p-4 space-y-3\"\r\n              >\r\n                <div className=\"flex items-start justify-between\">\r\n                  <div className=\"flex items-start space-x-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedSessions.has(session.sessionId)}\r\n                      onChange={() => toggleSessionSelection(session.sessionId)}\r\n                      className=\"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\r\n                      aria-label={`Select session ${session.sessionId}`}\r\n                    />\r\n                    <div>\r\n                      <h3 className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                        {session.fileName}\r\n                      </h3>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        ID: {session.sessionId.slice(-12)}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <StatusBadge status={session.status} />\r\n                </div>\r\n\r\n                {(session.depressionScore || session.anxietyScore) && (\r\n                  <div className=\"text-sm\">\r\n                    {session.depressionScore && (\r\n                      <div>Depression: {formatScoreCategory(session.depressionScore)}</div>\r\n                    )}\r\n                    {session.anxietyScore && (\r\n                      <div>Anxiety: {formatScoreCategory(session.anxietyScore)}</div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400\">\r\n                  <span>{formatRelativeTime(session.uploadedAt)}</span>\r\n                  <span>{formatFileSize(session.fileSize || 0)}</span>\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-end gap-2 pt-2 border-t border-gray-200 dark:border-gray-600\">\r\n                  <Link\r\n                    to={`/sessions/${session.sessionId}`}\r\n                    className=\"btn btn--secondary text-xs\"\r\n                    aria-label={`View details for session ${session.sessionId}`}\r\n                  >\r\n                    <Eye className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    View\r\n                  </Link>\r\n                  {session.status === 'succeeded' && (\r\n                    <button type=\"button\"\r\n                      className=\"btn btn--secondary text-xs\"\r\n                      aria-label={`Download results for session ${session.sessionId}`}\r\n                    >\r\n                      <Download className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                      Download\r\n                    </button>\r\n                  )}\r\n                  <button type=\"button\"\r\n                    onClick={() => handleRerunSession(session.sessionId)}\r\n                    className=\"btn btn--secondary text-xs\"\r\n                    aria-label={`Re-run analysis for session ${session.sessionId}`}\r\n                  >\r\n                    <RefreshCw className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    Re-run\r\n                  </button>\r\n                  <button type=\"button\"\r\n                    onClick={() => handleDeleteSession(session.sessionId)}\r\n                    className=\"btn btn--danger text-xs\"\r\n                    aria-label={`Delete session ${session.sessionId}`}\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n          <AlertCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No sessions found\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            {sessions.length === 0 \r\n              ? \"You haven't created any analysis sessions yet.\"\r\n              : \"No sessions match your current filters.\"\r\n            }\r\n          </p>\r\n          {sessions.length === 0 ? (\r\n            <Link to=\"/upload\" className=\"btn btn--primary\">\r\n              Start Your First Analysis\r\n            </Link>\r\n          ) : (\r\n            <button type=\"button\"\r\n              onClick={() => setFilters({\r\n                search: '',\r\n                status: 'all',\r\n                dateRange: 'all',\r\n                sortBy: 'date',\r\n                sortOrder: 'desc',\r\n              })}\r\n              className=\"btn btn--secondary\"\r\n            >\r\n              Clear Filters\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Sessions;\r\n","import React, { useState, useCallback } from 'react';\r\nimport { \r\n  Brain, \r\n  AlertTriangle, \r\n  CheckCircle, \r\n  RefreshCw, \r\n  Clock, \r\n  TrendingUp,\r\n  Lightbulb,\r\n  ShieldAlert,\r\n  FileText,\r\n  Target,\r\n  Calendar\r\n} from 'lucide-react';\r\nimport { apiService } from '../services/api';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { formatDateTime } from '../utils';\r\nimport type { RiskAssessment, AppError } from '../types';\r\n\r\ninterface RiskAssessmentProps {\r\n  sessionId: string;\r\n  existingAssessment?: RiskAssessment | null;\r\n  onAssessmentUpdated?: (assessment: RiskAssessment) => void;\r\n}\r\n\r\n// Risk level configuration\r\nconst riskLevelConfig = {\r\n  low: { \r\n    color: 'green', \r\n    label: 'Low Risk',\r\n    icon: CheckCircle,\r\n    description: 'Low likelihood of immediate concerns'\r\n  },\r\n  moderate: { \r\n    color: 'yellow', \r\n    label: 'Moderate Risk',\r\n    icon: AlertTriangle,\r\n    description: 'Some concerns that warrant attention'\r\n  },\r\n  high: { \r\n    color: 'red', \r\n    label: 'High Risk',\r\n    icon: ShieldAlert,\r\n    description: 'Significant concerns requiring immediate attention'\r\n  },\r\n  critical: { \r\n    color: 'red', \r\n    label: 'Critical Risk',\r\n    icon: ShieldAlert,\r\n    description: 'Urgent intervention required'\r\n  },\r\n} as const;\r\n\r\nconst RiskAssessmentComponent: React.FC<RiskAssessmentProps> = ({\r\n  sessionId,\r\n  existingAssessment,\r\n  onAssessmentUpdated\r\n}) => {\r\n  const { announceToScreenReader } = useAccessibility();\r\n  const [assessment, setAssessment] = useState<RiskAssessment | null>(existingAssessment || null);\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n\r\n  // Generate new risk assessment\r\n  const generateAssessment = useCallback(async () => {\r\n    try {\r\n      setIsGenerating(true);\r\n      setError(null);\r\n      announceToScreenReader('Generating AI risk assessment...');\r\n\r\n      const response = await apiService.generateRiskAssessment(sessionId);\r\n      \r\n      if (response.success && response.riskAssessment) {\r\n        setAssessment(response.riskAssessment);\r\n        onAssessmentUpdated?.(response.riskAssessment);\r\n        announceToScreenReader('Risk assessment generated successfully');\r\n      } else {\r\n        throw new Error(response.message || 'Failed to generate risk assessment');\r\n      }\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error generating assessment: ${appError.message}`);\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  }, [sessionId, onAssessmentUpdated, announceToScreenReader]);\r\n\r\n  // Load existing assessment\r\n  const loadAssessment = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      const response = await apiService.getRiskAssessment(sessionId);\r\n      \r\n      if (response.success && response.riskAssessment) {\r\n        setAssessment(response.riskAssessment);\r\n        onAssessmentUpdated?.(response.riskAssessment);\r\n      }\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [sessionId, onAssessmentUpdated]);\r\n\r\n  // Risk level badge component\r\n  const RiskLevelBadge: React.FC<{ riskLevel: string; riskScore?: number }> = ({ riskLevel, riskScore }) => {\r\n    const config = riskLevelConfig[riskLevel.toLowerCase() as keyof typeof riskLevelConfig];\r\n    if (!config) return null;\r\n\r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <span\r\n          className={`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${\r\n            config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n            config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n            'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n          }`}\r\n          role=\"status\"\r\n          aria-label={`Risk level: ${config.label}`}\r\n        >\r\n          <Icon className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n          {config.label}\r\n          {riskScore && (\r\n            <span className=\"ml-2 px-2 py-0.5 bg-white dark:bg-gray-800 rounded text-xs font-bold\">\r\n              {riskScore}/10\r\n            </span>\r\n          )}\r\n        </span>\r\n        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          {config.description}\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // If no assessment exists and not generating, show generate button\r\n  if (!assessment && !isGenerating && !isLoading) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"text-center py-8\">\r\n          <Brain className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No Risk Assessment Available\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            Generate an AI-powered risk assessment based on session data and clinical insights.\r\n          </p>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <button type=\"button\"\r\n              onClick={generateAssessment}\r\n              className=\"btn btn--primary\"\r\n              aria-label=\"Generate AI risk assessment\"\r\n            >\r\n              <Brain className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n              Generate AI Risk Assessment\r\n            </button>\r\n            \r\n            <button type=\"button\"\r\n              onClick={loadAssessment}\r\n              className=\"btn btn--secondary\"\r\n              aria-label=\"Check for existing assessment\"\r\n            >\r\n              <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n              Check for Existing Assessment\r\n            </button>\r\n          </div>\r\n          \r\n          {error && (\r\n            <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n              <p className=\"text-red-700 dark:text-red-300 text-sm\">\r\n                {error.message}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Loading state\r\n  if (isGenerating || isLoading) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">\r\n            {isGenerating ? 'Generating AI risk assessment...' : 'Loading assessment...'}\r\n          </span>\r\n        </div>\r\n        \r\n        {isGenerating && (\r\n          <div className=\"mt-4 text-center\">\r\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              This may take a few moments as AI analyzes the session data...\r\n            </p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Display assessment\r\n  if (!assessment) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6\">\r\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white flex items-center\">\r\n          <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n          AI Risk Assessment\r\n        </h2>\r\n        \r\n        <div className=\"flex items-center space-x-3 mt-4 sm:mt-0\">\r\n          <button type=\"button\"\r\n            onClick={generateAssessment}\r\n            disabled={isGenerating}\r\n            className=\"btn btn--secondary text-xs\"\r\n            aria-label=\"Regenerate risk assessment\"\r\n          >\r\n            <RefreshCw className={`w-3 h-3 mr-1 ${isGenerating ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Regenerate\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-6\">\r\n        {/* Risk Level and Score */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n          <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n            <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\r\n              Overall Risk Level\r\n            </h3>\r\n            <RiskLevelBadge riskLevel={assessment.overallRiskLevel} riskScore={assessment.riskScore} />\r\n          </div>\r\n          \r\n          {assessment.generatedAt && (\r\n            <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n              <h3 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center\">\r\n                <Calendar className=\"w-4 h-4 mr-1\" aria-hidden=\"true\" />\r\n                Generated\r\n              </h3>\r\n              <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                {formatDateTime(assessment.generatedAt)}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Summary */}\r\n        {assessment.summary && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <FileText className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Summary\r\n            </h3>\r\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n              <p className=\"text-blue-900 dark:text-blue-100 text-sm leading-relaxed\">\r\n                {assessment.summary}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Key Risk Factors */}\r\n        {assessment.keyFactors && assessment.keyFactors.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <AlertTriangle className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Key Risk Factors\r\n            </h3>\r\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.keyFactors.map((factor: string, index: number) => (\r\n                  <li key={index} className=\"text-yellow-900 dark:text-yellow-100 text-sm flex items-start\">\r\n                    <span className=\"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-3 flex-shrink-0\" aria-hidden=\"true\"></span>\r\n                    {factor}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Recommendations */}\r\n        {assessment.recommendations && assessment.recommendations.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <Lightbulb className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Recommendations\r\n            </h3>\r\n            <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.recommendations.map((recommendation: string, index: number) => (\r\n                  <li key={index} className=\"text-green-900 dark:text-green-100 text-sm flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {recommendation}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Immediate Actions */}\r\n        {assessment.immediateActions && assessment.immediateActions.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <Target className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Immediate Actions Required\r\n            </h3>\r\n            <div className=\"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.immediateActions.map((action: string, index: number) => (\r\n                  <li key={index} className=\"text-red-900 dark:text-red-100 text-sm flex items-start\">\r\n                    <ShieldAlert className=\"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {action}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Follow-up Recommendations */}\r\n        {assessment.followUpRecommendations && assessment.followUpRecommendations.length > 0 && (\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n              <TrendingUp className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Follow-up Recommendations\r\n            </h3>\r\n            <div className=\"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800\">\r\n              <ul className=\"space-y-2\">\r\n                {assessment.followUpRecommendations.map((followUp: string, index: number) => (\r\n                  <li key={index} className=\"text-purple-900 dark:text-purple-100 text-sm flex items-start\">\r\n                    <Clock className=\"w-4 h-4 text-purple-600 dark:text-purple-400 mt-0.5 mr-3 flex-shrink-0\" aria-hidden=\"true\" />\r\n                    {followUp}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Last Updated */}\r\n        <div className=\"pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center text-xs text-gray-500 dark:text-gray-400\">\r\n            <Clock className=\"w-3 h-3 mr-1\" aria-hidden=\"true\" />\r\n            Generated: {formatDateTime(assessment.generatedAt)}\r\n            {assessment.modelVersion && (\r\n              <span className=\"ml-4\">Model: {assessment.modelVersion}</span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {error && (\r\n        <div className=\"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n          <p className=\"text-red-700 dark:text-red-300 text-sm\">\r\n            {error.message}\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RiskAssessmentComponent;\r\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useParams, Link, useNavigate } from 'react-router-dom';\r\nimport { \r\n  ArrowLeft, \r\n  RefreshCw, \r\n  Download, \r\n  AlertCircle, \r\n  CheckCircle, \r\n  Clock, \r\n  XCircle,\r\n  Eye,\r\n  EyeOff,\r\n  Play,\r\n  Pause,\r\n  Calendar,\r\n  User,\r\n  FileAudio,\r\n  Activity,\r\n  TrendingUp,\r\n  Brain,\r\n  Heart,\r\n  Info\r\n} from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { apiService } from '../services/api';\r\nimport { formatDateTime, formatRelativeTime } from '../utils';\r\nimport RiskAssessmentComponent from '../components/RiskAssessment';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Status configuration for consistent styling\r\nconst statusConfig = {\r\n  queued: { color: 'yellow', icon: Clock, label: 'Queued', description: 'Waiting to be processed' },\r\n  initiated: { color: 'blue', icon: Clock, label: 'Initiated', description: 'Session has been created' },\r\n  running: { color: 'blue', icon: RefreshCw, label: 'Processing', description: 'Audio is being analyzed' },\r\n  processing: { color: 'blue', icon: RefreshCw, label: 'Processing', description: 'Analysis in progress' },\r\n  succeeded: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  success: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  completed: { color: 'green', icon: CheckCircle, label: 'Completed', description: 'Analysis completed successfully' },\r\n  failed: { color: 'red', icon: XCircle, label: 'Failed', description: 'Analysis encountered an error' },\r\n  error: { color: 'red', icon: XCircle, label: 'Error', description: 'An error occurred during processing' },\r\n} as const;\r\n\r\nconst SessionDetail: React.FC = () => {\r\n  const { sessionId } = useParams<{ sessionId: string }>();\r\n  const navigate = useNavigate();\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  const [session, setSession] = useState<SessionData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [showRawJson, setShowRawJson] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [audioPlaying, setAudioPlaying] = useState(false);\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n\r\n  // Load session data\r\n  const loadSession = useCallback(async () => {\r\n    if (!sessionId) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const sessionData = await apiService.getSessionData(sessionId);\r\n      setSession(sessionData);\r\n      announceToScreenReader(`Session ${sessionId} loaded successfully`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading session: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [sessionId, announceToScreenReader]);\r\n\r\n  // Refresh session data\r\n  const refreshSession = useCallback(async () => {\r\n    setIsRefreshing(true);\r\n    await loadSession();\r\n    setIsRefreshing(false);\r\n    announceToScreenReader('Session data refreshed');\r\n  }, [loadSession, announceToScreenReader]);\r\n\r\n  // Load session on component mount\r\n  useEffect(() => {\r\n    loadSession();\r\n  }, [loadSession]);\r\n\r\n  // Handle JSON view toggle\r\n  const toggleRawJson = useCallback(() => {\r\n    setShowRawJson(prev => {\r\n      const newState = !prev;\r\n      announceToScreenReader(`Raw JSON view ${newState ? 'enabled' : 'disabled'}`);\r\n      return newState;\r\n    });\r\n  }, [announceToScreenReader]);\r\n\r\n  // Audio controls\r\n  const toggleAudioPlayback = useCallback(() => {\r\n    if (!audioRef.current) return;\r\n    \r\n    if (audioPlaying) {\r\n      audioRef.current.pause();\r\n      setAudioPlaying(false);\r\n      announceToScreenReader('Audio paused');\r\n    } else {\r\n      audioRef.current.play().catch(() => {\r\n        announceToScreenReader('Failed to play audio');\r\n      });\r\n      setAudioPlaying(true);\r\n      announceToScreenReader('Audio playing');\r\n    }\r\n  }, [audioPlaying, announceToScreenReader]);\r\n\r\n  // Download session data\r\n  const downloadSessionData = useCallback(() => {\r\n    if (!session) return;\r\n\r\n    const dataStr = JSON.stringify(session, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    const url = URL.createObjectURL(dataBlob);\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `session-${session.sessionId}-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    announceToScreenReader('Session data download started');\r\n  }, [session, announceToScreenReader]);\r\n\r\n  // Download audio file using audioUrl from session data\r\n  const downloadAudioFile = useCallback(async () => {\r\n    if (!session?.audioUrl || !session?.audioFileName) return;\r\n    if (!session?.audioUrl) return;\r\n\r\n    try {\r\n      // Use the audioUrl directly from session data\r\n      const downloadUrl = session.audioUrl;\r\n      \r\n      // Open the download URL in a new tab\r\n      window.open(downloadUrl, '_blank');\r\n      // Use the audioUrl directly from session data\r\n      window.open(session.audioUrl, '_blank');\r\n      \r\n      announceToScreenReader(`Downloading audio file: ${session.audioFileName || 'audio file'}`);\r\n    } catch (error) {\r\n      console.error('Failed to download audio file:', error);\r\n      announceToScreenReader('Failed to download audio file');\r\n    }\r\n  }, [session, announceToScreenReader]);\r\n\r\n  // Re-run session analysis\r\n  const handleRerunSession = useCallback(() => {\r\n    if (!session) return;\r\n    \r\n    const confirmed = window.confirm('Are you sure you want to re-run the analysis for this session? You will be redirected to the upload page with the session data pre-filled.');\r\n    if (!confirmed) return;\r\n\r\n    announceToScreenReader('Redirecting to upload page for re-run...');\r\n    \r\n    // Navigate to upload page with session data\r\n    navigate('/upload', {\r\n      state: {\r\n        originalSessionId: session.sessionId,\r\n        audioFileName: session.audioFileName,\r\n        audioUrl: session.audioUrl,\r\n        userMetadata: session.userMetadata\r\n      }\r\n    });\r\n  }, [session, navigate, announceToScreenReader]);\r\n\r\n  // Status badge component\r\n  const StatusBadge: React.FC<{ status: string }> = ({ status }) => {\r\n    // For any unknown status that contains \"error\" or \"fail\", treat as error\r\n    const normalizedStatus = status.toLowerCase();\r\n    let config = statusConfig[status as keyof typeof statusConfig];\r\n    \r\n    if (!config) {\r\n      if (normalizedStatus.includes('error') || normalizedStatus.includes('fail')) {\r\n        config = statusConfig.error;\r\n      } else {\r\n        // Default to initiated for unknown statuses instead of failed\r\n        config = statusConfig.initiated;\r\n      }\r\n    }\r\n    \r\n    const Icon = config.icon;\r\n    \r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <span\r\n          className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\r\n            config.color === 'green' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\r\n            config.color === 'blue' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\r\n            config.color === 'yellow' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\r\n            'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'\r\n          }`}\r\n          role=\"status\"\r\n          aria-label={`Status: ${config.label}`}\r\n        >\r\n          <Icon className={`w-4 h-4 mr-2 ${config.color === 'blue' && status === 'processing' ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n          {config.label}\r\n        </span>\r\n        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          {config.description}\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading session details...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Session\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <div className=\"mt-4 space-x-3\">\r\n                <button type=\"button\"\r\n                  onClick={loadSession}\r\n                  className=\"btn btn--primary\"\r\n                  aria-label=\"Retry loading session\"\r\n                >\r\n                  Try Again\r\n                </button>\r\n                <Link to=\"/sessions\" className=\"btn btn--secondary\">\r\n                  Back to Sessions\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!session) {\r\n    return (\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <div className=\"text-center py-16\">\r\n          <AlertCircle className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            Session Not Found\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            The requested session could not be found.\r\n          </p>\r\n          <Link to=\"/sessions\" className=\"btn btn--primary\">\r\n            Back to Sessions\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div className=\"flex items-center space-x-4\">\r\n          <button type=\"button\"\r\n            onClick={() => navigate('/sessions')}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Back to sessions list\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Back to Sessions\r\n          </button>\r\n          \r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n              Session Details\r\n            </h1>\r\n            <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n              ID: {session.sessionId}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button type=\"button\"\r\n            onClick={toggleRawJson}\r\n            className=\"btn btn--secondary\"\r\n            aria-label={`${showRawJson ? 'Hide' : 'Show'} raw JSON data`}\r\n          >\r\n            {showRawJson ? <EyeOff className=\"w-4 h-4 mr-2\" /> : <Eye className=\"w-4 h-4 mr-2\" />}\r\n            {showRawJson ? 'Hide JSON' : 'Show JSON'}\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={refreshSession}\r\n            disabled={isRefreshing}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh session data\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${isRefreshing ? 'animate-spin' : ''}`} aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={handleRerunSession}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Re-run analysis for this session\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Re-run\r\n          </button>\r\n          \r\n          <button type=\"button\"\r\n            onClick={downloadSessionData}\r\n            className=\"btn btn--primary\"\r\n            aria-label=\"Download session data as JSON\"\r\n          >\r\n            <Download className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Download\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Raw JSON View */}\r\n      {showRawJson && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Info className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Raw Session Data\r\n          </h2>\r\n          <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 overflow-auto\">\r\n            <pre className=\"text-sm text-gray-900 dark:text-gray-100 whitespace-pre-wrap break-all\">\r\n              {JSON.stringify(session, null, 2)}\r\n            </pre>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Session Overview */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Basic Information */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Info className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Basic Information\r\n          </h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Status\r\n              </label>\r\n              <StatusBadge status={session.status} />\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <Calendar className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Created\r\n                </label>\r\n                <div className=\"text-sm\">\r\n                  <div className=\"text-gray-900 dark:text-white\">\r\n                    {formatRelativeTime(session.createdAt)}\r\n                  </div>\r\n                  <div className=\"text-gray-500 dark:text-gray-400\">\r\n                    {formatDateTime(session.createdAt)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <Clock className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Last Updated\r\n                </label>\r\n                <div className=\"text-sm\">\r\n                  <div className=\"text-gray-900 dark:text-white\">\r\n                    {formatRelativeTime(session.updatedAt)}\r\n                  </div>\r\n                  <div className=\"text-gray-500 dark:text-gray-400\">\r\n                    {formatDateTime(session.updatedAt)}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                <User className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                User ID\r\n              </label>\r\n              <div className=\"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all\">\r\n                {session.userId}\r\n              </div>\r\n            </div>\r\n            \r\n            {session.metadata_user_id && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  <User className=\"w-4 h-4 inline mr-1\" aria-hidden=\"true\" />\r\n                  Metadata User ID\r\n                </label>\r\n                <div className=\"font-mono text-sm bg-gray-100 dark:bg-gray-700 px-3 py-2 rounded border break-all\">\r\n                  {session.metadata_user_id}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Audio Information */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <FileAudio className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Audio Information\r\n          </h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            {session.audioFileName && session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  File Name\r\n                </label>\r\n                <button\r\n                  onClick={downloadAudioFile}\r\n                  className=\"text-sm text-blue-600 dark:text-blue-400 font-medium hover:text-blue-800 dark:hover:text-blue-300 underline transition-colors\"\r\n                  title=\"Click to download audio file\"\r\n                >\r\n                  {session.audioFileName}\r\n                </button>\r\n              </div>\r\n            )}\r\n            \r\n            {session.audioFileName && !session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  File Name\r\n                </label>\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  {session.audioFileName} (download not available)\r\n                </span>\r\n              </div>\r\n            )}\r\n            \r\n            {session.audioUrl && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Audio File\r\n                </label>\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <button type=\"button\"\r\n                    onClick={toggleAudioPlayback}\r\n                    className=\"btn btn--secondary\"\r\n                    aria-label={`${audioPlaying ? 'Pause' : 'Play'} audio`}\r\n                  >\r\n                    {audioPlaying ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\r\n                  </button>\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                    {audioPlaying ? 'Playing audio...' : 'Audio playback available'}\r\n                  </span>\r\n                </div>\r\n                <audio\r\n                  ref={audioRef}\r\n                  src={session.audioUrl}\r\n                  onPlay={() => setAudioPlaying(true)}\r\n                  onPause={() => setAudioPlaying(false)}\r\n                  onEnded={() => setAudioPlaying(false)}\r\n                  onError={() => {\r\n                    setAudioPlaying(false);\r\n                    announceToScreenReader('Audio playback failed - file may not be accessible');\r\n                  }}\r\n                  className=\"hidden\"\r\n                  preload=\"metadata\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* User Metadata */}\r\n      {session.userMetadata && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <User className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Patient Information\r\n          </h2>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n            {session.userMetadata.age && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Age\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.age} years\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.gender && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Gender\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white capitalize\">\r\n                  {session.userMetadata.gender.replace(/[_-]/g, ' ')}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.weight && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Weight\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.weight} lbs\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.race && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Race\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white capitalize\">\r\n                  {session.userMetadata.race}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.ethnicity && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Ethnicity\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.ethnicity}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.zipcode && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  ZIP Code\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white font-mono\">\r\n                  {session.userMetadata.zipcode}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.language !== undefined && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Primary Language English\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white\">\r\n                  {session.userMetadata.language ? 'Yes' : 'No'}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {session.userMetadata.sessionNotes && (\r\n              <div className=\"md:col-span-2 lg:col-span-3\">\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Session Notes\r\n                </label>\r\n                <div className=\"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 p-3 rounded border\">\r\n                  {session.userMetadata.sessionNotes}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Analysis Results */}\r\n      {(session.analysisResults || session.prediction) && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n            <Activity className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n            Analysis Results\r\n          </h2>\r\n          \r\n          <div className=\"space-y-6\">\r\n            {/* Mental Health Scores */}\r\n            {(session.analysisResults || session.prediction) && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center\">\r\n                  <Brain className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Mental Health Scores\r\n                </h3>\r\n                \r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  {/* Depression Score */}\r\n                  {(session.analysisResults?.depressionScore || (session.prediction as any)?.predicted_score_depression) && (\r\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <span className=\"text-sm font-medium text-blue-700 dark:text-blue-300\">\r\n                          Depression Score\r\n                        </span>\r\n                        <TrendingUp className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" aria-hidden=\"true\" />\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-blue-900 dark:text-blue-100\">\r\n                        {session.analysisResults?.depressionScore?.toFixed(2) || \r\n                         ((session.prediction as any)?.predicted_score_depression ? \r\n                           (session.prediction as any).predicted_score_depression.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase()) : \r\n                           'N/A')}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Anxiety Score */}\r\n                  {(session.analysisResults?.anxietyScore || (session.prediction as any)?.predicted_score_anxiety) && (\r\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <span className=\"text-sm font-medium text-purple-700 dark:text-purple-300\">\r\n                          Anxiety Score\r\n                        </span>\r\n                        <Heart className=\"w-4 h-4 text-purple-600 dark:text-purple-400\" aria-hidden=\"true\" />\r\n                      </div>\r\n                      <div className=\"text-2xl font-bold text-purple-900 dark:text-purple-100\">\r\n                        {session.analysisResults?.anxietyScore?.toFixed(2) || \r\n                         ((session.prediction as any)?.predicted_score_anxiety ? \r\n                           (session.prediction as any).predicted_score_anxiety.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase()) : \r\n                           'N/A')}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Note: Risk Level and Confidence scores have been removed per user request */}\r\n                  {/* Note: Overall Score (predicted_score) is deprecated and no longer displayed */}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Clinical Insights */}\r\n            {session.analysisResults?.insights && session.analysisResults.insights.length > 0 && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3\">\r\n                  Clinical Insights\r\n                </h3>\r\n                <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800\">\r\n                  <ul className=\"space-y-2\">\r\n                    {session.analysisResults.insights.map((insight, index) => (\r\n                      <li key={index} className=\"text-sm text-yellow-800 dark:text-yellow-200 flex items-start\">\r\n                        <span className=\"inline-block w-2 h-2 bg-yellow-600 dark:bg-yellow-400 rounded-full mt-2 mr-2 flex-shrink-0\" aria-hidden=\"true\"></span>\r\n                        {insight}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Completion Information */}\r\n            {session.analysisResults?.completedAt && (\r\n              <div>\r\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-3\">\r\n                  Analysis Completion\r\n                </h3>\r\n                <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n                  <div className=\"flex items-center text-sm\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 dark:text-green-400 mr-2\" aria-hidden=\"true\" />\r\n                    <span className=\"text-gray-700 dark:text-gray-300 mr-2\">\r\n                      Completed:\r\n                    </span>\r\n                    <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {formatDateTime(session.analysisResults.completedAt)}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* AI Risk Assessment */}\r\n      <RiskAssessmentComponent \r\n        sessionId={session.sessionId}\r\n        existingAssessment={session.riskAssessment || null}\r\n        onAssessmentUpdated={(assessment) => {\r\n          setSession(prev => prev ? { ...prev, riskAssessment: assessment } : null);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SessionDetail;\r\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { \r\n  TrendingUp, \r\n  TrendingDown, \r\n  Activity, \r\n  Brain, \r\n  Heart, \r\n  BarChart3, \r\n  PieChart, \r\n  Clock,\r\n  AlertCircle,\r\n  RefreshCw,\r\n  Filter,\r\n  ChevronDown,\r\n  ChevronUp,\r\n  Download,\r\n  Eye\r\n} from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { apiService } from '../services/api';\r\nimport { getUserId, formatRelativeTime } from '../utils';\r\nimport type { SessionData, AppError } from '../types';\r\n\r\n// Chart data interfaces\r\ninterface ChartDataPoint {\r\n  date: string;\r\n  depression: number | null;\r\n  anxiety: number | null;\r\n  overall: number | null;\r\n  sessionId: string;\r\n}\r\n\r\ninterface ScoreDistribution {\r\n  category: string;\r\n  count: number;\r\n  percentage: number;\r\n  color: string;\r\n}\r\n\r\ninterface TrendAnalysis {\r\n  direction: 'improving' | 'worsening' | 'stable';\r\n  change: number;\r\n  period: string;\r\n}\r\n\r\n// Filter interface\r\ninterface PredictionFilters {\r\n  dateRange: 'all' | 'week' | 'month' | 'quarter' | 'year';\r\n  scoreType: 'all' | 'depression' | 'anxiety' | 'overall';\r\n  showTrends: boolean;\r\n}\r\n\r\nconst Predictions: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [sessions, setSessions] = useState<SessionData[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [filters, setFilters] = useState<PredictionFilters>({\r\n    dateRange: 'all',\r\n    scoreType: 'all',\r\n    showTrends: true\r\n  });\r\n  const [showFilters, setShowFilters] = useState(false);\r\n\r\n  const { announceToScreenReader } = useAccessibility();\r\n  const navigate = useNavigate();\r\n\r\n  // Get authenticated user ID for API calls (matches blob storage folder structure)\r\n  const getAuthenticatedUserId = useCallback((): string => {\r\n    // Use authenticated user ID if available, otherwise fall back to getUserId utility\r\n    return user?.id || getUserId();\r\n  }, [user?.id]);\r\n\r\n  // Handle bar click to navigate to session details\r\n  const handleBarClick = useCallback((sessionId: string) => {\r\n    navigate(`/sessions/${sessionId}`);\r\n    announceToScreenReader(`Navigating to session ${sessionId} details`);\r\n  }, [navigate, announceToScreenReader]);\r\n\r\n  // Load user sessions with prediction data\r\n  const loadPredictions = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      const userId = getAuthenticatedUserId(); // Use authenticated user ID to match blob storage folder structure\r\n      const response = await apiService.getUserSessions(userId);\r\n      \r\n      // Filter sessions that have analysis results or predictions\r\n      const sessionsWithPredictions = response.sessions.filter(session => {\r\n        return session.analysisResults || session.prediction;\r\n      });\r\n      \r\n      setSessions(sessionsWithPredictions);\r\n      announceToScreenReader(`${sessionsWithPredictions.length} prediction sessions loaded`);\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading predictions: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  useEffect(() => {\r\n    loadPredictions();\r\n  }, [loadPredictions]);\r\n\r\n  // Filter sessions based on date range\r\n  const filteredSessions = useMemo(() => {\r\n    if (filters.dateRange === 'all') return sessions;\r\n\r\n    const now = new Date();\r\n    const startDate = new Date();\r\n    \r\n    switch (filters.dateRange) {\r\n      case 'week':\r\n        startDate.setDate(now.getDate() - 7);\r\n        break;\r\n      case 'month':\r\n        startDate.setMonth(now.getMonth() - 1);\r\n        break;\r\n      case 'quarter':\r\n        startDate.setMonth(now.getMonth() - 3);\r\n        break;\r\n      case 'year':\r\n        startDate.setFullYear(now.getFullYear() - 1);\r\n        break;\r\n    }\r\n    \r\n    return sessions.filter(session => \r\n      new Date(session.createdAt) >= startDate\r\n    );\r\n  }, [sessions, filters.dateRange]);\r\n\r\n  // Prepare chart data\r\n  const chartData = useMemo((): ChartDataPoint[] => {\r\n    return filteredSessions\r\n      .map(session => {\r\n        // Since we now have categorical data, we'll map categories to numbers for visualization\r\n        const mapCategoryToNumber = (category?: string): number | null => {\r\n          if (!category) return null;\r\n          switch (category.toLowerCase()) {\r\n            // Depression categories\r\n            case 'no_to_mild':\r\n              return 1;\r\n            case 'mild_to_moderate':\r\n              return 2;\r\n            case 'moderate_to_severe':\r\n              return 3;\r\n            // Anxiety categories\r\n            case 'no_or_minimal':\r\n              return 1;\r\n            case 'moderate':\r\n              return 2;\r\n            case 'moderately_severe':\r\n              return 3;\r\n            case 'severe':\r\n              return 4;\r\n            default:\r\n              return null;\r\n          }\r\n        };\r\n\r\n        const depression = mapCategoryToNumber((session.prediction as any)?.predicted_score_depression);\r\n        const anxiety = mapCategoryToNumber((session.prediction as any)?.predicted_score_anxiety);\r\n        // Note: predicted_score is deprecated, no longer using overall score\r\n\r\n        return {\r\n          date: session.createdAt,\r\n          depression,\r\n          anxiety,\r\n          overall: null, // No longer using deprecated predicted_score\r\n          sessionId: session.sessionId\r\n        };\r\n      })\r\n      .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate score distributions based on categorical data\r\n  const scoreDistribution = useMemo((): Record<string, ScoreDistribution[]> => {\r\n    const distributions: Record<string, ScoreDistribution[]> = {\r\n      depression: [],\r\n      anxiety: []\r\n    };\r\n\r\n    // Define possible categories and their colors\r\n    const categories = [\r\n      // Depression categories\r\n      { category: 'no_to_mild', label: 'No to Mild', color: 'bg-green-400' },\r\n      { category: 'mild_to_moderate', label: 'Mild to Moderate', color: 'bg-yellow-500' },\r\n      { category: 'moderate_to_severe', label: 'Moderate to Severe', color: 'bg-red-600' },\r\n      // Anxiety categories  \r\n      { category: 'no_or_minimal', label: 'No or Minimal', color: 'bg-green-400' },\r\n      { category: 'moderate', label: 'Moderate', color: 'bg-orange-500' },\r\n      { category: 'moderately_severe', label: 'Moderately Severe', color: 'bg-red-500' },\r\n      { category: 'severe', label: 'Severe', color: 'bg-red-700' }\r\n    ];\r\n\r\n    // Process depression scores\r\n    const depressionScores = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_depression)\r\n      .filter(score => score !== undefined);\r\n\r\n    categories.forEach(cat => {\r\n      const count = depressionScores.filter(score => score === cat.category).length;\r\n      const percentage = depressionScores.length > 0 ? (count / depressionScores.length) * 100 : 0;\r\n      \r\n      if (count > 0) { // Only show categories that have data\r\n        distributions.depression.push({\r\n          category: cat.label,\r\n          count,\r\n          percentage,\r\n          color: cat.color\r\n        });\r\n      }\r\n    });\r\n\r\n    // Process anxiety scores\r\n    const anxietyScores = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_anxiety)\r\n      .filter(score => score !== undefined);\r\n\r\n    categories.forEach(cat => {\r\n      const count = anxietyScores.filter(score => score === cat.category).length;\r\n      const percentage = anxietyScores.length > 0 ? (count / anxietyScores.length) * 100 : 0;\r\n      \r\n      if (count > 0) { // Only show categories that have data\r\n        distributions.anxiety.push({\r\n          category: cat.label,\r\n          count,\r\n          percentage,\r\n          color: cat.color\r\n        });\r\n      }\r\n    });\r\n\r\n    // Note: Overall scores (predicted_score) are deprecated and no longer processed\r\n\r\n    return distributions;\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate trend analysis for categorical data\r\n  const trendAnalysis = useMemo((): Record<string, TrendAnalysis> => {\r\n    const trends: Record<string, TrendAnalysis> = {};\r\n    \r\n    // For categorical data, we'll analyze if the trend is toward more severe or less severe categories\r\n    const getCategorySeverity = (category?: string): number => {\r\n      if (!category) return 0;\r\n      switch (category.toLowerCase()) {\r\n        // Depression categories: no_to_mild, mild_to_moderate, moderate_to_severe\r\n        case 'no_to_mild':\r\n          return 1;\r\n        case 'mild_to_moderate':\r\n          return 2;\r\n        case 'moderate_to_severe':\r\n          return 3;\r\n        // Anxiety categories: no_or_minimal, moderate, moderately_severe, severe\r\n        case 'no_or_minimal':\r\n          return 1;\r\n        case 'moderate':\r\n          return 2;\r\n        case 'moderately_severe':\r\n          return 3;\r\n        case 'severe':\r\n          return 4;\r\n        default:\r\n          return 0;\r\n      }\r\n    };\r\n\r\n    // Analyze depression trend\r\n    const depressionCategories = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_depression)\r\n      .filter(cat => cat !== undefined);\r\n\r\n    if (depressionCategories.length < 2) {\r\n      trends.depression = { direction: 'stable', change: 0, period: 'insufficient data' };\r\n    } else {\r\n      const severityScores = depressionCategories.map(getCategorySeverity);\r\n      const firstHalf = severityScores.slice(0, Math.floor(severityScores.length / 2));\r\n      const secondHalf = severityScores.slice(Math.floor(severityScores.length / 2));\r\n\r\n      const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\r\n      const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\r\n      const change = secondAvg - firstAvg;\r\n      \r\n      trends.depression = {\r\n        direction: Math.abs(change) < 0.5 ? 'stable' : change < 0 ? 'improving' : 'worsening',\r\n        change: Math.abs(change),\r\n        period: `${filteredSessions.length} sessions`\r\n      };\r\n    }\r\n\r\n    // Analyze anxiety trend\r\n    const anxietyCategories = filteredSessions\r\n      .map(session => (session.prediction as any)?.predicted_score_anxiety)\r\n      .filter(cat => cat !== undefined);\r\n\r\n    if (anxietyCategories.length < 2) {\r\n      trends.anxiety = { direction: 'stable', change: 0, period: 'insufficient data' };\r\n    } else {\r\n      const severityScores = anxietyCategories.map(getCategorySeverity);\r\n      const firstHalf = severityScores.slice(0, Math.floor(severityScores.length / 2));\r\n      const secondHalf = severityScores.slice(Math.floor(severityScores.length / 2));\r\n\r\n      const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;\r\n      const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;\r\n      const change = secondAvg - firstAvg;\r\n      \r\n      trends.anxiety = {\r\n        direction: Math.abs(change) < 0.5 ? 'stable' : change < 0 ? 'improving' : 'worsening',\r\n        change: Math.abs(change),\r\n        period: `${filteredSessions.length} sessions`\r\n      };\r\n    }\r\n\r\n    // Overall trend (placeholder)\r\n    trends.overall = { direction: 'stable', change: 0, period: 'coming soon' };\r\n\r\n    return trends;\r\n  }, [filteredSessions]);\r\n\r\n  // Calculate statistics\r\n  const statistics = useMemo(() => {\r\n    const stats = {\r\n      totalSessions: filteredSessions.length,\r\n      avgDepression: 0,\r\n      avgAnxiety: 0,\r\n      avgOverall: 0,\r\n      latestSession: null as SessionData | null,\r\n      improvementSessions: 0\r\n    };\r\n\r\n    if (filteredSessions.length === 0) return stats;\r\n\r\n    // For categorical data, we'll show the most common category instead of averages\r\n    const depressionCategories = filteredSessions\r\n      .map(s => s.prediction?.predictedScoreDepression)\r\n      .filter(s => s !== undefined);\r\n    \r\n    const anxietyCategories = filteredSessions\r\n      .map(s => s.prediction?.predictedScoreAnxiety)\r\n      .filter(s => s !== undefined);\r\n\r\n    // Calculate mode (most frequent category) for depression\r\n    if (depressionCategories.length > 0) {\r\n      const depressionCounts: Record<string, number> = {};\r\n      depressionCategories.forEach(cat => {\r\n        depressionCounts[cat!] = (depressionCounts[cat!] || 0) + 1;\r\n      });\r\n      const mostCommonDepression = Object.entries(depressionCounts)\r\n        .sort(([,a], [,b]) => b - a)[0][0];\r\n      stats.avgDepression = depressionCounts[mostCommonDepression];\r\n    }\r\n\r\n    // Calculate mode (most frequent category) for anxiety\r\n    if (anxietyCategories.length > 0) {\r\n      const anxietyCounts: Record<string, number> = {};\r\n      anxietyCategories.forEach(cat => {\r\n        anxietyCounts[cat!] = (anxietyCounts[cat!] || 0) + 1;\r\n      });\r\n      const mostCommonAnxiety = Object.entries(anxietyCounts)\r\n        .sort(([,a], [,b]) => b - a)[0][0];\r\n      stats.avgAnxiety = anxietyCounts[mostCommonAnxiety];\r\n    }\r\n    \r\n    stats.latestSession = filteredSessions.sort((a, b) => \r\n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\r\n    )[0];\r\n\r\n    // Improvement rate will be calculated later - for now set to 0\r\n    stats.improvementSessions = 0;\r\n\r\n    return stats;\r\n  }, [filteredSessions]);\r\n\r\n  // Handle filter changes\r\n  const updateFilter = useCallback((key: keyof PredictionFilters, value: any) => {\r\n    setFilters(prev => ({ ...prev, [key]: value }));\r\n    announceToScreenReader(`Filter ${key} changed to ${value}`);\r\n  }, [announceToScreenReader]);\r\n\r\n  // Download predictions data\r\n  const downloadPredictions = useCallback(() => {\r\n    const dataStr = JSON.stringify(filteredSessions, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    const url = URL.createObjectURL(dataBlob);\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `predictions-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    announceToScreenReader('Predictions data download started');\r\n  }, [filteredSessions, announceToScreenReader]);\r\n\r\n  // Trend indicator component\r\n  const TrendIndicator: React.FC<{ trend: TrendAnalysis; label: string }> = ({ trend, label }) => {\r\n    const Icon = trend.direction === 'improving' ? TrendingDown : \r\n                 trend.direction === 'worsening' ? TrendingUp : Activity;\r\n    const colorClass = trend.direction === 'improving' ? 'text-green-600 dark:text-green-400' :\r\n                       trend.direction === 'worsening' ? 'text-red-600 dark:text-red-400' :\r\n                       'text-gray-600 dark:text-gray-400';\r\n\r\n    return (\r\n      <div className=\"flex items-center space-x-2\">\r\n        <Icon className={`w-4 h-4 ${colorClass}`} aria-hidden=\"true\" />\r\n        <span className=\"text-sm text-gray-700 dark:text-gray-300\">{label}</span>\r\n        <span className={`text-sm font-medium ${colorClass} capitalize`}>\r\n          {trend.direction}\r\n          {trend.period === 'insufficient data' \r\n            ? ' (need more sessions)'\r\n            : trend.period === 'coming soon' \r\n              ? ' (analysis coming soon)'\r\n              : ` (${trend.period})`\r\n          }\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Simple line chart component\r\n  const SimpleLineChart: React.FC<{ \r\n    data: ChartDataPoint[]; \r\n    type: 'depression' | 'anxiety' | 'overall';\r\n    onBarClick: (sessionId: string) => void;\r\n  }> = ({ data, type, onBarClick }) => {\r\n    const scores = data.map(d => d[type]).filter(s => s !== null) as number[];\r\n    if (scores.length === 0) return <div className=\"text-center text-gray-500 py-8\">No data available</div>;\r\n\r\n    const maxScore = Math.max(...scores);\r\n    const minScore = Math.min(...scores);\r\n    const range = maxScore - minScore || 1;\r\n\r\n    // Function to convert numeric score back to category name\r\n    const getScoreCategoryName = (score: number): string => {\r\n      switch (score) {\r\n        case 1: return 'No to Mild / No or Minimal';\r\n        case 2: return 'Mild to Moderate / Moderate';\r\n        case 3: return 'Moderate to Severe / Moderately Severe';\r\n        case 4: return 'Severe';\r\n        default: return 'Unknown';\r\n      }\r\n    };\r\n\r\n    // Function to get category color based on score and chart type\r\n    const getCategoryColor = (score: number, type: 'depression' | 'anxiety' | 'overall'): string => {\r\n      if (type === 'depression') {\r\n        switch (score) {\r\n          case 1: return 'bg-blue-400';  // no_to_mild\r\n          case 2: return 'bg-blue-600';  // mild_to_moderate\r\n          case 3: return 'bg-blue-800';  // moderate_to_severe\r\n          default: return 'bg-blue-500';\r\n        }\r\n      } else if (type === 'anxiety') {\r\n        switch (score) {\r\n          case 1: return 'bg-purple-400'; // no_or_minimal\r\n          case 2: return 'bg-purple-600'; // moderate\r\n          case 3: return 'bg-purple-700'; // moderately_severe\r\n          case 4: return 'bg-purple-900'; // severe\r\n          default: return 'bg-purple-500';\r\n        }\r\n      } else {\r\n        switch (score) {\r\n          case 1: return 'bg-green-400';\r\n          case 2: return 'bg-green-600';\r\n          case 3: return 'bg-green-700';\r\n          case 4: return 'bg-green-800';\r\n          default: return 'bg-green-500';\r\n        }\r\n      }\r\n    };\r\n\r\n    // Legend data - updated to match the chart colors\r\n    const getLegendItems = (chartType: 'depression' | 'anxiety' | 'overall') => {\r\n      const baseItems = [\r\n        { score: 1, label: 'No/Minimal' },\r\n        { score: 2, label: 'Mild' },\r\n        { score: 3, label: 'Moderate' },\r\n        { score: 4, label: 'Mod-Severe' },\r\n        { score: 5, label: 'Severe' }\r\n      ];\r\n      \r\n      return baseItems.map(item => ({\r\n        ...item,\r\n        color: getCategoryColor(item.score, chartType)\r\n      }));\r\n    };\r\n\r\n    // Filter legend to only show categories that exist in the data\r\n    const usedScores = new Set(scores);\r\n    const legendItems = getLegendItems(type);\r\n    const activeLegendItems = legendItems.filter(item => usedScores.has(item.score));\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"h-32 flex items-end space-x-1 px-4 py-2 mb-4\">\r\n          {data.map((dataPoint, index) => {\r\n            const score = dataPoint[type];\r\n            if (score === null) return null;\r\n            \r\n            const height = ((score - minScore) / range) * 100;\r\n            const categoryColor = getCategoryColor(score, type);\r\n            const categoryName = getScoreCategoryName(score);\r\n            const dateStr = new Date(dataPoint.date).toLocaleDateString();\r\n            \r\n            return (\r\n              <div\r\n                key={index}\r\n                className={`flex-1 ${categoryColor} opacity-70 hover:opacity-100 hover:scale-105 transition-all duration-200 rounded-t cursor-pointer relative group chart-bar-dynamic`}\r\n                style={{ '--chart-height': `${Math.max(height, 8)}%` } as React.CSSProperties}\r\n                onClick={() => onBarClick(dataPoint.sessionId)}\r\n                role=\"button\"\r\n                tabIndex={0}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter' || e.key === ' ') {\r\n                    e.preventDefault();\r\n                    onBarClick(dataPoint.sessionId);\r\n                  }\r\n                }}\r\n                aria-label={`View session details for ${categoryName} score on ${dateStr}`}\r\n              >\r\n                {/* Tooltip */}\r\n                <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10\">\r\n                  <div className=\"font-medium\">{categoryName}</div>\r\n                  <div className=\"text-gray-300\">{dateStr}</div>\r\n                  <div className=\"text-gray-300\">Session: {dataPoint.sessionId.slice(-8)}</div>\r\n                  <div className=\"text-gray-400 text-xs mt-1\">Click to view details</div>\r\n                  {/* Tooltip arrow */}\r\n                  <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-gray-900\"></div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Legend */}\r\n        {activeLegendItems.length > 0 && (\r\n          <div className=\"px-4\">\r\n            <div className=\"flex flex-wrap items-center gap-3 text-xs\">\r\n              <span className=\"text-gray-600 dark:text-gray-400 font-medium\">Legend:</span>\r\n              {activeLegendItems.map((item) => (\r\n                <div key={item.score} className=\"flex items-center gap-1\">\r\n                  <div className={`w-3 h-3 ${item.color} rounded`}></div>\r\n                  <span className=\"text-gray-700 dark:text-gray-300\">{item.label}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <RefreshCw className=\"w-8 h-8 text-blue-600 animate-spin mr-3\" aria-hidden=\"true\" />\r\n          <span className=\"text-lg text-gray-900 dark:text-white\">Loading predictions...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-5 h-5 text-red-500 mr-3\" aria-hidden=\"true\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Error Loading Predictions\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">{error.message}</p>\r\n              <button\r\n                type=\"button\"\r\n                onClick={loadPredictions}\r\n                className=\"mt-4 btn btn--primary\"\r\n                aria-label=\"Retry loading predictions\"\r\n              >\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            My Predictions\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            Analyze your mental health trends and insights over time\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setShowFilters(!showFilters)}\r\n            className=\"btn btn--secondary\"\r\n            aria-expanded={showFilters ? 'true' : 'false'}\r\n            aria-label={`${showFilters ? 'Hide' : 'Show'} filter options`}\r\n          >\r\n            <Filter className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Filters\r\n            {showFilters ? <ChevronUp className=\"w-4 h-4 ml-2\" /> : <ChevronDown className=\"w-4 h-4 ml-2\" />}\r\n          </button>\r\n          \r\n          <button\r\n            type=\"button\"\r\n            onClick={loadPredictions}\r\n            className=\"btn btn--secondary\"\r\n            aria-label=\"Refresh predictions data\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Refresh\r\n          </button>\r\n          \r\n          <button\r\n            type=\"button\"\r\n            onClick={downloadPredictions}\r\n            className=\"btn btn--primary\"\r\n            disabled={filteredSessions.length === 0}\r\n            aria-label=\"Download predictions data\"\r\n          >\r\n            <Download className=\"w-4 h-4 mr-2\" aria-hidden=\"true\" />\r\n            Download\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      {showFilters && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div>\r\n              <label htmlFor=\"date-range\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Date Range\r\n              </label>\r\n              <select\r\n                id=\"date-range\"\r\n                value={filters.dateRange}\r\n                onChange={(e) => updateFilter('dateRange', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Time</option>\r\n                <option value=\"week\">Past Week</option>\r\n                <option value=\"month\">Past Month</option>\r\n                <option value=\"quarter\">Past Quarter</option>\r\n                <option value=\"year\">Past Year</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label htmlFor=\"score-type\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Focus Score\r\n              </label>\r\n              <select\r\n                id=\"score-type\"\r\n                value={filters.scoreType}\r\n                onChange={(e) => updateFilter('scoreType', e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              >\r\n                <option value=\"all\">All Scores</option>\r\n                <option value=\"depression\">Depression</option>\r\n                <option value=\"anxiety\">Anxiety</option>\r\n                <option value=\"overall\">Overall</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div className=\"flex items-end\">\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={filters.showTrends}\r\n                  onChange={(e) => updateFilter('showTrends', e.target.checked)}\r\n                  className=\"form__input form__input--checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2\"\r\n                />\r\n                <span className=\"text-sm text-gray-700 dark:text-gray-300\">Show trend analysis</span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {filteredSessions.length === 0 ? (\r\n        <div className=\"text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n          <Brain className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" aria-hidden=\"true\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\r\n            No Prediction Data Available\r\n          </h3>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mb-6\">\r\n            {sessions.length === 0 \r\n              ? \"You haven't completed any analysis sessions yet.\"\r\n              : \"No sessions found for the selected date range.\"\r\n            }\r\n          </p>\r\n          <Link to=\"/upload\" className=\"btn btn--primary\">\r\n            Start Your First Analysis\r\n          </Link>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Statistics Overview */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Activity className=\"w-8 h-8 text-blue-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Total Sessions</p>\r\n                  <p className=\"text-2xl font-semibold text-gray-900 dark:text-white\">{statistics.totalSessions}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Brain className=\"w-8 h-8 text-purple-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Depression (Most Common)</p>\r\n                  <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                    {(() => {\r\n                      const depressionCategories = filteredSessions\r\n                        .map(s => (s.prediction as any)?.predicted_score_depression)\r\n                        .filter(s => s !== undefined);\r\n                      \r\n                      if (depressionCategories.length === 0) return '';\r\n                      \r\n                      const counts: Record<string, number> = {};\r\n                      depressionCategories.forEach(cat => {\r\n                        counts[cat!] = (counts[cat!] || 0) + 1;\r\n                      });\r\n                      \r\n                      const mostCommon = Object.entries(counts)\r\n                        .sort(([,a], [,b]) => b - a)[0][0];\r\n                      \r\n                      return mostCommon.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n                    })()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Heart className=\"w-8 h-8 text-red-600\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Anxiety (Most Common)</p>\r\n                  <p className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                    {(() => {\r\n                      const anxietyCategories = filteredSessions\r\n                        .map(s => (s.prediction as any)?.predicted_score_anxiety)\r\n                        .filter(s => s !== undefined);\r\n                      \r\n                      if (anxietyCategories.length === 0) return '';\r\n                      \r\n                      const counts: Record<string, number> = {};\r\n                      anxietyCategories.forEach(cat => {\r\n                        counts[cat!] = (counts[cat!] || 0) + 1;\r\n                      });\r\n                      \r\n                      const mostCommon = Object.entries(counts)\r\n                        .sort(([,a], [,b]) => b - a)[0][0];\r\n                      \r\n                      return mostCommon.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase());\r\n                    })()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Improvement Rate section hidden - feature not implemented yet\r\n            <div className=\"bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 p-6 opacity-60\">\r\n              <div className=\"flex items-center\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <Activity className=\"w-8 h-8 text-gray-500\" aria-hidden=\"true\" />\r\n                </div>\r\n                <div className=\"ml-4\">\r\n                  <p className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">Improvement Rate</p>\r\n                  <p className=\"text-lg font-semibold text-gray-500 dark:text-gray-400\">\r\n                    Coming Soon\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                    Feature in development\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            */}\r\n          </div>\r\n\r\n          {/* Charts Section */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Score Trends Chart */}\r\n            {(filters.scoreType === 'all' || filters.scoreType === 'depression') && (\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                  <BarChart3 className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Depression Score Trend\r\n                </h3>\r\n                <SimpleLineChart data={chartData} type=\"depression\" onBarClick={handleBarClick} />\r\n                {filters.showTrends && (\r\n                  <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600\">\r\n                    <TrendIndicator trend={trendAnalysis.depression} label=\"Trend:\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {(filters.scoreType === 'all' || filters.scoreType === 'anxiety') && (\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                  <PieChart className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                  Anxiety Score Trend\r\n                </h3>\r\n                <SimpleLineChart data={chartData} type=\"anxiety\" onBarClick={handleBarClick} />\r\n                {filters.showTrends && (\r\n                  <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600\">\r\n                    <TrendIndicator trend={trendAnalysis.anxiety} label=\"Trend:\" />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Score Distribution */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n              <BarChart3 className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n              Score Distribution\r\n            </h3>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              {Object.entries(scoreDistribution).map(([scoreType, distribution]) => (\r\n                <div key={scoreType}>\r\n                  <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 capitalize\">\r\n                    {scoreType} Scores\r\n                  </h4>\r\n                  <div className=\"space-y-2\">\r\n                    {distribution.map((item) => (\r\n                      <div key={item.category} className=\"flex items-center\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex justify-between text-xs mb-1\">\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">{item.category}</span>\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">{item.count} ({item.percentage.toFixed(1)}%)</span>\r\n                          </div>\r\n                          <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n                            <div\r\n                              className={`h-2 rounded-full ${item.color} progress-dynamic progress-animated`}\r\n                              style={{ '--progress-width': `${item.percentage}%` } as React.CSSProperties}\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Recent Sessions */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center\">\r\n                <Clock className=\"w-5 h-5 mr-2\" aria-hidden=\"true\" />\r\n                Recent Analysis Sessions\r\n              </h3>\r\n              <Link to=\"/sessions\" className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm\">\r\n                View All Sessions \r\n              </Link>\r\n            </div>\r\n\r\n            <div className=\"space-y-4\">\r\n              {filteredSessions.slice(0, 5).map((session) => (\r\n                <div key={session.sessionId} className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className={`w-2 h-2 rounded-full ${\r\n                        session.status === 'succeeded' ? 'bg-green-500' :\r\n                        session.status === 'processing' ? 'bg-blue-500' :\r\n                        session.status === 'failed' ? 'bg-red-500' : 'bg-gray-500'\r\n                      }`} />\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {session.audioFileName || `Session ${session.sessionId.slice(-8)}`}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                          {formatRelativeTime(session.createdAt)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center space-x-4\">\r\n                    {(session.prediction as any)?.predicted_score_depression && (\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Depression</p>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {(session.prediction as any).predicted_score_depression.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                    {(session.prediction as any)?.predicted_score_anxiety && (\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">Anxiety</p>\r\n                        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {(session.prediction as any).predicted_score_anxiety.replace(/_/g, ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n                    <Link\r\n                      to={`/sessions/${session.sessionId}`}\r\n                      className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400\"\r\n                      aria-label={`View session ${session.sessionId}`}\r\n                    >\r\n                      <Eye className=\"w-4 h-4\" aria-hidden=\"true\" />\r\n                    </Link>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Predictions;\r\n","import React, { useState, useCallback, useEffect } from 'react';\r\nimport { RefreshCw, AlertCircle, TrendingUp, TrendingDown, Users, Activity, Info, X } from 'lucide-react';\r\nimport { useAccessibility } from '../hooks/useAccessibility';\r\nimport { apiService } from '../services/api';\r\nimport type { SessionData as ImportedSessionData, AppError } from '../types';\r\n\r\n// Types for analytics data\r\ninterface AnalyticsData {\r\n  overview: {\r\n    totalSessions: number;\r\n    uniqueUsers: number;\r\n    successRate: number;\r\n    avgSessionsPerUser: number;\r\n    recentActivity: number;\r\n  };\r\n  sessionStatus: {\r\n    succeeded: number;\r\n    failed: number;\r\n    processing: number;\r\n    total: number;\r\n  };\r\n  riskLevels: {\r\n    low: number;\r\n    medium: number;\r\n    high: number;\r\n    unknown: number;\r\n    total: number;\r\n  };\r\n  predictions: {\r\n    depression: {\r\n      no_to_mild: number;\r\n      mild_to_moderate: number;\r\n      moderate_to_severe: number;\r\n      severe: number;\r\n      total: number;\r\n    };\r\n    anxiety: {\r\n      no_or_minimal: number;\r\n      mild: number;\r\n      moderate: number;\r\n      moderately_severe: number;\r\n      severe: number;\r\n      total: number;\r\n    };\r\n  };\r\n  timeData: Array<{\r\n    date: string;\r\n    count: number;\r\n  }>;\r\n  riskDistribution: {\r\n    low: number;\r\n    medium: number;\r\n    high: number;\r\n    unknown: number;\r\n  };\r\n  userStats: Array<{\r\n    userId: string;\r\n    totalSessions: number;\r\n    successfulSessions: number;\r\n    successRate: number;\r\n    avgConfidence: number;\r\n    riskDistribution: {\r\n      low: number;\r\n      medium: number;\r\n      high: number;\r\n      unknown: number;\r\n    };\r\n    lastActivity: string;\r\n    depressionScores: {\r\n      no_to_mild: number;\r\n      mild_to_moderate: number;\r\n      moderate_to_severe: number;\r\n      severe: number;\r\n    };\r\n    anxietyScores: {\r\n      no_or_minimal: number;\r\n      mild: number;\r\n      moderate: number;\r\n      moderately_severe: number;\r\n      severe: number;\r\n    };\r\n  }>;\r\n  correlations: {\r\n    ageDistribution: {\r\n      [ageGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    genderDistribution: {\r\n      [gender: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    raceDistribution: {\r\n      [race: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    ethnicityDistribution: {\r\n      [ethnicity: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    languageDistribution: {\r\n      [language: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    weightDistribution: {\r\n      [weightGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n    zipCodeDistribution: {\r\n      [zipGroup: string]: {\r\n        depressionCases: number;\r\n        anxietyCases: number;\r\n        totalSessions: number;\r\n      };\r\n    };\r\n  };\r\n}\r\n\r\n// Utility function to calculate percentage\r\nconst getPercentage = (value: number, total: number): number => {\r\n  return total > 0 ? Math.round((value / total) * 100) : 0;\r\n};\r\n\r\n// Function to aggregate session data into analytics\r\nconst aggregateSessionData = (allSessions: ImportedSessionData[]): AnalyticsData => {\r\n  const totalSessions = allSessions.length;\r\n  const uniqueUsers = new Set(allSessions.map(s => s.userId)).size;\r\n  \r\n  const completedSessions = allSessions.filter(s => \r\n    s.status === 'succeeded' || s.status === 'completed'\r\n  );\r\n  \r\n  const failedSessions = allSessions.filter(s => \r\n    s.status === 'failed'\r\n  );\r\n  \r\n  const processingSessions = allSessions.filter(s => \r\n    s.status === 'processing'\r\n  );\r\n\r\n  // Calculate success rate and average sessions per user\r\n  const successRate = getPercentage(completedSessions.length, totalSessions);\r\n  const avgSessionsPerUser = uniqueUsers > 0 ? Math.round((totalSessions / uniqueUsers) * 10) / 10 : 0;\r\n  \r\n  // Calculate recent activity (sessions in last 24 hours)\r\n  const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\r\n  const recentActivity = allSessions.filter(s => \r\n    new Date(s.createdAt) > twentyFourHoursAgo\r\n  ).length;\r\n\r\n  // Risk level distribution\r\n  const riskCounts = {\r\n    low: 0,\r\n    medium: 0,\r\n    high: 0,\r\n    unknown: 0,\r\n  };\r\n\r\n  allSessions.forEach(session => {\r\n    const riskLevel = session.analysisResults?.riskLevel || 'unknown';\r\n    if (riskLevel in riskCounts) {\r\n      riskCounts[riskLevel as keyof typeof riskCounts]++;\r\n    }\r\n  });\r\n\r\n  // Depression score distribution\r\n  const depressionCounts = {\r\n    no_to_mild: 0,\r\n    mild_to_moderate: 0,\r\n    moderate_to_severe: 0,\r\n    severe: 0,\r\n  };\r\n\r\n  // Anxiety score distribution\r\n  const anxietyCounts = {\r\n    no_or_minimal: 0,\r\n    mild: 0,\r\n    moderate: 0,\r\n    moderately_severe: 0,\r\n    severe: 0,\r\n  };\r\n\r\n  completedSessions.forEach(session => {\r\n    // Handle depression scores - try multiple sources\r\n    let depressionCategory: string | null = null;\r\n    let anxietyCategory: string | null = null;\r\n\r\n    // First try prediction object for classification strings\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n      anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n    }\r\n\r\n    // If no classification from prediction, try to categorize from numeric scores in analysisResults\r\n    if (!depressionCategory && session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n      const score = session.analysisResults.depressionScore;\r\n      // Convert numeric PHQ-9 score to categories (0-27 scale)\r\n      if (score >= 0 && score <= 4) depressionCategory = 'no_to_mild';\r\n      else if (score >= 5 && score <= 9) depressionCategory = 'mild_to_moderate';\r\n      else if (score >= 10 && score <= 14) depressionCategory = 'mild_to_moderate';\r\n      else if (score >= 15 && score <= 19) depressionCategory = 'moderate_to_severe';\r\n      else if (score >= 20) depressionCategory = 'severe';\r\n    }\r\n\r\n    if (!anxietyCategory && session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n      const score = session.analysisResults.anxietyScore;\r\n      // Convert numeric GAD-7 score to categories (0-21 scale)\r\n      if (score >= 0 && score <= 4) anxietyCategory = 'no_or_minimal';\r\n      else if (score >= 5 && score <= 9) anxietyCategory = 'mild';\r\n      else if (score >= 10 && score <= 14) anxietyCategory = 'moderate';\r\n      else if (score >= 15 && score <= 19) anxietyCategory = 'moderately_severe';\r\n      else if (score >= 20) anxietyCategory = 'severe';\r\n    }\r\n\r\n    // Count the categories\r\n    if (depressionCategory && depressionCategory in depressionCounts) {\r\n      depressionCounts[depressionCategory as keyof typeof depressionCounts]++;\r\n    }\r\n\r\n    if (anxietyCategory && anxietyCategory in anxietyCounts) {\r\n      anxietyCounts[anxietyCategory as keyof typeof anxietyCounts]++;\r\n    }\r\n  });\r\n\r\n  // Time series data (last 7 days)\r\n  const timeData = [];\r\n  for (let i = 6; i >= 0; i--) {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - i);\r\n    const dateStr = date.toISOString().split('T')[0];\r\n    \r\n    const sessionsOnDate = allSessions.filter(s => \r\n      s.createdAt.split('T')[0] === dateStr\r\n    ).length;\r\n    \r\n    timeData.push({\r\n      date: dateStr,\r\n      count: sessionsOnDate,\r\n    });\r\n  }\r\n\r\n  // Calculate per-user statistics\r\n  const userStatsMap = new Map<string, {\r\n    totalSessions: number;\r\n    successfulSessions: number;\r\n    sessions: ImportedSessionData[];\r\n  }>();\r\n\r\n  // Group sessions by metadata user ID (patient) when available, otherwise by authenticated user ID\r\n  allSessions.forEach(session => {\r\n    // Use metadata_user_id (patient ID) for grouping if available, otherwise use userId (authenticated user)\r\n    const groupingUserId = session.metadata_user_id || session.userId;\r\n    \r\n    if (!userStatsMap.has(groupingUserId)) {\r\n      userStatsMap.set(groupingUserId, {\r\n        totalSessions: 0,\r\n        successfulSessions: 0,\r\n        sessions: [],\r\n      });\r\n    }\r\n    const userStats = userStatsMap.get(groupingUserId)!;\r\n    userStats.totalSessions++;\r\n    userStats.sessions.push(session);\r\n    if (session.status === 'succeeded' || session.status === 'completed') {\r\n      userStats.successfulSessions++;\r\n    }\r\n  });\r\n\r\n  // Calculate detailed user statistics\r\n  const userStats = Array.from(userStatsMap.entries()).map(([userId, stats]) => {\r\n    const successRate = getPercentage(stats.successfulSessions, stats.totalSessions);\r\n    \r\n    // Calculate average confidence for this user\r\n    const successfulSessions = stats.sessions.filter(s => \r\n      s.status === 'succeeded' || s.status === 'completed'\r\n    );\r\n    \r\n    const confidenceValues = successfulSessions\r\n      .map(s => s.analysisResults?.confidence)\r\n      .filter(c => c !== null && c !== undefined && typeof c === 'number');\r\n    \r\n    const avgConfidence = confidenceValues.length > 0 \r\n      ? confidenceValues.reduce((sum, c) => sum + c!, 0) / confidenceValues.length\r\n      : 0;\r\n\r\n    // Risk distribution for this user\r\n    const userRiskDistribution = {\r\n      low: 0,\r\n      medium: 0,\r\n      high: 0,\r\n      unknown: 0,\r\n    };\r\n\r\n    stats.sessions.forEach(session => {\r\n      const riskLevel = session.analysisResults?.riskLevel || 'unknown';\r\n      if (riskLevel in userRiskDistribution) {\r\n        userRiskDistribution[riskLevel as keyof typeof userRiskDistribution]++;\r\n      }\r\n    });\r\n\r\n    // Depression and anxiety score distributions for this user\r\n    const userDepressionScores = {\r\n      no_to_mild: 0,\r\n      mild_to_moderate: 0,\r\n      moderate_to_severe: 0,\r\n      severe: 0,\r\n    };\r\n\r\n    const userAnxietyScores = {\r\n      no_or_minimal: 0,\r\n      mild: 0,\r\n      moderate: 0,\r\n      moderately_severe: 0,\r\n      severe: 0,\r\n    };\r\n\r\n    successfulSessions.forEach(session => {\r\n      // Handle depression scores - try multiple sources\r\n      let depressionCategory: string | null = null;\r\n      let anxietyCategory: string | null = null;\r\n\r\n      // First try prediction object for classification strings\r\n      if (session.prediction) {\r\n        const prediction = session.prediction as any;\r\n        depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n        anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n      }\r\n\r\n      // If no classification from prediction, try to categorize from numeric scores in analysisResults\r\n      if (!depressionCategory && session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n        const score = session.analysisResults.depressionScore;\r\n        // Convert numeric PHQ-9 score to categories (0-27 scale)\r\n        if (score >= 0 && score <= 4) depressionCategory = 'no_to_mild';\r\n        else if (score >= 5 && score <= 9) depressionCategory = 'mild_to_moderate';\r\n        else if (score >= 10 && score <= 14) depressionCategory = 'mild_to_moderate';\r\n        else if (score >= 15 && score <= 19) depressionCategory = 'moderate_to_severe';\r\n        else if (score >= 20) depressionCategory = 'severe';\r\n      }\r\n\r\n      if (!anxietyCategory && session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n        const score = session.analysisResults.anxietyScore;\r\n        // Convert numeric GAD-7 score to categories (0-21 scale)\r\n        if (score >= 0 && score <= 4) anxietyCategory = 'no_or_minimal';\r\n        else if (score >= 5 && score <= 9) anxietyCategory = 'mild';\r\n        else if (score >= 10 && score <= 14) anxietyCategory = 'moderate';\r\n        else if (score >= 15 && score <= 19) anxietyCategory = 'moderately_severe';\r\n        else if (score >= 20) anxietyCategory = 'severe';\r\n      }\r\n\r\n      // Count the categories for this user\r\n      if (depressionCategory && depressionCategory in userDepressionScores) {\r\n        userDepressionScores[depressionCategory as keyof typeof userDepressionScores]++;\r\n      }\r\n\r\n      if (anxietyCategory && anxietyCategory in userAnxietyScores) {\r\n        userAnxietyScores[anxietyCategory as keyof typeof userAnxietyScores]++;\r\n      }\r\n    });\r\n\r\n    // Find last activity\r\n    const lastActivity = stats.sessions.reduce((latest, session) => {\r\n      return new Date(session.updatedAt) > new Date(latest) ? session.updatedAt : latest;\r\n    }, stats.sessions[0]?.updatedAt || new Date().toISOString());\r\n\r\n    return {\r\n      userId,\r\n      totalSessions: stats.totalSessions,\r\n      successfulSessions: stats.successfulSessions,\r\n      successRate,\r\n      avgConfidence: Math.round(avgConfidence * 100) / 100,\r\n      riskDistribution: userRiskDistribution,\r\n      lastActivity,\r\n      depressionScores: userDepressionScores,\r\n      anxietyScores: userAnxietyScores,\r\n    };\r\n  }).sort((a, b) => b.totalSessions - a.totalSessions); // Sort by total sessions desc\r\n\r\n  // Calculate correlations between metadata and mental health outcomes\r\n  const correlations = {\r\n    ageDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    genderDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    raceDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    ethnicityDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    languageDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    weightDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n    zipCodeDistribution: {} as Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>,\r\n  };\r\n\r\n  // Helper function to determine if a session indicates depression/anxiety\r\n  const hasDepressionCase = (session: ImportedSessionData): boolean => {\r\n    // Check for moderate_to_severe or severe depression\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      const depressionCategory = prediction.predictedScoreDepression || prediction.predicted_score_depression;\r\n      return depressionCategory === 'moderate_to_severe' || depressionCategory === 'severe';\r\n    }\r\n    // Fallback to numeric score (PHQ-9 >= 10 indicates moderate or higher depression)\r\n    if (session.analysisResults?.depressionScore !== null && session.analysisResults?.depressionScore !== undefined) {\r\n      return session.analysisResults.depressionScore >= 10;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  const hasAnxietyCase = (session: ImportedSessionData): boolean => {\r\n    // Check for moderate, moderately_severe, or severe anxiety\r\n    if (session.prediction) {\r\n      const prediction = session.prediction as any;\r\n      const anxietyCategory = prediction.predictedScoreAnxiety || prediction.predicted_score_anxiety;\r\n      return anxietyCategory === 'moderate' || anxietyCategory === 'moderately_severe' || anxietyCategory === 'severe';\r\n    }\r\n    // Fallback to numeric score (GAD-7 >= 10 indicates moderate or higher anxiety)\r\n    if (session.analysisResults?.anxietyScore !== null && session.analysisResults?.anxietyScore !== undefined) {\r\n      return session.analysisResults.anxietyScore >= 10;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Process sessions with metadata\r\n  const sessionsWithMetadata = allSessions.filter(session => session.userMetadata);\r\n  \r\n  sessionsWithMetadata.forEach(session => {\r\n    const metadata = session.userMetadata!;\r\n    const hasDepression = hasDepressionCase(session);\r\n    const hasAnxiety = hasAnxietyCase(session);\r\n\r\n    // Age correlation (group by age ranges)\r\n    if (metadata.age) {\r\n      let ageGroup: string;\r\n      if (metadata.age < 25) ageGroup = '18-24';\r\n      else if (metadata.age < 35) ageGroup = '25-34';\r\n      else if (metadata.age < 45) ageGroup = '35-44';\r\n      else if (metadata.age < 55) ageGroup = '45-54';\r\n      else if (metadata.age < 65) ageGroup = '55-64';\r\n      else ageGroup = '65+';\r\n\r\n      if (!correlations.ageDistribution[ageGroup]) {\r\n        correlations.ageDistribution[ageGroup] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.ageDistribution[ageGroup].totalSessions++;\r\n      if (hasDepression) correlations.ageDistribution[ageGroup].depressionCases++;\r\n      if (hasAnxiety) correlations.ageDistribution[ageGroup].anxietyCases++;\r\n    }\r\n\r\n    // Gender correlation\r\n    if (metadata.gender) {\r\n      const gender = metadata.gender;\r\n      if (!correlations.genderDistribution[gender]) {\r\n        correlations.genderDistribution[gender] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.genderDistribution[gender].totalSessions++;\r\n      if (hasDepression) correlations.genderDistribution[gender].depressionCases++;\r\n      if (hasAnxiety) correlations.genderDistribution[gender].anxietyCases++;\r\n    }\r\n\r\n    // Race correlation\r\n    if (metadata.race) {\r\n      const race = metadata.race;\r\n      if (!correlations.raceDistribution[race]) {\r\n        correlations.raceDistribution[race] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.raceDistribution[race].totalSessions++;\r\n      if (hasDepression) correlations.raceDistribution[race].depressionCases++;\r\n      if (hasAnxiety) correlations.raceDistribution[race].anxietyCases++;\r\n    }\r\n\r\n    // Ethnicity correlation\r\n    if (metadata.ethnicity) {\r\n      const ethnicity = metadata.ethnicity;\r\n      if (!correlations.ethnicityDistribution[ethnicity]) {\r\n        correlations.ethnicityDistribution[ethnicity] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.ethnicityDistribution[ethnicity].totalSessions++;\r\n      if (hasDepression) correlations.ethnicityDistribution[ethnicity].depressionCases++;\r\n      if (hasAnxiety) correlations.ethnicityDistribution[ethnicity].anxietyCases++;\r\n    }\r\n\r\n    // Language correlation\r\n    if (metadata.language !== undefined) {\r\n      const language = metadata.language ? 'English' : 'Other';\r\n      if (!correlations.languageDistribution[language]) {\r\n        correlations.languageDistribution[language] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.languageDistribution[language].totalSessions++;\r\n      if (hasDepression) correlations.languageDistribution[language].depressionCases++;\r\n      if (hasAnxiety) correlations.languageDistribution[language].anxietyCases++;\r\n    }\r\n\r\n    // Weight correlation (group by BMI-like ranges)\r\n    if (metadata.weight) {\r\n      let weightGroup: string;\r\n      if (metadata.weight < 120) weightGroup = 'Under 120 lbs';\r\n      else if (metadata.weight < 150) weightGroup = '120-149 lbs';\r\n      else if (metadata.weight < 180) weightGroup = '150-179 lbs';\r\n      else if (metadata.weight < 220) weightGroup = '180-219 lbs';\r\n      else weightGroup = '220+ lbs';\r\n\r\n      if (!correlations.weightDistribution[weightGroup]) {\r\n        correlations.weightDistribution[weightGroup] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.weightDistribution[weightGroup].totalSessions++;\r\n      if (hasDepression) correlations.weightDistribution[weightGroup].depressionCases++;\r\n      if (hasAnxiety) correlations.weightDistribution[weightGroup].anxietyCases++;\r\n    }\r\n\r\n    // ZIP code correlation (group by region - first 2 digits for demonstration)\r\n    if (metadata.zipcode) {\r\n      const zipPrefix = metadata.zipcode.substring(0, 2);\r\n      let region: string;\r\n      // Simple US region mapping based on ZIP code prefixes\r\n      if (['0', '1', '2'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Northeast';\r\n      else if (['3', '4'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Southeast';\r\n      else if (['5', '6'].some(prefix => zipPrefix.startsWith(prefix))) region = 'South Central';\r\n      else if (['7', '8'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Mountain/West';\r\n      else if (['9'].some(prefix => zipPrefix.startsWith(prefix))) region = 'Pacific';\r\n      else region = 'Other/International';\r\n\r\n      if (!correlations.zipCodeDistribution[region]) {\r\n        correlations.zipCodeDistribution[region] = { depressionCases: 0, anxietyCases: 0, totalSessions: 0 };\r\n      }\r\n      correlations.zipCodeDistribution[region].totalSessions++;\r\n      if (hasDepression) correlations.zipCodeDistribution[region].depressionCases++;\r\n      if (hasAnxiety) correlations.zipCodeDistribution[region].anxietyCases++;\r\n    }\r\n  });\r\n\r\n  return {\r\n    overview: {\r\n      totalSessions,\r\n      uniqueUsers,\r\n      successRate,\r\n      avgSessionsPerUser,\r\n      recentActivity,\r\n    },\r\n    sessionStatus: {\r\n      succeeded: completedSessions.length,\r\n      failed: failedSessions.length,\r\n      processing: processingSessions.length,\r\n      total: totalSessions,\r\n    },\r\n    riskLevels: {\r\n      ...riskCounts,\r\n      total: totalSessions,\r\n    },\r\n    predictions: {\r\n      depression: {\r\n        ...depressionCounts,\r\n        total: completedSessions.length,\r\n      },\r\n      anxiety: {\r\n        ...anxietyCounts,\r\n        total: completedSessions.length,\r\n      },\r\n    },\r\n    timeData,\r\n    riskDistribution: riskCounts,\r\n    userStats,\r\n    correlations,\r\n  };\r\n};\r\n\r\n// Types for chart components\r\n\r\n// Metric card component\r\nconst MetricCard: React.FC<{\r\n  title: string;\r\n  value: string | number;\r\n  subtitle?: string;\r\n  icon: React.ReactNode;\r\n  trend?: 'up' | 'down' | 'neutral';\r\n  color?: string;\r\n}> = ({ title, value, subtitle, icon, trend, color = 'text-blue-600' }) => (\r\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n    <div className=\"flex items-center justify-between\">\r\n      <div className=\"flex-1\">\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 font-medium\">{title}</p>\r\n        <p className={`text-2xl font-bold ${color} dark:text-white mt-1`}>{value}</p>\r\n        {subtitle && (\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">{subtitle}</p>\r\n        )}\r\n      </div>\r\n      <div className={`p-3 rounded-full bg-gray-100 dark:bg-gray-700 ${color}`}>\r\n        {icon}\r\n      </div>\r\n    </div>\r\n    {trend && (\r\n      <div className=\"flex items-center mt-4\">\r\n        {trend === 'up' && <TrendingUp className=\"h-4 w-4 text-green-500 mr-1\" />}\r\n        {trend === 'down' && <TrendingDown className=\"h-4 w-4 text-red-500 mr-1\" />}\r\n        <span className={`text-sm ${\r\n          trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-600' : 'text-gray-500'\r\n        }`}>\r\n          {trend === 'up' ? 'Trending up' : trend === 'down' ? 'Trending down' : 'Stable'}\r\n        </span>\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n\r\n// Distribution chart component\r\nconst DistributionChart: React.FC<{\r\n  title: string;\r\n  data: Array<{ label: string; value: number; color: string }>;\r\n  total: number;\r\n}> = ({ title, data, total }) => (\r\n  <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n    <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n    <div className=\"space-y-3\">\r\n      {data.map((item, index) => {\r\n        const percentage = getPercentage(item.value, total);\r\n        return (\r\n          <div key={index}>\r\n            <div className=\"flex justify-between text-sm mb-1\">\r\n              <span className=\"text-gray-600 dark:text-gray-400\">{item.label}</span>\r\n              <span className=\"text-gray-900 dark:text-white font-medium\">\r\n                {item.value} ({percentage}%)\r\n              </span>\r\n            </div>\r\n            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\r\n              <div\r\n                className={`h-2 rounded-full transition-all duration-500 ${item.color}`}\r\n                style={{ width: `${percentage}%` }}\r\n                role=\"progressbar\"\r\n                aria-label={`${item.label}: ${item.value} (${percentage}%)`}\r\n              />\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  </div>\r\n);\r\n\r\n// Time series chart component (elegant line chart)\r\nconst TimeSeriesChart: React.FC<{\r\n  title: string;\r\n  data: Array<{ date: string; count: number }>;\r\n}> = ({ title, data }) => {\r\n  const maxCount = Math.max(...data.map(d => d.count), 1);\r\n  const minCount = 0; // Start bars from zero for better visual comparison\r\n  const range = maxCount - minCount || 1;\r\n  \r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      {/* Chart Container */}\r\n      <div className=\"relative h-48\">\r\n        {/* SVG Chart */}\r\n        <svg\r\n          className=\"absolute inset-0 w-full h-full\"\r\n          viewBox=\"0 0 100 100\"\r\n          preserveAspectRatio=\"none\"\r\n        >\r\n          {/* Grid lines */}\r\n          <defs>\r\n            <pattern id=\"grid\" width=\"20\" height=\"20\" patternUnits=\"userSpaceOnUse\">\r\n              <path\r\n                d=\"M 20 0 L 0 0 0 20\"\r\n                fill=\"none\"\r\n                stroke=\"rgb(229 231 235)\"\r\n                strokeWidth=\"0.5\"\r\n                className=\"dark:stroke-gray-600\"\r\n              />\r\n            </pattern>\r\n            <linearGradient id=\"barGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n              <stop offset=\"0%\" stopColor=\"rgb(59 130 246)\" stopOpacity=\"0.8\"/>\r\n              <stop offset=\"100%\" stopColor=\"rgb(59 130 246)\" stopOpacity=\"0.6\"/>\r\n            </linearGradient>\r\n          </defs>\r\n          \r\n          {/* Grid */}\r\n          <rect width=\"100\" height=\"100\" fill=\"url(#grid)\" />\r\n          \r\n          {/* Thin Vertical Bars */}\r\n          {data.map((point, index) => {\r\n            const barWidth = 80 / data.length; // Thin bars with spacing\r\n            const x = (index / (data.length - 1)) * (100 - barWidth) + barWidth / 2;\r\n            const barHeight = ((point.count - minCount) / range) * 95; // 95% of container height\r\n            const y = 100 - barHeight;\r\n            \r\n            return (\r\n              <rect\r\n                key={index}\r\n                x={x - barWidth / 2}\r\n                y={y}\r\n                width={barWidth * 0.6} // Make bars a little thicker\r\n                height={barHeight}\r\n                fill=\"url(#barGradient)\"\r\n                stroke=\"rgb(59 130 246)\"\r\n                strokeWidth=\"0.2\"\r\n                className=\"transition-all duration-300 hover:opacity-80\"\r\n                rx=\"0.5\" // Slightly rounded corners\r\n              />\r\n            );\r\n          })}\r\n        </svg>\r\n      </div>\r\n      \r\n      {/* X-axis labels */}\r\n      <div className=\"flex items-center justify-between mt-4 px-2\">\r\n        {data.map((item, index) => {\r\n          const date = new Date(item.date);\r\n          const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });\r\n          const monthDay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n          \r\n          return (\r\n            <div key={index} className=\"text-center flex-1\">\r\n              <div className=\"text-xs font-medium text-gray-900 dark:text-white\">\r\n                {dayName}\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                {monthDay}\r\n              </div>\r\n              <div className=\"text-xs font-bold text-blue-600 dark:text-blue-400 mt-1\">\r\n                {item.count}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Metadata Correlation Chart Component\r\nconst MetadataCorrelationChart: React.FC<{\r\n  title: string;\r\n  data: Record<string, { depressionCases: number; anxietyCases: number; totalSessions: number; }>;\r\n  subtitle?: string;\r\n}> = ({ title, data, subtitle }) => {\r\n  const categories = Object.keys(data);\r\n  \r\n  if (categories.length === 0) {\r\n    return (\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n        {subtitle && (\r\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">{subtitle}</p>\r\n        )}\r\n        <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\r\n          No metadata available for this correlation\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">{title}</h3>\r\n      {subtitle && (\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">{subtitle}</p>\r\n      )}\r\n      \r\n      <div className=\"space-y-4\">\r\n        {categories.map((category, index) => {\r\n          const categoryData = data[category];\r\n          const depressionRate = categoryData.totalSessions > 0 \r\n            ? (categoryData.depressionCases / categoryData.totalSessions) * 100 \r\n            : 0;\r\n          const anxietyRate = categoryData.totalSessions > 0 \r\n            ? (categoryData.anxietyCases / categoryData.totalSessions) * 100 \r\n            : 0;\r\n          \r\n          return (\r\n            <div key={index} className=\"bg-gray-50 dark:bg-gray-700 rounded-lg p-4\">\r\n              <div className=\"flex justify-between items-center mb-3\">\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white\">{category}</h4>\r\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                  {categoryData.totalSessions} sessions\r\n                </span>\r\n              </div>\r\n              \r\n              {/* Depression Bar */}\r\n              <div className=\"mb-3\">\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Depression Cases</span>\r\n                  <span className=\"text-sm font-medium text-red-600 dark:text-red-400\">\r\n                    {categoryData.depressionCases} ({depressionRate.toFixed(1)}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2\">\r\n                  <div\r\n                    className=\"h-2 bg-red-500 rounded-full transition-all duration-500\"\r\n                    style={{ width: `${depressionRate}%` }}\r\n                    role=\"progressbar\"\r\n                    aria-label={`Depression rate: ${depressionRate.toFixed(1)}%`}\r\n                  />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Anxiety Bar */}\r\n              <div>\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Anxiety Cases</span>\r\n                  <span className=\"text-sm font-medium text-orange-600 dark:text-orange-400\">\r\n                    {categoryData.anxietyCases} ({anxietyRate.toFixed(1)}%)\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2\">\r\n                  <div\r\n                    className=\"h-2 bg-orange-500 rounded-full transition-all duration-500\"\r\n                    style={{ width: `${anxietyRate}%` }}\r\n                    role=\"progressbar\"\r\n                    aria-label={`Anxiety rate: ${anxietyRate.toFixed(1)}%`}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Summary */}\r\n      <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\r\n        <div className=\"grid grid-cols-2 gap-4 text-center\">\r\n          <div>\r\n            <div className=\"text-lg font-bold text-red-600 dark:text-red-400\">\r\n              {categories.reduce((sum, cat) => sum + data[cat].depressionCases, 0)}\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Total Depression Cases</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-lg font-bold text-orange-600 dark:text-orange-400\">\r\n              {categories.reduce((sum, cat) => sum + data[cat].anxietyCases, 0)}\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Total Anxiety Cases</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Depression vs Anxiety Correlation Chart\r\nconst CorrelationChart: React.FC<{\r\n  title: string;\r\n  depressionData: AnalyticsData['predictions']['depression'];\r\n  anxietyData: AnalyticsData['predictions']['anxiety'];\r\n}> = ({ title, depressionData, anxietyData }) => {\r\n  // Create correlation data points\r\n  const correlationPoints = [\r\n    { depression: depressionData.no_to_mild, anxiety: anxietyData.no_or_minimal, severity: 'Low', label: 'Minimal/None' },\r\n    { depression: depressionData.mild_to_moderate, anxiety: anxietyData.mild, severity: 'Mild', label: 'Mild' },\r\n    { depression: depressionData.moderate_to_severe, anxiety: anxietyData.moderate, severity: 'Moderate', label: 'Moderate' },\r\n    { depression: depressionData.severe, anxiety: anxietyData.moderately_severe + anxietyData.severe, severity: 'High', label: 'Severe' },\r\n  ];\r\n\r\n  const maxValue = Math.max(\r\n    ...correlationPoints.map(p => Math.max(p.depression, p.anxiety)),\r\n    10\r\n  );\r\n\r\n  const getColor = (severity: string) => {\r\n    switch (severity) {\r\n      case 'Low': return 'fill-green-500 stroke-green-600';\r\n      case 'Mild': return 'fill-yellow-500 stroke-yellow-600';\r\n      case 'Moderate': return 'fill-orange-500 stroke-orange-600';\r\n      case 'High': return 'fill-red-500 stroke-red-600';\r\n      default: return 'fill-gray-500 stroke-gray-600';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      <div className=\"relative h-[28rem]\">\r\n        <svg className=\"w-full h-full\" viewBox=\"0 0 600 350\">\r\n          {/* Grid lines */}\r\n          <defs>\r\n            <pattern id=\"correlationGrid\" width=\"50\" height=\"35\" patternUnits=\"userSpaceOnUse\">\r\n              <path\r\n                d=\"M 50 0 L 0 0 0 35\"\r\n                fill=\"none\"\r\n                stroke=\"rgb(229 231 235)\"\r\n                strokeWidth=\"0.5\"\r\n                className=\"dark:stroke-gray-600\"\r\n              />\r\n            </pattern>\r\n          </defs>\r\n          \r\n          <rect width=\"600\" height=\"350\" fill=\"url(#correlationGrid)\" />\r\n          \r\n          {/* Axes */}\r\n          <line x1=\"70\" y1=\"310\" x2=\"550\" y2=\"310\" stroke=\"rgb(107 114 128)\" strokeWidth=\"2\" />\r\n          <line x1=\"70\" y1=\"310\" x2=\"70\" y2=\"40\" stroke=\"rgb(107 114 128)\" strokeWidth=\"2\" />\r\n          \r\n          {/* Data points */}\r\n          {correlationPoints.map((point, index) => {\r\n            const x = 70 + (point.depression / maxValue) * 480;\r\n            const y = 310 - (point.anxiety / maxValue) * 270;\r\n            const radius = Math.max(Math.sqrt(point.depression + point.anxiety) * 3, 10);\r\n            \r\n            return (\r\n              <g key={index}>\r\n                <circle\r\n                  cx={x}\r\n                  cy={y}\r\n                  r={radius}\r\n                  className={`${getColor(point.severity)} opacity-70 hover:opacity-90 transition-opacity`}\r\n                  strokeWidth=\"2\"\r\n                />\r\n                <text\r\n                  x={x}\r\n                  y={y + 5}\r\n                  textAnchor=\"middle\"\r\n                  className=\"text-sm fill-white font-bold\"\r\n                >\r\n                  {point.depression + point.anxiety}\r\n                </text>\r\n              </g>\r\n            );\r\n          })}\r\n          \r\n          {/* Axis labels */}\r\n          <text x=\"310\" y=\"335\" textAnchor=\"middle\" className=\"text-sm font-medium fill-gray-700 dark:fill-gray-300\">\r\n            Depression Cases \r\n          </text>\r\n          <text x=\"40\" y=\"175\" textAnchor=\"middle\" transform=\"rotate(-90 40 175)\" className=\"text-sm font-medium fill-gray-700 dark:fill-gray-300\">\r\n             Anxiety Cases\r\n          </text>\r\n        </svg>\r\n      </div>\r\n      \r\n      {/* Legend */}\r\n      <div className=\"mt-4 flex justify-center space-x-4\">\r\n        {correlationPoints.map((point, index) => (\r\n          <div key={index} className=\"flex items-center space-x-2\">\r\n            <div className={`w-3 h-3 rounded-full ${getColor(point.severity).replace('fill-', 'bg-').replace('stroke-', 'border-').replace(' stroke-gray-600', '').replace(' stroke-green-600', '').replace(' stroke-yellow-600', '').replace(' stroke-orange-600', '').replace(' stroke-red-600', '')}`} />\r\n            <span className=\"text-xs text-gray-600 dark:text-gray-400\">{point.label}</span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Session Completion Funnel Chart\r\nconst FunnelChart: React.FC<{\r\n  title: string;\r\n  sessionStatus: AnalyticsData['sessionStatus'];\r\n}> = ({ title, sessionStatus }) => {\r\n  const stages = [\r\n    { label: 'Total Sessions', value: sessionStatus.total, color: 'bg-blue-500' },\r\n    { label: 'In Processing', value: sessionStatus.processing, color: 'bg-yellow-500' },\r\n    { label: 'Completed', value: sessionStatus.succeeded, color: 'bg-green-500' },\r\n    { label: 'Failed', value: sessionStatus.failed, color: 'bg-red-500' },\r\n  ];\r\n\r\n  const maxValue = sessionStatus.total || 1;\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n      <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-6\">{title}</h3>\r\n      \r\n      <div className=\"space-y-4\">\r\n        {stages.map((stage, index) => {\r\n          const width = (stage.value / maxValue) * 100;\r\n          const conversionRate = index > 0 ? ((stage.value / stages[0].value) * 100).toFixed(1) : '100.0';\r\n          \r\n          return (\r\n            <div key={index} className=\"relative\">\r\n              <div className=\"flex justify-between items-center mb-2\">\r\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                  {stage.label}\r\n                </span>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <span className=\"text-sm font-bold text-gray-900 dark:text-white\">\r\n                    {stage.value}\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                    ({conversionRate}%)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden\">\r\n                <div\r\n                  className={`h-full ${stage.color} transition-all duration-700 ease-out flex items-center justify-center relative`}\r\n                  style={{ width: `${width}%` }}\r\n                >\r\n                  {width > 20 && (\r\n                    <span className=\"text-xs font-medium text-white\">\r\n                      {stage.value}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Conversion arrow */}\r\n                {index < stages.length - 1 && (\r\n                  <div className=\"absolute right-2 top-1/2 transform -translate-y-1/2\">\r\n                    <svg className=\"w-4 h-4 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                      <path fillRule=\"evenodd\" d=\"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n                    </svg>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Summary */}\r\n      <div className=\"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n        <div className=\"grid grid-cols-2 gap-4 text-center\">\r\n          <div>\r\n            <div className=\"text-lg font-bold text-green-600 dark:text-green-400\">\r\n              {((sessionStatus.succeeded / sessionStatus.total) * 100).toFixed(1)}%\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Success Rate</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"text-lg font-bold text-red-600 dark:text-red-400\">\r\n              {((sessionStatus.failed / sessionStatus.total) * 100).toFixed(1)}%\r\n            </div>\r\n            <div className=\"text-xs text-gray-600 dark:text-gray-400\">Failure Rate</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// User statistics table component\r\nconst UserStatsTable: React.FC<{\r\n  userStats: AnalyticsData['userStats'];\r\n}> = ({ userStats }) => {\r\n  const [showConfidenceModal, setShowConfidenceModal] = useState(false);\r\n  const [showRiskModal, setShowRiskModal] = useState(false);\r\n  \r\n  const formatDate = (dateString: string) => {\r\n    const date = new Date(dateString);\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  const getRiskColor = (riskLevel: string, count: number) => {\r\n    if (count === 0) return 'text-gray-400';\r\n    switch (riskLevel) {\r\n      case 'low': return 'text-green-600';\r\n      case 'medium': return 'text-yellow-600';\r\n      case 'high': return 'text-red-600';\r\n      default: return 'text-gray-600';\r\n    }\r\n  };\r\n\r\n  // Calculate summary stats\r\n  const totalUsers = userStats.length;\r\n  const avgSessionsPerUser = totalUsers > 0 \r\n    ? Math.round(userStats.reduce((sum, u) => sum + u.totalSessions, 0) / totalUsers * 10) / 10\r\n    : 0;\r\n  const topPerformer = userStats.length > 0 \r\n    ? userStats.reduce((best, current) => \r\n        current.avgConfidence > best.avgConfidence ? current : best, userStats[0])\r\n    : null;\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 overflow-visible\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"text-lg font-medium text-gray-900 dark:text-white flex items-center\">\r\n          <Users className=\"h-5 w-5 mr-2 text-blue-500\" />\r\n          Per-User Analytics\r\n        </h3>\r\n        \r\n        {/* Summary stats */}\r\n        <div className=\"flex space-x-6 text-sm\">\r\n          <div className=\"text-center\">\r\n            <div className=\"font-semibold text-gray-900 dark:text-white\">{totalUsers}</div>\r\n            <div className=\"text-gray-600 dark:text-gray-400\">Total Users</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"font-semibold text-gray-900 dark:text-white\">{avgSessionsPerUser}</div>\r\n            <div className=\"text-gray-600 dark:text-gray-400\">Avg Sessions</div>\r\n          </div>\r\n          {topPerformer && (\r\n            <div className=\"text-center\">\r\n              <div className=\"font-semibold text-blue-600\">{(topPerformer.avgConfidence * 100).toFixed(1)}%</div>\r\n              <div className=\"text-gray-600 dark:text-gray-400\">Highest Avg Confidence</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {userStats.length === 0 ? (\r\n        <p className=\"text-gray-500 dark:text-gray-400 text-center py-8\">\r\n          No user data available\r\n        </p>\r\n      ) : (\r\n        <div>\r\n          {/* Risk Distribution Legend */}\r\n          <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\r\n                Risk Distribution Legend:\r\n              </span>\r\n              <div className=\"flex items-center space-x-3\">\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded text-xs font-medium\">\r\n                    L\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">Low Risk</span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded text-xs font-medium\">\r\n                    M\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">Medium Risk</span>\r\n                </div>\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <span className=\"px-2 py-1 bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded text-xs font-medium\">\r\n                    H\r\n                  </span>\r\n                  <span className=\"text-xs text-gray-600 dark:text-gray-400\">High Risk</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"overflow-x-auto overflow-y-visible relative\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"border-b border-gray-200 dark:border-gray-700\">\r\n                <th className=\"text-left py-3 px-2 font-medium text-gray-900 dark:text-white w-48\">\r\n                  User ID\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  Sessions\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  <div className=\"flex flex-col items-center\">\r\n                    <div className=\"flex items-center space-x-1\">\r\n                      <span>Risk Distribution</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowRiskModal(true)}\r\n                        className=\"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                        aria-label=\"Show Risk Distribution information\"\r\n                      >\r\n                        <Info className=\"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer\" />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </th>\r\n                <th className=\"text-center py-3 px-2 font-medium text-gray-900 dark:text-white relative\">\r\n                  <div className=\"flex flex-col items-center\">\r\n                    <div className=\"flex items-center space-x-1\">\r\n                      <span>Avg Confidence</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowConfidenceModal(true)}\r\n                        className=\"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                        aria-label=\"Show Average Confidence information\"\r\n                      >\r\n                        <Info className=\"h-3 w-3 text-gray-400 hover:text-blue-500 cursor-pointer\" />\r\n                      </button>\r\n                    </div>\r\n                    <span className=\"text-xs font-normal text-gray-500 dark:text-gray-400 mt-1\">\r\n                      (Analysis accuracy 0-100%)\r\n                    </span>\r\n                  </div>\r\n                </th>\r\n                <th className=\"text-right py-3 px-2 font-medium text-gray-900 dark:text-white\">\r\n                  Last Activity\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {userStats.map((user, index) => (\r\n                <tr \r\n                  key={user.userId}\r\n                  className={`border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors ${\r\n                    index % 2 === 0 ? 'bg-gray-50 dark:bg-gray-800' : 'bg-white dark:bg-gray-900'\r\n                  }`}\r\n                >\r\n                  <td className=\"py-3 px-2\">\r\n                    <div className=\"font-mono text-sm text-gray-900 dark:text-white\">\r\n                      <div className=\"truncate max-w-[200px]\" title={user.userId}>\r\n                        {user.userId}\r\n                      </div>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {user.totalSessions}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                      {user.successfulSessions} successful\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"flex justify-center space-x-2 text-xs\">\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('low', user.riskDistribution.low)}`}>\r\n                        L:{user.riskDistribution.low}\r\n                      </span>\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('medium', user.riskDistribution.medium)}`}>\r\n                        M:{user.riskDistribution.medium}\r\n                      </span>\r\n                      <span className={`px-1 py-0.5 rounded ${getRiskColor('high', user.riskDistribution.high)}`}>\r\n                        H:{user.riskDistribution.high}\r\n                      </span>\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-center\">\r\n                    <div className=\"text-gray-900 dark:text-white font-medium\">\r\n                      {(user.avgConfidence * 100).toFixed(1)}%\r\n                    </div>\r\n                  </td>\r\n                  <td className=\"py-3 px-2 text-right\">\r\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                      {formatDate(user.lastActivity)}\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Average Confidence Modal */}\r\n      {showConfidenceModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowConfidenceModal(false)}>\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Average Confidence Information</h3>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowConfidenceModal(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                aria-label=\"Close modal\"\r\n              >\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-3 text-sm text-gray-700 dark:text-gray-300\">\r\n              <div className=\"font-medium text-center text-gray-900 dark:text-white mb-3\">Average Confidence Calculation:</div>\r\n              <div className=\"space-y-2\">\r\n                <div> Calculated from AI model confidence scores</div>\r\n                <div> Averaged across all successful sessions per user</div>\r\n                <div> Related to risk distribution/evaluation accuracy</div>\r\n                <div> Higher values indicate more reliable assessments</div>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600\">\r\n                Analysis accuracy range: 0-100%\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Risk Distribution Modal */}\r\n      {showRiskModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowRiskModal(false)}>\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl\" onClick={(e) => e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Risk Distribution Information</h3>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowRiskModal(false)}\r\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded\"\r\n                aria-label=\"Close modal\"\r\n              >\r\n                <X className=\"h-5 w-5\" />\r\n              </button>\r\n            </div>\r\n            <div className=\"space-y-3 text-sm text-gray-700 dark:text-gray-300\">\r\n              <div className=\"font-medium text-center text-gray-900 dark:text-white mb-3\">Risk Distribution Explanation:</div>\r\n              <div className=\"space-y-2\">\r\n                <div> Shows the distribution of risk levels across all user sessions</div>\r\n                <div> Visualized as colored dots representing risk categories</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-green-500 rounded-full mr-1\"></span>Low Risk: Minimal behavioral health concerns</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>Medium Risk: Moderate concerns requiring attention</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-red-500 rounded-full mr-1\"></span>High Risk: Significant concerns requiring intervention</div>\r\n                <div> <span className=\"inline-block w-2 h-2 bg-gray-400 rounded-full mr-1\"></span>Unknown: Risk level could not be determined</div>\r\n              </div>\r\n              <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center mt-4 pt-3 border-t border-gray-200 dark:border-gray-600\">\r\n                Analysis accuracy: 0-100% (higher confidence = more reliable risk assessment)\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const ControlPanel: React.FC = () => {\r\n  const [analytics, setAnalytics] = useState<AnalyticsData | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<AppError | null>(null);\r\n  const [lastRefresh, setLastRefresh] = useState<Date>(new Date());\r\n  const { announceToScreenReader } = useAccessibility();\r\n\r\n  // Get refresh interval from environment variable (default to 69 seconds)\r\n  const refreshInterval = parseInt(import.meta.env.VITE_CONTROL_PANEL_REFRESH_INTERVAL || '69') * 1000;\r\n\r\n  // Load all sessions data for analytics\r\n  const loadAnalytics = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      \r\n      // Get all sessions from all users for system-wide analytics\r\n      let allSessions: ImportedSessionData[] = [];\r\n      \r\n      try {\r\n        // Add cache-busting timestamp to ensure fresh data\r\n        const timestamp = Date.now();\r\n        console.log(' ControlPanel: Fetching data with cache-buster:', timestamp);\r\n        \r\n        const allSessionsResponse = await apiService.getAllSessions();\r\n        allSessions = allSessionsResponse.sessions;\r\n        console.log(' ControlPanel: Fetched sessions data:', {\r\n          timestamp,\r\n          totalCount: allSessions.length,\r\n          responseCount: allSessionsResponse.count,\r\n          firstFewSessions: allSessions.slice(0, 3).map(s => ({\r\n            sessionId: s.sessionId,\r\n            userId: s.userId,\r\n            status: s.status,\r\n            createdAt: s.createdAt\r\n          }))\r\n        });\r\n      } catch (apiError) {\r\n        console.warn('getAllSessions endpoint not available:', apiError);\r\n        \r\n        // No fallback data - show empty state when API is unavailable\r\n        allSessions = [];\r\n      }\r\n      \r\n      const aggregatedData = aggregateSessionData(allSessions);\r\n      console.log(' ControlPanel: Aggregated analytics:', {\r\n        totalSessions: aggregatedData.overview.totalSessions,\r\n        uniqueUsers: aggregatedData.overview.uniqueUsers,\r\n        successRate: aggregatedData.overview.successRate,\r\n        sessionStatusBreakdown: aggregatedData.sessionStatus\r\n      });\r\n      setAnalytics(aggregatedData);\r\n      setLastRefresh(new Date());\r\n      \r\n      announceToScreenReader('Control panel data loaded successfully');\r\n    } catch (err) {\r\n      const appError = err as AppError;\r\n      setError(appError);\r\n      announceToScreenReader(`Error loading control panel data: ${appError.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [announceToScreenReader]);\r\n\r\n  // Load data on component mount\r\n  useEffect(() => {\r\n    loadAnalytics();\r\n  }, [loadAnalytics]);\r\n\r\n  // Auto-refresh data at specified interval\r\n  useEffect(() => {\r\n    console.log(' ControlPanel: Setting up auto-refresh with interval:', refreshInterval / 1000, 'seconds');\r\n    \r\n    const interval = setInterval(() => {\r\n      console.log(' ControlPanel: Auto-refresh triggered, loading state:', loading);\r\n      // Remove loading check to ensure refresh happens\r\n      loadAnalytics();\r\n    }, refreshInterval);\r\n\r\n    return () => {\r\n      console.log(' ControlPanel: Cleaning up auto-refresh interval');\r\n      clearInterval(interval);\r\n    }; // Cleanup on unmount\r\n  }, [loadAnalytics, refreshInterval]); // Keep loadAnalytics in dependencies but remove loading\r\n\r\n  // Retry error handler\r\n  const handleRetry = useCallback(() => {\r\n    setError(null);\r\n    loadAnalytics();\r\n  }, [loadAnalytics]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <div className=\"flex items-center space-x-3\">\r\n              <RefreshCw className=\"h-6 w-6 animate-spin text-blue-500\" />\r\n              <span className=\"text-lg text-gray-600 dark:text-gray-300\">\r\n                Loading control panel data...\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <div className=\"text-center\">\r\n              <AlertCircle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n              <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\r\n                Error Loading Control Panel\r\n              </h2>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\r\n                {error.message}\r\n              </p>\r\n              <button\r\n                onClick={handleRetry}\r\n                className=\"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\r\n              >\r\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                Retry\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!analytics) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <div className=\"flex items-center justify-center h-64\">\r\n            <span className=\"text-lg text-gray-600 dark:text-gray-300\">\r\n              No data available\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 p-4\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n                Summary\r\n              </h1>\r\n              <p className=\"text-gray-600 dark:text-gray-400 mt-2\">\r\n                System-wide analytics and insights from all users and sessions\r\n              </p>\r\n            </div>\r\n            \r\n            {/* Auto-refresh status and controls */}\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"text-right\">\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                  Last updated: {lastRefresh.toLocaleTimeString()}\r\n                </div>\r\n                <div className=\"text-xs text-gray-400 dark:text-gray-500\">\r\n                  Auto-refresh: {refreshInterval / 1000}s intervals\r\n                </div>\r\n              </div>\r\n              <div className=\"flex space-x-2\">\r\n                <button\r\n                  onClick={loadAnalytics}\r\n                  disabled={loading}\r\n                  className=\"inline-flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors text-sm\"\r\n                  aria-label=\"Refresh control panel data\"\r\n                >\r\n                  <RefreshCw className={`h-4 w-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                  Refresh\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Overview Metrics */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\r\n          <MetricCard\r\n            title=\"Total Sessions\"\r\n            value={analytics.overview.totalSessions}\r\n            subtitle=\"All time\"\r\n            icon={<Activity className=\"h-6 w-6\" />}\r\n            color=\"text-blue-600\"\r\n          />\r\n          <MetricCard\r\n            title=\"Unique Users\"\r\n            value={analytics.overview.uniqueUsers}\r\n            subtitle=\"Active users\"\r\n            icon={<Users className=\"h-6 w-6\" />}\r\n            color=\"text-green-600\"\r\n          />\r\n        </div>\r\n\r\n        {/* Charts Grid */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Risk Level Distribution */}\r\n          <div className=\"lg:col-span-2\">\r\n            <DistributionChart\r\n              title=\"Risk Level Distribution\"\r\n              data={[\r\n                { label: 'Low Risk', value: analytics.riskLevels.low, color: 'bg-green-500' },\r\n                { label: 'Medium Risk', value: analytics.riskLevels.medium, color: 'bg-yellow-500' },\r\n                { label: 'High Risk', value: analytics.riskLevels.high, color: 'bg-red-500' },\r\n                { label: 'Unknown', value: analytics.riskLevels.unknown, color: 'bg-gray-500' },\r\n              ]}\r\n              total={analytics.riskLevels.total}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Prediction Distribution */}\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\r\n          {/* Depression Score Distribution */}\r\n          <DistributionChart\r\n            title=\"Depression Score Distribution\"\r\n            data={[\r\n              { label: 'No to Mild', value: analytics.predictions.depression.no_to_mild, color: 'bg-green-500' },\r\n              { label: 'Mild to Moderate', value: analytics.predictions.depression.mild_to_moderate, color: 'bg-yellow-500' },\r\n              { label: 'Moderate to Severe', value: analytics.predictions.depression.moderate_to_severe, color: 'bg-orange-500' },\r\n              { label: 'Severe', value: analytics.predictions.depression.severe, color: 'bg-red-500' },\r\n            ]}\r\n            total={analytics.predictions.depression.total}\r\n          />\r\n\r\n          {/* Anxiety Score Distribution */}\r\n          <DistributionChart\r\n            title=\"Anxiety Score Distribution\"\r\n            data={[\r\n              { label: 'No or Minimal', value: analytics.predictions.anxiety.no_or_minimal, color: 'bg-green-500' },\r\n              { label: 'Mild', value: analytics.predictions.anxiety.mild, color: 'bg-yellow-500' },\r\n              { label: 'Moderate', value: analytics.predictions.anxiety.moderate, color: 'bg-orange-500' },\r\n              { label: 'Moderately Severe', value: analytics.predictions.anxiety.moderately_severe, color: 'bg-red-500' },\r\n              { label: 'Severe', value: analytics.predictions.anxiety.severe, color: 'bg-red-700' },\r\n            ]}\r\n            total={analytics.predictions.anxiety.total}\r\n          />\r\n        </div>\r\n\r\n        {/* Per-User Statistics */}\r\n        <div className=\"mb-8\">\r\n          <UserStatsTable userStats={analytics.userStats} />\r\n        </div>\r\n\r\n        {/* Metadata Correlation Analysis */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"mb-6\">\r\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\r\n              Demographic Correlation Analysis\r\n            </h2>\r\n            <p className=\"text-gray-600 dark:text-gray-400\">\r\n              Correlation between patient demographics and mental health outcomes (Depression & Anxiety cases)\r\n            </p>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Depression vs Anxiety Correlation - Featured First */}\r\n            <div className=\"lg:col-span-2\">\r\n              <CorrelationChart\r\n                title=\"Depression vs Anxiety Correlation\"\r\n                depressionData={analytics.predictions.depression}\r\n                anxietyData={analytics.predictions.anxiety}\r\n              />\r\n            </div>\r\n            \r\n            {/* Age Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Age Groups vs Mental Health Cases\"\r\n              subtitle=\"Distribution by age ranges showing depression and anxiety case rates\"\r\n              data={analytics.correlations.ageDistribution}\r\n            />\r\n            \r\n            {/* Gender Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Gender vs Mental Health Cases\"\r\n              subtitle=\"Distribution by gender identity showing case rates\"\r\n              data={analytics.correlations.genderDistribution}\r\n            />\r\n            \r\n            {/* Weight Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Weight Groups vs Mental Health Cases\"\r\n              subtitle=\"Distribution by weight ranges showing case rates\"\r\n              data={analytics.correlations.weightDistribution}\r\n            />\r\n            \r\n            {/* Race Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Race vs Mental Health Cases\"\r\n              subtitle=\"Distribution by racial identity showing case rates\"\r\n              data={analytics.correlations.raceDistribution}\r\n            />\r\n            \r\n            {/* Ethnicity Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Ethnicity vs Mental Health Cases\"\r\n              subtitle=\"Distribution by ethnic background showing case rates\"\r\n              data={analytics.correlations.ethnicityDistribution}\r\n            />\r\n            \r\n            {/* Language Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Primary Language vs Mental Health Cases\"\r\n              subtitle=\"Distribution by language preference showing case rates\"\r\n              data={analytics.correlations.languageDistribution}\r\n            />\r\n            \r\n            {/* Geographic Correlation */}\r\n            <MetadataCorrelationChart\r\n              title=\"Geographic Region vs Mental Health Cases\"\r\n              subtitle=\"Distribution by ZIP code regions showing case rates\"\r\n              data={analytics.correlations.zipCodeDistribution}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Session Analytics */}\r\n        <div className=\"mb-8\">\r\n          <FunnelChart\r\n            title=\"Session Completion Funnel\"\r\n            sessionStatus={analytics.sessionStatus}\r\n          />\r\n        </div>\r\n\r\n        {/* Sessions Over Time - Full Width */}\r\n        <div className=\"mb-8\">\r\n          <TimeSeriesChart\r\n            title=\"Sessions Over Time (7 Days)\"\r\n            data={analytics.timeData}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ControlPanel;","import React, { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { ArrowRight, MessageCircle } from 'lucide-react';\n\n/**\n * AgentExperience Component - Redirects to Speech Avatar Experience\n * \n * This component now redirects users to the new Speech Avatar experience\n * which provides real-time AI agent interactions using Azure Speech services.\n */\nexport const AgentExperience: React.FC = () => {\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Auto-redirect after a short delay to show the user what's happening\n    const timer = setTimeout(() => {\n      navigate('/speech-avatar-experience');\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, [navigate]);\n\n  const handleRedirectNow = () => {\n    navigate('/speech-avatar-experience');\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 max-w-md w-full mx-4 text-center\">\n        <div className=\"mb-6\">\n          <div className=\"bg-blue-100 dark:bg-blue-900 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4\">\n            <MessageCircle className=\"h-8 w-8 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n            Agent Experience Upgraded\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-300\">\n            We've upgraded the agent experience with our new Speech Avatar technology \n            for more natural, real-time conversations.\n          </p>\n        </div>\n\n        <div className=\"space-y-4\">\n          <button\n            onClick={handleRedirectNow}\n            className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2\"\n          >\n            Go to Speech Avatar Experience\n            <ArrowRight className=\"h-4 w-4\" />\n          </button>\n\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            Redirecting automatically in a few seconds...\n          </p>\n        </div>\n\n        <div className=\"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n          <h3 className=\"font-medium text-gray-900 dark:text-white mb-2\">\n            What's New:\n          </h3>\n          <ul className=\"text-sm text-gray-600 dark:text-gray-300 space-y-1 text-left\">\n            <li> Real-time speech interaction</li>\n            <li> Visual avatar representation</li>\n            <li> Enhanced behavioral health assessments</li>\n            <li> Improved agent coordination</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AgentExperience;\n","// Audio Device Management Service\r\n// Handles microphone device selection and permissions\r\n\r\nexport interface AudioDevice {\r\n  deviceId: string;\r\n  label: string;\r\n  kind: MediaDeviceKind;\r\n  groupId: string;\r\n  isDefault?: boolean;\r\n}\r\n\r\nexport interface AudioPermissionStatus {\r\n  granted: boolean;\r\n  error?: string;\r\n  needsUserGesture?: boolean;\r\n}\r\n\r\nexport class AudioDeviceService {\r\n  private static instance: AudioDeviceService;\r\n  private availableDevices: AudioDevice[] = [];\r\n  private selectedDeviceId: string = '';\r\n  private hasPermission: boolean = false;\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): AudioDeviceService {\r\n    if (!AudioDeviceService.instance) {\r\n      AudioDeviceService.instance = new AudioDeviceService();\r\n    }\r\n    return AudioDeviceService.instance;\r\n  }\r\n\r\n  // Check if browser supports necessary APIs\r\n  static isSupported(): boolean {\r\n    return !!(\r\n      navigator.mediaDevices &&\r\n      typeof navigator.mediaDevices.getUserMedia === 'function' &&\r\n      typeof navigator.mediaDevices.enumerateDevices === 'function' &&\r\n      window.AudioContext\r\n    );\r\n  }\r\n\r\n  // Request microphone permission\r\n  async requestPermission(): Promise<AudioPermissionStatus> {\r\n    try {\r\n      if (!AudioDeviceService.isSupported()) {\r\n        return {\r\n          granted: false,\r\n          error: 'Browser does not support required audio APIs'\r\n        };\r\n      }\r\n\r\n      // Request access to get device labels (requires user gesture)\r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: true \r\n      });\r\n      \r\n      // Stop the stream immediately - we just needed permission\r\n      stream.getTracks().forEach(track => track.stop());\r\n      \r\n      this.hasPermission = true;\r\n      console.log(' Microphone permission granted');\r\n      \r\n      return { granted: true };\r\n\r\n    } catch (error) {\r\n      console.error(' Failed to get microphone permission:', error);\r\n      \r\n      let errorMessage = 'Failed to access microphone';\r\n      let needsUserGesture = false;\r\n\r\n      if (error instanceof Error) {\r\n        if (error.name === 'NotAllowedError') {\r\n          errorMessage = 'Microphone access denied. Please allow microphone access in your browser settings.';\r\n        } else if (error.name === 'NotFoundError') {\r\n          errorMessage = 'No microphone found. Please connect a microphone and try again.';\r\n        } else if (error.name === 'NotReadableError') {\r\n          errorMessage = 'Microphone is already in use by another application.';\r\n        } else if (error.name === 'OverconstrainedError') {\r\n          errorMessage = 'Microphone does not meet the required constraints.';\r\n        } else if (error.name === 'SecurityError') {\r\n          errorMessage = 'Microphone access blocked by security policy.';\r\n        } else if (error.name === 'AbortError') {\r\n          errorMessage = 'Microphone access request was interrupted.';\r\n          needsUserGesture = true;\r\n        }\r\n      }\r\n\r\n      return {\r\n        granted: false,\r\n        error: errorMessage,\r\n        needsUserGesture\r\n      };\r\n    }\r\n  }\r\n\r\n  // Get available audio input devices\r\n  async getAvailableDevices(): Promise<AudioDevice[]> {\r\n    try {\r\n      if (!this.hasPermission) {\r\n        const permission = await this.requestPermission();\r\n        if (!permission.granted) {\r\n          throw new Error(permission.error || 'Permission required to list devices');\r\n        }\r\n      }\r\n\r\n      const devices = await navigator.mediaDevices.enumerateDevices();\r\n      \r\n      this.availableDevices = devices\r\n        .filter(device => device.kind === 'audioinput')\r\n        .map((device, index) => ({\r\n          deviceId: device.deviceId,\r\n          label: device.label || `Microphone ${index + 1}`,\r\n          kind: device.kind,\r\n          groupId: device.groupId,\r\n          isDefault: device.deviceId === 'default'\r\n        }));\r\n\r\n      console.log(` Found ${this.availableDevices.length} audio input devices:`, this.availableDevices);\r\n      \r\n      // Auto-select default device if none selected\r\n      if (!this.selectedDeviceId && this.availableDevices.length > 0) {\r\n        const defaultDevice = this.availableDevices.find(d => d.isDefault) || this.availableDevices[0];\r\n        this.selectedDeviceId = defaultDevice.deviceId;\r\n      }\r\n\r\n      return this.availableDevices;\r\n\r\n    } catch (error) {\r\n      console.error(' Failed to enumerate audio devices:', error);\r\n      throw new Error('Failed to get available microphones');\r\n    }\r\n  }\r\n\r\n  // Select a specific audio device\r\n  setSelectedDevice(deviceId: string): void {\r\n    const device = this.availableDevices.find(d => d.deviceId === deviceId);\r\n    if (device) {\r\n      this.selectedDeviceId = deviceId;\r\n      console.log(` Selected audio device: ${device.label} (${deviceId})`);\r\n    } else {\r\n      console.warn(` Audio device not found: ${deviceId}`);\r\n    }\r\n  }\r\n\r\n  // Get currently selected device\r\n  getSelectedDevice(): AudioDevice | null {\r\n    return this.availableDevices.find(d => d.deviceId === this.selectedDeviceId) || null;\r\n  }\r\n\r\n  // Create MediaStream with selected device\r\n  async createAudioStream(constraints?: MediaTrackConstraints): Promise<MediaStream> {\r\n    try {\r\n      if (!this.hasPermission) {\r\n        const permission = await this.requestPermission();\r\n        if (!permission.granted) {\r\n          throw new Error(permission.error || 'Microphone permission required');\r\n        }\r\n      }\r\n\r\n      const audioConstraints: MediaTrackConstraints = {\r\n        deviceId: this.selectedDeviceId ? { exact: this.selectedDeviceId } : undefined,\r\n        sampleRate: 24000,\r\n        channelCount: 1,\r\n        echoCancellation: true,\r\n        noiseSuppression: true,\r\n        autoGainControl: true,\r\n        ...constraints\r\n      };\r\n\r\n      console.log(' Creating audio stream with constraints:', audioConstraints);\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        audio: audioConstraints\r\n      });\r\n\r\n      const track = stream.getAudioTracks()[0];\r\n      if (track) {\r\n        console.log(` Audio stream created successfully using: ${track.label}`);\r\n        console.log(' Track settings:', track.getSettings());\r\n      }\r\n\r\n      return stream;\r\n\r\n    } catch (error) {\r\n      console.error(' Failed to create audio stream:', error);\r\n      \r\n      // If specific device fails, try with default\r\n      if (this.selectedDeviceId) {\r\n        console.log(' Trying with default audio device...');\r\n        this.selectedDeviceId = '';\r\n        return this.createAudioStream(constraints);\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Test audio input levels\r\n  async testAudioInput(durationMs: number = 10000, enablePlayback: boolean = true): Promise<boolean> {\r\n    try {\r\n      const stream = await this.createAudioStream();\r\n      \r\n      return new Promise((resolve) => {\r\n        const audioContext = new AudioContext();\r\n        const source = audioContext.createMediaStreamSource(stream);\r\n        const analyser = audioContext.createAnalyser();\r\n        \r\n        // Create gain node for playback volume control\r\n        let gainNode: GainNode | null = null;\r\n        \r\n        if (enablePlayback) {\r\n          gainNode = audioContext.createGain();\r\n          gainNode.gain.value = 0.3; // 30% volume to prevent feedback\r\n          \r\n          // Connect to speakers for playback (user can hear what mic picks up)\r\n          source.connect(gainNode);\r\n          gainNode.connect(audioContext.destination);\r\n          console.log(' Audio test started - You should hear your microphone input through speakers at 30% volume');\r\n        } else {\r\n          console.log(' Audio test started - Playback disabled');\r\n        }\r\n        \r\n        analyser.fftSize = 256;\r\n        source.connect(analyser);\r\n        \r\n        const dataArray = new Uint8Array(analyser.frequencyBinCount);\r\n        let hasAudioInput = false;\r\n        \r\n        const checkAudio = () => {\r\n          analyser.getByteFrequencyData(dataArray);\r\n          const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;\r\n          \r\n          // Much lower threshold for more sensitive audio detection - baseline noise is around 0.1-1\r\n          if (average > 0.5) { // Very sensitive threshold for detecting any audio input\r\n            hasAudioInput = true;\r\n          }\r\n          \r\n          console.log(` Audio test - Frequency average: ${average.toFixed(3)}, Input detected: ${hasAudioInput}`);\r\n        };\r\n        \r\n        const interval = setInterval(checkAudio, 100);\r\n        \r\n        setTimeout(() => {\r\n          clearInterval(interval);\r\n          \r\n          // Disconnect playback before stopping\r\n          if (enablePlayback && gainNode) {\r\n            source.disconnect(gainNode);\r\n            gainNode.disconnect(audioContext.destination);\r\n          }\r\n          \r\n          stream.getTracks().forEach(track => track.stop());\r\n          audioContext.close();\r\n          \r\n          console.log(` Audio test completed - Input detected: ${hasAudioInput ? 'YES' : 'NO'}`);\r\n          resolve(hasAudioInput);\r\n        }, durationMs);\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error(' Audio test failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Get permission status without requesting\r\n  async getPermissionStatus(): Promise<'granted' | 'denied' | 'prompt'> {\r\n    try {\r\n      // Check if we can enumerate devices (indicates permission)\r\n      const devices = await navigator.mediaDevices.enumerateDevices();\r\n      const hasLabeledDevices = devices.some(device => device.label !== '');\r\n      \r\n      if (hasLabeledDevices) {\r\n        return 'granted';\r\n      }\r\n\r\n      // Try to check permission API if available\r\n      if ('permissions' in navigator) {\r\n        const result = await (navigator.permissions as any).query({ name: 'microphone' });\r\n        return result.state;\r\n      }\r\n\r\n      return 'prompt';\r\n    } catch (error) {\r\n      console.warn('Could not determine permission status:', error);\r\n      return 'prompt';\r\n    }\r\n  }\r\n\r\n  // Reset service state\r\n  reset(): void {\r\n    this.availableDevices = [];\r\n    this.selectedDeviceId = '';\r\n    this.hasPermission = false;\r\n  }\r\n}\r\n\r\nexport default AudioDeviceService;","// Azure Voice Live API Service for Behavioral Health System\r\n// Based on Azure AI Voice Live Python SDK patterns\r\n\r\nimport { EventEmitter } from 'events';\r\nimport { AudioDeviceService } from './audioDeviceService';\r\n\r\n// ===== Type Definitions =====\r\n\r\nexport interface AgentMessage {\r\n  agentName: string;\r\n  content: string;\r\n  timestamp: string;\r\n  confidence?: number;\r\n  suggestedActions?: string[];\r\n}\r\n\r\nexport interface SpeechAvatarConfig {\r\n  endpoint: string;\r\n  apiKey: string;\r\n  model: string;\r\n  voice: string;\r\n  instructions: string;\r\n  agentPersonality?: {\r\n    name: string;\r\n    role: string;\r\n    traits: string[];\r\n  };\r\n}\r\n\r\nexport interface AudioStreamConfig {\r\n  sampleRate: number;\r\n  channels: number;\r\n  bitDepth: number;\r\n  format: string;\r\n}\r\n\r\nexport interface AvatarVisualConfig {\r\n  avatarId?: string;\r\n  customAvatar?: boolean;\r\n  videoSize: { width: number; height: number };\r\n  backgroundColor?: string;\r\n}\r\n\r\nexport interface SpeechSessionEvent {\r\n  type: 'session.created' | 'session.updated' | 'input_audio_buffer.speech_started' | \r\n        'input_audio_buffer.speech_stopped' | 'response.created' | 'response.audio.delta' | \r\n        'response.audio.done' | 'response.done' | 'error' | 'conversation.item.created';\r\n  data?: unknown;\r\n  timestamp: string;\r\n}\r\n\r\nexport interface VoiceLiveConfig {\r\n  endpoint: string;\r\n  apiKey: string;\r\n  model: string;\r\n  voice?: string;\r\n  apiVersion?: string;\r\n}\r\n\r\nexport interface SessionConfig {\r\n  modalities?: ('text' | 'audio')[];\r\n  instructions?: string;\r\n  voice?: {\r\n    name: string;\r\n    type?: string;\r\n  };\r\n  input_audio_format?: string;\r\n  output_audio_format?: string;\r\n  input_audio_transcription?: {\r\n    model: string;\r\n  };\r\n  turn_detection?: {\r\n    type: string;\r\n    threshold?: number;\r\n    prefix_padding_ms?: number;\r\n    silence_duration_ms?: number;\r\n  };\r\n  max_response_output_tokens?: number;\r\n  temperature?: number;\r\n  tools?: any[];\r\n}\r\n\r\nexport interface ResponseCreateParams {\r\n  modalities?: ('text' | 'audio')[];\r\n  instructions?: string;\r\n  voice?: string;\r\n  output_audio_format?: string;\r\n  tools?: any[];\r\n  tool_choice?: string;\r\n  temperature?: number;\r\n  max_output_tokens?: number;\r\n}\r\n\r\nexport interface ConversationItem {\r\n  id?: string;\r\n  type: 'message' | 'function_call' | 'function_call_output';\r\n  role?: 'user' | 'assistant' | 'system';\r\n  content?: Array<{\r\n    type: 'text' | 'audio';\r\n    text?: string;\r\n    audio?: string;\r\n    transcript?: string;\r\n  }>;\r\n  call_id?: string;\r\n  name?: string;\r\n  arguments?: string;\r\n  output?: string;\r\n}\r\n\r\nexport interface ClientEvent {\r\n  type: string;\r\n  event_id?: string;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface ServerEvent {\r\n  type: string;\r\n  event_id?: string;\r\n  session?: any;\r\n  response?: any;\r\n  item?: any;\r\n  delta?: any;\r\n  error?: any;\r\n  [key: string]: any;\r\n}\r\n\r\n// ===== Resource Classes =====\r\n\r\nexport class SessionResource {\r\n  constructor(private connection: VoiceLiveConnection) {}\r\n\r\n  async update(session: SessionConfig, eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'session.update',\r\n      session,\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n}\r\n\r\nexport class ResponseResource {\r\n  constructor(private connection: VoiceLiveConnection) {}\r\n\r\n  async create(\r\n    response?: ResponseCreateParams,\r\n    eventId?: string,\r\n    additionalInstructions?: string\r\n  ): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'response.create',\r\n      response,\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    if (additionalInstructions) {\r\n      event.additional_instructions = additionalInstructions;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n\r\n  async cancel(responseId?: string, eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'response.cancel',\r\n    };\r\n    if (responseId) {\r\n      event.response_id = responseId;\r\n    }\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n}\r\n\r\nexport class InputAudioBufferResource {\r\n  constructor(private connection: VoiceLiveConnection) {}\r\n\r\n  async append(audio: string, eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'input_audio_buffer.append',\r\n      audio,\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n\r\n  async commit(eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'input_audio_buffer.commit',\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n\r\n  async clear(eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'input_audio_buffer.clear',\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n}\r\n\r\nexport class OutputAudioBufferResource {\r\n  constructor(private connection: VoiceLiveConnection) {}\r\n\r\n  async clear(eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'output_audio_buffer.clear',\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n}\r\n\r\nexport class ConversationItemResource {\r\n  constructor(private connection: VoiceLiveConnection) {}\r\n\r\n  async create(\r\n    item: ConversationItem,\r\n    previousItemId?: string,\r\n    eventId?: string\r\n  ): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'conversation.item.create',\r\n      item,\r\n    };\r\n    if (previousItemId) {\r\n      event.previous_item_id = previousItemId;\r\n    }\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n\r\n  async delete(itemId: string, eventId?: string): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'conversation.item.delete',\r\n      item_id: itemId,\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n\r\n  async truncate(\r\n    itemId: string,\r\n    audioEndMs: number,\r\n    contentIndex: number,\r\n    eventId?: string\r\n  ): Promise<void> {\r\n    const event: ClientEvent = {\r\n      type: 'conversation.item.truncate',\r\n      item_id: itemId,\r\n      audio_end_ms: audioEndMs,\r\n      content_index: contentIndex,\r\n    };\r\n    if (eventId) {\r\n      event.event_id = eventId;\r\n    }\r\n    await this.connection.send(event);\r\n  }\r\n}\r\n\r\nexport class ConversationResource {\r\n  public readonly item: ConversationItemResource;\r\n\r\n  constructor(connection: VoiceLiveConnection) {\r\n    this.item = new ConversationItemResource(connection);\r\n  }\r\n}\r\n\r\n// ===== Main Connection Class =====\r\n\r\nexport class VoiceLiveConnection extends EventEmitter {\r\n  private websocket: WebSocket | null = null;\r\n  private sessionId: string | null = null;\r\n  private isConnected = false;\r\n  private isSessionReady = false;\r\n  private sessionReadyResolve: ((value: void) => void) | null = null;\r\n  private currentAudioStream: MediaStream | null = null;\r\n  private mediaRecorder: MediaRecorder | null = null;\r\n  private audioContext: AudioContext | null = null;\r\n  private audioWorkletNode: AudioWorkletNode | null = null;\r\n  public audioLevelCallback: ((levels: { average: number; peak: number; active: boolean }) => void) | null = null;\r\n\r\n  // Resource interfaces\r\n  public readonly session: SessionResource;\r\n  public readonly response: ResponseResource;\r\n  public readonly inputAudioBuffer: InputAudioBufferResource;\r\n  public readonly outputAudioBuffer: OutputAudioBufferResource;\r\n  public readonly conversation: ConversationResource;\r\n\r\n  constructor(private config: VoiceLiveConfig) {\r\n    super();\r\n    \r\n    // Initialize resources\r\n    this.session = new SessionResource(this);\r\n    this.response = new ResponseResource(this);\r\n    this.inputAudioBuffer = new InputAudioBufferResource(this);\r\n    this.outputAudioBuffer = new OutputAudioBufferResource(this);\r\n    this.conversation = new ConversationResource(this);\r\n  }\r\n\r\n  async connect(): Promise<void> {\r\n    if (this.isConnected) {\r\n      throw new Error('Already connected');\r\n    }\r\n\r\n    try {\r\n      const wsUrl = this.buildWebSocketUrl();\r\n      console.log(' Connecting to Azure Voice Live API:', wsUrl.toString());\r\n      \r\n      this.websocket = new WebSocket(wsUrl.toString());\r\n      \r\n      return new Promise((resolve, reject) => {\r\n        if (!this.websocket) {\r\n          reject(new Error('Failed to create WebSocket'));\r\n          return;\r\n        }\r\n\r\n        this.websocket.onopen = () => {\r\n          console.log(' WebSocket connected to Azure Voice Live API');\r\n          this.isConnected = true;\r\n          this.setupMessageHandlers();\r\n          resolve();\r\n        };\r\n\r\n        this.websocket.onerror = (error) => {\r\n          console.error(' WebSocket connection error:', error);\r\n          this.isConnected = false;\r\n          \r\n          // Provide more specific error message for common Azure issues\r\n          let errorMessage = 'WebSocket connection failed';\r\n          if (this.websocket?.readyState === WebSocket.CLOSED) {\r\n            errorMessage = 'Azure Voice Live API insufficient resources (service may be overloaded)';\r\n          }\r\n          \r\n          reject(new Error(errorMessage));\r\n        };\r\n\r\n        this.websocket.onclose = (event) => {\r\n          console.log(` WebSocket closed: ${event.code} - ${event.reason}`);\r\n          \r\n          // Provide more detailed information about close codes\r\n          let closeReason = 'Unknown reason';\r\n          switch (event.code) {\r\n            case 1000:\r\n              closeReason = 'Normal closure';\r\n              break;\r\n            case 1006:\r\n              closeReason = 'Connection lost abnormally (likely insufficient resources or network issue)';\r\n              break;\r\n            case 1011:\r\n              closeReason = 'Server error (insufficient resources)';\r\n              break;\r\n            case 1012:\r\n              closeReason = 'Service restart';\r\n              break;\r\n            case 1013:\r\n              closeReason = 'Try again later (service overloaded)';\r\n              break;\r\n            default:\r\n              closeReason = `Close code ${event.code}: ${event.reason || 'No additional information'}`;\r\n          }\r\n          \r\n          console.log(` Close reason: ${closeReason}`);\r\n          \r\n          this.isConnected = false;\r\n          this.isSessionReady = false;\r\n          this.cleanup();\r\n          this.emit('disconnected', { \r\n            code: event.code, \r\n            reason: event.reason || closeReason,\r\n            wasClean: event.wasClean \r\n          });\r\n        };\r\n      });\r\n    } catch (error) {\r\n      throw new Error(`Failed to connect: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n\r\n  async waitForSessionReady(): Promise<void> {\r\n    if (this.isSessionReady) {\r\n      return;\r\n    }\r\n    \r\n    return new Promise((resolve) => {\r\n      this.sessionReadyResolve = resolve;\r\n    });\r\n  }\r\n\r\n  private buildWebSocketUrl(): URL {\r\n    const wsUrl = new URL(this.config.endpoint.replace('https://', 'wss://'));\r\n    wsUrl.pathname = '/voice-live/realtime';\r\n    wsUrl.searchParams.set('api-version', this.config.apiVersion || '2025-05-01-preview');\r\n    wsUrl.searchParams.set('model', this.config.model);\r\n    wsUrl.searchParams.set('api-key', this.config.apiKey);\r\n    return wsUrl;\r\n  }\r\n\r\n  private setupMessageHandlers(): void {\r\n    if (!this.websocket) return;\r\n\r\n    this.websocket.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        this.handleServerEvent(data);\r\n      } catch (error) {\r\n        console.error(' Failed to parse WebSocket message:', error);\r\n        this.emit('error', new Error('Failed to parse server message'));\r\n      }\r\n    };\r\n  }\r\n\r\n  private handleServerEvent(data: ServerEvent): void {\r\n    console.log(` Received event: ${data.type}`);\r\n    \r\n    switch (data.type) {\r\n      case 'session.created':\r\n      case 'session.updated':\r\n        this.sessionId = data.session?.id || null;\r\n        console.log(` Session ready: ${this.sessionId}`);\r\n        \r\n        if (!this.isSessionReady) {\r\n          this.isSessionReady = true;\r\n          if (this.sessionReadyResolve) {\r\n            this.sessionReadyResolve();\r\n            this.sessionReadyResolve = null;\r\n          }\r\n        }\r\n        this.emit('session.ready', data);\r\n        break;\r\n\r\n      case 'input_audio_buffer.speech_started':\r\n        console.log(' User started speaking');\r\n        this.emit('speech.started');\r\n        break;\r\n\r\n      case 'input_audio_buffer.speech_stopped':\r\n        console.log(' User stopped speaking');\r\n        this.emit('speech.stopped');\r\n        break;\r\n\r\n      case 'response.created':\r\n        console.log(' Agent response created');\r\n        this.emit('response.created', data);\r\n        break;\r\n\r\n      case 'response.audio.delta':\r\n        if (data.delta?.audio) {\r\n          this.emit('audio.delta', data.delta.audio);\r\n        }\r\n        break;\r\n\r\n      case 'response.audio.done':\r\n        console.log(' Audio response completed');\r\n        this.emit('audio.done', data);\r\n        break;\r\n\r\n      case 'response.audio_transcript.done':\r\n        console.log(' Audio transcript completed');\r\n        this.emit('audio.transcript.done', data);\r\n        break;\r\n\r\n      case 'response.content_part.done':\r\n        console.log(' Content part completed');\r\n        this.emit('content.part.done', data);\r\n        break;\r\n\r\n      case 'response.output_item.done':\r\n        console.log(' Output item completed');\r\n        this.emit('output.item.done', data);\r\n        break;\r\n\r\n      case 'response.done':\r\n        console.log(' Response completed');\r\n        this.emit('response.done', data);\r\n        break;\r\n\r\n      case 'conversation.item.created':\r\n        this.emit('item.created', data.item);\r\n        break;\r\n\r\n      case 'conversation.item.input_audio_transcription.completed':\r\n        console.log(' Input audio transcription completed');\r\n        this.emit('input.transcription.completed', data);\r\n        break;\r\n\r\n      case 'response.output_item.added':\r\n        console.log(' Output item added');\r\n        this.emit('output.item.added', data);\r\n        break;\r\n\r\n      case 'response.content_part.added':\r\n        console.log(' Content part added');\r\n        this.emit('content.part.added', data);\r\n        break;\r\n\r\n      case 'response.audio_transcript.delta':\r\n        console.log(' Audio transcript delta');\r\n        this.emit('audio.transcript.delta', data);\r\n        break;\r\n\r\n      case 'error':\r\n        console.error(' Server error:', data.error);\r\n        // If it's a protocol error, it might indicate we're sending data too early\r\n        if (data.error?.type === 'invalid_request_error') {\r\n          console.error(' Protocol error - possibly sending data before session ready:', data.error.message);\r\n          // Stop audio capture if it's a protocol error related to audio\r\n          if (data.error.message?.includes('input_audio_buffer')) {\r\n            console.log(' Stopping audio capture due to protocol error');\r\n            this.stopAudioCapture().catch(err => console.error('Failed to stop audio:', err));\r\n          }\r\n        }\r\n        this.emit('error', new Error(data.error?.message || 'Server error'));\r\n        break;\r\n\r\n      default:\r\n        console.log(` Unhandled event type: ${data.type}`);\r\n        this.emit('event', data);\r\n        break;\r\n    }\r\n\r\n    // Emit all events generically too\r\n    this.emit('server.event', data);\r\n  }\r\n\r\n  async send(event: ClientEvent): Promise<void> {\r\n    if (!this.websocket || !this.isConnected) {\r\n      throw new Error('WebSocket not connected');\r\n    }\r\n\r\n    try {\r\n      const data = JSON.stringify(event);\r\n      this.websocket.send(data);\r\n      console.log(` Sent event: ${event.type}`);\r\n    } catch (error) {\r\n      console.error(' Failed to send event:', error);\r\n      throw new Error(`Failed to send event: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n\r\n  async startAudioCapture(): Promise<void> {\r\n    try {\r\n      // Request microphone permission and start capturing\r\n      this.currentAudioStream = await navigator.mediaDevices.getUserMedia({\r\n        audio: {\r\n          sampleRate: 24000,\r\n          channelCount: 1,\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true,\r\n        },\r\n      });\r\n\r\n      // Create Web Audio API context for proper PCM16 processing\r\n      this.audioContext = new AudioContext({ sampleRate: 24000 });\r\n      \r\n      // Load the AudioWorklet processor\r\n      await this.audioContext.audioWorklet.addModule('/audio-worklet-processor.js');\r\n      \r\n      const source = this.audioContext.createMediaStreamSource(this.currentAudioStream);\r\n      \r\n      // Create AudioWorkletNode to replace deprecated ScriptProcessorNode\r\n      this.audioWorkletNode = new AudioWorkletNode(this.audioContext, 'audio-input-processor', {\r\n        numberOfInputs: 1,\r\n        numberOfOutputs: 0,\r\n        channelCount: 1,\r\n        channelCountMode: 'explicit',\r\n        channelInterpretation: 'speakers'\r\n      });\r\n      \r\n      // Handle messages from the AudioWorklet processor\r\n      this.audioWorkletNode.port.onmessage = (event) => {\r\n        const { type, audioBuffer, samples, average, peak, active } = event.data;\r\n        \r\n        if (type === 'audioLevel') {\r\n          // Log audio input test data\r\n          console.log(` Audio Input Test - Samples: ${samples}, Average: ${(average * 100).toFixed(2)}%, Peak: ${(peak * 100).toFixed(2)}%, Active: ${active ? 'YES' : 'NO'}`);\r\n        } else if (type === 'audioData' && this.isConnected && this.isSessionReady) {\r\n          // Process the audio data\r\n          this.processAudioChunk(audioBuffer).catch(error => {\r\n            console.error(' Failed to process audio chunk:', error);\r\n          });\r\n        }\r\n      };\r\n      \r\n      // Connect the audio processing chain\r\n      source.connect(this.audioWorkletNode);\r\n\r\n      console.log(' Audio capture started with AudioWorkletNode (replacing deprecated ScriptProcessorNode)');\r\n      this.emit('audio.capture.started');\r\n\r\n    } catch (error) {\r\n      console.error(' Failed to start audio capture:', error);\r\n      throw new Error('Microphone access required for voice interaction');\r\n    }\r\n  }\r\n\r\n  private async processAudioChunk(audioData: Blob | ArrayBuffer): Promise<void> {\r\n    try {\r\n      // Check if connection is still active before processing audio\r\n      if (!this.isConnected) {\r\n        console.warn(' Skipping audio chunk - WebSocket not connected');\r\n        return;\r\n      }\r\n\r\n      // Check if session is ready\r\n      if (!this.isSessionReady) {\r\n        console.warn(' Skipping audio chunk - Session not ready');\r\n        return;\r\n      }\r\n\r\n      let arrayBuffer: ArrayBuffer;\r\n      if (audioData instanceof Blob) {\r\n        arrayBuffer = await audioData.arrayBuffer();\r\n      } else {\r\n        arrayBuffer = audioData;\r\n      }\r\n\r\n      // Ensure even byte length for PCM16 format\r\n      if (arrayBuffer.byteLength % 2 !== 0) {\r\n        console.warn(' Odd byte length detected, padding audio chunk');\r\n        const originalData = new Uint8Array(arrayBuffer);\r\n        const paddedData = new Uint8Array(arrayBuffer.byteLength + 1);\r\n        paddedData.set(originalData);\r\n        paddedData[originalData.length] = 0; // Add padding byte\r\n        arrayBuffer = paddedData.buffer;\r\n      }\r\n\r\n      const base64Audio = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));\r\n      await this.inputAudioBuffer.append(base64Audio);\r\n    } catch (error) {\r\n      console.error(' Failed to process audio chunk:', error);\r\n      // If we fail to send audio, stop capturing to prevent flood of errors\r\n      if (error instanceof Error && error.message.includes('WebSocket not connected')) {\r\n        console.log(' Stopping audio capture due to WebSocket disconnection');\r\n        await this.stopAudioCapture();\r\n      }\r\n    }\r\n  }\r\n\r\n  async stopAudioCapture(): Promise<void> {\r\n    // Clean up Web Audio API resources\r\n    if (this.audioWorkletNode) {\r\n      this.audioWorkletNode.disconnect();\r\n      this.audioWorkletNode = null;\r\n    }\r\n\r\n    if (this.audioContext && this.audioContext.state !== 'closed') {\r\n      await this.audioContext.close();\r\n      this.audioContext = null;\r\n    }\r\n\r\n    // Clean up MediaRecorder (for backwards compatibility)\r\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\r\n      this.mediaRecorder.stop();\r\n      this.mediaRecorder = null;\r\n    }\r\n\r\n    // Clean up MediaStream\r\n    if (this.currentAudioStream) {\r\n      this.currentAudioStream.getTracks().forEach(track => track.stop());\r\n      this.currentAudioStream = null;\r\n    }\r\n\r\n    console.log(' Audio capture stopped');\r\n    this.emit('audio.capture.stopped');\r\n  }\r\n\r\n  async close(): Promise<void> {\r\n    await this.stopAudioCapture();\r\n    \r\n    if (this.websocket && this.isConnected) {\r\n      this.websocket.close(1000, 'Client disconnecting');\r\n    }\r\n    \r\n    this.cleanup();\r\n  }\r\n\r\n  private cleanup(): void {\r\n    this.isConnected = false;\r\n    this.isSessionReady = false;\r\n    this.sessionReadyResolve = null;\r\n    this.sessionId = null;\r\n    this.websocket = null;\r\n\r\n    // Stop audio capture if active\r\n    if (this.mediaRecorder && this.mediaRecorder.state !== 'inactive') {\r\n      console.log(' Stopping MediaRecorder during cleanup');\r\n      this.mediaRecorder.stop();\r\n    }\r\n\r\n    // Stop all audio tracks\r\n    if (this.currentAudioStream) {\r\n      console.log(' Stopping audio stream during cleanup');\r\n      this.currentAudioStream.getTracks().forEach(track => track.stop());\r\n      this.currentAudioStream = null;\r\n    }\r\n\r\n    // Reset MediaRecorder\r\n    this.mediaRecorder = null;\r\n\r\n    if (this.audioContext) {\r\n      this.audioContext.close();\r\n      this.audioContext = null;\r\n    }\r\n  }\r\n\r\n  // Getters\r\n  get connected(): boolean {\r\n    return this.isConnected;\r\n  }\r\n\r\n  get sessionReady(): boolean {\r\n    return this.isSessionReady;\r\n  }\r\n\r\n  get currentSessionId(): string | null {\r\n    return this.sessionId;\r\n  }\r\n}\r\n\r\n// ===== Factory Function =====\r\n\r\nexport async function createVoiceLiveConnection(config: VoiceLiveConfig): Promise<VoiceLiveConnection> {\r\n  const maxRetries = 3;\r\n  const baseDelay = 2000; // 2 seconds\r\n  \r\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      console.log(` Creating Voice Live connection (attempt ${attempt + 1}/${maxRetries + 1})...`);\r\n      \r\n      const connection = new VoiceLiveConnection(config);\r\n      await connection.connect();\r\n      await connection.waitForSessionReady();\r\n      \r\n      console.log(' Voice Live connection established successfully');\r\n      return connection;\r\n      \r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      console.error(` Connection attempt ${attempt + 1} failed:`, errorMessage);\r\n      \r\n      // Check if this is an \"Insufficient resources\" type error\r\n      const isResourceError = errorMessage.toLowerCase().includes('insufficient') || \r\n                             errorMessage.toLowerCase().includes('overloaded') ||\r\n                             errorMessage.toLowerCase().includes('connection failed');\r\n      \r\n      if (attempt < maxRetries && isResourceError) {\r\n        const delay = baseDelay * Math.pow(2, attempt); // Exponential backoff\r\n        console.log(` Retrying in ${delay}ms due to resource constraints...`);\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n      } else {\r\n        // Either max retries reached or non-retryable error\r\n        const finalError = new Error(\r\n          attempt >= maxRetries \r\n            ? `Failed to connect after ${maxRetries + 1} attempts. Azure Voice Live API may be overloaded. Please try again later.`\r\n            : `Connection failed: ${errorMessage}`\r\n        );\r\n        throw finalError;\r\n      }\r\n    }\r\n  }\r\n  \r\n  // This should never be reached due to the throw above, but TypeScript requires it\r\n  throw new Error('Unexpected error in connection retry logic');\r\n}\r\n\r\n// ===== High-Level Service Class =====\r\n\r\nexport class SpeechAvatarService {\r\n  private connection: VoiceLiveConnection | null = null;\r\n  private config: VoiceLiveConfig;\r\n  private audioLevelCallback: ((levels: { average: number; peak: number; active: boolean }) => void) | null = null;\r\n\r\n  constructor(config: VoiceLiveConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      console.log(' Initializing Speech Avatar Service...');\r\n      console.log(' Attempting to connect to Azure Voice Live API...');\r\n      \r\n      // Create and connect with automatic retry logic\r\n      this.connection = await createVoiceLiveConnection(this.config);\r\n      \r\n      // Set up audio level callback if one was previously registered\r\n      if (this.audioLevelCallback) {\r\n        this.connection.audioLevelCallback = this.audioLevelCallback;\r\n      }\r\n      \r\n      // Configure session with behavioral health settings\r\n      await this.configureSession();\r\n      \r\n      console.log(' Speech Avatar Service initialized successfully');\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      console.error(' Failed to initialize Speech Avatar Service:', errorMessage);\r\n      \r\n      // Provide user-friendly error message for common Azure issues\r\n      if (errorMessage.includes('insufficient') || errorMessage.includes('overloaded')) {\r\n        console.log(' Tip: Azure Voice Live API may be experiencing high demand. Try again in a few minutes.');\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async configureSession(): Promise<void> {\r\n    if (!this.connection) {\r\n      throw new Error('Connection not established');\r\n    }\r\n\r\n    const sessionConfig: SessionConfig = {\r\n      modalities: ['text', 'audio'],\r\n      instructions: this.getBehavioralHealthInstructions(),\r\n      voice: {\r\n        name: this.config.voice || 'en-US-AvaNeural',\r\n        type: 'azure-standard',\r\n      },\r\n      input_audio_format: 'pcm16',\r\n      output_audio_format: 'pcm16',\r\n      input_audio_transcription: {\r\n        model: 'whisper-1',\r\n      },\r\n      turn_detection: {\r\n        type: 'azure_semantic_vad',\r\n        threshold: 0.3,\r\n        prefix_padding_ms: 200,\r\n        silence_duration_ms: 500,\r\n      },\r\n      max_response_output_tokens: 4096,\r\n      temperature: 0.7,\r\n    };\r\n\r\n    await this.connection.session.update(sessionConfig);\r\n  }\r\n\r\n  private getBehavioralHealthInstructions(): string {\r\n    return `You are Dr. Sarah Chen, a compassionate and experienced Behavioral Health Support Specialist. \r\n\r\nYour role is to:\r\n- Provide empathetic, non-judgmental support\r\n- Use active listening techniques\r\n- Ask thoughtful, open-ended questions\r\n- Validate feelings and experiences\r\n- Suggest coping strategies when appropriate\r\n- Maintain professional boundaries\r\n- Know when to recommend professional help\r\n\r\nCommunication style:\r\n- Warm, calm, and reassuring tone\r\n- Use \"I\" statements and reflective responses\r\n- Avoid medical advice or diagnosis\r\n- Keep responses concise but meaningful\r\n- Show genuine care and understanding\r\n\r\nRemember: You are a supportive companion, not a therapist. Always encourage seeking professional help for serious concerns.`;\r\n  }\r\n\r\n  onAudioLevel(callback: (levels: { average: number; peak: number; active: boolean }) => void): void {\r\n    this.audioLevelCallback = callback;\r\n    \r\n    // If connection already exists, register the callback immediately\r\n    if (this.connection) {\r\n      this.connection.audioLevelCallback = callback;\r\n    }\r\n  }\r\n\r\n  async checkMicrophonePermission(): Promise<'granted' | 'denied' | 'prompt'> {\r\n    const audioDeviceService = AudioDeviceService.getInstance();\r\n    \r\n    try {\r\n      // Get current permission status\r\n      const permissionStatus = await audioDeviceService.getPermissionStatus();\r\n      \r\n      if (permissionStatus === 'granted' || permissionStatus === 'denied') {\r\n        return permissionStatus;\r\n      }\r\n      \r\n      // Permission is 'prompt' - we can try to request it\r\n      try {\r\n        const result = await audioDeviceService.requestPermission();\r\n        return result.granted ? 'granted' : 'denied';\r\n      } catch (error) {\r\n        console.error(' Failed to request microphone permission:', error);\r\n        return 'denied';\r\n      }\r\n    } catch (error) {\r\n      console.error(' Failed to check microphone permission:', error);\r\n      return 'prompt';\r\n    }\r\n  }\r\n\r\n  async startSession(): Promise<void> {\r\n    console.log(' startSession called, checking connection state...');\r\n    console.log(' this.connection:', this.connection ? 'exists' : 'null');\r\n    console.log(' connection.connected:', this.connection?.connected);\r\n    \r\n    if (!this.connection) {\r\n      console.log(' Connection is null, reinitializing...');\r\n      // Reinitialize the connection\r\n      this.connection = await createVoiceLiveConnection(this.config);\r\n      await this.configureSession();\r\n      console.log(' Connection reinitialized successfully');\r\n    }\r\n\r\n    if (!this.connection.connected) {\r\n      console.log(' Connection lost, attempting to reconnect...');\r\n      await this.connection.connect();\r\n    }\r\n\r\n    // Wait for session to be properly ready before starting audio\r\n    console.log(' Waiting for session to be ready...');\r\n    await this.connection.waitForSessionReady();\r\n    console.log(' Session is ready, starting audio capture...');\r\n\r\n    await this.connection.startAudioCapture();\r\n    console.log(' Speech Avatar session started');\r\n  }\r\n\r\n  async endSession(): Promise<void> {\r\n    if (this.connection) {\r\n      await this.connection.close();\r\n      this.connection = null;\r\n    }\r\n    console.log(' Speech Avatar session ended');\r\n  }\r\n\r\n  // High-level event handlers for component compatibility\r\n  onAgentMessage(callback: (message: AgentMessage) => void): void {\r\n    this.connection?.on('response.audio.done', (event: ServerEvent) => {\r\n      const message: AgentMessage = {\r\n        agentName: 'Speech Avatar',\r\n        content: event.response?.content || '',\r\n        timestamp: new Date().toISOString(),\r\n        confidence: 0.95,\r\n        suggestedActions: []\r\n      };\r\n      callback(message);\r\n    });\r\n  }\r\n\r\n  onUserSpeech(callback: (isActive: boolean) => void): void {\r\n    this.connection?.on('input_audio_buffer.speech_started', () => {\r\n      callback(true);\r\n    });\r\n    this.connection?.on('input_audio_buffer.speech_stopped', () => {\r\n      callback(false);\r\n    });\r\n  }\r\n\r\n  onError(callback: (error: string) => void): void {\r\n    this.connection?.on('error', (event: ServerEvent) => {\r\n      callback(event.error?.message || 'Unknown error');\r\n    });\r\n  }\r\n\r\n  async stopSession(): Promise<void> {\r\n    await this.endSession();\r\n  }\r\n\r\n  // Event delegation\r\n  on(event: string, listener: (...args: unknown[]) => void): void {\r\n    this.connection?.on(event, listener);\r\n  }\r\n\r\n  off(event: string, listener: (...args: unknown[]) => void): void {\r\n    this.connection?.off(event, listener);\r\n  }\r\n\r\n  // Resource access\r\n  get session() {\r\n    return this.connection?.session;\r\n  }\r\n\r\n  get response() {\r\n    return this.connection?.response;\r\n  }\r\n\r\n  get conversation() {\r\n    return this.connection?.conversation;\r\n  }\r\n\r\n  get inputAudioBuffer() {\r\n    return this.connection?.inputAudioBuffer;\r\n  }\r\n\r\n  get outputAudioBuffer() {\r\n    return this.connection?.outputAudioBuffer;\r\n  }\r\n\r\n  get isConnected(): boolean {\r\n    return this.connection?.connected || false;\r\n  }\r\n\r\n  get isSessionReady(): boolean {\r\n    return this.connection?.sessionReady || false;\r\n  }\r\n}\r\n\r\n// ===== Default Export =====\r\nexport default SpeechAvatarService;","import { useState, useEffect } from 'react';\r\nimport { Mic, Settings, AlertCircle, CheckCircle, RefreshCw, Volume2 } from 'lucide-react';\r\nimport type { AudioDevice } from '../services/audioDeviceService';\r\n\r\ninterface MicrophoneSettingsProps {\r\n  speechService: any; // SpeechAvatarService instance\r\n  onClose?: () => void;\r\n  isOpen: boolean;\r\n}\r\n\r\nexport function MicrophoneSettings({ speechService, onClose, isOpen }: MicrophoneSettingsProps) {\r\n  const [devices, setDevices] = useState<AudioDevice[]>([]);\r\n  const [selectedDevice, setSelectedDevice] = useState<AudioDevice | null>(null);\r\n  const [permissionStatus, setPermissionStatus] = useState<'granted' | 'denied' | 'prompt'>('prompt');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string>('');\r\n  const [testingAudio, setTestingAudio] = useState(false);\r\n  const [audioTestResult, setAudioTestResult] = useState<boolean | null>(null);\r\n\r\n  // Load devices and check permissions\r\n  const loadDevices = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError('');\r\n\r\n      // Check permissions first\r\n      const permission = await speechService.checkMicrophonePermission();\r\n      setPermissionStatus(permission);\r\n\r\n      if (permission === 'denied') {\r\n        setError('Microphone access is denied. Please enable microphone permissions in your browser settings.');\r\n        return;\r\n      }\r\n\r\n      // Get available devices\r\n      const availableDevices = await speechService.getAvailableAudioDevices();\r\n      setDevices(availableDevices);\r\n\r\n      // Get current selection\r\n      const current = speechService.getSelectedAudioDevice();\r\n      setSelectedDevice(current);\r\n\r\n      console.log(` Loaded ${availableDevices.length} audio devices`, availableDevices);\r\n\r\n    } catch (err) {\r\n      console.error('Failed to load audio devices:', err);\r\n      setError(err instanceof Error ? err.message : 'Failed to load microphone devices');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Request microphone permission\r\n  const requestPermission = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError('');\r\n\r\n      const result = await speechService.requestMicrophonePermission();\r\n      \r\n      if (result.granted) {\r\n        setPermissionStatus('granted');\r\n        await loadDevices(); // Reload devices after permission granted\r\n      } else {\r\n        setPermissionStatus('denied');\r\n        setError(result.error || 'Permission denied');\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error('Failed to request permission:', err);\r\n      setError(err instanceof Error ? err.message : 'Failed to request permission');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Select audio device\r\n  const selectDevice = (device: AudioDevice) => {\r\n    try {\r\n      speechService.setAudioDevice(device.deviceId);\r\n      setSelectedDevice(device);\r\n      console.log(` Selected device: ${device.label}`);\r\n    } catch (err) {\r\n      console.error('Failed to select device:', err);\r\n      setError('Failed to select audio device');\r\n    }\r\n  };\r\n\r\n  // Test audio input\r\n  const testAudio = async () => {\r\n    try {\r\n      setTestingAudio(true);\r\n      setAudioTestResult(null);\r\n      setError('');\r\n\r\n      console.log(' Testing audio input...');\r\n      const hasInput = await speechService.testAudioInput(10000); // 10 seconds\r\n      setAudioTestResult(hasInput);\r\n\r\n      if (!hasInput) {\r\n        setError('No audio input detected. Please check your microphone settings and try speaking.');\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error('Audio test failed:', err);\r\n      setError('Audio test failed. Please check your microphone connection.');\r\n      setAudioTestResult(false);\r\n    } finally {\r\n      setTestingAudio(false);\r\n    }\r\n  };\r\n\r\n  // Load devices when component opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadDevices();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-200\">\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Settings size={20} className=\"text-gray-600\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900\">Microphone Settings</h2>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n          >\r\n            \r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"p-4 space-y-4\">\r\n          {/* Permission Status */}\r\n          <div className=\"flex items-center space-x-3 p-3 rounded-lg bg-gray-50\">\r\n            {permissionStatus === 'granted' ? (\r\n              <CheckCircle size={20} className=\"text-green-600\" />\r\n            ) : (\r\n              <AlertCircle size={20} className=\"text-yellow-600\" />\r\n            )}\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-900\">\r\n                Permission Status: {permissionStatus === 'granted' ? 'Granted' : 'Required'}\r\n              </p>\r\n              {permissionStatus !== 'granted' && (\r\n                <button\r\n                  onClick={requestPermission}\r\n                  disabled={isLoading}\r\n                  className=\"text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400\"\r\n                >\r\n                  {isLoading ? 'Requesting...' : 'Request Permission'}\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Device Selection */}\r\n          {permissionStatus === 'granted' && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <label className=\"text-sm font-medium text-gray-900\">Available Microphones</label>\r\n                <button\r\n                  onClick={loadDevices}\r\n                  disabled={isLoading}\r\n                  className=\"text-sm text-blue-600 hover:text-blue-700 disabled:text-gray-400 flex items-center space-x-1\"\r\n                >\r\n                  <RefreshCw size={14} className={isLoading ? 'animate-spin' : ''} />\r\n                  <span>Refresh</span>\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"space-y-2 max-h-32 overflow-y-auto\">\r\n                {devices.map((device) => (\r\n                  <button\r\n                    key={device.deviceId}\r\n                    onClick={() => selectDevice(device)}\r\n                    className={`w-full text-left p-3 rounded-lg border transition-colors ${\r\n                      selectedDevice?.deviceId === device.deviceId\r\n                        ? 'border-blue-500 bg-blue-50 text-blue-900'\r\n                        : 'border-gray-200 hover:border-gray-300 text-gray-700'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <Mic size={16} />\r\n                      <span className=\"text-sm font-medium\">{device.label}</span>\r\n                      {device.isDefault && (\r\n                        <span className=\"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded\">\r\n                          Default\r\n                        </span>\r\n                      )}\r\n                      {selectedDevice?.deviceId === device.deviceId && (\r\n                        <CheckCircle size={16} className=\"text-blue-600\" />\r\n                      )}\r\n                    </div>\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              \r\n              {devices.length === 0 && !isLoading && (\r\n                <p className=\"text-sm text-gray-500 text-center py-4\">\r\n                  No microphones found. Please connect a microphone and refresh.\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Audio Test */}\r\n          {permissionStatus === 'granted' && selectedDevice && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <label className=\"text-sm font-medium text-gray-900\">Test Audio Input</label>\r\n                {audioTestResult !== null && (\r\n                  <div className=\"flex items-center space-x-1\">\r\n                    {audioTestResult ? (\r\n                      <CheckCircle size={16} className=\"text-green-600\" />\r\n                    ) : (\r\n                      <AlertCircle size={16} className=\"text-red-600\" />\r\n                    )}\r\n                    <span className={`text-xs ${audioTestResult ? 'text-green-600' : 'text-red-600'}`}>\r\n                      {audioTestResult ? 'Audio detected' : 'No audio detected'}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              <div className=\"mb-2\">\r\n                <p className=\"text-xs text-gray-600\">\r\n                  Click test to hear your microphone input through your speakers. This helps confirm your microphone is working properly.\r\n                </p>\r\n              </div>\r\n              \r\n              <button\r\n                onClick={testAudio}\r\n                disabled={testingAudio || isLoading}\r\n                className=\"w-full p-3 border border-gray-300 rounded-lg hover:border-gray-400 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed\"\r\n              >\r\n                <div className=\"flex items-center justify-center space-x-2\">\r\n                  {testingAudio ? (\r\n                    <>\r\n                      <Volume2 size={16} className=\"text-blue-600 animate-pulse\" />\r\n                      <span className=\"text-sm text-blue-600\">Testing... Speak now! (You should hear your voice)</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Volume2 size={16} className=\"text-gray-600\" />\r\n                      <span className=\"text-sm text-gray-700\">Test Microphone with Playback (10 seconds)</span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Error Display */}\r\n          {error && (\r\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <AlertCircle size={16} className=\"text-red-600\" />\r\n                <p className=\"text-sm text-red-700\">{error}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"p-4 border-t border-gray-200 flex justify-end space-x-2\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors\"\r\n          >\r\n            Close\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MicrophoneSettings;","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Mic, Volume2, VolumeX, Settings, AlertTriangle, Phone } from 'lucide-react';\r\nimport { SpeechAvatarService, SpeechAvatarConfig, AgentMessage } from '../services/speechAvatarServiceV2';\r\nimport MicrophoneSettings from './MicrophoneSettings';\r\n\r\ninterface SpeechAvatarExperienceProps {\r\n  agentType?: 'PHQ9' | 'PHQ2' | 'CRISIS' | 'COMEDIAN';\r\n  userId: string;\r\n  onSessionEnd?: (sessionSummary: any) => void;\r\n  onRiskDetected?: (riskLevel: string) => void;\r\n}\r\n\r\nexport function SpeechAvatarExperience({ \r\n  agentType = 'PHQ9', \r\n  userId, \r\n  onSessionEnd, \r\n  onRiskDetected \r\n}: SpeechAvatarExperienceProps) {\r\n  // State management\r\n  const [isSessionActive, setIsSessionActive] = useState(false);\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [isSpeaking, setIsSpeaking] = useState(false);\r\n  const [sessionId, setSessionId] = useState<string | null>(null);\r\n  const [currentMessage, setCurrentMessage] = useState<string>('');\r\n  const [conversationHistory, setConversationHistory] = useState<AgentMessage[]>([]);\r\n  const [connectionStatus, setConnectionStatus] = useState<'disconnected' | 'connecting' | 'connected' | 'error'>('disconnected');\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const [isAudioEnabled, setIsAudioEnabled] = useState(true);\r\n  const [audioLevels, setAudioLevels] = useState<{ average: number; peak: number; active: boolean }>({ \r\n    average: 0, \r\n    peak: 0, \r\n    active: false \r\n  });\r\n  const [showMicSettings, setShowMicSettings] = useState(false);\r\n  \r\n  // Services and refs\r\n  const speechServiceRef = useRef<SpeechAvatarService | null>(null);\r\n  const avatarVideoRef = useRef<HTMLVideoElement>(null);\r\n  const conversationEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Configuration based on agent type\r\n  const agentConfig = {\r\n    PHQ9: {\r\n      name: 'Dr. Sarah Chen',\r\n      role: 'Depression Screening Specialist',\r\n      voice: 'en-US-AvaNeural',\r\n      personality: 'empathetic, professional, thorough'\r\n    },\r\n    PHQ2: {\r\n      name: 'Dr. Michael Torres',\r\n      role: 'Mental Health Screener',\r\n      voice: 'en-US-GuyNeural',\r\n      personality: 'supportive, gentle, efficient'\r\n    },\r\n    CRISIS: {\r\n      name: 'Dr. Jennifer Walsh',\r\n      role: 'Crisis Intervention Specialist',\r\n      voice: 'en-US-JennyNeural',\r\n      personality: 'calm, authoritative, compassionate'\r\n    },\r\n    COMEDIAN: {\r\n      name: 'Dr. Alex Rivera',\r\n      role: 'Therapeutic Humor Specialist',\r\n      voice: 'en-US-AriaNeural',\r\n      personality: 'warm, humorous, professional'\r\n    }\r\n  }[agentType];\r\n\r\n  // Initialize Speech Avatar Service function\r\n  const initializeSpeechService = useCallback(async () => {\r\n    try {\r\n      // Check if Azure Speech credentials are configured\r\n      const endpoint = import.meta.env.VITE_AZURE_SPEECH_ENDPOINT;\r\n      const apiKey = import.meta.env.VITE_AZURE_SPEECH_API_KEY;\r\n      \r\n      if (!endpoint || !apiKey || apiKey === 'your-azure-speech-api-key') {\r\n        throw new Error('Azure Speech service credentials not configured. Please check your .env.local file.');\r\n      }\r\n\r\n      const config: SpeechAvatarConfig = {\r\n        endpoint,\r\n        apiKey,\r\n        model: import.meta.env.VITE_AZURE_SPEECH_MODEL || 'gpt-4o-realtime-preview',\r\n        voice: import.meta.env.VITE_AZURE_SPEECH_VOICE || agentConfig.voice,\r\n        instructions: import.meta.env.VITE_AGENT_INSTRUCTIONS || `You are ${agentConfig.name}, a ${agentConfig.role}. Your personality is ${agentConfig.personality}. Conduct a compassionate, professional behavioral health interaction.`,\r\n        agentPersonality: {\r\n          name: import.meta.env.VITE_AGENT_NAME || agentConfig.name,\r\n          role: import.meta.env.VITE_AGENT_ROLE || agentConfig.role,\r\n          traits: agentConfig.personality.split(', ')\r\n        }\r\n      };\r\n\r\n      const service = new SpeechAvatarService(config);\r\n      \r\n      // Set up event handlers\r\n      service.onAgentMessage((message: AgentMessage) => {\r\n        setConversationHistory(prev => [...prev, message]);\r\n        setCurrentMessage(message.content);\r\n        \r\n        // Check for risk indicators\r\n        if (message.content.toLowerCase().includes('crisis') || \r\n            message.content.toLowerCase().includes('emergency') ||\r\n            message.content.toLowerCase().includes('harm')) {\r\n          onRiskDetected?.('high');\r\n        }\r\n      });\r\n\r\n      service.onUserSpeech((isActive: boolean) => {\r\n        setIsListening(isActive);\r\n        if (isActive) {\r\n          setIsSpeaking(false);\r\n          setCurrentMessage('Listening...');\r\n        }\r\n      });\r\n\r\n      service.onError((error: string) => {\r\n        setErrorMessage(error);\r\n        setConnectionStatus('error');\r\n      });\r\n\r\n      await service.initialize();\r\n      speechServiceRef.current = service;\r\n      \r\n      // Set up audio level callback after service is initialized\r\n      service.onAudioLevel((levels: { average: number; peak: number; active: boolean }) => {\r\n        setAudioLevels(levels);\r\n      });\r\n      \r\n      setConnectionStatus('connected');\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to initialize Speech Avatar service:', error);\r\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error occurred';\r\n      setErrorMessage(errorMsg);\r\n      setConnectionStatus('error');\r\n    }\r\n  }, [agentConfig]);\r\n\r\n  // Initialize Speech Avatar Service on mount/config change\r\n  useEffect(() => {\r\n    initializeSpeechService();\r\n\r\n    return () => {\r\n      if (speechServiceRef.current) {\r\n        speechServiceRef.current.stopSession();\r\n      }\r\n    };\r\n  }, [initializeSpeechService]);\r\n\r\n  // Auto-scroll to bottom of conversation\r\n  useEffect(() => {\r\n    conversationEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [conversationHistory]);\r\n\r\n  // Start speech session\r\n  const startSession = useCallback(async () => {\r\n    try {\r\n      setConnectionStatus('connecting');\r\n      setErrorMessage('');\r\n      \r\n      // Check if service needs to be reinitialized\r\n      if (!speechServiceRef.current) {\r\n        console.log(' Service not available, reinitializing...');\r\n        await initializeSpeechService();\r\n        \r\n        // Wait a bit for initialization to complete\r\n        if (!speechServiceRef.current) {\r\n          throw new Error('Failed to reinitialize speech service');\r\n        }\r\n        console.log(' Service successfully reinitialized');\r\n      } else {\r\n        console.log(' Service already available, using existing instance');\r\n      }\r\n      \r\n      // First, try to initiate session with backend\r\n      const apiBaseUrl = import.meta.env.VITE_API_BASE || 'http://localhost:7071/api';\r\n      let sessionData;\r\n      \r\n      try {\r\n        const response = await fetch(`${apiBaseUrl}/speech-avatar/sessions`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({\r\n            agentType,\r\n            userId,\r\n            sessionConfig: {\r\n              agentType,\r\n              sessionId: '', // Will be generated by backend\r\n              enableAudio: true,\r\n              preferredVoice: agentConfig.voice\r\n            }\r\n          })\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error('Backend not available');\r\n        }\r\n\r\n        sessionData = await response.json();\r\n      } catch (backendError) {\r\n        console.warn('Backend not available, using fallback session:', backendError);\r\n        // Create a fallback session ID when backend is not available\r\n        sessionData = {\r\n          sessionId: `fallback-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n          status: 'initialized',\r\n          agentType: agentType\r\n        };\r\n      }\r\n\r\n      setSessionId(sessionData.sessionId);\r\n\r\n      // Set session as active BEFORE starting the speech service\r\n      setIsSessionActive(true);\r\n      setConnectionStatus('connected');\r\n      \r\n      // Start the speech avatar session\r\n      try {\r\n        await speechServiceRef.current.startSession();\r\n        console.log(' Speech Avatar session started successfully');\r\n        \r\n        // Force enable listening state since Azure connection isn't working\r\n        setIsListening(true);\r\n        console.log(' Manually setting listening state to true for audio testing');\r\n        \r\n      } catch (speechError) {\r\n        console.warn(' Azure Speech service connection failed, but allowing local audio testing:', speechError);\r\n        // Don't throw here - allow session to continue for audio testing even if Azure isn't available\r\n        setIsListening(true);\r\n      }\r\n      \r\n      // Add welcome message\r\n      const welcomeMessage: AgentMessage = {\r\n        agentName: agentConfig.name,\r\n        content: getWelcomeMessage(agentType),\r\n        timestamp: new Date().toISOString(),\r\n        confidence: 1.0\r\n      };\r\n      \r\n      setConversationHistory([welcomeMessage]);\r\n      setCurrentMessage(welcomeMessage.content);\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to start session:', error);\r\n      setErrorMessage('Failed to start session. Please try again.');\r\n      setConnectionStatus('error');\r\n    }\r\n  }, [userId, agentType, agentConfig, initializeSpeechService]);\r\n\r\n  // End speech session\r\n  const endSession = useCallback(async () => {\r\n    if (!speechServiceRef.current || !sessionId) return;\r\n\r\n    try {\r\n      // End session with backend\r\n      const apiBaseUrl = import.meta.env.VITE_API_BASE || 'http://localhost:7071/api';\r\n      const response = await fetch(`${apiBaseUrl}/speech-avatar/sessions/${sessionId}`, {\r\n        method: 'DELETE'\r\n      });\r\n\r\n      if (response.ok) {\r\n        const sessionSummary = await response.json();\r\n        onSessionEnd?.(sessionSummary);\r\n      }\r\n\r\n      // Stop the speech service\r\n      await speechServiceRef.current.stopSession();\r\n      \r\n      setIsSessionActive(false);\r\n      setIsListening(false);\r\n      setIsSpeaking(false);\r\n      setSessionId(null);\r\n      setConnectionStatus('disconnected');\r\n      setCurrentMessage('Session ended. Thank you for your time.');\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to end session:', error);\r\n      setErrorMessage('Failed to end session properly.');\r\n    }\r\n  }, [sessionId, onSessionEnd]);\r\n\r\n  // Toggle audio\r\n  const toggleAudio = useCallback(() => {\r\n    setIsAudioEnabled(prev => !prev);\r\n    // Here you would implement actual audio muting\r\n  }, []);\r\n\r\n  const getWelcomeMessage = (type: string): string => {\r\n    switch (type) {\r\n      case 'PHQ9':\r\n        return \"Hello! I'm Dr. Sarah Chen. I'd like to have a conversation with you about how you've been feeling lately. This will help us understand your mental health better. Feel free to speak naturally - I'm here to listen.\";\r\n      case 'PHQ2':\r\n        return \"Hi there! I'm Dr. Michael Torres. I'd like to ask you a couple of quick questions about your mood over the past two weeks. Just speak naturally, and I'll listen carefully.\";\r\n      case 'CRISIS':\r\n        return \"Hello, I'm Dr. Jennifer Walsh, a crisis intervention specialist. I'm here to provide immediate support. Please tell me what's happening and how you're feeling right now.\";\r\n      case 'COMEDIAN':\r\n        return \"Hey there! I'm Dr. Alex Rivera. I like to bring a little light-heartedness to our conversations while still taking your mental health seriously. Ready to chat?\";\r\n      default:\r\n        return \"Hello! I'm here to provide behavioral health support. Feel free to share what's on your mind.\";\r\n    }\r\n  };\r\n\r\n  const getConnectionStatusDisplay = () => {\r\n    switch (connectionStatus) {\r\n      case 'connecting':\r\n        return { text: 'Connecting...', color: 'text-yellow-600' };\r\n      case 'connected':\r\n        return { text: 'Connected', color: 'text-green-600' };\r\n      case 'error':\r\n        return { text: 'Connection Error', color: 'text-red-600' };\r\n      default:\r\n        return { text: 'Disconnected', color: 'text-gray-600' };\r\n    }\r\n  };\r\n\r\n  const statusDisplay = getConnectionStatusDisplay();\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen bg-gradient-to-br from-blue-50 to-indigo-100\">\r\n      {/* Header */}\r\n      <div className=\"bg-white shadow-sm border-b border-gray-200 p-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center space-x-4\">\r\n            <div className=\"w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center\">\r\n              <span className=\"text-white font-semibold text-lg\">\r\n                {agentConfig.name.split(' ').map(n => n[0]).join('')}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <h1 className=\"text-xl font-semibold text-gray-900\">{agentConfig.name}</h1>\r\n              <p className=\"text-sm text-gray-600\">{agentConfig.role}</p>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-3\">\r\n            <div className={`flex items-center space-x-2 ${statusDisplay.color}`}>\r\n              <div className={`w-2 h-2 rounded-full ${\r\n                connectionStatus === 'connected' ? 'bg-green-500' : \r\n                connectionStatus === 'connecting' ? 'bg-yellow-500' : \r\n                connectionStatus === 'error' ? 'bg-red-500' : 'bg-gray-500'\r\n              }`}></div>\r\n              <span className=\"text-sm font-medium\">{statusDisplay.text}</span>\r\n            </div>\r\n            \r\n            <button\r\n              onClick={toggleAudio}\r\n              className={`p-2 rounded-full transition-colors ${\r\n                isAudioEnabled ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'\r\n              }`}\r\n              title={isAudioEnabled ? 'Mute Audio' : 'Unmute Audio'}\r\n            >\r\n              {isAudioEnabled ? <Volume2 size={20} /> : <VolumeX size={20} />}\r\n            </button>\r\n\r\n            <button\r\n              onClick={() => setShowMicSettings(true)}\r\n              className=\"p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors\"\r\n              title=\"Microphone Settings\"\r\n            >\r\n              <Settings size={20} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content Area */}\r\n      <div className=\"flex-1 flex\">\r\n        {/* Avatar Video Area */}\r\n        <div className=\"w-1/2 bg-gray-900 relative\">\r\n          <video\r\n            ref={avatarVideoRef}\r\n            className=\"w-full h-full object-cover\"\r\n            autoPlay\r\n            muted={!isAudioEnabled}\r\n            playsInline\r\n          />\r\n          \r\n          {/* Avatar Placeholder */}\r\n          {!avatarVideoRef.current?.srcObject && (\r\n            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n              <div className=\"text-center\">\r\n                <div className=\"w-32 h-32 bg-indigo-600 rounded-full flex items-center justify-center mb-4 mx-auto\">\r\n                  <span className=\"text-white font-bold text-4xl\">\r\n                    {agentConfig.name.split(' ').map(n => n[0]).join('')}\r\n                  </span>\r\n                </div>\r\n                <p className=\"text-white text-lg\">{agentConfig.name}</p>\r\n                <p className=\"text-gray-300\">{agentConfig.role}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Microphone Status Indicator - Always Visible */}\r\n          <div className=\"absolute bottom-4 left-4\">\r\n            {/* Persistent Microphone Icon with Audio Feedback */}\r\n            <div className={`flex items-center space-x-2 px-3 py-2 rounded-full transition-all duration-200 ${\r\n              isSessionActive ? (\r\n                isListening ? (\r\n                  audioLevels.active \r\n                    ? 'bg-green-500 text-white shadow-lg' \r\n                    : 'bg-green-600 text-white'\r\n                ) : isSpeaking \r\n                  ? 'bg-blue-600 text-white'\r\n                  : 'bg-gray-700 text-gray-300'\r\n              ) : 'bg-gray-600 text-gray-400'\r\n            }`}>\r\n              <div className=\"relative\">\r\n                {isSessionActive && isListening ? (\r\n                  <Mic \r\n                    size={18} \r\n                    className={`transition-all duration-150 ${\r\n                      audioLevels.active \r\n                        ? 'scale-125 brightness-125 drop-shadow-md' \r\n                        : 'scale-100 brightness-100'\r\n                    }`}\r\n                  />\r\n                ) : isSessionActive && isSpeaking ? (\r\n                  <Volume2 size={18} />\r\n                ) : (\r\n                  <Mic size={18} />\r\n                )}\r\n                \r\n                {/* Audio level pulse ring */}\r\n                {isSessionActive && isListening && audioLevels.active && (\r\n                  <div \r\n                    className={`absolute inset-0 rounded-full border-2 border-yellow-300 animate-ping ${\r\n                      audioLevels.peak > 0.5 ? 'scale-150 opacity-75' : 'scale-125 opacity-60'\r\n                    }`}\r\n                  />\r\n                )}\r\n              </div>\r\n              \r\n              <span className=\"text-sm font-medium\">\r\n                {!isSessionActive ? 'Mic Ready' :\r\n                 isListening ? (audioLevels.active ? 'Recording...' : 'Listening...') :\r\n                 isSpeaking ? 'Speaking...' : 'Ready'}\r\n              </span>\r\n              \r\n              {/* Audio level bars - only show when actively listening */}\r\n              {isSessionActive && isListening && (\r\n                <div className=\"flex items-center space-x-1\">\r\n                  <div \r\n                    className={`w-1 h-3 rounded-full transition-all duration-150 ${\r\n                      audioLevels.average > 0.1 ? 'bg-yellow-300' : 'bg-green-800'\r\n                    }`}\r\n                  />\r\n                  <div \r\n                    className={`w-1 h-4 rounded-full transition-all duration-150 ${\r\n                      audioLevels.average > 0.2 ? 'bg-yellow-300' : 'bg-green-800'\r\n                    }`}\r\n                  />\r\n                  <div \r\n                    className={`w-1 h-5 rounded-full transition-all duration-150 ${\r\n                      audioLevels.peak > 0.3 ? 'bg-yellow-300' : 'bg-green-800'\r\n                    }`}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Conversation Panel */}\r\n        <div className=\"w-1/2 bg-white flex flex-col\">\r\n          {/* Current Message Display */}\r\n          <div className=\"bg-gray-50 p-6 border-b border-gray-200\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Current Message</h3>\r\n            <p className=\"text-gray-700 leading-relaxed\">\r\n              {currentMessage || 'Waiting for conversation to begin...'}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Conversation History */}\r\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n            {conversationHistory.map((message, index) => (\r\n              <div key={index} className=\"bg-blue-50 rounded-lg p-4\">\r\n                <div className=\"flex items-center space-x-2 mb-2\">\r\n                  <span className=\"font-semibold text-blue-900\">{message.agentName}</span>\r\n                  <span className=\"text-xs text-blue-600\">\r\n                    {new Date(message.timestamp).toLocaleTimeString()}\r\n                  </span>\r\n                </div>\r\n                <p className=\"text-blue-800\">{message.content}</p>\r\n                {message.suggestedActions && message.suggestedActions.length > 0 && (\r\n                  <div className=\"mt-2\">\r\n                    <p className=\"text-sm font-medium text-blue-900\">Suggested Actions:</p>\r\n                    <ul className=\"text-sm text-blue-700 mt-1\">\r\n                      {message.suggestedActions.map((action, actionIndex) => (\r\n                        <li key={actionIndex} className=\"ml-4\"> {action}</li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))}\r\n            <div ref={conversationEndRef} />\r\n          </div>\r\n\r\n          {/* Controls */}\r\n          <div className=\"bg-gray-50 p-4 border-t border-gray-200\">\r\n            {!isSessionActive ? (\r\n              <button\r\n                onClick={startSession}\r\n                disabled={connectionStatus !== 'connected'}\r\n                className=\"w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold \r\n                         hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed\"\r\n              >\r\n                {connectionStatus === 'connecting' ? 'Connecting...' : 'Start Conversation'}\r\n              </button>\r\n            ) : (\r\n              <button\r\n                onClick={endSession}\r\n                className=\"w-full bg-red-600 text-white py-3 px-4 rounded-lg font-semibold \r\n                         hover:bg-red-700 transition-colors flex items-center justify-center space-x-2\"\r\n              >\r\n                <Phone size={18} />\r\n                <span>End Session</span>\r\n              </button>\r\n            )}\r\n\r\n            {/* Error Display */}\r\n            {errorMessage && (\r\n              <div className=\"mt-3 p-3 bg-red-100 border border-red-400 rounded-lg flex items-center space-x-2\">\r\n                <AlertTriangle size={16} className=\"text-red-600\" />\r\n                <span className=\"text-red-700 text-sm\">{errorMessage}</span>\r\n              </div>\r\n            )}\r\n\r\n            {/* Audio Debug Info */}\r\n            {isSessionActive && (\r\n              <div className=\"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                <h4 className=\"text-sm font-medium text-blue-900 mb-2\">Audio Debug Info</h4>\r\n                <div className=\"text-xs text-blue-700 space-y-1\">\r\n                  <div>Listening: {isListening ? 'YES' : 'NO'}</div>\r\n                  <div>Audio Active: {audioLevels.active ? 'YES' : 'NO'}</div>\r\n                  <div>Average Level: {(audioLevels.average * 100).toFixed(1)}%</div>\r\n                  <div>Peak Level: {(audioLevels.peak * 100).toFixed(1)}%</div>\r\n                </div>\r\n                \r\n                {/* Quick Audio Test Button */}\r\n                <button\r\n                  onClick={async () => {\r\n                    console.log(' Starting quick audio test...');\r\n                    const audioService = (await import('../services/audioDeviceService')).default.getInstance();\r\n                    try {\r\n                      const result = await audioService.testAudioInput(3000, false);\r\n                      console.log(` Quick test result: ${result ? 'PASS' : 'FAIL'}`);\r\n                    } catch (error) {\r\n                      console.error(' Quick test failed:', error);\r\n                    }\r\n                  }}\r\n                  className=\"mt-2 px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors\"\r\n                >\r\n                  Quick Audio Test (3s)\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Microphone Settings Modal */}\r\n      <MicrophoneSettings\r\n        speechService={speechServiceRef.current}\r\n        isOpen={showMicSettings}\r\n        onClose={() => setShowMicSettings(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SpeechAvatarExperience;","import React from 'react';\r\nimport { RefreshCw, AlertCircle, Activity, Info } from 'lucide-react';\r\nimport { useHealthCheck } from '@/hooks/api';\r\nimport { useAnnouncements } from '@/hooks/accessibility';\r\n\r\n// Re-export the full UploadAnalyze component\r\nexport { default as UploadAnalyze } from './UploadAnalyze';\r\n\r\n// Re-export the full Sessions component\r\nexport { default as Sessions } from './Sessions';\r\n\r\nexport { default as SessionDetail } from './SessionDetail';\r\n\r\nexport { default as Predictions } from './Predictions';\r\n\r\nexport { default as ControlPanel } from './ControlPanel';\r\n\r\nexport { default as AgentExperience } from './AgentExperience';\r\n\r\nexport { default as SpeechAvatarExperience } from '../components/SpeechAvatarExperience';\r\n\r\nexport const SystemHealth: React.FC = () => {\r\n  const { data: healthStatus, isLoading, error, refetch } = useHealthCheck();\r\n  const { announce } = useAnnouncements();\r\n\r\n  React.useEffect(() => {\r\n    announce('System Health page loaded', 'polite');\r\n  }, [announce]);\r\n\r\n  const formatTimestamp = (timestamp?: string) => {\r\n    if (!timestamp) return 'Just now';\r\n    \r\n    try {\r\n      const date = new Date(timestamp);\r\n      if (isNaN(date.getTime())) {\r\n        return 'Just now';\r\n      }\r\n      \r\n      return date.toLocaleString(undefined, {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n      });\r\n    } catch (error) {\r\n      return 'Just now';\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return 'text-green-600 dark:text-green-400';\r\n      case 'degraded':\r\n        return 'text-yellow-600 dark:text-yellow-400';\r\n      case 'unhealthy':\r\n        return 'text-red-600 dark:text-red-400';\r\n      default:\r\n        return 'text-gray-600 dark:text-gray-400';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return '';\r\n      case 'degraded':\r\n        return '';\r\n      case 'unhealthy':\r\n        return '';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const baseClasses = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-medium';\r\n    switch (status?.toLowerCase()) {\r\n      case 'healthy':\r\n        return `${baseClasses} bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200`;\r\n      case 'degraded':\r\n        return `${baseClasses} bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200`;\r\n      case 'unhealthy':\r\n        return `${baseClasses} bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200`;\r\n      default:\r\n        return `${baseClasses} bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200`;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6 space-y-6\">\r\n      {/* Page Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n            System Health\r\n          </h1>\r\n          <p className=\"text-gray-600 dark:text-gray-300 mt-1\">\r\n            Monitor API status and system connectivity\r\n          </p>\r\n        </div>\r\n        <button type=\"button\"\r\n          onClick={() => refetch()}\r\n          disabled={isLoading}\r\n          className=\"btn btn--secondary flex items-center space-x-2\"\r\n          aria-label=\"Refresh system health status\"\r\n        >\r\n          <RefreshCw className={`w-4 h-4 ${isLoading ? 'animate-spin' : ''}`} />\r\n          <span>Refresh</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Loading State */}\r\n      {isLoading && (\r\n        <div className=\"flex items-center justify-center py-16\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <RefreshCw className=\"w-6 h-6 text-blue-600 animate-spin\" />\r\n            <span className=\"text-lg text-gray-900 dark:text-white\">\r\n              Checking system health...\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Error State */}\r\n      {error && (\r\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6\">\r\n          <div className=\"flex items-center\">\r\n            <AlertCircle className=\"w-6 h-6 text-red-500 mr-3\" />\r\n            <div>\r\n              <h3 className=\"text-lg font-medium text-red-900 dark:text-red-200\">\r\n                Health Check Failed\r\n              </h3>\r\n              <p className=\"text-red-700 dark:text-red-300 mt-1\">\r\n                {error.message || 'Unable to retrieve system health status'}\r\n              </p>\r\n              <button type=\"button\"\r\n                onClick={() => refetch()}\r\n                className=\"mt-3 text-sm text-red-800 dark:text-red-200 hover:text-red-900 dark:hover:text-red-100 underline\"\r\n              >\r\n                Try again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Health Status Display */}\r\n      {healthStatus && !isLoading && (\r\n        <>\r\n          {/* Overall Status Card */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\r\n                Overall System Status\r\n              </h2>\r\n              <div className={getStatusBadge(healthStatus.status)}>\r\n                <span className=\"mr-1\">{getStatusIcon(healthStatus.status)}</span>\r\n                {healthStatus.status}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\">{getStatusIcon(healthStatus.status)}</div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Status</div>\r\n                <div className={`font-medium ${getStatusColor(healthStatus.status)}`}>\r\n                  {healthStatus.status}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\"></div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Response Time</div>\r\n                <div className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {healthStatus.totalDuration ? `${healthStatus.totalDuration}ms` : 'N/A'}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl mb-2\"></div>\r\n                <div className=\"text-sm text-gray-500 dark:text-gray-400\">Last Checked</div>\r\n                <div className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {formatTimestamp(healthStatus.timestamp)}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Individual Service Checks */}\r\n          {healthStatus.checks && Object.keys(healthStatus.checks).length > 0 && (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n                <Activity className=\"w-5 h-5 mr-2\" />\r\n                Service Details\r\n              </h3>\r\n              \r\n              <div className=\"space-y-4\">\r\n                {Object.entries(healthStatus.checks).map(([serviceName, serviceStatus]) => (\r\n                  <div key={serviceName} className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <span className=\"text-lg\">{getStatusIcon(serviceStatus.status)}</span>\r\n                      <div>\r\n                        <div className=\"font-medium text-gray-900 dark:text-white capitalize\">\r\n                          {serviceName.replace(/-/g, ' ')}\r\n                        </div>\r\n                        {serviceStatus.description && (\r\n                          <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                            {serviceStatus.description}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center space-x-4\">\r\n                      {serviceStatus.duration && (\r\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          {serviceStatus.duration}ms\r\n                        </div>\r\n                      )}\r\n                      <div className={getStatusBadge(serviceStatus.status)}>\r\n                        {serviceStatus.status}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* System Information */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center\">\r\n              <Info className=\"w-5 h-5 mr-2\" />\r\n              System Information\r\n            </h3>\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n              <div>\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white mb-3\">API Endpoints</h4>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Health Check:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/health</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Sessions:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/sessions</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between\">\r\n                    <span className=\"text-gray-500 dark:text-gray-400\">Predictions:</span>\r\n                    <span className=\"font-mono text-gray-900 dark:text-white\">/predictions</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <h4 className=\"font-medium text-gray-900 dark:text-white mb-3\">Connection Status</h4>\r\n                <div className=\"space-y-2 text-sm\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">API Connected</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">Real-time Updates</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <div className=\"w-2 h-2 bg-purple-500 rounded-full\"></div>\r\n                    <span className=\"text-gray-900 dark:text-white\">Auto-refresh Enabled</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const NotFound: React.FC = () => {\r\n  return (\r\n    <div className=\"text-center py-16\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Page Not Found</h1>\r\n      <p className=\"text-gray-600 dark:text-gray-400 mb-8\">\r\n        The page you're looking for doesn't exist.\r\n      </p>\r\n      <a\r\n        href=\"/\"\r\n        className=\"btn btn--primary\"\r\n      >\r\n        Go to Dashboard\r\n      </a>\r\n    </div>\r\n  );\r\n};\r\n","import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport { ReactQueryDevtools } from '@tanstack/react-query-devtools';\r\nimport { ThemeProvider } from '@/contexts/ThemeContext';\r\nimport { ConditionalAuthProvider } from '@/components/auth/ConditionalAuthProvider';\r\nimport { ProtectedRoute } from '@/components/auth/AuthGuards';\r\nimport { RoleBasedRedirect } from '@/components/auth/RoleBasedRedirect';\r\nimport { ApiAuthInitializer } from '@/components/auth/ApiAuthInitializer';\r\nimport { Layout } from '@/components/layout/Layout';\r\nimport { APP_ROLES } from '@/config/authConfig';\r\n\r\n// Page components\r\nimport { Dashboard } from '@/pages/Dashboard';\r\nimport { UploadAnalyze, Sessions, SessionDetail, Predictions, ControlPanel, AgentExperience, SpeechAvatarExperience, SystemHealth, NotFound } from '@/pages';\r\n\r\n// Create React Query client\r\nconst queryClient = new QueryClient({\r\n  defaultOptions: {\r\n    queries: {\r\n      retry: (failureCount, error) => {\r\n        // Don't retry on 4xx errors except 408 (timeout)\r\n        if (error && typeof error === 'object' && 'code' in error) {\r\n          const errorCode = (error as any).code;\r\n          if (errorCode?.startsWith('HTTP_4') && errorCode !== 'HTTP_408') {\r\n            return false;\r\n          }\r\n        }\r\n        return failureCount < 3;\r\n      },\r\n      staleTime: 5 * 60 * 1000, // 5 minutes\r\n      refetchOnWindowFocus: false,\r\n    },\r\n    mutations: {\r\n      retry: 1,\r\n    },\r\n  },\r\n});\r\n\r\nfunction App() {\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <ThemeProvider>\r\n        <ConditionalAuthProvider>\r\n          <ApiAuthInitializer>\r\n            <Router>\r\n              <Layout>\r\n                <Routes>\r\n                    {/* Control Panel route - accessible to both Admin and Control Panel roles */}\r\n                    <Route \r\n                      path=\"/\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <RoleBasedRedirect />\r\n                          <Dashboard />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    \r\n                    {/* Admin-only routes */}\r\n                    <Route \r\n                      path=\"/upload\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <UploadAnalyze />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/sessions\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <Sessions />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/sessions/:sessionId\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <SessionDetail />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/predictions\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <Predictions />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/summary\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <ControlPanel />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/agent-experience\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <AgentExperience />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/speech-avatar-experience\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN, APP_ROLES.CONTROL_PANEL]}>\r\n                          <SpeechAvatarExperience userId=\"current-user\" />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    <Route \r\n                      path=\"/health\" \r\n                      element={\r\n                        <ProtectedRoute requireRoles={[APP_ROLES.ADMIN]}>\r\n                          <SystemHealth />\r\n                        </ProtectedRoute>\r\n                      } \r\n                    />\r\n                    \r\n                    {/* 404 page */}\r\n                    <Route path=\"*\" element={<NotFound />} />\r\n                  </Routes>\r\n                </Layout>\r\n              </Router>\r\n            </ApiAuthInitializer>\r\n          </ConditionalAuthProvider>\r\n        </ThemeProvider>\r\n        \r\n        {/* React Query DevTools (only in development) */}\r\n        {import.meta.env.DEV && <ReactQueryDevtools initialIsOpen={false} />}\r\n      </QueryClientProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport App from './App.tsx';\r\nimport './index.css';\r\nimport './styles/dynamic-progress.css';\r\nimport './styles/components.css';\r\nimport './styles/layouts.css';\r\n\r\n// Apply initial theme before React renders\r\nconst storedTheme = localStorage.getItem('bh_theme');\r\nconst prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\nconst initialTheme = storedTheme === 'dark' || (!storedTheme && prefersDark);\r\n\r\nif (initialTheme) {\r\n  document.documentElement.classList.add('dark');\r\n} else {\r\n  document.documentElement.classList.remove('dark');\r\n}\r\n\r\nReactDOM.createRoot(document.getElementById('root')!).render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n);\r\n"],"file":"assets/index-f376f115.js"}