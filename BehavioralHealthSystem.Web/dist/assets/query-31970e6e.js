import{r as u,j as _}from"./react-core-1e64fdba.js";import{s as Q,n as M,a as R,i as b,Q as I}from"./vendor-9cc92b6a.js";var v=u.createContext(void 0),T=e=>{const r=u.useContext(v);if(e)return e;if(!r)throw new Error("No QueryClient set, use QueryClientProvider to set one");return r},L=({client:e,children:r})=>(u.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),_.jsx(v.Provider,{value:e,children:r})),C=u.createContext(!1),w=()=>u.useContext(C);C.Provider;function P(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var N=u.createContext(P()),d=()=>u.useContext(N),B=(e,r)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(r.isReset()||(e.retryOnMount=!1))},O=e=>{u.useEffect(()=>{e.clearReset()},[e])},q=({result:e,errorResetBoundary:r,throwOnError:o,query:a,suspense:s})=>e.isError&&!r.isReset()&&!e.isFetching&&a&&(s&&e.data===void 0||Q(o,[e.error,a])),H=e=>{if(e.suspense){const o=s=>s==="static"?s:Math.max(s??1e3,1e3),a=e.staleTime;e.staleTime=typeof a=="function"?(...s)=>o(a(...s)):o(a),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},U=(e,r)=>e.isLoading&&e.isFetching&&!r,j=(e,r)=>(e==null?void 0:e.suspense)&&r.isPending,S=(e,r,o)=>r.fetchOptimistic(e).catch(()=>{o.clearReset()});function F(e,r,o){var f,E,y,m,g;const a=w(),s=d(),i=T(o),t=i.defaultQueryOptions(e);(E=(f=i.getDefaultOptions().queries)==null?void 0:f._experimental_beforeQuery)==null||E.call(f,t),t._optimisticResults=a?"isRestoring":"optimistic",H(t),B(t,s),O(s);const p=!i.getQueryCache().get(t.queryHash),[n]=u.useState(()=>new r(i,t)),c=n.getOptimisticResult(t),h=!a&&e.subscribed!==!1;if(u.useSyncExternalStore(u.useCallback(l=>{const x=h?n.subscribe(M.batchCalls(l)):R;return n.updateResult(),x},[n,h]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),u.useEffect(()=>{n.setOptions(t)},[t,n]),j(t,c))throw S(t,n,s);if(q({result:c,errorResetBoundary:s,throwOnError:t.throwOnError,query:i.getQueryCache().get(t.queryHash),suspense:t.suspense}))throw c.error;if((m=(y=i.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||m.call(y,t,c),t.experimental_prefetchInRender&&!b&&U(c,a)){const l=p?S(t,n,s):(g=i.getQueryCache().get(t.queryHash))==null?void 0:g.promise;l==null||l.catch(R).finally(()=>{n.updateResult()})}return t.notifyOnChangeProps?c:n.trackResult(c)}function V(e,r){return F(e,I,r)}export{L as Q,V as u};
//# sourceMappingURL=query-31970e6e.js.map
